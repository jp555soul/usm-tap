/*! For license information please see main.49962564.js.LICENSE.txt */
(()=>{var e={356:(e,t,n)=>{e.exports=n(9645).last},477:()=>{},528:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler");Symbol.for("react.provider");var a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.view_transition"),m=Symbol.for("react.client.reference");function g(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case i:case s:case o:case u:case h:case p:return e;default:switch(e=e&&e.$$typeof){case l:case c:case f:case d:case a:return e;default:return t}}case r:return t}}}t.zv=function(e){return g(e)===i}},548:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){var t=e.words,n=e.sigBytes-1;for(n=e.sigBytes-1;n>=0;n--)if(t[n>>>2]>>>24-n%4*8&255){e.sigBytes=n+1;break}}},t.pad.ZeroPadding)}()},579:(e,t,n)=>{"use strict";e.exports=n(2799)},870:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isObject=function(e){return null!==e&&("object"===typeof e||"function"===typeof e)}},879:function(e){e.exports=function(){"use strict";var e,t,n;function r(r,i){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),n=i(s),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=i;else e=i}return r(["exports"],function(e){var t=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;function r(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*o-i*r;return s?(e[0]=o*(s=1/s),e[1]=-r*s,e[2]=-i*s,e[3]=n*s,e):null}function i(){var e=new n(9);return n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function o(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=i*c-r*u,e[2]=r*a-i*s,e[3]=a*l-o*u,e[4]=n*u-i*l,e[5]=i*o-n*a,e[6]=o*c-s*l,e[7]=r*l-n*c,e[8]=n*s-r*o,e}function s(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],f=n[1],p=n[2],m=n[3],g=n[4],_=n[5],y=n[6],v=n[7],x=n[8];return e[0]=d*r+f*s+p*c,e[1]=d*i+f*a+p*u,e[2]=d*o+f*l+p*h,e[3]=m*r+g*s+_*c,e[4]=m*i+g*a+_*u,e[5]=m*o+g*l+_*h,e[6]=y*r+v*s+x*c,e[7]=y*i+v*a+x*u,e[8]=y*o+v*l+x*h,e}function a(){var e=new n(16);return n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function c(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=n*a-r*s,v=n*l-i*s,x=n*c-o*s,b=r*l-i*a,w=r*c-o*a,S=i*c-o*l,E=u*m-h*p,T=u*g-d*p,A=u*_-f*p,C=h*g-d*m,P=h*_-f*m,I=d*_-f*g,k=y*I-v*P+x*C+b*A-w*T+S*E;return k?(e[0]=(a*I-l*P+c*C)*(k=1/k),e[1]=(i*P-r*I-o*C)*k,e[2]=(m*S-g*w+_*b)*k,e[3]=(d*w-h*S-f*b)*k,e[4]=(l*A-s*I-c*T)*k,e[5]=(n*I-i*A+o*T)*k,e[6]=(g*x-p*S-_*v)*k,e[7]=(u*S-d*x+f*v)*k,e[8]=(s*P-a*A+c*E)*k,e[9]=(r*A-n*P-o*E)*k,e[10]=(p*w-m*x+_*y)*k,e[11]=(h*x-u*w-f*y)*k,e[12]=(a*T-s*C-l*E)*k,e[13]=(n*C-r*T+i*E)*k,e[14]=(m*v-p*b-g*y)*k,e[15]=(u*b-h*v+d*y)*k,e):null}function u(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=n[0],x=n[1],b=n[2],w=n[3];return e[0]=v*r+x*a+b*h+w*m,e[1]=v*i+x*l+b*d+w*g,e[2]=v*o+x*c+b*f+w*_,e[3]=v*s+x*u+b*p+w*y,e[4]=(v=n[4])*r+(x=n[5])*a+(b=n[6])*h+(w=n[7])*m,e[5]=v*i+x*l+b*d+w*g,e[6]=v*o+x*c+b*f+w*_,e[7]=v*s+x*u+b*p+w*y,e[8]=(v=n[8])*r+(x=n[9])*a+(b=n[10])*h+(w=n[11])*m,e[9]=v*i+x*l+b*d+w*g,e[10]=v*o+x*c+b*f+w*_,e[11]=v*s+x*u+b*p+w*y,e[12]=(v=n[12])*r+(x=n[13])*a+(b=n[14])*h+(w=n[15])*m,e[13]=v*i+x*l+b*d+w*g,e[14]=v*o+x*c+b*f+w*_,e[15]=v*s+x*u+b*p+w*y,e}function h(e,t,n){var r,i,o,s,a,l,c,u,h,d,f,p,m=n[0],g=n[1],_=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=r=t[0],e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=r*m+a*g+h*_+t[12],e[13]=i*m+l*g+d*_+t[13],e[14]=o*m+c*g+f*_+t[14],e[15]=s*m+u*g+p*_+t[15]),e}function d(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=s*i+u*r,e[6]=a*i+h*r,e[7]=l*i+d*r,e[8]=c*i-o*r,e[9]=u*i-s*r,e[10]=h*i-a*r,e[11]=d*i-l*r,e}function p(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=s*i-u*r,e[2]=a*i-h*r,e[3]=l*i-d*r,e[8]=o*r+c*i,e[9]=s*r+u*i,e[10]=a*r+h*i,e[11]=l*r+d*i,e}function m(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=s*i+u*r,e[2]=a*i+h*r,e[3]=l*i+d*r,e[4]=c*i-o*r,e[5]=u*i-s*r,e[6]=h*i-a*r,e[7]=d*i-l*r,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _(e,n,r){var i,o,s,a=r[0],l=r[1],c=r[2],u=Math.hypot(a,l,c);return u<t?null:(a*=u=1/u,l*=u,c*=u,i=Math.sin(n),o=Math.cos(n),e[0]=a*a*(s=1-o)+o,e[1]=l*a*s+c*i,e[2]=c*a*s-l*i,e[3]=0,e[4]=a*l*s-c*i,e[5]=l*l*s+o,e[6]=c*l*s+a*i,e[7]=0,e[8]=a*c*s+l*i,e[9]=l*c*s-a*i,e[10]=c*c*s+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function y(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,l=i+i,c=n*s,u=r*s,h=r*a,d=i*s,f=i*a,p=i*l,m=o*s,g=o*a,_=o*l;return e[0]=1-h-p,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=f+m,e[7]=0,e[8]=d+g,e[9]=f-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var v=u;function x(){var e=new n(3);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function w(e){return Math.hypot(e[0],e[1],e[2])}function S(e,t,r){var i=new n(3);return i[0]=e,i[1]=t,i[2]=r,i}function E(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function T(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function A(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function C(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function P(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function I(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function k(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function M(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function R(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function O(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function L(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function D(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function N(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function z(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=i*l-o*a,e[1]=o*s-r*l,e[2]=r*a-i*s,e}function F(e,t,n,r){var i=t[0],o=t[1],s=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e}function B(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/(s=s||1),e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,e}function j(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function U(e,t,n){var r=n[0],i=n[1],o=n[2],s=t[0],a=t[1],l=t[2],c=i*l-o*a,u=o*s-r*l,h=r*a-i*s,d=i*h-o*u,f=o*c-r*h,p=r*u-i*c,m=2*n[3];return u*=m,h*=m,f*=2,p*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+f,e[2]=l+h+p,e}function V(e){return e[0]=0,e[1]=0,e[2]=0,e}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var H=A,$=C,W=w;function q(){var e=new n(4);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function X(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Z(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=o*s,e}function K(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,e}function Y(){var e=new n(4);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function J(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Q(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+s*a,e[1]=i*l+o*a,e[2]=o*l-i*a,e[3]=s*l-r*a,e}function ee(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l-o*a,e[1]=i*l+s*a,e[2]=o*l+r*a,e[3]=s*l-i*a,e}x(),q();var te,ne,re,ie=Z,oe=(te=x(),ne=S(1,0,0),re=S(0,1,0),function(e,t,n){var r=N(t,n);return r<-.999999?(z(te,ne,t),W(te)<1e-6&&z(te,re,t),D(te,te),function(e,t,n){n*=.5;var r=Math.sin(n);e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n)}(e,te,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(z(te,t,n),e[0]=te[0],e[1]=te[1],e[2]=te[2],e[3]=1+r,ie(e,e))});function se(){var e=new n(2);return n!=Float32Array&&(e[0]=0,e[1]=0),e}function ae(e,t){var r=new n(2);return r[0]=e,r[1]=t,r}function le(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ce(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function ue(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function he(e){return Math.hypot(e[0],e[1])}function de(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function fe(e,t){return e[0]*t[0]+e[1]*t[1]}Y(),Y(),i();var pe,me,ge=ce;function _e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}se();var ye=function(){if(me)return pe;function e(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}return me=1,pe=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=i/o}var s=0,a=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},pe}(),ve=_e(ye);function xe(e,t){this.x=e,this.y=t}function be(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!be(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!be(e[n],t[n]))return!1;return!0}return e===t}xe.prototype={clone(){return new xe(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround(e,t){const n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:xe},xe.convert=function(e){if(e instanceof xe)return e;if(Array.isArray(e))return new xe(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new xe(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};const we=Math.PI/180,Se=180/Math.PI;function Ee(e){return e*we}function Te(e){return e*Se}const Ae=[[0,0],[1,0],[1,1],[0,1]];function Ce(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Pe(e,t,n,r){const i=new ve(e,t,n,r);return function(e){return i.solve(e)}}const Ie=Pe(.25,.1,.25,1);function ke(e,t,n){return Math.min(n,Math.max(t,e))}function Me(e,t,n){return(n=ke((n-e)/(t-e),0,1))*n*(3-2*n)}function Re(e,t,n){const r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function Oe(e,t,n){if(!e.length)return n(null,[]);let r=e.length;const i=new Array(e.length);let o=null;e.forEach((e,s)=>{t(e,(e,t)=>{e&&(o=e),i[s]=t,0==--r&&n(o,i)})})}function Le(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const i of n)for(const t in i)e[t]=i[t];return e}let De=1;function Ne(){return De++}function ze(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Fe(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function Be(e,t,n){const r={};for(const i in e)r[i]=t.call(this,e[i],i,e);return r}function je(e,t,n){const r={};for(const i in e)t.call(this,e[i],i,e)&&(r[i]=e[i]);return r}function Ue(e){return Array.isArray(e)?e.map(Ue):"object"==typeof e&&e?Be(e,Ue):e}function Ve(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}const Ge={};function He(e){Ge[e]||("undefined"!=typeof console&&console.warn(e),Ge[e]=!0)}function $e(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function We(e){let t=0;for(let n,r,i=0,o=e.length,s=o-1;i<o;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}function qe(e){let[t,n,r]=e;const i=Ee(n+90),o=Ee(r);return{x:t*Math.cos(i)*Math.sin(o),y:t*Math.sin(i)*Math.sin(o),z:t*Math.cos(o),azimuthal:n,polar:r}}function Xe(e){return("undefined"!=typeof self||void 0!==e)&&"undefined"!=typeof WorkerGlobalScope&&(void 0!==e?e:self)instanceof WorkerGlobalScope}function Ze(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,n,r,i)=>{const o=r||i;return t[n]=!o||o.toLowerCase(),""}),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let Ke=null;function Ye(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Je(e,t,n,r){for(;t<n;){const i=t+n>>1;e[i]<r?t=i+1:n=i}return t}function Qe(e,t,n,r){for(;t<n;){const i=t+n>>1;e[i]<=r?t=i+1:n=i}return t}function et(e){return e>0?1/(1.001-e):1+e}function tt(e){return e>0?1-1/(1.001-e):-e}function nt(e,t,n){return(e-t.min)*(n.max-n.min)/(t.max-t.min)+n.min}const rt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!rt.API_URL)return null;try{const e=new URL(rt.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function it(e){return rt.API_URL_REGEX.test(e)}function ot(e){return rt.API_SPRITE_REGEX.test(e)}let st,at,lt,ct,ut,ht;function dt(){return null==st&&(st=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),st}const ft={now:()=>void 0!==ct?ct:performance.now(),setNow(e){ct=e},restoreNow(){ct=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:n,height:r}=e;ut||(ut=document.createElement("canvas"));const i=ut.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return(n>ut.width||r>ut.height)&&(ut.width=n,ut.height=r),i.clearRect(-t,-t,n+2*t,r+2*t),i.drawImage(e,0,0,n,r),i.getImageData(-t,-t,n+2*t,r+2*t)},resolveURL:e=>(at||(at=document.createElement("a")),at.href=e,at.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==lt&&(lt=window.matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)},hasCanvasFingerprintNoise(){if(void 0!==ht)return ht;if(!dt())return ht=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let n=0;for(let i=0;i<e.width;++i)t.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,t.fillRect(i,0,1,1);const r=t.getImageData(0,0,e.width,e.height);n=0;for(let i=0;i<r.data.length;++i)if(i%4!=3&&n++!==r.data[i])return ht=!0,!0;return ht=!1,!1}};function pt(e,t){const n=e.indexOf("?");if(n<0)return`${e}?${new URLSearchParams(t).toString()}`;const r=new URLSearchParams(e.slice(n));for(const i in t)r.set(i,t[i]);return`${e.slice(0,n)}?${r.toString()}`}function mt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const n=e.indexOf("?");if(n<0)return e;const r=new URLSearchParams,i=new URLSearchParams(e.slice(n));for(const s of t.persistentParams){const e=i.get(s);e&&r.set(s,e)}const o=r.toString();return`${e.slice(0,n)}${o.length>0?`?${o}`:""}`}const gt="mapbox-tiles";let _t=500,yt=50;const vt=["language","worldview","jobid"];let xt,bt;function wt(){try{return caches}catch(e){}}function St(){const e=wt();e&&null==xt&&(xt=e.open(gt))}let Et=1/0;const Tt={supported:!1,testSupport:function(e){!Pt&&Ct&&(It?Mt(e):At=e)}};let At,Ct,Pt=!1,It=!1;const kt="undefined"!=typeof self?self:{};function Mt(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ct),e.isContextLost())return;Tt.supported=!0}catch(e){}e.deleteTexture(t),Pt=!0}kt.document&&(Ct=kt.document.createElement("img"),Ct.onload=function(){At&&Mt(At),At=null,It=!0},Ct.onerror=function(){Pt=!0,At=null},Ct.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Rt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Rt);class Ot extends Error{constructor(e,t,n){401===t&&it(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Lt=Xe()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Dt=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Lt())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new AbortController,r=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Lt(),referrerPolicy:e.referrerPolicy,signal:n.signal});let i=!1,o=!1;const s=(a=r.url).indexOf("sku=")>0&&it(a);var a;"json"===e.type&&r.headers.set("Accept","application/json");const l=(n,i,a)=>{if(o)return;if(n&&"SecurityError"!==n.message&&He(n.toString()),i&&a)return c(i);const l=Date.now();fetch(r).then(n=>{if(n.ok){const e=s?n.clone():null;return c(n,e,l)}return t(new Ot(n.statusText,n.status,e.url))}).catch(n=>{"AbortError"!==n.name&&t(new Error(`${n.message} ${e.url}`))})},c=(n,s,a)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then(e=>{o||(s&&a&&function(e,t,n){if(St(),null==xt)return;const r=Ze(t.headers.get("Cache-Control")||"");if(r["no-store"])return;const i={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach((e,t)=>i.headers.set(t,e)),r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString());const o=i.headers.get("Expires");if(!o)return;if(new Date(o).getTime()-n<42e4)return;let s=mt(e.url,{persistentParams:vt});if(206===t.status){const t=e.headers.get("Range");if(!t)return;i.status=200,s=pt(s,{range:t})}!function(e,t){if(void 0===bt)try{new Response(new ReadableStream),bt=!0}catch(e){bt=!1}bt?t(e.body):e.blob().then(t).catch(e=>He(e.message))}(t,e=>{const n=new Response(200!==(r=t.status)&&404!==r&&[101,103,204,205,304].includes(r)?null:e,i);var r;St(),null!=xt&&xt.then(e=>e.put(s,n)).catch(e=>He(e.message))})}(r,s,a),i=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))}).catch(e=>{o||t(new Error(e.message))})};return s?function(e,t){if(St(),null==xt)return t(null);xt.then(n=>{let r=mt(e.url,{persistentParams:vt});const i=e.headers.get("Range");i&&(r=pt(r,{range:i})),n.match(r).then(e=>{const i=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=Ze(e.headers.get("Cache-Control")||"");return Number(t)>Date.now()&&!n["no-cache"]}(e);n.delete(r).catch(t),i&&n.put(r,e.clone()).catch(t),t(null,e,i)}).catch(t)}).catch(t)}(r,l):l(null,null),{cancel:()=>{o=!0,i||n.abort()}}}(e,t);if(Xe(self)&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){const n=new XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const r in e.headers)n.setRequestHeader(r,e.headers[r]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let r=n.response;if("json"===e.type)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new Ot(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},Nt=function(e,t){return Dt(Le(e,{type:"arrayBuffer"}),t)};function zt(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const Ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Bt,jt;Bt=[],jt=0;const Ut=function(e,t){if(Tt.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),jt>=rt.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Bt.push(n),n}jt++;let n=!1;const r=()=>{if(!n)for(n=!0,jt--;Bt.length&&jt<rt.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Bt.shift(),{requestParameters:t,callback:n,cancelled:r}=e;r||(e.cancel=Ut(t,n).cancel)}},i=Nt(e,(e,n,i,o)=>{r(),e?t(e):n&&(self.createImageBitmap?function(e,t){const n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then(e=>{t(null,e)}).catch(e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(n,(e,n)=>t(e,n,i,o)):function(e,t){const n=new Image;n.onload=()=>{t(null,n),URL.revokeObjectURL(n.src),n.onload=null,requestAnimationFrame(()=>{n.src=Ft})},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?URL.createObjectURL(r):Ft}(n,(e,n)=>t(e,n,i,o)))});return{cancel:()=>{i.cancel(),r()}}};var Vt,Gt,Ht,$t={exports:{}},Wt={exports:{}},qt={exports:{}},Xt=function(){if(Ht)return $t.exports;Ht=1;var e=(Vt||(Vt=1,Wt.exports=function(e,t){var n,r,i,o,s,a,l,c;for(r=e.length-(n=3&e.length),i=t,s=3432918353,a=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}),Wt.exports),t=(Gt||(Gt=1,qt.exports=function(e,t){for(var n,r=e.length,i=t^r,o=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&e.charCodeAt(o+2))<<16;case 2:i^=(255&e.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}),qt.exports);return $t.exports=e,$t.exports.murmur3=e,$t.exports.murmur2=t,$t.exports}(),Zt=_e(Xt);class Kt{constructor(e){Le(this,(arguments.length<=1?void 0:arguments[1])||{}),this.type=e}}class Yt extends Kt{constructor(e){super("error",Le({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}function Jt(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Qt(e,t,n){if(n&&n[e]){const r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}class en{on(e,t){return this._listeners=this._listeners||{},Jt(e,t,this._listeners),this}off(e,t){return Qt(e,t,this._listeners),Qt(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(e,t,this._oneTimeListeners),this):new Promise(t=>{this.once(e,t)})}fire(e,t){const n="string"==typeof e?new Kt(e,t):e,r=n.type;if(this.listens(r)){n.target=this;const e=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of e)r.call(this,n);const t=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const o of t)Qt(r,o,this._oneTimeListeners),o.call(this,n);const i=this._eventedParent;i&&(Le(n,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(n))}else n instanceof Yt&&console.error(n.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}class tn{constructor(e){"string"==typeof e?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new tn(e)}static toString(e){return e.iconsetId?`${e.name}\x1f${e.iconsetId}`:e.name}static parse(e){const[t,n]=e.split("\x1f");return new tn({name:t,iconsetId:n})}static isEqual(e,t){return e.name===t.name&&e.iconsetId===t.iconsetId}toString(){return tn.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var nn,rn={},on=function(){if(nn)return rn;nn=1;var e={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return t("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function r(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function i(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{rn.parseCSSColor=function(o){var s,a=o.replace(/ /g,"").toLowerCase();if(a in e)return e[a].slice();if("#"===a[0])return 4===a.length?(s=parseInt(a.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:7===a.length&&(s=parseInt(a.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=r(h.pop());case"rgb":return 3!==h.length?null:[n(h[0]),n(h[1]),n(h[2]),d];case"hsla":if(4!==h.length)return null;d=r(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=r(h[1]),m=r(h[2]),g=m<=.5?m*(p+1):m+p-m*p,_=2*m-g;return[t(255*i(_,g,f+1/3)),t(255*i(_,g,f)),t(255*i(_,g,f-1/3)),d];default:return null}}return null}}catch(e){}return rn}();class sn{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=n,this.a=r}static parse(e){if(!e)return;if(e instanceof sn)return e;if("string"!=typeof e)return;const t=on.parseCSSColor(e);return t?new sn(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}toString(){const[e,t,n,r]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*t)},${Math.round(255*n)},${r})`}toNonPremultipliedRenderColor(e){const{r:t,g:n,b:r,a:i}=this;return new ln(e,t,n,r,i)}toPremultipliedRenderColor(e){const{r:t,g:n,b:r,a:i}=this;return new cn(e,t*i,n*i,r*i,i)}clone(){return new sn(this.r,this.g,this.b,this.a)}}class an{constructor(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(this.premultiplied=!1,this.premultiplied=o,e){const o=e.image.height,s=o*o;this.premultiplied?(t=0===i?0:t/i*(o-1),n=0===i?0:n/i*(o-1),r=0===i?0:r/i*(o-1)):(t*=o-1,n*=o-1,r*=o-1);const a=Math.floor(t),l=Math.floor(n),c=Math.floor(r),u=Math.ceil(t),h=Math.ceil(n),d=Math.ceil(r),f=t-a,p=n-l,m=r-c,g=e.image.data,_=4*(a+l*s+c*o),y=4*(a+l*s+d*o),v=4*(a+h*s+c*o),x=4*(a+h*s+d*o),b=4*(u+l*s+c*o),w=4*(u+l*s+d*o),S=4*(u+h*s+c*o),E=4*(u+h*s+d*o);if(_<0||E>=g.length)throw new Error("out of range");this.r=un(un(un(g[_],g[y],m),un(g[v],g[x],m),p),un(un(g[b],g[w],m),un(g[S],g[E],m),p),f)/255*(this.premultiplied?i:1),this.g=un(un(un(g[_+1],g[y+1],m),un(g[v+1],g[x+1],m),p),un(un(g[b+1],g[w+1],m),un(g[S+1],g[E+1],m),p),f)/255*(this.premultiplied?i:1),this.b=un(un(un(g[_+2],g[y+2],m),un(g[v+2],g[x+2],m),p),un(un(g[b+2],g[w+2],m),un(g[S+2],g[E+2],m),p),f)/255*(this.premultiplied?i:1),this.a=i}else this.r=t,this.g=n,this.b=r,this.a=i}toArray(){const{r:e,g:t,b:n,a:r}=this;return[255*e,255*t,255*n,r]}toHslaArray(){let{r:e,g:t,b:n,a:r}=this;if(this.premultiplied){if(0===r)return[0,0,0,0];e/=r,t/=r,n/=r}const i=Math.min(Math.max(e,0),1),o=Math.min(Math.max(t,0),1),s=Math.min(Math.max(n,0),1),a=Math.min(i,o,s),l=Math.max(i,o,s),c=(a+l)/2;if(a===l)return[0,0,100*c,r];const u=l-a,h=c>.5?u/(2-l-a):u/(l+a);let d=0;return l===i?d=(o-s)/u+(o<s?6:0):l===o?d=(s-i)/u+2:l===s&&(d=(i-o)/u+4),d*=60,[Math.min(Math.max(d,0),360),Math.min(Math.max(100*h,0),100),Math.min(Math.max(100*c,0),100),r]}toArray01(){const{r:e,g:t,b:n,a:r}=this;return[e,t,n,r]}toArray01Scaled(e){const{r:t,g:n,b:r}=this;return[t*e,n*e,r*e]}toArray01Linear(){const{r:e,g:t,b:n,a:r}=this;return[Math.pow(e,2.2),Math.pow(t,2.2),Math.pow(n,2.2),r]}}class ln extends an{constructor(e,t,n,r,i){super(e,t,n,r,i,!1)}}class cn extends an{constructor(e,t,n,r,i){super(e,t,n,r,i,!0)}}function un(e,t,n){return e*(1-n)+t*n}function hn(e,t,n){return e.map((e,r)=>un(e,t[r],n))}sn.black=new sn(0,0,0,1),sn.white=new sn(1,1,1,1),sn.transparent=new sn(0,0,0,0),sn.red=new sn(1,0,0,1),sn.blue=new sn(0,0,1,1);var dn=Object.freeze({__proto__:null,array:hn,color:function(e,t,n){return new sn(un(e.r,t.r,n),un(e.g,t.g,n),un(e.b,t.b,n),un(e.a,t.a,n))},number:un});function fn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const i of n)for(const t in i)e[t]=i[t];return e}class pn extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class mn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[n,r]of t)this.bindings[n]=r}concat(e){return new mn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const gn={kind:"null"},_n={kind:"number"},yn={kind:"string"},vn={kind:"boolean"},xn={kind:"color"},bn={kind:"object"},wn={kind:"value"},Sn={kind:"collator"},En={kind:"formatted"},Tn={kind:"resolvedImage"};function An(e,t){return{kind:"array",itemType:e,N:t}}function Cn(e){if("array"===e.kind){const t=Cn(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Pn=[gn,_n,yn,vn,xn,En,bn,An(wn),Tn];function In(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!In(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Pn)if(!In(e,t))return null}return`Expected ${Cn(e)} but found ${Cn(t)} instead.`}function kn(e,t){return t.some(t=>t.kind===e.kind)}function Mn(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function Rn(e,t){return"array"===e.kind&&"array"===t.kind?e.N===t.N&&Rn(e.itemType,t.itemType):e.kind===t.kind}class On{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ln{constructor(e,t,n,r,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=r,this.textColor=i}}class Dn{constructor(e){this.sections=e}static fromString(e){return new Dn([new Ln(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Dn?e:Dn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){const n=t.image.getPrimary().id.toString();e.push(["image",n]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(n)}return e}}class Nn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.id=tn.from(e),this.options=Object.assign({},t),t.transform){const{a:e,b:n,c:r,d:i,e:o,f:s}=t.transform;this.options.transform=new DOMMatrix([e,n,r,i,o,s])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:t,c:n,d:r,e:i,f:o}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:t,c:n,d:r,e:i,f:o}})}static parse(e){let t,n,r,i;try{({name:t,iconsetId:n,params:r,transform:i}=JSON.parse(e)||{})}catch(e){return null}if(!t)return null;const{a:o,b:s,c:a,d:l,e:c,f:u}=i||{};return new Nn({name:t,iconsetId:n},{params:r,transform:new DOMMatrix([o,s,a,l,c,u])})}scaleSelf(e,t){return this.options.transform.scaleSelf(e,t),this}}class zn{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.primaryId=tn.from(e),this.primaryOptions=t,n&&(this.secondaryId=tn.from(n)),this.secondaryOptions=r,this.available=i}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Nn(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Nn(this.secondaryId,this.secondaryOptions):null}static from(e){return"string"==typeof e?zn.build({name:e}):e}static build(e,t,n,r){return!e||"object"==typeof e&&!("name"in e)?null:new zn(e,n,t,r)}}function Fn(e,t,n,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bn(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof sn)return!0;if(e instanceof On)return!0;if(e instanceof Dn)return!0;if(e instanceof zn)return!0;if(Array.isArray(e)){for(const t of e)if(!Bn(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Bn(e[t]))return!1;return!0}return!1}function jn(e){if(null===e)return gn;if("string"==typeof e)return yn;if("boolean"==typeof e)return vn;if("number"==typeof e)return _n;if(e instanceof sn)return xn;if(e instanceof On)return Sn;if(e instanceof Dn)return En;if(e instanceof zn)return Tn;if(Array.isArray(e)){const t=e.length;let n;for(const r of e){const e=jn(r);if(n){if(n===e)continue;n=wn;break}n=e}return An(n||wn,t)}return bn}function Un(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Dn||e instanceof zn||e instanceof sn?e.toString():JSON.stringify(e)}class Vn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Bn(e[1]))return t.error("invalid value");const n=e[1];let r=jn(n);const i=t.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new Vn(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof sn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Dn?this.value.serialize():this.value}}class Gn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Hn={string:yn,number:_n,boolean:vn,object:bn};class $n{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,r=1;const i=e[0];if("array"===i){let i,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in Hn)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=Hn[n],r++}else i=wn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}n=An(i,o)}else n=Hn[i];const o=[];for(;r<e.length;r++){const n=t.parse(e[r],r,wn);if(!n)return null;o.push(n)}return new $n(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!In(this.type,jn(n)))return n;if(t===this.args.length-1)throw new Gn(`The expression ${JSON.stringify(this.args[t].serialize())} evaluated to ${Cn(jn(n))} but was expected to be of type ${Cn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map(e=>e.serialize()))}}class Wn{constructor(e){this.type=En,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const r=[];let i=!1;for(let o=1;o<=e.length-1;++o){const n=e[o];if(i&&"object"==typeof n&&!Array.isArray(n)){i=!1;let e=null;if(n["font-scale"]&&(e=t.parseObjectValue(n["font-scale"],o,"font-scale",_n),!e))return null;let s=null;if(n["text-font"]&&(s=t.parseObjectValue(n["text-font"],o,"text-font",An(yn)),!s))return null;let a=null;if(n["text-color"]&&(a=t.parseObjectValue(n["text-color"],o,"text-color",xn),!a))return null;const l=r[r.length-1];l.scale=e,l.font=s,l.textColor=a}else{const n=t.parse(e[o],o,wn);if(!n)return null;const s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:n,scale:null,font:null,textColor:null})}}return new Wn(r)}evaluate(e){return new Dn(this.sections.map(t=>{const n=t.content.evaluate(e);return Rn(jn(n),Tn)?new Ln("",n,null,null,null):new Ln(Un(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class qn{constructor(e,t,n,r){this._imageWarnHistory={},this.type=Tn,this.namePrimary=e,this.nameSecondary=t,n&&(this.paramsPrimary=n.params,this.iconsetIdPrimary=n.iconset?n.iconset.id:void 0),r&&(this.paramsSecondary=r.params,this.iconsetIdSecondary=r.iconset?r.iconset.id:void 0)}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");let n=1;const r=[];function i(){if(n<e.length){const i=t.parse(e[n],n++,yn);return i?(r.push({image:i,options:{}}),!0):(t.error(r.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function o(){if(n<e.length){const o=e[n];if(null===(i=o)||"object"!=typeof i||Array.isArray(i))return!0;const s=o.params,a=o.iconset,l=t.concat(n);if(!s&&!a)return n++,!0;if(s){if("object"!=typeof s||s.constructor!==Object)return l.error('Image options "params" should be an object'),!1;const e={},t=l.concat(void 0,"params");for(const n in s){if(!n)return t.error("Image parameter name should be non-empty"),!1;const r=t.concat(void 0,n).parse(s[n],void 0,xn,void 0,{typeAnnotation:"coerce"});if(!r)return!1;e[n]=r}r[r.length-1].options.params=e}if(a){if("object"!=typeof a||a.constructor!==Object)return l.error('Image options "iconset" should be an object'),!1;if(!a.id)return l.error('Image options "iconset" should have an "id" property'),!1;r[r.length-1].options.iconset=a}return n++,!0}var i;return!0}for(let s=0;s<2;s++)if(!i()||!o())return;return new qn(r[0].image,r[1]?r[1].image:void 0,r[0].options,r[1]?r[1].options:void 0)}evaluateParams(e,t){const n={};if(t){for(const r in t)if(t[r])try{n[r]=t[r].evaluate(e)}catch(e){continue}if(0!==Object.keys(n).length)return{params:n}}}evaluate(e){const t={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},n=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,r=zn.build(t,n,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(r&&e.availableImages){const t=r.getPrimary().id;if(r.available=e.availableImages.some(e=>tn.isEqual(e,t)),r.available){const t=r.getSecondary()?r.getSecondary().id:null;t&&(r.available=e.availableImages.some(e=>tn.isEqual(e,t)))}}return r}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const t in this.paramsPrimary)this.paramsPrimary[t]&&e(this.paramsPrimary[t]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const t in this.paramsSecondary)this.paramsSecondary[t]&&e(this.paramsSecondary[t])}outputDefined(){return!1}serializeOptions(e,t){const n={};if(t&&(n.iconset={id:t}),e){n.params={};for(const t in e)e[t]&&(n.params[t]=e[t].serialize())}return Object.keys(n).length>0?n:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const t=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);t&&e.push(t)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const t=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);t&&e.push(t)}return e}}function Xn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Zn={"to-boolean":vn,"to-color":xn,"to-number":_n,"to-string":yn};class Kn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0],r=[];let i=gn;if("to-array"===n){if(!Array.isArray(e[1]))return null;const n=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);i=An(t.expectedType.itemType,n)}else{if(!(n>0&&Bn(e[1][0])))return null;i=An(jn(e[1][0]),n)}for(let o=0;o<n;o++){const n=e[1][o];let s;if("array"===Xn(n))s=t.parse(n,void 0,i.itemType);else{const e=Xn(n);if(e!==i.itemType.kind)return t.error(`Expected ${i.itemType.kind} but found ${e}.`);s=t.registry.literal.parse(["literal",void 0===n?null:n],t)}if(!s)return null;r.push(s)}}else{if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");i=Zn[n];for(let n=1;n<e.length;n++){const i=t.parse(e[n],n,wn);if(!i)return null;r.push(i)}}return new Kn(i,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const r of this.args){if(t=r.evaluate(e),n=null,t instanceof sn)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Fn(t[0],t[1],t[2],t[3]),!n))return new sn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Gn(n||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Gn(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Dn.fromString(Un(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?zn.build(Un(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(t=>t.evaluate(e)):Un(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Wn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new qn(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Yn=["Unknown","Point","LineString","Polygon"];class Jn{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Yn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=sn.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class Qn{constructor(e,t,n,r,i){this.name=e,this.type=t,this._evaluate=n,this.args=r,this._overloadIndex=i}evaluate(e){if(!this._evaluate){const e=Qn.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],r=Qn.definitions[n];if(!r)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=[];let a=null,l=-1;for(const[c,u]of o){if(Array.isArray(c)&&c.length!==e.length-1)continue;s.push(c),l++,a=new xi(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const r=[];let o=!1;for(let t=1;t<e.length;t++){const n=e[t],i=Array.isArray(c)?c[t-1]:c.type,s=a.parse(n,1+r.length,i);if(!s){o=!0;break}r.push(s)}if(!o)if(Array.isArray(c)&&c.length!==r.length)a.error(`Expected ${c.length} arguments, but found ${r.length} instead.`);else{for(let e=0;e<r.length;e++){const t=Array.isArray(c)?c[e]:c.type,n=r[e];a.concat(e+1).checkSubtype(t,n.type)}if(0===a.errors.length)return new Qn(n,i,u,r,l)}}if(1===s.length)t.errors.push(...a.errors);else{const n=(s.length?s:o.map(e=>{let[t]=e;return t})).map(er).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(Cn(n.type))}t.error(`Expected arguments of type ${n}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){Qn.definitions=t;for(const n in t)e[n]=Qn}}function er(e){return Array.isArray(e)?`(${e.map(Cn).join(", ")})`:`(${Cn(e.type)}...)`}class tr{constructor(e,t,n){this.type=Sn,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const r=void 0===n["case-sensitive"]?t.parse(!1,1,vn):t.parseObjectValue(n["case-sensitive"],1,"case-sensitive",vn);if(!r)return null;const i=void 0===n["diacritic-sensitive"]?t.parse(!1,1,vn):t.parseObjectValue(n["diacritic-sensitive"],1,"diacritic-sensitive",vn);if(!i)return null;let o=null;return n.locale&&(o=t.parseObjectValue(n.locale,1,"locale",yn),!o)?null:new tr(r,i,o)}evaluate(e){return new On(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function nr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ir;for(;r>n;){if(r-n>600){const o=r-n+1,s=t-n+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);nr(e,t,Math.max(n,Math.floor(t-s*l/o+c)),Math.min(r,Math.floor(t+(o-s)*l/o+c)),i)}const o=e[t];let s=n,a=r;for(rr(e,n,t),i(e[r],o)>0&&rr(e,n,r);s<a;){for(rr(e,s,a),s++,a--;i(e[s],o)<0;)s++;for(;i(e[a],o)>0;)a--}0===i(e[n],o)?rr(e,n,a):(a++,rr(e,a,r)),a<=t&&(n=a+1),t<=a&&(r=a-1)}}function rr(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function ir(e,t){return e<t?-1:e>t?1:0}function or(e){let t=0;for(let n,r,i=0,o=e.length,s=o-1;i<o;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}function sr(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ar(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function lr(e,t,n){const r=e[0]-t[0],i=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return r*s-o*i==0&&r*o<=0&&i*s<=0}function cr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(lr(e,a,u))return n;(o=a)[1]>(i=e)[1]!=(s=u)[1]>i[1]&&i[0]<(s[0]-o[0])*(i[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}}var i,o,s;return r}function ur(e,t,n,r){const i=r[0]-n[0],o=r[1]-n[1],s=(e[0]-n[0])*o-i*(e[1]-n[1]),a=(t[0]-n[0])*o-i*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function hr(e,t,n,r){return 0!=(i=[r[0]-n[0],r[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*o[0]&&!(!ur(e,t,n,r)||!ur(n,r,e,t));var i,o}function dr(e){const t=new xe(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new xe(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const r of e[0])t.x>r.x&&(t.x=r.x),t.y>r.y&&(t.y=r.y),n.x<r.x&&(n.x=r.x),n.y<r.y&&(n.y=r.y);return{min:t,max:n}}const fr=8192;function pr(e,t){const n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(n*i*fr),Math.round(r*i*fr)]}function mr(e,t){for(let n=0;n<t.length;n++)if(cr(e,t[n]))return!0;return!1}function gr(e,t,n){for(const r of n)for(let n=0,i=r.length,o=i-1;n<i;o=n++)if(hr(e,t,r[o],r[n]))return!0;return!1}function _r(e,t){for(let n=0;n<e.length;++n)if(!cr(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(gr(e[n],e[n+1],t))return!1;return!0}function yr(e,t){for(let n=0;n<t.length;n++)if(_r(e,t[n]))return!0;return!1}function vr(e,t,n){const r=[];for(let i=0;i<e.length;i++){const o=[];for(let r=0;r<e[i].length;r++){const s=pr(e[i][r],n);sr(t,s),o.push(s)}r.push(o)}return r}function xr(e,t,n){const r=[];for(let i=0;i<e.length;i++){const o=vr(e[i],t,n);r.push(o)}return r}function br(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){const t=.5*r;let i=e[0]-n[0]>t?-r:n[0]-e[0]>t?r:0;0===i&&(i=e[0]-n[2]>t?-r:n[2]-e[0]>t?r:0),e[0]+=i}sr(t,e)}function wr(e,t,n,r){const i=Math.pow(2,r.z)*fr,o=[r.x*fr,r.y*fr],s=[];if(!e)return s;for(const a of e)for(const e of a){const r=[e.x+o[0],e.y+o[1]];br(r,t,n,i),s.push(r)}return s}function Sr(e,t,n,r){const i=Math.pow(2,r.z)*fr,o=[r.x*fr,r.y*fr],s=[];if(!e)return s;for(const l of e){const e=[];for(const n of l){const r=[n.x+o[0],n.y+o[1]];sr(t,r),e.push(r)}s.push(e)}if(t[2]-t[0]<=i/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const r of e)br(r,t,n,i)}var a;return s}class Er{constructor(e,t){this.type=vn,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Er(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Er(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Er(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=vr(t.coordinates,r,i),s=wr(e.geometry(),n,r,i);if(!ar(n,r))return!1;for(const e of s)if(!cr(e,o))return!1}if("MultiPolygon"===t.type){const o=xr(t.coordinates,r,i),s=wr(e.geometry(),n,r,i);if(!ar(n,r))return!1;for(const e of s)if(!mr(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=vr(t.coordinates,r,i),s=Sr(e.geometry(),n,r,i);if(!ar(n,r))return!1;for(const e of s)if(!_r(e,o))return!1}if("MultiPolygon"===t.type){const o=xr(t.coordinates,r,i),s=Sr(e.geometry(),n,r,i);if(!ar(n,r))return!1;for(const e of s)if(!yr(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Tr={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ar=1/298.257223563,Cr=Ar*(2-Ar),Pr=Math.PI/180;class Ir{static fromTile(e,t,n){const r=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),i=Math.atan(.5*(Math.exp(r)-Math.exp(-r)))/Pr;return new Ir(i,n)}static get units(){return Tr}constructor(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!Tr[t])throw new Error(`Unknown unit ${t}. Use one of: ${Object.keys(Tr).join(", ")}`);const n=6378.137*Pr*(t?Tr[t]:1),r=Math.cos(e*Pr),i=1/(1-Cr*(1-r*r)),o=Math.sqrt(i);this.kx=n*o*r,this.ky=n*o*i*(1-Cr)}distance(e,t){const n=Rr(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+r*r)}bearing(e,t){const n=Rr(t[0]-e[0])*this.kx;return Math.atan2(n,(t[1]-e[1])*this.ky)/Pr}destination(e,t,n){const r=n*Pr;return this.offset(e,Math.sin(r)*t,Math.cos(r)*t)}offset(e,t,n){return[e[0]+t/this.kx,e[1]+n/this.ky]}lineDistance(e){let t=0;for(let n=0;n<e.length-1;n++)t+=this.distance(e[n],e[n+1]);return t}area(e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];for(let e=0,i=r.length,o=i-1;e<i;o=e++)t+=Rr(r[e][0]-r[o][0])*(r[e][1]+r[o][1])*(n?-1:1)}return Math.abs(t)/2*this.kx*this.ky}along(e,t){let n=0;if(t<=0)return e[0];for(let r=0;r<e.length-1;r++){const i=e[r],o=e[r+1],s=this.distance(i,o);if(n+=s,n>t)return Mr(i,o,(t-(n-s))/s)}return e[e.length-1]}pointToSegmentDistance(e,t,n){let[r,i]=t,o=Rr(n[0]-r)*this.kx,s=(n[1]-i)*this.ky;if(0!==o||0!==s){const t=(Rr(e[0]-r)*this.kx*o+(e[1]-i)*this.ky*s)/(o*o+s*s);t>1?(r=n[0],i=n[1]):t>0&&(r+=o/this.kx*t,i+=s/this.ky*t)}return o=Rr(e[0]-r)*this.kx,s=(e[1]-i)*this.ky,Math.sqrt(o*o+s*s)}pointOnLine(e,t){let n=1/0,r=e[0][0],i=e[0][1],o=0,s=0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=Rr(e[a+1][0]-l)*this.kx,h=(e[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(Rr(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=Rr(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const f=u*u+h*h;f<n&&(n=f,r=l,i=c,o=a,s=d)}return{point:[r,i],index:o,t:Math.max(0,Math.min(1,s))}}lineSlice(e,t,n){let r=this.pointOnLine(n,e),i=this.pointOnLine(n,t);if(r.index>i.index||r.index===i.index&&r.t>i.t){const e=r;r=i,i=e}const o=[r.point],s=r.index+1,a=i.index;!kr(n[s],o[0])&&s<=a&&o.push(n[s]);for(let l=s+1;l<=a;l++)o.push(n[l]);return kr(n[a],i.point)||o.push(i.point),o}lineSliceAlong(e,t,n){let r=0;const i=[];for(let o=0;o<n.length-1;o++){const s=n[o],a=n[o+1],l=this.distance(s,a);if(r+=l,r>e&&0===i.length&&i.push(Mr(s,a,(e-(r-l))/l)),r>=t)return i.push(Mr(s,a,(t-(r-l))/l)),i;r>e&&i.push(a)}return i}bufferPoint(e,t){const n=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-n,e[0]+r,e[1]+n]}bufferBBox(e,t){const n=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-n,e[2]+r,e[3]+n]}insideBBox(e,t){return Rr(e[0]-t[0])>=0&&Rr(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]}}function kr(e,t){return e[0]===t[0]&&e[1]===t[1]}function Mr(e,t,n){const r=Rr(t[0]-e[0]);return[e[0]+r*n,e[1]+(t[1]-e[1])*n]}function Rr(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}class Or{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const i=e-1>>1,o=t[i];if(n(r,o)>=0)break;t[e]=o,e=i}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&n(t[o],t[r])<0&&(r=o),n(t[r],i)>=0)break;t[e]=t[r],e=r}t[e]=i}}var Lr=8192;function Dr(e,t){return t.dist-e.dist}const Nr=100,zr=50;function Fr(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Br(e){return e[1]-e[0]+1}function jr(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function Ur(e,t){if(e[0]>e[1])return[null,null];const n=Br(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===n)return[e,null];const t=Math.floor(n/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function Vr(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!jr(t,e.length))return n;for(let r=t[0];r<=t[1];++r)sr(n,e[r]);return n}function Gr(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)sr(t,e[n][r]);return t}function Hr(e,t,n){if(Fr(e)||Fr(t))return NaN;let r=0,i=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),n.distance([0,0],[r,i])}function $r(e){return 360*e-180}function Wr(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function qr(e,t){const n=Math.pow(2,t.z),r=(e.y/Lr+t.y)/n;return[$r((e.x/Lr+t.x)/n),Wr(r)]}function Xr(e,t){const n=[];for(let r=0;r<e.length;++r)n.push(qr(e[r],t));return n}function Zr(e,t,n){const r=n.pointOnLine(t,e).point;return n.distance(e,r)}function Kr(e,t,n,r,i){const o=n.slice(r[0],r[1]+1);let s=1/0;for(let a=t[0];a<=t[1];++a)if(0===(s=Math.min(s,Zr(e[a],o,i))))return 0;return s}function Yr(e,t,n,r,i){const o=Math.min(i.pointToSegmentDistance(e,n,r),i.pointToSegmentDistance(t,n,r)),s=Math.min(i.pointToSegmentDistance(n,e,t),i.pointToSegmentDistance(r,e,t));return Math.min(o,s)}function Jr(e,t,n,r,i){if(!jr(t,e.length)||!jr(r,n.length))return NaN;let o=1/0;for(let s=t[0];s<t[1];++s)for(let t=r[0];t<r[1];++t){if(hr(e[s],e[s+1],n[t],n[t+1]))return 0;o=Math.min(o,Yr(e[s],e[s+1],n[t],n[t+1],i))}return o}function Qr(e,t,n,r,i){if(!jr(t,e.length)||!jr(r,n.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=r[0];t<=r[1];++t)if(0===(o=Math.min(o,i.distance(e[s],n[t]))))return o;return o}function ei(e,t,n){if(cr(e,t,!0))return 0;let r=1/0;for(const i of t){const t=i.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(i[0]!==i[t-1]&&0===(r=Math.min(r,n.pointToSegmentDistance(e,i[t-1],i[0]))))return r;if(0===(r=Math.min(r,Zr(e,i,n))))return r}return r}function ti(e,t,n,r){if(!jr(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(cr(e[o],n,!0))return 0;let i=1/0;for(let o=t[0];o<t[1];++o)for(const t of n)for(let n=0,s=t.length,a=s-1;n<s;a=n++){if(hr(e[o],e[o+1],t[a],t[n]))return 0;i=Math.min(i,Yr(e[o],e[o+1],t[a],t[n],r))}return i}function ni(e,t){for(const n of e)for(let e=0;e<=n.length-1;++e)if(cr(n[e],t,!0))return!0;return!1}function ri(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const i=Gr(e),o=Gr(t);if(r!==1/0&&Hr(i,o,n)>=r)return r;if(ar(i,o)){if(ni(e,t))return 0}else if(ni(t,e))return 0;let s=r;for(const a of e)for(let e=0,r=a.length,i=r-1;e<r;i=e++)for(const o of t)for(let t=0,r=o.length,l=r-1;t<r;l=t++){if(hr(a[i],a[e],o[l],o[t]))return 0;s=Math.min(s,Yr(a[i],a[e],o[l],o[t],n))}return s}function ii(e,t,n,r,i,o,s){if(null===o||null===s)return;const a=Hr(Vr(r,o),Vr(i,s),n);a<t&&e.push({dist:a,range1:o,range2:s})}function oi(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=Math.min(r.distance(e[0],n[0][0]),i);if(0===o)return o;const s=new Or([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Dr),a=t?zr:Nr,l=Gr(n);for(;s.length;){const i=s.pop();if(i.dist>=o)continue;const c=i.range1;if(Br(c)<=a){if(!jr(c,e.length))return NaN;if(t){const t=ti(e,c,n,r);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const i=ei(e[t],n,r);if(0===(o=Math.min(o,i)))return o}}else{const n=Ur(c,t);if(null!==n[0]){const t=Hr(Vr(e,n[0]),l,r);t<o&&s.push({dist:t,range1:n[0],range2:[0,0]})}if(null!==n[1]){const t=Hr(Vr(e,n[1]),l,r);t<o&&s.push({dist:t,range1:n[1],range2:[0,0]})}}}return o}function si(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,s=Math.min(o,i.distance(e[0],n[0]));if(0===s)return s;const a=new Or([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],Dr),l=t?zr:Nr,c=r?zr:Nr;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(Br(u)<=l&&Br(h)<=c){if(!jr(u,e.length)||!jr(h,n.length))return NaN;if(t&&r?s=Math.min(s,Jr(e,u,n,h,i)):t||r?t&&!r?s=Math.min(s,Kr(n,h,e,u,i)):!t&&r&&(s=Math.min(s,Kr(e,u,n,h,i))):s=Math.min(s,Qr(e,u,n,h,i)),0===s)return s}else{const o=Ur(u,t),l=Ur(h,r);ii(a,s,i,e,n,o[0],l[0]),ii(a,s,i,e,n,o[0],l[1]),ii(a,s,i,e,n,o[1],l[0]),ii(a,s,i,e,n,o[1],l[1])}}return s}function ai(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=Vr(e,[0,e.length-1]);for(const s of n)if(!(i!==1/0&&Hr(o,Vr(s,[0,s.length-1]),r)>=i)&&(i=Math.min(i,si(e,t,s,!0,r,i)),0===i))return i;return i}function li(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=Vr(e,[0,e.length-1]);for(const s of n){if(i!==1/0&&Hr(o,Gr(s),r)>=i)continue;const n=oi(e,t,s,r,i);if(isNaN(n))return n;if(0===(i=Math.min(i,n)))return i}return i}function ci(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class ui{constructor(e,t){this.type=_n,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Bn(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(ci(t.features[e].geometry.type))return new ui(t,t.features[e].geometry)}else if("Feature"===t.type){if(ci(t.geometry.type))return new ui(t,t.geometry)}else if(ci(t.type))return new ui(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),n=e.canonicalID();if(null!=t&&null!=n){if("Point"===e.geometryType())return function(e,t,n){const r=[];for(const o of e)for(const e of o)r.push(qr(e,t));const i=new Ir(r[0][1],"meters");return"Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type?si(r,!1,"Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i):"MultiLineString"===n.type?ai(r,!1,n.coordinates,i):"Polygon"===n.type||"MultiPolygon"===n.type?li(r,!1,"Polygon"===n.type?[n.coordinates]:n.coordinates,i):null}(t,n,this.geometries);if("LineString"===e.geometryType())return function(e,t,n){const r=[];for(const o of e){const e=[];for(const n of o)e.push(qr(n,t));r.push(e)}const i=new Ir(r[0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return ai("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r,i);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=ai(n.coordinates[t],!0,r,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===n.type||"MultiPolygon"===n.type){let e=1/0;for(let t=0;t<r.length;t++){const o=li(r[t],!0,"Polygon"===n.type?[n.coordinates]:n.coordinates,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,n,this.geometries);if("Polygon"===e.geometryType())return function(e,t,n){const r=[];for(const o of function(e){const t=e.length;if(t<=1)return[e];const n=[];let r,i;for(let o=0;o<t;o++){const t=or(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===i&&(i=t<0),i===t<0?(r&&n.push(r),r=[e[o]]):r.push(e[o]))}return r&&n.push(r),n}(e)){const e=[];for(let n=0;n<o.length;++n)e.push(Xr(o[n],t));r.push(e)}const i=new Ir(r[0][0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return li("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r,i);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=li(n.coordinates[t],!0,r,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===n.type||"MultiPolygon"===n.type?function(e,t,n){let r=1/0;for(const i of e)for(const e of t){const t=ri(i,e,n,r);if(isNaN(t))return t;if(0===(r=Math.min(r,t)))return r}return r}("Polygon"===n.type?[n.coordinates]:n.coordinates,r,i):null}(t,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function hi(e){if(e instanceof Qn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Er)return!1;if(e instanceof ui)return!1;if(e instanceof yi)return e.featureConstant;let t=!0;return e.eachChild(e=>{t&&!hi(e)&&(t=!1)}),t}function di(e){if(e instanceof Qn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!di(e)&&(t=!1)}),t}function fi(e){if(e instanceof yi)return new Set([e.key]);let t=new Set;return e.eachChild(e=>{t=new Set([...t,...fi(e)])}),t}function pi(e,t){if(e instanceof Qn&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(e=>{n&&!pi(e,t)&&(n=!1)}),n}function mi(e,t,n){return[e,t,n].filter(Boolean).join("\x1f")}function gi(e,t){switch(e){case"string":return Un(t);case"number":return+t;case"boolean":return!!t;case"color":return sn.parse(t);case"formatted":return Dn.fromString(Un(t));case"resolvedImage":return zn.build(Un(t))}return t}function _i(e,t,n,r){return void 0!==r&&(e=r*Math.round(e/r)),void 0!==t&&e<t&&(e=t),void 0!==n&&e>n&&(e=n),e}class yi{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.type=e,this.key=t,this.scope=n,this.featureConstant=r}static parse(e,t){let n=t.expectedType;if(null==n&&(n=wn),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const r=t.parse(e[1],1);if(!(r instanceof Vn))return t.error("Key name of 'config' expression must be a string literal.");let i,o=!0;const s=Un(r.value);if(e.length>=3){const n=t.parse(e[2],2);if(!(n instanceof Vn))return t.error("Scope of 'config' expression must be a string literal.");i=Un(n.value)}if(t.options){const e=mi(s,i,t._scope),n=t.options.get(e);n&&(o=hi(n.value||n.default))}return new yi(n,s,i,o)}evaluate(e){const t=mi(this.key,this.scope,e.scope),n=e.getConfig(t);if(!n)return null;const{type:r,value:i,values:o,minValue:s,maxValue:a,stepValue:l}=n,c=n.default.evaluate(e);let u=c;if(i){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),u=i.evaluate(e),e.scope=t}return r&&(u=gi(r,u)),void 0===u||void 0===s&&void 0===a&&void 0===l||("number"==typeof u?u=_i(u,s,a,l):Array.isArray(u)&&(u=u.map(e=>"number"==typeof e?_i(e,s,a,l):e))),void 0!==i&&void 0!==u&&o&&!o.includes(u)&&(u=c,r&&(u=gi(r,u))),(r&&r!==this.type||void 0!==u&&!Rn(jn(u),this.type))&&(u=gi(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class vi{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new vi(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class xi{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mn,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;this.registry=e,this.path=t,this.key=t.map(e=>"string"==typeof e?`['${e}']`:`[${e}]`).join(""),this.scope=r,this.errors=i,this.expectedType=n,this._scope=o,this.options=s}parse(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||n?this.concat(t,null,n,r)._parse(e,i):this._parse(e,i)}parseObjectValue(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.concat(t,n,r,i)._parse(e,o)}_parse(e,t){function n(e,t,n){return"assert"===n?new $n(t,[e]):"coerce"===n?new Kn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r="string"==typeof e[0]?this.registry[e[0]]:void 0;if(r){let i=r.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,r=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else i=n(i,e,t.typeAnnotation||"coerce");else i=n(i,e,t.typeAnnotation||"assert")}if(!(i instanceof Vn)&&"resolvedImage"!==i.type.kind&&bi(i)){const t=new Jn(this._scope,this.options);try{i=new Vn(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return Kn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n,r){let i="number"==typeof e?this.path.concat(e):this.path;i="string"==typeof t?i.concat(t):i;const o=r?this.scope.concat(r):this.scope;return new xi(this.registry,i,n||null,o,this.errors,this._scope,this.options)}error(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=`${this.key}${n.map(e=>`[${e}]`).join("")}`;this.errors.push(new pn(i,e))}checkSubtype(e,t){const n=In(e,t);return n&&this.error(n),n}}function bi(e){if(e instanceof vi)return bi(e.boundExpression);if(e instanceof Qn&&"error"===e.name)return!1;if(e instanceof tr)return!1;if(e instanceof Er)return!1;if(e instanceof ui)return!1;if(e instanceof yi)return!1;const t=e instanceof Kn||e instanceof $n;let n=!0;return e.eachChild(e=>{n=t?n&&bi(e):n&&e instanceof Vn}),!!n&&hi(e)&&pi(e,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wi(e,t){const n=e.length-1;let r,i,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],i=e[a+1],r<=t){if(a===n||t<i)return a;o=a+1}else{if(!(r>t))throw new Gn("Input is not a number.");s=a-1}return 0}class Si{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[r,i]of n)this.labels.push(r),this.outputs.push(i)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,_n);if(!n)return null;const r=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let o=1;o<e.length;o+=2){const n=1===o?-1/0:e[o],s=e[o+1],a=o,l=o+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,i);if(!c)return null;i=i||c.type,r.push([n,c])}return new Si(i,n,r)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);const i=t.length;return r>=t[i-1]?n[i-1].evaluate(e):n[wi(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const Ei=.95047,Ti=1.08883,Ai=4/29,Ci=6/29,Pi=3*Ci*Ci,Ii=Ci*Ci*Ci,ki=Math.PI/180,Mi=180/Math.PI;function Ri(e){return e>Ii?Math.pow(e,1/3):e/Pi+Ai}function Oi(e){return e>Ci?e*e*e:Pi*(e-Ai)}function Li(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Di(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ni(e){const t=Di(e.r),n=Di(e.g),r=Di(e.b),i=Ri((.4124564*t+.3575761*n+.1804375*r)/Ei),o=Ri((.2126729*t+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-Ri((.0193339*t+.119192*n+.9503041*r)/Ti)),alpha:e.a}}function zi(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Oi(t),n=Ei*Oi(n),r=Ti*Oi(r),new sn(Li(3.2404542*n-1.5371385*t-.4985314*r),Li(-.969266*n+1.8760108*t+.041556*r),Li(.0556434*n-.2040259*t+1.0572252*r),e.alpha)}function Fi(e,t,n){const r=t-e;return e+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const Bi={forward:Ni,reverse:zi,interpolate:function(e,t,n){return{l:un(e.l,t.l,n),a:un(e.a,t.a,n),b:un(e.b,t.b,n),alpha:un(e.alpha,t.alpha,n)}}},ji={forward:function(e){const{l:t,a:n,b:r}=Ni(e),i=Math.atan2(r,n)*Mi;return{h:i<0?i+360:i,c:Math.sqrt(n*n+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ki,n=e.c;return zi({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:Fi(e.h,t.h,n),c:un(e.c,t.c,n),l:un(e.l,t.l,n),alpha:un(e.alpha,t.alpha,n)}}};var Ui=Object.freeze({__proto__:null,hcl:ji,lab:Bi});class Vi{constructor(e,t,n,r,i){this.type=e,this.operator=t,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(const[o,s]of i)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(e,t,n,r){let i=0;if("exponential"===e.name)i=Gi(t,e.base,n,r);else if("linear"===e.name)i=Gi(t,1,n,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;i=new ve(o[0],o[1],o[2],o[3]).solve(Gi(t,1,n,r))}return i}static parse(e,t){let[n,r,i,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,_n),!i)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=xn:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let l=0;l<o.length;l+=2){const e=o[l],n=o[l+1],r=l+3,i=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(n,i,a);if(!c)return null;a=a||c.type,s.push([e,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Vi(a,n,r,i,s):t.error(`Type ${Cn(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);const i=t.length;if(r>=t[i-1])return n[i-1].evaluate(e);const o=wi(t,r),s=Vi.interpolationFactor(this.interpolation,r,t[o],t[o+1]),a=n[o].evaluate(e),l=n[o+1].evaluate(e);return"interpolate"===this.operator?dn[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?ji.reverse(ji.interpolate(ji.forward(a),ji.forward(l),s)):Bi.reverse(Bi.interpolate(Bi.forward(a),Bi.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function Gi(e,t,n,r){const i=r-n,o=e-n;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}class Hi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const r=t.expectedType;r&&"value"!==r.kind&&(n=r);const i=[];for(const s of e.slice(1)){const e=t.parse(s,1+i.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,i.push(e)}const o=r&&i.some(e=>In(r,e.type));return new Hi(o?wn:n,i)}evaluate(e){let t,n=null,r=0;for(const i of this.args){if(r++,n=i.evaluate(e),n&&n instanceof zn&&!n.available&&(t||(t=n),n=null,r===this.args.length))return t;if(null!==n)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class $i{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let i=1;i<e.length-1;i+=2){const r=e[i];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,i);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=t.parse(e[i+1],i+1);if(!o)return null;n.push([r,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return r?new $i(n,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}class Wi{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,_n),r=t.parse(e[2],2,An(t.expectedType||wn));return n&&r?new Wi(r.type.itemType,n,r):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Gn(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new Gn(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new Gn(`Array index must be an integer, but found ${t} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class qi{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,_n),r=t.parse(e[2],2,An(t.expectedType||wn));return n&&r?new qi(r.type.itemType,n,r):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Gn(`Array index out of bounds: ${t} < 0.`);if(t>n.length-1)throw new Gn(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t===Math.floor(t))return n[t];const r=Math.floor(t),i=Math.ceil(t),o=n[r],s=n[i];if("number"!=typeof o||"number"!=typeof s)throw new Gn(`Cannot interpolate between non-number values at index ${t}.`);const a=t-r;return o*(1-a)+s*a}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Xi{constructor(e,t){this.type=vn,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,wn),r=t.parse(e[2],2,wn);return n&&r?kn(n.type,[vn,yn,_n,gn,wn])?new Xi(n,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!Mn(t,["boolean","string","number","null"]))throw new Gn(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(jn(t))} instead.`);if(!Mn(n,["string","array"]))throw new Gn(`Expected second argument to be of type array or string, but found ${Cn(jn(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Zi{constructor(e,t,n){this.type=_n,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,wn),r=t.parse(e[2],2,wn);if(!n||!r)return null;if(!kn(n.type,[vn,yn,_n,gn,wn]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(n.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,_n);return i?new Zi(n,r,i):null}return new Zi(n,r)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Mn(t,["boolean","string","number","null"]))throw new Gn(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(jn(t))} instead.`);if(!Mn(n,["string","array"]))throw new Gn(`Expected second argument to be of type array or string, but found ${Cn(jn(n))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return n.indexOf(t,r)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ki{constructor(e,t,n,r,i,o){this.inputType=e,this.type=t,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const i={},o=[];for(let l=2;l<e.length-1;l+=2){let s=e[l];const a=e[l+1];Array.isArray(s)||(s=[s]);const c=t.concat(l);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,jn(e)))return null}else n=jn(e);if(void 0!==i[String(e)])return c.error("Branch labels must be unique.");i[String(e)]=o.length}const u=t.parse(a,l,r);if(!u)return null;r=r||u.type,o.push(u)}const s=t.parse(e[1],1,wn);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,r);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new Ki(n,r,s,i,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(Rn(jn(t),this.inputType)&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],r={};for(const o of t){const e=r[this.cases[o]];void 0===e?(r[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[e][1].push(o)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[o,s]of n)e.push(1===s.length?i(s[0]):s.map(i)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}class Yi{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r=[];for(let o=1;o<e.length-1;o+=2){const i=t.parse(e[o],o,vn);if(!i)return null;const s=t.parse(e[o+1],o+1,n);if(!s)return null;r.push([i,s]),n=n||s.type}const i=t.parse(e[e.length-1],e.length-1,n);return i?new Yi(n,r,i):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(e=>{let[t,n]=e;return n.outputDefined()})&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class Ji{constructor(e,t,n,r){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,wn),r=t.parse(e[2],2,_n);if(!n||!r)return null;if(!kn(n.type,[An(wn),yn,wn]))return t.error(`Expected first argument to be of type array or string, but found ${Cn(n.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,_n);return i?new Ji(n.type,n,r,i):null}return new Ji(n.type,n,r)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Mn(t,["string","array"]))throw new Gn(`Expected first argument to be of type array or string, but found ${Cn(jn(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(n,r)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Qi{constructor(e,t){this.type=An(yn),this.str=e,this.delimiter=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,yn),r=t.parse(e[2],2,yn);return n&&r?new Qi(n,r):void 0}evaluate(e){const t=this.str.evaluate(e),n=this.delimiter.evaluate(e);return t.split(n)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function eo(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function to(e,t,n,r){return 0===r.compare(t,n)}function no(e,t,n){const r="=="!==e&&"!="!==e;return class i{constructor(e,t,n){this.type=vn,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,wn);if(!o)return null;if(!eo(n,o.type))return t.concat(1).error(`"${n}" comparisons are not supported for type '${Cn(o.type)}'.`);let s=t.parse(e[2],2,wn);if(!s)return null;if(!eo(n,s.type))return t.concat(2).error(`"${n}" comparisons are not supported for type '${Cn(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${Cn(o.type)}' and '${Cn(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new $n(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new $n(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Sn),!a)return null}return new i(o,s,a)}evaluate(i){const o=this.lhs.evaluate(i),s=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const t=jn(o),n=jn(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new Gn(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${n.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=jn(o),n=jn(s);if("string"!==e.kind||"string"!==n.kind)return t(i,o,s)}return this.collator?n(i,o,s,this.collator.evaluate(i)):t(i,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild(e=>{t.push(e.serialize())}),t}}}const ro=no("==",function(e,t,n){return t===n},to),io=no("!=",function(e,t,n){return t!==n},function(e,t,n,r){return!to(0,t,n,r)}),oo=no("<",function(e,t,n){return t<n},function(e,t,n,r){return r.compare(t,n)<0}),so=no(">",function(e,t,n){return t>n},function(e,t,n,r){return r.compare(t,n)>0}),ao=no("<=",function(e,t,n){return t<=n},function(e,t,n,r){return r.compare(t,n)<=0}),lo=no(">=",function(e,t,n){return t>=n},function(e,t,n,r){return r.compare(t,n)>=0});class co{constructor(e,t,n,r,i,o){this.type=yn,this.number=e,this.locale=t,this.currency=n,this.unit=r,this.minFractionDigits=i,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,_n);if(!n)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=t.parseObjectValue(r.locale,2,"locale",yn),!i))return null;let o=null;if(r.currency&&(o=t.parseObjectValue(r.currency,2,"currency",yn),!o))return null;let s=null;if(r.unit&&(s=t.parseObjectValue(r.unit,2,"unit",yn),!s))return null;let a=null;if(r["min-fraction-digits"]&&(a=t.parseObjectValue(r["min-fraction-digits"],2,"min-fraction-digits",_n),!a))return null;let l=null;return r["max-fraction-digits"]&&(l=t.parseObjectValue(r["max-fraction-digits"],2,"max-fraction-digits",_n),!l)?null:new co(n,i,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class uo{constructor(e){this.type=_n,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error(`Expected argument of type string or array, but found ${Cn(n.type)} instead.`):new uo(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Gn(`Expected value to be of type string or array, but found ${Cn(jn(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}function ho(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const fo={"==":ro,"!=":io,">":so,"<":oo,">=":lo,"<=":ao,array:$n,at:Wi,"at-interpolated":qi,boolean:$n,case:Yi,coalesce:Hi,collator:tr,format:Wn,image:qn,in:Xi,"index-of":Zi,interpolate:Vi,"interpolate-hcl":Vi,"interpolate-lab":Vi,length:uo,let:$i,literal:Vn,match:Ki,number:$n,"number-format":co,object:$n,slice:Ji,step:Si,string:$n,"to-boolean":Kn,"to-color":Kn,"to-number":Kn,"to-string":Kn,var:vi,within:Er,distance:ui,config:yi,split:Qi};function po(e,t){let[n,r,i,o]=t;n=n.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);const s=o?o.evaluate(e):1,a=Fn(n,r,i,s);if(a)throw new Gn(a);return new sn(n/255,r/255,i/255,s)}function mo(e,t){let[n,r,i,o]=t;n=n.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);const s=o?o.evaluate(e):1,a=function(e,t,n,r){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof n&&n>=0&&n<=100?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid hsla value [${[e,t,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", ")}]: 'h' must be between 0 and 360.`}(n,r,i,s);if(a)throw new Gn(a);const l=`hsla(${n}, ${r}%, ${i}%, ${s})`,c=sn.parse(l);if(!c)throw new Gn(`Failed to parse HSLA color: ${l}`);return c}function go(e,t){return e in t}function _o(e,t){const n=t[e];return void 0===n?null:n}function yo(e){return{type:e}}function vo(e){return{result:"success",value:e}}function xo(e){return{result:"error",value:e}}function bo(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function wo(e){return"data-driven"===e["property-type"]}function So(e){return bo(e.expression,"measure-light")}function Eo(e){return bo(e.expression,"zoom")}function To(e){return!!e.expression&&e.expression.interpolated}function Ao(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Co(e){return e}function Po(e,t){const n="color"===t.type,r=e.stops&&"object"==typeof e.stops[0][0],i=r||!(r||void 0!==e.property),o=e.type||(To(t)?"exponential":"interval");if(n&&((e=fn({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],sn.parse(e[1])])),e.default=sn.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Ui[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if("exponential"===o)s=Ro;else if("interval"===o)s=Mo;else if("categorical"===o){s=ko,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=Oo}if(r){const n={},r=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],o=i[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),n[o].stops.push([i[0].value,i[1]])}const i=[];for(const e of r)i.push([n[e].zoom,Po(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Vi.interpolationFactor.bind(void 0,o),zoomStops:i.map(e=>e[0]),evaluate:(n,r)=>{let{zoom:o}=n;return Ro({stops:i,base:e.base},t,o).evaluate(o,r)}}}if(i){const n="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:Vi.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map(e=>e[0]),evaluate:n=>{let{zoom:r}=n;return s(e,t,r,a,l)}}}return{kind:"source",evaluate(n,r){const i=r&&r.properties?r.properties[e.property]:void 0;return void 0===i?Io(e.default,t.default):s(e,t,i,a,l)}}}function Io(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function ko(e,t,n,r,i){return Io(typeof n===i?r[n]:void 0,e.default,t.default)}function Mo(e,t,n){if("number"!==Xn(n))return Io(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const i=wi(e.stops.map(e=>e[0]),n);return e.stops[i][1]}function Ro(e,t,n){const r=void 0!==e.base?e.base:1;if("number"!==Xn(n))return Io(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const o=wi(e.stops.map(e=>e[0]),n),s=function(e,t,n,r){const i=r-n,o=e-n;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}(n,r,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=dn[t.type]||Co;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Ui[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==i)return c(r,i,s)}}:c(a,l,s)}function Oo(e,t,n){return"color"===t.type?n=sn.parse(n):"formatted"===t.type?n=Dn.fromString(n.toString()):"resolvedImage"===t.type?n=zn.build(n.toString()):Xn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),Io(n,e.default,t.default)}Qn.register(fo,{error:[{kind:"error"},[yn],(e,t)=>{let[n]=t;throw new Gn(n.evaluate(e))}],typeof:[yn,[wn],(e,t)=>{let[n]=t;return Cn(jn(n.evaluate(e)))}],"to-rgba":[An(_n,4),[xn],(e,t)=>{let[n]=t;return n.evaluate(e).toNonPremultipliedRenderColor(null).toArray()}],"to-hsla":[An(_n,4),[xn],(e,t)=>{let[n]=t;return n.evaluate(e).toNonPremultipliedRenderColor(null).toHslaArray()}],rgb:[xn,[_n,_n,_n],po],rgba:[xn,[_n,_n,_n,_n],po],hsl:[xn,[_n,_n,_n],mo],hsla:[xn,[_n,_n,_n,_n],mo],has:{type:vn,overloads:[[[yn],(e,t)=>{let[n]=t;return go(n.evaluate(e),e.properties())}],[[yn,bn],(e,t)=>{let[n,r]=t;return go(n.evaluate(e),r.evaluate(e))}]]},get:{type:wn,overloads:[[[yn],(e,t)=>{let[n]=t;return _o(n.evaluate(e),e.properties())}],[[yn,bn],(e,t)=>{let[n,r]=t;return _o(n.evaluate(e),r.evaluate(e))}]]},"feature-state":[wn,[yn],(e,t)=>{let[n]=t;return _o(n.evaluate(e),e.featureState||{})}],properties:[bn,[],e=>e.properties()],"geometry-type":[yn,[],e=>e.geometryType()],worldview:[yn,[],e=>e.globals.worldview||""],id:[wn,[],e=>e.id()],zoom:[_n,[],e=>e.globals.zoom],pitch:[_n,[],e=>e.globals.pitch||0],"distance-from-center":[_n,[],e=>e.distanceFromCenter()],"measure-light":[_n,[yn],(e,t)=>{let[n]=t;return e.measureLight(n.evaluate(e))}],"heatmap-density":[_n,[],e=>e.globals.heatmapDensity||0],"line-progress":[_n,[],e=>e.globals.lineProgress||0],"raster-value":[_n,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[_n,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[_n,[],e=>e.globals.skyRadialProgress||0],accumulated:[wn,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[_n,yo(_n),(e,t)=>{let n=0;for(const r of t)n+=r.evaluate(e);return n}],"*":[_n,yo(_n),(e,t)=>{let n=1;for(const r of t)n*=r.evaluate(e);return n}],"-":{type:_n,overloads:[[[_n,_n],(e,t)=>{let[n,r]=t;return n.evaluate(e)-r.evaluate(e)}],[[_n],(e,t)=>{let[n]=t;return-n.evaluate(e)}]]},"/":[_n,[_n,_n],(e,t)=>{let[n,r]=t;return n.evaluate(e)/r.evaluate(e)}],"%":[_n,[_n,_n],(e,t)=>{let[n,r]=t;return n.evaluate(e)%r.evaluate(e)}],ln2:[_n,[],()=>Math.LN2],pi:[_n,[],()=>Math.PI],e:[_n,[],()=>Math.E],"^":[_n,[_n,_n],(e,t)=>{let[n,r]=t;return Math.pow(n.evaluate(e),r.evaluate(e))}],sqrt:[_n,[_n],(e,t)=>{let[n]=t;return Math.sqrt(n.evaluate(e))}],log10:[_n,[_n],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN10}],ln:[_n,[_n],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))}],log2:[_n,[_n],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN2}],sin:[_n,[_n],(e,t)=>{let[n]=t;return Math.sin(n.evaluate(e))}],cos:[_n,[_n],(e,t)=>{let[n]=t;return Math.cos(n.evaluate(e))}],tan:[_n,[_n],(e,t)=>{let[n]=t;return Math.tan(n.evaluate(e))}],asin:[_n,[_n],(e,t)=>{let[n]=t;return Math.asin(n.evaluate(e))}],acos:[_n,[_n],(e,t)=>{let[n]=t;return Math.acos(n.evaluate(e))}],atan:[_n,[_n],(e,t)=>{let[n]=t;return Math.atan(n.evaluate(e))}],min:[_n,yo(_n),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[_n,yo(_n),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[_n,[_n],(e,t)=>{let[n]=t;return Math.abs(n.evaluate(e))}],round:[_n,[_n],(e,t)=>{let[n]=t;const r=n.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[_n,[_n],(e,t)=>{let[n]=t;return Math.floor(n.evaluate(e))}],ceil:[_n,[_n],(e,t)=>{let[n]=t;return Math.ceil(n.evaluate(e))}],"filter-==":[vn,[yn,wn],(e,t)=>{let[n,r]=t;return e.properties()[n.value]===r.value}],"filter-id-==":[vn,[wn],(e,t)=>{let[n]=t;return e.id()===n.value}],"filter-type-==":[vn,[yn],(e,t)=>{let[n]=t;return e.geometryType()===n.value}],"filter-<":[vn,[yn,wn],(e,t)=>{let[n,r]=t;const i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i<o}],"filter-id-<":[vn,[wn],(e,t)=>{let[n]=t;const r=e.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[vn,[yn,wn],(e,t)=>{let[n,r]=t;const i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i>o}],"filter-id->":[vn,[wn],(e,t)=>{let[n]=t;const r=e.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[vn,[yn,wn],(e,t)=>{let[n,r]=t;const i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[vn,[wn],(e,t)=>{let[n]=t;const r=e.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[vn,[yn,wn],(e,t)=>{let[n,r]=t;const i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[vn,[wn],(e,t)=>{let[n]=t;const r=e.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[vn,[wn],(e,t)=>{let[n]=t;return n.value in e.properties()}],"filter-has-id":[vn,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[vn,[An(yn)],(e,t)=>{let[n]=t;return n.value.indexOf(e.geometryType())>=0}],"filter-id-in":[vn,[An(wn)],(e,t)=>{let[n]=t;return n.value.indexOf(e.id())>=0}],"filter-in-small":[vn,[yn,An(wn)],(e,t)=>{let[n,r]=t;return r.value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[vn,[yn,An(wn)],(e,t)=>{let[n,r]=t;return function(e,t,n,r){for(;n<=r;){const i=n+r>>1;if(t[i]===e)return!0;t[i]>e?r=i-1:n=i+1}return!1}(e.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:vn,overloads:[[[vn,vn],(e,t)=>{let[n,r]=t;return n.evaluate(e)&&r.evaluate(e)}],[yo(vn),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:vn,overloads:[[[vn,vn],(e,t)=>{let[n,r]=t;return n.evaluate(e)||r.evaluate(e)}],[yo(vn),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[vn,[vn],(e,t)=>{let[n]=t;return!n.evaluate(e)}],"is-supported-script":[vn,[yn],(e,t)=>{let[n]=t;const r=e.globals&&e.globals.isSupportedScript;return!r||r(n.evaluate(e))}],upcase:[yn,[yn],(e,t)=>{let[n]=t;return n.evaluate(e).toUpperCase()}],downcase:[yn,[yn],(e,t)=>{let[n]=t;return n.evaluate(e).toLowerCase()}],concat:[yn,yo(wn),(e,t)=>t.map(t=>Un(t.evaluate(e))).join("")],"resolved-locale":[yn,[Sn],(e,t)=>{let[n]=t;return n.evaluate(e).resolvedLocale()}],random:[_n,[_n,_n,wn],(e,t)=>{const[n,r,i]=t.map(t=>t.evaluate(e));if(n>r)return n;if(n===r)return n;let o;if("string"==typeof i)o=function(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(i);else{if("number"!=typeof i)throw new Gn(`Invalid seed input: ${i}`);o=i}return n+ho(o)()*(r-n)}]});class Lo{constructor(e,t,n,r){this.expression=e,this._warningHistory={},this._evaluator=new Jn(n,r),this._defaultValue=t?function(e){return"color"===e.type&&(Ao(e.default)||Array.isArray(e.default))?new sn(0,0,0,0):"color"===e.type?sn.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null,this.configDependencies=fi(e)}evaluateWithoutErrorHandling(e,t,n,r,i,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=r||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,r,i,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Gn(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${e.message}`)),this._defaultValue}}}function Do(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in fo}function No(e,t,n,r){const i=new xi(fo,[],t?function(e){const t={color:xn,string:yn,number:_n,enum:yn,boolean:vn,formatted:En,resolvedImage:Tn};return"array"===e.type?An(t[e.value]||wn,e.length):t[e.type]}(t):void 0,void 0,void 0,n,r),o=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return o?vo(new Lo(o,t,n,r)):xo(i.errors)}class zo{constructor(e,t,n,r){this.kind=e,this._styleExpression=t,this.isLightConstant=n,this.isLineProgressConstant=r,this.isStateDependent="constant"!==e&&!di(t.expression),this.configDependencies=fi(t.expression)}evaluateWithoutErrorHandling(e,t,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,o)}evaluate(e,t,n,r,i,o){return this._styleExpression.evaluate(e,t,n,r,i,o)}}class Fo{constructor(e,t,n,r,i,o){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!di(t.expression),this.isLightConstant=i,this.isLineProgressConstant=o,this.configDependencies=fi(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,o)}evaluate(e,t,n,r,i,o){return this._styleExpression.evaluate(e,t,n,r,i,o)}interpolationFactor(e,t,n){return this.interpolationType?Vi.interpolationFactor(this.interpolationType,e,t,n):0}}function Bo(e,t,n,r){if("error"===(e=No(e,t,n,r)).result)return e;const i=e.value.expression,o=hi(i);if(!o&&!wo(t))return xo([new pn("","data expressions not supported")]);const s=pi(i,["zoom","pitch","distance-from-center"]);if(!s&&!Eo(t))return xo([new pn("","zoom expressions not supported")]);const a=pi(i,["measure-light"]);if(!a&&!So(t))return xo([new pn("","measure-light expression not supported")]);const l=pi(i,["line-progress"]);if(!l&&!function(e){return bo(e.expression,"line-progress")}(t))return xo([new pn("","line-progress expression not supported")]);const c=t.expression&&t.expression.relaxZoomRestriction,u=Uo(i);return u||s||c?u instanceof pn?xo([u]):u instanceof Vi&&!To(t)?xo([new pn("",'"interpolate" expressions cannot be used with this property')]):vo(u?new Fo(o&&l?"camera":"composite",e.value,u.labels,u instanceof Vi?u.interpolation:void 0,a,l):new zo(o&&l?"constant":"source",e.value,a,l)):xo([new pn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class jo{constructor(e,t){this._parameters=e,this._specification=t,fn(this,Po(this._parameters,this._specification))}static deserialize(e){return new jo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Uo(e){let t=null;if(e instanceof $i)t=Uo(e.result);else if(e instanceof Hi){for(const n of e.args)if(t=Uo(n),t)break}else(e instanceof Si||e instanceof Vi)&&e.input instanceof Qn&&"zoom"===e.input.name&&(t=e);return t instanceof pn||e.eachChild(e=>{const n=Uo(e);n instanceof pn?t=n:t&&n&&t!==n&&(t=new pn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Vo,Go,Ho=function(){if(Go)return Vo;Go=1,Vo=t;var e=3;function t(t,n,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],this.d=(n=o[1])+2*(r=o[2]);for(var s=0;s<this.d*this.d;s++){var a=o[e+s],l=o[e+s+1];i.push(a===l?null:o.subarray(a,l))}var c=o[e+i.length+1];this.keys=o.subarray(o[e+i.length],c),this.bboxes=o.subarray(c),this.insert=this._insertReadonly}else{this.d=n+2*r;for(var u=0;u<this.d*this.d;u++)i.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=r,this.scale=n/t,this.uid=0;var h=r/n*t;this.min=-h,this.max=t+h}return t.prototype.insert=function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(e,t,n,r,i,o){this.cells[i].push(o)},t.prototype.query=function(e,t,n,r,i){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=r&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,n,r,this._queryCell,a,{},i),a},t.prototype._queryCell=function(e,t,n,r,i,o,s,a){var l=this.cells[i];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var f=4*d;(a?a(u[f+0],u[f+1],u[f+2],u[f+3]):e<=u[f+2]&&t<=u[f+3]&&n>=u[f+0]&&r>=u[f+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},t.prototype._forEachCell=function(e,t,n,r,i,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(r),d=l;d<=u;d++)for(var f=c;f<=h;f++){var p=this.d*f+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(f),this._convertFromCellCoord(d+1),this._convertFromCellCoord(f+1)))&&i.call(this,e,t,n,r,p,o,s,a))return}},t.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},t.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,n=e+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var o=new Int32Array(n+r+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var s=n,a=0;a<t.length;a++){var l=t[a];o[e+a]=s,o.set(l,s),s+=l.length}return o[e+t.length]=s,o.set(this.keys,s),o[e+t.length+1]=s+=this.keys.length,o.set(this.bboxes,s),s+=this.bboxes.length,o.buffer},Vo}(),$o=_e(Ho);const Wo={};function qo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writable:!1}),Wo[t]={klass:e,omit:n.omit||[]}}qo(Object,"Object"),$o.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},$o.deserialize=function(e){return new $o(e.buffer)},Object.defineProperty($o,"name",{value:"Grid"}),qo($o,"Grid"),delete xe.prototype.constructor,"undefined"!=typeof DOMMatrix&&qo(DOMMatrix,"DOMMatrix"),qo(sn,"Color"),qo(Error,"Error"),qo(Dn,"Formatted"),qo(Ln,"FormattedSection"),qo(Ot,"AJAXError"),qo(zn,"ResolvedImage"),qo(jo,"StylePropertyFunction"),qo(Lo,"StyleExpression",{omit:["_evaluator"]}),qo(tn,"ImageId"),qo(Nn,"ImageVariant"),qo(Fo,"ZoomDependentExpression"),qo(zo,"ZoomConstantExpression"),qo(Qn,"CompoundExpression",{omit:["_evaluate"]});for(const xb in fo)Wo[fo[xb]._classRegistryKey]||qo(fo[xb],`Expression${xb}`);function Xo(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Zo(e){return self.ImageBitmap&&e instanceof ImageBitmap}function Ko(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Xo(e)||Zo(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e))return t&&t.add(e.buffer),e;if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const r of e)n.push(Ko(r,t));return n}if(e instanceof Map){const n={$name:"Map",entries:[]};for(const[r,i]of e.entries())n.entries.push(Ko(r),Ko(i,t));return n}if(e instanceof Set){const t={$name:"Set"};let n=0;for(const r of e.values())t[++n]=Ko(r);return t}if(e instanceof DOMMatrix){const t={$name:"DOMMatrix"},n=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const r of n)t[r]=e[r];return t}if("bigint"==typeof e)return{$name:"BigInt",value:e.toString()};if("object"==typeof e){const n=e.constructor,r=n._classRegistryKey;if(!r)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const i=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const n in e)e.hasOwnProperty(n)&&(Wo[r].omit.indexOf(n)>=0||(i[n]=Ko(e[n],t)));e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(i.$name=r),i}throw new Error("can't serialize object of type "+typeof e)}function Yo(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Xo(e)||Zo(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(Yo);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=e.entries||[],n=new Map;for(let e=0;e<t.length;e+=2)n.set(Yo(t[e]),Yo(t[e+1]));return n}if("Set"===t){const t=new Set;for(const n of Object.keys(e))"$name"!==n&&t.add(Yo(e[n]));return t}if("DOMMatrix"===t){let t;return t=e.is2D?[e.a,e.b,e.c,e.d,e.e,e.f]:[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44],new DOMMatrix(t)}if("BigInt"===t)return BigInt(e.value);const{klass:n}=Wo[t];if(!n)throw new Error(`Can't deserialize unregistered class "${t}".`);if(n.deserialize)return n.deserialize(e);const r=Object.create(n.prototype);for(const i of Object.keys(e))"$name"!==i&&(r[i]=Yo(e[i]));return r}throw new Error("can't deserialize object of type "+typeof e)}const Jo={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,Osage:e=>e>=66736&&e<=66815,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function Qo(e){for(const t of e)if(ns(t.charCodeAt(0)))return!0;return!1}function es(e){for(const t of e)if(!ts(t.charCodeAt(0)))return!1;return!0}function ts(e){return!(Jo.Arabic(e)||Jo["Arabic Supplement"](e)||Jo["Arabic Extended-A"](e)||Jo["Arabic Presentation Forms-A"](e)||Jo["Arabic Presentation Forms-B"](e))}function ns(e){return!(746!==e&&747!==e&&(e<4352||!(Jo["Bopomofo Extended"](e)||Jo.Bopomofo(e)||Jo["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Jo["CJK Compatibility Ideographs"](e)||Jo["CJK Compatibility"](e)||Jo["CJK Radicals Supplement"](e)||Jo["CJK Strokes"](e)||!(!Jo["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Jo["CJK Unified Ideographs Extension A"](e)||Jo["CJK Unified Ideographs"](e)||Jo["Enclosed CJK Letters and Months"](e)||Jo["Hangul Compatibility Jamo"](e)||Jo["Hangul Jamo Extended-A"](e)||Jo["Hangul Jamo Extended-B"](e)||Jo["Hangul Jamo"](e)||Jo["Hangul Syllables"](e)||Jo.Hiragana(e)||Jo["Ideographic Description Characters"](e)||Jo.Kanbun(e)||Jo["Kangxi Radicals"](e)||Jo["Katakana Phonetic Extensions"](e)||Jo.Katakana(e)&&12540!==e||!(!Jo["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Jo["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Jo["Unified Canadian Aboriginal Syllabics"](e)||Jo["Unified Canadian Aboriginal Syllabics Extended"](e)||Jo["Vertical Forms"](e)||Jo["Yijing Hexagram Symbols"](e)||Jo["Yi Syllables"](e)||Jo["Yi Radicals"](e))))}function rs(e){return!(ns(e)||function(e){return!!(Jo["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Jo["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Jo["Letterlike Symbols"](e)||Jo["Number Forms"](e)||Jo["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Jo["Control Pictures"](e)&&9251!==e||Jo["Optical Character Recognition"](e)||Jo["Enclosed Alphanumerics"](e)||Jo["Geometric Shapes"](e)||Jo["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Jo["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Jo["CJK Symbols and Punctuation"](e)||Jo.Katakana(e)||Jo["Private Use Area"](e)||Jo["CJK Compatibility Forms"](e)||Jo["Small Form Variants"](e)||Jo["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function is(e){return Jo.Arabic(e)||Jo["Arabic Supplement"](e)||Jo["Arabic Extended-A"](e)||Jo["Arabic Presentation Forms-A"](e)||Jo["Arabic Presentation Forms-B"](e)}function os(e){return e>=1424&&e<=2303||Jo["Arabic Presentation Forms-A"](e)||Jo["Arabic Presentation Forms-B"](e)}function ss(e,t){return!(!t&&os(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Jo.Khmer(e))}function as(e){for(const t of e)if(os(t.charCodeAt(0)))return!0;return!1}const ls={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let cs=null,us=ls.unavailable,hs=null;const ds=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(us=ls.error),cs&&cs(e)};function fs(){ps.fire(new Kt("pluginStateChange",{pluginStatus:us,pluginURL:hs}))}const ps=new en,ms=function(){return us},gs=function(){if(us!==ls.deferred||!hs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");us=ls.loading,fs(),hs&&Nt({url:hs},e=>{e?ds(e):(us=ls.loaded,fs())})},_s={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>us===ls.loaded||null!=_s.applyArabicShaping,isLoading:()=>us===ls.loading,setState(e){us=e.pluginStatus,hs=e.pluginURL},isParsing:()=>us===ls.parsing,isParsed:()=>us===ls.parsed,getPluginURL:()=>hs};class ys{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness,this.worldview=t.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const n of e)if(!ss(n.charCodeAt(0),t))return!1;return!0}(e,_s.isLoaded())}}class vs{constructor(e,t,n,r){this.property=e,this.value=t,this.expression=function(e,t,n,r){if(Ao(e))return new jo(e,t);if(Do(e)||Array.isArray(e)&&e.length>0){const i=Bo(e,t,n,r);if("error"===i.result)throw new Error(i.value.map(e=>`${e.key}: ${e.message}`).join(", "));return i.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=sn.parse(e)),{kind:"constant",configDependencies:new Set,evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n,r)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class xs{constructor(e,t,n){this.property=e,this.value=new vs(e,void 0,t,n)}transitioned(e,t){return new ws(this.property,this.value,t,Le({},e.transition,this.transition),e.now)}untransitioned(){return new ws(this.property,this.value,null,{},0)}}class bs{constructor(e,t,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=n,this.configDependencies=new Set}getValue(e){return Ue(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new xs(this._values[e].property,this._scope,this._options)),this._values[e].value=new vs(this._values[e].property,null===t?void 0:Ue(t),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,t){t&&(this._options=t);const n=this._properties.properties;if(e)for(const r in e){const t=e[r];if(r.endsWith("-transition")){const e=r.slice(0,-11);n[e]&&this.setTransition(e,t)}else n.hasOwnProperty(r)&&this.setValue(r,t)}}getTransition(e){return Ue(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new xs(this._values[e].property)),this._values[e].transition=Ue(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const r=this.getTransition(t);void 0!==r&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){const n=new Ss(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].transitioned(e,t._values[r]);return n}untransitioned(){const e=new Ss(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ws{constructor(e,t,n,r,i){const o=r.delay||0,s=r.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+o,this.end=this.begin+s,e.specification.transition&&(r.delay||r.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const r=e.now||0,i=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(e,t,n);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),i,Ce(s))}}return i}}class Ss{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const r=new As(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Es{constructor(e,t,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=n,this.configDependencies=new Set}getValue(e){return Ue(this._values[e].value)}setValue(e,t){this._values[e]=new vs(this._values[e].property,null===t?void 0:Ue(t),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const r=new As(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}}class Ts{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,r){return this.property.evaluate(this.value,this.parameters,e,t,n,r)}}class As{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Cs{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const r=dn[this.specification.type];return r?r(e,t,n):e}}class Ps{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,r){return new Ts(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,r)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Ts(this,{kind:"constant",value:void 0},e.parameters);const r=dn[this.specification.type];return r?new Ts(this,{kind:"constant",value:r(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,r,i,o){return"constant"===e.kind?e.value:e.evaluate(t,n,r,i,o)}}class Is{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,r){return!!e.expression.evaluate(t,null,{},n,r)}interpolate(){return!1}}class ks{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new ys(0,{});for(const n in e){const r=e[n];r.specification.overridable&&this.overridableProperties.push(n);const i=this.defaultPropertyValues[n]=new vs(r,void 0),o=this.defaultTransitionablePropertyValues[n]=new xs(r);this.defaultTransitioningPropertyValues[n]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=i.possiblyEvaluate(t)}}}qo(Ps,"DataDrivenProperty"),qo(Cs,"DataConstantProperty"),qo(Is,"ColorRampProperty");var Ms=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Rs(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Os(e){if(Array.isArray(e))return e.map(Os);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Os(e[n]);return t}return Rs(e)}function Ls(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ls(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Ds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ls(e)||(e=Vs(e));const i=e;let o=!0;try{o=function(e){if(!Fs(e))return e;let t=Os(e);return zs(t),t=Ns(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}let s=null,a=null;if("background"!==r&&"sky"!==r&&"slot"!==r){a=Ms[`filter_${r}`];const e=No(o,a,t,n);if("error"===e.result)throw new Error(e.value.map(e=>`${e.key}: ${e.message}`).join(", "));s=(t,n,r)=>e.value.evaluate(t,n,{},r)}let l=null,c=null;if(o!==i){const e=No(i,a,t,n);if("error"===e.result)throw new Error(e.value.map(e=>`${e.key}: ${e.message}`).join(", "));l=(t,n,r,i,o)=>e.value.evaluate(t,n,{},r,void 0,void 0,i,o),c=!hi(e.value.expression)}return{filter:s,dynamicFilter:l||void 0,needGeometry:Us(o),needFeature:!!c}}function Ns(e){if(!Array.isArray(e))return e;const t=function(e){if(Bs.has(e[0]))for(let t=1;t<e.length;t++)if(Fs(e[t]))return!0;return e}(e);return!0===t?t:t.map(e=>Ns(e))}function zs(e){let t=!1;const n=[];if("case"===e[0]){for(let r=1;r<e.length-1;r+=2)t=t||Fs(e[r]),n.push(e[r+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||Fs(e[1]);for(let t=2;t<e.length-1;t+=2)n.push(e[t+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||Fs(e[1]);for(let t=1;t<e.length-1;t+=2)n.push(e[t+1])}t&&(e.length=0,e.push("any",...n));for(let r=1;r<e.length;r++)zs(e[r])}function Fs(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(Fs(e[n]))return!0;return!1}const Bs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function js(e,t){return e<t?-1:e>t?1:0}function Us(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Us(e[t]))return!0;return!1}function Vs(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Gs(e[1],e[2],"=="):"!="===t?Ws(Gs(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Gs(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(Vs))):"all"===t?["all"].concat(e.slice(1).map(Vs)):"none"===t?["all"].concat(e.slice(1).map(Vs).map(Ws)):"in"===t?Hs(e[1],e.slice(2)):"!in"===t?Ws(Hs(e[1],e.slice(2))):"has"===t?$s(e[1]):"!has"!==t||Ws($s(e[1]));var n}function Gs(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function Hs(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(js)]]:["filter-in-small",e,["literal",t]]}}function $s(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ws(e){return["!",e]}const qs="\x1f";function Xs(e,t){return t?`${e}${qs}${t}`:e}const Zs="-transition",Ks=new Set(["fill","line","background","hillshade","raster"]);class Ys extends en{constructor(e,t,n,r,i){if(super(),this.id=e.id,this.fqid=Xs(this.id,n),this.type=e.type,this.scope=n,this.lut=r,this.options=i,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==e.type){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const t=No(this.filter,Ms[`filter_${e.type}`]);"error"!==t.result&&(this.configDependencies=new Set([...this.configDependencies,...t.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new Es(t.layout,this.scope,i),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),t.paint){this._transitionablePaint=new bs(t.paint,this.scope,i);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new As(t.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Ks.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...n.configDependencies]),"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Zs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const n=this._transitionablePaint,r=n._properties.properties;if(e.endsWith(Zs)){const i=e.slice(0,-11);return r[i]&&n.setTransition(i,t||void 0),!1}if(!r[e])return!1;const i=n._values[e],o=i.value.isDataDriven(),s=i.value;n.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...n.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const a=n._values[e].value,l=a.isDataDriven(),c=e.endsWith("pattern")||"line-dasharray"===e;return l||o||c||this._handleOverridablePaintPropertyUpdate(e,s,a)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t,n){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return je({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Ts&&wo(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Ds(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,t,n,r,i,o,s,a,l){}}const Js={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qs{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ea{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&t.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ta(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,r=0;return{members:e.map(e=>{const i=Js[e.type].BYTES_PER_ELEMENT,o=n=na(n,Math.max(t,i)),s=e.components||1;return r=Math.max(r,i),n+=i*s,{name:e.name,type:e.type,components:s,offset:o}}),size:na(n,Math.max(r,t)),alignment:t}}function na(e,t){return Math.ceil(e/t)*t}class ra extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,e}}ra.prototype.bytesPerElement=4,qo(ra,"StructArrayLayout2i4");class ia extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e}}ia.prototype.bytesPerElement=6,qo(ia,"StructArrayLayout3i6");class oa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,e}}oa.prototype.bytesPerElement=8,qo(oa,"StructArrayLayout4i8");class sa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}sa.prototype.bytesPerElement=4,qo(sa,"StructArrayLayout1f4");class aa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=4*e,o=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.float32[o+1]=r,e}}aa.prototype.bytesPerElement=8,qo(aa,"StructArrayLayout2i1f8");class la extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=4*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e}}la.prototype.bytesPerElement=8,qo(la,"StructArrayLayout3i8");class ca extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const s=5*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,e}}ca.prototype.bytesPerElement=10,qo(ca,"StructArrayLayout5i10");class ua extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o,s)}emplace(e,t,n,r,i,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=r,this.uint8[c+5]=i,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}ua.prototype.bytesPerElement=12,qo(ua,"StructArrayLayout2i4ub1f12");class ha extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}ha.prototype.bytesPerElement=12,qo(ha,"StructArrayLayout3f12");class da extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=r,this.uint16[s+3]=i,this.float32[a+2]=o,e}}da.prototype.bytesPerElement=12,qo(da,"StructArrayLayout4ui1f12");class fa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=r,this.uint16[o+3]=i,e}}fa.prototype.bytesPerElement=8,qo(fa,"StructArrayLayout4ui8");class pa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=r,this.int16[a+3]=i,this.int16[a+4]=o,this.int16[a+5]=s,e}}pa.prototype.bytesPerElement=12,qo(pa,"StructArrayLayout6i12");class ma extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,r,i,o,s,a,l,c,u,h)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d){const f=12*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=r,this.int16[f+3]=i,this.uint16[f+4]=o,this.uint16[f+5]=s,this.uint16[f+6]=a,this.uint16[f+7]=l,this.int16[f+8]=c,this.int16[f+9]=u,this.int16[f+10]=h,this.int16[f+11]=d,e}}ma.prototype.bytesPerElement=24,qo(ma,"StructArrayLayout4i4ui4i24");class ga extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=r,this.float32[l+2]=i,this.float32[l+3]=o,this.float32[l+4]=s,e}}ga.prototype.bytesPerElement=20,qo(ga,"StructArrayLayout3i3f20");class _a extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,e}}_a.prototype.bytesPerElement=16,qo(_a,"StructArrayLayout4f16");class ya extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}ya.prototype.bytesPerElement=4,qo(ya,"StructArrayLayout1ul4");class va extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,e}}va.prototype.bytesPerElement=4,qo(va,"StructArrayLayout2ui4");class xa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,r,i,o,s,a,l,c,u,h,d)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d,f){const p=20*e,m=10*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.int16[p+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[p+14]=u,this.uint32[m+8]=h,this.uint16[p+18]=d,this.uint16[p+19]=f,e}}xa.prototype.bytesPerElement=40,qo(xa,"StructArrayLayout5i4f1i1ul2ui40");class ba extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o,s)}emplace(e,t,n,r,i,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=r,this.int16[l+4]=i,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}ba.prototype.bytesPerElement=16,qo(ba,"StructArrayLayout3i2i2i16");class wa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=r,this.int16[a+6]=i,this.int16[a+7]=o,e}}wa.prototype.bytesPerElement=16,qo(wa,"StructArrayLayout2f1f2i16");class Sa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,s){const a=20*e,l=5*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[l+1]=r,this.float32[l+2]=i,this.float32[l+3]=o,this.float32[l+4]=s,e}}Sa.prototype.bytesPerElement=20,qo(Sa,"StructArrayLayout2ub4f20");class Ea extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,this.uint16[i+2]=r,e}}Ea.prototype.bytesPerElement=6,qo(Ea,"StructArrayLayout3ui6");class Ta extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b){const w=30*e,S=15*e,E=60*e;return this.int16[w+0]=t,this.int16[w+1]=n,this.int16[w+2]=r,this.float32[S+2]=i,this.float32[S+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[S+5]=l,this.uint32[S+6]=c,this.uint32[S+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=f,this.float32[S+10]=p,this.float32[S+11]=m,this.uint8[E+48]=g,this.uint8[E+49]=_,this.uint8[E+50]=y,this.uint32[S+13]=v,this.int16[w+28]=x,this.uint8[E+58]=b,e}}Ta.prototype.bytesPerElement=60,qo(Ta,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Aa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,S,E,T,A,C,P,I,k,M,R){const O=this.length;return this.resize(O+1),this.emplace(O,e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,S,E,T,A,C,P,I,k,M,R)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,S,E,T,A,C,P,I,k,M,R,O){const L=20*e,D=40*e,N=80*e;return this.float32[L+0]=t,this.float32[L+1]=n,this.int16[D+4]=r,this.int16[D+5]=i,this.int16[D+6]=o,this.int16[D+7]=s,this.int16[D+8]=a,this.int16[D+9]=l,this.int16[D+10]=c,this.int16[D+11]=u,this.int16[D+12]=h,this.uint16[D+13]=d,this.uint16[D+14]=f,this.uint16[D+15]=p,this.uint16[D+16]=m,this.uint16[D+17]=g,this.uint16[D+18]=_,this.uint16[D+19]=y,this.uint16[D+20]=v,this.uint16[D+21]=x,this.uint16[D+22]=b,this.uint16[D+23]=w,this.uint16[D+24]=S,this.uint16[D+25]=E,this.uint16[D+26]=T,this.uint16[D+27]=A,this.uint32[L+14]=C,this.float32[L+15]=P,this.float32[L+16]=I,this.float32[L+17]=k,this.float32[L+18]=M,this.uint8[N+76]=R,this.uint16[D+39]=O,e}}Aa.prototype.bytesPerElement=80,qo(Aa,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ca extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,s){const a=6*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=r,this.float32[a+3]=i,this.float32[a+4]=o,this.float32[a+5]=s,e}}Ca.prototype.bytesPerElement=24,qo(Ca,"StructArrayLayout6f24");class Pa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=r,this.float32[s+3]=i,this.float32[s+4]=o,e}}Pa.prototype.bytesPerElement=20,qo(Pa,"StructArrayLayout5f20");class Ia extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o,s)}emplace(e,t,n,r,i,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=n,this.float32[l+2]=r,this.float32[l+3]=i,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}Ia.prototype.bytesPerElement=28,qo(Ia,"StructArrayLayout7f28");class ka extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,n,r,i,o,s,a,l,c,u)}emplace(e,t,n,r,i,o,s,a,l,c,u,h){const d=11*e;return this.float32[d+0]=t,this.float32[d+1]=n,this.float32[d+2]=r,this.float32[d+3]=i,this.float32[d+4]=o,this.float32[d+5]=s,this.float32[d+6]=a,this.float32[d+7]=l,this.float32[d+8]=c,this.float32[d+9]=u,this.float32[d+10]=h,e}}ka.prototype.bytesPerElement=44,qo(ka,"StructArrayLayout11f44");class Ma extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,r,i,o,s,a,l)}emplace(e,t,n,r,i,o,s,a,l,c){const u=9*e;return this.float32[u+0]=t,this.float32[u+1]=n,this.float32[u+2]=r,this.float32[u+3]=i,this.float32[u+4]=o,this.float32[u+5]=s,this.float32[u+6]=a,this.float32[u+7]=l,this.float32[u+8]=c,e}}Ma.prototype.bytesPerElement=36,qo(Ma,"StructArrayLayout9f36");class Ra extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=n,e}}Ra.prototype.bytesPerElement=8,qo(Ra,"StructArrayLayout2f8");class Oa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=n,this.uint16[o+3]=r,this.uint16[o+4]=i,e}}Oa.prototype.bytesPerElement=12,qo(Oa,"StructArrayLayout1ul3ui12");class La extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}La.prototype.bytesPerElement=2,qo(La,"StructArrayLayout1ui2");class Da extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g){const _=16*e;return this.float32[_+0]=t,this.float32[_+1]=n,this.float32[_+2]=r,this.float32[_+3]=i,this.float32[_+4]=o,this.float32[_+5]=s,this.float32[_+6]=a,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=u,this.float32[_+10]=h,this.float32[_+11]=d,this.float32[_+12]=f,this.float32[_+13]=p,this.float32[_+14]=m,this.float32[_+15]=g,e}}Da.prototype.bytesPerElement=64,qo(Da,"StructArrayLayout16f64");class Na extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o,s)}emplace(e,t,n,r,i,o,s,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,this.uint16[l+2]=r,this.uint16[l+3]=i,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,e}}Na.prototype.bytesPerElement=20,qo(Na,"StructArrayLayout4ui3f20");class za extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}za.prototype.bytesPerElement=2,qo(za,"StructArrayLayout1i2");class Fa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}Fa.prototype.bytesPerElement=1,qo(Fa,"StructArrayLayout1ub1");class Ba extends Qs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ba.prototype.size=40;class ja extends xa{get(e){return new Ba(this,e)}}qo(ja,"CollisionBoxArray");class Ua extends Qs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ua.prototype.size=60;class Va extends Ta{get(e){return new Ua(this,e)}}qo(Va,"PlacedSymbolArray");class Ga extends Qs{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Ga.prototype.size=80;class Ha extends Aa{get(e){return new Ga(this,e)}}qo(Ha,"SymbolInstanceArray");class $a extends sa{getoffsetX(e){return this.float32[1*e+0]}}qo($a,"GlyphOffsetArray");class Wa extends ra{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}qo(Wa,"SymbolLineVertexArray");class qa extends Qs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qa.prototype.size=12;class Xa extends Oa{get(e){return new qa(this,e)}}qo(Xa,"FeatureIndexArray");class Za extends va{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}qo(Za,"FillExtrusionCentroidArray");class Ka extends Qs{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Ka.prototype.size=6;class Ya extends ia{get(e){return new Ka(this,e)}}qo(Ya,"FillExtrusionWallArray");const Ja=ta([{name:"a_pos",components:2,type:"Int16"}],4),Qa=ta([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),el=ta([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class tl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,n,r){let i=this.segments[this.segments.length-1];return e>tl.MAX_VERTEX_ARRAY_LENGTH&&He(`Max vertices per segment is ${tl.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!i||i.vertexLength+e>tl.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:t,primitiveOffset:n,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i}prepareSegment(e,t,n,r){return this._prepareSegment(e,t.length,n.length,r)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,r){return new tl([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])}}function nl(e,t){return 256*(e=ke(Math.floor(e),0,255))+ke(Math.floor(t),0,255)}tl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qo(tl,"SegmentVector");const rl=ta([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),il=ta([{name:"a_pattern_b",components:4,type:"Uint16"}]),ol=ta([{name:"a_dash",components:4,type:"Uint16"}]);class sl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,n,r){this.ids.push(al(e)),this.positions.push(t,n,r)}eachPosition(e,t){const n=al(e);let r=0,i=this.ids.length-1;for(;r<i;){const e=r+i>>1;this.ids[e]>=n?i=e:r=e+1}for(;this.ids[r]===n;)t(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(e,t){const n=new Float64Array(e.ids),r=new Uint32Array(e.positions);return ll(n,r,0,n.length-1),t&&(t.add(n.buffer),t.add(r.buffer)),{ids:n,positions:r}}static deserialize(e){const t=new sl;let n;t.ids=e.ids,t.positions=e.positions;for(const r of t.ids)r!==n&&t.uniqueIds.push(r),n=r;return t.indexed=!0,t}}function al(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Zt(String(e))}function ll(e,t,n,r){for(;n<r;){const i=e[n+r>>1];let o=n-1,s=r+1;for(;;){do{o++}while(e[o]<i);do{s--}while(e[s]>i);if(o>=s)break;cl(e,o,s),cl(t,3*o,3*s),cl(t,3*o+1,3*s+1),cl(t,3*o+2,3*s+2)}s-n<r-s?(ll(e,t,n,s),n=s+1):(ll(e,t,s+1,r),r=s)}}function cl(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}qo(sl,"FeaturePositionMap");class ul{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,n){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class hl extends ul{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class dl extends ul{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class fl extends ul{constructor(e){super(e),this.current=[0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class pl extends ul{constructor(e){super(e),this.current=[0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class ml extends ul{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class gl extends ul{constructor(e){super(e),this.current=sn.transparent.toPremultipliedRenderColor(null)}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const _l=new Float32Array(16);class yl extends ul{constructor(e){super(e),this.current=_l}set(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const vl=new Float32Array(9),xl=new Float32Array(4);class bl extends ul{constructor(e){super(e),this.current=xl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let r=0;r<4;r++)if(n[r]!==this.current[r]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}function wl(e){return[nl(255*e.r,255*e.g),nl(255*e.b,255*e.a)]}class Sl{constructor(e,t,n,r){this.value=e,this.uniformNames=t.map(e=>`u_${e}`),this.type=n,this.context=r}setUniform(e,t,n,r,i){const o=r.constantOr(this.value);t.set(e,i,o instanceof sn?o.toPremultipliedRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):o)}getBinding(e,t){return"color"===this.type?new gl(e):new dl(e)}}class El{constructor(e,t){this.uniformNames=t.map(e=>`u_${e}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,t){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=t?t.tl.concat(t.br):this.pattern}setUniform(e,t,n,r,i){let o=null;"u_pattern"!==i&&"u_dash"!==i||(o=this.pattern),"u_pattern_b"===i&&(o=this.patternTransition),"u_pixel_ratio"===i&&(o=this.pixelRatio),o&&t.set(e,i,o)}getBinding(e,t){return"u_pattern"===t||"u_pattern_b"===t||"u_dash"===t?new ml(e):new dl(e)}}class Tl{constructor(e,t,n,r){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(e,t,n,r,i,o,s,a){const l=this.paintVertexArray.length,c="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new ys(0,{brightness:o,worldview:a}),t,{},i,r,s):"constant"===this.expression.kind&&this.expression.value,u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new ys(0,{brightness:o,worldview:a}),t,{},i,r,s):this.lutExpression.value);this.paintVertexArray.resize(e),this._setPaintValue(l,e,c,u?null:this.context.lut)}updatePaintArray(e,t,n,r,i,o,s,a){const l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:s,worldview:a},n,r,void 0,i):"constant"===this.expression.kind&&this.expression.value,c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new ys(0,{brightness:s,worldview:a}),n,r,void 0,i):this.lutExpression.value);this._setPaintValue(e,t,l,c?null:this.context.lut)}_setPaintValue(e,t,n,r){if("color"===this.type){const i=wl(n.toPremultipliedRenderColor(r));for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Al{constructor(e,t,n,r,i,o){this.expression=e,this.uniformNames=t.map(e=>`u_${e}_t`),this.type=n,this.useIntegerZoom=r,this.context=i,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,t,n,r,i,o,s,a){const l=this.expression.evaluate(new ys(this.context.zoom,{brightness:o,worldview:a}),t,{},i,r,s),c=this.expression.evaluate(new ys(this.context.zoom+1,{brightness:o,worldview:a}),t,{},i,r,s),u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new ys(0,{brightness:o,worldview:a}),t,{},i,r,s):this.lutExpression.value),h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(h,e,l,c,u?null:this.context.lut)}updatePaintArray(e,t,n,r,i,o,s,a){const l=this.expression.evaluate({zoom:this.context.zoom,brightness:s,worldview:a},n,r,void 0,i),c=this.expression.evaluate({zoom:this.context.zoom+1,brightness:s,worldview:a},n,r,void 0,i),u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new ys(0,{brightness:s,worldview:a}),n,r,void 0,i):this.lutExpression.value);this._setPaintValue(e,t,l,c,u?null:this.context.lut)}_setPaintValue(e,t,n,r,i){if("color"===this.type){const r=wl(n.toPremultipliedRenderColor(i)),o=wl(n.toPremultipliedRenderColor(i));for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1],o[0],o[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,r,i){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,s=ke(this.expression.interpolationFactor(o,this.context.zoom,this.context.zoom+1),0,1);t.set(e,i,s)}getBinding(e,t){return new dl(e)}}class Cl{constructor(e,t,n,r,i){this.expression=e,this.layerId=i,this.paintVertexAttributes=("array"===n?ol:rl).members;for(let o=0;o<t.length;++o);this.paintVertexArray=new r,this.paintTransitionVertexArray=new fa}populatePaintArray(e,t,n,r){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,r,i,o,s){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],o)}_setPaintValues(e,t,n,r){if(!r||!n)return;const i=r[n[0]],o=r[n[1]];if(i){if(i){const{tl:n,br:r,pixelRatio:o}=i;for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1],r[0],r[1],o)}if(o){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:n,br:r}=o;for(let i=e;i<t;i++)this.paintTransitionVertexArray.emplace(i,n[0],n[1],r[0],r[1])}}}upload(e){const t=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,t)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,il.members,t))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Pl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[],this.context=t;const r=[];for(const i in e.paint._values){const o=e.paint.get(i);if(i.endsWith("-use-theme"))continue;if(!n(i))continue;if(!(o instanceof Ts&&wo(o.property.specification)))continue;const s=Ml(i,e.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===i||i.endsWith("pattern"),h=e.paint.get(`${i}-use-theme`),d="line-dasharray"===i&&"constant"!==e.layout.get("line-cap").value.kind||h&&"constant"!==h.value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||u){const t=Ll(i,l,"source");this.binders[i]=u?new Cl(a,s,l,t,e.id):new Tl(a,s,l,t),r.push(`/a_${i}`)}else{const e=Ll(i,l,"composite");this.binders[i]=new Al(a,s,l,c,t,e),r.push(`/z_${i}`)}else this.binders[i]=u?new El(a.value,s):new Sl(a.value,s,l,t),r.push(`/u_${i}`);h&&(this.binders[i].lutExpression=h.value)}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Tl||t instanceof Al?t.maxValue:0}populatePaintArrays(e,t,n,r,i,o,s,a){for(const l in this.binders){const c=this.binders[l];c.context=this.context,(c instanceof Tl||c instanceof Al||c instanceof Cl)&&c.populatePaintArray(e,t,n,r,i,o,s,a)}}setConstantPatternPositions(e,t){for(const n in this.binders){const r=this.binders[n];r instanceof El&&r.setConstantPatternPositions(e,t)}}getPatternTransitionVertexBuffer(e){const t=this.binders[e];return t instanceof Cl?t.paintTransitionVertexBuffer:null}updatePaintArrays(e,t,n,r,i,o,s,a,l,c){let u=!1;const h=Object.keys(e),d=0!==h.length&&!a,f=d?h:t.uniqueIds;this.context.lut=i.lut;for(const p in this.binders){const a=this.binders[p];if(a.context=this.context,(a instanceof Tl||a instanceof Al||a instanceof Cl)&&a.expression&&a.expression.kind&&"constant"!==a.expression.kind&&(!0===a.expression.isStateDependent||!1===a.expression.isLightConstant)){const h=i.paint.get(p);a.expression=h.value;for(const n of f){const i=e[n.toString()];t.eachPosition(n,(e,t,n)=>{const u=r.feature(e);a.updatePaintArray(t,n,u,i,o,s,l,c)})}if(!d)for(const t of n.uniqueIds){const i=e[t.toString()];n.eachPosition(t,(e,t,n)=>{const u=r.feature(e);a.updatePaintArray(t,n,u,i,o,s,l,c)})}u=!0}}return u}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Sl||n instanceof El)&&e.push(...n.uniformNames.map(e=>`#define HAS_UNIFORM_${e}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Tl||n instanceof Al||n instanceof Cl)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name);if(n instanceof Cl)for(let t=0;t<il.members.length;t++)e.push(il.members[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Sl||n instanceof El||n instanceof Al)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof Sl||r instanceof El||r instanceof Al)for(const i of r.uniformNames)t.push({name:i,property:n,binding:r.getBinding(e,i)})}return t}setUniforms(e,t,n,r,i){for(const{name:o,property:s,binding:a}of n)this.binders[s].setUniform(e,a,i,r.get(s),o)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Tl||t instanceof Al||t instanceof Cl)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer),t instanceof Cl&&t.paintTransitionVertexBuffer&&this._buffers.push(t.paintTransitionVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Tl||n instanceof Al||n instanceof Cl)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Tl||t instanceof Al||t instanceof Cl)&&t.destroy()}}}class Il{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new Pl(r,t,n);this.needsUpload=!1,this._featureMap=new sl,this._featureMapWithoutIds=new sl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,n,r,i,o,s,a,l){for(const c in this.programConfigurations)this.programConfigurations[c].populatePaintArrays(e,t,r,i,o,s,a,l);void 0!==t.id?this._featureMap.add(t.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,r,i,o,s,a){for(const l of n)this.needsUpload=this.programConfigurations[l.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,l,r,i,o,s||0,a)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const kl={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Ml(e,t){return kl[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Rl={"line-pattern":{source:da,composite:da},"fill-pattern":{source:da,composite:da},"fill-extrusion-pattern":{source:da,composite:da},"line-dasharray":{source:fa,composite:fa}},Ol={color:{source:Ra,composite:_a},number:{source:sa,composite:Ra}};function Ll(e,t,n){const r=Rl[e];return r&&r[n]||Ol[t][n]}qo(Sl,"ConstantBinder"),qo(El,"PatternConstantBinder"),qo(Tl,"SourceExpressionBinder"),qo(Cl,"PatternCompositeBinder"),qo(Al,"CompositeExpressionBinder"),qo(Pl,"ProgramConfiguration",{omit:["_buffers"]}),qo(Il,"ProgramConfigurationSet");const Dl=Lr/Math.PI/2,Nl=5,zl=6,Fl=16383,Bl=64,jl=[Bl,32,16],Ul=-Dl,Vl=Dl;function Gl(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Dl;return n=Ee(n),[e*Math.sin(n)*r,-t*r,e*Math.cos(n)*r]}function Hl(e,t,n){return Gl(Math.cos(Ee(e)),Math.sin(Ee(e)),t,n)}const $l=6371008.8,Wl=2*Math.PI*$l;class ql{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ql(Re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return $l*Math.acos(Math.min(i,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new Xl({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return Hl(this.lat,this.lng,Dl+e*Dl/$l)}static convert(e){if(e instanceof ql)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ql(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ql(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Xl{constructor(e,t){if(e)if(t)this.setSouthWest(e).setNorthEast(t);else if(4===e.length){const t=e;this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]])}else{const t=e;this.setSouthWest(t[0]).setNorthEast(t[1])}}setNorthEast(e){return this._ne=e instanceof ql?new ql(e.lng,e.lat):ql.convert(e),this}setSouthWest(e){return this._sw=e instanceof ql?new ql(e.lng,e.lat):ql.convert(e),this}extend(e){const t=this._sw,n=this._ne;let r,i;if(e instanceof ql)r=e,i=e;else{if(!(e instanceof Xl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Xl.convert(e)):this.extend(ql.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ql.convert(e)):this;if(r=e._sw,i=e._ne,!r||!i)return this}return t||n?(t.lng=Math.min(r.lng,t.lng),t.lat=Math.min(r.lat,t.lat),n.lng=Math.max(i.lng,n.lng),n.lat=Math.max(i.lat,n.lat)):(this._sw=new ql(r.lng,r.lat),this._ne=new ql(i.lng,i.lat)),this}getCenter(){return new ql((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ql(this.getWest(),this.getNorth())}getSouthEast(){return new ql(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=ql.convert(e);let r=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&r}static convert(e){if(e)return e instanceof Xl?e:new Xl(e)}}const Zl=0,Kl=25.5;function Yl(e){return Wl*Math.cos(e*Math.PI/180)}function Jl(e){return(180+e)/360}function Ql(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ec(e,t){return e/Yl(t)}function tc(e){return 360*e-180}function nc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function rc(e,t){return e*Yl(nc(t))}const ic=85.051129;function oc(e){return Math.cos(Ee(ke(e,-ic,ic)))}function sc(e,t){const n=ke(t,Zl,Kl),r=Math.pow(2,n);return oc(e)*Wl/(512*r)}function ac(e){return 1/Math.cos(e*Math.PI/180)}function lc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Math.exp(Math.PI*(1-(e.y+t/Lr)/(1<<e.z)*2));return 80150034*n/(n*n+1)/Lr/(1<<e.z)}class cc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=ql.convert(e);return new cc(Jl(n.lng),Ql(n.lat),ec(t,n.lat))}toLngLat(){return new ql(tc(this.x),nc(this.y))}toAltitude(){return rc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Wl*ac(nc(this.y))}}function uc(e,t,n,r,i,o,s,a,l){const c=(t+r)/2,u=(n+i)/2,h=new xe(c,u);a(h),function(e,t,n,r,i,o){const s=n-i,a=r-o;return Math.abs((r-t)*s-(n-e)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(uc(e,t,n,c,u,o,h,a,l),uc(e,c,u,r,i,h,s,a,l)):e.push(s)}function hc(e,t,n){let r=e[0],i=r.x,o=r.y;t(r);const s=[r];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),uc(s,i,o,c,u,r,l,t,n),i=c,o=u,r=l}return s}function dc(e,t,n,r){if(r(t,n)){const i=t.add(n)._mult(.5);dc(e,t,i,r),dc(e,i,n,r)}else e.push(n)}function fc(e,t){let n=e[0];const r=[n];for(let i=1;i<e.length;i++){const o=e[i];dc(r,n,o,t),n=o}return r}const pc=Math.pow(2,14)-1,mc=-pc-1;function gc(e,t){const n=Math.round(e.x*t),r=Math.round(e.y*t);return e.x=ke(n,mc,pc),e.y=ke(r,mc,pc),(n<e.x||n>e.x+1||r<e.y||r>e.y+1)&&He("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function _c(e,t,n){const r=e.loadGeometry(),i=e.extent,o=Lr/i;if(t&&n&&n.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=n,u=e=>{const n=tc((t.x+e.x/i)/o),r=nc((t.y+e.y/i)/o),u=c.project(n,r);e.x=(u.x*s-a)*i,e.y=(u.y*s-l)*i};for(let t=0;t<r.length;t++)if(1!==e.type)r[t]=hc(r[t],u,1);else{const e=[];for(const n of r[t])n.x<0||n.x>=i||n.y<0||n.y>=i||(u(n),e.push(n));r[t]=e}}for(const s of r)for(const e of s)gc(e,o);return r}function yc(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?_c(e):[]}}class vc{constructor(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(xc,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,n=[];let r,i=1,o=0,s=0,a=0;for(;e.pos<t;){if(o<=0){const t=e.readVarint();i=7&t,o=t>>3}if(o--,1===i||2===i)s+=e.readSVarint(),a+=e.readSVarint(),1===i&&(r&&n.push(r),r=[]),r&&r.push(new xe(s,a));else{if(7!==i)throw new Error(`unknown command ${i}`);r&&r.push(r[0].clone())}}return r&&n.push(r),n}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let n=1,r=0,i=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(r<=0){const t=e.readVarint();n=7&t,r=t>>3}if(r--,1===n||2===n)i+=e.readSVarint(),o+=e.readSVarint(),i<s&&(s=i),i>a&&(a=i),o<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error(`unknown command ${n}`)}return[s,l,a,c]}toGeoJSON(e,t,n){const r=this.extent*Math.pow(2,n),i=this.extent*e,o=this.extent*t,s=this.loadGeometry();function a(e){return[360*(e.x+i)/r-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/r)*Math.PI))-90]}function l(e){return e.map(a)}let c;if(1===this.type){const e=[];for(const n of s)e.push(n[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=s.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=function(e){const t=e.length;if(t<=1)return[e];const n=[];let r,i;for(let o=0;o<t;o++){const t=bc(e[o]);0!==t&&(void 0===i&&(i=t<0),i===t<0?(r&&n.push(r),r=[e[o]]):r&&r.push(e[o]))}return r&&n.push(r),n}(s),t=[];for(const n of e)t.push(n.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function xc(e,t,n){1===e?t.id=n.readVarint():2===e?function(e,t){const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[n]=r}}(n,t):3===e?t.type=n.readVarint():4===e&&(t._geometry=n.pos)}function bc(e){let t=0;for(let n,r,i=0,o=e.length,s=o-1;i<o;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}vc.types=["Unknown","Point","LineString","Polygon"];class wc{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Sc,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new vc(this._pbf,t,this.extent,this._keys,this._values)}}function Sc(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){let t=null;const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}if(null==t)throw new Error("unknown feature value");return t}(n))}class Ec{constructor(e,t){this.layers=e.readFields(Tc,{},t)}}function Tc(e,t,n){if(3===e){const e=new wc(n,n.readVarint()+n.pos);e.length&&(t[e.name]=e)}}const Ac="3d_elevation_id",Cc="level";class Pc{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(e,t){return this._valid&&e(t(this._geometry)),this}require(e,t,n){return this.get(e,!0,t,n)}optional(e,t,n){return this.get(e,!1,t,n)}success(){return this._valid}get(e,t,n,r){const i=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&void 0!==i&&!Number.isNaN(i)?n(r?r(i):i):t&&(this._valid=!1),this}}class Ic{constructor(e,t){this.featureFunc=e,this.vertexFunc=t}parseFeature(e,t,n){return this.featureFunc(e,t,n)}parseVertex(e,t,n){return this.vertexFunc(e,t,n)}}const kc=new Ic((e,t,n)=>e.reset(t).require(Ac,e=>{n.id=e}).optional("fixed_height_relative",e=>{n.constantHeight=e},Rc.decodeRelativeHeight).geometry(e=>{n.bounds=e},dr).success(),(e,t,n)=>e.reset(t).require(Ac,e=>{n.id=e}).require("elevation_idx",e=>{n.idx=e}).require("extent",e=>{n.extent=e}).require("height_relative",e=>{n.height=e},Rc.decodeRelativeHeight).geometry(e=>{n.position=e},Rc.getPoint).success()),Mc=new Ic((e,t,n)=>e.reset(t).require(Ac,e=>{n.id=e}).optional("fixed_height",e=>{n.constantHeight=e},Rc.decodeMetricHeight).geometry(e=>{n.bounds=e},dr).success(),(e,t,n)=>e.reset(t).require(Ac,e=>{n.id=e}).require("elevation_idx",e=>{n.idx=e}).require("extent",e=>{n.extent=e}).require("height",e=>{n.height=e},Rc.decodeMetricHeight).geometry(e=>{n.position=e},Rc.getPoint).success());class Rc{static getPoint(e){return ae(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const t=[],n=[],r=e.length,i=new Pc;for(let s=0;s<r;s++){const r=e.feature(s),a=r.properties.version,l=(o=a)?"1.0.1"===o?Mc:void 0:kc;if(void 0===l){He(`Unknown elevation feature version number ${a||"(unknown)"}`);continue}const c=r.properties.hasOwnProperty("type")?r.properties.type:void 0;if(c)if("Point"===vc.types[r.type]&&"curve_point"===c){const e={};l.parseVertex(i,r,e)&&t.push(e)}else if("Polygon"===vc.types[r.type]&&"curve_meta"===c){const e={};l.parseFeature(i,r,e)&&n.push(e)}}var o;return{vertices:t,features:n}}}class Oc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const r=fe(t,this.dir);if(Math.abs(r)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1])/r;return n[0]=this.pos[0]+this.dir[0]*i,n[1]=this.pos[1]+this.dir[1]*i,!0}}class Lc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const r=N(t,this.dir);if(Math.abs(r)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/r;return n[0]=this.pos[0]+this.dir[0]*i,n[1]=this.pos[1]+this.dir[1]*i,n[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(e,n,r){if(function(e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],l=n[2];return Math.abs(r-s)<=t*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=t*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-l)<=t*Math.max(1,Math.abs(o),Math.abs(l))}(this.pos,e)||0===n)return r[0]=r[1]=r[2]=0,!1;const[i,o,s]=this.dir,a=this.pos[0]-e[0],l=this.pos[1]-e[1],c=this.pos[2]-e[2],u=i*i+o*o+s*s,h=2*(a*i+l*o+c*s),d=h*h-4*u*(a*a+l*l+c*c-n*n);if(d<0){const e=Math.max(-h/2,0),t=a+i*e,u=l+o*e,d=c+s*e,f=Math.hypot(t,u,d);return r[0]=t*n/f,r[1]=u*n/f,r[2]=d*n/f,!1}{const e=(-h-Math.sqrt(d))/(2*u);if(e<0){const e=Math.hypot(a,l,c);return r[0]=a*n/e,r[1]=l*n/e,r[2]=c*n/e,!1}return r[0]=a+i*e,r[1]=l+o*e,r[2]=c+s*e,!0}}}class Dc{constructor(e,t,n,r,i){this.TL=e,this.TR=t,this.BR=n,this.BL=r,this.horizon=i}static fromInvProjectionMatrix(e,t,n){const r=[-1,1,1],i=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=B(r,r,e),l=B(i,i,e),c=B(o,o,e),u=B(s,s,e);return new Dc(a,l,c,u,t/n)}}function Nc(e,t,n){let r=1/0,i=-1/0;const o=[];for(const s of e){H(o,s,t);const e=N(o,n);r=Math.min(r,e),i=Math.max(i,e)}return[r,i]}function zc(e,t){let n=!0;for(let r=0;r<e.planes.length;r++){const i=e.planes[r];let o=0;for(let e=0;e<t.length;e++)o+=N(i,t[e])+i[3]>=0;if(0===o)return 0;o!==t.length&&(n=!1)}return n?2:1}function Fc(e,t){for(const n of e.projections){const r=Nc(t,e.points[0],n.axis);if(n.projection[1]<r[0]||n.projection[0]>r[1])return 0}return 1}function Bc(e,t){let n=0;const r=[0,0,0,0];for(let s=0;s<e.length;s++)r[0]=e[s][0],r[1]=e[s][1],r[2]=e[s][2],r[3]=1,(i=r)[0]*(o=t)[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]>=0&&n++;var i,o;return n}class jc{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=Uc.fromPoints(this.points),this.projections=[],this.frustumEdges=[H([],this.points[2],this.points[3]),H([],this.points[0],this.points[3]),H([],this.points[4],this.points[0]),H([],this.points[5],this.points[1]),H([],this.points[6],this.points[2]),H([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const e=[0,-n[2],n[1]],t=[n[2],0,-n[0]];this.projections.push({axis:e,projection:Nc(this.points,this.points[0],e)}),this.projections.push({axis:t,projection:Nc(this.points,this.points[0],t)})}}static fromInvProjectionMatrix(e,t,n,r){const i=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(n=>{const o=K([],n,e),s=1/o[3]/t*i;return(a=o)[0]=(l=o)[0]*(c=[s,s,r?1/o[3]:s,s])[0],a[1]=l[1]*c[1],a[2]=l[2]*c[2],a[3]=l[3]*c[3],a;var a,l,c}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const t=D([],z([],H([],o[e[0]],o[e[1]]),H([],o[e[2]],o[e[1]]))),n=-N(t,o[e[1]]);return t.concat(n)}),a=[];for(let l=0;l<o.length;l++)a.push([o[l][0],o[l][1],o[l][2]]);return new jc(a,s)}intersectsPrecise(e,t,n){for(let r=0;r<t.length;r++)if(!Bc(e,t[r]))return 0;for(let r=0;r<this.planes.length;r++)if(!Bc(e,this.planes[r]))return 0;for(const r of n)for(const t of this.frustumEdges){const n=z([],r,t),i=w(n);if(0===i)continue;k(n,n,1/i);const o=Nc(this.points,this.points[0],n),s=Nc(e,this.points[0],n);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}containsPoint(e){for(const t of this.planes){const n=t[3];if(N([t[0],t[1],t[2]],e)+n<0)return!1}return!0}}class Uc{static fromPoints(e){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const r of e)P(t,t,r),I(n,n,r);return new Uc(t,n)}static fromTileIdAndHeight(e,t,n){const r=1<<e.canonical.z,i=e.canonical.x,o=e.canonical.y;return new Uc([i/r,o/r,t],[(i+1)/r,(o+1)/r,n])}static applyTransform(e,t){const n=e.getCorners();for(let r=0;r<n.length;++r)B(n[r],n[r],t);return Uc.fromPoints(n)}static applyTransformFast(e,t){const n=[t[12],t[13],t[14]],r=[...n];for(let i=0;i<3;i++)for(let o=0;o<3;o++){const s=t[4*o+i],a=s*e.min[o],l=s*e.max[o];n[i]+=Math.min(a,l),r[i]+=Math.max(a,l)}return new Uc(n,r)}static projectAabbCorners(e,t){const n=e.getCorners();for(let r=0;r<n.length;++r)B(n[r],n[r],t);return n}constructor(e,t){this.min=e,this.max=t,this.center=k([],T([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=b(this.min),r=b(this.max);for(let i=0;i<t.length;i++)n[i]=t[i]?this.min[i]:this.center[i],r[i]=t[i]?this.center[i]:this.max[i];return r[2]=this.max[2],new Uc(n,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?zc(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?zc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Fc(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Fc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}qo(Uc,"Aabb");class Vc{constructor(e,t){this.feature=e,this.metersToTile=t,this.index=0}get(){const e=this.feature.vertices[this.index],t=this.feature.vertexProps[this.index].dir,n=t[1],r=-t[0],i=(e.extent+1)*this.metersToTile;return[new xe(Math.trunc(e.position[0]+n*i),Math.trunc(e.position[1]+r*i)),new xe(Math.trunc(e.position[0]-n*i),Math.trunc(e.position[1]-r*i))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Gc{constructor(e,t,n,r,i,o){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:n,max:n},this.safeArea=t,this.constantHeight=n,null==this.constantHeight&&(null!=this.constantHeight||0!==r.length)){this.vertices=r,this.edges=i,this.edges=this.edges.filter(e=>{return e.a<this.vertices.length&&e.b<this.vertices.length&&!((t=this.vertices[e.a].position)[0]===(n=this.vertices[e.b].position)[0]&&t[1]===n[1]);var t,n}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const e of this.vertices)this.vertexProps.push({dir:ae(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,e.height),this.heightRange.max=Math.max(this.heightRange.max,e.height);for(const e of this.edges){const t=this.vertices[e.a].position,n=this.vertices[e.b].position,r=ce(se(),n,t),i=he(r),o=ue(se(),r,1/i);this.edgeProps.push({vec:r,dir:o,len:i});const s=this.vertexProps[e.a].dir,a=this.vertexProps[e.b].dir;le(s,s,o),le(a,a,o)}for(const e of this.vertexProps)0===e.dir[0]&&0===e.dir[1]||de(e.dir,e.dir);this.tessellate(o)}}pointElevation(e){if(null!=this.constantHeight)return this.constantHeight;const t=this.getClosestEdge(e);if(null==t)return 0;const[n,r]=t;return un(this.vertices[this.edges[n].a].height,this.vertices[this.edges[n].b].height,r)}computeSlopeNormal(e,t){const n=this.getClosestEdge(e);if(!n)return S(0,0,1);const r=n[0],i=this.edges[r],o=this.edgeProps[r].vec,s=S(o[0],o[1],(this.vertices[i.b].height-this.vertices[i.a].height)*t),a=S(s[1],-s[0],0);z(a,a,s);const l=w(a);return l>0?k(a,a,1/l):S(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(0===this.edges.length)return;let t=0,n=Number.POSITIVE_INFINITY,r=0;const i=ae(e.x,e.y);for(let o=0;o<this.edges.length;o++){const e=this.edges[o],s=this.edgeProps[o].dir,a=new Oc(i,this.edgeProps[o].dir),l=this.vertices[e.a].position,c=this.vertices[e.b].position,u=se(),h=se(),d=a.intersectsPlane(l,this.vertexProps[e.a].dir,u),f=a.intersectsPlane(c,this.vertexProps[e.b].dir,h);if(!d||!f)continue;const p=ce(se(),h,u),m=ce(se(),i,u),g=fe(p,p),_=g>0?fe(m,p)/g:0,y=ke(_,0,1),v=Math.abs((_-y)*this.edgeProps[o].len),x=ce(se(),i,l),b=v+Math.abs(fe(x,ae(s[1],-s[0])));b<n&&(t=o,n=b,r=y)}return[t,r]}tessellate(e){for(let t=this.edges.length-1;t>=0;--t){const n=this.edges[t].a,r=this.edges[t].b,{position:i,height:o,extent:s}=this.vertices[n],{position:a,height:l,extent:c}=this.vertices[r],u=this.vertexProps[n].dir,h=this.vertexProps[r].dir,d=S(i[0]/e,i[1]/e,o),f=S(a[0]/e,a[1]/e,l),p=S(u[1],-u[0],0);k(p,p,s);const m=S(h[1],-h[0],0);if(k(m,m,c),this.distSqLines(S(d[0]+.5*p[0],d[1]+.5*p[1],d[2]+.5*p[2]),S(f[0]-.5*m[0],f[1]-.5*m[1],f[2]-.5*m[2]),S(d[0]-.5*p[0],d[1]-.5*p[1],d[2]-.5*p[2]),S(f[0]+.5*m[0],f[1]+.5*m[1],f[2]+.5*m[2]))<=.0025000000000000005)continue;const g=this.vertices.length,_=le(se(),i,a);this.vertices.push({position:ue(_,_,.5),height:.5*(o+l),extent:.5*(s+c)});const y=le(se(),u,h);this.vertexProps.push({dir:de(y,y)}),this.edges.splice(t,1),this.edgeProps.splice(t,1),this.edges.push({a:n,b:g}),this.edges.push({a:g,b:r});const v=ce(se(),this.vertices[g].position,i),x=he(v),b={vec:v,dir:ue(se(),v,1/x),len:x};this.edgeProps.push(b),this.edgeProps.push(b)}}distSqLines(e,t,n,r){const i=A(x(),t,e),o=A(x(),r,n),s=A(x(),e,n),a=N(i,i),l=N(i,o),c=N(i,s),u=N(o,o),h=N(o,s),d=a*u-l*l;if(0===d){const t=N(s,o)/N(o,o);return R(F(x(),n,r,t),e)}const f=(l*h-c*u)/d,p=(a*h-l*c)/d;return R(F(x(),e,t,f),F(x(),n,r,p))}}class Hc{static parseFrom(e,t){const n=Rc.parse(e);if(!n)return[];let{vertices:r,features:i}=n;const o=1/lc(t);i.sort((e,t)=>e.id-t.id),r.sort((e,t)=>e.id-t.id||e.idx-t.idx),r=r.filter((e,t,n)=>t===n.findIndex(t=>t.id===e.id&&t.idx===e.idx));const s=new Array;let a=0;const l=r.length;for(const c of i){if(c.constantHeight){s.push(new Gc(c.id,c.bounds,c.constantHeight));continue}for(;a!==l&&r[a].id<c.id;)a++;if(a===l||r[a].id!==c.id)continue;const e=new Array,t=new Array,n=a;for(;a!==l&&r[a].id===c.id;){const i=r[a];if(e.push({position:i.position,height:i.height,extent:i.extent}),a!==n&&r[a-1].idx===i.idx-1){const e=a-n;t.push({a:e-1,b:e})}a++}s.push(new Gc(c.id,c.bounds,void 0,e,t,o))}return s}static getElevationFeature(e,t){if(!t)return;const n=+e.properties[Ac];return Number.isNaN(n)?void 0:t.find(e=>e.id===n)}}class $c{constructor(e,t){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(t)||(this.zScale=Math.pow(2,t.z-e.z),this.xOffset=(e.x*this.zScale-t.x)*Lr,this.yOffset=(e.y*this.zScale-t.y)*Lr)}constantElevation(e,t){if(null!=e.constantHeight)return this.computeBiasedHeight(e.constantHeight,t)}pointElevation(e,t,n){const r=this.constantElevation(t,n);return null!=r?r:(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(t.pointElevation(e),n))}computeBiasedHeight(e,t){return t<=0?e:e+t*Me(0,t,e>=0?e:Math.abs(.5*e))}}qo(Gc,"ElevationFeature");class Wc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ra,this.indexArray=new Ea,this.segments=new tl,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,"none"!==this.elevationMode&&(this.elevatedLayoutVertexArray=new sa),this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,r){const i=this.layers[0],o=[];let s=null;"circle"===i.type&&(s=i.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(l,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),t,n))continue;const i=s?s.evaluate(t,{},n):void 0,a={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:e?t.geometry:_c(l,n,r),patterns:{},sortKey:i};o.push(a)}s&&o.sort((e,t)=>e.sortKey-t.sortKey);let a=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new pa,a=r.projection);for(const l of o){const{geometry:r,index:i,sourceLayerIndex:o}=l,s=e[i].feature;this.addFeature(l,r,i,t.availableImages,n,a,t.brightness,t.elevationFeatures),t.featureIndex.insert(s,r,i,o,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,t,n,r,i,o,s){this.programConfigurations.updatePaintArrays(e,t,i,n,r,o,s,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ja.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,el.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Qa.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,t,n,r,i,o,s,a){let l;"none"!==this.elevationMode&&(l=Hc.getElevationFeature(e,a));for(const c of t)for(const t of c){const n=t.x,r=t.y;if(n<0||n>=Lr||r<0||r>=Lr)continue;if(o){const e=o.projectTilePoint(n,r,i),t=o.upVector(i,n,r);this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;if(this.addCircleVertex(n,r,-1,-1),this.addCircleVertex(n,r,1,-1),this.addCircleVertex(n,r,1,1),this.addCircleVertex(n,r,-1,1),"none"!==this.elevationMode){const e=l?l.pointElevation(new xe(n,r)):0;this.hasElevation=this.hasElevation||0!==e;for(let t=0;t<4;t++)this.elevatedLayoutVertexArray.emplaceBack(e)}this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},r,i,s,void 0,this.worldview)}addCircleVertex(e,t,n,r){this.layoutVertexArray.emplaceBack(2*e+(n+1)/2,2*t+(r+1)/2)}addGlobeExtVertex(e,t){const n=16384;this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,t[0]*n,t[1]*n,t[2]*n)}}function qc(e,t){for(let n=0;n<e.length;n++)if(iu(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(iu(e,t[n]))return!0;return!!Yc(e,t)}function Xc(e,t,n){return!!iu(e,t)||!!tu(t,e,n)}function Zc(e,t){if(1===e.length)return ru(t,e[0]);for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.length;t++)if(iu(e,r[t]))return!0}for(let n=0;n<e.length;n++)if(ru(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Yc(e,t[n]))return!0;return!1}function Kc(e,t,n){if(e.length>1){if(Yc(e,t))return!0;for(let r=0;r<t.length;r++)if(tu(t[r],e,n))return!0}for(let r=0;r<e.length;r++)if(tu(e[r],t,n))return!0;return!1}function Yc(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];for(let e=0;e<t.length-1;e++)if(Jc(r,i,t[e],t[e+1]))return!0}return!1}function Jc(e,t,n,r){return $e(e,n,r)!==$e(t,n,r)&&$e(e,t,n)!==$e(e,t,r)}function Qc(e,t,n){return(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x)}function eu(e,t,n,r){const i=Qc(e,t,r),o=Qc(e,t,n);if(Math.sign(i)===Math.sign(o))return;const s=Qc(n,r,e),a=s+o-i;return Math.sign(s)!==Math.sign(a)?[s/(s-a),o/(o-i)]:void 0}function tu(e,t,n){const r=n*n;if(1===t.length)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(nu(e,t[i-1],t[i])<r)return!0;return!1}function nu(e,t,n){const r=t.distSqr(n);if(0===r)return e.distSqr(t);const i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function ru(e,t){let n,r,i,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)r=n[e],i=n[s],r.y>t.y!=i.y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(o=!o)}return o}function iu(e,t){let n=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const o=e[r],s=e[i];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function ou(e,t,n,r,i){for(const s of e)if(t<=s.x&&n<=s.y&&r>=s.x&&i>=s.y)return!0;const o=[new xe(t,n),new xe(t,i),new xe(r,i),new xe(r,n)];if(e.length>2)for(const s of o)if(iu(e,s))return!0;for(let s=0;s<e.length-1;s++)if(su(e[s],e[s+1],o))return!0;return!1}function su(e,t,n){const r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;const o=$e(e,t,n[0]);return o!==$e(e,t,n[1])||o!==$e(e,t,n[2])||o!==$e(e,t,n[3])}function au(e,t,n,r,i,o){let s=t.y-e.y,a=e.x-t.x;if(o=o||0){const e=s*s+a*a;if(0===e)return!0;const t=Math.sqrt(e);s/=t,a/=t}return!((n.x-e.x)*s+(n.y-e.y)*a-o<0||(r.x-e.x)*s+(r.y-e.y)*a-o<0||(i.x-e.x)*s+(i.y-e.y)*a-o<0)}function lu(e,t,n,r,i,o,s){return!(au(e,t,r,i,o,s)||au(t,n,r,i,o,s)||au(n,e,r,i,o,s)||au(r,i,e,t,n,s)||au(i,o,e,t,n,s)||au(o,r,e,t,n,s))}function cu(e,t,n){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function uu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function hu(e,t,n,r,i){if(!t[0]&&!t[1])return e;const o=xe.convert(t)._mult(i);"viewport"===n&&o._rotate(-r);const s=[];for(let a=0;a<e.length;a++)s.push(e[a].sub(o));return s}function du(e,t,n,r){const i=xe.convert(e)._mult(r);return"viewport"===t&&i._rotate(-n),i}let fu,pu;function mu(e,t,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}qo(Wc,"CircleBucket",{omit:["layers"]});class gu{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=vu(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const t=this.z-e.z;return 0===e.z||e.z<this.z&&e.x===this.x>>t&&e.y===this.y>>t}url(e,t){const n=function(e,t,n){var r=mu(256*e,256*(t=Math.pow(2,n)-t-1),n),i=mu(256*(e+1),256*(t+1),n);return r[0]+","+r[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),r=function(e,t,n){let r,i="";for(let o=e;o>0;o--)r=1<<o-1,i+=(t&r?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _u{constructor(e,t){this.wrap=e,this.canonical=t,this.key=vu(e,t.z,t.z,t.x,t.y)}}class yu{constructor(e,t,n,r,i){this.overscaledZ=e,this.wrap=t,this.canonical=new gu(n,+r,+i),this.key=0===t&&e===n?this.canonical.key:vu(t,e,n,r,i)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new yu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return vu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return vu(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new yu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new yu(t,this.wrap,t,n,r),new yu(t,this.wrap,t,n+1,r),new yu(t,this.wrap,t,n,r+1),new yu(t,this.wrap,t,n+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new yu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new yu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _u(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vu(e,t,n,r,i){const o=1<<Math.min(n,22);let s=o*(i%o)+r%o;return e&&n<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*s+n)+(t-n)}const xu=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new yu(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new yu(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new yu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new yu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];qo(gu,"CanonicalTileID"),qo(yu,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const bu=ta([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:wu}=bu,Su=ta([{name:"a_pos_3",components:3,type:"Int16"}]);var Eu=ta([{name:"a_pos",type:"Int16",components:2}]);function Tu(e){return e*Dl/$l}const Au=[new Uc([Ul,Ul,Ul],[Vl,Vl,Vl]),new Uc([Ul,Ul,Ul],[0,0,Vl]),new Uc([0,Ul,Ul],[Vl,0,Vl]),new Uc([Ul,0,Ul],[0,Vl,Vl]),new Uc([0,0,Ul],[Vl,Vl,Vl])];function Cu(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=k([],e._camera.position,e.worldSize),o=[t,n,1,1];K(o,o,e.pixelMatrixInverse),X(o,o,1/o[3]);const s=D([],H([],o,i)),a=e.globeMatrix,l=[a[12],a[13],a[14]],c=H([],l,i),u=w(c),h=D([],c),d=e.worldSize/(2*Math.PI),f=N(h,s),p=Math.asin(d/u);if(p<Math.acos(f)){if(!r)return null;const e=[],t=[];k(e,s,u/f),D(t,H(t,e,c)),D(s,T(s,c,k(s,t,Math.tan(p)*u)))}const m=[];new Lc(i,s).closestPointOnSphere(l,d,m);const g=D([],Ye(a,0)),_=D([],Ye(a,1)),y=D([],Ye(a,2)),v=N(g,m),x=N(_,m),b=N(y,m),S=Te(Math.asin(-x/d));let E=Te(Math.atan2(v,b));E=e.center.lng+function(e,t){const n=(t-e+180)%360-180;return n<-180?n+360:n}(e.center.lng,E);const A=Jl(E),C=ke(Ql(S),0,1);return new cc(A,C)}class Pu{constructor(e,t,n){this.a=H([],e,n),this.b=H([],t,n),this.center=n;const r=D([],this.a),i=D([],this.b);this.angle=Math.acos(N(r,i))}}function Iu(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(e,t,n,r){const i=Math.sin(n);return e*(Math.sin((1-r)*n)/i)+t*(Math.sin(r*n)/i)}(e.a[t],e.b[t],e.angle,ke(n,0,1))+e.center[t]}function ku(e){if(e.z<=1)return Au[e.z+2*e.y+e.x];const t=Du(Lu(e));return Uc.fromPoints(t)}function Mu(e,t,n){return k(e,e,1-n),M(e,e,t,n)}function Ru(e,t,n){for(const r of e)B(r,r,t),k(r,r,n)}function Ou(e,t,n,r){const i=t/e.worldSize,o=e.globeMatrix;if(n.z<=1){const e=ku(n).getCorners();return Ru(e,o,i),Uc.fromPoints(e)}const s=Lu(n,r),a=Du(s,Dl+Tu(e._tileCoverLift));Ru(a,o,i);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(s.contains(e.center)){for(const e of a)P(u,u,e),I(c,c,e);c[2]=0;const t=e.point,n=[t.x*i,t.y*i,0];return P(u,u,n),I(c,c,n),new Uc(u,c)}if(e._tileCoverLift>0){for(const e of a)P(u,u,e),I(c,c,e);return new Uc(u,c)}const h=[o[12]*i,o[13]*i,o[14]*i],d=s.getCenter(),f=ke(e.center.lat,-ic,ic),p=ke(d.lat,-ic,ic),m=Jl(e.center.lng),g=Ql(f);let _=m-Jl(d.lng);const y=g-Ql(p);_>.5?_-=1:_<-.5&&(_+=1);let v=0;Math.abs(_)>Math.abs(y)?v=_>=0?1:3:(v=y>=0?0:2,M(h,h,[o[4]*i,o[5]*i,o[6]*i],-Math.sin(Ee(y>=0?s.getSouth():s.getNorth()))*Dl));const x=a[v],b=a[(v+1)%4],w=new Pu(x,b,h),S=[Iu(w,0)||x[0],Iu(w,1)||x[1],Iu(w,2)||x[2]],E=Hu(e.zoom);if(E>0){const r=function(e,t,n,r,i){let{x:o,y:s,z:a}=e;const l=1/(1<<a);let c=o*l,u=c+l,h=s*l,d=h+l,f=0;const p=(c+u)/2-r;return p>.5?f=-1:p<-.5&&(f=1),c=((c+f)*t-(r*=t))*n+r,u=((u+f)*t-r)*n+r,h=(h*t-(i*=t))*n+i,d=(d*t-i)*n+i,[[c,d,0],[u,d,0],[u,h,0],[c,h,0]]}(n,t,e._pixelsPerMercatorPixel,m,g);for(let e=0;e<a.length;e++)Mu(a[e],r[e],E);const i=T([],r[v],r[(v+1)%4]);k(i,i,.5),Mu(S,i,E)}for(const T of a)P(u,u,T),I(c,c,T);return u[2]=Math.min(x[2],b[2]),P(u,u,S),I(c,c,S),new Uc(u,c)}function Lu(e){let{x:t,y:n,z:r}=e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=1/(1<<r),s=new ql(tc(t*o),n===(1<<r)-1&&i?-90:nc((n+1)*o)),a=new ql(tc((t+1)*o),0===n&&i?90:nc(n*o));return new Xl(s,a)}function Du(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dl;const n=Ee(e.getNorth()),r=Ee(e.getSouth()),i=Math.cos(n),o=Math.cos(r),s=Math.sin(n),a=Math.sin(r),l=e.getWest(),c=e.getEast();return[Gl(o,a,l,t),Gl(o,a,c,t),Gl(i,s,c,t),Gl(i,s,l,t)]}function Nu(e,t,n,r){const i=1<<n.z,o=(e/Lr+n.x)/i;return Hl(nc((t/Lr+n.y)/i),tc(o),r)}function zu(e){let{min:t,max:n}=e;return Fl/Math.max(n[0]-t[0],n[1]-t[1],n[2]-t[2])}const Fu=new Float64Array(16);function Bu(e){const t=zu(e),n=g(Fu,[t,t,t]);return h(n,n,L([],e.min))}function ju(e){const t=(r=e.min,(n=Fu)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n);var n,r;const i=1/zu(e);return d(t,t,[i,i,i])}function Uu(e){const t=Lr/(2*Math.PI);return e/(2*Math.PI)/t}function Vu(e,t){return Lr/(512*Math.pow(2,e))*zu(ku(t))}function Gu(e,t,n,r,i){const o=Uu(n),s=[e,t,-n/(2*Math.PI)],a=l(new Float64Array(16));return h(a,a,s),d(a,a,[o,o,o]),f(a,a,Ee(-i)),p(a,a,Ee(-r)),a}function Hu(e){return Me(Nl,zl,e)}function $u(e,t){const n=Hl(t.lat,t.lng),r=function(e){const t=Hl(e._center.lat,e._center.lng);let n=z([],S(0,1,0),t);const r=_([],-e.angle,t);n=B(n,n,r),_(r,-e._pitch,n);const i=D([],t);return k(i,i,Tu(e.cameraToCenterDistance/e.pixelsPerMeter)),B(i,i,r),T([],t,i)}(e);return s=(i=A([],r,n))[0],a=i[1],l=i[2],c=(o=n)[0],u=o[1],h=o[2],f=(d=Math.sqrt(s*s+a*a+l*l)*Math.sqrt(c*c+u*u+h*h))&&N(i,o)/d,Math.acos(Math.min(Math.max(f,-1),1));var i,o,s,a,l,c,u,h,d,f}function Wu(e,t){return $u(e,t)>Math.PI/2*1.01}const qu=Ee(85),Xu=Math.cos(qu),Zu=Math.sin(qu),Ku=a(),Yu=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Ju(e,t,n,r,i,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=n.projection.upVectorScale(c,n.center.lat,n.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=i&&n.elevation?n.elevation.exaggeration()*i.getElevationAt(h.x,h.y,!0):0,f=n.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=n.projection.upVector(c,h.x,h.y);f.x+=e[0]*u*d,f.y+=e[1]*u*d,f.z+=e[2]*u*d}const p=o?h:Qu(f.x,f.y,f.z,r),m=o?e.tilespaceRays.map(e=>nh(e,d)):e.queryGeometry.screenGeometry,g=K([],[f.x,f.y,f.z,1],r);if(!s&&o?l*=g[3]/n.cameraToCenterDistance:s&&!o&&(l*=n.cameraToCenterDistance/g[3]),o){const e=nc((t.y/Lr+c.y)/(1<<c.z));l/=n.projection.pixelsPerMeter(e,1)/ec(1,e)}if(Xc(m,p,l))return!0}return!1}function Qu(e,t,n,r){const i=K([],[e,t,n,1],r);return new xe(i[0]/i[3],i[1]/i[3])}const eh=S(0,0,0),th=S(0,0,1);function nh(e,t){const n=x();return eh[2]=t,e.intersectsPlane(eh,th,n),new xe(n[0],n[1])}class rh extends Wc{}let ih,oh,sh,ah;function lh(e,t,n,r){let{width:i,height:o}=t;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return e.width=i,e.height=o,e.data=r,e}function ch(e,t,n){const{width:r,height:i}=t;r===e.width&&i===e.height||(uh(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n,null),e.width=r,e.height=i,e.data=t.data)}function uh(e,t,n,r,i,o,s,a){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const l=e.data,c=t.data,u=4===o&&a;for(let h=0;h<i.height;h++){const a=((n.y+h)*e.width+n.x)*o,d=((r.y+h)*t.width+r.x)*o;if(u)for(let e=0;e<i.width;e++){const t=a+e*o+3,n=d+e*o;c[n+0]=255,c[n+1]=255,c[n+2]=255,c[n+3]=l[t]}else if(s)for(let e=0;e<i.width;e++){const t=a+e*o,n=d+e*o,r=new sn(l[t+0]/255,l[t+1]/255,l[t+2]/255,l[t+3]).toNonPremultipliedRenderColor(s).toArray();c[n+0]=r[0],c[n+1]=r[1],c[n+2]=r[2],c[n+3]=r[3]}else for(let e=0;e<i.width*o;e++)c[d+e]=l[a+e]}return t}qo(rh,"HeatmapBucket",{omit:["layers"]});class hh{constructor(e,t){lh(this,e,1,t)}resize(e){ch(this,new hh(e),1)}clone(){return new hh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){uh(e,t,n,r,i,1,null)}}class dh{constructor(e,t){lh(this,e,4,t)}resize(e){ch(this,new dh(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new dh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i,o,s){uh(e,t,n,r,i,4,o,s)}}class fh{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}function ph(e){const t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new dh({width:n,height:r}),o=(n,r,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t),a=s?s.toNonPremultipliedRenderColor(null):null;a&&(i.data[n+r+0]=Math.floor(255*a.r),i.data[n+r+1]=Math.floor(255*a.g),i.data[n+r+2]=Math.floor(255*a.b),i.data[n+r+3]=Math.floor(255*a.a))};if(e.clips)for(let s=0,a=0;s<r;++s,a+=4*n)for(let t=0,r=0;t<n;t++,r+=4){const i=t/(n-1),{start:l,end:c}=e.clips[s];o(a,r,l*(1-i)+c*i)}else for(let s=0,a=0;s<n;s++,a+=4)o(0,a,s/(n-1));return i}qo(hh,"AlphaImage"),qo(dh,"RGBAImage");const mh=ta([{name:"a_pos",components:2,type:"Int16"}],4),gh=ta([{name:"a_road_z_offset",components:1,type:"Float32"}],4),_h=ta([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),yh=ta([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function vh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=t&&t.length,i=r?t[0]*n:e.length;let o=xh(e,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c;if(r&&(o=function(e,t,n,r){const i=[];for(let o=0,s=t.length;o<s;o++){const n=xh(e,t[o]*r,o<s-1?t[o+1]*r:e.length,r,!1);n===n.next&&(n.steiner=!0),i.push(Mh(n))}i.sort(Ch);for(let o=0;o<i.length;o++)n=Ph(i[o],n);return n}(e,t,o,n)),e.length>80*n){a=e[0],l=e[1];let t=a,r=l;for(let o=n;o<i;o+=n){const n=e[o],i=e[o+1];n<a&&(a=n),i<l&&(l=i),n>t&&(t=n),i>r&&(r=i)}c=Math.max(t-a,r-l),c=0!==c?32767/c:0}return wh(o,s,n,a,l,c,0),s}function xh(e,t,n,r,i){let o;if(i===function(e,t,n,r){let i=0;for(let o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,n,r)>0)for(let s=t;s<n;s+=r)o=Vh(s/r|0,e[s],e[s+1],o);else for(let s=n-r;s>=t;s-=r)o=Vh(s/r|0,e[s],e[s+1],o);return o&&Nh(o,o.next)&&(Gh(o),o=o.next),o}function bh(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Nh(r,r.next)&&0!==Dh(r.prev,r,r.next))r=r.next;else{if(Gh(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function wh(e,t,n,r,i,o,s){if(!e)return;!s&&o&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=kh(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n=1;do{let r,i=e;e=null;let o=null;for(t=0;i;){t++;let s=i,a=0;for(let e=0;e<n&&(a++,s=s.nextZ,s);e++);let l=n;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||i.z<=s.z)?(r=i,i=i.nextZ,a--):(r=s,s=s.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=s}o.nextZ=null,n*=2}while(t>1)}(i)}(e,r,i,o);let a=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(o?Eh(e,r,i,o):Sh(e))t.push(l.i,e.i,c.i),Gh(e),e=c.next,a=c.next;else if((e=c)===a){s?1===s?wh(e=Th(bh(e),t),t,n,r,i,o,2):2===s&&Ah(e,t,n,r,i,o):wh(bh(e),t,n,r,i,o,1);break}}}function Sh(e){const t=e.prev,n=e,r=e.next;if(Dh(t,n,r)>=0)return!1;const i=t.x,o=n.x,s=r.x,a=t.y,l=n.y,c=r.y,u=Math.min(i,o,s),h=Math.min(a,l,c),d=Math.max(i,o,s),f=Math.max(a,l,c);let p=r.next;for(;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&Oh(i,a,o,l,s,c,p.x,p.y)&&Dh(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Eh(e,t,n,r){const i=e.prev,o=e,s=e.next;if(Dh(i,o,s)>=0)return!1;const a=i.x,l=o.x,c=s.x,u=i.y,h=o.y,d=s.y,f=Math.min(a,l,c),p=Math.min(u,h,d),m=Math.max(a,l,c),g=Math.max(u,h,d),_=kh(f,p,t,n,r),y=kh(m,g,t,n,r);let v=e.prevZ,x=e.nextZ;for(;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==i&&v!==s&&Oh(a,u,l,h,c,d,v.x,v.y)&&Dh(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==s&&Oh(a,u,l,h,c,d,x.x,x.y)&&Dh(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==i&&v!==s&&Oh(a,u,l,h,c,d,v.x,v.y)&&Dh(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==s&&Oh(a,u,l,h,c,d,x.x,x.y)&&Dh(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Th(e,t){let n=e;do{const r=n.prev,i=n.next.next;!Nh(r,i)&&zh(r,n,n.next,i)&&jh(r,i)&&jh(i,r)&&(t.push(r.i,n.i,i.i),Gh(n),Gh(n.next),n=e=i),n=n.next}while(n!==e);return bh(n)}function Ah(e,t,n,r,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Lh(s,e)){let a=Uh(s,e);return s=bh(s,s.next),a=bh(a,a.next),wh(s,t,n,r,i,o,0),void wh(a,t,n,r,i,o,0)}e=e.next}s=s.next}while(s!==e)}function Ch(e,t){let n=e.x-t.x;return 0===n&&(n=e.y-t.y,0===n)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Ph(e,t){const n=function(e,t){let n=t;const r=e.x,i=e.y;let o,s=-1/0;if(Nh(e,n))return n;do{if(Nh(e,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s&&(s=e,o=n.x<n.next.x?n:n.next,e===r))return o}n=n.next}while(n!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;n=o;do{if(r>=n.x&&n.x>=l&&r!==n.x&&Rh(i<c?r:s,i,l,c,i<c?s:r,i,n.x,n.y)){const t=Math.abs(i-n.y)/(r-n.x);jh(n,e)&&(t<u||t===u&&(n.x>o.x||n.x===o.x&&Ih(o,n)))&&(o=n,u=t)}n=n.next}while(n!==a);return o}(e,t);if(!n)return t;const r=Uh(n,e);return bh(r,r.next),bh(n,n.next)}function Ih(e,t){return Dh(e.prev,e,t.prev)<0&&Dh(t.next,e,e.next)<0}function kh(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Mh(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Rh(e,t,n,r,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(i-s)*(r-a)}function Oh(e,t,n,r,i,o,s,a){return!(e===s&&t===a)&&Rh(e,t,n,r,i,o,s,a)}function Lh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&zh(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(jh(e,t)&&jh(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Dh(e.prev,e,t.prev)||Dh(e,t.prev,t))||Nh(e,t)&&Dh(e.prev,e,e.next)>0&&Dh(t.prev,t,t.next)>0)}function Dh(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Nh(e,t){return e.x===t.x&&e.y===t.y}function zh(e,t,n,r){const i=Bh(Dh(e,t,n)),o=Bh(Dh(e,t,r)),s=Bh(Dh(n,r,e)),a=Bh(Dh(n,r,t));return i!==o&&s!==a||!(0!==i||!Fh(e,n,t))||!(0!==o||!Fh(e,r,t))||!(0!==s||!Fh(n,e,r))||!(0!==a||!Fh(n,t,r))}function Fh(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Bh(e){return e>0?1:e<0?-1:0}function jh(e,t){return Dh(e.prev,e,e.next)<0?Dh(e,t,e.next)>=0&&Dh(e,e.prev,t)>=0:Dh(e,t,e.prev)<0||Dh(e,e.next,t)<0}function Uh(e,t){const n=Hh(e.i,e.x,e.y),r=Hh(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Vh(e,t,n,r){const i=Hh(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Gh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Hh(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $h(e,t){const n=e.length;if(n<=1)return[e];const r=[];let i,o;for(let s=0;s<n;s++){const t=We(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(i&&r.push(i),i=[e[s]]):i.push(e[s]))}if(i&&r.push(i),t>1)for(let s=0;s<r.length;s++)r[s].length<=t||(nr(r[s],t,1,r[s].length-1,Wh),r[s]=r[s].slice(0,t));return r}function Wh(e,t){return t.area-e.area}function qh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!e)return null;const r="string"==typeof e?zn.from(e).getPrimary():e.getPrimary(),i="string"==typeof e?null:e.getSecondary();for(const o of[r,i]){if(!o)continue;const e=o.id.toString();t.has(e)||t.set(e,[]),o.scaleSelf(n),t.get(e).push(o)}return{primary:r.toString(),secondary:i?i.toString():null}}function Xh(e,t,n,r){const i=r.patternDependencies;let o=!1;for(const s of t){const t=s.paint.get(`${e}-pattern`);t.isConstant()||(o=!0),qh(t.constantOr(null),i,n)&&(o=!0)}return o}function Zh(e,t,n,r,i,o){const s=o.patternDependencies;for(const a of t){const t=a.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r},n,{},o.availableImages);e=e&&e.name?e.name:e;const l=qh(e,s,i);if(!l)continue;const{primary:c,secondary:u}=l;c&&(n.patterns[a.id]=[c,u].filter(Boolean))}}return n}class Kh{constructor(){this.polygons=new Map}add(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.polygons.has(e)?this.polygons.get(e).push(...n):this.polygons.set(e,n)}merge(e){for(const[t,n]of e.polygons)this.add(t,...n)}}class Yh{constructor(){this.portals=[]}static evaluate(e){if(0===e.length)return new Yh;let t=[];for(const l of e)t.push(...l.portals);if(0===t.length)return new Yh;const n=(e,t)=>e<=0&&t<=0||e>=Lr&&t>=Lr;for(const l of t){const e=l.va,t=l.vb;(n(e.x,t.x)||n(e.y,t.y))&&(l.type="border")}const r=t.filter(e=>"unevaluated"!==e.type),i=t.filter(e=>"unevaluated"===e.type);if(0===i.length)return new Yh;i.sort((e,t)=>e.hash===t.hash?e.isTunnel===t.isTunnel?0:e.isTunnel?-1:1:e.hash<t.hash?1:-1),t=r.concat(i);let o=r.length,s=o,a=o;do{if(s++,s===t.length||t[o].hash!==t[s].hash){if(s-o==2){a<o&&(t[a]=t[o],t[o]=null);const e=t[a],n=t[s-1];e.type=e.isTunnel!==n.isTunnel?"tunnel":"polygon",e.connection={a:e.connection.a,b:n.connection.a},a++}o=s}}while(o!==t.length);return t.splice(a),t.sort((e,t)=>e.hash<t.hash?1:-1),{portals:t}}}qo(Yh,"ElevationPortalGraph"),qo(Kh,"ElevationPolygons");class Jh{constructor(e,t,n){this.outPositions=e,this.outNormals=t,this.outIndices=n,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,t,n){let r=e[2];null!=n&&(r*=n);const i=this.getVec3Bits(e)<<96n|this.getVec3Bits(t),o=this.vertexLookup.get(i);if(null!=o)return o;const s=this.outPositions.length;this.vertexLookup.set(i,s);const a=Math.trunc(16384*t[0]),l=Math.trunc(16384*t[1]),c=Math.trunc(16384*t[2]);return this.outPositions.emplaceBack(e[0],e[1],r),this.outNormals.emplaceBack(a,l,c),s}addTriangle(e,t,n){this.outIndices.emplaceBack(e,t,n)}addTriangles(e,t,n){if(0===e.length)return;const r=1===n.length,i=x(),o=x();for(let s=0;s<e.length;s+=3){const a=t[e[s+0]],l=t[e[s+1]],c=t[e[s+2]],u=r?n[0]:n[e[s+1]],h=r?n[0]:n[e[s+2]];E(i,a.x,a.y,r?n[0]:n[e[s+0]]);const d=this.addVertex(i,o);E(i,l.x,l.y,u);const f=this.addVertex(i,o);E(i,c.x,c.y,h);const p=this.addVertex(i,o);this.outIndices.emplaceBack(d,f,p)}}addQuad(e,t,n,r,i,o){const s=this.addVertex(e,i,o),a=this.addVertex(t,i,o),l=this.addVertex(n,i,o),c=this.addVertex(r,i,o);this.addTriangle(s,a,l),this.addTriangle(l,c,s)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Qh{constructor(e,t,n,r){this.unevaluatedPortals=new Yh,this.portalPolygons=new Kh,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new aa,this.vertexNormals=new la,this.indexArray=new Ea,this.tileToMeters=lc(e),this.bridgeProgramConfigurations=new Il(t,{zoom:n,lut:r},e=>"fill-tunnel-structure-color"!==e),this.tunnelProgramConfigurations=new Il(t,{zoom:n,lut:r},e=>"fill-bridge-guard-rail-color"!==e)}addVertices(e,t){const n=this.unevalVertices.length;for(let r=0;r<e.length;r++)this.unevalVertices.push(e[r]),this.unevalHeights.push(t[r]);return n}addTriangles(e,t,n){const r=n?this.unevalTunnelTriangles:this.unevalTriangles;for(const i of e)r.push(i+t)}addRenderableRing(e,t,n,r,i,o){const s=[new xe(i.min.x,i.min.y),new xe(i.max.x,i.min.y),new xe(i.max.x,i.max.y),new xe(i.min.x,i.max.y)];for(let a=0;a<n-1;a++){const n=t+a,l=n+1,c=this.unevalVertices[n],u=this.unevalVertices[l];if(!(c.x>=i.min.x&&c.x<=i.max.x&&c.y>=i.min.y&&c.y<=i.max.y||u.x>=i.min.x&&u.x<=i.max.x&&u.y>=i.min.y&&u.y<=i.max.y||su(c,u,s)))continue;if(this.isOnBorder(c.x,u.x)||this.isOnBorder(c.y,u.y))continue;const h=Qh.computeEdgeHash(this.unevalVertices[n],this.unevalVertices[l]);let d,f=this.vertexHashLookup.get(Qh.computePosHash(c));null!=f?d=f.next:(f=this.vertexHashLookup.get(Qh.computePosHash(u)),d=null!=f?f.prev:h),this.unevalEdges.push({polygonIdx:e,a:n,b:l,hash:h,portalHash:d,isTunnel:r,type:"unevaluated",featureInfo:o})}}addPortalCandidates(e,t,n,r,i){if(0===t.length)return;this.portalPolygons.add(e,{geometry:t,zLevel:i});const o=t[0];this.vertexHashLookup.clear();let s=Qh.computeEdgeHash(o[o.length-2],o[o.length-1]);for(let a=0;a<o.length-1;a++){const t=o[a+0],i=o[a+1],l=ae(i.x-t.x,i.y-t.y),c=he(l);if(0===c)continue;let u="unevaluated";const h=r.pointElevation(t),d=r.pointElevation(i);Math.abs(h)<.01&&Math.abs(d)<.01?u="entrance":(this.isOnBorder(t.x,i.x)||this.isOnBorder(t.y,i.y))&&(u="border");const f=Qh.computeEdgeHash(t,i);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:t,vb:i,vab:l,length:c,hash:f,isTunnel:n,type:u});const p=Qh.computePosHash(t);this.vertexHashLookup.set(p,{prev:s,next:f}),s=f}}construct(e){if(0===this.unevalVertices.length)return;const t=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),n=e=>{e.primitiveLength=this.indexArray.length-e.primitiveOffset},r=new Jh(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const i=t(),o=t(),s=t(),a=(e,t)=>{e.sort((e,n)=>e.type===t&&n.type!==t?-1:e.type!==t&&n.type===t?1:0);const n=e.findIndex(e=>e.type!==t);return n>=0?n:e.length};let l=0;this.unevalEdges.length>0&&(l=a(this.unevalEdges,"none"),this.constructBridgeStructures(r,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},this.tileToMeters)),n(s);const c=t(),u=t();if(this.unevalEdges.length>0){const e=this.unevalEdges.splice(l),t=a(e,"tunnel")+l;this.unevalEdges.push(...e),this.constructTunnelStructures(r,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},{min:l,max:t})}n(c),r.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),n(u),r.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),n(o),r.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),n(i),this.maskSegments=tl.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength),this.depthSegments=tl.simpleSegment(0,o.primitiveOffset,0,o.primitiveLength),this.renderableBridgeSegments=tl.simpleSegment(0,s.primitiveOffset,0,s.primitiveLength),this.renderableTunnelSegments=tl.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength),this.shadowCasterSegments=tl.simpleSegment(0,i.primitiveOffset,0,i.primitiveLength)}update(e,t,n,r,i,o,s,a){this.bridgeProgramConfigurations.updatePaintArrays(e,t,i,n,r,o,s,a),this.tunnelProgramConfigurations.updatePaintArrays(e,t,i,n,r,o,s,a)}upload(e){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,_h.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,yh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,t,n,r,i){const o=(o,s)=>{for(let a=0;a<s.length-1;a++){const l=s[a].featureIndex,c=s[a+1].vertexStart,u=e.feature(l);o.populatePaintArrays(c,u,l,{},n,t,r,void 0,i)}};o(this.bridgeProgramConfigurations,this.bridgeFeatureSections),o(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,t,n,r,i){const o=new Map;for(let s=r;s<i;s++){const r=n[s],i=r.a,a=r.b,l=Qh.computePosHash(e[i]),c=Qh.computePosHash(e[a]);let u=o.get(l);u||(u={},o.set(l,u));let h=o.get(c);h||(h={},o.set(c,h)),t[i]<=0&&t[a]<=0||(u.to=a,h.from=i)}return o}isTerminalVertex(e,t){const n=Qh.computePosHash(this.unevalVertices[e]),r=t.get(n);return!r||!r.from||!r.to}constructBridgeStructures(e,t,n,r,i,o){e.clearVertexLookup();const s=this.computeVertexConnections(t,n,r,i.min,i.max),a=1/o,l=.5*a,c=(e,r)=>E(e,t[r].x,t[r].y,n[r]*a),u=x(),h=x(),d=x(),f=x(),p=x(),m=(e,n)=>{const r=s.get(Qh.computePosHash(t[n])),i=r.from,o=r.to;if(!i||!o)return;c(u,i),c(h,n),c(d,o),V(f),G(u,h)||(H(p,h,u),D(f,p)),G(d,h)||(H(p,d,h),T(f,f,D(p,p)));const a=W(f);return a>0?k(e,f,1/a):void 0};let g=Number.POSITIVE_INFINITY;this.sortSubarray(r,i.min,i.max,(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex);const _=x(),y=x(),v=x(),b=x(),w=x(),S=x(),A=x(),C=x(),P=x(),I=[x(),x(),x(),x()],M=[x(),x(),x(),x()],R=[{coord:new xe(0,0),height:0},{coord:new xe(0,0),height:0}],O=(e,t)=>e>t;for(let x=i.min;x<i.max;x++){const i=r[x];if(!i.featureInfo.guardRailEnabled)continue;if(!this.prepareEdgePoints(R,t,n,i,O))continue;const[c,u]=R;if(E(_,c.coord.x,c.coord.y,a*c.height),E(y,u.coord.x,u.coord.y,a*u.height),G(_,y))continue;H(v,y,_),D(v,v);const h=m(C,i.a)||v,d=m(P,i.b)||v;E(b,h[1],-h[0],0),D(b,b),E(w,d[1],-d[0],0),D(w,w),z(C,b,h),D(S,C),z(C,w,d),D(A,C),T(I[0],_,k(C,H(C,b,S),l)),T(I[1],_,k(C,T(C,b,S),l)),T(I[2],_,k(C,S,l)),I[3]=_,T(M[0],y,k(C,H(C,w,A),l)),T(M[1],y,k(C,T(C,w,A),l)),T(M[2],y,k(C,A,l)),M[3]=y,g=this.addFeatureSection(i.featureInfo.featureIndex,g,this.bridgeFeatureSections,e);const f=e.addVertex(I[0],b,o),p=e.addVertex(I[1],b,o),N=e.addVertex(M[0],w,o),F=e.addVertex(M[1],w,o);e.addTriangle(f,p,N),e.addTriangle(p,F,N);const B=e.addVertex(I[1],S,o),j=e.addVertex(I[2],S,o),U=e.addVertex(M[1],A,o),V=e.addVertex(M[2],A,o);e.addTriangle(B,j,U),e.addTriangle(j,V,U),L(b,b),L(w,w);const $=e.addVertex(I[2],b,o),W=e.addVertex(I[3],b,o),q=e.addVertex(M[2],w,o),X=e.addVertex(M[3],w,o);e.addTriangle($,W,q),e.addTriangle(W,X,q);const Z=this.isTerminalVertex(i.a,s),K=this.isTerminalVertex(i.b,s);c.height<.01&&Z&&e.addQuad(I[3],I[2],I[1],I[0],L(h,h),o),u.height<.01&&K&&e.addQuad(M[0],M[1],M[2],M[3],d,o)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,t,n,r,i,o){e.clearVertexLookup();let s=Number.POSITIVE_INFINITY;const a=(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex;this.sortSubarray(r,i.min,i.max,a),this.sortSubarray(r,o.min,o.max,a);const l=e=>D(e,e),c=[{coord:new xe(0,0),height:0},{coord:new xe(0,0),height:0}],u=(e,t)=>e<t,h=x(),d=x(),f=x(),p=x(),m=x();for(let g=i.min;g<i.max;g++){if(!this.prepareEdgePoints(c,t,n,r[g],u))continue;const[i,o]=c,a=l(E(m,-(o.coord.y-i.coord.y),o.coord.x-i.coord.x,0));s=this.addFeatureSection(r[g].featureInfo.featureIndex,s,this.tunnelFeatureSections,e),e.addQuad(E(h,i.coord.x,i.coord.y,i.height),E(d,o.coord.x,o.coord.y,o.height),E(f,o.coord.x,o.coord.y,r[g].isTunnel?-.1:0),E(p,i.coord.x,i.coord.y,r[g].isTunnel?-.1:0),a)}for(let g=o.min;g<o.max;g++){const i=r[g];i.isTunnel&&([i.a,i.b]=[i.b,i.a]);const o=t[i.a],a=t[i.b],c=l(E(m,-(a.y-o.y),a.x-o.x,0));s=this.addFeatureSection(i.featureInfo.featureIndex,s,this.tunnelFeatureSections,e),e.addQuad(E(h,a.x,a.y,0),E(d,o.x,o.y,0),E(f,o.x,o.y,n[i.a]+4),E(p,a.x,a.y,n[i.b]+4),c),e.addQuad(E(h,o.x,o.y,0),E(d,a.x,a.y,0),E(f,a.x,a.y,n[i.b]+4),E(p,o.x,o.y,n[i.a]+4),c)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,t,n,r){e.coord.x=t,e.coord.y=n,e.height=r}prepareEdgePoints(e,t,n,r,i){let o=t[r.a].x,s=t[r.a].y,a=t[r.b].x,l=t[r.b].y,c=n[r.a],u=n[r.b];const h=i(c,0),d=i(u,0);if(h&&d)return this.setElevatedPoint(e[0],o,s,c),this.setElevatedPoint(e[1],a,l,u),!0;if(!h&&!d)return!1;if(h){if(!d){const e=u/(u-c);a=un(a,o,e),l=un(l,s,e),u=un(u,c,e)}}else{const e=c/(c-u);o=un(o,a,e),s=un(s,l,e),c=un(c,u,e)}return this.setElevatedPoint(e[0],o,s,c),this.setElevatedPoint(e[1],a,l,u),!0}prepareEdges(e,t){if(0===t.length)return;t.sort((e,t)=>e.hash===t.hash?t.polygonIdx-e.polygonIdx:t.hash>e.hash?1:-1);let n=0,r=0,i=0,o=t[n].polygonIdx;do{r++,(r===t.length||t[n].hash!==t[r].hash)&&((1==r-n||t[r-1].polygonIdx!==o)&&(i<n&&(t[i]=t[n],t[n]=null),t[i].type="none",i++),n=r,n!==t.length&&(o=t[n].polygonIdx))}while(n!==t.length);if(t.splice(i),0!==t.length&&0!==e.length){t.sort((e,t)=>e.portalHash<t.portalHash?1:-1);let n=0,r=0;for(;n!==t.length&&r!==e.length;){const i=t[n],o=e[r];i.portalHash>o.hash?n++:o.hash>i.portalHash?r++:(i.type=o.type,n++)}}}isOnBorder(e,t){return e<=0&&t<=0||e>=Lr&&t>=Lr}addFeatureSection(e,t,n,r){return e!==t&&(t=e,n.push({featureIndex:e,vertexStart:r.getVertexCount()}),r.clearVertexLookup()),t}sortSubarray(e,t,n,r){const i=e.slice(t,n);i.sort(r),e.splice(t,i.length,...i)}static computeEdgeHash(e,t){return(e.y===t.y&&e.x>t.x||e.y>t.y)&&([e,t]=[t,e]),BigInt(Qh.computePosHash(e))<<32n|BigInt(Qh.computePosHash(t))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var ed,td={exports:{}},nd=(ed||(ed=1,function(e,t){!function(e){function t(e,t){return e>t?1:e<t?-1:0}var n=function(e,n){void 0===e&&(e=t),void 0===n&&(n=!1),this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!n},r={size:{configurable:!0}};function i(e,t,n,r,o){var s=o-r;if(s>0){var a=r+Math.floor(s/2),l={key:t[a],data:n[a],parent:e};return l.left=i(l,t,n,r,a),l.right=i(l,t,n,a+1,o),l}return null}function o(e,t,n,r,i){if(!(n>=r)){for(var s=e[n+r>>1],a=n-1,l=r+1;;){do{a++}while(i(e[a],s)<0);do{l--}while(i(e[l],s)>0);if(a>=l)break;var c=e[a];e[a]=e[l],e[l]=c,c=t[a],t[a]=t[l],t[l]=c}o(e,t,n,l,i),o(e,t,l+1,r,i)}}n.prototype.rotateLeft=function(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t},n.prototype.rotateRight=function(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t},n.prototype._splay=function(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}},n.prototype.splay=function(e){for(var t,n,r,i,o;e.parent;)(n=(t=e.parent).parent)&&n.parent?((r=n.parent).left===n?r.left=e:r.right=e,e.parent=r):(e.parent=null,this._root=e),i=e.left,o=e.right,e===t.left?(n&&(n.left===t?(t.right?(n.left=t.right,n.left.parent=n):n.left=null,t.right=n,n.parent=t):(i?(n.right=i,i.parent=n):n.right=null,e.left=n,n.parent=e)),o?(t.left=o,o.parent=t):t.left=null,e.right=t,t.parent=e):(n&&(n.right===t?(t.left?(n.right=t.left,n.right.parent=n):n.right=null,t.left=n,n.parent=t):(o?(n.left=o,o.parent=n):n.left=null,e.right=n,n.parent=e)),i?(t.right=i,i.parent=t):t.right=null,e.left=t,t.parent=e)},n.prototype.replace=function(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)},n.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.insert=function(e,t){var n=this._root,r=null,i=this._compare;if(this._noDuplicates)for(;n;){if(r=n,0===i(n.key,e))return;n=i(n.key,e)<0?n.right:n.left}else for(;n;)r=n,n=i(n.key,e)<0?n.right:n.left;return n={key:e,data:t,left:null,right:null,parent:r},r?i(r.key,n.key)<0?r.right=n:r.left=n:this._root=n,this.splay(n),this._size++,n},n.prototype.find=function(e){for(var t=this._root,n=this._compare;t;){var r=n(t.key,e);if(r<0)t=t.right;else{if(!(r>0))return t;t=t.left}}return null},n.prototype.contains=function(e){for(var t=this._root,n=this._compare;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},n.prototype.remove=function(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var n=this.minNode(t.right);n.parent!==t&&(this.replace(n,n.right),n.right=t.right,n.right.parent=n),this.replace(t,n),n.left=t.left,n.left.parent=n}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},n.prototype.removeNode=function(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},n.prototype.erase=function(e){var t=this.find(e);if(t){this.splay(t);var n=t.left,r=t.right,i=null;n&&(n.parent=null,i=this.maxNode(n),this.splay(i),this._root=i),r&&(n?i.right=r:this._root=r,r.parent=i),this._size--}},n.prototype.pop=function(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t},n.prototype.next=function(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t},n.prototype.prev=function(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t},n.prototype.forEach=function(e){for(var t=this._root,n=[],r=!1,i=0;!r;)t?(n.push(t),t=t.left):n.length>0?(e(t=n.pop(),i++),t=t.right):r=!0;return this},n.prototype.range=function(e,t,n,r){for(var i=[],o=this._compare,s=this._root;0!==i.length||s;)if(s)i.push(s),s=s.left;else{if(o((s=i.pop()).key,t)>0)break;if(o(s.key,e)>=0&&n.call(r,s))return this;s=s.right}return this},n.prototype.keys=function(){for(var e=this._root,t=[],n=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.key),e=e.right):r=!0;return n},n.prototype.values=function(){for(var e=this._root,t=[],n=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.data),e=e.right):r=!0;return n},n.prototype.at=function(e){for(var t=this._root,n=[],r=!1,i=0;!r;)if(t)n.push(t),t=t.left;else if(n.length>0){if(t=n.pop(),i===e)return t;i++,t=t.right}else r=!0;return null},n.prototype.load=function(e,t,n){if(void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var r=e.length;return n&&o(e,t,0,r-1,this._compare),this._root=i(null,e,t,0,r),this._size=r,this},n.prototype.min=function(){var e=this.minNode(this._root);return e?e.key:null},n.prototype.max=function(){var e=this.maxNode(this._root);return e?e.key:null},n.prototype.isEmpty=function(){return null===this._root},r.size.get=function(){return this._size},n.createTree=function(e,t,r,i,o){return new n(r,o).load(e,t,i)},Object.defineProperties(n.prototype,r);var s=0,a=1,l=2,c=3,u=0,h=1,d=2,f=3;function p(e,t,n){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!m(t,n)||t.isVertical()?t.prevInResult:t));var r=m(e,n);e.resultTransition=r?function(e,t){var n,r=!e.inOut,i=!e.otherInOut;switch(t){case u:n=r&&i;break;case h:n=r||i;break;case f:n=r^i;break;case d:n=e.isSubject?r&&!i:i&&!r}return n?1:-1}(e,n):0}function m(e,t){switch(e.type){case s:switch(t){case u:return!e.otherInOut;case h:return e.otherInOut;case d:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case f:return!0}break;case l:return t===u||t===h;case c:return t===d;case a:return!1}return!1}var g=function(e,t,n,r,i){this.left=t,this.point=e,this.otherEvent=n,this.isSubject=r,this.type=i||s,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},_={inResult:{configurable:!0}};function y(e,t){return e[0]===t[0]&&e[1]===t[1]}g.prototype.isBelow=function(e){var t=this.point,n=this.otherEvent.point;return this.left?(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])>0:(n[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(n[1]-e[1])>0},g.prototype.isAbove=function(e){return!this.isBelow(e)},g.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},_.inResult.get=function(){return 0!==this.resultTransition},g.prototype.clone=function(){var e=new g(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e},Object.defineProperties(g.prototype,_);var v=11102230246251565e-32,x=134217729,b=(3+8*v)*v;function w(e,t,n,r,i){var o,s,a,l,c=t[0],u=r[0],h=0,d=0;u>c==u>-c?(o=c,c=t[++h]):(o=u,u=r[++d]);var f=0;if(h<e&&d<n)for(u>c==u>-c?(a=o-((s=c+o)-c),c=t[++h]):(a=o-((s=u+o)-u),u=r[++d]),o=s,0!==a&&(i[f++]=a);h<e&&d<n;)u>c==u>-c?(a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h]):(a=o-((s=o+u)-(l=s-o))+(u-l),u=r[++d]),o=s,0!==a&&(i[f++]=a);for(;h<e;)a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h],o=s,0!==a&&(i[f++]=a);for(;d<n;)a=o-((s=o+u)-(l=s-o))+(u-l),u=r[++d],o=s,0!==a&&(i[f++]=a);return 0===o&&0!==f||(i[f++]=o),f}function S(e){return new Float64Array(e)}var E=33306690738754716e-32,T=22204460492503146e-32,A=11093356479670487e-47,C=S(4),P=S(8),I=S(12),k=S(16),M=S(4);function R(e,t,n){var r=function(e,t,n,r,i,o){var s=(t-o)*(n-i),a=(e-i)*(r-o),l=s-a;if(0===s||0===a||s>0!=a>0)return l;var c=Math.abs(s+a);return Math.abs(l)>=E*c?l:-function(e,t,n,r,i,o,s){var a,l,c,u,h,d,f,p,m,g,_,y,v,S,E,R,O,L,D=e-i,N=n-i,z=t-o,F=r-o;C[0]=(E=(p=D-(f=(d=x*D)-(d-D)))*(g=F-(m=(d=x*F)-(d-F)))-((S=D*F)-f*m-p*m-f*g))-((_=E-(O=(p=z-(f=(d=x*z)-(d-z)))*(g=N-(m=(d=x*N)-(d-N)))-((R=z*N)-f*m-p*m-f*g)))+(h=E-_))+(h-O),C[1]=(v=S-((y=S+_)-(h=y-S))+(_-h))-((_=v-R)+(h=v-_))+(h-R),C[2]=y-((L=y+_)-(h=L-y))+(_-h),C[3]=L;var B=function(e,t){for(var n=t[0],r=1;r<4;r++)n+=t[r];return n}(0,C),j=T*s;if(B>=j||-B>=j)return B;if(a=e-(D+(h=e-D))+(h-i),c=n-(N+(h=n-N))+(h-i),l=t-(z+(h=t-z))+(h-o),u=r-(F+(h=r-F))+(h-o),0===a&&0===l&&0===c&&0===u)return B;if(j=A*s+b*Math.abs(B),(B+=D*u+F*a-(z*c+N*l))>=j||-B>=j)return B;M[0]=(E=(p=a-(f=(d=x*a)-(d-a)))*(g=F-(m=(d=x*F)-(d-F)))-((S=a*F)-f*m-p*m-f*g))-((_=E-(O=(p=l-(f=(d=x*l)-(d-l)))*(g=N-(m=(d=x*N)-(d-N)))-((R=l*N)-f*m-p*m-f*g)))+(h=E-_))+(h-O),M[1]=(v=S-((y=S+_)-(h=y-S))+(_-h))-((_=v-R)+(h=v-_))+(h-R),M[2]=y-((L=y+_)-(h=L-y))+(_-h),M[3]=L;var U=w(4,C,4,M,P);M[0]=(E=(p=D-(f=(d=x*D)-(d-D)))*(g=u-(m=(d=x*u)-(d-u)))-((S=D*u)-f*m-p*m-f*g))-((_=E-(O=(p=z-(f=(d=x*z)-(d-z)))*(g=c-(m=(d=x*c)-(d-c)))-((R=z*c)-f*m-p*m-f*g)))+(h=E-_))+(h-O),M[1]=(v=S-((y=S+_)-(h=y-S))+(_-h))-((_=v-R)+(h=v-_))+(h-R),M[2]=y-((L=y+_)-(h=L-y))+(_-h),M[3]=L;var V=w(U,P,4,M,I);M[0]=(E=(p=a-(f=(d=x*a)-(d-a)))*(g=u-(m=(d=x*u)-(d-u)))-((S=a*u)-f*m-p*m-f*g))-((_=E-(O=(p=l-(f=(d=x*l)-(d-l)))*(g=c-(m=(d=x*c)-(d-c)))-((R=l*c)-f*m-p*m-f*g)))+(h=E-_))+(h-O),M[1]=(v=S-((y=S+_)-(h=y-S))+(_-h))-((_=v-R)+(h=v-_))+(h-R),M[2]=y-((L=y+_)-(h=L-y))+(_-h),M[3]=L;var G=w(V,I,4,M,k);return k[G-1]}(e,t,n,r,i,o,c)}(e[0],e[1],t[0],t[1],n[0],n[1]);return r>0?-1:r<0?1:0}function O(e,t){var n=e.point,r=t.point;return n[0]>r[0]?1:n[0]<r[0]?-1:n[1]!==r[1]?n[1]>r[1]?1:-1:function(e,t,n){return e.left!==t.left?e.left?1:-1:0!==R(n,e.otherEvent.point,t.otherEvent.point)?e.isBelow(t.otherEvent.point)?-1:1:!e.isSubject&&t.isSubject?1:-1}(e,t,n)}function L(e,t,n){var r=new g(t,!1,e,e.isSubject),i=new g(t,!0,e.otherEvent,e.isSubject);return y(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),r.contourId=i.contourId=e.contourId,O(i,e.otherEvent)>0&&(e.otherEvent.left=!0,i.left=!1),e.otherEvent.otherEvent=i,e.otherEvent=r,n.push(i),n.push(r),n}function D(e,t){return e[0]*t[1]-e[1]*t[0]}function N(e,t){return e[0]*t[0]+e[1]*t[1]}function z(e,t,n){var r=function(e,t,n,r){var i=[t[0]-e[0],t[1]-e[1]],o=[r[0]-n[0],r[1]-n[1]];function s(e,t,n){return[e[0]+t*n[0],e[1]+t*n[1]]}var a=[n[0]-e[0],n[1]-e[1]],l=D(i,o),c=l*l,u=N(i,i);if(c>0){var h=D(a,o)/l;if(h<0||h>1)return null;var d=D(a,i)/l;return d<0||d>1?null:0===h||1===h?[s(e,h,i)]:0===d||1===d?[s(n,d,o)]:[s(e,h,i)]}if((c=(l=D(a,i))*l)>0)return null;var f=N(i,a)/u,p=f+N(i,o)/u,m=Math.min(f,p),g=Math.max(f,p);return m<=1&&g>=0?1===m?[s(e,m>0?m:0,i)]:0===g?[s(e,g<1?g:1,i)]:[s(e,m>0?m:0,i),s(e,g<1?g:1,i)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),i=r?r.length:0;if(0===i)return 0;if(1===i&&(y(e.point,t.point)||y(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===i&&e.isSubject===t.isSubject)return 0;if(1===i)return y(e.point,r[0])||y(e.otherEvent.point,r[0])||L(e,r[0],n),y(t.point,r[0])||y(t.otherEvent.point,r[0])||L(t,r[0],n),1;var o=[],s=!1,u=!1;return y(e.point,t.point)?s=!0:1===O(e,t)?o.push(t,e):o.push(e,t),y(e.otherEvent.point,t.otherEvent.point)?u=!0:1===O(e.otherEvent,t.otherEvent)?o.push(t.otherEvent,e.otherEvent):o.push(e.otherEvent,t.otherEvent),s&&u||s?(t.type=a,e.type=t.inOut===e.inOut?l:c,s&&!u&&L(o[1].otherEvent,o[0].point,n),2):u?(L(o[0],o[1].point,n),3):o[0]!==o[3].otherEvent?(L(o[0],o[1].point,n),L(o[1],o[2].point,n),3):(L(o[0],o[1].point,n),L(o[3].otherEvent,o[2].point,n),3)}function F(e,t){if(e===t)return 0;if(0!==R(e.point,e.otherEvent.point,t.point)||0!==R(e.point,e.otherEvent.point,t.otherEvent.point))return y(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===O(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;var n=e.point,r=t.point;return n[0]===r[0]&&n[1]===r[1]?(n=e.otherEvent.point)[0]===(r=t.otherEvent.point)[0]&&n[1]===r[1]?0:e.contourId>t.contourId?1:-1:1===O(e,t)?1:-1}var B=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function j(e,t,n,r){var i,o=e+1,s=t[e].point,a=t.length;for(o<a&&(i=t[o].point);o<a&&i[0]===s[0]&&i[1]===s[1];){if(!n[o])return o;++o<a&&(i=t[o].point)}for(o=e-1;n[o]&&o>r;)o--;return o}B.prototype.isExterior=function(){return null==this.holeOf};var U=G,V=G;function G(e,t){if(!(this instanceof G))return new G(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||H,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function H(e,t){return e<t?-1:e>t?1:0}G.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,r=t[e];e>0;){var i=e-1>>1,o=t[i];if(n(r,o)>=0)break;t[e]=o,e=i}t[e]=r},_down:function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&n(t[s],a)<0&&(o=s,a=t[s]),n(a,i)>=0)break;t[e]=a,e=o}t[e]=i}},U.default=V;var $=Math.max,W=Math.min,q=0;function X(e,t,n,r,i,o){var s,a,l,c,u,h;for(s=0,a=e.length-1;s<a;s++)if(c=e[s+1],u=new g(l=e[s],!1,void 0,t),h=new g(c,!1,u,t),u.otherEvent=h,l[0]!==c[0]||l[1]!==c[1]){u.contourId=h.contourId=n,o||(u.isExteriorRing=!1,h.isExteriorRing=!1),O(u,h)>0?h.left=!0:u.left=!0;var d=l[0],f=l[1];i[0]=W(i[0],d),i[1]=W(i[1],f),i[2]=$(i[2],d),i[3]=$(i[3],f),r.push(u),r.push(h)}}var Z=[];function K(e,t,r){"number"==typeof e[0][0][0]&&(e=[e]),"number"==typeof t[0][0][0]&&(t=[t]);var i=function(e,t,n){var r=null;return e.length*t.length==0&&(n===u?r=Z:n===d?r=e:n!==h&&n!==f||(r=0===e.length?t:e)),r}(e,t,r);if(i)return i===Z?null:i;var o=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=function(e,t,n,r,i){var o,s,a,l,c,u,h=new U(null,O);for(a=0,l=e.length;a<l;a++)for(c=0,u=(o=e[a]).length;c<u;c++)(s=0===c)&&q++,X(o[c],!0,q,h,n,s);for(a=0,l=t.length;a<l;a++)for(c=0,u=(o=t[a]).length;c<u;c++)s=0===c,i===d&&(s=!1),s&&q++,X(o[c],!1,q,h,r,s);return h}(e,t,o,s,r);if(i=function(e,t,n,r,i){var o=null;return(n[0]>r[2]||r[0]>n[2]||n[1]>r[3]||r[1]>n[3])&&(i===u?o=Z:i===d?o=e:i!==h&&i!==f||(o=e.concat(t))),o}(e,t,o,s,r))return i===Z?null:i;for(var l=function(e){var t,n,r=function(e){var t,n,r,i,o=[];for(n=0,r=e.length;n<r;n++)((t=e[n]).left&&t.inResult||!t.left&&t.otherEvent.inResult)&&o.push(t);for(var s=!1;!s;)for(s=!0,n=0,r=o.length;n<r;n++)n+1<r&&1===O(o[n],o[n+1])&&(i=o[n],o[n]=o[n+1],o[n+1]=i,s=!1);for(n=0,r=o.length;n<r;n++)(t=o[n]).otherPos=n;for(n=0,r=o.length;n<r;n++)(t=o[n]).left||(i=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=i);return o}(e),i={},o=[],s=function(){if(!i[t]){var e=o.length,n=function(e,t,n){var r=new B;if(null!=e.prevInResult){var i=e.prevInResult,o=i.outputContourId;if(i.resultTransition>0){var s=t[o];if(null!=s.holeOf){var a=s.holeOf;t[a].holeIds.push(n),r.holeOf=a,r.depth=t[o].depth}else t[o].holeIds.push(n),r.holeOf=o,r.depth=t[o].depth+1}else r.holeOf=null,r.depth=t[o].depth}else r.holeOf=null,r.depth=0;return r}(r[t],o,e),s=function(t){i[t]=!0,t<r.length&&r[t]&&(r[t].outputContourId=e)},a=t,l=t;for(n.points.push(r[t].point);s(a),s(a=r[a].otherPos),n.points.push(r[a].point),!((a=j(a,r,i,l))==l||a>=r.length)&&r[a];);o.push(n)}};for(t=0,n=r.length;t<n;t++)s();return o}(function(e,t,r,i,o,s){for(var a,l,c,h=new n(F),f=[],m=Math.min(i[2],o[2]);0!==e.length;){var g=e.pop();if(f.push(g),s===u&&g.point[0]>m||s===d&&g.point[0]>i[2])break;if(g.left){l=a=h.insert(g),a=a!==(c=h.minNode())?h.prev(a):null,l=h.next(l);var _=a?a.key:null;if(p(g,_,s),l&&2===z(g,l.key,e)&&(p(g,_,s),p(l.key,g,s)),a&&2===z(a.key,g,e)){var y=a;p(_,(y=y!==c?h.prev(y):null)?y.key:null,s),p(g,_,s)}}else l=a=h.find(g=g.otherEvent),a&&l&&(a=a!==c?h.prev(a):null,l=h.next(l),h.remove(g),l&&a&&z(a.key,l.key,e))}return f}(a,0,0,o,s,r)),c=[],m=0;m<l.length;m++){var g=l[m];if(g.isExterior()){for(var _=[g.points],y=0;y<g.holeIds.length;y++)_.push(l[g.holeIds[y]].points);c.push(_)}}return c}var Y={UNION:h,DIFFERENCE:d,INTERSECTION:u,XOR:f};e.diff=function(e,t){return K(e,t,d)},e.intersection=function(e,t){return K(e,t,u)},e.operations=Y,e.union=function(e,t){return K(e,t,h)},e.xor=function(e,t){return K(e,t,f)},Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,td.exports)),td.exports);function rd(e,t,n,r){const i=[],o=0===r?(e,t,n,r,i,o)=>{e.push(new xe(o,n+(o-t)/(r-t)*(i-n)))}:(e,t,n,r,i,o)=>{e.push(new xe(t+(o-n)/(i-n)*(r-t),o))};for(const s of e){const e=[];for(const i of s){if(i.length<=2)continue;const s=[];for(let e=0;e<i.length-1;e++){const a=i[e].x,l=i[e].y,c=i[e+1].x,u=i[e+1].y,h=0===r?a:l,d=0===r?c:u;h<t?d>t&&o(s,a,l,c,u,t):h>n?d<n&&o(s,a,l,c,u,n):s.push(i[e]),d<t&&h>=t&&o(s,a,l,c,u,t),d>n&&h<=n&&o(s,a,l,c,u,n)}let a=i[i.length-1];const l=0===r?a.x:a.y;l>=t&&l<=n&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),e.push(s))}e.length&&i.push(e)}return i}function id(e,t){const n=sd(e),r=sd([t]),i=nd.intersection(n,r);return null==i?[]:ad(i)}function od(e,t){const n=65536;let r=sd(e,n);for(;t.valid();t.next()){const[e,i]=t.get(),o=e.x*n,s=e.y*n,a=i.x*n,l=i.y*n,c=a-o,u=l-s,h=Math.hypot(c,u),d=Math.trunc(u/h*3),f=-Math.trunc(c/h*3);r=nd.diff(r,[[[o,s],[a,l],[a+d,l+f],[o+d,s+f],[o,s]]])}return ad(r,1/n)}function sd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[e.map(e=>e.map(e=>[e.x*t,e.y*t]))]}function ad(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.map(e=>e.map((e,n)=>{const r=e.map(e=>new xe(e[0]*t,e[1]*t).round());return n>0&&r.reverse(),r}))}class ld{constructor(e,t){this.layoutVertexArray=new ra,this.indexArray=new Ea,this.lineIndexArray=new va,this.triangleSegments=new tl,this.lineSegments=new tl,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,t&&(this.elevatedLayoutVertexArray=new sa)}update(e,t,n,r,i,o,s,a){this.programConfigurations.updatePaintArrays(e,t,i,n,r,o,s,a)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,gh.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,t,n,r,i,o,s){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,t,n,r,i,o,void 0,s)}}class cd{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new ld(e,!1),this.elevationBufferData=new ld(e,!0),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,r){this.hasPattern=Xh("fill",this.layers,this.pixelRatio,t);const i=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=yc(s,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),u,n))continue;const h=i?i.evaluate(u,{},n,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:_c(s,n,r),patterns:{},sortKey:h};o.push(d)}i&&o.sort((e,t)=>e.sortKey-t.sortKey);for(const s of o){const{geometry:r,index:i,sourceLayerIndex:o}=s;if(this.hasPattern){const e=Zh("fill",this.layers,s,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(s,r,i,n,{},t.availableImages,t.brightness,t.elevationFeatures);t.featureIndex.insert(e[i].feature,r,i,o,this.index)}}update(e,t,n,r,i,o,s){this.bufferData.update(e,t,n,r,i,o,s,this.worldview),this.elevationBufferData.update(e,t,n,r,i,o,s,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,t,n,r,i,o,s,this.worldview)}addFeatures(e,t,n,r,i,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,n,r,o,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;const l=$h(t,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(e,l,r,n,a):this.addGeometry(l,this.bufferData),this.bufferData.populatePaintArrays(e,n,i,o,r,s,this.worldview),this.elevationBufferData.populatePaintArrays(e,n,i,o,r,s,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,t,n,r,i){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(t,n,r,i,this.worldview))}addElevatedRoadFeature(e,t,n,r,i){const o=new Array,s=Hc.getElevationFeature(e,i);if(!s)return void this.addGeometry(t,this.bufferData);{const e=this.clipPolygonsToTile(t,1);e.length>0&&o.push({polygons:e,elevationFeature:s,elevationTileID:n})}const a={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},n),featureIndex:r};for(const l of o)if(l.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new Qh(l.elevationTileID,this.layers,this.zoom,this.lut));const t=l.elevationFeature.isTunnel();let n=0;e.properties.hasOwnProperty(Cc)&&(n=+e.properties[Cc]);for(const e of l.polygons)this.elevatedStructures.addPortalCandidates(l.elevationFeature.id,e,t,l.elevationFeature,n)}null==l.elevationFeature.constantHeight&&(l.polygons=this.prepareElevatedPolygons(l.polygons,l.elevationFeature,l.elevationTileID));const t=new $c(n,l.elevationTileID);this.addElevatedGeometry(l.polygons,t,l.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,r,a)}}addElevatedGeometry(e,t,n,r,i,o){const s={elevation:n,elevationSampler:t,bias:r,index:i,featureInfo:o},[a,l]=this.addGeometry(e,this.elevationBufferData,s);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:a,max:l}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,a),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,l))}addGeometry(e,t,n){let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=null;n&&(o=n.elevationSampler.constantElevation(n.elevation,n.bias),null!=o&&(r=o,i=o));const s=(e,s,a)=>{if(null!=n)if(s.push(e),null!=o)t.elevatedLayoutVertexArray.emplaceBack(o),a.push(o);else{const o=n.elevationSampler.pointElevation(e,n.elevation,n.bias);t.elevatedLayoutVertexArray.emplaceBack(o),a.push(o),r=Math.min(r,o),i=Math.max(i,o)}};for(const a of e){let e=0;for(const t of a)e+=t.length;const r=t.triangleSegments.prepareSegment(e,t.layoutVertexArray,t.indexArray),i=r.vertexLength,o=[],l=[],c=[],u=[],h=[],d=t.layoutVertexArray.length;for(const p of a){if(0===p.length)continue;p!==a[0]&&l.push(o.length/2);const e=t.lineSegments.prepareSegment(p.length,t.layoutVertexArray,t.lineIndexArray),r=e.vertexLength;n&&h.push(t.layoutVertexArray.length-d),s(p[0],c,u),t.layoutVertexArray.emplaceBack(p[0].x,p[0].y),t.lineIndexArray.emplaceBack(r+p.length-1,r),o.push(p[0].x),o.push(p[0].y);for(let n=1;n<p.length;n++)s(p[n],c,u),t.layoutVertexArray.emplaceBack(p[n].x,p[n].y),t.lineIndexArray.emplaceBack(r+n-1,r+n),o.push(p[n].x),o.push(p[n].y);e.vertexLength+=p.length,e.primitiveLength+=p.length}const f=vh(o,l);for(let n=0;n<f.length;n+=3)t.indexArray.emplaceBack(i+f[n],i+f[n+1],i+f[n+2]);if(f.length>0&&n&&"hd-road-base"===this.elevationMode){const e=n.elevation.isTunnel(),t=n.elevation.safeArea,r=this.elevatedStructures.addVertices(c,u);this.elevatedStructures.addTriangles(f,r,e);const i=h.length;if(i>0){for(let o=0;o<i-1;o++)this.elevatedStructures.addRenderableRing(n.index,h[o]+r,h[o+1]-h[o],e,t,n.featureInfo);this.elevatedStructures.addRenderableRing(n.index,h[i-1]+r,c.length-h[i-1],e,t,n.featureInfo)}}r.vertexLength+=e,r.primitiveLength+=f.length/3}return[r,i]}prepareElevatedPolygons(e,t,n){const r=1/lc(n),i=[];for(const o of e){const e=od(o,new Vc(t,r));i.push(...e)}return i}clipPolygonsToTile(e,t){const n=-t,r=-t,i=Lr+t,o=Lr+t;let s=0;const a=[],l=[];for(;s<e.length;s++){const t=e[s],c=dr(t);(c.min.x>=n&&c.max.x<=i&&c.min.y>=r&&c.max.y<=o?a:l).push(t)}if(a.length===e.length)return e;const c=[new xe(n,r),new xe(i,r),new xe(i,o),new xe(n,o),new xe(n,r)],u=a;for(const h of l)u.push(...id(h,c));return u}}let ud,hd,dd,fd;qo(cd,"FillBucket",{omit:["layers","patternFeatures"]}),qo(ld,"FillBufferData"),qo(Qh,"ElevatedStructures");class pd{constructor(e,t,n,r){if(this.triangleCount=t.length/3,this.min=new xe(0,0),this.max=new xe(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[i,o]=[e[0].clone(),e[0].clone()];for(let u=1;u<e.length;++u){const t=e[u];i.x=Math.min(i.x,t.x),i.y=Math.min(i.y,t.y),o.x=Math.max(o.x,t.x),o.y=Math.max(o.y,t.y)}if(r){const e=Math.ceil(Math.max(o.x-i.x,o.y-i.y)/r);n=Math.max(n,e)}if(0===n)return;this.min=i,this.max=o;const s=this.max.sub(this.min);s.x=Math.max(s.x,1),s.y=Math.max(s.y,1);const a=Math.max(s.x,s.y)/n;this.cellsX=Math.max(1,Math.ceil(s.x/a)),this.cellsY=Math.max(1,Math.ceil(s.y/a)),this.xScale=1/a,this.yScale=1/a;const l=[];for(let u=0;u<this.triangleCount;u++){const n=e[t[3*u+0]].sub(this.min),r=e[t[3*u+1]].sub(this.min),i=e[t[3*u+2]].sub(this.min),o=md(Math.floor(Math.min(n.x,r.x,i.x)),this.xScale,this.cellsX),s=md(Math.floor(Math.max(n.x,r.x,i.x)),this.xScale,this.cellsX),c=md(Math.floor(Math.min(n.y,r.y,i.y)),this.yScale,this.cellsY),h=md(Math.floor(Math.max(n.y,r.y,i.y)),this.yScale,this.cellsY),d=new xe(0,0),f=new xe(0,0),p=new xe(0,0),m=new xe(0,0);for(let e=c;e<=h;++e){d.y=f.y=e*a,p.y=m.y=(e+1)*a;for(let t=o;t<=s;++t)d.x=p.x=t*a,f.x=m.x=(t+1)*a,(lu(n,r,i,d,f,m)||lu(n,r,i,d,m,p))&&l.push({cellIdx:e*this.cellsX+t,triIdx:u})}}if(0===l.length)return;l.sort((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx);let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,t){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const n=md(e.x-this.min.x,this.xScale,this.cellsX),r=md(e.y-this.min.y,this.yScale,this.cellsY),i=this.cells[r*this.cellsX+n];if(i){this._lazyInitLookup();for(let e=0;e<i.len;e++){const n=this.payload[i.start+e],r=Math.floor(n/8),o=1<<n%8;if(!(this.lookup[r]&o)&&(this.lookup[r]|=o,t.push(n),t.length===this.triangleCount))return}}}query(e,t,n){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this._lazyInitLookup();const r=md(e.x-this.min.x,this.xScale,this.cellsX),i=md(t.x-this.min.x,this.xScale,this.cellsX),o=md(e.y-this.min.y,this.yScale,this.cellsY),s=md(t.y-this.min.y,this.yScale,this.cellsY);for(let a=o;a<=s;a++)for(let e=r;e<=i;e++){const t=this.cells[a*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const r=this.payload[t.start+e],i=Math.floor(r/8),o=1<<r%8;if(!(this.lookup[i]&o)&&(this.lookup[i]|=o,n.push(r),n.length===this.triangleCount))return}}}}function md(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}qo(pd,"TriangleGridIndex");class gd{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,t){for(const n of this.footprints)t.push({footprint:n,id:e})}populate(e,t,n,r){const i=[];for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(o,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),t,n))continue;const c={id:s,properties:o.properties,type:o.type,sourceLayerIndex:l,index:a,geometry:e?t.geometry:_c(o,n,r),patterns:{}};i.push(c)}for(const o of i){const{geometry:r,index:i,sourceLayerIndex:s}=o;this.addFeature(o,r,i,n,{},t.availableImages,t.brightness),t.featureIndex.insert(e[i].feature,r,i,s,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,t,n,r,i,o,s){}destroy(){}addFeature(e,t,n,r,i){for(const o of $h(t,2)){const e=[],t=[],n=[],r=new xe(1/0,1/0),i=new xe(-1/0,-1/0);for(const l of o)if(0!==l.length){l!==o[0]&&n.push(t.length/2);for(let n=0;n<l.length;n++)t.push(l[n].x),t.push(l[n].y),e.push(l[n]),r.x=Math.min(r.x,l[n].x),r.y=Math.min(r.y,l[n].y),i.x=Math.max(i.x,l[n].x),i.y=Math.max(i.y,l[n].y)}const s=vh(t,n),a=new pd(e,s,8,256);this.footprints.push({vertices:e,indices:s,grid:a,min:r,max:i})}}}qo(gd,"ClipBucket",{omit:["layers"]});const _d=ta([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),yd=ta([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),vd=ta([{name:"a_centroid_pos",components:2,type:"Uint16"}]),xd=ta([{name:"a_join_normal_inside",components:3,type:"Int16"}]),bd=ta([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),wd=ta([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Sd}=_d,Ed=Number.MAX_SAFE_INTEGER,Td=Ed-1;function Ad(e,t,n,r){return e.order<t||e.order===Ed||!(e.clipMask&n)||function(e,t){return 0!==t.length&&void 0===t.find(t=>t===e)}(r,e.clipScope)}function Cd(e,t){return e.x-t.x||e.y-t.y}function Pd(e,t){return 0===Cd(e.min,t.min)&&0===Cd(e.max,t.max)}function Id(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function kd(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n].sourceId!==t[n].sourceId||!Pd(e[n],t[n])||e[n].order!==t[n].order||e[n].clipMask!==t[n].clipMask||!be(e[n].clipScope,t[n].clipScope))return!1;return!0}function Md(e,t,n){const r=1/Lr,i=1/(1<<n.canonical.z),o=(t.x*r+n.canonical.x)*i+n.wrap,s=(t.y*r+n.canonical.y)*i;return{min:new xe((e.x*r+n.canonical.x)*i+n.wrap,(e.y*r+n.canonical.y)*i),max:new xe(o,s)}}function Rd(e,t,n){const r=1<<n.canonical.z,i=((t.x-n.wrap)*r-n.canonical.x)*Lr,o=(t.y*r-n.canonical.y)*Lr;return{min:new xe(((e.x-n.wrap)*r-n.canonical.x)*Lr,(e.y*r-n.canonical.y)*Lr),max:new xe(i,o)}}function Od(e,t,n,r,i,o,s){const a=e.indices,l=e.vertices,c=[];for(let u=r;u<r+i;u+=3){const r=t[n[u+0]+o],i=t[n[u+1]+o],h=t[n[u+2]+o],d=Math.min(r.x,i.x,h.x),f=Math.max(r.x,i.x,h.x),p=Math.min(r.y,i.y,h.y),m=Math.max(r.y,i.y,h.y);c.length=0,e.grid.query(new xe(d,p),new xe(f,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(lu(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],r,i,h,s))return!0}}return!1}function Ld(e,t,n,r){if(!e||!n)return!1;let i=e.vertices;if(!t.canonical.equals(r.canonical)||t.wrap!==r.wrap){if(n.vertices.length<e.vertices.length)return Ld(n,r,e,t);const o=t.canonical,s=r.canonical,a=Math.pow(2,s.z-o.z);i=e.vertices.map(e=>new xe((e.x+o.x*Lr)*a-s.x*Lr,(e.y+o.y*Lr)*a-s.y*Lr))}return Od(n,i,e.indices,0,e.indices.length,0,0)}function Dd(e,t,n,r){const i=Math.pow(2,r.z-n.z);return new xe((e+n.x*Lr)*i-r.x*Lr,(t+n.y*Lr)*i-r.y*Lr)}function Nd(e,t){const n=[];t.grid.queryPoint(e,n);const r=t.indices,i=t.vertices;for(let o=0;o<n.length;o++){const t=n[o];if(iu([i[r[3*t+0]],i[r[3*t+1]],i[r[3*t+2]]],e))return!0}return!1}const zd=[new xe(0,0),new xe(Lr,0),new xe(Lr,Lr),new xe(0,Lr)];function Fd(e,t){const n=[];let r=[];if(!t||e.length<2)return[e];if(2===e.length)return su(e[0],e[1],zd)?[e]:[];for(let i=0;i<e.length+2;i++){const t=e[i%e.length],o=e[(i+1)%e.length],s=su(0===i?e[e.length-1]:e[(i-1)%e.length],t,zd),a=su(t,o,zd),l=s||a;l&&r.push(t),l&&a||r.length>0&&(r.length>1&&n.push(r),r=[])}return r.length>1&&n.push(r),n}const Bd=vc.types,jd=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Ud=["fill-extrusion-flood-light-ground-radius"],Vd=Math.pow(2,13),Gd=Math.pow(2,15)-1,Hd=new xe(0,1),$d=2147483648;function Wd(e,t,n,r,i,o,s,a){e.emplaceBack((t<<1)+s,(n<<1)+o,(Math.floor(r*Vd)<<1)+i,Math.round(a))}function qd(e,t,n){e.emplaceBack(t.x*Lr,t.y*Lr,n?1:0)}function Xd(e,t,n,r,i,o){e.emplaceBack(t.x,t.y,(n.x<<1)+r,(n.y<<1)+i,o)}function Zd(e,t,n){const r=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*r,n[1]*r,n[2]*r)}class Kd{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Yd{constructor(){this.centroidXY=new xe(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new xe(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new xe(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new xe(this.max.x-this.min.x,this.max.y-this.min.y)}}class Jd{constructor(){this.acc=new xe(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,n){this.accCount++,this.acc._add(t);let r=!!this.borders;t.x<e.min.x?(e.min.x=t.x,r=!0):t.x>e.max.x&&(e.max.x=t.x,r=!0),t.y<e.min.y?(e.min.y=t.y,r=!0):t.y>e.max.y&&(e.max.y=t.y,r=!0),((0===t.x||t.x===Lr)&&t.x===n.x)!=((0===t.y||t.y===Lr)&&t.y===n.y)&&this.processBorderOverlap(t,n),r&&this.checkBorderIntersection(t,n)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,un(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Lr!=e.x>Lr&&this.addBorderIntersection(1,un(t.y,e.y,(Lr-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,un(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Lr!=e.y>Lr&&this.addBorderIntersection(3,un(t.x,e.x,(Lr-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){return 0===this.accCount?new xe(0,0):new xe(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0):0}}function Qd(e,t){const n=e.add(t)._unit(),r=ke(e.x*n.x+e.y*n.y,-1,1);var i,o,s;return i=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(i)))/4*Gd*((o=e).x*(s=t).y-o.y*s.x<0?-1:1)}const ef=[e=>e.x<0,e=>e.x>Lr,e=>e.y<0,e=>e.y>Lr];function tf(e,t,n,r){const i=[4];if(0===r)return i;n._mult(r);const o=e.sub(n),s=t.sub(n),a=[e,t,o,s];for(let l=0;l<4;l++)for(const e of a)if(ef[l](e)){i.push(l);break}return i}class nf{constructor(e){this.vertexArray=new ca,this.indexArray=new Ea,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut},e=>Ud.includes(e)),this._segments=new tl,this.hiddenByLandmarkVertexArray=new Fa,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new tl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=e.length;if(i>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*i,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],n=e[1];a=Qd(t.sub(e[i-1])._perp()._unit(),n.sub(t)._perp()._unit())}for(let l=0;l<i;l++){const c=l===i-1?0:l+1,u=e[l],h=e[c],d=e[c===i-1?0:c+1],f=h.sub(u)._perp()._unit(),p=Qd(f,d.sub(h)._perp()._unit()),m=a,g=p;if(lf(u,h,t)||r&&cf(u,t)&&cf(h,t)){a=p;continue}const _=s.vertexLength;Xd(this.vertexArray,u,h,1,1,m),Xd(this.vertexArray,u,h,1,0,m),Xd(this.vertexArray,u,h,0,1,g),Xd(this.vertexArray,u,h,0,0,g),s.vertexLength+=4;const y=tf(u,h,f,n);for(const e of y)this._segmentToGroundQuads[o].push({id:_,region:e}),this._segmentToRegionTriCounts[o][e]+=2,s.primitiveLength+=2;a=p}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let n=0;n<t;n++)this._segmentToGroundQuads[n].sort((e,t)=>e.region-t.region);for(let n=0;n<t;n++){const t=this._segmentToGroundQuads[n],r=e[n],i=this._segmentToRegionTriCounts[n];i.reduce((e,t)=>e+t,0);let o=0;for(let e=0;e<=4;e++){const t=i[e];if(0!==t){let n=this.regionSegments[e];n||(n=this.regionSegments[e]=new tl);const i={vertexOffset:r.vertexOffset,primitiveOffset:r.primitiveOffset+o,vertexLength:r.vertexLength,primitiveLength:t};n.get().push(i)}o+=t}for(let e=0;e<t.length;e++){const n=t[e].id;this.indexArray.emplaceBack(n,n+1,n+3),this.indexArray.emplaceBack(n,n+3,n+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,n,r,i,o,s){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,n,r,i,o,void 0,s)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,yd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,n,r,i,o,s,a){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,n,r,i,o,s,a)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&$d))}updateHiddenByLandmarkRange(e,t,n){if(!this.hasData())return;const r=t+e;if(0!==t){for(let t=e;t<r;++t)this.hiddenByLandmarkVertexArray.emplace(t,n?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,bd.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class rf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ea,this.footprintVertices=new ra,this.footprintSegments=[],this.layoutVertexArray=new oa,this.centroidVertexArray=new Za,this.wallVertexArray=new Ya,this.indexArray=new Ea,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut},e=>jd.includes(e)),this.segments=new tl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.groundEffect=new nf(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,r){this.features=[],this.hasPattern=Xh("fill-extrusion",this.layers,this.pixelRatio,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=lc(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:i,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=yc(i,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),l,n))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:_c(i,n,r),properties:i.properties,type:i.type,patterns:{}},u=this.layoutVertexArray.length,h="Polygon"===Bd[c.type];if(this.hasPattern)this.features.push({featureId:i.id,feature:Zh("fill-extrusion",this.layers,c,this.zoom,this.pixelRatio,t)});else if(this.wallMode)for(const o of c.geometry)for(const e of Fd(o,h))this.addFeature(i.id,c,[e],s,n,{},t.availableImages,r,t.brightness);else this.addFeature(i.id,c,c.geometry,s,n,{},t.availableImages,r,t.brightness);t.featureIndex.insert(i,c.geometry,s,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,n,r,i,o){for(const{featureId:s,feature:a}of this.features){const e="Polygon"===Bd[a.type],{geometry:l}=a;if(this.wallMode)for(const c of l)for(const l of Fd(c,e))this.addFeature(s,a,[l],a.index,t,n,r,i,o);else this.addFeature(s,a,l,a.index,t,n,r,i,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,n,r,i,o,s){this.programConfigurations.updatePaintArrays(e,t,i,n,r,o,s,this.worldview),this.groundEffect.update(e,t,i,n,r,o,s,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,xd.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,wd.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,vd.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,r,i,o,s,a,l){const c=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,u=[new xe(0,0),new xe(Lr,Lr)],h=a.projection,d="globe"===h.name,f=this.wallMode||"Polygon"===Bd[t.type],p=new Jd;p.centroidDataIndex=this.centroidData.length;const m=new Yd;m.buildingId=e,t.properties&&t.properties.hasOwnProperty("building_id")&&(m.buildingId=t.properties.building_id);const g=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},i)<=0,_=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},i);let y;if(m.height=_,m.vertexArrayOffset=this.layoutVertexArray.length,m.groundVertexArrayOffset=this.groundEffect.vertexArray.length,d&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new pa),this.wallMode){if(d)return void He("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==n.length)return;y=function(e){const t=e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y,n=function(e){let t=0;const n=e.length;for(let r=0;r<n;r++)t+=(e[(r+1)%n].x-e[r].x)*(e[(r+1)%n].y+e[r].y);return t>=0}(e);n||(e=e.reverse());const r={geometry:[],joinNormals:[],indices:[]},i=[],o=[],s=[];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;if(a<(t?3:2))return r;let l,c,u,h,d,f=0;for(;f<a-1&&e[f].equals(e[f+1]);)f++;t&&(l=e[a-2],d=e[f].sub(l)._unit()._perp());for(let m=f;m<a;m++){if(u=m===a-1?t?e[f+1]:void 0:e[m+1],u&&e[m].equals(u))continue;d&&(h=d),l&&(c=l),l=e[m],d=u?u.sub(l)._unit()._perp():h,h=h||d;let n=h.add(d);0===n.x&&0===n.y||n._unit();const r=n.x*d.x+n.y*d.y,p=0!==r?1/r:1/0,g=h.x*d.y-h.y*d.x>0;let _="miter";const y=2;"miter"===_&&p>y&&(_="bevel"),"bevel"===_&&(p>100&&(_="flipbevel"),p<y&&(_="miter"));const v=(e,t,n,r)=>{const a=new xe(e.x,e.y),l=new xe(e.x,e.y);a.x+=t.x*r,a.y+=t.y*r,l.x-=t.x*Math.max(n,1),l.y-=t.y*Math.max(n,1),s.push(t),i.push(a),o.push(l)};if("miter"===_)n._mult(p),v(l,n,0,0);else if("flipbevel"===_)n=d.mult(-1),v(l,n,0,0),v(l,n.mult(-1),0,0);else{const e=-Math.sqrt(p*p-1),t=g?e:0,n=g?0:e;c&&v(l,h,t,n),u&&v(l,d,t,n)}}r.geometry=[...i,...o.reverse(),i[0]],r.joinNormals=[...s,...s.reverse(),s[s.length-1]];const p=r.geometry.length-1;for(let m=0;m<p/2;m++)if(m+1<p/2){let e=m,t=m+1,n=p-1-m,i=p-2-m;e=0===e?p-1:e-1,t=0===t?p-1:t-1,n=0===n?p-1:n-1,i=0===i?p-1:i-1,r.indices.push(n),r.indices.push(t),r.indices.push(e),r.indices.push(n),r.indices.push(i),r.indices.push(t)}return r}(n[0]),n=[y.geometry]}const v=(e,t)=>e<(t.length-1)/2||e===t.length-1,x=this.wallMode?[n]:$h(n,500);for(let A=x.length-1;A>=0;A--){const e=x[A];(0===e.length||(b=e[0]).every(e=>e.x<=0)||b.every(e=>e.x>=Lr)||b.every(e=>e.y<=0)||b.every(e=>e.y>=Lr))&&x.splice(A,1)}var b;let w;if(d)w=ff(x,u,i);else{w=[];for(const e of x)w.push({polygon:e,bounds:u})}const S=f?this.edgeRadius:0,E=S>0&&this.zoom<17,T=(e,t)=>{if(0===e.length)return!1;const n=e[e.length-1];return t.x===n.x&&t.y===n.y};for(const{polygon:A,bounds:C}of w){let e=0,t=0;for(const i of A)f&&!i[0].equals(i[i.length-1])&&i.push(i[0]),t+=f?i.length-1:i.length;const n=this.segments.prepareSegment((f?5:4)*t,this.layoutVertexArray,this.indexArray);m.footprintSegIdx<0&&(m.footprintSegIdx=this.footprintSegments.length),m.polygonSegIdx<0&&(m.polygonSegIdx=this.polygonSegments.length);const r={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},o=new Kd;if(o.vertexOffset=this.footprintVertices.length,o.indexOffset=3*this.footprintIndices.length,o.ringIndices=[],f){const t=[],r=[];e=n.vertexLength;for(let e=0;e<A.length;e++){const s=A[e];s.length&&0!==e&&r.push(t.length/2);const a=[];let l,u;l=s[1].sub(s[0])._perp()._unit(),o.ringIndices.push(s.length-1);for(let e=1;e<s.length;e++){const r=s[e],o=s[e===s.length-1?1:e+1],c=r.clone();if(S){u=o.sub(r)._perp()._unit();const e=l.add(u)._unit(),t=S*Math.min(4,1/(l.x*e.x+l.y*e.y));c.x+=t*e.x,c.y+=t*e.y,c.x=Math.round(c.x),c.y=Math.round(c.y),l=u}if(!g||0!==S&&!E||T(a,c)||a.push(c),Wd(this.layoutVertexArray,c.x,c.y,0,0,1,1,0),this.wallMode){const t=v(e,s);qd(this.wallVertexArray,y.joinNormals[e],!t)}n.vertexLength++,this.footprintVertices.emplaceBack(r.x,r.y),t.push(r.x,r.y),d&&Zd(this.layoutVertexExtArray,h.projectTilePoint(c.x,c.y,i),h.upVector(i,c.x,c.y))}g&&(0===S||E)&&(0!==a.length&&T(a,a[0])&&a.pop(),this.groundEffect.addData(a,C,c))}const s=this.wallMode?y.indices:vh(t,r);for(let i=0;i<s.length;i+=3)this.footprintIndices.emplaceBack(o.vertexOffset+s[i+0],o.vertexOffset+s[i+1],o.vertexOffset+s[i+2]),this.indexArray.emplaceBack(e+s[i],e+s[i+2],e+s[i+1]),n.primitiveLength++;o.indexCount+=s.length,o.vertexCount+=this.footprintVertices.length-o.vertexOffset}for(let s=0;s<A.length;s++){const t=A[s];p.startRing(m,t[0]);let r=t.length>4&&uf(t[t.length-2],t[0],t[1]),o=S?sf(t[t.length-2],t[0],t[1],S):0;const a=[];let l,u,_;u=t[1].sub(t[0])._perp()._unit();let x=!0;for(let s=1,c=0;s<t.length;s++){let f=t[s-1],b=t[s];const w=t[s===t.length-1?1:s+1];if(p.appendEdge(m,b,f),lf(b,f,C)){S&&(u=w.sub(b)._perp()._unit(),x=!x);continue}const E=b.sub(f)._perp(),A=E.x/(Math.abs(E.x)+Math.abs(E.y)),P=E.y>0?1:0,I=f.dist(b);if(c+I>32768&&(c=0),S){_=w.sub(b)._perp()._unit();let e=af(f,b,w,of(u,_),S);isNaN(e)&&(e=0);const t=b.sub(f)._unit();f=f.add(t.mult(o))._round(),b=b.add(t.mult(-e))._round(),o=e,u=_,g&&this.zoom>=17&&(T(a,f)||a.push(f),T(a,b)||a.push(b))}const k=n.vertexLength,M=t.length>4&&uf(f,b,w);let R=hf(c,r,x);if(Wd(this.layoutVertexArray,f.x,f.y,A,P,0,0,R),Wd(this.layoutVertexArray,f.x,f.y,A,P,0,1,R),this.wallMode){const e=v(s-1,t),n=y.joinNormals[s-1];qd(this.wallVertexArray,n,e),qd(this.wallVertexArray,n,e)}if(c+=I,R=hf(c,M,!x),r=M,Wd(this.layoutVertexArray,b.x,b.y,A,P,0,0,R),Wd(this.layoutVertexArray,b.x,b.y,A,P,0,1,R),this.wallMode){const e=v(s,t),n=y.joinNormals[s];qd(this.wallVertexArray,n,e),qd(this.wallVertexArray,n,e)}if(n.vertexLength+=4,this.indexArray.emplaceBack(k+0,k+1,k+2),this.indexArray.emplaceBack(k+1,k+3,k+2),n.primitiveLength+=2,S){const r=e+(1===s?t.length-2:s-2),i=1===s?e:r+1;if(this.indexArray.emplaceBack(k+1,r,k+3),this.indexArray.emplaceBack(r,i,k+3),n.primitiveLength+=2,void 0===l&&(l=k),!lf(w,t[s],C)){const e=s===t.length-1?l:n.vertexLength;this.indexArray.emplaceBack(k+2,k+3,e),this.indexArray.emplaceBack(k+3,e+1,e),this.indexArray.emplaceBack(k+3,i,e+1),n.primitiveLength+=3}x=!x}if(d){const e=this.layoutVertexExtArray,t=h.projectTilePoint(f.x,f.y,i),n=h.projectTilePoint(b.x,b.y,i),r=h.upVector(i,f.x,f.y),o=h.upVector(i,b.x,b.y);Zd(e,t,r),Zd(e,t,r),Zd(e,n,o),Zd(e,n,o)}}f&&(e+=t.length-1),g&&S&&this.zoom>=17&&(0!==a.length&&T(a,a[0])&&a.pop(),this.groundEffect.addData(a,C,c,S>0))}this.footprintSegments.push(o),r.triangleCount=this.indexArray.length-r.triangleArrayOffset,this.polygonSegments.push(r),++m.footprintSegLen,++m.polygonSegLen}if(m.vertexCount=this.layoutVertexArray.length-m.vertexArrayOffset,m.groundVertexCount=this.groundEffect.vertexArray.length-m.groundVertexArrayOffset,0!==m.vertexCount){if(m.centroidXY=p.borders?Hd:this.encodeCentroid(p,m),this.centroidData.push(m),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,o,s,i,l,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(t,r,o,s,i,l,this.worldview),this.maxHeight=Math.max(this.maxHeight,_)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}splitToSubtiles(){const e=[];for(let s=0;s<this.centroidData.length;s++){const t=this.centroidData[s],n=+(t.min.y+t.max.y>Lr),r=2*n+(+(t.min.x+t.max.x>Lr)^n);for(let i=0;i<t.polygonSegLen;i++){const n=t.polygonSegIdx+i;e.push({centroidIdx:s,subtile:r,polygonSegmentIdx:n,triangleSegmentIdx:this.polygonSegments[n].triangleSegIdx})}}const t=new Ea;e.sort((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx);let n=0,r=0,i=0;for(const s of e){if(s.triangleSegmentIdx!==n)break;i++}const o=e.length;for(;r!==e.length;){n=e[r].triangleSegmentIdx;let s=0,a=r,l=r;for(let t=a;t<i&&e[t].subtile===s;t++)l++;for(;a!==i;){const r=e[a];s=r.subtile;const o=this.centroidData[r.centroidIdx].min.clone(),c=this.centroidData[r.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let n=a;n<l;n++){const r=e[n],i=this.polygonSegments[r.polygonSegmentIdx],s=this.centroidData[r.centroidIdx].min,a=this.centroidData[r.centroidIdx].max,l=this.indexArray.uint16;for(let e=i.triangleArrayOffset;e<i.triangleArrayOffset+i.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=i.triangleCount,o.x=Math.min(o.x,s.x),o.y=Math.min(o.y,s.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),a=l;for(let t=a;t<i&&e[t].subtile===e[a].subtile;t++)l++}r=i;for(let t=r;t<o&&e[t].triangleSegmentIdx===e[r].triangleSegmentIdx;t++)i++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,n){const r=new tl;if(this.wallMode){for(const e of this.triangleSubSegments)r.segments.push(e.segment);return r}let i=0,o=0;const s=1<<e.canonical.z;if(t){const n=t.getMinMaxForTile(e);n&&(i=n.min,o=n.max)}o+=this.maxHeight;const a=e.toUnwrapped();let l;const c=[a.canonical.x/s+a.wrap,a.canonical.y/s],u=[(a.canonical.x+1)/s+a.wrap,(a.canonical.y+1)/s],h=(e,t,n)=>[e[0]*(1-n[0])+t[0]*n[0],e[1]*(1-n[1])+t[1]*n[1]],d=[],f=[];for(const p of this.triangleSubSegments){d[0]=p.min.x/Lr,d[1]=p.min.y/Lr,f[0]=p.max.x/Lr,f[1]=p.max.y/Lr;const e=h(c,u,d),t=h(c,u,f);if(0===new Uc([e[0],e[1],i],[t[0],t[1],o]).intersectsPrecise(n)){l&&(r.segments.push(l),l=void 0);continue}const s=p.segment;l&&l.vertexOffset!==s.vertexOffset&&(r.segments.push(l),l=void 0),l?(l.vertexLength+=s.vertexLength,l.primitiveLength+=s.primitiveLength):l={vertexOffset:s.vertexOffset,primitiveLength:s.primitiveLength,vertexLength:s.vertexLength,primitiveOffset:s.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&r.segments.push(l),r}encodeCentroid(e,t){const n=e.centroid(),r=t.span(),i=Math.min(7,Math.round(r.x*this.tileToMeter/10)),o=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new xe(ke(n.x,1,Lr-1)<<3|i,ke(n.y,1,Lr-1)<<3|o)}encodeBorderCentroid(e){if(!e.borders)return new xe(0,0);const t=e.borders,n=Number.MAX_VALUE;if(t[0][0]!==n||t[1][0]!==n){const e=t[0][0]!==n?0:1;return new xe(6|(t[0][0]!==n?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==n?2:3;return new xe((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==n?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=2147483647,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,r=e.flags&$d?Hd:e.centroidXY,i=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==r.y||i!==r.x){for(let e=t;e<n;++e)this.centroidVertexArray.emplace(e,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t,n){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());if(kd(this.activeReplacements,r))return;if(this.activeReplacements=r,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const o of this.centroidData)o.flags&=2147483647;const i=[];for(const o of this.activeReplacements){if(o.order<n)continue;const t=Math.max(1,Math.pow(2,o.footprintTileId.canonical.z-e.canonical.z));if(o.footprint.buildingId){const e=o.footprint.buildingId;for(const t of this.centroidData)t.buildingId===e&&(t.flags|=$d)}else for(const n of this.centroidData)if(!(n.flags&$d||o.min.x>n.max.x||n.min.x>o.max.x||o.min.y>n.max.y||n.min.y>o.max.y))for(let r=0;r<n.footprintSegLen;r++){const s=this.footprintSegments[n.footprintSegIdx+r];if(i.length=0,pf(this.footprintVertices,s.vertexOffset,s.vertexCount,o.footprintTileId.canonical,e.canonical,i),Od(o.footprint,i,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-t)){n.flags|=$d;break}}}for(const o of this.centroidData)this.writeCentroidToBuffer(o);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,n){let r=!1;for(let i=0;i<n.footprintSegLen;i++){const o=this.footprintSegments[n.footprintSegIdx+i];let s=0;for(const n of o.ringIndices){for(let i=s,a=n+s-1;i<n+s;a=i++){const n=this.footprintVertices.int16[2*(i+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(i+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>t!=l>t&&e<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-n)*(t-s)/(l-s)+n&&(r=!r)}s=n}}return r}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,r=!0;const i=4*(e+Lr)*Lr+(t+Lr);if(this.partLookup.hasOwnProperty(i)){const e=this.partLookup[i];return e?{height:e.height,hidden:!!(e.flags&$d)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||o.height<=n||this.footprintContainsPoint(e,t,o)&&(n=o.height,this.partLookup[i]=o,r=!!(o.flags&$d));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:r};this.partLookup[i]=void 0}}function of(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function sf(e,t,n,r){const i=t.sub(e)._perp()._unit(),o=n.sub(t)._perp()._unit();return af(e,t,n,of(i,o),r)}function af(e,t,n,r,i){const o=Math.sqrt(1-r*r);return Math.min(e.dist(t)/3,t.dist(n)/3,i*o/r)}function lf(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function cf(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function uf(e,t,n){if(e.x<0||e.x>=Lr||t.x<0||t.x>=Lr||n.x<0||n.x>=Lr)return!1;const r=n.sub(t),i=r.perp(),o=e.sub(t);return(r.x*o.x+r.y*o.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(o.x*o.x+o.y*o.y))>-.866&&i.x*o.x+i.y*o.y<0}function hf(e,t,n){const r=t?2|e:-3&e;return n?1|r:-2&r}function df(){const e=Math.PI/32,t=Math.tan(e),n=$l;return n*Math.sqrt(1+2*t*t)-n}function ff(e,t,n){const r=1<<n.z,i=tc(n.x/r),o=tc((n.x+1)/r),s=nc(n.y/r),a=nc((n.y+1)/r);return function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;const s=[];if(!e.length||!n||!r)return s;const a=(e,t)=>{for(const n of e)s.push({polygon:n,bounds:t})},l=Math.ceil(Math.log2(n)),c=Math.ceil(Math.log2(r)),u=l-c,h=[];for(let p=0;p<Math.abs(u);p++)h.push(u>0?0:1);for(let p=0;p<Math.min(l,c);p++)h.push(0),h.push(1);let d=e;if(d=rd(d,t[0].y-i,t[1].y+i,1),d=rd(d,t[0].x-i,t[1].x+i,0),!d.length)return s;const f=[];for(h.length?f.push({polygons:d,bounds:t,depth:0}):a(d,t);f.length;){const e=f.pop(),t=e.depth,n=h[t],r=e.bounds[0],s=e.bounds[1],l=0===n?r.x:r.y,c=0===n?s.x:s.y,u=o?o(n,l,c):.5*(l+c),d=rd(e.polygons,l-i,u+i,n),p=rd(e.polygons,u-i,c+i,n);if(d.length){const e=[r,new xe(0===n?u:s.x,1===n?u:s.y)];h.length>t+1?f.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(p.length){const e=[new xe(0===n?u:r.x,1===n?u:r.y),s];h.length>t+1?f.push({polygons:p,bounds:e,depth:t+1}):a(p,e)}}return s}(e,t,Math.ceil((o-i)/11.25),Math.ceil((s-a)/11.25),1,(e,t,i)=>{if(0===e)return.5*(t+i);{const e=nc((n.y+t/Lr)/r);return(Ql(.5*(nc((n.y+i/Lr)/r)+e))*r-n.y)*Lr}})}function pf(e,t,n,r,i,o){const s=Math.pow(2,r.z-i.z);for(let a=0;a<n;a++){let n=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];n=(n+i.x*Lr)*s-r.x*Lr,l=(l+i.y*Lr)*s-r.y*Lr,o.push(new xe(n,l))}}let mf,gf;qo(rf,"FillExtrusionBucket",{omit:["layers","features"]}),qo(Yd,"PartData"),qo(Kd,"FootprintSegment"),qo(Jd,"BorderCentroidData"),qo(nf,"GroundEffect");class _f extends xe{constructor(e,t,n){super(e,t),this.z=n}}class yf extends _f{constructor(e,t,n,r){super(e,t,n),this.w=r}}function vf(e,t,n,r){const i="x"===n?"y":"x",o=(r-e[n])/(t[n]-e[n]);e[i]=Math.round(e[i]+(t[i]-e[i])*o),e[n]=r,e.hasOwnProperty("z")&&(e.z=un(e.z,t.z,o)),e.hasOwnProperty("w")&&(e.w=un(e.w,t.w,o))}function xf(e,t,n,r){const i=n,o=r;for(const s of["x","y"]){let n=e,r=t;n[s]>=r[s]&&(n=t,r=e),n[s]<i&&r[s]>i&&vf(n,r,s,i),n[s]<o&&r[s]>o&&vf(r,n,s,o)}}function bf(e,t,n,r,i,o){const s=[];for(let a=0;a<e.length;a++){const l=e[a];let c;const u=s.length;let h=0;for(let e=0;e<l.length-1;e++){let u=l[e],d=l[e+1],f=0;const p=h;let m,g;o&&(f=Math.hypot(d.x-u.x,d.y-u.y),h+=f,m=u,g=d),u.x<t&&d.x<t||(u.x<t?u=new xe(t,u.y+(t-u.x)/(d.x-u.x)*(d.y-u.y))._round():d.x<t&&(d=new xe(t,u.y+(t-u.x)/(d.x-u.x)*(d.y-u.y))._round()),u.y<n&&d.y<n||(u.y<n?u=new xe(u.x+(n-u.y)/(d.y-u.y)*(d.x-u.x),n)._round():d.y<n&&(d=new xe(u.x+(n-u.y)/(d.y-u.y)*(d.x-u.x),n)._round()),u.x>=r&&d.x>=r||(u.x>=r?u=new xe(r,u.y+(r-u.x)/(d.x-u.x)*(d.y-u.y))._round():d.x>=r&&(d=new xe(r,u.y+(r-u.x)/(d.x-u.x)*(d.y-u.y))._round()),u.y>=i&&d.y>=i||(u.y>=i?u=new xe(u.x+(i-u.y)/(d.y-u.y)*(d.x-u.x),i)._round():d.y>=i&&(d=new xe(u.x+(i-u.y)/(d.y-u.y)*(d.x-u.x),i)._round()),c&&u.equals(c[c.length-1])||(c=[u],s.push(c),o&&o.push({progress:{min:p+Sf(m,g,u)*f,max:1},parentIndex:a,prevPoint:m,nextPoint:g})),c.push(d),o&&(o[o.length-1].progress.max=p+Sf(m,g,d)*f,o[o.length-1].nextPoint=g)))))}if(o&&h>0)for(let e=u;e<s.length;e++)o[e].progress.min/=h,o[e].progress.max/=h}return s}function wf(e,t,n,r,i){if(e.length<2)return void r.push(e);const o=[];for(;t.valid();){const[n,r]=t.get();for(let t=0;t<e.length-1;t++){const i=e[t],s=e[t+1],a=eu(i,s,n,r);if(a){const[e]=a,n=new xe(un(i.x,s.x,e),un(i.y,s.y,e));o.push({t:t+e,distance:0,point:n})}}t.next()}if(0===o.length)return void r.push(e);o.sort((e,t)=>e.t-t.t);let s=0,a=0,l=[];for(r.push(l);s!==e.length;){if(a===o.length){for(;s!==e.length;)0!==l.length&&l[l.length-1].equals(e[s])||l.push(e[s]),s++;break}o[a].t<=s?(0!==l.length&&l[l.length-1].equals(o[a].point)||l.push(o[a].point),Math.trunc(o[a].t),a++):(0!==l.length&&l[l.length-1].equals(e[s])||l.push(e[s]),s++)}}function Sf(e,t,n){return e.x!==t.x?(n.x-e.x)/(t.x-e.x):e.y!==t.y?(n.y-e.y)/(t.y-e.y):0}function Ef(e,t){return e.x*t.x+e.y*t.y}function Tf(e,t){if(1===e.length){let n=0;const r=t[n++];let i;for(;!i||r.equals(i);)if(i=t[n++],!i)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=i.sub(r),l=o.sub(r),c=s.sub(r),u=Ef(a,a),h=Ef(a,l),d=Ef(l,l),f=Ef(c,a),p=Ef(c,l),m=u*d-h*h,g=(d*f-h*p)/m,_=(u*p-h*f)/m,y=r.z*(1-g-_)+i.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function Af(e,t,n,r,i,o,s,a){const l=s*i.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,n){const r=Math.floor(t[0]/8),i=Math.floor(t[1]/8),o=10*(t[0]-8*r),s=10*(t[1]-8*i),a=e.getElevationAt(r,i,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(r,i),d=2*c+1,f=2*u+1,p=function(e,t,n,r,i){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+i,n,!0),e.getElevationAtPixel(t,n+i,!0),e.getElevationAtPixel(t+r,n+i,!0)]}(e,h.x-c,h.y-u,d,f),m=Math.abs(p[0]-p[1]),g=Math.abs(p[2]-p[3]),_=Math.abs(p[0]-p[2])+Math.abs(p[1]-p[3]),y=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*_/f);return a+Math.max(y*o,v*s)}(i,o,a):l;return{base:l+(0===n?-1:n),top:c?Math.max(u+r,l+n+2):l+r}}class Cf{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Pf{constructor(){this.tasks={},this.taskQueue=[],Fe(["process"],this),this.invoker=new Cf(this.process),this.nextId=0}add(e,t){const n=this.nextId++,r=function(e){let{type:t,isSymbolTile:n,zoom:r}=e;return r=r||0,"message"===t?0:"maybePrepare"!==t||n?"parseTile"!==t||n?"parseTile"===t&&n?300-r:"maybePrepare"===t&&n?400-r:500:200-r:100-r}(t);if(0===r){try{e()}finally{}return null}return this.tasks[n]={fn:e,metadata:t,priority:r,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let r=0;r<this.taskQueue.length;r++){const n=this.tasks[this.taskQueue[r]];n.priority<t&&(t=n.priority,e=r)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class If{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Fe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Pf}send(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);const a=new Set;return this.target.postMessage({id:s,type:e,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Ko(t,a)},a),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){const t=e.data;if(!t)return;const n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||Xe(self)){const e=this.callbacks[n],r=this.scheduler.add(()=>this.processTask(n,t),e&&e.metadata||{type:"message"});r&&(this.cancelCallbacks[n]=r)}else this.processTask(n,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(Yo(t.error)):n(null,Yo(t.data)))}else{const n=new Set,r=t.hasCallback?(t,r)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Ko(t):null,data:Ko(r,n)},n)}:()=>{},i=Yo(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,i,r);else if(this.parent.getWorkerSource){const e=t.type.split("."),{source:n,scope:o}=i;this.parent.getWorkerSource(t.sourceMapId,e[0],n,o)[e[1]](i,r)}else r(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var kf={workerUrl:"",workerClass:null,workerParams:void 0};const Mf="mapboxgl_preloaded_worker_pool";class Rf{constructor(){this.active={}}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rf.workerCount;if(!this.workers)for(this.workers=[];this.workers.length<t;)this.workers.push(null!=kf.workerClass?new kf.workerClass:new self.Worker(kf.workerUrl,kf.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mf]}numActive(){return Object.keys(this.active).length}}Rf.workerCount=2;class Of{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Worker",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Rf.workerCount;this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ne();const i=this.workerPool.acquire(this.id,r);for(let o=0;o<i.length;o++){const e=new Of.Actor(i[o],t,this.id);e.name=`${n} ${o}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,t,n){Oe(this.actors,(n,r)=>{n.send(e,t,r)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Lf,Df;function Nf(){return Lf||(Lf=new Rf),Lf}Of.Actor=If;class zf{constructor(e){this.module=e}createIntArray(e){const t=new Int32Array(e),n=this.module.malloc(t.length*t.BYTES_PER_ELEMENT);return this.module.heap32.set(t,n/t.BYTES_PER_ELEMENT),n}createFloatArray(e){const t=new Float32Array(e),n=this.module.malloc(t.length*t.BYTES_PER_ELEMENT);return this.module.heapF32.set(t,n/t.BYTES_PER_ELEMENT),n}createStringBuffer(e){const t=this.module.malloc(e.length+1);for(let n=0;n<e.length;++n)this.module.heapU8[t+n]=e.charCodeAt(n);return this.module.heapU8[t+e.length]=0,t}readStringBuffer(e){let t="";for(;0!==this.module.heapU8[e];)t+=String.fromCharCode(this.module.heapU8[e]),++e;return t}setStyle(e){const t=e.entranceColorRgb,n=e.facadeGlazingColorRgb,r=e.roofColorRgb,i=e.wallColorRgb,o=e.normalScale;this.module.setStyle(t[0],t[1],t[2],n[0],n[1],n[2],r[0],r[1],r[2],i[0],i[1],i[2],o[0],o[1],o[2],e.tileToMeters)}setAOOptions(e,t){this.module.setAOOptions(e?1:0,t)}setMetricOptions(e,t){this.module.setMetricOptions(e?1:0,t)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,t){this.module.setFacadeOptions(e,t?1:0)}setFauxFacadeOptions(e,t,n){this.module.setFauxFacadeOptions(e?1:0,t?1:0,n)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,t){for(const s of e){const e=this.createStringBuffer(s.roofType),t=[0],n=[];for(const o of s.coordinates)if(Array.isArray(o)){for(const e of o)n.push(e.x),n.push(e.y);t.push(n.length)}const r=this.createIntArray(t),i=this.createFloatArray(n);this.module.addFeature(s.id,s.sourceId,s.minHeight,s.height,e,s.roofType.length,i,r,t.length-1),this.module.free(e),this.module.free(r),this.module.free(i)}for(const s of t){let e;e=s.entrances?JSON.parse(s.entrances):[];const t=this.createFloatArray(e),n=[];for(const i of s.coordinates)n.push(i.x),n.push(i.y);const r=this.createFloatArray(n);this.module.addFacade(s.sourceId,s.crossPerc,s.distanceToRoad,t,e.length,r,n.length),this.module.free(t),this.module.free(r)}if(!this.module.generateMesh()){const e=this.module.getLastError();return this.readStringBuffer(e)}const n=this.module.getMeshCount(),r=new Array(n);for(let s=0;s<n;s++){const e=this.module.getPositionsPtr(s),t=this.module.getPositionsLength(s),n=new Float32Array(this.module.heapF32.buffer,e,t),i=this.module.getNormalsPtr(s),o=this.module.getNormalsLength(s),a=new Float32Array(this.module.heapF32.buffer,i,o),l=this.module.getColorsPtr(s),c=this.module.getColorsLength(s),u=new Uint8Array(this.module.heapU8.buffer,l,c),h=this.module.getAOPtr(s),d=this.module.getAOLength(s),f=new Float32Array(this.module.heapF32.buffer,h,d),p=this.module.getUVPtr(s),m=this.module.getUVLength(s),g=new Float32Array(this.module.heapF32.buffer,p,m),_=this.module.getFauxFacadePtr(s),y=this.module.getFauxFacadeLength(s),v=new Uint8Array(this.module.heapU8.buffer,_,y),x=this.module.getIndicesPtr(s),b=this.module.getIndicesLength(s),w=new Int32Array(this.module.heap32.buffer,x,b),S=this.module.getBuildingPart(s),E=this.readStringBuffer(S);r[s]={positions:n,normals:a,colors:u,ao:f,uv:g,isFauxFacade:v,indices:w,buildingPart:E}}const i=this.module.getRingCount(),o=[];for(let s=0;s<i;s++){const e=this.module.getRingPtr(s),t=this.module.getRingLength(s),n=new Float32Array(this.module.heapF32.buffer,e,t);o.push(n)}return{meshes:r,modifiedPolygonRings:o}}}let Ff,Bf,jf,Uf,Vf,Gf=null,Hf=null,$f=null,Wf=null;function qf(){return Xe(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Bf||rt.DRACO_URL}function Xf(){if(Xe(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Uf)return Uf;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Uf=WebAssembly.validate(e)?rt.MESHOPT_SIMD_URL:rt.MESHOPT_URL,Uf}function Zf(){return Wf}const Kf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Yf={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Jf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Qf(e,t,n){const r=n.json.bufferViews.length,i=n.buffers.length;t.bufferView=r,n.json.bufferViews[r]={buffer:i,byteLength:e.byteLength},n.buffers[i]=e}const ep="KHR_draco_mesh_compression";function tp(e,t){const n=e.extensions&&e.extensions[ep];if(!n)return;const r=new jf.Decoder,i=lp(t,n.bufferView),o=new jf.Mesh;if(!r.DecodeArrayToMesh(i,i.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=Kf[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=jf._malloc(l);a===Uint16Array?r.GetTrianglesUInt16Array(o,l,c):r.GetTrianglesUInt32Array(o,l,c),Qf(jf.memory.buffer.slice(c,c+l),s,t),jf._free(c);for(const u of Object.keys(n.attributes)){const i=r.GetAttributeByUniqueId(o,n.attributes[u]),s=t.json.accessors[e.attributes[u]],a=Yf[s.componentType],l=s.count*Jf[s.type]*Kf[s.componentType].BYTES_PER_ELEMENT,c=jf._malloc(l);r.GetAttributeDataArrayForAllPoints(o,i,jf[a],l,c),Qf(jf.memory.buffer.slice(c,c+l),s,t),jf._free(c)}r.destroy(),o.destroy(),delete e.extensions[ep]}const np="EXT_meshopt_compression";function rp(e,t){if(!e.extensions||!e.extensions[np])return;const n=e.extensions[np],r=new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),i=new Uint8Array(n.count*n.byteStride);Vf.decodeGltfBuffer(i,n.count,n.byteStride,r,n.mode,n.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=i.buffer,delete e.extensions[np]}const ip=1179937895,op=new TextDecoder("utf8");function sp(e,t){return new URL(e,t).href}function ap(e,t,n,r){return fetch(sp(e.uri,r)).then(e=>e.arrayBuffer()).then(e=>{t.buffers[n]=e})}function lp(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function cp(e,t,n,r){if(e.uri){const i=sp(e.uri,r);return fetch(i).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{t.images[n]=e})}if(void 0!==e.bufferView){const r=lp(t,e.bufferView),i=new Blob([r],{type:e.mimeType});return createImageBitmap(i).then(e=>{t.images[n]=e})}}function up(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const r={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===ip){const n=new Uint32Array(e,t);let i=2;const o=(n[i++]>>2)-3,s=n[i++]>>2;if(i++,r.json=JSON.parse(op.decode(n.subarray(i,i+s))),i+=s,i<o){const o=n[i++];i++;const s=t+(i<<2);r.buffers[0]=e.slice(s,s+o)}}else r.json=JSON.parse(op.decode(new Uint8Array(e,t)));const{buffers:i,images:o,meshes:s,extensionsUsed:a,bufferViews:l}=r.json;let c=Promise.resolve();if(i){const e=[];for(let t=0;t<i.length;t++){const o=i[t];o.uri?e.push(ap(o,r,t,n)):r.buffers[t]||(r.buffers[t]=null)}c=Promise.all(e)}return c.then(()=>{const e=[],t=a&&a.includes(ep),i=a&&a.includes(np);if(t&&e.push(function(){if(!jf)return null!=Ff?Ff:(Ff=function(e){let t,n=null;function r(){t=new Uint8Array(n.buffer)}function i(){throw new Error("Unexpected Draco error.")}const o={a:{a:i,d:function(e,n,r){return t.copyWithin(e,n,n+r)},c:function(e){const i=t.length,o=Math.max(e>>>0,Math.ceil(1.2*i)),s=Math.ceil((o-i)/65536);try{return n.grow(s),r(),!0}catch(e){return!1}},b:i}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,o))).then(e=>{const{Rb:i,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:f,eb:p,jb:m,f:g,e:_,yb:y,zb:v,Ab:x,Bb:b,Db:w,Gb:S}=e.instance.exports;n=_;const E=(()=>{let e=0,n=0,r=0,s=0;return a=>{r&&(i(s),i(e),n+=r,r=e=0),e||(n+=128,e=o(n));const l=a.length+7&-8;let c=e;l>=n&&(r=l,c=s=o(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return r(),g(),{memory:_,_free:i,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,n){const r=E(e),i=u(this.ptr,r,t,n.ptr);return!!l(i)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,n){d(this.ptr,e.ptr,t,n)}GetTrianglesUInt32Array(e,t,n){f(this.ptr,e.ptr,t,n)}GetAttributeDataArrayForAllPoints(e,t,n,r,i){p(this.ptr,e.ptr,t.ptr,n,r,i)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:S()}})}(fetch(qf())),Ff.then(e=>{jf=e,Ff=void 0}))}()),i&&e.push(function(){if(Vf)return;const e=function(e){let t;const n=WebAssembly.instantiateStreaming(e,{}).then(e=>{t=e.instance,t.exports.__wasm_call_ctors()}),r={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},i={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:n,supported:!0,decodeGltfBuffer(e,n,o,s,a,l){!function(e,t,n,r,i,o,s){const a=e.exports.sbrk,l=r+3&-4,c=a(l*i),u=a(o.length),h=new Uint8Array(e.exports.memory.buffer);h.set(o,u);const d=t(c,r,i,u,o.length);if(0===d&&s&&s(c,l,i),n.set(h.subarray(c,c+r*i)),a(c-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(t,t.exports[i[a]],e,n,o,s,t.exports[r[l]])}}}(fetch(Xf()));return e.ready.then(()=>{Vf=e})}()),o)for(let s=0;s<o.length;s++)e.push(cp(o[s],r,s,n));return(e.length?Promise.all(e):Promise.resolve()).then(()=>{if(t&&s)for(const{primitives:e}of s)for(const t of e)tp(t,r);if(i&&s&&l)for(const e of l)rp(e,r);return r})})}function hp(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function dp(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class fp{constructor(e,t,n,r){this.context=e,this.format=n,this.useMipmap=r&&r.useMipmap,this.texture=e.gl.createTexture(),this.update(t,{premultiply:r&&r.premultiply})}update(e,t){const n=e&&e instanceof HTMLVideoElement&&0===e.width?e.videoWidth:e.width,r=e&&e instanceof HTMLVideoElement&&0===e.height?e.videoHeight:e.height,{context:i}=this,{gl:o}=i,{x:s,y:a}=t&&t.position?t.position:{x:0,y:0},l=s+n,c=a+r;!this.size||this.size[0]===l&&this.size[1]===c||(o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(this.texture),this.texture=o.createTexture(),this.size=null),o.bindTexture(o.TEXTURE_2D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA8&&(!t||!1!==t.premultiply));const u=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&l>0&&c>0){const e=this.useMipmap?Math.floor(Math.log2(Math.max(l,c)))+1:1;o.texStorage2D(o.TEXTURE_2D,e,this.format,l,c),this.size=[l,c]}if(this.size)if(u)o.texSubImage2D(o.TEXTURE_2D,0,s,a,hp(this.format),dp(this.format),e);else{const t=e.data;t&&o.texSubImage2D(o.TEXTURE_2D,0,s,a,n,r,hp(this.format),dp(this.format),t)}this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap&&!n?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,n,r,i){const{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),t!==this.magFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?e===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),this.wrapS=n),r!==this.wrapT&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,r),this.wrapT=r),i!==this.compareMode&&(i?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_FUNC,i)):s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.NONE),this.compareMode=i)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pp{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}}const mp=ta([{name:"a_pos_3f",components:3,type:"Float32"}]),gp=ta([{name:"a_color_3f",components:3,type:"Float32"}]),_p=ta([{name:"a_color_4f",components:4,type:"Float32"}]),yp=ta([{name:"a_uv_2f",components:2,type:"Float32"}]),vp=ta([{name:"a_normal_3f",components:3,type:"Float32"}]),xp=ta([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),bp=ta([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function wp(e,t){const n=Ep(e.projection,e.zoom,e.width,e.height),r=function(e,t,n,r,i){const o=new ql(n.lng-180*Tp,n.lat),s=new ql(n.lng+180*Tp,n.lat),a=e.project(o.lng,o.lat),c=e.project(s.lng,s.lat),h=-Math.atan2(c.y-a.y,c.x-a.x),f=cc.fromLngLat(n);f.y=ke(f.y,-1+Tp,1-Tp);const p=f.toLngLat(),g=e.project(p.lng,p.lat),_=cc.fromLngLat(p);_.x+=Tp;const y=_.toLngLat(),v=e.project(y.lng,y.lat),x=Cp(v.x-g.x,v.y-g.y,h),b=cc.fromLngLat(p);b.y+=Tp;const w=b.toLngLat(),S=e.project(w.lng,w.lat),E=Cp(S.x-g.x,S.y-g.y,h),T=Math.abs(x.x)/Math.abs(E.y),A=l([]);m(A,A,-h*(1-(i?0:r)));const C=l([]);return d(C,C,[1,1-(1-T)*r,1]),C[4]=-E.x/E.y*r,m(C,C,h),u(C,A,C),C}(e.projection,0,e.center,n,t),i=Sp(e);return d(r,r,[i,i,1]),r}function Sp(e){const t=e.projection,n=Ep(e.projection,e.zoom,e.width,e.height),r=Ap(t,e.center),i=Ap(t,ql.convert(t.center));return Math.pow(2,r*n+(1-n)*i)}function Ep(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=e.range;if(!o)return 0;const s=Math.min(i,Math.max(n,r)),a=Math.log(s/1024)/Math.LN2;return Me(o[0]+a,o[1]+a,t)}const Tp=1/4e4;function Ap(e,t){const n=ke(t.lat,-ic,ic),r=new ql(t.lng-180*Tp,n),i=new ql(t.lng+180*Tp,n),o=e.project(r.lng,n),s=e.project(i.lng,n),a=cc.fromLngLat(r),l=cc.fromLngLat(i),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,f=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(f)/Math.LN2}function Cp(e,t,n){const r=Math.cos(n),i=Math.sin(n);return{x:e*r-t*i,y:e*i+t*r}}function Pp(e,t,n){l(e),m(e,e,Ee(t[2])),f(e,e,Ee(t[0])),p(e,e,Ee(t[1])),d(e,e,n),u(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ip(e,t,n,r,i,o,s,a){const l=[n[0]-t[0],n[1]-t[1],0],c=[r[0]-t[0],r[1]-t[1],0];if(w(l)<1e-12||w(c)<1e-12)return J(e);const u=z([],l,c);D(u,u),A(c,r,t),l[2]=(o-i)*a,c[2]=(s-i)*a;const h=l;return z(h,l,c),D(h,h),oe(e,u,h)}function kp(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Hu(t.zoom),i=function(e,t,n){const r=t.worldSize,i=[e[12],e[13],e[14]],o=nc(i[1]/r),s=tc(i[0]/r),a=l([]),c=ec(1,o)*r,f=ec(1,0)*r*sc(o,t.zoom),p=1/Uu(r);let m=f*p;if(n){const e=Ep(t.projection,t.zoom,t.width,t.height,1024);m=p*t.projection.pixelSpaceConversion(t.center.lat,r,e)}const g=Hl(o,s);T(g,g,k([],D([],g),c*m*i[2]));const _=function(e){const t=[e[0],e[1],e[2]];let n=[0,1,0];const r=z([],n,t);return z(n,t,r),0===O(n)&&(n=[0,1,0],z(r,t,n)),D(r,r),D(n,n),D(t,t),[r[0],r[1],r[2],0,n[0],n[1],n[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(g);d(a,a,[m,m,m*c]),h(a,a,[-i[0],-i[1],-i[2]]);const y=u([],t.globeMatrix,_);return u(y,y,a),u(y,y,e),y}(e,t,n);if(r>0){const n=function(e,t){const n=t.worldSize,r=ec(1,0)*n*sc(t.center.lat,t.zoom)/Uu(n),i=ec(1,t.center.lat)*n,o=l([]);return p(o,o,Ee(t.center.lng)),f(o,o,Ee(t.center.lat)),h(o,o,[0,0,Dl]),d(o,o,[r,r,r*i]),h(o,o,[t.point.x-.5*n,t.point.y-.5*n,0]),u(o,o,e),u(o,t.globeMatrix,o)}(e,t);return function(e,t,n){const r=(e,t,n)=>{const r=w(e),i=w(t),o=Mu(e,t,n);return k(o,o,1/w(o)*un(r,i,n))},i=r([e[0],e[1],e[2]],[t[0],t[1],t[2]],n),o=r([e[4],e[5],e[6]],[t[4],t[5],t[6]],n),s=r([e[8],e[9],e[10]],[t[8],t[9],t[10]],n),a=Mu([e[12],e[13],e[14]],[t[12],t[13],t[14]],n);return[i[0],i[1],i[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],1]}(i,n,r)}return i}function Mp(e,t,n,r){const i=Uc.projectAabbCorners(r,n);let o=Number.MAX_VALUE,s=-1;for(let c=0;c<i.length;++c){const e=i[c];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<o&&(s=c,o=e[2])}const a=e=>new xe(i[e][0],i[e][1]);let l;switch(s){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(qc(e,l))return o}const Rp=64,Op={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Lp(e,t,n,r,i,o,s,a,c){let f=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const p=n.zoom,m=n.project(r),g=sc(r.lat,p),_=1/g;l(e),h(e,e,[m.x+s[0]*_,m.y+s[1]*_,s[2]]);let v=1,x=1;const b=n.worldSize;if(f){if("mercator"===n.projection.name){let e=0;n.elevation&&(e=n.elevation.getAtPointOrZero(new cc(m.x/b,m.y/b),0));const t=K([],[m.x,m.y,e,1],n.projMatrix)[3]/n.cameraToCenterDistance;v=t,x=t*sc(n.center.lat,p)}else if("globe"===n.projection.name){const t=kp(e,n),i=[0,0,0,1];K(i,i,u([],n.projMatrix,t));const o=i[3]/n.cameraToCenterDistance,s=Hu(p),a=n.projection.pixelsPerMeter(r.lat,b)*sc(r.lat,p),l=n.projection.pixelsPerMeter(n.center.lat,b)*sc(n.center.lat,p);v=o/un(a,oc(n.center.lat),s),x=o*g/a,v*=l,x*=l}}else v=_;d(e,e,[v,v,x]);const w=[...e],S=t.orientation,E=[];if(Pp(E,[S[0]+i[0],S[1]+i[1],S[2]+i[2]],o),u(e,w,E),a&&n.elevation){let i=0;const o=[];if(c&&n.elevation){i=function(e,t,n,r,i){const o=t.elevation;if(!o)return 0;const s=Uc.projectAabbCorners(n,r),a=ec(1,i.lat)*t.worldSize,l=function(e,t){const n=[0,0,1],r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const i of r){const r=e[i.corners[0]],o=e[i.corners[1]],s=e[i.corners[2]],a=[o[0]-r[0],o[1]-r[1],t*(o[2]-r[2])],l=z(a,a,[s[0]-r[0],s[1]-r[1],t*(s[2]-r[2])]);D(l,l),i.dotProductWithUp=N(l,n)}return r.sort((e,t)=>e.dotProductWithUp-t.dotProductWithUp),r[0].corners}(s,a),c=s[l[0]],u=s[l[1]],h=s[l[2]],d=s[l[3]],f=o.getAtPointOrZero(new cc(c[0]/t.worldSize,c[1]/t.worldSize),0),p=o.getAtPointOrZero(new cc(u[0]/t.worldSize,u[1]/t.worldSize),0),m=o.getAtPointOrZero(new cc(h[0]/t.worldSize,h[1]/t.worldSize),0),g=o.getAtPointOrZero(new cc(d[0]/t.worldSize,d[1]/t.worldSize),0),_=(f+g)/2,y=(p+m)/2;return _>y?p<m?Ip(e,u,d,c,p,g,f,a):Ip(e,h,c,d,m,f,g,a):f<g?Ip(e,c,u,h,f,p,m,a):Ip(e,d,h,u,g,m,p,a),Math.max(_,y)}(o,n,t.aabb,e,r);const s=u([],y([],o),E);u(e,w,s)}else i=n.elevation.getAtPointOrZero(new cc(m.x/b,m.y/b),0);0!==i&&(e[14]+=i)}}function Dp(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new fp(t,e.image,n?t.gl.R8:t.gl.RGBA8,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function Np(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,mp.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,vp.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,yp.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?gp:_p).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,bp.members,!0)),e.segments=tl.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const r=e.material;r.pbrMetallicRoughness.baseColorTexture&&Dp(r.pbrMetallicRoughness.baseColorTexture,t),r.pbrMetallicRoughness.metallicRoughnessTexture&&Dp(r.pbrMetallicRoughness.metallicRoughnessTexture,t),r.normalTexture&&Dp(r.normalTexture,t),r.occlusionTexture&&Dp(r.occlusionTexture,t,n),r.emissionTexture&&Dp(r.emissionTexture,t)}function zp(e,t,n){if(e.meshes)for(const r of e.meshes)Np(r,t,n);if(e.children)for(const r of e.children)zp(r,t,n)}function Fp(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Fp(t)}function Bp(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)Bp(n)}function jp(e,t){const n=e.json.bufferViews[t.bufferView],r=Kf[t.componentType];return new r(e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*(n.byteStride&&n.byteStride!==Jf[t.type]*r.BYTES_PER_ELEMENT?n.byteStride/r.BYTES_PER_ELEMENT:Jf[t.type]))}function Up(e,t,n,r){const i=Kf[t.componentType],o=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(i),s=e.json.bufferViews[t.bufferView],a=s.byteStride?s.byteStride/i.BYTES_PER_ELEMENT:Jf[t.type],l=n.float32,c=l.length/n.capacity;for(let u=0,h=0;u<t.count*a;u+=a,h+=c)for(let e=0;e<c;e++)l[h+e]=r[u+e]*o;n._trim()}function Vp(e,t,n){const r=e.indices,i=e.attributes,o={};o.indexArray=new Ea;const s=t.json.accessors[r],a=s.count/3;o.indexArray.reserve(a);const l=jp(t,s);for(let d=0;d<a;d++)o.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);o.indexArray._trim(),o.vertexArray=new ha;const c=t.json.accessors[i.POSITION];o.vertexArray.reserve(c.count);const u=jp(t,c);for(let d=0;d<c.count;d++)o.vertexArray.emplaceBack(u[3*d],u[3*d+1],u[3*d+2]);if(o.vertexArray._trim(),o.aabb=new Uc(c.min,c.max),o.centroid=function(e,t){const n=[0,0,0],r=e.length;if(r>0){for(let i=0;i<r;i++){const r=3*e[i];n[0]+=t[r],n[1]+=t[r+1],n[2]+=t[r+2]}n[0]/=r,n[1]/=r,n[2]/=r}return n}(l,u),void 0!==i.COLOR_0){const e=t.json.accessors[i.COLOR_0],n=Jf[e.type],r=jp(t,e);o.colorArray=3===n?new ha:new _a,o.colorArray.resize(e.count),Up(t,e,o.colorArray,r)}if(void 0!==i.NORMAL){o.normalArray=new ha;const e=t.json.accessors[i.NORMAL];o.normalArray.resize(e.count);const n=jp(t,e);Up(t,e,o.normalArray,n)}if(void 0!==i.TEXCOORD_0&&n.length>0){o.texcoordArray=new Ra;const e=t.json.accessors[i.TEXCOORD_0];o.texcoordArray.resize(e.count);const n=jp(t,e);Up(t,e,o.texcoordArray,n)}if(void 0!==i._FEATURE_ID_RGBA4444){const e=t.json.accessors[i._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=jp(t,e))}void 0!==i._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(jp(t,t.json.accessors[i._FEATURE_RGBA4444]).buffer));const h=e.material;return o.material=function(e,t){const{emissiveFactor:n=[0,0,0],alphaMode:r="OPAQUE",alphaCutoff:i=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:f}=e.pbrMetallicRoughness||{},p=s?t[s.index]:void 0;if(s&&s.extensions&&s.extensions.KHR_texture_transform&&p){const e=s.extensions.KHR_texture_transform;p.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new sn(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:f?t[f.index]:void 0},doubleSided:l,emissiveFactor:new sn(...n),alphaMode:r,alphaCutoff:i,normalTexture:o?t[o.index]:void 0,occlusionTexture:p,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},n),o}function Gp(e,t,n){const{matrix:r,rotation:i,translation:o,scale:s,mesh:a,extras:l,children:c}=e,u={};if(u.matrix=r||function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=t[3],l=i+i,c=o+o,u=s+s,h=i*l,d=i*c,f=i*u,p=o*c,m=o*u,g=s*u,_=a*l,y=a*c,v=a*u,x=r[0],b=r[1],w=r[2];return e[0]=(1-(p+g))*x,e[1]=(d+v)*x,e[2]=(f-y)*x,e[3]=0,e[4]=(d-v)*b,e[5]=(1-(h+g))*b,e[6]=(m+_)*b,e[7]=0,e[8]=(f+y)*w,e[9]=(m-_)*w,e[10]=(1-(h+p))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}([],i||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==a){u.meshes=n[a];const e=u.anchor=[0,0];for(const t of u.meshes){const{min:n,max:r}=t.aabb;e[0]+=n[0]+r[0],e[1]+=n[1]+r[1]}e[0]=Math.floor(e[0]/u.meshes.length/2),e[1]=Math.floor(e[1]/u.meshes.length/2)}if(l&&(l.id&&(u.id=l.id),l.lights&&(u.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.codePointAt(r);return n}(e),n=[],r=t.length/24,i=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let s=0;s<r;s++){const e=i[2*s*6]/30,t=i[2*s*6+1]/30,r=i[2*s*6+10]/100,a=o[6*s+1],l=o[6*s+2],c=o[6*s+3],u=o[6*s+4],h=c-a,d=u-l,f=Math.hypot(h,d);n.push({pos:[a+.5*h,l+.5*d,t],normal:[d/f,-h/f,0],width:f,height:e,depth:r,points:[a,l,c,u]})}return n}(l.lights))),c){const e=[];for(const r of c)e.push(Gp(t.json.nodes[r],t,n));u.children=e}return u}function Hp(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new pd(e.vertices,e.indices,8,256),[n,r]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:n,max:r}}function $p(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const r=[];for(const s of n){if(!Array.isArray(s)||2!==s.length)continue;const e=s[0],t=s[1];"number"==typeof e&&"number"==typeof t&&r.push(new xe(e,t))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let i=0;for(let s=0;s<r.length;s++){const e=r[s],t=r[(s+1)%r.length],n=r[(s+2)%r.length];i+=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}i>0&&r.reverse();const o=vh(r.flatMap(e=>[e.x,e.y]),[]);return 0===o.length?null:{vertices:r,indices:o}}function Wp(e,t){const n=[],r=[];let i=0;const o=[];for(const s of e){i=n.length;const e=s.vertexArray.float32,a=s.indexArray.uint16;for(let r=0;r<s.vertexArray.length;r++)o[0]=e[3*r+0],o[1]=e[3*r+1],o[2]=e[3*r+2],B(o,o,t),n.push(new xe(o[0],o[1]));for(let t=0;t<3*s.indexArray.length;t++)r.push(a[t]+i)}if(r.length%3!=0)return null;for(let s=0;s<r.length;s+=3){const e=n[r[s+0]],t=n[r[s+1]],i=n[r[s+2]];(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>0&&([r[s+1],r[s+2]]=[r[s+2],r[s+1]])}return{vertices:n,indices:r}}function qp(e){const t=function(e,t){const n=[],r=WebGL2RenderingContext;if(e.json.textures)for(const i of e.json.textures){const o={magFilter:r.LINEAR,minFilter:r.NEAREST,wrapS:r.REPEAT,wrapT:r.REPEAT};void 0!==i.sampler&&Object.assign(o,e.json.samplers[i.sampler]),n.push({image:t[i.source],sampler:o,uploaded:!1})}return n}(e,e.images),n=function(e,t){const n=[];for(const r of e.json.meshes){const i=[];for(const n of r.primitives)i.push(Vp(n,e,t));n.push(i)}return n}(e,t),{scenes:r,scene:i,nodes:o}=e.json,s=r?r[i||0].nodes:o,a=[];for(const l of s)a.push(Gp(o[l],e,n));return function(e,t,n){const r={},i=new Set;for(let o=0;o<e.length;o++){const e=n[t[o]];if(!e.extras)continue;const s=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(s||a)&&i.add(o),"1.0.0"===s&&a&&(r[a]=o)}for(let o=0;o<e.length;o++){if(i.has(o))continue;const s=e[o],a=n[t[o]];if(!a.extras)continue;let l=null;s.id in r&&(l=Wp(e[r[s.id]].meshes,s.matrix)),l||(l=$p(a)),l&&(s.footprint=Hp(l))}if(i.size>0){const t=Array.from(i.values()).sort((e,t)=>e-t);for(let n=t.length-1;n>=0;n--)e.splice(t[n],1)}}(a,s,e.json.nodes),a}function Xp(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,r=e.aabb.min[1]-1,i=Rp/(e.aabb.max[0]-n+2),o=Rp/(e.aabb.max[1]-r+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],l=(t[s+0]-n)*i|0,c=(t[s+1]-r)*o|0;a>e.heightmap[c*Rp+l]&&(e.heightmap[c*Rp+l]=a)}}function Zp(e,t,n,r,i){n.reserve(n.length+4*e.length),r.reserve(r.length+10*e.length),i.reserve(i.length+10*e.length);let o=r.length;for(const s of e){const e=Math.min(10,Math.max(4,1.3*s.height))*t,a=[-s.normal[1],s.normal[0],0],l=Math.min(.29,.1*s.width/s.depth),c=s.width-2*s.depth*t*(l+.01),u=M([],s.pos,a,c/2),h=M([],s.pos,a,-c/2),d=[u[0],u[1],u[2]+s.height],f=[h[0],h[1],h[2]+s.height],p=M([],s.normal,a,l);k(p,p,e);const m=M([],s.normal,a,-l);k(m,m,e),T(p,u,p),T(m,h,m),u[2]+=.1,h[2]+=.1,r.emplaceBack(p[0],p[1],p[2]),r.emplaceBack(m[0],m[1],m[2]),r.emplaceBack(u[0],u[1],u[2]),r.emplaceBack(h[0],h[1],h[2]),r.emplaceBack(d[0],d[1],d[2]),r.emplaceBack(f[0],f[1],f[2]),r.emplaceBack(u[0],u[1],u[2]),r.emplaceBack(h[0],h[1],h[2]),r.emplaceBack(p[0],p[1],p[2]),r.emplaceBack(m[0],m[1],m[2]);const g=c/e/2;i.emplaceBack(-g-l,-1,g,.8),i.emplaceBack(g+l,-1,g,.8),i.emplaceBack(-g,0,g,1.3),i.emplaceBack(g,0,g,1.3),i.emplaceBack(g+l,-.8,g,.7),i.emplaceBack(g+l,-.8,g,.7),i.emplaceBack(0,0,g,1.3),i.emplaceBack(0,0,g,1.3),i.emplaceBack(g+l,-1.2,g,.8),i.emplaceBack(g+l,-1.2,g,.8),n.emplaceBack(6+o,4+o,8+o),n.emplaceBack(7+o,9+o,5+o),n.emplaceBack(0+o,1+o,2+o),n.emplaceBack(1+o,3+o,2+o),o+=10}}function Kp(e,t){const n={};n.indexArray=new Ea,n.vertexArray=new ha,n.colorArray=new _a,Zp(e,t,n.indexArray,n.vertexArray,n.colorArray);const r={defined:!0};r.emissiveFactor=sn.black;const i={};return i.baseColorFactor=sn.white,r.pbrMetallicRoughness=i,n.material=r,n.aabb=new Uc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const Yp=ta([{name:"a_pos_3f",components:3,type:"Float32"}]),Jp=ta([{name:"a_normal_3",components:3,type:"Int16"}]),Qp=ta([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),em=ta([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),tm=vc.types,nm=32767;function rm(e,t){const n=Lr+t;for(const r of e)for(const e of r)if(e.x<-t||e.x>n||e.y<-t||e.y>n)return!1;return!0}class im{constructor(e){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.layoutVertexArray=new ha,this.layoutNormalArray=new ia,this.layoutColorArray=new va,this.indexArray=new Ea,this.indexArrayForConflation=new Ea,this.entranceBloom={layoutVertexArray:new ha,layoutVertexBuffer:null,layoutAttenuationArray:new _a,layoutAttenuationBuffer:null,layoutColorArray:new va,layoutColorBuffer:null,indexArray:new Ea,indexArrayForConflation:new Ea,indexBuffer:null,segmentsBucket:new tl},this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut}),this.segmentsBucket=new tl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.groundEffect=new nf(e)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(e,t){for(const n of this.footprints)t.push({footprint:n,id:e})}prepare(){return function(){if(null!=Wf||null!=$f)return null;if(null!=Hf)return Hf;const e=fetch(rt.BUILDING_GEN_URL);return Hf=function(e){let t,n,r,i;function o(){t=new Uint8Array(i.buffer),n=new Int32Array(i.buffer),r=new Float32Array(i.buffer)}function s(){throw new Error("Unexpected BuildingGen error.")}const a=()=>{},l={a:{a:s,f:function(e){const n=t.length,r=Math.max(e>>>0,Math.ceil(1.2*n)),s=Math.ceil((r-n)/65536);try{return i.grow(s),o(),!0}catch(e){return!1}},g:s,b:a,c:a,d:a,e:a}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,l):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,l))).then(e=>{const s=e.instance.exports;return(0,s.g)(),i=s.f,o(),new zf({setStyle:s.h,setAOOptions:s.i,setMetricOptions:s.j,setStructuralOptions:s.k,setFacadeOptions:s.l,setFauxFacadeOptions:s.m,setFacadeClassifierOptions:s.n,addFeature:s.o,addFacade:s.p,generateMesh:s.q,getLastError:s.r,getMeshCount:s.s,getPositionsPtr:s.t,getPositionsLength:s.u,getNormalsPtr:s.v,getNormalsLength:s.w,getColorsPtr:s.x,getColorsLength:s.y,getAOPtr:s.z,getAOLength:s.A,getUVPtr:s.B,getUVLength:s.C,getFauxFacadePtr:s.D,getFauxFacadeLength:s.E,getIndicesPtr:s.F,getIndicesLength:s.G,getBuildingPart:s.H,getRingCount:s.I,getRingPtr:s.J,getRingLength:s.K,free:s.L,malloc:s.M,heapU8:t,heap32:n,heapF32:r})})}(e).then(e=>(Hf=null,Wf=e,Wf)).catch(e=>{He("Could not load building-gen"),Hf=null,$f=e}),Hf}()}populate(e,t,n,r){const i=Zf();if(!i)return;const o=lc(n);this.tileToMeter=o,this.brightness=t.brightness,i.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,o],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:o,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),i.setAOOptions(!1,.3),i.setMetricOptions(!1,16),i.setStructuralOptions(!0),i.setFacadeOptions(4,!0),i.setFauxFacadeOptions(!1,!1,1),i.setFacadeClassifierOptions(3);const s=new Map;for(const{feature:a}of e){if("LineString"!==tm[a.type])continue;const e=this.layers[0]._featureFilter.needGeometry,t=yc(a,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom),t,n))continue;const i=e?t.geometry:_c(a,n,r),o=[];for(const n of i)for(const e of n)o.push({x:e.x,y:e.y});const l={coordinates:o,crossPerc:a.properties.cross_perc,distanceToRoad:a.properties.distance_to_road,entrances:a.properties.entrances,sourceId:0},c=a.properties.source_id;let u=s.get(c);u||(u=[],s.set(c,u)),u.push(l)}this.maxHeight=0;for(const{feature:a,index:l}of e){if("LineString"===tm[a.type])continue;const e=this.layers[0]._featureFilter.needGeometry,o=yc(a,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom),o,n))continue;const c=e?o.geometry:_c(a,n,r),u=$h(c,500);if(!rm(c,163))continue;const h=this.layers[0],d=h.layout.get("building-base").evaluate(a,{},n),f=h.layout.get("building-height").evaluate(a,{},n),p=h.layout.get("building-roof-shape").evaluate(a,{},n),m=h.paint.get("building-ambient-occlusion-intensity"),g=h.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if("flat"===p)continue;const _=a.properties.source_id;let y;y=s.has(_)?s.get(_):[];const v=[],x=new xe(1/0,1/0),b=new xe(-1/0,-1/0);for(const t of u)if(t.length>0){const e=[];for(const n of t){const t=[];for(let e=n.length-1;e>=0;e--){const r=n[e];t.push({x:r.x,y:r.y}),x.x=Math.min(x.x,r.x),x.y=Math.min(x.y,r.y),b.x=Math.max(b.x,r.x),b.y=Math.max(b.y,r.y)}e.push(t)}v.push({id:a.id,height:f,minHeight:d,sourceId:0,roofType:p,coordinates:e})}const w=i.generateMesh(v,y);if("string"==typeof w)continue;if(0===w.meshes.length||0===w.modifiedPolygonRings.length)continue;let S=0;for(const t of w.meshes)S+=t.positions.length/3;const E=this.segmentsBucket.prepareSegment(S,this.layoutVertexArray,this.indexArray),T=[];let A=null,C=0,P=-1;const I=this.indexArray.length;let k=0;for(const t of w.meshes){const e=this.layoutVertexArray.length;if("entrance"===t.buildingPart){const e=new Array;for(let o=0;o<t.indices.length;o+=12){const n=t.positions[o+0],r=t.positions[o+1],i=t.positions[o+3],s=t.positions[o+4],a=t.positions[o+2],l=t.positions[o+8]-a,c=1,u=i-n,h=s-r,d=Math.hypot(u,h);e.push({pos:[n+.5*u,r+.5*h,a],normal:[h/d,-u/d,0],width:d,height:l,depth:c,points:[n,r,i,s]})}const n=this.entranceBloom.segmentsBucket.prepareSegment(10*e.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),r=this.entranceBloom.layoutVertexArray.length;C=this.entranceBloom.indexArray.length,Zp(e,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const i=this.entranceBloom.layoutVertexArray.length-r;P=this.entranceBloom.indexArray.length-C;for(let t=0;t<i;t++){const e=65535;this.entranceBloom.layoutColorArray.emplaceBack(e,e)}n.vertexLength+=i,n.primitiveLength+=P,A={part:t.buildingPart,vertexOffset:r,vertexLength:i}}for(let r=0;r<t.positions.length;r+=3)k=Math.max(k,t.positions[r+2]),this.layoutVertexArray.emplaceBack(t.positions[r],t.positions[r+1],t.positions[r+2]);for(let r=0;r<t.normals.length;r+=3)this.layoutNormalArray.emplaceBack(t.normals[r+0]*nm,t.normals[r+1]*nm,t.normals[r+2]*nm);for(let r=0;r<t.ao.length;r++)this.layoutAOArray.push(t.ao[r]);for(let r=0;r<t.colors.length;r+=3){const e=1+(t.ao[r/3]-1)*m;this.layoutColorArray.emplaceBack(t.colors[r]*e<<8|t.colors[r+1]*e,t.colors[r+2]*e<<8)}const n=E.vertexLength;for(let r=0;r<t.indices.length;r+=3)this.indexArray.emplaceBack(n+t.indices[r],n+t.indices[r+1],n+t.indices[r+2]);E.vertexLength+=t.positions.length/3,E.primitiveLength+=t.indices.length/3,("roof"===t.buildingPart||"wall"===t.buildingPart||"facade_glazing"===t.buildingPart||"entrance"===t.buildingPart)&&T.push({part:t.buildingPart,vertexOffset:e,vertexLength:t.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,k),this.buildingFeatures.push({feature:o,segment:E,parts:T,buildingBloom:A});const M=this.indexArray.length-I,R=[],O=[],L=new xe(1/0,1/0),D=new xe(-1/0,-1/0),N=this.groundEffect.vertexArray.length;for(const t of w.modifiedPolygonRings){const e=[],n=new xe(1/0,1/0),r=new xe(-1/0,-1/0);for(let i=0;i<t.length;i+=2){const o=t.length-i-2;n.x=Math.min(n.x,t[o]),n.y=Math.min(n.y,t[o+1]),r.x=Math.max(r.x,t[o]),r.y=Math.max(r.y,t[o+1]);const s=new xe(t[o],t[o+1]);e.push(s),R.push(s.x,s.y),O.push(s.clone())}L.x=Math.min(L.x,n.x),L.y=Math.min(L.y,n.y),D.x=Math.max(D.x,r.x),D.y=Math.max(D.y,r.y),this.groundEffect.addData(e,[n,r],g)}const z=this.groundEffect.vertexArray.length-N;(x.x<0||b.x>Lr||x.y<0||b.y>Lr)&&this.featuresOnBorder.push({featureId:a.id,footprintIndex:this.footprints.length});{const e=vh(R,null,2),t=new pd(O,e,8,256);let n=a.id;a.properties&&a.properties.hasOwnProperty("building_id")&&(n=a.properties.building_id),this.footprints.push({vertices:O,indices:e,grid:t,min:L,max:D,buildingId:n,hiddenFlags:0,indicesOffset:I,indicesLength:M,bloomIndicesOffset:C,bloomIndicesLength:P,groundEffectVertexOffset:N,groundEffectVertexLength:z,segment:E,height:k})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,{},t.availableImages,n,t.brightness),this.groundEffect.addPaintPropertiesData(a,l,{},t.availableImages,n,t.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(e,t,n,r,i,o,s){this.programConfigurations.updatePaintArrays(e,t,i,n,r,o,s),this.groundEffect.update(e,t,i,n,r,o,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yp.members),this.layoutNormalBuffer=e.createVertexBuffer(this.layoutNormalArray,Jp.members),this.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(this.entranceBloom.layoutVertexArray,Yp.members),this.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,em.members),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!1;const i=n?t:0,o=0|(n?-1:~t);0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of e){const e=this.footprints[s],t=e.hiddenFlags&o|i;e.hiddenFlags!==t&&(e.hiddenFlags=t,r=!0,this.groundEffect.updateHiddenByLandmarkRange(e.groundEffectVertexOffset,e.groundEffectVertexLength,0!==e.hiddenFlags))}return r&&(this.indexArrayForConflationUploaded=!1),r}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),!this.indexArrayForConflationUploaded&&0!==this.indexArray.length){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const e of this.footprints){const t=e.indicesOffset+e.indicesLength;if(0!==e.hiddenFlags){for(let r=e.indicesOffset;r<t;r++)this.indexArrayForConflation.uint16[3*r+0]=0,this.indexArrayForConflation.uint16[3*r+1]=0,this.indexArrayForConflation.uint16[3*r+2]=0;const n=e.bloomIndicesOffset+e.bloomIndicesLength;for(let t=e.bloomIndicesOffset;t<n;t++)this.entranceBloom.indexArrayForConflation.uint16[3*t+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*t+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*t+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=e.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=e.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(e){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=e.createVertexBuffer(this.layoutColorArray,Qp.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=e.createVertexBuffer(this.entranceBloom.layoutColorArray,Qp.members,!0)}evaluate(e){const t=e.paint.get("building-ambient-occlusion-intensity");for(const n of this.buildingFeatures){const r=n.feature;r.properties["building-part"]="roof";const i=e.paint.get("building-color").evaluate(r,{},this.canonical),o=e.paint.get("building-emissive-strength").evaluate(r,{},this.canonical);r.properties["building-part"]="wall";const s=e.paint.get("building-color").evaluate(r,{},this.canonical),a=e.paint.get("building-emissive-strength").evaluate(r,{},this.canonical);r.properties["building-part"]="window";const l=e.paint.get("building-color").evaluate(r,{},this.canonical),c=e.paint.get("building-emissive-strength").evaluate(r,{},this.canonical);r.properties["building-part"]="door";const u=e.paint.get("building-color").evaluate(r,{},this.canonical),h=e.paint.get("building-emissive-strength").evaluate(r,{},this.canonical);for(const e of n.parts){let n,r=i;"roof"===e.part?(r=i,n=o):"wall"===e.part?(r=s,n=a):"facade_glazing"===e.part?(r=l,n=c):"entrance"===e.part&&(r=u,n=h),n=ke(n,0,1);for(let i=0;i<e.vertexLength;i++){const o=e.vertexOffset+i,s=1+(this.layoutAOArray[o]-1)*t;this.layoutColorArray.emplace(o,r.r*s*255<<8|r.g*s*255,r.b*s*255<<8|255*n)}}const d=n.buildingBloom;if(d)for(let e=0;e<d.vertexLength;e++)this.bloomGeometry.layoutColorArray.emplace(d.vertexOffset+e,255*u.r<<8|255*u.g,255*u.b<<8|51*h)}}needsEvaluation(e,t){const n=e.transform.projectionOptions,r=e.style.getBrightness();return!(this.uploaded&&n.name===this.projection.name&&this.brightness===r||(this.projection=n,this.brightness=r,0))}updateReplacement(e,t,n){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());if(kd(this.activeReplacements,r))return;this.activeReplacements=r;for(const o of this.footprints)o.hiddenFlags&=-2;const i=[];for(const o of this.activeReplacements){if(o.order<=Td)continue;const t=Math.max(1,Math.pow(2,o.footprintTileId.canonical.z-e.canonical.z));for(const n of this.footprints)n.min.x>o.max.x||n.max.x<o.min.x||n.min.y>o.max.y||n.max.y<o.min.y||(i.length=0,om(n.vertices,0,n.vertices.length,o.footprintTileId.canonical,e.canonical,i),Od(o.footprint,i,n.indices,0,n.indices.length,0,-t)&&(n.hiddenFlags|=1))}0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(o.groundEffectVertexOffset,o.groundEffectVertexLength,0!==o.hiddenFlags);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,r=!0;const i=4*(e+Lr)*Lr+(t+Lr);if(this.footprintLookup.hasOwnProperty(i)){const e=this.footprintLookup[i];return e?{height:e.height,hidden:0!==e.hiddenFlags}:void 0}const o=new xe(e,t);for(const s of this.footprints)e>s.max.x||s.min.x>e||t>s.max.y||s.min.y>t||s.height<=n||Nd(o,s)&&(n=s.height,this.footprintLookup[i]=s,r=0!==s.hiddenFlags);if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:r};this.footprintLookup[i]=void 0}}function om(e,t,n,r,i,o){const s=Math.pow(2,r.z-i.z);for(let a=0;a<n;a++){let n=e[a+t].x,l=e[a+t].y;n=(n+i.x*Lr)*s-r.x*Lr,l=(l+i.y*Lr)*s-r.y*Lr,o.push(new xe(n,l))}}let sm,am;qo(im,"BuildingBucket",{omit:["layers"]});const lm=ta([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),cm=ta([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:um}=lm,hm=ta([{name:"a_packed",components:3,type:"Float32"}]),{members:dm}=hm,fm=ta([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:pm}=fm;class mm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new hh({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=ze(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const r=[];let i=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,s=!0;r.push({left:i,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let l=1;l<e.length;l++){s=!s;const t=e[l];i=a*n,a+=t,o=a*n,r.push({left:i,right:o,isDash:s,zeroLength:0===t})}return r}addRoundDash(e,t,n){const r=t/2;for(let i=-n;i<=n;i++){const t=this.width*(this.nextRow+n+i);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=i/n*(r+1);if(s.isDash){const e=r-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=r-Math.sqrt(u*u+d*d);this.image.data[t+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let a=e.length-1;a>=0;--a){const t=e[a],n=e[a+1];t.zeroLength?e.splice(a,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(a,1))}const n=e[0],r=e[e.length-1];n.isDash===r.isDash&&(n.left=r.left-this.width,r.right=n.right+this.width);const i=this.width*this.nextRow;let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const n=Math.abs(a-s.left),r=Math.abs(a-s.right),l=Math.min(n,r);this.image.data[i+a]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const r="round"===t,i=r?7:0,o=2*i+1;if(this.nextRow+o>this.height)return He("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let c=0;c<e.length;c++)e[c]<0&&(He("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),s+=e[c];if(0!==s){const n=this.width/s,o=this.getDashRanges(e,this.width,n);r?this.addRoundDash(o,n,i):this.addRegularDash(o,"square"===t?.5*n:0)}const a=this.nextRow+i;this.nextRow+=o;const l={tl:[a,i],br:[s,0]};return this.positions[n]=l,l}}qo(mm,"LineAtlas");const gm=vc.types,_m=Math.cos(Math.PI/180*37.5),ym=Math.cos(Math.PI/180*5);class vm{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new ua,this.layoutVertexArray2=new ha,this.patternVertexArray=new ha,this.indexArray=new Ea,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new tl,this.maxLineLength=0,this.zOffsetVertexArray=new ha,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Lr/64,this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,r){this.hasPattern=Xh("line",this.layers,this.pixelRatio,t);const i=this.layers[0].layout.get("line-sort-key");this.tileToMeter=lc(n);const o=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===o)this.elevationType="road";else{const e=this.layers[0].layout.get("line-z-offset"),t=e.isConstant()&&!e.constantOr(0);this.elevationType="sea"!==o&&"ground"!==o&&t?"none":"offset","offset"===this.elevationType&&"none"===o&&He(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const s=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==s;const a=[];for(const{feature:h,id:d,index:f,sourceLayerIndex:p}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(h,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),t,n))continue;const o=i?i.evaluate(t,{},n):void 0,s={id:d,properties:h.properties,type:h.type,sourceLayerIndex:p,index:f,geometry:e?t.geometry:_c(h,n,r),patterns:{},sortKey:o};a.push(s)}i&&a.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:l,featureIndex:c}=t,u=this.addConstantDashes(l);for(const h of a){const{geometry:r,index:i,sourceLayerIndex:o}=h;if(u&&this.addFeatureDashes(h,l),this.hasPattern){const e=Zh("line",this.layers,h,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(h,r,i,n,l.positions,t.availableImages,t.brightness,t.elevationFeatures);c.insert(e[i].feature,r,i,o,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,i=n.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==i.kind)t=!0;else{const t=i.value,n=r.value;if(!n)continue;e.addDash(n,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const r of this.layers){const i=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===o.kind)continue;let s,a;if("constant"===i.kind){if(s=i.value,!s)continue}else s=i.evaluate({zoom:n},e);a="constant"===o.kind?o.value:o.evaluate({zoom:n},e),t.addDash(s,a),e.patterns[r.id]=[t.getKey(s,a)]}}update(e,t,n,r,i,o,s,a){this.programConfigurations.updatePaintArrays(e,t,i,n,r,o,s,a)}addFeatures(e,t,n,r,i,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,n,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,dm)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,pm)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,cm.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,um),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,r,i,o,s,a){const l=this.layers[0].layout,c=l.get("line-join").evaluate(e,{}),u=l.get("line-cap").evaluate(e,{}),h=l.get("line-miter-limit"),d=l.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=l.get("line-z-offset").value;const f=this.layers[0].paint.get("line-width").value;if("constant"!==f.kind&&!1===f.isLineProgressConstant&&(this.variableWidthValue=f),"road"===this.elevationType){const n=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,t,r,a,c,u,h,d)){const[i,o]=this.clipRuntimeLinesToTile(t,1);for(let t=0;t<i.length;t++){const n=i[t],s=o[t],a={progress:{min:s.progress.min,max:s.progress.max},nextDir:this.computeSegNextDir(s,n),prevDir:this.computeSegPrevDir(s,n)};this.addLine(n,e,r,c,u,h,d,a)}this.fillNonElevatedRoadSegment(n)}}else for(const p of t)this.addLine(p,e,r,c,u,h,d);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,o,r,s,void 0,this.worldview)}computeSegNextDir(e,t){return e.nextPoint.sub(t.at(-2)).unit()}computeSegPrevDir(e,t){return t[1].sub(e.prevPoint).unit()}clipLinesToTile(e,t){return bf(e,-t,-t,Lr+t,Lr+t)}clipRuntimeLinesToTile(e,t){const n=[];return[bf(e,-t,-t,Lr+t,Lr+t,n),n]}addElevatedRoadFeature(e,t,n,r,i,o,s,a){const l=[],c=Hc.getElevationFeature(e,r);if(c){const e=this.clipLinesToTile(t,1),r=this.prepareElevatedLines(e,c,n);for(const t of r)l.push({geometry:t,elevation:c,elevationTileID:n,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(0===l.length)return!1;for(const u of l){const t=this.layoutVertexArray.length;this.addLine(u.geometry,e,n,i,o,s,a);const r=new $c(n,u.elevationTileID);if(u.elevation)for(let e=t;e<this.layoutVertexArray.length;e++){const t=new xe(this.layoutVertexArray.int16[6*e]>>1,this.layoutVertexArray.int16[6*e+1]>>1),n=r.pointElevation(t,u.elevation,.05);this.updateHeightRange(n),this.zOffsetVertexArray.emplaceBack(n,0,0)}else this.fillNonElevatedRoadSegment(t)}return!0}prepareElevatedLines(e,t,n){if(null!=t.constantHeight)return e;const r=[],i=1/lc(n);for(const o of e)wf(o,new Vc(t,i),0,r);return r}fillNonElevatedRoadSegment(e){for(let t=e;t<this.layoutVertexArray.length;t++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,t,n,r,i,o,s,a){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const l="none"===r;this.patternJoinNone=this.hasPattern&&l,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const c=a&&a.progress.min>0,u=a&&a.progress.max<1;if(this.lineClips){let n={min:this.lineClips.start,max:this.lineClips.end},r=1;if(a){const e=this.lineClips.end-this.lineClips.start;n=function(e,t,n){return{min:nt(e.min,t,n),max:nt(e.max,t,n)}}(a.progress,{min:0,max:1},n),e>0&&(r=(n.max-n.min)/e)}const i=+t.properties.mapbox_clip_feature_len,o=+t.properties.mapbox_clip_seg_len;if(Number.isNaN(i)||Number.isNaN(o)){for(let n=0;n<e.length-1;n++)this.totalDistance+=e[n].dist(e[n+1]);const t=this.totalDistance/(n.max-n.min);this.totalFeatureLength=Number.isFinite(t)?t:0,this.lineClips.start=n.min,this.lineClips.end=n.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=i,this.distance=o*r,this.lineClips.start=n.min,this.lineClips.end=n.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const h="Polygon"===gm[t.type];let d=e.length;for(;d>=2&&e[d-1].equals(e[d-2]);)d--;let f=0;for(;f<d-1&&e[f].equals(e[f+1]);)f++;if(d<(h?3:2))return;"bevel"===r&&(o=1.05);const p=this.segments.prepareSegment(10*d,this.layoutVertexArray,this.indexArray);let m,g,_,y,v,x,b,w;a&&a.prevDir&&(x=a.prevDir.perp()),a&&a.nextDir&&(b=a.nextDir.perp()),this.e1=this.e2=-1,h&&(m=e[d-2],v=e[f].sub(m)._unit()._perp());for(let S=f;S<d;S++){if(_=S===d-1?h?e[f+1]:void 0:e[S+1],_&&e[S].equals(_))continue;v&&(y=v),m&&(g=m),m=e[S],w=this.evaluateLineProgressFeatures(g?g.dist(m):0),v=_?_.sub(m)._unit()._perp():y,y=y||v;const t=g&&_;let n=t?r:h||l?"butt":i;const a=y.x*v.x+y.y*v.y;if(l){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,n=e.lineSoFar-e.segmentStart;for(let r=0;r<t;++r){const t=e.segmentPoints[2*r+1],i=Math.round(e.segmentPoints[2*r])+.5+.25*t;e.patternVertexArray.emplaceBack(i,n,e.segmentStart),e.patternVertexArray.emplaceBack(i,n,e.segmentStart)}e.segmentPoints.length=0}e.e1=e.e2=-1};if(t&&a<ym){this.updateDistance(g,m),this.addCurrentVertex(m,y,1,1,p,w),e(this),this.addCurrentVertex(m,v,-1,-1,p,w);continue}if(g){if(!_){this.updateDistance(g,m),this.addCurrentVertex(m,y,1,1,p,w),e(this);continue}n="miter"}}let E=y.add(v);0===E.x&&0===E.y||E._unit();const T=E.x*v.x+E.y*v.y,A=0!==T?1/T:1/0,C=2*Math.sqrt(2-2*T),P=T<_m&&g&&_,I=y.x*v.y-y.y*v.x>0,k=this.overscaling<=16?15*Lr/(512*this.overscaling):0;if(t&&"round"===n)if(A<s)n="miter";else if(A<=2){const e=xm(m,-10,Lr+10);n="offset"===this.elevationType&&(e||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===n&&A>o&&(n="bevel"),"bevel"===n&&(A>2&&(n="flipbevel"),A<o&&(n="miter")),g&&!("miter"===n&&P)&&this.updateDistance(g,m),"miter"===n)if(P){const e=m.dist(g);if(e>2*k){const t=m.sub(m.sub(g)._mult(k/e)._round());this.updateDistance(g,t),this.addCurrentVertex(t,y,0,0,p,w),g=t}this.updateDistance(g,m),E._mult(A),this.addCurrentVertex(m,E,0,0,p,w);const t=m.dist(_);if(t>2*k){const e=m.add(_.sub(m)._mult(k/t)._round());this.updateDistance(m,e),this.addCurrentVertex(e,v,0,0,p,w),m=e}}else E._mult(A),this.addCurrentVertex(m,E,0,0,p,w);else if("flipbevel"===n){if(A>100)E=v.mult(-1);else{const e=A*y.add(v).mag()/y.sub(v).mag();E._perp()._mult(e*(I?-1:1))}this.addCurrentVertex(m,E,0,0,p,w),this.addCurrentVertex(m,E.mult(-1),0,0,p,w)}else if("bevel"===n||"fakeround"===n){null!=w&&g&&this.addCurrentVertex(m,b||y,-1,-1,p,w);const e=m.dist(g)<=2*k&&"bevel"!==n,t=E.mult(I?1:-1);t._mult(A);const r=v.mult(I?-1:1),i=y.mult(I?-1:1),o=this.evaluateLineProgressFeatures(this.distance);if(null==w&&(this.addHalfVertex(m,t.x,t.y,!1,!I,0,p,o),e||this.addHalfVertex(m,t.x+2*i.x,t.y+2*i.y,!1,I,0,p,o)),"fakeround"===n){const e=Math.round(180*C/Math.PI/20);this.addHalfVertex(m,i.x,i.y,!1,I,0,p,o);for(let t=0;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+a*(a*(3.55645-1.43519*a)-3.2452))*e*e+(.848013+a*(.215638*a-1.06021)))}const s=r.sub(i)._mult(n)._add(i)._unit();this.addHalfVertex(m,s.x,s.y,!1,I,0,p,o)}this.addHalfVertex(m,r.x,r.y,!1,I,0,p,o)}e||null!=w||this.addHalfVertex(m,t.x+2*r.x,t.y+2*r.y,!1,I,0,p,o),null!=w&&_&&this.addCurrentVertex(m,x||v,1,1,p,w)}else if("butt"===n)this.addCurrentVertex(m,E,0,0,p,w);else if("square"===n){if(!g){const e=c?0:-1;this.addCurrentVertex(m,E,e,e,p,w)}if(this.addCurrentVertex(m,E,0,0,p,w),g){const e=u?0:1;this.addCurrentVertex(m,E,e,e,p,w)}}else if("round"===n){if(g){const e=!t&&b?b:y;this.addCurrentVertex(m,e,0,0,p,w),!t&&u||this.addCurrentVertex(m,e,1,1,p,w,!0)}if(_){const e=!t&&x?x:v;!t&&c||this.addCurrentVertex(m,e,-1,-1,p,w,!0),this.addCurrentVertex(m,e,0,0,p,w)}}}}addVerticesTo(e,t,n,r,i,o,s,a,l,c){const u=(t.w-e.w)/this.tessellationStep|0;let h=0;const d=this.scaledDistance;if(u>1){this.lineSoFar=e.w;const d=(t.x-e.x)/u,f=(t.y-e.y)/u,p=(t.z-e.z)/u,m=(t.w-e.w)/u;for(let t=1;t<u;++t){e.x+=d,e.y+=f,e.z+=p,this.lineSoFar+=m,h+=m;const t=this.evaluateLineProgressFeatures(this.prevDistance+h);this.scaledDistance=(this.prevDistance+h)/this.totalDistance,this.addHalfVertex(e,n,r,c,!1,s,l,t),this.addHalfVertex(e,i,o,c,!0,-a,l,t)}}this.lineSoFar=t.w,this.scaledDistance=d;const f=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(t,n,r,c,!1,s,l,f),this.addHalfVertex(t,i,o,c,!0,-a,l,f)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):He(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let t=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(t=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:t}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:t}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:t}}addCurrentVertex(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=t.x+t.y*n,l=t.y-t.x*n,c=t.y*r-t.x,u=-t.y-t.x*r;if(null!=o){const t="offset"===this.elevationType,h=-10,d=Lr+10,f=o.zOffset,p=new yf(e.x,e.y,f,this.lineSoFar),m=!!t&&xm(e,h,d),g=this.lineSoFar,_=this.distance;if(this.currentVertex)if(m){const t=this.currentVertexIsOutside,o=this.currentVertex,m=new yf(e.x,e.y,f,this.lineSoFar);if(xf(o,m,h,d),!xm(m,h,d)){if(t){this.e1=this.e2=-1,this.distance-=o.dist(p),this.lineSoFar=o.w;const e=this.evaluateLineProgressFeatures(o.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(o,a,l,s,!1,n,i,e),this.addHalfVertex(o,c,u,s,!0,-r,i,e),this.prevDistance=this.distance}this.distance=this.prevDistance+o.dist(m),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(o,m,a,l,c,u,n,r,i,s),this.distance=_,this.scaledDistance=this.distance/this.totalDistance}}else{const e=this.currentVertex;if(this.currentVertexIsOutside){xf(e,p,h,d),this.e1=this.e2=-1,this.distance-=e.dist(p),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e.w;const t=this.evaluateLineProgressFeatures(e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(e,a,l,s,!1,n,i,t),this.addHalfVertex(e,c,u,s,!0,-r,i,t),this.prevDistance=this.distance,this.distance=_,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(e,p,a,l,c,u,n,r,i,s)}else m||(this.addHalfVertex(e,a,l,s,!1,n,i,o),this.addHalfVertex(e,c,u,s,!0,-r,i,o));this.currentVertex=p,this.currentVertexIsOutside=m,this.lineSoFar=g}else this.addHalfVertex(e,a,l,s,!1,n,i,o),this.addHalfVertex(e,c,u,s,!0,-r,i,o)}addHalfVertex(e,t,n,r,i,o,s,a){let{x:l,y:c}=e;if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),i||this.segmentPoints.push(this.lineSoFar-this.segmentStart,o)),this.layoutVertexArray.emplaceBack((l<<1)+(r?1:0),(c<<1)+(i?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const e=un(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,e)}const u=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),s.primitiveLength++),i?this.e2=u:this.e1=u,null!=a&&this.zOffsetVertexArray.emplaceBack(a.zOffset,a.variableWidth,a.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.prevDistance=this.distance,this.distance+=e.dist(t),this.updateScaledDistance()}}function xm(e,t,n){return e.x<t||e.x>n||e.y<t||e.y>n}let bm,wm;function Sm(e,t,n){return t*(Lr/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}qo(vm,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Em=(e,t,n)=>(1-n)*e+n*t;function Tm(e,t){return 1/Sm(e,1,t.tileZoom)}function Am(e,t,n,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Cm=e=>{const t=[];Pm(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const r="none"===e.layout.get("line-join").constantOr("miter"),i=!!e.paint.get("line-pattern").constantOr(1);return r&&i&&t.push("LINE_JOIN_NONE"),t};function Pm(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}let Im;const km=()=>Im||(Im={layout:bm||(bm=new ks({"line-cap":new Ps(Ms.layout_line["line-cap"]),"line-join":new Ps(Ms.layout_line["line-join"]),"line-miter-limit":new Cs(Ms.layout_line["line-miter-limit"]),"line-round-limit":new Cs(Ms.layout_line["line-round-limit"]),"line-sort-key":new Ps(Ms.layout_line["line-sort-key"]),"line-z-offset":new Ps(Ms.layout_line["line-z-offset"]),"line-elevation-reference":new Cs(Ms.layout_line["line-elevation-reference"]),"line-cross-slope":new Cs(Ms.layout_line["line-cross-slope"]),visibility:new Cs(Ms.layout_line.visibility),"line-width-unit":new Cs(Ms.layout_line["line-width-unit"])})),paint:wm||(wm=new ks({"line-opacity":new Ps(Ms.paint_line["line-opacity"]),"line-color":new Ps(Ms.paint_line["line-color"]),"line-translate":new Cs(Ms.paint_line["line-translate"]),"line-translate-anchor":new Cs(Ms.paint_line["line-translate-anchor"]),"line-width":new Ps(Ms.paint_line["line-width"]),"line-gap-width":new Ps(Ms.paint_line["line-gap-width"]),"line-offset":new Ps(Ms.paint_line["line-offset"]),"line-blur":new Ps(Ms.paint_line["line-blur"]),"line-dasharray":new Ps(Ms.paint_line["line-dasharray"]),"line-pattern":new Ps(Ms.paint_line["line-pattern"]),"line-pattern-cross-fade":new Cs(Ms.paint_line["line-pattern-cross-fade"]),"line-gradient":new Is(Ms.paint_line["line-gradient"]),"line-trim-offset":new Cs(Ms.paint_line["line-trim-offset"]),"line-trim-fade-range":new Cs(Ms.paint_line["line-trim-fade-range"]),"line-trim-color":new Cs(Ms.paint_line["line-trim-color"]),"line-emissive-strength":new Cs(Ms.paint_line["line-emissive-strength"]),"line-border-width":new Ps(Ms.paint_line["line-border-width"]),"line-border-color":new Ps(Ms.paint_line["line-border-color"]),"line-occlusion-opacity":new Cs(Ms.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},Im);class Mm extends Ps{possiblyEvaluate(e,t){return t=new ys(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition,worldview:t.worldview}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,r){return t=Le({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,r)}}let Rm;function Om(e,t){return t>0?t+2*e:e}const Lm=ta([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dm=ta([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Nm=ta([{name:"a_projected_pos",components:4,type:"Float32"}],4);ta([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zm=ta([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Fm=ta([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Bm=ta([{name:"a_texb",components:2,type:"Uint16"}]),jm=ta([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Um=ta([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ta([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vm=ta([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gm=ta([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ta([{name:"triangle",components:3,type:"Uint16"}]),ta([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ta([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ta([{type:"Float32",name:"offsetX"}]),ta([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Hm=24;function $m(e,t,n){return e.sections.forEach(e=>{e.text=function(e,t,n){const r=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),_s.applyArabicShaping&&(e=_s.applyArabicShaping(e)),e}(e.text,t,n)}),e}const Wm={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function qm(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function Xm(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const Zm=4294967296,Km=1/Zm,Ym="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");let Jm=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array(16);this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length;for(;this.pos<n;){const n=this.readVarint(),r=n>>3,i=this.pos;this.type=7&n,e(r,t,this),this.pos===i&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Zm;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Zm;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let n,r;return r=t[this.pos++],n=127&r,r<128?n:(r=t[this.pos++],n|=(127&r)<<7,r<128?n:(r=t[this.pos++],n|=(127&r)<<14,r<128?n:(r=t[this.pos++],n|=(127&r)<<21,r<128?n:(r=t[this.pos],n|=(15&r)<<28,function(e,t,n){const r=n.buf;let i,o;if(o=r[n.pos++],i=(112&o)>>4,o<128)return Qm(e,i,t);if(o=r[n.pos++],i|=(127&o)<<3,o<128)return Qm(e,i,t);if(o=r[n.pos++],i|=(127&o)<<10,o<128)return Qm(e,i,t);if(o=r[n.pos++],i|=(127&o)<<17,o<128)return Qm(e,i,t);if(o=r[n.pos++],i|=(127&o)<<24,o<128)return Qm(e,i,t);if(o=r[n.pos++],i|=(1&o)<<31,o<128)return Qm(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(n,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Ym?Ym.decode(this.buf.subarray(t,e)):function(e,t,n){let r="",i=t;for(;i<n;){const t=e[i];let o,s,a,l=null,c=t>239?4:t>223?3:t>191?2:1;if(i+c>n)break;1===c?t<128&&(l=t):2===c?(o=e[i+1],128==(192&o)&&(l=(31&t)<<6|63&o,l<=127&&(l=null))):3===c?(o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(l=(15&t)<<12|(63&o)<<6|63&s,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&t)<<18|(63&o)<<12|(63&s)<<6|63&a,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readVarint(t));return e}readPackedSVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Km),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Km),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(n=~(-e%4294967296),r=~(-e/4294967296),4294967295^n?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){const n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,n){for(let r,i,o=0;o<t.length;o++){if(r=t.charCodeAt(o),r>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);const n=this.pos-t;n>=128&&eg(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let n=0;n<t;n++)this.buf[this.pos++]=e[n]}writeRawMessage(e,t){this.pos++;const n=this.pos;e(t,this);const r=this.pos-n;r>=128&&eg(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r}writeMessage(e,t,n){this.writeTag(e,2),this.writeRawMessage(t,n)}writePackedVarint(e,t){t.length&&this.writeMessage(e,tg,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,ng,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,og,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,rg,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,ig,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,sg,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,ag,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,lg,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,cg,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function Qm(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function eg(e,t,n){const r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(let i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function tg(e,t){for(let n=0;n<e.length;n++)t.writeVarint(e[n])}function ng(e,t){for(let n=0;n<e.length;n++)t.writeSVarint(e[n])}function rg(e,t){for(let n=0;n<e.length;n++)t.writeFloat(e[n])}function ig(e,t){for(let n=0;n<e.length;n++)t.writeDouble(e[n])}function og(e,t){for(let n=0;n<e.length;n++)t.writeBoolean(e[n])}function sg(e,t){for(let n=0;n<e.length;n++)t.writeFixed32(e[n])}function ag(e,t){for(let n=0;n<e.length;n++)t.writeSFixed32(e[n])}function lg(e,t){for(let n=0;n<e.length;n++)t.writeFixed64(e[n])}function cg(e,t){for(let n=0;n<e.length;n++)t.writeSFixed64(e[n])}const ug=3;function hg(e,t,n){t.glyphs=[],1===e&&n.readMessage(dg,t)}function dg(e,t,n){if(3===e){const{id:e,bitmap:r,width:i,height:o,left:s,top:a,advance:l}=n.readMessage(fg,{});t.glyphs.push({id:e,bitmap:new hh({width:i+2*ug,height:o+2*ug},r),metrics:{width:i,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function fg(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const pg=ug,mg={horizontal:1,vertical:2,horizontalOnly:3};class gg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,t){const n=new gg;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new gg;return t.image=e,t}}class _g{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t,n){const r=new _g;for(let i=0;i<e.sections.length;i++){const o=e.sections[i];o.image?r.addImageSection(o,n):r.addTextSection(o,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let n="";for(let r=0;r<e.length;r++){const i=e.charCodeAt(r+1)||null,o=e.charCodeAt(r-1)||null;n+=!t&&(i&&rs(i)&&!Wm[e[r+1]]||o&&rs(o)&&!Wm[e[r-1]])||!Wm[e[r]]?e[r]:Wm[e[r]]}return n}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&vg[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&vg[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new _g;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(gg.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let r=0;r<e.text.length;++r)this.sectionIndex.push(n)}addImageSection(e,t){const n=e.image?e.image.getPrimary():null;if(!n)return void He("Can't add FormattedSection with an empty image.");n.scaleSelf(t);const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(gg.forImage(n)),this.sectionIndex.push(this.sections.length-1)):He("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yg(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p){let m=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;const g=_g.fromFeature(e,i,m);h===mg.vertical&&g.verticalizePunctuation(d);let _=[];const y=function(e,t,n,r,i,o){if(!e)return[];const s=[],a=function(e,t,n,r,i,o){let s=0;for(let a=0;a<e.length();a++){const n=e.getSection(a);s+=bg(e.getCodePoint(a),n,r,i,t,o)}return s/Math.max(1,Math.ceil(s/n))}(e,t,n,r,i,o),l=e.text.indexOf("\u200b")>=0;let c=0;for(let h=0;h<e.length();h++){const n=e.getSection(h),d=e.getCodePoint(h);if(vg[d]||(c+=bg(d,n,r,i,t,o)),h<e.length()-1){const t=!((u=d)<11904||!(Jo["Bopomofo Extended"](u)||Jo.Bopomofo(u)||Jo["CJK Compatibility Forms"](u)||Jo["CJK Compatibility Ideographs"](u)||Jo["CJK Compatibility"](u)||Jo["CJK Radicals Supplement"](u)||Jo["CJK Strokes"](u)||Jo["CJK Symbols and Punctuation"](u)||Jo["CJK Unified Ideographs Extension A"](u)||Jo["CJK Unified Ideographs"](u)||Jo["Enclosed CJK Letters and Months"](u)||Jo["Halfwidth and Fullwidth Forms"](u)||Jo.Hiragana(u)||Jo["Ideographic Description Characters"](u)||Jo["Kangxi Radicals"](u)||Jo["Katakana Phonetic Extensions"](u)||Jo.Katakana(u)||Jo["Vertical Forms"](u)||Jo["Yi Radicals"](u)||Jo["Yi Syllables"](u)));(xg[d]||t||n.image)&&s.push(Eg(h+1,c,a,s,Sg(d,e.getCodePoint(h+1),t&&l),!1))}}var u;return Tg(Eg(e.length(),c,a,s,0,!0))}(g,c,o,t,r,f),{processBidirectionalText:v,processStyledBidirectionalText:x}=_s;if(v&&1===g.sections.length){const e=v(g.toString(),y);for(const t of e){const e=new _g;e.text=t,e.sections=g.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);_.push(e)}}else if(x){const e=x(g.text,g.sectionIndex,y);for(const t of e){const e=new _g;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,_.push(e)}}else _=function(e,t){const n=[],r=e.text;let i=0;for(const o of t)n.push(e.substring(i,o)),i=o;return i<r.length&&n.push(e.substring(i,r.length)),n}(g,y);const b=[],w={positionedLines:b,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(e,t,n,r,i,o,s,a,l,c,u,h){let d=0,f=0,p=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const w of i){const e=w.getSections();for(const n of e){if(n.image)continue;const e=t[n.fontStack];if(e&&(g=void 0!==e.ascender&&void 0!==e.descender,!g))break}if(!g)break}let _=0;for(const w of i){w.trim();const i=w.getMaxScale(),s=(i-1)*Hm,a={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=a;const v=a.positionedGlyphs;let x=0;if(!w.length()){f+=o,++_;continue}let b=0,S=0;for(let o=0;o<w.length();o++){const s=w.getSection(o),a=w.getSectionIndex(o),p=w.getCodePoint(o);let m=s.scale,_=null,E=null,T=null,A=Hm,C=0,P=l;P===mg.vertical&&(12312===(y=p)||12313===y||12316===y||12540===y||12448===y)&&(P=mg.horizontal);const I=!(P===mg.horizontal||!u&&!ns(p)||u&&(vg[p]||is(p)));if(s.image){const t=r.get(s.image.toString());if(!t)continue;T=s.image,e.iconsInText=e.iconsInText||!0,E=t.paddedRect;const n=t.displaySize;m=m*Hm/h,_={width:n[0],height:n[1],left:0,top:-pg,advance:I?n[1]:n[0],localGlyph:!1},C=g?-_.height*m:i*Hm-17-n[1]*m,A=_.advance;const o=(I?n[0]:n[1])*m-Hm*i;o>0&&o>x&&(x=o)}else{const e=n[s.fontStack];if(!e)continue;e[p]&&(E=e[p]);const r=t[s.fontStack];if(!r)continue;const o=r.glyphs[p];if(!o)continue;if(_=o.metrics,A=8203!==p?Hm:0,g){const e=void 0!==r.ascender?Math.abs(r.ascender):0,t=void 0!==r.descender?Math.abs(r.descender):0,n=(e+t)*m;b<n&&(b=n,S=(e-t)/2*m),C=-e*m}else C=(i-m)*Hm-17}I?(e.verticalizable=!0,v.push({glyph:p,image:T,x:d,y:f+C,vertical:I,scale:m,localGlyph:_.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:_,rect:E}),d+=A*m+c):(v.push({glyph:p,image:T,x:d,y:f+C,vertical:I,scale:m,localGlyph:_.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:_,rect:E}),d+=_.advance*m+c)}0!==v.length&&(p=Math.max(d-c,p),g?Cg(v,m,x,S,o*i/2):Cg(v,m,x,0,o/2)),d=0;const E=o*i+x;a.lineOffset=Math.max(x,s),f+=E,++_}var y;const v=f,{horizontalAlign:x,verticalAlign:b}=Ag(s);(function(e,t,n,r,i,o){const s=(t-n)*i,a=-o*r;for(const l of e)for(const e of l.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,x,b,p,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*p,e.right=e.left+p,e.hasBaseline=g}(w,t,n,r,_,s,a,l,h,c,d,p),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b))return w}const vg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bg(e,t,n,r,i,o){if(t.image){const e=r.get(t.image.toString());return e?e.displaySize[0]*t.scale*Hm/o+i:0}{const r=n[t.fontStack],o=r&&r.glyphs[e];return o?o.metrics.advance*t.scale+i:0}}function wg(e,t,n,r){const i=Math.pow(e-t,2);return r?e<t?i/2:2*i:i+Math.abs(n)*n}function Sg(e,t,n){let r=0;return 10===e&&(r-=1e4),n&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function Eg(e,t,n,r,i,o){let s=null,a=wg(t,n,i,o);for(const l of r){const e=wg(t-l.x,n,i,o)+l.badness;e<=a&&(s=l,a=e)}return{index:e,x:t,priorBreak:s,badness:a}}function Tg(e){return e?Tg(e.priorBreak).concat(e.index):[]}function Ag(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Cg(e,t,n,r,i){if(!(t||n||r||i))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let l=0;l<=o;l++)e[l].x-=a,e[l].y+=n+r+i}function Pg(e){return void 0!==e.imagePrimary&&void 0!==e.top&&void 0!==e.bottom&&void 0!==e.left&&void 0!==e.right}function Ig(e,t,n,r){const{horizontalAlign:i,verticalAlign:o}=Ag(r),s=n[0]-e.displaySize[0]*i,a=n[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function kg(e,t,n,r,i,o){const s=e.imagePrimary;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,f;"width"===n||"both"===n?(f=i[0]+l-r[3],h=i[0]+c+r[1]):(f=i[0]+(l+c-s.displaySize[0])/2,h=f+s.displaySize[0]);const p=t.top*o,m=t.bottom*o;return"height"===n||"both"===n?(u=i[1]+p-r[0],d=i[1]+m+r[2]):(u=i[1]+(p+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:f,collisionPadding:a}}function Mg(e){return!e.imagePrimary.stretchX}function Rg(e){return!e.imagePrimary.stretchY}function Og(e){return{width:e.right-e.left,height:e.bottom-e.top}}const Lg=128;function Dg(e,t,n){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new ys(e+1,{worldview:n}))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=r;let o=0;for(;o<t.length&&t[o]<=e;)o++;o=Math.max(0,o-1);let s=o;for(;s<t.length&&t[s]<e+1;)s++;s=Math.min(t.length-1,s);const a=t[o],l=t[s];return"composite"===r.kind?{kind:"composite",minZoom:a,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:a,maxZoom:l,minSize:r.evaluate(new ys(a,{worldview:n})),maxSize:r.evaluate(new ys(l,{worldview:n})),interpolationType:i}}}function Ng(e,t,n){let{uSize:r,uSizeT:i}=t,{lowerSize:o,upperSize:s}=n;return"source"===e.kind?o/Lg:"composite"===e.kind?un(o/Lg,s/Lg,i):r}function zg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=0,i=0;if("constant"===e.kind)i=e.layoutSize*n;else if("source"!==e.kind){const{interpolationType:o,minZoom:s,maxZoom:a}=e,l=o?ke(Vi.interpolationFactor(o,t,s,a),0,1):0;"camera"===e.kind?i=un(e.minSize,e.maxSize,l)*n:r=l*n}return{uSizeT:r,uSize:i}}class Fg extends xe{constructor(e,t,n,r,i){super(e,t),this.angle=r,this.z=n,void 0!==i&&(this.segment=i)}clone(){return new Fg(this.x,this.y,this.z,this.angle,this.segment)}}function Bg(e,t,n,r,i){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let o=e[s-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>i)return!1;s++,a+=t.dist(n)}return!0}function jg(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Ug(e,t,n){return e?.6*t*n:0}function Vg(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Gg(e,t,n,r,i,o){const s=Ug(n,i,o),a=Vg(n,r)*o;let l=0;const c=jg(e)/2;for(let u=0;u<e.length-1;u++){const n=e[u],r=e[u+1],i=n.dist(r);if(l+i>c){const o=(c-l)/i,h=un(n.x,r.x,o),d=un(n.y,r.y,o),f=new Fg(h,d,0,r.angleTo(n),u);return!s||Bg(e,f,a,s,t)?f:void 0}l+=i}}function Hg(e,t,n,r,i,o,s,a,l){const c=Ug(r,o,s),u=Vg(r,i),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),$g(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,n,h,d,!1,l)}function $g(e,t,n,r,i,o,s,a,l){const c=o/2,u=jg(e);let h=0,d=t-n,f=[];for(let p=0;p<e.length-1;p++){const t=e[p],s=e[p+1],a=t.dist(s),m=s.angleTo(t);for(;d+n<h+a;){d+=n;const g=(d-h)/a,_=un(t.x,s.x,g),y=un(t.y,s.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const t=new Fg(_,y,0,m,p);r&&!Bg(e,t,o,r,i)||f.push(t)}}h+=a}return a||f.length||s||(f=$g(e,h/2,n,r,i,o,s,!0,l)),f}function Wg(e){let t=0,n=0;for(const s of e)t+=s.w*s.h,n=Math.max(n,s.w);e.sort((e,t)=>t.h-e.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let i=0,o=0;for(const s of e)for(let e=r.length-1;e>=0;e--){const t=r[e];if(!(s.w>t.w||s.h>t.h)){if(s.x=t.x,s.y=t.y,o=Math.max(o,s.y+s.h),i=Math.max(i,s.x+s.w),s.w===t.w&&s.h===t.h){const t=r.pop();t&&e<r.length&&(r[e]=t)}else s.h===t.h?(t.x+=s.w,t.w-=s.w):s.w===t.w?(t.y+=s.h,t.h-=s.h):(r.push({x:t.x+s.w,y:t.y,w:t.w-s.w,h:s.h}),t.y+=s.h,t.h-=s.h);break}}return{w:i,h:o,fill:t/(i*o)||0}}qo(Fg,"Anchor");const qg=1;class Xg{static getImagePositionScale(e,t,n){if(t&&e&&e.options&&e.options.transform){const t=e.options.transform;return{x:t.a,y:t.d}}return{x:n,y:n}}constructor(e,t,n,r){this.paddedRect=e;const{pixelRatio:i,version:o,stretchX:s,stretchY:a,content:l,sdf:c,usvg:u}=t;this.pixelRatio=i,this.stretchX=s,this.stretchY=a,this.content=l,this.version=o,this.padding=n,this.sdf=c,this.usvg=u,this.scale=Xg.getImagePositionScale(r,u,i)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Zg(e,t,n){const r=Nn.parse(e),i=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1];return{x:0,y:0,w:(e.data?e.data.width:e.width*n[0])+2*t,h:(e.data?e.data.height:e.height*n[1])+2*t}}(t,n,[r.options.transform.a,r.options.transform.d]);return{bin:i,imagePosition:new Xg(i,t,n,r),imageVariant:r}}class Kg{constructor(e,t,n){const r=new Map,i=new Map;this.haveRenderCallbacks=[];const o=[];this.addImages(e,r,qg,o),this.addImages(t,i,2,o);const{w:s,h:a}=Wg(o),l=new dh({width:s||1,height:a||1});for(const[c,u]of e.entries()){const e=r.get(c).paddedRect;dh.copy(u.data,l,{x:0,y:0},{x:e.x+qg,y:e.y+qg},u.data,n,u.sdf)}for(const[c,u]of t.entries()){const e=i.get(c),t=e.paddedRect;let r=e.padding;const o=t.x+r,s=t.y+r,a=u.data.width,h=u.data.height;r=r>1?r-1:r,dh.copy(u.data,l,{x:0,y:0},{x:o,y:s},u.data,n),dh.copy(u.data,l,{x:0,y:h-r},{x:o,y:s-r},{width:a,height:r},n),dh.copy(u.data,l,{x:0,y:0},{x:o,y:s+h},{width:a,height:r},n),dh.copy(u.data,l,{x:a-r,y:0},{x:o-r,y:s},{width:r,height:h},n),dh.copy(u.data,l,{x:0,y:0},{x:o+a,y:s},{width:r,height:h},n),dh.copy(u.data,l,{x:a-r,y:h-r},{x:o-r,y:s-r},{width:r,height:r},n),dh.copy(u.data,l,{x:0,y:h-r},{x:o+a,y:s-r},{width:r,height:r},n),dh.copy(u.data,l,{x:0,y:0},{x:o+a,y:s+h},{width:r,height:r},n),dh.copy(u.data,l,{x:a-r,y:0},{x:o-r,y:s+h},{width:r,height:r},n)}this.lut=n,this.image=l,this.iconPositions=r,this.patternPositions=i}addImages(e,t,n,r){for(const[i,o]of e.entries()){const{bin:e,imagePosition:s,imageVariant:a}=Zg(i,o,n);t.set(i,s),r.push(e),o.hasRenderCallback&&this.haveRenderCallbacks.push(a.id)}}patchUpdatedImages(e,t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(t=>e.hasImage(t,n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const r of e.getUpdatedImages(n)){for(const i of this.iconPositions.keys()){const o=Nn.parse(i);if(tn.isEqual(o.id,r)){const o=e.getImage(r,n);this.patchUpdatedImage(this.iconPositions.get(i),o,t)}}for(const i of this.patternPositions.keys()){const o=Nn.parse(i);if(tn.isEqual(o.id,r)){const o=e.getImage(r,n);this.patchUpdatedImage(this.patternPositions.get(i),o,t)}}}}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,i]=e.tl,o=e.sdf;if(this.lut||o){const e={width:t.data.width,height:t.data.height},s=new dh(e);dh.copy(t.data,s,{x:0,y:0},{x:0,y:0},e,this.lut,o),n.update(s,{position:{x:r,y:i}})}else n.update(t.data,{position:{x:r,y:i}})}}qo(Xg,"ImagePosition"),qo(Kg,"ImageAtlas");const Yg=1e20;function Jg(e,t,n,r,i,o,s,a,l){for(let c=t;c<t+r;c++)Qg(e,n*o+c,o,i,s,a,l);for(let c=n;c<n+i;c++)Qg(e,c*o+t,1,r,s,a,l)}function Qg(e,t,n,r,i,o,s){o[0]=0,s[0]=-Yg,s[1]=Yg,i[0]=e[t];for(let a=1,l=0,c=0;a<r;a++){i[a]=e[t+a*n];const r=a*a;do{const e=o[l];c=(i[a]-i[e]+r-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=Yg}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;e[t+a*n]=i[r]+c*c}}const e_=2,t_={none:0,ideographs:1,all:2};class n_{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const n=[],r=this.url||rt.GLYPHS_URL;for(const i in e)for(const t of e[i])n.push({stack:i,id:t});Oe(n,(e,t)=>{let{stack:n,id:i}=e,o=this.entries[n];o||(o=this.entries[n]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let s=o.glyphs[i];if(void 0!==s)return void t(null,{stack:n,id:i,glyph:s});if(s=this._tinySDF(o,n,i),s)return o.glyphs[i]=s,void t(null,{stack:n,id:i,glyph:s});const a=Math.floor(i/256);if(256*a>65535)return He("glyphs > 65535 not supported"),void t(null,{stack:n,id:i,glyph:s});if(o.ranges[a])return void t(null,{stack:n,id:i,glyph:s});let l=o.requests[a];l||(l=o.requests[a]=[],n_.loadGlyphRange(n,a,r,this.requestManager,(e,t)=>{if(t){o.ascender=t.ascender,o.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(o.glyphs[+e]=t.glyphs[+e]);o.ranges[a]=!0}for(const n of l)n(e,t);delete o.requests[a]})),l.push((e,r)=>{e?t(e):r&&t(null,{stack:n,id:i,glyph:r.glyphs[i]||null})})},(e,n)=>{if(e)t(e);else if(n){const e={};for(const{stack:t,id:r,glyph:i}of n)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[r]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==t_.none&&(this.localGlyphMode===t_.all?!!this.localFontFamily:!!this.localFontFamily&&(Jo["CJK Unified Ideographs"](e)||Jo["Hangul Syllables"](e)||Jo.Hiragana(e)||Jo.Katakana(e)||Jo["CJK Symbols and Punctuation"](e)||Jo["CJK Unified Ideographs Extension A"](e)||Jo["CJK Unified Ideographs Extension B"](e)||Jo.Osage(e)))}_tinySDF(e,t,n){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(n))return;let i=e.tinySDF;if(!i){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),i=e.tinySDF=new n_.TinySDF({fontFamily:r,fontWeight:n,fontSize:24*e_,buffer:3*e_,radius:8*e_}),i.fontWeight=n}if(this.localGlyphs[i.fontWeight][n])return this.localGlyphs[i.fontWeight][n];const o=String.fromCodePoint(n),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:f}=i.draw(o);return this.localGlyphs[i.fontWeight][n]={id:n,bitmap:new hh({width:a,height:l},s),metrics:{width:c/e_,height:u/e_,left:h/e_,top:d/e_-27,advance:f/e_,localGlyph:!0}}}}n_.loadGlyphRange=function(e,t,n,r,i){const o=256*t,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),Rt.Glyphs);Nt(a,(e,t)=>{if(e)i(e);else if(t){const e={},n=function(e){return new Jm(e).readFields(hg,{})}(t);for(const t of n.glyphs)e[t.id]=t;i(null,{glyphs:e,ascender:n.ascender,descender:n.descender})}})},n_.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:n=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=r,this.radius=n;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${i}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),f={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return f;const{ctx:p,buffer:m,gridInner:g,gridOuter:_}=this;p.clearRect(m,m,a,l),p.fillText(e,m,m+s);const y=p.getImageData(m,m,a,l);_.fill(Yg,0,h),g.fill(0,0,h);for(let v=0;v<l;v++)for(let e=0;e<a;e++){const t=y.data[4*(v*a+e)+3]/255;if(0===t)continue;const n=(v+m)*c+e+m;if(1===t)_[n]=0,g[n]=Yg;else{const e=.5-t;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}Jg(_,0,0,c,u,c,this.f,this.v,this.z),Jg(g,m,m,a,l,c,this.f,this.v,this.z);for(let v=0;v<h;v++){const e=Math.sqrt(_[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return f}};const r_=qg;function i_(e,t){return e+t[1]-t[0]}function o_(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const o=[],s=e.imagePrimary,a=s.pixelRatio,l=s.paddedRect.w-2*r_,c=s.paddedRect.h-2*r_,u=(e.right-e.left)*i,h=(e.bottom-e.top)*i,d=s.stretchX||[[0,l]],f=s.stretchY||[[0,c]],p=d.reduce(i_,0),m=f.reduce(i_,0),g=l-p,_=c-m;let y=0,v=p,x=0,b=m,w=0,S=g,E=0,T=_;if(s.content&&r){const e=s.content;y=s_(d,0,e[0]),x=s_(f,0,e[1]),v=s_(d,e[0],e[2]),b=s_(f,e[1],e[3]),w=e[0]-y,E=e[1]-x,S=e[2]-e[0]-v,T=e[3]-e[1]-b}const A=(r,o,l,c)=>{const d=l_(r.stretch-y,v,u,e.left*i),f=c_(r.fixed-w,S,r.stretch,p),g=l_(o.stretch-x,b,h,e.top*i),_=c_(o.fixed-E,T,o.stretch,m),A=l_(l.stretch-y,v,u,e.left*i),C=c_(l.fixed-w,S,l.stretch,p),P=l_(c.stretch-x,b,h,e.top*i),I=c_(c.fixed-E,T,c.stretch,m),k=new xe(d,g),M=new xe(A,g),R=new xe(A,P),O=new xe(d,P),L=new xe(f/a,_/a),D=new xe(C/a,I/a),N=t*Math.PI/180;if(N){const e=Math.sin(N),t=Math.cos(N),n=[t,-e,e,t];k._matMult(n),M._matMult(n),O._matMult(n),R._matMult(n)}const z=r.stretch+r.fixed,F=l.stretch+l.fixed,B=o.stretch+o.fixed,j=c.stretch+c.fixed,U=e.imageSecondary;return{tl:k,tr:M,bl:O,br:R,texPrimary:{x:s.paddedRect.x+r_+z,y:s.paddedRect.y+r_+B,w:F-z,h:j-B},texSecondary:U?{x:U.paddedRect.x+r_+z,y:U.paddedRect.y+r_+B,w:F-z,h:j-B}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:D,minFontScaleX:S/a/u,minFontScaleY:T/a/h,isSDF:n}};if(r&&(s.stretchX||s.stretchY)){const e=a_(d,g,p),t=a_(f,_,m);for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];for(let e=0;e<t.length-1;e++)o.push(A(r,t[e],i,t[e+1]))}}else o.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function s_(e,t,n){let r=0;for(const i of e)r+=Math.max(t,Math.min(n,i[1]))-Math.max(t,Math.min(n,i[0]));return r}function a_(e,t,n){const r=[{fixed:-r_,stretch:0}];for(const[i,o]of e){const e=r[r.length-1];r.push({fixed:i-e.stretch,stretch:e.stretch}),r.push({fixed:i-e.stretch,stretch:e.stretch+(o-i)})}return r.push({fixed:t+r_,stretch:n}),r}function l_(e,t,n,r){return e/t*n+r}function c_(e,t,n,r){return e-t*n/r}function u_(e,t,n,r){const i=t+e.positionedLines[r].lineOffset;return 0===r?n+i/2:n+(i+(t+e.positionedLines[r-1].lineOffset))/2}function h_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=1/0,i=1/0,o=-1/0,s=-1/0;const a=e[0];for(let f=0;f<a.length;f++){const e=a[f];(!f||e.x<r)&&(r=e.x),(!f||e.y<i)&&(i=e.y),(!f||e.x>o)&&(o=e.x),(!f||e.y>s)&&(s=e.y)}const l=Math.min(o-r,s-i);let c=l/2;const u=new Or([],d_);if(0===l)return new xe(r,i);for(let f=r;f<o;f+=l)for(let t=i;t<s;t+=l)u.push(new f_(f+c,t+c,c,e));let h=function(e){let t=0,n=0,r=0;const i=e[0];for(let o=0,s=i.length,a=s-1;o<s;a=o++){const e=i[o],s=i[a],l=e.x*s.y-s.x*e.y;n+=(e.x+s.x)*l,r+=(e.y+s.y)*l,t+=3*l}return new f_(n/t,r/t,0,e)}(e),d=u.length;for(;u.length;){const r=u.pop();(r.d>h.d||!h.d)&&(h=r,n&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-h.d<=t||(c=r.h/2,u.push(new f_(r.p.x-c,r.p.y-c,c,e)),u.push(new f_(r.p.x+c,r.p.y-c,c,e)),u.push(new f_(r.p.x-c,r.p.y+c,c,e)),u.push(new f_(r.p.x+c,r.p.y+c,c,e)),d+=4)}return n&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function d_(e,t){return t.max-e.max}class f_{constructor(e,t,n,r){this.p=new xe(e,t),this.h=n,this.d=function(e,t){let n=!1,r=1/0;for(let i=0;i<t.length;i++){const o=t[i];for(let t=0,i=o.length,s=i-1;t<i;s=t++){const i=o[t],a=o[s];i.y>e.y!=a.y>e.y&&e.x<(a.x-i.x)*(e.y-i.y)/(a.y-i.y)+i.x&&(n=!n),r=Math.min(r,nu(e,i,a))}}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const p_=Object.keys,m_=Number.POSITIVE_INFINITY,g_=Math.sqrt(2);function __(e,t){let[n,r]=t,i=0,o=0;if(r===m_){n<0&&(n=0);const t=n/g_;switch(e){case"top-right":case"top-left":o=t-7;break;case"bottom-right":case"bottom-left":o=7-t;break;case"bottom":o=7-n;break;case"top":o=n-7}switch(e){case"top-right":case"bottom-right":i=-t;break;case"top-left":case"bottom-left":i=t;break;case"left":i=n;break;case"right":i=-n}}else{switch(n=Math.abs(n),r=Math.abs(r),e){case"top-right":case"top-left":case"top":o=r-7;break;case"bottom-right":case"bottom-left":case"bottom":o=7-r}switch(e){case"top-right":case"bottom-right":case"right":i=-n;break;case"top-left":case"bottom-left":case"left":i=n}}return[i,o]}function y_(e,t,n,r,i,o,s,a,l){if(!t||!t.usvg)return;const c=Og(r),u=Og(i),h="both"!==o&&"width"!==o||!Mg(r)?1:u.width/c.width,d="both"!==o&&"height"!==o||!Rg(r)?1:u.height/c.height;n.scaleSelf(h,d);const f=n.toString();s.set(f,n),a.set(f,t);const{imagePosition:p}=Zg(f,t,qg);l.set(f,p)}function v_(e,t,n,r,i,o,s,a,l){if(!e)return;const c=function(e,t,n,r,i,o){if("camera"===e.kind)return e.maxSize;if("composite"===e.kind){const r=t.possiblyEvaluate(new ys(e.maxZoom,{worldview:o}),n).evaluate(i,{},n),s=t.possiblyEvaluate(new ys(e.minZoom,{worldview:o}),n).evaluate(i,{},n);return Math.max(r,s)}return t.possiblyEvaluate(new ys(r,{worldview:o})).evaluate(i,{},n)}(t,n,r,i,o,l);return e.scaleSelf(c*a*s)}function x_(e,t,n,r,i,o,s,a,l){return{iconPrimary:v_(e.getPrimary(),t,n,r,i,o,s,a,l),iconSecondary:v_(e.getSecondary(),t,n,r,i,o,s,a,l)}}function b_(e,t,n){if(!t)return;const r=n.get(e.toString()),i=n.get(t.toString());i&&(r.paddedRect.w===i.paddedRect.w&&r.paddedRect.h===i.paddedRect.h||He(`Mismatch in icon variant sizes: ${e.toString()} and ${t.toString()}`),r.usvg!==i.usvg&&He(`Mismatch in icon variant image types: ${e.id} and ${t.id}`))}function w_(e,t,n,r){if(!e)return;const i=t.get(n.toString());if(e.imagePrimary=i,r){const n=t.get(r.toString());e.imageSecondary=n}}function S_(e,t){for(const n in e.horizontal)E_(e.horizontal[n],t);E_(e.vertical,t)}function E_(e,t){if(e)for(const n of e.positionedLines)for(const e of n.positionedGlyphs)if(null!==e.image){const n=e.image.toString();e.rect=t.get(n).paddedRect}}function T_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function A_(e,t,n,r,i,o,s,a,l){const c=M_(o.horizontal)||o.vertical,u=n.get("icon-text-fit-padding").evaluate(r,{},i);let h,d=t;return t&&"none"!==l&&(e.allowVerticalPlacement&&o.vertical&&(h=kg(t,o.vertical,l,u,a,s)),c&&(d=kg(t,c,l,u,a,s))),{defaultShapedIcon:d,verticallyShapedIcon:h}}function C_(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v){let x=s.textMaxSize.evaluate(t,{},d);void 0===x?x=a*s.textScaleFactor:x*=s.textScaleFactor;const b=e.layers[0].layout,w=M_(n.horizontal)||n.vertical,S="globe"===f.name,E=Hm,T=e.tilePixelRatio*x/E,A=(R=e.overscaling,e.zoom>18&&R>2&&(R>>=1),Math.max(Lr/(512*R),1)*b.get("symbol-spacing")),C=b.get("text-padding")*e.tilePixelRatio,P=b.get("icon-padding")*e.tilePixelRatio,I=Ee(b.get("text-max-angle")),k="map"===b.get("icon-rotation-alignment")&&"point"!==v,M=A/2;var R;!1===e.hasAnyIconTextFit&&"none"!==g&&(e.hasAnyIconTextFit=!0);const O=t.properties?+t.properties[Ac]:null,L=O&&e.elevationFeatureIdToIndex?e.elevationFeatureIdToIndex.get(O):65535,D=(a,l,v)=>{if(l.x<0||l.x>=Lr||l.y<0||l.y>=Lr)return;let x=null;if(S){const{x:e,y:t,z:n}=f.projectTilePoint(l.x,l.y,v);x={anchor:new Fg(e,t,n,0,void 0),up:f.upVector(v,l.x,l.y)}}!function(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,S,E,T,A,C,P){const I=e.addToLineVertexArray(t,r);let k,M,R,O,L,D,N,z=0,F=0,B=0,j=0,U=-1,V=-1;const G={};let H=Zt("");const $=n?n.anchor:t,W="none"!==C;let q=0,X=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")){const e=l.layout.get("text-offset").evaluate(x,{},E);q=e[0]*Hm,X=e[1]*Hm}else q=l.layout.get("text-radial-offset").evaluate(x,{},E)*Hm,X=m_;if(e.allowVerticalPlacement&&i.vertical){const e=i.vertical;if(p)D=O_(e),a&&(N=O_(a));else{const n=l.layout.get("text-rotate").evaluate(x,{},E)+90;R=R_(c,$,t,u,h,d,e,f,n,m),a&&(O=R_(c,$,t,u,h,d,a,_,n))}}if(o){const r=e.iconSizeData,i=l.layout.get("icon-rotate").evaluate(x,{},E),s=o_(o,i,w,W,b.iconScaleFactor),f=a?o_(a,i,w,W,b.iconScaleFactor):void 0;M=R_(c,$,t,u,h,d,o,_,i,null),z=4*s.length;let p=null;"source"===r.kind?(p=[Lg*l.layout.get("icon-size").evaluate(x,{},E)*b.iconScaleFactor],p[0]>I_&&He(`${e.layerIds[0]}: Value for "icon-size" is >= ${P_}. Reduce your "icon-size".`)):"composite"===r.kind&&(p=[Lg*b.compositeIconSizes[0].evaluate(x,{},E)*b.iconScaleFactor,Lg*b.compositeIconSizes[1].evaluate(x,{},E)*b.iconScaleFactor],(p[0]>I_||p[1]>I_)&&He(`${e.layerIds[0]}: Value for "icon-size" is >= ${P_}. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,p,v,y,x,void 0,n,t,I.lineStartIndex,I.lineLength,-1,S,E,T,A),U=e.icon.placedSymbolArray.length-1,f&&(F=4*f.length,e.addSymbols(e.icon,f,p,v,y,x,mg.vertical,n,t,I.lineStartIndex,I.lineLength,-1,S,E,T,A),V=e.icon.placedSymbolArray.length-1)}for(const J in i.horizontal){const r=J,o=i.horizontal[r];k||(H=Zt(o.text),p?L=O_(o):k=R_(c,$,t,u,h,d,o,f,l.layout.get("text-rotate").evaluate(x,{},E),m));const a=1===o.positionedLines.length;if(B+=k_(e,n,t,o,s,l,p,x,m,I,i.vertical?mg.horizontal:mg.horizontalOnly,a?p_(i.horizontal):[r],G,U,b,S,E,T),a)break}i.vertical&&(j+=k_(e,n,t,i.vertical,s,l,p,x,m,I,mg.vertical,["vertical"],G,V,b,S,E,T));let Z=-1;const K=(e,t)=>e?Math.max(e,t):t;Z=K(L,Z),Z=K(D,Z),Z=K(N,Z);const Y=Z>-1?1:0;e.glyphOffsetArray.length>=65535&&He("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,$.x,$.y,$.z,G.right>=0?G.right:-1,G.center>=0?G.center:-1,G.left>=0?G.left:-1,G.vertical>=0?G.vertical:-1,U,V,H,void 0!==k?k:e.collisionBoxArray.length,void 0!==k?k+1:e.collisionBoxArray.length,void 0!==R?R:e.collisionBoxArray.length,void 0!==R?R+1:e.collisionBoxArray.length,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,O||e.collisionBoxArray.length,O?O+1:e.collisionBoxArray.length,u,B,j,z,F,Y,0,q,X,Z,0,W?1:0,P)}(e,l,x,a,n,r,o,i,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,C,y,c,0,P,k,_,t,s,u,h,d,p,m,g,L)};if("line"===v)for(const N of bf(t.geometry,0,0,Lr,Lr)){const t=Hg(N,A,I,n.vertical||w,r,E,T,e.overscaling,Lr);for(const n of t)w&&L_(e,w.text,M,n)||D(N,n,d)}else if("line-center"===v){for(const N of t.geometry)if(N.length>1){const e=Gg(N,I,n.vertical||w,r,E,T);e&&D(N,e,d)}}else if("Polygon"===t.type)for(const N of $h(t.geometry,0)){const e=h_(N,16);D(N[0],new Fg(e.x,e.y,0,0,void 0),d)}else if("LineString"===t.type)for(const N of t.geometry)D(N,new Fg(N[0].x,N[0].y,0,0,void 0),d);else if("Point"===t.type)for(const N of t.geometry)for(const e of N)D([e],new Fg(e.x,e.y,0,0,void 0),d)}const P_=255,I_=P_*Lg;function k_(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_){const y=function(e,t,n,r,i,o,s,a){const l=[];if(0===t.positionedLines.length)return l;const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],n=e[1],r=t*n;return r>0?[t,-n]:r<0?[-t,n]:0===t?[n,t]:[n,-t]}(n);let h=Math.abs(t.top-t.bottom);for(const m of t.positionedLines)h-=m.lineOffset;const d=t.positionedLines.length,f=h/d;let p=t.top-n[1];for(let m=0;m<d;++m){const e=t.positionedLines[m];p=u_(t,f,p,m);for(const r of e.positionedGlyphs){if(!r.rect)continue;const e=r.rect||{};let o=pg+1,h=!0,d=1,f=0;if(r.image){const e=s.get(r.image.toString());if(!e)continue;if(e.sdf){He("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=qg/d}const m=(i||a)&&r.vertical,g=r.metrics.advance*r.scale/2,_=r.metrics,y=r.rect;if(null===y)continue;a&&t.verticalizable&&(f=r.image?g-r.metrics.width*r.scale/2:0);const v=i?[r.x+g,r.y]:[0,0];let x=[0,0],b=[0,0],w=!1;i||(m?(b=[r.x+g+u[0],r.y+u[1]-f],w=!0):x=[r.x+g+n[0],r.y+n[1]-f]);const S=y.w*r.scale/(d*(r.localGlyph?e_:1)),E=y.h*r.scale/(d*(r.localGlyph?e_:1));let T,A,C,P;if(m){const e=r.y-p,t=new xe(-g,g-e),n=-Math.PI/2,i=new xe(...b);T=new xe(-g+x[0],x[1]),T._rotateAround(n,t)._add(i),T.x+=-e+g,T.y-=(_.left-o)*r.scale;const s=r.image?_.advance*r.scale:Hm*r.scale,a=String.fromCodePoint(r.glyph);qm(a)?T.x+=(1-o)*r.scale:Xm(a)?T.x+=s-_.height*r.scale+(-o-1)*r.scale:T.x+=r.image||_.width+2*o===y.w&&_.height+2*o===y.h?(s-E)/2:(s-(_.height+2*o)*r.scale)/2,A=new xe(T.x,T.y-S),C=new xe(T.x+E,T.y),P=new xe(T.x+E,T.y-S)}else{const e=(_.left-o)*r.scale-g+x[0],t=(-_.top-o)*r.scale+x[1],n=e+S,i=t+E;T=new xe(e,t),A=new xe(n,t),C=new xe(e,i),P=new xe(n,i)}if(c){let e;e=i?new xe(0,0):w?new xe(u[0],u[1]):new xe(n[0],n[1]),T._rotateAround(c,e),A._rotateAround(c,e),C._rotateAround(c,e),P._rotateAround(c,e)}const I=new xe(0,0),k=new xe(0,0);l.push({tl:T,tr:A,bl:C,br:P,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:v,sectionIndex:r.sectionIndex,isSDF:h,pixelOffsetTL:I,pixelOffsetBR:k,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,o,s,a,i,e.allowVerticalPlacement),v=e.textSizeData;let x=null;"source"===v.kind?(x=[Lg*o.layout.get("text-size").evaluate(a,{},g)*p.textScaleFactor],x[0]>I_&&He(`${e.layerIds[0]}: Value for "text-size" is >= ${P_}. Reduce your "text-size".`)):"composite"===v.kind&&(x=[Lg*p.compositeTextSizes[0].evaluate(a,{},g)*p.textScaleFactor,Lg*p.compositeTextSizes[1].evaluate(a,{},g)*p.textScaleFactor],(x[0]>I_||x[1]>I_)&&He(`${e.layerIds[0]}: Value for "text-size" is >= ${P_}. Reduce your "text-size".`)),e.addSymbols(e.text,y,x,l,s,a,u,t,n,c.lineStartIndex,c.lineLength,f,m,g,_,!1);for(const b of h)d[b]=e.text.placedSymbolArray.length-1;return 4*y.length}function M_(e){for(const t in e)return e[t];return null}function R_(e,t,n,r,i,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,f=s.right;if(Pg(s)&&s.collisionPadding){const e=s.collisionPadding;d-=e[0],u-=e[1],f+=e[2],h+=e[3]}if(l){const e=new xe(d,u),t=new xe(f,u),n=new xe(d,h),r=new xe(f,h),i=Ee(l);let o=new xe(0,0);c&&(o=new xe(c[0],c[1])),e._rotateAround(i,o),t._rotateAround(i,o),n._rotateAround(i,o),r._rotateAround(i,o),d=Math.min(e.x,t.x,n.x,r.x),f=Math.max(e.x,t.x,n.x,r.x),u=Math.min(e.y,t.y,n.y,r.y),h=Math.max(e.y,t.y,n.y,r.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,d,u,f,h,a,r,i,o),e.length-1}function O_(e){Pg(e)&&e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function L_(e,t,n,r){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<n)return!0}else i[t]=[];return i[t].push(r),!1}function D_(e,t){const n=e.fovAboveCenter,r=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-r)/Math.cos(e._pitch),o=Math.sin(n)*i/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01));let s=Math.sin(e._pitch)*o+i;const a=i*(1/e._horizonShift);if(!e.elevation||0===e.elevation.exaggeration()){let t=Math.max(e.zoom-17,0);e.isOrthographic&&(t/=10),s*=1+t}return Math.min(1.01*s,a)}function N_(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),r=e.x*n,i=(e.x+1)*n,o=e.y*n,s=(e.y+1)*n,a=tc(r),l=tc(i),c=nc(o),u=nc(s),h=t.project(a,c),d=t.project(l,c),f=t.project(l,u),p=t.project(a,u);let m=Math.min(h.x,d.x,f.x,p.x),g=Math.min(h.y,d.y,f.y,p.y),_=Math.max(h.x,d.x,f.x,p.x),y=Math.max(h.y,d.y,f.y,p.y);const v=n/16;function x(e,n,r,i,o,s){const a=(r+o)/2,l=(i+s)/2,c=t.project(tc(a),nc(l)),u=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>v&&(x(e,c,r,i,a,l),x(c,n,a,l,o,s))}x(h,d,r,o,i,o),x(d,f,i,o,i,s),x(f,p,i,s,r,s),x(p,h,r,s,r,o),m-=v,g-=v,_+=v,y+=v;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:t}}function z_(e,t){let{x:n,y:r}=t;return new xe(((n-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*Lr,(r*e.scale-e.y)*Lr)}const F_=l(new Float32Array(16));class B_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new ql(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._coordinatePoint(e.locationCoordinate(t,n),r)}pixelsPerMeter(e,t){return ec(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return D_(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,r){const i=e.horizonLineFromTop(!1),o=new xe(t,Math.max(i,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,r))}pointCoordinate3D(e,t,n){const r=new xe(t,n);if(e.elevation)return e.elevation.pointCoordinate(r);{const t=this.pointCoordinate(e,r.x,r.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return F_}createTileMatrix(e,t,n){let r,i,o;const s=n.canonical,a=l(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=N_(s,this);r=1,i=l.x+n.wrap*l.scale,o=l.y,d(a,a,[r/l.scale,r/l.scale,e.pixelsPerMeter/t])}else r=t/e.zoomScale(s.z),i=(s.x+Math.pow(2,s.z)*n.wrap)*r,o=s.y*r;return h(a,a,[i,o,0]),d(a,a,[r/Lr,r/Lr,1]),a}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class j_ extends B_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],r=Math.sin(Ee(t));this.n=(r+Math.sin(Ee(n)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:n,c:r,r0:i}=this,o=Ee(e-this.center[0]),s=Ee(t),a=Math.sqrt(r-2*n*Math.sin(s))/n;return{x:a*Math.sin(o*n),y:a*Math.cos(o*n)-i,z:0}}unproject(e,t){const{n:n,c:r,r0:i}=this,o=i+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*n<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=Ee(this.center[0])*n;s=Re(s,-Math.PI-a,Math.PI-a);const l=ke(Te(s/n)+this.center[0],-180,180),c=Math.asin(ke((r-(e*e+o*o)*n*n)/(2*n),-1,1)),u=ke(Te(c),-ic,ic);return new ql(l,u)}}const U_=1.340264,V_=-.081106,G_=893e-6,H_=.003796,$_=Math.sqrt(3)/2;class W_ extends B_{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin($_*Math.sin(t)),r=n*n,i=r*r*r;return{x:.5*(e*Math.cos(n)/($_*(U_+3*V_*r+i*(7*G_+9*H_*r)))/Math.PI+.5),y:1-.5*(n*(U_+V_*r+i*(G_+H_*r))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,r=n*n,i=r*r*r;for(let c,u,h,d=0;d<12&&(u=n*(U_+V_*r+i*(G_+H_*r))-t,h=U_+3*V_*r+i*(7*G_+9*H_*r),c=u/h,n=ke(n-c,-Math.PI/3,Math.PI/3),r=n*n,i=r*r*r,!(Math.abs(c)<1e-12));++d);const o=$_*e*(U_+3*V_*r+i*(7*G_+9*H_*r))/Math.cos(n),s=Math.asin(Math.sin(n)/$_),a=ke(180*o/Math.PI,-180,180),l=ke(180*s/Math.PI,-ic,ic);return new ql(a,l)}}class q_ extends B_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),r=ke(360*(.5-t),-ic,ic);return new ql(n,r)}}const X_=Math.PI/2;function Z_(e){return Math.tan((X_+e)/2)}class K_ extends B_{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let r=Ee(t),i=Ee(n);this.southernCenter=r+i<0,this.southernCenter&&(r=-r,i=-i);const o=Math.cos(r),s=Z_(r);this.n=r===i?Math.sin(r):Math.log(o/Math.cos(i))/Math.log(Z_(i)/s),this.f=o*Math.pow(Z_(r),this.n)/this.n}project(e,t){t=Ee(t),this.southernCenter&&(t=-t),e=Ee(e-this.center[0]);const n=1e-6,{n:r,f:i}=this;i>0?t<-X_+n&&(t=-X_+n):t>X_-n&&(t=X_-n);const o=i/Math.pow(Z_(t),r);let s=o*Math.sin(r*e),a=i-o*Math.cos(r*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:n,f:r}=this,i=r-t,o=Math.sign(i),s=Math.sign(n)*Math.sqrt(e*e+i*i);let a=Math.atan2(e,Math.abs(i))*o;i*n<0&&(a-=Math.PI*Math.sign(e)*o);const l=ke(Te(a/n)+this.center[0],-180,180),c=ke(Te(2*Math.atan(Math.pow(r/s,1/n))-X_),-ic,ic);return new ql(l,this.southernCenter?-c:c)}}class Y_ extends B_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Jl(e),y:Ql(t),z:0}}unproject(e,t){const n=tc(e),r=nc(t);return new ql(n,r)}}const J_=Ee(ic);class Q_ extends B_{project(e,t){const n=(t=Ee(t))*t,r=n*n;return{x:.5*((e=Ee(e))*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,r=25,i=0,o=n*n;do{o=n*n;const e=o*o;i=(n*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),n=ke(n-i,-J_,J_)}while(Math.abs(i)>1e-6&&--r>0);o=n*n;const s=ke(Te(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=Te(n);return new ql(s,a)}}const ey=Ee(ic);class ty extends B_{project(e,t){t=Ee(t),e=Ee(e);const n=Math.cos(t),r=2/Math.PI,i=Math.acos(n*Math.cos(e/2)),o=Math.sin(i)/i,s=.5*(e*r+2*n*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,r=t=(2*(1-t)-1)*Math.PI,i=25;const o=1e-6;let s=0,a=0;do{const i=Math.cos(r),o=Math.sin(r),l=2*o*i,c=o*o,u=i*i,h=Math.cos(n/2),d=Math.sin(n/2),f=2*h*d,p=d*d,m=1-u*h*h,g=m?1/m:0,_=m?Math.acos(i*h)*Math.sqrt(1/m):0,y=.5*(2*_*i*d+2*n/Math.PI)-e,v=.5*(_*o+r)-t,x=.5*g*(u*p+_*i*h*c)+1/Math.PI,b=g*(f*l/4-_*o*d),w=.125*g*(l*d-_*o*u*f),S=.5*g*(c*h+_*p*i)+.5,E=b*w-S*x;s=(v*b-y*S)/E,a=(y*w-v*x)/E,n=ke(n-s,-Math.PI,Math.PI),r=ke(r-a,-ey,ey)}while((Math.abs(s)>o||Math.abs(a)>o)&&--i>0);return new ql(Te(n),Te(r))}}class ny extends B_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ee(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:r}=this;return{x:Ee(e)*r*n+.5,y:-Math.sin(Ee(t))/r*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:r}=this,i=-(t-.5)/n,o=ke(Te((e-.5)/n)/r,-180,180),s=Math.asin(ke(i*r,-1,1)),a=ke(Te(s),-ic,ic);return new ql(o,a)}}class ry extends Y_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,n){const r=Nu(e,t,n);return B(r,r,Bu(ku(n))),{x:r[0],y:r[1],z:r[2]}}locationPoint(e,t,n){const r=Hl(t.lat,t.lng),i=D([],r),o=n?e._centerAltitude+n:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;M(r,r,i,ec(1,0)*Lr*o);const s=l(new Float64Array(16));return u(s,e.pixelMatrix,e.globeMatrix),B(r,r,s),new xe(r[0],r[1])}pixelsPerMeter(e,t){return ec(1,0)*t}pixelSpaceConversion(e,t,n){const r=ec(1,e)*t,i=un(ec(1,45)*t,r,n);return this.pixelsPerMeter(e,t)/i}createTileMatrix(e,t,n){const r=ju(ku(n.canonical));return u(new Float64Array(16),e.globeMatrix,r)}createInversionMatrix(e,t){const{center:n}=e,r=Bu(ku(t));return p(r,r,Ee(n.lng)),f(r,r,Ee(n.lat)),d(r,r,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(e,t,n,r){return Cu(e,t,n,!0)||new cc(0,0)}pointCoordinate3D(e,t,n){const r=this.pointCoordinate(e,t,n,0);return[r.x,r.y,r.z]}isPointAboveHorizon(e,t){return!Cu(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const n=e.cameraToCenterDistance,r=e._centerAltitude*t,i=e._camera,o=e._camera.forward(),s=T([],k([],o,-n),[0,0,r]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=k([],i.up(),u),d=k([],i.right(),u*c),f=D([],T([],T([],o,h),d)),p=[];let m;if(new Lc(s,f).closestPointOnSphere(l,a,p)){const t=T([],p,l),n=H([],t,s);m=Math.cos(e.fovAboveCenter)*w(n)}else{const e=H([],s,l),t=H([],l,s);D(t,t);const n=w(e)-a;m=Math.sqrt(n*(n+2*a));const r=Math.acos(m/(a+n))-Math.acos(N(o,t));m*=Math.cos(r)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Hu(e.zoom);if(n>0){const r=D_(e,ec(1,e.center.lat)*e.worldSize),i=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return un(t,r+i*(1-Math.cos(o)),Math.pow(n,10))}return t}upVector(e,t,n){return Nu(t,n,e,1)}upVectorScale(e){return{metersToTile:Tu(zu(ku(e)))}}}function iy(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Y_(e);case"equirectangular":return new q_(e);case"naturalEarth":return new Q_(e);case"equalEarth":return new W_(e);case"winkelTripel":return new ty(e);case"albers":return n?new ny(e):new j_(e);case"lambertConformalConic":return n?new ny(e):new K_(e);case"globe":return new ry(e)}throw new Error(`Invalid projection name: ${e.name}`)}const oy=vc.types,sy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ay(e,t,n,r,i,o,s,a,l,c,u,h,d){const f=a?Math.min(I_,Math.round(a[0])):0,p=a?Math.min(I_,Math.round(a[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),o,s,(f<<1)+(l?1:0),p,16*c,16*u,256*h,256*d)}function ly(e,t,n){e.emplaceBack(t,n)}function cy(e,t,n,r,i,o,s){e.emplaceBack(t,n,r,i,o,s)}const uy=(e,t,n,r)=>{for(let i=0;i<t;i++)e.emplaceBack(n[0],n[1],n[2],r[0],r[1],r[2])};function hy(e,t,n,r,i){e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i)}function dy(e){for(const t of e.sections)if(as(t.text))return!0;return!1}class fy{constructor(e){this.layoutVertexArray=new ma,this.indexArray=new Ea,this.programConfigurations=e,this.segments=new tl,this.dynamicLayoutVertexArray=new _a,this.opacityVertexArray=new ya,this.placedSymbolArray=new Va,this.iconTransitioningVertexArray=new va,this.globeExtVertexArray=new ga,this.zOffsetVertexArray=new sa,this.orientationVertexArray=new Ca}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,n,r,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Nm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sy,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Bm.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Dm.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||i)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,zm.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Fm.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}qo(fy,"SymbolBuffers");class py{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new tl,this.collisionVertexArray=new Sa,this.collisionVertexArrayExt=new _a}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,jm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Um.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qo(py,"CollisionBuffers");class my{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=l([]),this.placementViewportMatrix=l([]);const t=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Dg(this.zoom,t["text-size"],this.worldview),this.iconSizeData=Dg(this.zoom,t["icon-size"],this.worldview);const n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(e=>mg[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new fy(new Il(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new fy(new Il(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new $a,this.lineVertexArray=new Wa,this.symbolInstances=new Ha}calculateGlyphDependencies(e,t,n,r,i){for(const o of e){const e=o.codePointAt(0);if(void 0===e)break;if(t[e]=!0,r&&i&&e<=65535){const e=Wm[o];e&&(t[e.charCodeAt(0)]=!0)}}}updateFootprints(e,t){}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!kd(this.activeReplacements,n)&&(this.activeReplacements=n,!0)}populate(e,t,n,r){const i=this.layers[0],o=i.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),[u,h]=o.get("icon-size-scale-range"),d=ke(t.scaleFactor||1,u,h),f=("constant"!==l.value.kind||l.value.value instanceof Dn&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),p="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,m=o.get("symbol-sort-key");if(this.features=[],!f&&!p)return;const g=t.iconDependencies,_=t.glyphDependencies,y=t.availableImages,v=new ys(this.zoom,{worldview:this.worldview});for(const{feature:x,id:b,index:w,sourceLayerIndex:S}of e){const e=i._featureFilter.needGeometry,t=yc(x,e);if(!i._featureFilter.filter(v,t,n))continue;if(e||(t.geometry=_c(x,n,r)),s&&1!==x.type&&n.z<=5){const e=t.geometry,r=.98078528056,i=(e,t)=>N(Nu(e.x,e.y,n,1),Nu(t.x,t.y,n,1))<r;for(let t=0;t<e.length;t++)e[t]=fc(e[t],i)}let l,c;if(f){const e=i.getValueAndResolveTokens("text-field",t,n,y),r=Dn.factory(e);dy(r)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ms()||this.hasRTLText&&_s.isParsed())&&(l=$m(r,i,t))}if(p){const e=i.getValueAndResolveTokens("icon-image",t,n,y);c="string"==typeof e?zn.build(e):e}if(!l&&!c)continue;const u=this.sortFeaturesByKey?m.evaluate(t,{},n):void 0,h={id:b,text:l,icon:c,index:w,sourceLayerIndex:S,geometry:t.geometry,properties:x.properties,type:oy[x.type],sortKey:u};if(this.features.push(h),c){const e=this.layers[0]._unevaluatedLayout._values,{iconPrimary:t,iconSecondary:r}=x_(c,this.iconSizeData,e["icon-size"],n,this.zoom,h,this.pixelRatio,d,this.worldview),i=t.id.toString();if(g.has(i)?g.get(i).push(t):g.set(i,[t]),r){this.hasAnySecondaryIcon=!0;const e=r.id.toString();g.has(e)?g.get(e).push(r):g.set(e,[r])}}if(l){const e=a.evaluate(t,{},n).join(","),r="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(mg.vertical)>=0;for(const t of l.sections)if(t.image){const e=t.image.getPrimary().scaleSelf(this.pixelRatio),n=e.id.toString(),r=g.get(n)||[];r.push(e),g.set(n,r)}else{const n=Qo(l.toString()),i=t.fontStack||e,o=_[i]=_[i]||{};this.calculateGlyphDependencies(t.text,o,r,this.allowVerticalPlacement,n)}}}if("line"===o.get("symbol-placement")&&(this.features=function(e){const t={},n={},r=[];let i=0;function o(t){r.push(e[t]),i++}function s(e,t,i){const o=n[e];return delete n[e],n[t]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function a(e,n,i){const o=t[n];return delete t[n],t[e]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function l(e,t,n){const r=n?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const f=l(d,h),p=l(d,h,!0);if(f in n&&p in t&&n[f]!==t[p]){const e=a(f,p,h),i=s(f,p,r[e].geometry);delete t[f],delete n[p],n[l(d,r[i].geometry,!0)]=i,r[e].geometry=null}else f in n?s(f,p,h):p in t?a(f,p,h):(o(c),t[f]=i-1,n[p]=i-1)}return r.filter(e=>e.geometry)}(this.features)),"hd-road-markup"===o.get("symbol-elevation-reference")){if(this.elevationType="road",t.elevationFeatures){!this.elevationFeatures&&t.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const e of t.elevationFeatures)this.elevationFeatureIdToIndex.set(e.id,this.elevationFeatures.length),this.elevationFeatures.push(e)}}else o.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}update(e,t,n,r,i,o,s){this.text.programConfigurations.updatePaintArrays(e,t,i,n,r,o,s,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,t,i,n,r,o,s,this.worldview)}updateRoadElevation(e){if("road"!==this.elevationType||!this.elevationFeatures)return;if(this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let t=!1;const n=lc(e),r=1/n;let i=!1,o=!1;for(let s=0;s<this.symbolInstances.length;s++){const e=this.symbolInstances.get(s),a=S(1,0,0),l=S(0,1,0),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:u,numIconVertices:h,numVerticalIconVertices:d}=e,f=c>0||u>0,p=h>0,m=this.elevationFeatures[e.elevationFeatureIndex];if(m){const s=new xe(e.tileAnchorX,e.tileAnchorY),c=.075+m.pointElevation(s);e.zOffset!==c&&(t=!0,e.zOffset=c);const u=m.computeSlopeNormal(s,r),h=oe(Y(),S(0,0,1),u);U(a,a,h),U(l,l,h),a[2]*=n,l[2]*=n,1===a[0]&&0===a[1]&&0===a[2]&&0===l[0]&&1===l[1]&&0===l[2]||(i=i||f,o=o||p)}if(f&&(uy(this.text.orientationVertexArray,c,a,l),uy(this.text.orientationVertexArray,u,a,l)),p){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:n}=e;t>=0&&uy(this.icon.orientationVertexArray,h,a,l),n>=0&&uy(this.icon.orientationVertexArray,d,a,l)}}i||(this.text.orientationVertexArray=void 0),o||(this.icon.orientationVertexArray=void 0),t&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(e,t,r)=>{n+=t,n>e.length&&e.resize(n);for(let i=-t;i<0;i++)e.emplace(i+n,r)},t=(e,t,n)=>{r+=t,r>e.length&&e.resize(r);for(let i=-t;i<0;i++)e.emplace(i+r,n)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,r=0;for(let i=0;i<this.symbolInstances.length;i++){const n=this.symbolInstances.get(i),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:o,numIconVertices:s}=n,a=n.zOffset,l=s>0;if((r>0||o>0)&&(e(this.text.zOffsetVertexArray,r,a),e(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:r}=n;e>=0&&t(this.icon.zOffsetVertexArray,s,a),r>=0&&t(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=iy(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:r,y:i}of t)this.lineVertexArray.emplaceBack(r,i);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m){const g=e.indexArray,_=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,_,g,this.canOverlap?o.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&s===mg.vertical?Math.PI/2:0,S=o.text&&o.text.sections;for(let T=0;T<t.length;T++){const{tl:r,tr:i,bl:s,br:c,texPrimary:u,texSecondary:h,pixelOffsetTL:x,pixelOffsetBR:b,minFontScaleX:E,minFontScaleY:A,glyphOffset:C,isSDF:P,sectionIndex:I}=t[T],k=v.vertexLength,M=C[1];if(ay(_,l.x,l.y,r.x,M+r.y,u.x,u.y,n,P,x.x,x.y,E,A),ay(_,l.x,l.y,i.x,M+i.y,u.x+u.w,u.y,n,P,b.x,x.y,E,A),ay(_,l.x,l.y,s.x,M+s.y,u.x,u.y+u.h,n,P,x.x,b.y,E,A),ay(_,l.x,l.y,c.x,M+c.y,u.x+u.w,u.y+u.h,n,P,b.x,b.y,E,A),a){const{x:t,y:n,z:r}=a.anchor,[i,o,s]=a.up;cy(y,t,n,r,i,o,s),cy(y,t,n,r,i,o,s),cy(y,t,n,r,i,o,s),cy(y,t,n,r,i,o,s),hy(e.dynamicLayoutVertexArray,t,n,r,w)}else hy(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=h||u;ly(e.iconTransitioningVertexArray,t.x,t.y),ly(e.iconTransitioningVertexArray,t.x+t.w,t.y),ly(e.iconTransitioningVertexArray,t.x,t.y+t.h),ly(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(k,k+1,k+2),g.emplaceBack(k+1,k+2,k+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(C[0]),T!==t.length-1&&I===t[T+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,o,o.index,{},d,f,p,S&&S[I],this.worldview)}const E=a?a.anchor:l;e.placedSymbolArray.emplaceBack(E.x,E.y,E.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],s,0,0,0,h,0)}_commitLayoutVertex(e,t,n,r,i,o,s){e.emplaceBack(t,n,r,i,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,n,r,i,o,s){const a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let d=0;d<4;d++)n.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,t,e.padding,s.zOffset),this._commitLayoutVertex(n.layoutVertexArray,r,i,o,c,u,new xe(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,r,i,o,c,u,new xe(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,r,i,o,c,u,new xe(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,r,i,o,c,u,new xe(e.x1,e.y2)),a.vertexLength+=4;const h=n.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(r,i,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(r,i,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new py(ba,Vm.members,va),this.iconCollisionBox=new py(ba,Vm.members,va);const r=zg(this.iconSizeData,e),i=zg(this.textSizeData,e,n);for(let o=0;o<this.symbolInstances.length;o++){const n=this.symbolInstances.get(o);this._addTextDebugCollisionBoxes(i,e,t,n.textBoxStartIndex,n.textBoxEndIndex,n),this._addTextDebugCollisionBoxes(i,e,t,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n),this._addIconDebugCollisionBoxes(r,e,t,n.iconBoxStartIndex,n.iconBoxEndIndex,n),this._addIconDebugCollisionBoxes(r,e,t,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n)}}getSymbolInstanceTextSize(e,t,n,r){const i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:r),o=Ng(this.textSizeData,e,i)/Hm;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,n){const r=this.icon.placedSymbolArray.get(n),i=Ng(this.iconSizeData,e,r);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(e,t,n,r){e.emplaceBack(t,-n,-n,r),e.emplaceBack(t,n,-n,r),e.emplaceBack(t,n,n,r),e.emplaceBack(t,-n,n,r)}_updateTextDebugCollisionBoxes(e,t,n,r,i,o,s){for(let a=r;a<i;a++){const r=n.get(a),i=this.getSymbolInstanceTextSize(e,o,t,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,r.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(e,t,n,r,i,o,s){for(let a=r;a<i;a++){const r=n.get(a),i=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,r.padding,o.zOffset)}}updateCollisionDebugBuffers(e,t,n,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=zg(this.iconSizeData,e,r),o=zg(this.textSizeData,e,n);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(o,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a,n),this._updateTextDebugCollisionBoxes(o,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,n),this._updateIconDebugCollisionBoxes(i,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a,r),this._updateIconDebugCollisionBoxes(i,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,r)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,r,i,o,s,a,l){const c={};if(t<n){const{x1:n,y1:r,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=e.get(t);c.textBox={x1:n,y1:r,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=f}if(r<i){const{x1:t,y1:n,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=e.get(r);c.verticalTextBox={x1:t,y1:n,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=f}if(o<s){const{x1:t,y1:n,x2:r,y2:i,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=e.get(o);c.iconBox={x1:t,y1:n,x2:r,y2:i,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=f}if(a<l){const{x1:t,y1:n,x2:r,y2:i,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=e.get(a);c.verticalIconBox={x1:t,y1:n,x2:r,y2:i,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=f}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),r=n.vertexStartIndex+4*n.numGlyphs;for(let i=n.vertexStartIndex;i<r;i+=4)e.indexArray.emplaceBack(i,i+1,i+2),e.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),r=[],i=[],o=[];for(let s=0;s<this.symbolInstances.length;++s){o.push(s);const e=this.symbolInstances.get(s);r.push(0|Math.round(t*e.tileAnchorX+n*e.tileAnchorY)),i.push(e.featureIndex)}return o.sort((e,t)=>r[e]-r[t]||i[t]-i[e]),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:i,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),r>=0&&r!==n&&this.addIndicesForPlacedSymbol(this.text,r),i>=0&&i!==r&&i!==n&&this.addIndicesForPlacedSymbol(this.text,i),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gy,_y,yy;qo(my,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),my.addDynamicAttributes=hy;class vy{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qo(vy,"FormatSectionOverride",{omit:["defaultValue"]});const xy=()=>yy||(yy={layout:gy||(gy=new ks({"symbol-placement":new Cs(Ms.layout_symbol["symbol-placement"]),"symbol-spacing":new Cs(Ms.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Cs(Ms.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ps(Ms.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Cs(Ms.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Cs(Ms.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Cs(Ms.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Cs(Ms.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Cs(Ms.layout_symbol["icon-ignore-placement"]),"icon-optional":new Cs(Ms.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Cs(Ms.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ps(Ms.layout_symbol["icon-size"]),"icon-size-scale-range":new Cs(Ms.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ps(Ms.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ps(Ms.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ps(Ms.layout_symbol["icon-image"]),"icon-rotate":new Ps(Ms.layout_symbol["icon-rotate"]),"icon-padding":new Cs(Ms.layout_symbol["icon-padding"]),"icon-keep-upright":new Cs(Ms.layout_symbol["icon-keep-upright"]),"icon-offset":new Ps(Ms.layout_symbol["icon-offset"]),"icon-anchor":new Ps(Ms.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Cs(Ms.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Cs(Ms.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Cs(Ms.layout_symbol["text-rotation-alignment"]),"text-field":new Ps(Ms.layout_symbol["text-field"]),"text-font":new Ps(Ms.layout_symbol["text-font"]),"text-size":new Ps(Ms.layout_symbol["text-size"]),"text-size-scale-range":new Cs(Ms.layout_symbol["text-size-scale-range"]),"text-max-width":new Ps(Ms.layout_symbol["text-max-width"]),"text-line-height":new Ps(Ms.layout_symbol["text-line-height"]),"text-letter-spacing":new Ps(Ms.layout_symbol["text-letter-spacing"]),"text-justify":new Ps(Ms.layout_symbol["text-justify"]),"text-radial-offset":new Ps(Ms.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Cs(Ms.layout_symbol["text-variable-anchor"]),"text-anchor":new Ps(Ms.layout_symbol["text-anchor"]),"text-max-angle":new Cs(Ms.layout_symbol["text-max-angle"]),"text-writing-mode":new Cs(Ms.layout_symbol["text-writing-mode"]),"text-rotate":new Ps(Ms.layout_symbol["text-rotate"]),"text-padding":new Cs(Ms.layout_symbol["text-padding"]),"text-keep-upright":new Cs(Ms.layout_symbol["text-keep-upright"]),"text-transform":new Ps(Ms.layout_symbol["text-transform"]),"text-offset":new Ps(Ms.layout_symbol["text-offset"]),"text-allow-overlap":new Cs(Ms.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Cs(Ms.layout_symbol["text-ignore-placement"]),"text-optional":new Cs(Ms.layout_symbol["text-optional"]),visibility:new Cs(Ms.layout_symbol.visibility)})),paint:_y||(_y=new ks({"icon-opacity":new Ps(Ms.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ps(Ms.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ps(Ms.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ps(Ms.paint_symbol["text-emissive-strength"]),"icon-color":new Ps(Ms.paint_symbol["icon-color"]),"icon-halo-color":new Ps(Ms.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ps(Ms.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ps(Ms.paint_symbol["icon-halo-blur"]),"icon-translate":new Cs(Ms.paint_symbol["icon-translate"]),"icon-translate-anchor":new Cs(Ms.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Cs(Ms.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ps(Ms.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ps(Ms.paint_symbol["text-occlusion-opacity"]),"text-color":new Ps(Ms.paint_symbol["text-color"],{runtimeType:xn,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Ps(Ms.paint_symbol["text-halo-color"]),"text-halo-width":new Ps(Ms.paint_symbol["text-halo-width"]),"text-halo-blur":new Ps(Ms.paint_symbol["text-halo-blur"]),"text-translate":new Cs(Ms.paint_symbol["text-translate"]),"text-translate-anchor":new Cs(Ms.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Cs(Ms.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Cs(Ms.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Cs(Ms.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Cs(Ms.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ps(Ms.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},yy);class by extends Ys{constructor(e,t,n,r){super(e,xy(),t,n,r),this._colorAdjustmentMatrix=l([]),this.hasInitialOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const e=[];for(const t of n)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,t,n,r){return this._saturation===e&&this._contrast===t&&this._brightnessMin===n&&this._brightnessMax===r||(this._colorAdjustmentMatrix=function(e,t,n,r){e=tt(e),t=et(t);const i=a(),o=e/3,s=1-2*o,l=[s,o,o,0,o,s,o,0,o,o,s,0,0,0,0,1],c=.5-.5*t,h=r-n;return u(i,[h,0,0,0,0,h,0,0,0,0,h,0,n,n,n,1],[t,0,0,0,0,t,0,0,0,0,t,0,c,c,c,1]),u(i,i,l),i}(e,t,n,r),this._saturation=e,this._contrast=t,this._brightnessMin=n,this._brightnessMax=r),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,n,r){const i=this.layout.get(e).evaluate(t,{},n,r),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Do(o.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,(t,n)=>n in e?String(e[n]):"")}(t.properties,i)}createBucket(e){return new my(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of xy().paint.overridableProperties){if(!by.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new vy(t),r=new Lo(n,t.property.specification,this.scope,this.options);let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new zo("source",r):new Fo("composite",r,t.value.zoomStops,t.value.interpolationType),this.paint._values[e]=new Ts(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&by.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),r=xy().paint.properties[t];let i=!1;const o=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof Dn)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{i||(t instanceof Vn&&jn(t.value)===En?o(t.value.sections):t instanceof Wn?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return i}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,t,n){return{config:new Pl(this,{zoom:t,lut:n}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}let wy,Sy,Ey,Ty;var Ay=ta([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Cy(e,t,n,r,i,a,l,c){const u=[e,t,1,n,r,1,i,a,1],h=[l,c,1],d=o([],u),[f,p,m]=j(h,h,d);return s(u,u,[f,0,0,0,p,0,0,0,m])}function Py(e,t,n,r,i,a,l,c){const u=function(e,t,n,r,i,a,l,c){const u=Cy(0,0,1,0,1,1,0,1),h=Cy(e,t,n,r,i,a,l,c);return s(h,h,o([],u))}(e,t,n,r,i,a,l,c);return[u[2]/u[8]/Lr,u[5]/u[8]/Lr]}function Iy(e){return[e[0],Math.min(Math.max(e[1],-ic),ic)]}class ky extends en{constructor(e,t,n,r){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new Kt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ut(this.map._requestManager.transformRequest(this.url,Rt.Image),(t,n)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new Yt(t)):n&&(this.image=n instanceof HTMLImageElement?ft.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new pp(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Kt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof pp||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],n=e[0][1];for(const i of e)i[1]>n&&(n=i[1]),i[1]<t&&(t=i[1]);const r=(n+t)/2;if(r>ic?this.onNorthPole=!0:r<-ic&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(cc.fromLngLat);this.tileID=function(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(const c of e)t=Math.min(t,c.x),n=Math.min(n,c.y),r=Math.max(r,c.x),i=Math.max(i,c.y);const o=Math.max(r-t,i-n),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);let l=Math.floor((t+r)/2*a);return l>1&&(l-=1),new gu(s,l,Math.floor((n+i)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Kt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof pp||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const o in this.tiles){const e=this.tiles[o];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const t=N_(new gu(0,0,0),this.map.transform.projection),n=[t.projection.project(this.coordinates[0][0],this.coordinates[0][1]),t.projection.project(this.coordinates[1][0],this.coordinates[1][1]),t.projection.project(this.coordinates[2][0],this.coordinates[2][1]),t.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,n=e[1].y-e[0].y,r=e[2].x-e[1].x,i=e[2].y-e[1].y,o=e[3].x-e[2].x,s=e[3].y-e[2].y,a=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*i-r*n,u=r*s-o*i,h=o*l-a*s,d=a*n-t*l;return c>0&&u>0&&h>0&&d>0||c<0&&u<0&&h<0&&d<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const r=N_(this.tileID,this.map.transform.projection),[i,a,l,c]=this.coordinates.map(e=>{const t=r.projection.project(e[0],e[1]);return z_(r,t)._round()});this.perspectiveTransform=Py(i.x,i.y,a.x,a.y,l.x,l.y,c.x,c.y);const u=this._boundsArray=new oa;u.emplaceBack(i.x,i.y,0,0),u.emplaceBack(a.x,a.y,Lr,0),u.emplaceBack(c.x,c.y,0,Lr),u.emplaceBack(l.x,l.y,Lr,Lr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(u,Ay.members),this.boundsSegments=tl.simpleSegment(0,0,4,2);const h=[],d=[Iy((f=this.coordinates)[0]),Iy(f[1]),Iy(f[2]),Iy(f[3])];var f;const[p,m,g,_]=function(e){let t=e[0][0],n=t,r=e[0][1],i=r;for(let o=1;o<e.length;o++)e[o][0]<t?t=e[o][0]:e[o][0]>n&&(n=e[o][0]),e[o][1]<r?r=e[o][1]:e[o][1]>i&&(i=e[o][1]);return[t,r,n-t,i-r]}(d);{const r=new oa,[i,a,l,c]=function(e){let t=e[0].x,n=t,r=e[0].y,i=r;for(let o=1;o<e.length;o++)e[o].x<t?t=e[o].x:e[o].x>n&&(n=e[o].x),e[o].y<r?r=e[o].y:e[o].y>i&&(i=e[o].y);return[t,r,n-t,i-r]}(n),u=e=>[(e.x-i)/l,(e.y-a)/c],[d,f,y,v]=n.map(u),x=function(e,t,n,r,i,a,l,c){const u=Cy(0,0,1,0,1,1,0,1);return s(u,u,o([],Cy(e,t,n,r,i,a,l,c)))}(d[0],d[1],f[0],f[1],y[0],y[1],v[0],v[1]);this.elevatedGlobePerspectiveTransform=Py(d[0],d[1],f[0],f[1],y[0],y[1],v[0],v[1]);const b=(e,t)=>{h.push(e.lng);const n=Math.round((e.lng-p)/g*Lr),i=Math.round((e.lat-m)/_*Lr),o=u(t),s=j([],[o[0],o[1],1],x),a=Math.round(s[0]/s[2]*Lr),l=Math.round(s[1]/s[2]*Lr);r.emplaceBack(n,i,a,l)},w=n[3].x-n[0].x,S=n[3].y-n[0].y,E=n[2].x-n[1].x,T=n[2].y-n[1].y;for(let e=0;e<65;e++){const r=e/64,i=[n[0].x+r*w,n[0].y+r*S],o=[n[1].x+r*E,n[1].y+r*T],s=o[0]-i[0],a=o[1]-i[1];for(let e=0;e<65;e++){const n=e/64,r={x:i[0]+s*n,y:i[1]+a*n};b(t.projection.unproject(r.x,r.y),r)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(r,Ay.members)}{this.maxLongitudeTriangleSize=0;let t=[],n=new Ea;const r=(e,r,i)=>{n.emplaceBack(e,r,i);const o=h[e],s=h[r],a=h[i],l=Math.min(Math.min(o,s),a),c=Math.max(Math.max(o,s),a)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(l+c/2)};for(let e=0;e<64;e++)for(let t=0;t<64;t++){const n=65*e+t,i=n+1,o=n+65,s=o+1;r(n,o,i),r(i,o,s)}[t,n]=function(e,t){const n=Array.from({length:e.length},(e,t)=>t);n.sort((t,n)=>e[t]-e[n]);const r=[],i=new Ea;for(let o=0;o<n.length;o++){const s=n[o];r.push(e[s]);const a=3*s,l=a+1;i.emplaceBack(t.uint16[a],t.uint16[l],t.uint16[l+1])}return[r,i]}(t,n),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(n)}this.elevatedGlobeSegments=tl.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,g/Lr,0,_/Lr,0,0,m,p,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,n=t.gl;!this._dirty||this.texture instanceof pp||(this.texture?this.texture.update(this.image):(this.texture=new fp(t,this.image,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const n=this.elevatedGlobeTrianglesCenterLongitudes;let r=(i=e+180)+360*Math.round((n[0]-i)/360);var i;const o=new tl,s=(e,n)=>{o.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:n,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-r)<=a){const e=Qe(n,0,n.length,r+a);return e===n.length||s(e,Je(n,e+1,n.length,r+360-a)-e),o}r<n[0]&&(r+=360);const l=Je(n,0,n.length,r-a);if(l===n.length)return s(0,n.length),o;s(0,l-0);const c=Qe(n,l+1,n.length,r+a);return c!==n.length&&s(c,n.length-c),o}}const My=(Math.pow(256,2)-1)/16907520;class Ry extends Ys{constructor(e,t,n,r){super(e,{layout:Ey||(Ey=new ks({visibility:new Cs(Ms.layout_raster.visibility)})),paint:Ty||(Ty=new ks({"raster-opacity":new Cs(Ms.paint_raster["raster-opacity"]),"raster-color":new Is(Ms.paint_raster["raster-color"]),"raster-color-mix":new Cs(Ms.paint_raster["raster-color-mix"]),"raster-color-range":new Cs(Ms.paint_raster["raster-color-range"]),"raster-hue-rotate":new Cs(Ms.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Cs(Ms.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Cs(Ms.paint_raster["raster-brightness-max"]),"raster-saturation":new Cs(Ms.paint_raster["raster-saturation"]),"raster-contrast":new Cs(Ms.paint_raster["raster-contrast"]),"raster-resampling":new Cs(Ms.paint_raster["raster-resampling"]),"raster-fade-duration":new Cs(Ms.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Cs(Ms.paint_raster["raster-emissive-strength"]),"raster-array-band":new Cs(Ms.paint_raster["raster-array-band"]),"raster-elevation":new Cs(Ms.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof ky&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[n,r]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(n)&&isNaN(r)||n===this._curRampRange[0]&&r===this._curRampRange[1]||(this.colorRamp=ph({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:r}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[n,r])}}let Oy,Ly,Dy,Ny,zy;class Fy extends Ys{constructor(e,t,n,r){super(e,{layout:Oy||(Oy=new ks({visibility:new Cs(Ms["layout_raster-particle"].visibility)})),paint:Ly||(Ly=new ks({"raster-particle-array-band":new Cs(Ms["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Cs(Ms["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Is(Ms["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Cs(Ms["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Cs(Ms["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Cs(Ms["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Cs(Ms["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Cs(Ms["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r),this._updateColorRamp(),this.lastInvalidatedAt=ft.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ph({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ft.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class By extends Ys{constructor(e,t){super(e,{},t,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function jy(e,t,n){const r=[0,0,1],i=J([]);return ee(i,i,n?-Ee(e)+Math.PI:Ee(e)),Q(i,i,-Ee(t)),U(r,r,i),D(r,r)}const Uy={None:0,Model:1,Symbol:2,FillExtrusion:4};class Vy{constructor(e,t,n,r){this.message=(e?`${e}: `:"")+n,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function Gy(e,t){const n=-1===e.indexOf("://");try{return new URL(e,n&&t?"http://example.com":void 0),!0}catch(e){return!1}}class Hy{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class $y{constructor(){this.instancedDataArray=new Da,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Wy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,t){}populate(e,t,n,r){this.tileToMeter=lc(n);const i=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=null!=s?s:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0,c=yc(o,i);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),c,n))continue;const u={id:e,sourceLayerIndex:l,index:a,geometry:i?c.geometry:_c(o,n,r),properties:o.properties,type:o.type,patterns:{}},h=this.addFeature(u,u.geometry,c);h&&t.featureIndex.insert(o,u.geometry,a,l,this.index,this.instancesPerModel[h].instancedDataArray.length,Lr/32)}this.lookup=null}update(e,t,n,r){for(const i in this.instancesPerModel){const t=this.instancesPerModel[i];for(const n in e)t.idToFeaturesIndex.hasOwnProperty(n)&&(this.evaluate(t.features[t.idToFeaturesIndex[n]],e[n],t,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];for(const t of n.features){const r=this.layers[0],i=t.feature,o=this.canonical,s=r.paint.get("model-rotation").evaluate(i,{},o),a=r.paint.get("model-scale").evaluate(i,{},o),l=r.paint.get("model-translation").evaluate(i,{},o);G(t.rotation,s)&&G(t.scale,a)&&G(t.translation,l)||(this.evaluate(t,t.featureStates,n,!0),e=!0)}}return e}updateReplacement(e,t,n,r){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(kd(this.activeReplacements,i))return!1;this.activeReplacements=i;let o=!1;for(const s in this.instancesPerModel){const t=this.instancesPerModel[s],i=t.instancedDataArray;for(const s of t.features){const t=s.instancedDataOffset,a=s.instancedDataCount;for(let s=0;s<a;s++){const a=16*(s+t);let l=i.float32[a+0];const c=l>Lr;l=c?l-Lr:l;const u=Math.floor(l),h=i.float32[a+1];let d=!1;for(const t of this.activeReplacements)if(!Ad(t,n,Uy.Model,r)&&!(t.min.x>u||u>t.max.x||t.min.y>h||h>t.max.y)&&(d=Nd(Dd(u,h,e.canonical,t.footprintTileId.canonical),t.footprint),d))break;i.float32[a]=d?l+Lr:l,o=o||d!==c}}}return o}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];n.instancedDataArray.length<0||0===n.instancedDataArray.length||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,xp.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const t of this.modelUris)e.removeModel(t,"",!0)}addFeature(e,t,n){const r=this.layers[0],i=r.layout.get("model-id").evaluate(n,{},this.canonical);if(!i)return He(`modelId is not evaluated for layer ${r.id} and it is not going to get rendered.`),i;(Gy(i,!1)||void 0!==this.styleDefinedModelURLs[i])&&(this.modelUris.includes(i)||this.modelUris.push(i)),this.instancesPerModel[i]||(this.instancesPerModel[i]=new $y);const o=this.instancesPerModel[i],s=o.instancedDataArray,a=new Hy(n,s.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=Lr||e.y<0||e.y>=Lr)continue;const t=(this.lookupDim-1)/Lr,n=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[n])continue;this.lookup[n]=1}this.instanceCount++;const r=s.length;s.resize(r+1),o.instancesEvaluatedElevation.push(0),s.float32[16*r]=e.x,s.float32[16*r+1]=e.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),i}getModelUris(){return this.modelUris}evaluate(e,t,n,r){const i=this.layers[0],o=e.feature,s=this.canonical,a=e.rotation=i.paint.get("model-rotation").evaluate(o,t,s),l=e.scale=i.paint.get("model-scale").evaluate(o,t,s),c=e.translation=i.paint.get("model-translation").evaluate(o,t,s),u=i.paint.get("model-color").evaluate(o,t,s);u.a=i.paint.get("model-color-mix-intensity").evaluate(o,t,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Pp(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let f=0;f<e.instancedDataCount;++f){const t=e.instancedDataOffset+f,i=16*t,o=n.instancedDataArray.float32;let a=0;r&&(a=o[i+6]-n.instancesEvaluatedElevation[t]);const l=0|o[i+1];o[i]=(0|o[i])+u.r/1.05,o[i+1]=l+u.g/1.05,o[i+2]=d,o[i+3]=1/(s.z>10?this.tileToMeter:lc(s,l)),o[i+4]=c[0],o[i+5]=c[1],o[i+6]=c[2]+a,o[i+7]=h[0],o[i+8]=h[1],o[i+9]=h[2],o[i+10]=h[4],o[i+11]=h[5],o[i+12]=h[6],o[i+13]=h[8],o[i+14]=h[9],o[i+15]=h[10],n.instancesEvaluatedElevation[t]=c[2]}}}let qy,Xy;qo(Wy,"ModelBucket",{omit:["layers"]}),qo($y,"PerModelAttributes"),qo(Hy,"ModelFeature");class Zy{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const r=n||e.findDEMTileFor(t);if(!r||!r.dem)return;const i=r.dem,o=r.tileID,s=1<<t.canonical.z-o.canonical.z;return new Zy(r,i.dim/Lr/s,[(t.canonical.x/s-o.canonical.x)*i.dim,(t.canonical.y/s-o.canonical.y)*i.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1];return new xe(Math.floor(e*this._scale+this._offset[0]),Math.floor(n))}getElevationAt(e,t,n,r){const i=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(i),a=Math.floor(o),l=this._dem;return r=!!r,n?un(un(l.get(s,a,r),l.get(s,a+1,r),o-a),un(l.get(s+1,a,r),l.get(s+1,a+1,r),o-a),i-s):l.get(s,a,r)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ec(1,e)*this._dem.stride}}const Ky=new Float32Array(262144),Yy=new Uint8Array(262144);function Jy(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,Jy(n));return t}function Qy(e,t,n){if(e.meshes)for(const r of e.meshes){if(r.aabb.min[0]===1/0)continue;const i=Uc.applyTransform(r.aabb,e.matrix);n.insert(t,i.min[0],i.min[1],i.max[0],i.max[1])}if(e.children)for(const r of e.children)Qy(r,t,n)}const ev=["","wall","door","roof","window","lamp","logo"];class tv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Jy(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Uc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Uc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.node.meshes)this.node.lightMeshIndex!==e&&(n.transformedAabb=Uc.applyTransformFast(n.aabb,this.node.matrix),t.encapsulate(n.transformedAabb)),e++;this.aabb=t}return this.aabb}}class nv{constructor(e,t,n,r,i,o,s,a){this.id=n,this.layers=e,this.layerIds=this.layers.map(e=>e.fqid),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.modelTraits|=Op.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=Op.HasMapboxMeshFeatures),i&&(this.modelTraits|=Op.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=o,this.worldview=a,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const l of t)this.nodesInfo.push(new tv(l)),Qy(l,s.featureIndexArray.length,s.grid),s.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,s.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,t){for(const n of this.getNodesInfo()){const r=n.node;r.footprint&&t.push({footprint:r.footprint,id:e})}}update(e){const t=0!==Object.keys(e).length;if(t&&!this.stateDependentLayers.length)return;const n=t?this.stateDependentLayers:this.layers;if(!be(e,this.states))for(const r of n)this.evaluate(r,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const n of t){const t=n.node;this.uploaded?this.updatePbrBuffer(t):zp(t,e,!0)}for(const n of t)Fp(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),t=!0);return t}needsReEvaluation(e,t,n){const r=e.transform.projectionOptions,i=e.style.getBrightness(),o=this.brightness!==i;if(!this.uploaded||this.dirty||r.name!==this.projection.name||rv(n.paint.get("model-color").value,o)||rv(n.paint.get("model-color-mix-intensity").value,o)||rv(n.paint.get("model-roughness").value,o)||rv(n.paint.get("model-emissive-strength").value,o)||rv(n.paint.get("model-height-based-emissive-strength-multiplier").value,o)){this.projection=r,this.brightness=i;const e=this.getNodesInfo();for(const t of e)t.state=null;return!0}return!1}evaluateTransform(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),r=this.id.canonical;for(const i of n){const e=i.feature;i.evaluatedTranslation=t.paint.get("model-translation").evaluate(e,{},r),i.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},r)}}evaluate(e,t){const n=this.getNodesInfo();for(const r of n){if(!r.node.meshes)continue;const n=r.feature,i=t&&t[n.id];if(be(i,r.state))continue;r.state=structuredClone(i);const o=r.node.meshes&&r.node.meshes[0].featureData,s=r.evaluatedColor[2],a=r.evaluatedRMEA[2],l=this.id.canonical;if(r.hasTranslucentParts=!1,o){for(let t=0;t<ev.length;t++){const o=ev[t];o.length&&(n.properties.part=o);const s=e.paint.get("model-color").evaluate(n,i,l).toPremultipliedRenderColor(null),a=e.paint.get("model-color-mix-intensity").evaluate(n,i,l);r.evaluatedColor[t]=[s.r,s.g,s.b,a],r.evaluatedRMEA[t][0]=e.paint.get("model-roughness").evaluate(n,i,l),r.evaluatedRMEA[t][2]=e.paint.get("model-emissive-strength").evaluate(n,i,l),r.evaluatedRMEA[t][3]=s.a,r.emissionHeightBasedParams[t]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(n,i,l),!r.hasTranslucentParts&&s.a<1&&(r.hasTranslucentParts=!0)}delete n.properties.part,ov(r,s!==r.evaluatedColor[2]||a!==r.evaluatedRMEA[2],this.modelTraits)}else r.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(n,i,l);r.evaluatedTranslation=e.paint.get("model-translation").evaluate(n,i,l),r.evaluatedScale=e.paint.get("model-scale").evaluate(n,i,l),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,n,r){const i=e.findDEMTileFor(n);if(i&&(i.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(i.dem&&i.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=i.tileID.overscaledZ;const t=Zy.create(e,n,i);if(!t)return;this.modelTraits&Op.HasMapboxMeshFeatures&&this.updateDEM(e,t,n,r);for(const e of this.getNodesInfo()){const n=e.node;if(!n.footprint||!n.footprint.vertices||!n.footprint.vertices.length)continue;const r=n.footprint.vertices;let i=t.getElevationAt(r[0].x,r[0].y,!0,!0);for(let e=1;e<r.length;e++)i=Math.min(i,t.getElevationAt(r[e].x,r[e].y,!0,!0));n.elevation=i}}this.terrainTile=i.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,n,r){let i=t._dem._modifiedForSources[r];if(void 0===i&&(t._dem._modifiedForSources[r]=[],i=t._dem._modifiedForSources[r]),i.includes(n.canonical))return;const o=t._dem.dim;i.push(n.canonical);let s=!1;for(const a of this.getNodesInfo()){const e=a.node;if(!e.footprint||!e.footprint.grid)continue;const n=e.footprint.grid,r=t.tileCoordToPixel(n.min.x,n.min.y),i=t.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(o-i.y,r.x),Math.min(r.y,o-i.x));if(l<0)continue;const c=ke(l,2,5);let u=Math.max(0,r.x-c),h=Math.max(0,r.y-c),d=Math.min(i.x+c,o-1),f=Math.min(i.y+c,o-1);for(let t=h;t<=f;++t)for(let e=u;e<=d;++e)Yy[t*o+e]=255;let p=0,m=0;for(let s=0;s<n.cellsY;++s)for(let e=0;e<n.cellsX;++e){if(!n.cells[s*n.cellsX+e])continue;const r=t.tileCoordToPixel(n.min.x+e/n.xScale,n.min.y+s/n.yScale),i=t.tileCoordToPixel(n.min.x+(e+1)/n.xScale,n.min.y+(s+1)/n.yScale);for(let e=r.y;e<=Math.min(i.y+1,o-1);++e)for(let n=r.x;n<=Math.min(i.x+1,o-1);++n)255===Yy[e*o+n]&&(Yy[e*o+n]=0,p+=t.getElevationAtPixel(n,e),m++)}const g=p/m;u=Math.max(1,r.x-c),h=Math.max(1,r.y-c),d=Math.min(i.x+c,o-2),f=Math.min(i.y+c,o-2),s=!0;for(let s=h;s<=f;++s)for(let e=u;e<=d;++e)0===Yy[s*o+e]&&(Ky[s*o+e]=t._dem.set(e,s,g));for(let s=1;s<c;++s){u=Math.max(1,r.x-s),h=Math.max(1,r.y-s),d=Math.min(i.x+s,o-2),f=Math.min(i.y+s,o-2);for(let e=h;e<=f;++e)for(let n=u;n<=d;++n){const r=e*o+n;if(255===Yy[r]){let i=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let r=-1;r<=1;++r){const c=(e+t)*o+n+r;if(Yy[c]>=s)continue;const h=Ky[c],d=Math.abs(h);d>a&&(i=h,a=d,l=r,u=t)}if(a>.1){const o=1-(s+.5*Math.abs(l*u))/c;let a=t._dem.get(n,e)+i*o;const h=t._dem.get(n+l,e+u),d=t._dem.get(n-l,e-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),Ky[r]=t._dem.set(n,e,a),Yy[r]=s}}}}}s&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=ft.now())}setFilter(e){this.filter=e?Ds(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new ys(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)Fp(t.node),Bp(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());for(const r of this.getNodesInfo()){const e=r.node.footprint;r.hiddenByReplacement=!!e&&!n.find(t=>t.footprint===e)}}getHeightAtTileCoord(e,t){const n=[],r=[0,0,0],i=l([]);for(const o of this.getNodesInfo()){const s=o.node.meshes[0],a=s.transformedAabb;if(e<a.min[0]||t<a.min[1]||e>a.max[0]||t>a.max[1])continue;if(!0===o.node.hidden)return{height:1/0,maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]};c(i,o.node.matrix),r[0]=e,r[1]=t,B(r,r,i);const l=(r[0]-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*Rp|0,u=Math.min(63,(r[1]-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*Rp|0)*Rp+Math.min(63,l),h=s.heightmap[u];if(!(h<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:h,maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new xe(e,t),new xe(e,t),n),n.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function rv(e,t){return e instanceof zo&&!e.isLightConstant&&t}function iv(e,t,n,r,i,o,s,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;n[3]>0&&(l=un(l,255*n[0],n[3]),c=un(c,255*n[1],n[3]),u=un(u,255*n[2],n[3]));const h=l<<8|c,d=u<<8|Math.floor(255*r[3]),f=function(e){const t=ke(e,0,2);return Math.min(Math.round(.5*t*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],p=ke(i[0],0,1),m=ke(i[1],0,1),g=ke(i[2],0,1),_=ke(i[3],0,1);let y,v,x,b;if(p!==m&&s!==o&&m!==p){const e=s-o;v=1/(e*(m-p)),x=-(o+e*p)/(e*(m-p));const t=ke(i[4],-1,1);b=Math.pow(10,t),y=255*g<<8|255*_}else y=65535,v=0,x=1,b=1;if(e.emplaceBack(h,d,f,y,v,x,b),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(h,d,f,y,v,x,b)}}function ov(e,t,n){const r=e.node;let i=0;const o=n&Op.HasMeshoptCompression;for(const s of r.meshes){if(r.lights&&r.lightMeshIndex===i)continue;if(!s.featureData)continue;s.featureArray=new Na,s.featureArray.reserve(s.featureData.length);let n=t;for(const t of s.featureData){const i=o?65535&t:t>>16&65535,a=o?t>>16&65535:65535&t,l=(15&a)<8?15&a:0,c=e.evaluatedRMEA[l],u=e.evaluatedColor[l],h=e.emissionHeightBasedParams[l];let d;if(n&&2===l&&r.lights&&(d=new Na,d.resize(10*r.lights.length)),iv(s.featureArray,i,u,c,h,s.aabb.min[2],s.aabb.max[2],d),d&&n){n=!1;const e=r.meshes[r.lightMeshIndex];e.featureArray=d,e.featureArray._trim()}}s.featureArray._trim(),i++}}function sv(e,t,n,r){const i=1<<e.z;t.lat=nc((r/Lr+e.y)/i),t.lng=tc((n/Lr+e.x)/i)}function av(e,t,n,r){const i=e.getNodesInfo()[t];if(!i||i.hiddenByReplacement||!i.node.meshes)return;let o=Number.MAX_VALUE;const s=i.node,a=n.tile,l=r.calculatePosMatrix(a.tileID.toUnwrapped(),r.worldSize),c=i.evaluatedScale;let f=0;r.elevation&&s.elevation&&(f=s.elevation*r.elevation.exaggeration()),h(l,l,[(s.anchor?s.anchor[0]:0)*(c[0]-1),(s.anchor?s.anchor[1]:0)*(c[1]-1),f]),d(l,l,c);const p=n.queryGeometry,m=p.isPointQuery()?p.screenBounds:p.screenGeometry,g=function(e){const t=u([],l,e.matrix);u(t,r.expandedFarZProjMatrix,t);for(let n=0;n<e.meshes.length;++n){const i=e.meshes[n];if(n===e.lightMeshIndex)continue;const s=Mp(m,r,t,i.aabb);null!=s&&(o=Math.min(s,o))}if(e.children)for(const n of e.children)g(n)};if(g(s),o===Number.MAX_VALUE)return;const _=new ql(0,0);return sv(a.tileID.canonical,_,i.node.anchor[0],i.node.anchor[1]),{intersectionZ:o,position:_,feature:i.feature}}qo(nv,"Tiled3dModelBucket",{omit:["layers"]}),qo(tv,"Tiled3dModelFeature");const lv={circle:class extends Ys{constructor(e,t,n,r){super(e,{layout:fu||(fu=new ks({"circle-sort-key":new Ps(Ms.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Cs(Ms.layout_circle["circle-elevation-reference"]),visibility:new Cs(Ms.layout_circle.visibility)})),paint:pu||(pu=new ks({"circle-radius":new Ps(Ms.paint_circle["circle-radius"]),"circle-color":new Ps(Ms.paint_circle["circle-color"]),"circle-blur":new Ps(Ms.paint_circle["circle-blur"]),"circle-opacity":new Ps(Ms.paint_circle["circle-opacity"]),"circle-translate":new Cs(Ms.paint_circle["circle-translate"]),"circle-translate-anchor":new Cs(Ms.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Cs(Ms.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Cs(Ms.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ps(Ms.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ps(Ms.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ps(Ms.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Cs(Ms.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r)}createBucket(e){return new Wc(e)}queryRadius(e){const t=e;return cu("circle-radius",this,t)+cu("circle-stroke-width",this,t)+uu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,r,i,o,s,a){const l=du(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Ju(e,r,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t,n){const r=Yu(this);return{config:new Pl(this,{zoom:t,lut:n}),defines:r,overrideFog:!1}}is3D(e){return!e&&!!this.layout&&"none"!==this.layout.get("circle-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends Ys{createBucket(e){return new rh(e)}constructor(e,t,n,r){super(e,{layout:ih||(ih=new ks({visibility:new Cs(Ms.layout_heatmap.visibility)})),paint:oh||(oh=new ks({"heatmap-radius":new Ps(Ms.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ps(Ms.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Cs(Ms.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Is(Ms.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Cs(Ms.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ph({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(e){return cu("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,r,i,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,n);return Ju(e,r,o,s,a,!0,!0,new xe(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t,n){return"heatmap"===e?{config:new Pl(this,{zoom:t,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Ys{constructor(e,t,n,r){super(e,{layout:sh||(sh=new ks({visibility:new Cs(Ms.layout_hillshade.visibility)})),paint:ah||(ah=new ks({"hillshade-illumination-direction":new Cs(Ms.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Cs(Ms.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Cs(Ms.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Cs(Ms.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Cs(Ms.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Cs(Ms.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Cs(Ms.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t,n){return{overrideFog:!1}}},fill:class extends Ys{constructor(e,t,n,r){super(e,{layout:ud||(ud=new ks({"fill-sort-key":new Ps(Ms.layout_fill["fill-sort-key"]),visibility:new Cs(Ms.layout_fill.visibility),"fill-elevation-reference":new Cs(Ms.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ps(Ms.layout_fill["fill-construct-bridge-guard-rail"])})),paint:hd||(hd=new ks({"fill-antialias":new Cs(Ms.paint_fill["fill-antialias"]),"fill-opacity":new Ps(Ms.paint_fill["fill-opacity"]),"fill-color":new Ps(Ms.paint_fill["fill-color"]),"fill-outline-color":new Ps(Ms.paint_fill["fill-outline-color"]),"fill-translate":new Cs(Ms.paint_fill["fill-translate"]),"fill-translate-anchor":new Cs(Ms.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ps(Ms.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Cs(Ms.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Cs(Ms.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ps(Ms.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ps(Ms.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ps(Ms.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t,n){return{config:new Pl(this,{zoom:t,lut:n}),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new cd(e)}queryRadius(){return uu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,r,i,o){return!e.queryGeometry.isAboveHorizon&&Zc(hu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(e){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const t=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=e?t&&!e:t}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends Ys{constructor(e,t,n,r){super(e,{layout:mf||(mf=new ks({visibility:new Cs(Ms["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Cs(Ms["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:gf||(gf=new ks({"fill-extrusion-opacity":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ps(Ms["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ps(Ms["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Ps(Ms["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ps(Ms["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ps(Ms["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ps(Ms["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ps(Ms["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ps(Ms["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Cs(Ms["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new rf(e)}queryRadius(){return uu(this.paint.get("fill-extrusion-translate"))}is3D(e){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,r,i,o,s,a,l){const c=du(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),d=[0,0],f=a&&o.elevation,p=o.elevation?o.elevation.exaggeration():1,m=e.tile.getBucket(this);if(f&&m instanceof rf){const e=m.centroidVertexArray,t=l+1;t<e.length&&(d[0]=e.geta_centroid_pos0(t),d[1]=e.geta_centroid_pos1(t))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(r=ff([r],[new xe(0,0),new xe(Lr,Lr)],e.tileID.canonical).map(e=>e.polygon).flat());const g=f?a:null,[_,y]=function(e,t,n,r,i,o,s,a,l,c,u){return"globe"===e.projection.name?function(e,t,n,r,i,o,s,a,l,c,u){const h=[],d=[],f=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,p=[0,0,0,1],m=[0,0,0,1],g=(e,t,n,r)=>{e[0]=t,e[1]=n,e[2]=r,e[3]=1},_=df();n>0&&(n+=_),r+=_;for(const y of t){const t=[],_=[];for(const h of y){const d=h.x+i.x,y=h.y+i.y,v=e.projection.projectTilePoint(d,y,u),x=e.projection.upVector(u,h.x,h.y);let b=n,w=r;if(s){const e=Af(d,y,n,r,s,a,l,c);b+=e.base,w+=e.top}0!==n?g(p,v.x+x[0]*f*b,v.y+x[1]*f*b,v.z+x[2]*f*b):g(p,v.x,v.y,v.z),g(m,v.x+x[0]*f*w,v.y+x[1]*f*w,v.z+x[2]*f*w),B(p,p,o),B(m,m,o),t.push(new _f(p[0],p[1],p[2])),_.push(new _f(m[0],m[1],m[2]))}h.push(t),d.push(_)}return[h,d]}(e,t,n,r,i,o,s,a,l,c,u):s?function(e,t,n,r,i,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],f=[];for(const c of d){const u=c.x+r.x,d=c.y+r.y,p=Af(u,d,t,n,o,s,a,l);h[0]=u,h[1]=d,h[2]=p.base,h[3]=1,K(h,h,i),h[3]=Math.max(h[3],1e-5);const m=new _f(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=p.top,h[3]=1,K(h,h,i),h[3]=Math.max(h[3],1e-5);const g=new _f(h[0]/h[3],h[1]/h[3],h[2]/h[3]);e.push(m),f.push(g)}c.push(e),u.push(f)}return[c,u]}(t,n,r,i,o,s,a,l,c):function(e,t,n,r,i){const o=[],s=[],a=i[8]*t,l=i[9]*t,c=i[10]*t,u=i[11]*t,h=i[8]*n,d=i[9]*n,f=i[10]*n,p=i[11]*n;for(const m of e){const e=[],t=[];for(const n of m){const o=n.x+r.x,s=n.y+r.y,m=i[0]*o+i[4]*s+i[12],g=i[1]*o+i[5]*s+i[13],_=i[2]*o+i[6]*s+i[14],y=i[3]*o+i[7]*s+i[15],v=m+a,x=g+l,b=_+c,w=Math.max(y+u,1e-5),S=m+h,E=g+d,T=_+f,A=Math.max(y+p,1e-5);e.push(new _f(v/w,x/w,b/w)),t.push(new _f(S/A,E/A,T/A))}o.push(e),s.push(t)}return[o,s]}(t,n,r,i,o)}(o,r,h,u,c,s,g,d,p,o.center.lat,e.tileID.canonical),v=e.queryGeometry;return function(e,t,n){let r=1/0;Zc(n,t)&&(r=Tf(n,t[0]));for(let i=0;i<t.length;i++){const o=t[i],s=e[i];for(let e=0;e<o.length-1;e++){const t=o[e],i=[t,o[e+1],s[e+1],s[e],t];qc(n,i)&&(r=Math.min(r,Tf(n,i)))}}return r!==1/0&&r}(_,y,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},building:class extends Ys{constructor(e,t,n,r){super(e,{layout:sm||(sm=new ks({visibility:new Cs(Ms.layout_building.visibility),"building-facade":new Ps(Ms.layout_building["building-facade"]),"building-facade-floors":new Ps(Ms.layout_building["building-facade-floors"]),"building-facade-window":new Ps(Ms.layout_building["building-facade-window"]),"building-roof-shape":new Ps(Ms.layout_building["building-roof-shape"]),"building-height":new Ps(Ms.layout_building["building-height"]),"building-base":new Ps(Ms.layout_building["building-base"])})),paint:am||(am=new ks({"building-opacity":new Cs(Ms.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Cs(Ms.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Cs(Ms.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Cs(Ms.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Cs(Ms.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Cs(Ms.paint_building["building-vertical-scale"]),"building-cast-shadows":new Cs(Ms.paint_building["building-cast-shadows"]),"building-color":new Ps(Ms.paint_building["building-color"]),"building-emissive-strength":new Ps(Ms.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Cs(Ms.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Cs(Ms.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new im(e)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(e){return!0}},line:class extends Ys{constructor(e,t,n,r){const i=km();super(e,i,t,n,r),i.layout&&(this.layout=new As(i.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Si,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=(()=>{if(Rm)return Rm;const e=km();return Rm=new Mm(e.paint.properties["line-width"].specification),Rm.useIntegerZoom=!0,Rm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new vm(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t,n){const r=Cm(this);return{config:new Pl(this,{zoom:t,lut:n}),defines:r,overrideFog:!1}}queryRadius(e){const t=e,n=Om(cu("line-width",this,t),cu("line-gap-width",this,t)),r=cu("line-offset",this,t);return n/2+Math.abs(r)+uu(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,r,i,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=hu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Om(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),l=this.paint.get("line-offset").evaluate(t,n);return l&&(r=function(e,t){const n=[],r=new xe(0,0);for(let i=0;i<e.length;i++){const o=e[i],s=[];for(let e=0;e<o.length;e++){const n=o[e],i=o[e+1],a=0===e?r:n.sub(o[e-1])._unit()._perp(),l=e===o.length-1?r:i.sub(n)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(t)._add(n))}n.push(s)}return n}(r,l*e.pixelToTileUnitsFactor)),function(e,t,n){for(let r=0;r<t.length;r++){const i=t[r];if(e.length>=3)for(let t=0;t<i.length;t++)if(iu(e,i[t]))return!0;if(Kc(e,i,n))return!0}return!1}(s,r,a)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(e){return!this.hasElevatedBuckets||this.layout&&"hd-road-markup"===this.layout.get("line-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:by,background:class extends Ys{constructor(e,t,n,r){super(e,{layout:wy||(wy=new ks({visibility:new Cs(Ms.layout_background.visibility)})),paint:Sy||(Sy=new ks({"background-pitch-alignment":new Cs(Ms.paint_background["background-pitch-alignment"]),"background-color":new Cs(Ms.paint_background["background-color"]),"background-pattern":new Cs(Ms.paint_background["background-pattern"]),"background-opacity":new Cs(Ms.paint_background["background-opacity"]),"background-emissive-strength":new Cs(Ms.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t,n){return{overrideFog:!1}}is3D(e){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:Ry,"raster-particle":Fy,sky:class extends Ys{constructor(e,t,n,r){super(e,{layout:Dy||(Dy=new ks({visibility:new Cs(Ms.layout_sky.visibility)})),paint:Ny||(Ny=new ks({"sky-type":new Cs(Ms.paint_sky["sky-type"]),"sky-atmosphere-sun":new Cs(Ms.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Cs(Ms.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Cs(Ms.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Cs(Ms.paint_sky["sky-gradient-radius"]),"sky-gradient":new Is(Ms.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Cs(Ms.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Cs(Ms.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Cs(Ms.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ph({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const n=this.paint.get("sky-atmosphere-sun"),r=!n,i=e.style.light,o=i.properties.get("position");return r&&"viewport"===i.properties.get("anchor")&&He("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?jy(o.azimuthal,90-o.polar,t):jy(n[0],90-n[1],t)}const n=this.paint.get("sky-gradient-center");return jy(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends Ys{constructor(e,t,n,r){super(e,{paint:zy||(zy=new ks({}))},t,null)}},model:class extends Ys{constructor(e,t,n,r){super(e,{layout:qy||(qy=new ks({visibility:new Cs(Ms.layout_model.visibility),"model-id":new Ps(Ms.layout_model["model-id"])})),paint:Xy||(Xy=new ks({"model-opacity":new Ps(Ms.paint_model["model-opacity"]),"model-rotation":new Ps(Ms.paint_model["model-rotation"]),"model-scale":new Ps(Ms.paint_model["model-scale"]),"model-translation":new Ps(Ms.paint_model["model-translation"]),"model-color":new Ps(Ms.paint_model["model-color"]),"model-color-mix-intensity":new Ps(Ms.paint_model["model-color-mix-intensity"]),"model-type":new Cs(Ms.paint_model["model-type"]),"model-cast-shadows":new Cs(Ms.paint_model["model-cast-shadows"]),"model-receive-shadows":new Cs(Ms.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Cs(Ms.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ps(Ms.paint_model["model-emissive-strength"]),"model-roughness":new Ps(Ms.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ps(Ms.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Cs(Ms.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Cs(Ms.paint_model["model-front-cutoff"]),"model-color-use-theme":new Ps({type:"string",default:"default","property-type":"data-driven"})}))},t,n,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Wy(e)}getProgramIds(){return["model"]}is3D(e){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof nv?Lr-1:0}queryIntersectsFeature(e,t,n,r,i,o){if(!this.modelManager)return!1;const s=this.modelManager,l=e.tile.getBucket(this);if(!(l&&l instanceof Wy))return!1;for(const c in l.instancesPerModel){const n=l.instancesPerModel[c],r=void 0!==t.id?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(n.idToFeaturesIndex.hasOwnProperty(r)){const t=n.features[n.idToFeaturesIndex[r]],i=s.getModel(c,this.scope);if(!i)return!1;let h=a();const d=new ql(0,0),f=l.canonical;let p=Number.MAX_VALUE;for(let r=0;r<t.instancedDataCount;++r){const s=16*(t.instancedDataOffset+r),a=n.instancedDataArray.float32,l=[a[s+4],a[s+5],a[s+6]];sv(f,d,a[s],0|a[s+1]),Lp(h,i,o,d,t.rotation,t.scale,l,!1,!1,!1),"globe"===o.projection.name&&(h=kp(h,o));const c=u([],o.projMatrix,h),m=e.queryGeometry,g=Mp(m.isPointQuery()?m.screenBounds:m.screenGeometry,o,c,i.aabb);null!=g&&(p=Math.min(g,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof Fo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ys{constructor(e,t,n,r){super(e,{layout:dd||(dd=new ks({"clip-layer-types":new Cs(Ms.layout_clip["clip-layer-types"]),"clip-layer-scope":new Cs(Ms.layout_clip["clip-layer-scope"])})),paint:fd||(fd=new ks({}))},t,n,r)}recalculate(e,t){super.recalculate(e,t)}createBucket(e){return new gd(e)}is3D(e){return!0}}},cv=new sn(0,0,0),uv={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},hv={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},dv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},fv={PAINT_ORDER_FILL_AND_STROKE:1},pv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},mv={MASK_TYPE_LUMINANCE:1};function gv(e,t,n){1===e&&t.icons.push(function(e,t){return function(e){if(e.usvg_tree.height||(e.usvg_tree.height=e.usvg_tree.width),!e.metadata)return e;const{metadata:t}=e;if(t.content_area){const{content_area:n}=t;null==n.top&&(n.top=n.left),null==n.width&&(n.width=e.usvg_tree.width),null==n.height&&(n.height=n.width)}return t.stretch_x&&t.stretch_x.length&&_v(t,"x"),t.stretch_y&&t.stretch_y.length&&_v(t,"y"),e}(e.readFields(yv,{name:void 0},t))}(n,n.readVarint()+n.pos))}function _v(e,t){const n=[],r=e[`stretch_${t}`];let i=null;for(let o=0;o<r.length;o++)null===i?i=0===n.length?r[0]:n[n.length-1][1]+r[o]:(n.push([i,i+r[o]]),i=null);e[`stretch_${t}_areas`]=n}function yv(e,t,n){1===e?t.name=n.readString():2===e?t.metadata=function(e,t){return e.readFields(vv,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},t)}(n,n.readVarint()+n.pos):3===e&&(t.usvg_tree=function(e,t){return e.readFields(wv,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},t)}(n,n.readVarint()+n.pos),t.data="usvg_tree")}function vv(e,t,n){1===e?t.stretch_x=n.readPackedVarint():2===e?t.stretch_y=n.readPackedVarint():3===e?t.content_area=function(e,t){return e.readFields(xv,{left:0},t)}(n,n.readVarint()+n.pos):4===e&&t.variables.push(function(e,t){return e.readFields(bv,{name:void 0},t)}(n,n.readVarint()+n.pos))}function xv(e,t,n){1===e?t.left=n.readVarint():2===e?t.width=n.readVarint():3===e?t.top=n.readVarint():4===e&&(t.height=n.readVarint())}function bv(e,t,n){1===e?t.name=n.readString():2===e&&(t.rgb_color=kv(n.readVarint()),t.value="rgb_color")}function wv(e,t,n){1===e?t.width=t.height=n.readVarint():2===e?t.height=n.readVarint():3===e?t.children.push(Sv(n,n.readVarint()+n.pos)):4===e?t.linear_gradients.push(function(e,t){return e.readFields(Rv,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},t)}(n,n.readVarint()+n.pos)):5===e?t.radial_gradients.push(function(e,t){return e.readFields(Dv,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},t)}(n,n.readVarint()+n.pos)):7===e?t.clip_paths.push(function(e,t){return e.readFields(Nv,{children:[]},t)}(n,n.readVarint()+n.pos)):8===e&&t.masks.push(function(e,t){const n=e.readFields(zv,{left:0,width:20,mask_type:mv.MASK_TYPE_LUMINANCE,children:[]},t);return null==n.height&&(n.height=n.width),null==n.top&&(n.top=n.left),n}(n,n.readVarint()+n.pos))}function Sv(e,t){return e.readFields(Ev,{},t)}function Ev(e,t,n){1===e?(t.group=function(e,t){return e.readFields(Tv,{opacity:255,children:[]},t)}(n,n.readVarint()+n.pos),t.node="group"):2===e&&(t.path=function(e,t){return e.readFields(Pv,{paint_order:1,commands:[],step:1,diffs:[],rule:uv.PATH_RULE_NON_ZERO},t)}(n,n.readVarint()+n.pos),t.node="path")}function Tv(e,t,n){1===e?t.transform=Av(n,n.readVarint()+n.pos):2===e?t.opacity=n.readVarint():5===e?t.clip_path_idx=n.readVarint():6===e?t.mask_idx=n.readVarint():7===e&&t.children.push(Sv(n,n.readVarint()+n.pos))}function Av(e,t){return e.readFields(Cv,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function Cv(e,t,n){1===e?t.sx=n.readFloat():2===e?t.ky=n.readFloat():3===e?t.kx=n.readFloat():4===e?t.sy=n.readFloat():5===e?t.tx=n.readFloat():6===e&&(t.ty=n.readFloat())}function Pv(e,t,n){1===e?t.fill=function(e,t){return e.readFields(Iv,{rgb_color:cv,paint:"rgb_color",opacity:255},t)}(n,n.readVarint()+n.pos):2===e?t.stroke=function(e,t){return e.readFields(Mv,{rgb_color:cv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},t)}(n,n.readVarint()+n.pos):3===e?t.paint_order=n.readVarint():5===e?n.readPackedVarint(t.commands):6===e?t.step=n.readFloat():7===e?n.readPackedSVarint(t.diffs):8===e&&(t.rule=n.readVarint())}function Iv(e,t,n){1===e?(t.rgb_color=kv(n.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=n.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=n.readVarint(),t.paint="radial_gradient_idx"):5===e&&(t.opacity=n.readVarint())}function kv(e){return new sn((e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1)}function Mv(e,t,n){1===e?(t.rgb_color=kv(n.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=n.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=n.readVarint(),t.paint="radial_gradient_idx"):5===e?n.readPackedFloat(t.dasharray):6===e?t.dashoffset=n.readFloat():7===e?t.miterlimit=n.readFloat():8===e?t.opacity=n.readVarint():9===e?t.width=n.readFloat():10===e?t.linecap=n.readVarint():11===e&&(t.linejoin=n.readVarint())}function Rv(e,t,n){1===e?t.transform=Av(n,n.readVarint()+n.pos):2===e?t.spread_method=n.readVarint():3===e?t.stops.push(Ov(n,n.readVarint()+n.pos)):4===e?t.x1=n.readFloat():5===e?t.y1=n.readFloat():6===e?t.x2=n.readFloat():7===e&&(t.y2=n.readFloat())}function Ov(e,t){return e.readFields(Lv,{offset:0,opacity:255,rgb_color:cv},t)}function Lv(e,t,n){1===e?t.offset=n.readFloat():2===e?t.opacity=n.readVarint():3===e&&(t.rgb_color=kv(n.readVarint()))}function Dv(e,t,n){1===e?t.transform=Av(n,n.readVarint()+n.pos):2===e?t.spread_method=n.readVarint():3===e?t.stops.push(Ov(n,n.readVarint()+n.pos)):4===e?t.cx=n.readFloat():5===e?t.cy=n.readFloat():6===e?t.r=n.readFloat():7===e?t.fx=n.readFloat():8===e?t.fy=n.readFloat():9===e&&(t.fr=n.readFloat())}function Nv(e,t,n){1===e?t.transform=Av(n,n.readVarint()+n.pos):2===e?t.clip_path_idx=n.readVarint():3===e&&t.children.push(Sv(n,n.readVarint()+n.pos))}function zv(e,t,n){1===e?t.left=t.top=n.readFloat():2===e?t.width=t.height=n.readFloat():3===e?t.top=n.readFloat():4===e?t.height=n.readFloat():5===e?t.mask_type=n.readVarint():6===e?t.mask_idx=n.readVarint():7===e&&t.children.push(Sv(n,n.readVarint()+n.pos))}class Fv{static calculate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=new Map,r=new Map;if(0===Object.keys(e).length)return n;t.forEach(e=>{r.set(e.name,e.rgb_color||new sn(0,0,0))});for(const[i,o]of Object.entries(e))r.has(i)?n.set(r.get(i).toString(),o):console.warn(`Ignoring unknown image variable "${i}"`);return n}}function Bv(e){let t=arguments.length>2?arguments[2]:void 0;const n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:255)/255,r=e.toString(),i=t.has(r)?t.get(r).clone():e.clone();return i.a*=n,i.toString()}function jv(e,t){if(!dt()){const n=document.createElement("canvas");return n.width=e,n.height=t,n}return new OffscreenCanvas(e,t)}function Uv(e,t){const n=Fv.calculate(t.params,e.metadata?e.metadata.variables:[]),r=e.usvg_tree,i=r.width,o=r.height,s=t.transform?t.transform:new DOMMatrix,a=Math.max(1,Math.round(i*s.a)),l=Math.max(1,Math.round(o*s.d)),c=new DOMMatrix([a/i,0,0,l/o,0,0]),u=jv(a,l).getContext("2d");return Vv(u,c,r,r,n),u.getImageData(0,0,a,l)}function Vv(e,t,n,r,i){for(const o of r.children)Gv(e,t,n,o,i)}function Gv(e,t,n,r,i){r.group?(e.save(),function(e,t,n,r,i){const o=null!=r.mask_idx?n.masks[r.mask_idx]:null,s=null!=r.clip_path_idx?n.clip_paths[r.clip_path_idx]:null;if(r.transform&&(t=Jv(r.transform).preMultiplySelf(t)),!function(e,t,n){return 255!==e.opacity||t||n}(r,null!=s,null!=o))return void Vv(e,t,n,r,i);const a=jv(e.canvas.width,e.canvas.height),l=a.getContext("2d");Vv(l,t,n,r,i),s&&Kv(l,t,n,s),o&&Yv(l,t,n,o,i),e.globalAlpha=r.opacity/255,e.drawImage(a,0,0)}(e,t,n,r.group,i),e.restore()):r.path&&(e.save(),function(e,t,n,r,i){e.setTransform(t),r.paint_order===fv.PAINT_ORDER_FILL_AND_STROKE?(Hv(e,n,r,i),Wv(e,n,r,i)):(Wv(e,n,r,i),Hv(e,n,r,i))}(e,t,n,r.path,i),e.restore())}function Hv(e,t,n,r){const i=n.fill;if(!i)return;const o=i.opacity/255;switch(e.save(),e.beginPath(),Qv(n,e),i.paint){case"rgb_color":e.fillStyle=Bv(i.rgb_color,i.opacity,r);break;case"linear_gradient_idx":{const n=t.linear_gradients[i.linear_gradient_idx];n.transform&&e.setTransform(Jv(n.transform).preMultiplySelf(e.getTransform())),e.fillStyle=qv(e,n,o,r);break}case"radial_gradient_idx":{const n=t.radial_gradients[i.radial_gradient_idx];n.transform&&e.setTransform(Jv(n.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Xv(e,n,o,r)}}e.fill($v(n)),e.restore()}function $v(e){return e.rule===uv.PATH_RULE_NON_ZERO?"nonzero":e.rule===uv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Wv(e,t,n,r){const i=n.stroke;if(!i)return;const o=ex(n);e.lineWidth=i.width,e.miterLimit=i.miterlimit,e.setLineDash(i.dasharray),e.lineDashOffset=i.dashoffset;const s=i.opacity/255;switch(i.paint){case"rgb_color":e.strokeStyle=Bv(i.rgb_color,i.opacity,r);break;case"linear_gradient_idx":e.strokeStyle=qv(e,t.linear_gradients[i.linear_gradient_idx],s,r,!0);break;case"radial_gradient_idx":e.strokeStyle=Xv(e,t.radial_gradients[i.radial_gradient_idx],s,r,!0)}switch(i.linejoin){case dv.LINE_JOIN_MITER_CLIP:case dv.LINE_JOIN_MITER:e.lineJoin="miter";break;case dv.LINE_JOIN_ROUND:e.lineJoin="round";break;case dv.LINE_JOIN_BEVEL:e.lineJoin="bevel"}switch(i.linecap){case hv.LINE_CAP_BUTT:e.lineCap="butt";break;case hv.LINE_CAP_ROUND:e.lineCap="round";break;case hv.LINE_CAP_SQUARE:e.lineCap="square"}e.stroke(o)}function qv(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Bv(e.rgb_color,e.opacity*n,r)}const{x1:o,y1:s,x2:a,y2:l}=t;let c=new DOMPoint(o,s),u=new DOMPoint(a,l);if(i){const e=Jv(t.transform);c=e.transformPoint(c),u=e.transformPoint(u)}const h=e.createLinearGradient(c.x,c.y,u.x,u.y);for(const d of t.stops)h.addColorStop(d.offset,Bv(d.rgb_color,d.opacity*n,r));return h}function Xv(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Bv(e.rgb_color,e.opacity*n,r)}const o=Jv(t.transform),{fx:s,fy:a,fr:l,cx:c,cy:u,r:h}=t;let d=new DOMPoint(s,a),f=new DOMPoint(c,u),p=l,m=h;if(i){d=o.transformPoint(d),f=o.transformPoint(f);const e=(o.a+o.d)/2;p=l*e,m=t.r*e}const g=e.createRadialGradient(d.x,d.y,p,f.x,f.y,m);for(const _ of t.stops)g.addColorStop(_.offset,Bv(_.rgb_color,_.opacity*n,r));return g}function Zv(e,t,n,r){const i=r.transform?Jv(r.transform).preMultiplySelf(t):t,o=jv(e.canvas.width,e.canvas.height),s=o.getContext("2d");for(const l of r.children)if(l.group)Zv(s,i,n,l.group);else if(l.path){const e=l.path,t=new Path2D;t.addPath(ex(e),i),s.fill(t,$v(e))}const a=null!=r.clip_path_idx?n.clip_paths[r.clip_path_idx]:null;a&&Kv(s,i,n,a),e.globalCompositeOperation="source-over",e.drawImage(o,0,0)}function Kv(e,t,n,r){const i=jv(e.canvas.width,e.canvas.height);Zv(i.getContext("2d"),t,n,r),e.globalCompositeOperation="destination-in",e.drawImage(i,0,0)}function Yv(e,t,n,r,i){if(0===r.children.length)return;const o=null!=r.mask_idx?n.masks[r.mask_idx]:null;o&&Yv(e,t,n,o,i);const s=e.canvas.width,a=e.canvas.height,l=jv(s,a),c=l.getContext("2d"),u=r.width,h=r.height,d=r.left,f=r.top,p=new Path2D,m=new Path2D;m.rect(d,f,u,h),p.addPath(m,t),c.clip(p);for(const y of r.children)Gv(c,t,n,y,i);const g=c.getImageData(0,0,s,a),_=g.data;if(r.mask_type===mv.MASK_TYPE_LUMINANCE)for(let y=0;y<_.length;y+=4)_[y+3]=_[y+3]/255*(.2126*_[y]+.7152*_[y+1]+.0722*_[y+2]);c.putImageData(g,0,0),e.globalCompositeOperation="destination-in",e.drawImage(l,0,0)}function Jv(e){return e?new DOMMatrix([e.sx,e.ky,e.kx,e.sy,e.tx,e.ty]):new DOMMatrix}function Qv(e,t){const n=e.step;let r=e.diffs[0]*n,i=e.diffs[1]*n;t.moveTo(r,i);for(let o=0,s=2;o<e.commands.length;o++)switch(e.commands[o]){case pv.PATH_COMMAND_MOVE:r+=e.diffs[s++]*n,i+=e.diffs[s++]*n,t.moveTo(r,i);break;case pv.PATH_COMMAND_LINE:r+=e.diffs[s++]*n,i+=e.diffs[s++]*n,t.lineTo(r,i);break;case pv.PATH_COMMAND_QUAD:{const o=r+e.diffs[s++]*n,a=i+e.diffs[s++]*n;r=o+e.diffs[s++]*n,i=a+e.diffs[s++]*n,t.quadraticCurveTo(o,a,r,i);break}case pv.PATH_COMMAND_CUBIC:{const o=r+e.diffs[s++]*n,a=i+e.diffs[s++]*n,l=o+e.diffs[s++]*n,c=a+e.diffs[s++]*n;r=l+e.diffs[s++]*n,i=c+e.diffs[s++]*n,t.bezierCurveTo(o,a,l,c,r,i);break}case pv.PATH_COMMAND_CLOSE:t.closePath()}return t}function ex(e){return Qv(e,new Path2D)}class tx{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}delete(e){this.cache.delete(e)}}qo(tx,"LRUCache");class nx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new dh(e,e.data)}getFromCache(e,t,n){return this.cacheMap.has(n)||this.cacheMap.set(n,new tx(150)),this.cacheMap.get(n).get(Xs(e.toString(),t))}setInCache(e,t,n,r){this.cacheDependenciesMap.has(r)||this.cacheDependenciesMap.set(r,new Map),this.cacheMap.has(r)||this.cacheMap.set(r,new tx(150));const i=this.cacheDependenciesMap.get(r),o=Xs(e.id.toString(),n);i.get(o)||i.set(o,new Set);const s=this.cacheMap.get(r),a=e.toString();i.get(o).add(a),s.put(Xs(e.toString(),n),t)}removeImagesFromCacheByIds(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.cacheMap.has(n)||!this.cacheDependenciesMap.has(n))return;const r=this.cacheMap.get(n),i=this.cacheDependenciesMap.get(n);for(const o of e){const e=Xs(o.toString(),t);if(i.has(e)){for(const t of i.get(e))r.delete(t);i.delete(e)}}}rasterize(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Uv;const o=this.getFromCache(e,n,r);if(o)return o.clone();const s=i(t.icon,e.options),a=nx._getImage(s);return this.setInCache(e,a,n,r),a.clone()}}class rx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function ix(e,t,n,r){let i=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(n[s]<e[s]||n[s]>t[s])return null}else{const a=1/r[s];let l=(e[s]-n[s])*a,c=(t[s]-n[s])*a;if(l>c){const e=l;l=c,c=e}if(l>i&&(i=l),c<o&&(o=c),i>o)return null}return i}function ox(e,t,n,r,i,o,s,a,l,c,u){const h=r-e,d=i-t,f=o-n,p=s-e,m=a-t,g=l-n,_=u[1]*g-u[2]*m,y=u[2]*p-u[0]*g,v=u[0]*m-u[1]*p,x=h*_+d*y+f*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,S=c[1]-t,E=c[2]-n,T=(w*_+S*y+E*v)*b;if(T<0||T>1)return null;const A=S*f-E*d,C=E*h-w*f,P=w*d-S*h,I=(u[0]*A+u[1]*C+u[2]*P)*b;return I<0||T+I>1?null:(p*A+m*C+g*P)*b}function sx(e,t,n){return(e-t)/(n-t)}function ax(e,t,n,r,i,o,s,a,l){const c=1<<n,u=o-r,h=s-i,d=(e+1)/c*u+r,f=(t+0)/c*h+i,p=(t+1)/c*h+i;a[0]=(e+0)/c*u+r,a[1]=f,l[0]=d,l[1]=p}class lx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let r=Math.ceil(Math.pow(2,t));const i=1/r,o=(e,t,n,r,i)=>{const o=r?1:0,s=(e+1)*n-o,a=t*n,l=(t+1)*n-o;i[0]=e*n,i[1]=a,i[2]=s,i[3]=l};let s=new rx(r);const a=[];for(let l=0;l<r*r;l++){o(l%r,Math.floor(l/r),i,!1,a);const t=ux(a[0],a[1],e),n=ux(a[2],a[1],e),c=ux(a[2],a[3],e),u=ux(a[0],a[3],e);s.minimums.push(Math.min(t,n,c,u)),s.maximums.push(Math.max(t,n,c,u)),s.leaves.push(1)}for(n.push(s),r/=2;r>=1;r/=2){const e=n[n.length-1];s=new rx(r);for(let t=0;t<r*r;t++){o(t%r,Math.floor(t/r),2,!0,a);const n=e.getElevation(a[0],a[1]),i=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),f=e.isLeaf(a[0],a[3]),p=Math.min(n.min,i.min,l.min,c.min),m=Math.max(n.max,i.max,l.max,c.max),g=u&&h&&d&&f;s.maximums.push(m),s.minimums.push(p),s.leaves.push(m-p<=5&&g?1:0)}n.push(s)}return n}(this.dem),n=t.length-1,r=t[n];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return ix([e,t,-100],[n,r,this.maximums[0]*s],i,o)}raycast(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,n,r,i,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:f,nodex:p,nodey:m,depth:g}=d.pop();if(this.leaves[a]){ax(p,m,g,e,t,n,r,u,h);const a=1<<g,l=(p+0)/a,c=(p+1)/a,d=(m+0)/a,_=(m+1)/a,y=ux(l,d,this.dem)*s,v=ux(c,d,this.dem)*s,x=ux(c,_,this.dem)*s,b=ux(l,_,this.dem)*s,w=ox(u[0],u[1],y,h[0],u[1],v,h[0],h[1],x,i,o),S=ox(h[0],h[1],x,u[0],h[1],b,u[0],u[1],y,i,o),E=Math.min(null!==w?w:Number.MAX_VALUE,null!==S?S:Number.MAX_VALUE);if(E!==Number.MAX_VALUE)return E;{const e=M([],i,o,f);if(cx(y,v,b,x,sx(e[0],u[0],h[0]),sx(e[1],u[1],h[1]))>=e[2])return f}continue}let _=0;for(let d=0;d<this._siblingOffset.length;d++){ax((p<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,n,r,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const f=ix(u,h,i,o);if(null!=f){const e=f;l[d]=e;let t=!1;for(let n=0;n<_&&!t;n++)e>=l[c[n]]&&(c.splice(n,0,d),t=!0);t||(c[_]=d),_++}}for(let e=0;e<_;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(p<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,r,i){if(1===e[r].isLeaf(t,n))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const o=r-1,s=e[o];let a=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],r=2*n+this._siblingOffset[c][1],i=s.getElevation(e,r),o=s.isLeaf(e,r),u=this._addNode(i.min,i.max,o);o&&(a|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)a&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],o,l+c)}}function cx(e,t,n,r,i,o){return un(un(e,n,o),un(t,r,o),i)}function ux(e,t,n){const r=n.dim,i=ke(e*r-.5,0,r-1),o=ke(t*r-.5,0,r-1),s=Math.floor(i),a=Math.floor(o),l=Math.min(s+1,r-1),c=Math.min(a+1,r-1);return cx(n.get(s,a),n.get(l,a),n.get(s,c),n.get(l,c),i-s,o-a)}const hx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function dx(e,t,n){return(256*e*256+256*t+n)/10-1e4}function fx(e,t,n){return 256*e+t+n/256-32768}class px{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return void He(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const i=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let e=0;e<i;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(i,e)]=o[this._idx(i-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,i)]=o[this._idx(e,i-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(i,-1)]=o[this._idx(i-1,0)],o[this._idx(-1,i)]=o[this._idx(0,i-1)],o[this._idx(i,i)]=o[this._idx(i-1,i-1)]}const s="terrarium"===n?fx:dx;for(let a=0;a<o.length;++a){const e=4*a;this.floatView[a]=s(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=ft.now()}_buildQuadTree(){this._tree=new lx(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=ke(e,-1,this.dim),t=ke(t,-1,this.dim));const n=this._idx(e,t);return this.floatView[n]}set(e,t,n){const r=this._idx(e,t),i=this.floatView[r];return this.floatView[r]=n,n-i}static getUnpackVector(e){return hx[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const n=[0,0,0,0],r=px.getUnpackVector(t);let i=Math.floor((e+r[3])/r[2]);return n[2]=i%256,i=Math.floor(i/256),n[1]=i%256,i=Math.floor(i/256),n[0]=i,n}getPixels(){return new fh({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,i=t*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-n*this.dim;for(let c=o;c<s;c++)for(let t=r;t<i;t++){const n=4*this._idx(t,c),r=4*this._idx(t+a,c+l);this.pixels[n+0]=e.pixels[r+0],this.pixels[n+1]=e.pixels[r+1],this.pixels[n+2]=e.pixels[r+2],this.pixels[n+3]=e.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function mx(e,t,n){1===e?t.headerLength=n.readFixed32():2===e?t.x=n.readVarint():3===e?t.y=n.readVarint():4===e?t.z=n.readVarint():5===e&&t.layers.push(function(e,t){return e.readFields(xx,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},t)}(n,n.readVarint()+n.pos))}function gx(e,t,n){1===e?(t.delta_filter=function(e,t){return e.readFields(_x,{blockSize:0},t)}(n,n.readVarint()+n.pos),t.filter="delta_filter"):2===e?(n.readVarint(),t.filter="zigzag_filter"):3===e?(n.readVarint(),t.filter="bitshuffle_filter"):4===e&&(n.readVarint(),t.filter="byteshuffle_filter")}function _x(e,t,n){1===e&&(t.blockSize=n.readVarint())}function yx(e,t,n){1===e?(n.readVarint(),t.codec="gzip_data"):2===e?(n.readVarint(),t.codec="jpeg_image"):3===e?(n.readVarint(),t.codec="webp_image"):4===e&&(n.readVarint(),t.codec="png_image")}function vx(e,t,n){let r=0,i=0;1===e?t.firstByte=n.readFixed64():2===e?t.lastByte=n.readFixed64():3===e?t.filters.push(function(e,t){return e.readFields(gx,{},t)}(n,n.readVarint()+n.pos)):4===e?t.codec=function(e,t){return e.readFields(yx,{},t)}(n,n.readVarint()+n.pos):5===e?i=n.readFloat():6===e?r=n.readFloat():7===e?t.bands.push(n.readString()):8===e?t.offset=n.readDouble():9===e&&(t.scale=n.readDouble()),0===t.offset&&(t.offset=i),0===t.scale&&(t.scale=r)}function xx(e,t,n){1===e?t.version=n.readVarint():2===e?t.name=n.readString():3===e?t.units=n.readString():4===e?t.tileSize=n.readVarint():5===e?t.buffer=n.readVarint():6===e?t.pixelFormat=n.readVarint():7===e&&t.dataIndex.push(function(e,t){return e.readFields(vx,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)}(n,n.readVarint()+n.pos))}function bx(e,t,n){if(2===e)!function(e,t,n){e.readFields(wx,n,t)}(n,n.readVarint()+n.pos,t);else if(3===e)throw new Error("Not implemented")}function wx(e,t,n){if(1===e){let e=0;const r=n.readVarint()+n.pos;for(;n.pos<r;)t[e++]=n.readVarint()}}function Sx(e,t){if(4!==t.length)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let n=t[3];for(let r=2;r>=1;r--){const i=1===r?1:0,o=2===r?1:0;for(let r=0;r<t[0];r++){const s=t[1]*r;for(let r=i;r<t[1];r++){const i=t[2]*(r+s);for(let r=o;r<t[2];r++){const o=t[3]*(r+i);for(let r=0;r<t[3];r++){const t=o+r;e[t]+=e[t-n]}}}}n*=t[r]}return e}function Ex(e){for(let t=0,n=e.length;t<n;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function Tx(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const n=e[t],r=e[t+1];e[t]=(240&n)>>4|(61440&n)>>8|(240&r)<<4|61440&r,e[t+1]=15&n|(3840&n)>>4|(15&r)<<8|(3840&r)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const n=e[t],r=e[t+1],i=e[t+2],o=e[t+3];e[t+0]=(192&n)>>6|(192&r)>>4|(192&i)>>2|192&o,e[t+1]=(48&n)>>4|(48&r)>>2|48&i|(48&o)<<2,e[t+2]=(12&n)>>2|12&r|(12&i)<<2|(12&o)<<4,e[t+3]=3&n|(3&r)<<2|(3&i)<<4|(3&o)<<6}return e;default:throw new Error(`Invalid pixel format, "${t}"`)}}qo(px,"DEMData"),qo(lx,"DemMinMaxQuadTree",{omit:["dem"]});var Ax=Uint8Array,Cx=Uint16Array,Px=Int32Array,Ix=new Ax([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kx=new Ax([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mx=new Ax([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rx=function(e,t){for(var n=new Cx(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Px(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return{b:n,r:i}},Ox=Rx(Ix,2),Lx=Ox.b,Dx=Ox.r;Lx[28]=258,Dx[258]=28;for(var Nx=Rx(kx,0).b,zx=new Cx(32768),Fx=0;Fx<32768;++Fx){var Bx=(43690&Fx)>>1|(21845&Fx)<<1;zx[Fx]=((65280&(Bx=(61680&(Bx=(52428&Bx)>>2|(13107&Bx)<<2))>>4|(3855&Bx)<<4))>>8|(255&Bx)<<8)>>1}var jx=function(e,t,n){for(var r=e.length,i=0,o=new Cx(t);i<r;++i)e[i]&&++o[e[i]-1];var s,a=new Cx(t);for(i=1;i<t;++i)a[i]=a[i-1]+o[i-1]<<1;s=new Cx(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],h=a[e[i]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[zx[h]>>l]=c;return s},Ux=new Ax(288);for(Fx=0;Fx<144;++Fx)Ux[Fx]=8;for(Fx=144;Fx<256;++Fx)Ux[Fx]=9;for(Fx=256;Fx<280;++Fx)Ux[Fx]=7;for(Fx=280;Fx<288;++Fx)Ux[Fx]=8;var Vx=new Ax(32);for(Fx=0;Fx<32;++Fx)Vx[Fx]=5;var Gx=jx(Ux,9),Hx=jx(Vx,5),$x=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Wx=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},qx=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Xx=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Zx=function(e,t,n){var r=new Error(t||Xx[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,Zx),!n)throw r;return r},Kx=new Ax(0),Yx="undefined"!=typeof TextDecoder&&new TextDecoder;try{Yx.decode(Kx,{stream:!0})}catch(e){}const Jx={gzip_data:"gzip"};class Qx extends Error{constructor(e){super(e),this.name="MRTError"}}const eb={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},tb={uint32:1,uint16:2,uint8:4},nb={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let rb;class ib{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const t=this.layers[e];if(!t)throw new Qx(`Layer '${e}' not found`);return t}getHeaderLength(e){const t=new Uint8Array(e),n=new DataView(e);if(13!==t[0])throw new Qx("File is not a valid MRT.");return n.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),n=this.getHeaderLength(e);if(t.length<n)throw new Qx(`Expected header with length >= ${n} but got buffer of length ${t.length}`);const r=new rb(t.subarray(0,n)).readFields(mx,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==r.x||this.y!==r.y||this.z!==r.z))throw new Qx(`Invalid attempt to parse header ${r.z}/${r.x}/${r.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=r.x,this.y=r.y,this.z=r.z;for(const i of r.layers)this.layers[i.name]=new ob(i,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],n=this.getLayer(e.layerName);for(let r of e.blockIndices){const i=n.dataIndex[r],o=i.firstByte-e.firstByte,s=i.lastByte-e.firstByte;if(n._blocksInProgress.has(r))continue;const a={layerName:n.name,firstByte:o,lastByte:s,pixelFormat:n.pixelFormat,blockIndex:r,blockShape:[i.bands.length].concat(n.bandShape),buffer:n.buffer,codec:i.codec.codec,filters:i.filters.map(e=>e.filter)};n._blocksInProgress.add(r),t.push(a)}return new sb(t,()=>{t.forEach(e=>n._blocksInProgress.delete(e.blockIndex))},(e,r)=>{if(t.forEach(e=>n._blocksInProgress.delete(e.blockIndex)),e)throw e;r.forEach(e=>{this.getLayer(e.layerName).processDecodedData(e)})})}}class ob{constructor(e,t){let{version:n,name:r,units:i,tileSize:o,pixelFormat:s,buffer:a,dataIndex:l}=e;if(this.version=n,1!==this.version)throw new Qx(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=r,this.units=i,this.tileSize=o,this.buffer=a,this.pixelFormat=eb[s],this.dataIndex=l,this.bandShape=[o+2*a,o+2*a,tb[this.pixelFormat]],this._decodedBlocks=new tx(t?t.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return tb[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(e=>{let{bands:t}=e;return t}).flat()}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.put(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[n,r]of this.dataIndex.entries()){for(const[i,o]of r.bands.entries())if(o===e)return{bandIndex:t+i,blockIndex:n,blockBandIndex:i};t+=r.bands.length}break;case"number":for(const[n,r]of this.dataIndex.entries()){if(e>=t&&e<t+r.bands.length)return{bandIndex:e,blockIndex:n,blockBandIndex:e-t};t+=r.bands.length}break;default:throw new Qx(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let t=1/0,n=-1/0;const r=[],i=new Set;for(const o of e){const{blockIndex:e}=this.getBlockForBand(o);if(e<0)throw new Qx(`Invalid band: ${JSON.stringify(o)}`);const s=this.dataIndex[e];r.includes(e)||r.push(e),i.add(e),t=Math.min(t,s.firstByte),n=Math.max(n,s.lastByte)}if(i.size>this.cacheSize)throw new Qx(`Number of blocks to decode (${i.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:t,lastByte:n,blockIndices:r}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:n}=this.getBlockForBand(e);if(t<0)throw new Qx(`Band not found: ${JSON.stringify(e)}`);const r=this._decodedBlocks.get(t.toString());if(!r)throw new Qx(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const i=this.dataIndex[t],o=this.bandShape.reduce((e,t)=>e*t,1),s=n*o,a=r.subarray(s,s+o);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:i.offset,scale:i.scale}}}ib.setPbf=function(e){rb=e};class sb{constructor(e,t,n){this.tasks=e,this._onCancel=t,this._onComplete=n,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}ib.performDecoding=function(e,t){const n=new Uint8Array(e);return Promise.all(t.tasks.map(e=>{const{layerName:t,firstByte:r,lastByte:i,pixelFormat:o,blockShape:s,blockIndex:a,filters:l,codec:c}=e,u=n.subarray(r,i+1),h=new Uint32Array(s[0]*s[1]*s[2]);let d;if("gzip_data"!==c)throw new Qx(`Unhandled codec: ${c}`);return d=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((o=function(e){31==e[0]&&139==e[1]&&8==e[2]||Zx(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)}(i=e))+8>i.length&&Zx(6,"invalid gzip data"),function(e,t,n){var r=e.length;if(!r||t.f&&!t.l)return n||new Ax(0);var i=!n,o=i||2!=t.i,s=t.i;i&&(n=new Ax(3*r));var a,l,c=function(e){var t=n.length;if(e>t){var r=new Ax(Math.max(2*t,e));r.set(n),n=r}},u=t.f||0,h=t.p||0,d=t.b||0,f=t.l,p=t.d,m=t.m,g=t.n,_=8*r;do{if(!f){u=Wx(e,h,1);var y=Wx(e,h+1,3);if(h+=3,!y){var v=e[(k=4+((h+7)/8|0))-4]|e[k-3]<<8,x=k+v;if(x>r){s&&Zx(0);break}o&&c(d+v),n.set(e.subarray(k,x),d),t.b=d+=v,t.p=h=8*x,t.f=u;continue}if(1==y)f=Gx,p=Hx,m=9,g=5;else if(2==y){var b=Wx(e,h,31)+257,w=Wx(e,h+10,15)+4,S=b+Wx(e,h+5,31)+1;h+=14;for(var E=new Ax(S),T=new Ax(19),A=0;A<w;++A)T[Mx[A]]=Wx(e,h+3*A,7);h+=3*w;var C=$x(T),P=(1<<C)-1,I=jx(T,C);for(A=0;A<S;){var k,M=I[Wx(e,h,P)];if(h+=15&M,(k=M>>4)<16)E[A++]=k;else{var R=0,O=0;for(16==k?(O=3+Wx(e,h,3),h+=2,R=E[A-1]):17==k?(O=3+Wx(e,h,7),h+=3):18==k&&(O=11+Wx(e,h,127),h+=7);O--;)E[A++]=R}}var L=E.subarray(0,b),D=E.subarray(b);m=$x(L),g=$x(D),f=jx(L,m),p=jx(D,g)}else Zx(1);if(h>_){s&&Zx(0);break}}o&&c(d+131072);for(var N=(1<<m)-1,z=(1<<g)-1,F=h;;F=h){var B=(R=f[qx(e,h)&N])>>4;if((h+=15&R)>_){s&&Zx(0);break}if(R||Zx(2),B<256)n[d++]=B;else{if(256==B){F=h,f=null;break}var j=B-254;B>264&&(j=Wx(e,h,(1<<(G=Ix[A=B-257]))-1)+Lx[A],h+=G);var U=p[qx(e,h)&z],V=U>>4;if(U||Zx(3),h+=15&U,D=Nx[V],V>3){var G=kx[V];D+=qx(e,h)&(1<<G)-1,h+=G}if(h>_){s&&Zx(0);break}o&&c(d+131072);var H=d+j;if(d<D){var $=0-D,W=Math.min(D,H);for($+d<0&&Zx(3);d<W;++d)n[d]=(void 0)[$+d]}for(;d<H;++d)n[d]=n[d-D]}}t.l=f,t.p=F,t.b=d,t.f=u,f&&(u=1,t.m=m,t.d=p,t.n=g)}while(!u);return d!=n.length&&i?(a=n,(null==(l=d)||l>a.length)&&(l=a.length),new Ax(a.subarray(0,l))):n.subarray(0,d)}(i.subarray(o,-8),{i:2},new Ax(((n=i)[(r=n.length)-4]|n[r-3]<<8|n[r-2]<<16|n[r-1]<<24)>>>0))));var n,r,i,o;const s=Jx[t];if(!s)throw new Error(`Unhandled codec: ${t}`);const a=new globalThis.DecompressionStream(s);return new Response(new Blob([e]).stream().pipeThrough(a)).arrayBuffer().then(e=>new Uint8Array(e))}(u,c).then(e=>(function(e,t){e.readFields(bx,t)}(new rb(e),h),new(0,nb[o])(h.buffer))),d.then(e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":Sx(e,s);break;case"zigzag_filter":Ex(e);break;case"bitshuffle_filter":Tx(e,o);break;default:throw new Qx(`Unhandled filter "${l[t]}"`)}return{layerName:t,blockIndex:a,data:e}}).catch(e=>{throw e})}))},qo(sb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),qo(ib,"MapboxRasterTile"),qo(ob,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class ab{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const lb=["id","tile","layer","source","sourceLayer","state"];class cb{constructor(e,t,n,r,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=r,this.properties=e.properties,this.id=i}clone(){const e=new cb(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const t of lb)void 0!==this[t]&&(e[t]=this[t]);return e}}class ub{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new $o(Lr,16,0),this.featureIndexArray=new Xa,this.promoteId=t,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i,o);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const r=e[t];n[0]=Math.min(n[0],r.x),n[1]=Math.min(n[1],r.y),n[2]=Math.max(n[2],r.x),n[3]=Math.max(n[3],r.y)}0!==s&&(n[0]-=s,n[1]-=s,n[2]+=s,n[3]+=s),n[0]<Lr&&n[1]<Lr&&n[2]>=0&&n[3]>=0&&l.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ec(new Jm(this.rawTileData)).layers,this.sourceLayerCoder=new ab(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t){var n=this;const{tilespaceGeometry:r,transform:i,tileTransform:o,pixelPosMatrix:s,availableImages:a,worldview:l}=t;this.loadVTLayers(),this.serializedLayersCache.clear();const c=r.bufferedTilespaceBounds,u=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(e,t,n,i)=>ou(r.bufferedTilespaceGeometry,e,t,n,i));u.sort(db);let h=null;i.elevation&&u.length>0&&(h=Zy.create(i.elevation,this.tileID));const d={};let f;for(let p=0;p<u.length;p++){const t=u[p];if(t===f)continue;f=t;const c=this.featureIndexArray.get(t);let m=null;this.is3DTile?this.loadMatchingModelFeature(d,c,e,r,i,l):this.loadMatchingFeature(d,c,e,a,l,function(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return m||(m=_c(e,n.tileID.canonical,o)),t.queryIntersectsFeature(r,e,a,m,n.z,i,s,h,l)})}return d}loadMatchingFeature(e,t,n,r,i,o){const{featureIndex:s,bucketIndex:a,sourceLayerIndex:l,layoutVertexArrayOffset:c}=t,u=this.bucketLayerIDs[a],h=n.layers,d=Object.keys(h);if(d.length&&!Ve(d,u))return;const f=n.sourceCache,p=this.sourceLayerCoder.decode(l),m=this.vtLayers[p].feature(s),g=this.getId(m,p);for(let _=0;_<u.length;_++){const t=u[_];if(!h[t])continue;const{styleLayer:n,targets:a}=h[t];let l={};void 0!==g&&(l=f.getFeatureState(n.sourceLayer,g));const d=!o||o(m,n,l,c);if(!d)continue;const p=new cb(m,this.z,this.x,this.y,g);p.tile=this.tileID.canonical,p.state=l;let y=this.serializedLayersCache.get(t);y||(y=n.serialize(),y.id=t,this.serializedLayersCache.set(t,y)),p.source=y.source,p.sourceLayer=y["source-layer"],p.layer=Le({},y),p.layer.paint=hb(y.paint,n.paint,m,l,r),p.layer.layout=hb(y.layout,n.layout,m,l,r);let v=!1;for(const e of a){this.updateFeatureProperties(p,e);const{filter:t}=e;if(t)if(m.properties=p.properties,t.needGeometry){const e=yc(m,!0);if(!t.filter(new ys(this.tileID.overscaledZ,{worldview:i}),e,this.tileID.canonical))continue}else if(!t.filter(new ys(this.tileID.overscaledZ,{worldview:i}),m))continue;v=!0,e.targetId&&this.addFeatureVariant(p,e)}v&&this.appendToResult(e,t,s,p,d)}}loadMatchingModelFeature(e,t,n,r,i,o){const{featureIndex:s,bucketIndex:a}=t,l=this.bucketLayerIDs[a],c=n.layers,u=Object.keys(c);if(!u.length||Ve(u,l))for(let h=0;h<l.length;h++){const t=l[h],{styleLayer:a,targets:u}=c[t];if("model"!==a.type)continue;const d=r.tile,f=d.getBucket(a);if(!(f&&f instanceof nv))continue;const p=av(f,s,r,i);if(!p)continue;const{z:m,x:g,y:_}=d.tileID.canonical,{feature:y,intersectionZ:v,position:x}=p;let b={};void 0!==y.id&&(b=n.sourceCache.getFeatureState(a.sourceLayer,y.id));const w=new cb({},m,g,_,y.id);w.tile=this.tileID.canonical,w.state=b,w.properties=y.properties,w.geometry={type:"Point",coordinates:[x.lng,x.lat]};let S=this.serializedLayersCache.get(t);S||(S=a.serialize(),S.id=t,this.serializedLayersCache.set(t,S)),w.source=S.source,w.sourceLayer=S["source-layer"],w.layer=Le({},S);let E=!1;for(const e of u){this.updateFeatureProperties(w,e);const{filter:t}=e;if(t)if(y.properties=w.properties,t.needGeometry){if(!t.filter(new ys(this.tileID.overscaledZ,{worldview:o}),y,this.tileID.canonical))continue}else if(!t.filter(new ys(this.tileID.overscaledZ,{worldview:o}),y))continue;E=!0,e.targetId&&this.addFeatureVariant(w,e)}E&&this.appendToResult(e,t,s,w,v)}}updateFeatureProperties(e,t,n){if(t.properties){const r={};for(const i in t.properties){const o=t.properties[i].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,n);null!=o&&(r[i]=o)}e.properties=r}}addFeatureVariant(e,t,n){const r={target:t.target,namespace:t.namespace,uniqueFeatureID:t.uniqueFeatureID};t.properties&&(r.properties=e.properties),e.variants=e.variants||{},e.variants[t.targetId]=e.variants[t.targetId]||[],e.variants[t.targetId].push(r)}appendToResult(e,t,n,r,i){let o=e[t];void 0===o&&(o=e[t]=[]),o.push({featureIndex:n,feature:r,intersectionZ:i})}lookupSymbolFeatures(e,t,n,r,i,o){const s={};this.loadVTLayers();for(const a of e)this.loadMatchingFeature(s,{bucketIndex:t,sourceLayerIndex:n,featureIndex:a,layoutVertexArrayOffset:0},r,i,o);return s}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const r=this.sourceLayerCoder.decode(n),i=this.vtFeatures[r];if(i[t])return i[t];const o=this.vtLayers[r].feature(t);return i[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const r=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[t];if(null!=r)if(Array.isArray(r)){if(!this.promoteIdExpression){const e=No(r);if("success"!==e.result)return void He(`Failed to create expression for promoteId: ${e.value.map(e=>`${e.key}: ${e.message}`).join(", ")}`);this.promoteIdExpression=e.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Jn),n=this.promoteIdExpression.evaluate({zoom:0},e)}else n=e.properties[r];"boolean"==typeof n&&(n=Number(n))}return n}}function hb(e,t,n,r,i){return Be(e,(e,o)=>{const s=t instanceof As?t.get(o):null;return s&&s.evaluate?s.evaluate(n,r,void 0,i):s})}function db(e,t){return t-e}qo(ub,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const fb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=n>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const i=fb[15&n];if(!i)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new pb(s,o,i,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,r=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=fb.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${n}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return mb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:s}=this,a=[0,i.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=r&&l.push(i[s])}continue}const d=h+u>>1,f=o[2*d],p=o[2*d+1];f>=e&&f<=n&&p>=t&&p<=r&&l.push(i[d]),(0===c?e<=f:t<=p)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=f:r>=p)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:i,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)vb(i[2*n],i[2*n+1],e,t)<=l&&a.push(r[n]);continue}const d=h+u>>1,f=i[2*d],p=i[2*d+1];vb(f,p,e,t)<=l&&a.push(r[d]),(0===c?e-n<=f:t-n<=p)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=f:t+n>=p)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function mb(e,t,n,r,i,o){if(i-r<=n)return;const s=r+i>>1;gb(e,t,s,r,i,o),mb(e,t,n,r,s-1,1-o),mb(e,t,n,s+1,i,1-o)}function gb(e,t,n,r,i,o){for(;i>r;){if(i-r>600){const s=i-r+1,a=n-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);gb(e,t,n,Math.max(r,Math.floor(n-a*c/s+u)),Math.min(i,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=r,l=i;for(_b(e,t,r,n),t[2*i+o]>s&&_b(e,t,r,i);a<l;){for(_b(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*r+o]===s?_b(e,t,r,l):(l++,_b(e,t,l,i)),l<=n&&(r=l+1),n<=l&&(i=l-1)}}function _b(e,t,n,r){yb(e,n,r),yb(t,2*n,2*r),yb(t,2*n+1,2*r+1)}function yb(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function vb(e,t,n,r){const i=e-n,o=t-r;return i*i+o*o}e.$=Qn,e.A=Kt,e.B=Nn,e.C=Xs,e.D=Of,e.E=en,e.F=2,e.G=Xg,e.H=Wg,e.I=tn,e.J=Xn,e.K=class extends Vy{},e.L=fn,e.M=Rs,e.N=To,e.O=wo,e.P=xe,e.Q=Eo,e.R=Rt,e.S=Do,e.T=fp,e.U=Os,e.V=Vy,e.W=Bo,e.X=No,e.Y=di,e.Z=pi,e._=hi,e.a=function(e){return rt.API_CDN_URL_REGEX.test(e)},e.a$=Ne,e.a0=on,e.a1=Ls,e.a2=Ao,e.a3=So,e.a4=function(e){const t=e.value;let n=[];if(!t)return n;const r=Xn(t);return"string"!==r?(n=n.concat([new Vy(e.key,t,`string expected, "${r}" found`)]),n):(Gy(t,!0)||(n=n.concat([new Vy(e.key,t,`invalid url "${t}"`)])),n)},e.a5=Ms,e.a6=bs,e.a7=ks,e.a8=Cs,e.a9=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return qe(e.expression.evaluate(t))}interpolate(e,t,n){return{x:un(e.x,t.x,n),y:un(e.y,t.y,n),z:un(e.z,t.z,n),azimuthal:un(e.azimuthal,t.azimuthal,n),polar:un(e.polar,t.polar,n)}}},e.aA=K,e.aB=Dl,e.aC=iu,e.aD=Jl,e.aE=hc,e.aF=function(e,t){const n={};for(let r=0;r<t.length;r++){const i=t[r];i in e&&(n[i]=e[i])}return n},e.aG=Xl,e.aH=Ql,e.aI=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,r){const i=this.entries[e]=this.entries[e]||{callbacks:[]};if(i.result){const[e,n]=i.result;return this.scheduler?this.scheduler.add(()=>{r(e,n)},t):r(e,n),()=>{}}return i.callbacks.push(r),i.cancel||(i.cancel=n((n,r)=>{i.result=[n,r];for(const e of i.callbacks)this.scheduler?this.scheduler.add(()=>{e(n,r)},t):e(n,r);setTimeout(()=>delete this.entries[e],3e3)})),()=>{i.result||(i.callbacks=i.callbacks.filter(e=>e!==r),i.callbacks.length||(i.cancel(),delete this.entries[e]))}}},e.aJ=function(e,t,n){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},t=>{const r=Nt(e.request,(e,r,i,o)=>{e?t(e):r&&t(null,{vectorTile:n?void 0:new Ec(new Jm(r)),rawData:r,cacheControl:i,expires:o})});return()=>{r.cancel(),t()}},t)},e.aK=function(e){Et++,Et>yt&&(e.getActor().send("enforceCacheSizeLimit",_t),Et=0)},e.aL=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.aM=yu,e.aN=Ry,e.aO=Fy,e.aP=ky,e.aQ=function(e,t){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let r=0;r<e.length;r++){const t=document.createElement("source");zt(e[r])||(n.crossOrigin="Anonymous"),t.src=e[r],n.appendChild(t)}return{cancel:()=>{}}},e.aR=pp,e.aS=function(e){return fetch(e).then(e=>e.arrayBuffer()).then(t=>up(t,0,e))},e.aT=qp,e.aU=class{constructor(e,t,n,r){this.id=e,this.position=null!=t?new ql(t[0],t[1]):new ql(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new Uc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(u(e.matrix,t,e.matrix),e.meshes)for(const n of e.meshes){const t=Uc.applyTransformFast(n.aabb,e.matrix);this.aabb.encapsulate(t)}if(e.children)for(const n of e.children)this._applyTransformations(n,e.matrix)}computeBoundsAndApplyParent(){const e=l([]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Lp(this.matrix,this,e.transform,this.position,t,n,r,i,o,s)}upload(e){if(!this.uploaded){for(const t of this.nodes)zp(t,e);for(const e of this.nodes)Fp(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Bp(e)}},e.aV=Fe,e.aW=N_,e.aX=tc,e.aY=nc,e.aZ=oa,e.a_=Ea,e.aa=ys,e.ab=Fo,e.ac=cc,e.ad=B,e.ae=w,e.af=Me,e.ag=As,e.ah=Hu,e.ai=un,e.aj=Lr,e.ak=hn,e.al=Ee,e.am=sn,e.an=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,n]=e;const r=qe([1,t,n]);return{x:r.x,y:r.y,z:r.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:un(e.x,t.x,n),y:un(e.y,t.y,n),z:un(e.z,t.z,n)}}},e.ao=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=new xe(n,n),o=e.sub(i),s=t.add(i),a=[o,new xe(s.x,o.y),s,new xe(o.x,s.y)];return r&&a.push(o.clone()),a},e.ap=function(e,t){const n=[];for(let r=0;r<e.length;r++){const i=Re(r-1,-1,e.length-1),o=Re(r+1,-1,e.length-1),s=e[r],a=e[o],l=e[i].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));n.push(s.add(h))}return n},e.aq=z_,e.ar=ou,e.as=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return S(((t.x-n)*e.scale-e.x)*Lr,(t.y*e.scale-e.y)*Lr,rc(t.z,t.y))},e.at=H,e.au=D,e.av=Lc,e.aw=Sm,e.ax=function(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),r=Math.max(r,o.x),i=Math.max(i,o.y);return{min:new xe(t,n),max:new xe(r,i)}},e.ay=ke,e.az=u,e.b=function(e){return rt.API_FONTS_REGEX.test(e)},e.b$=T_,e.b0=ja,e.b1=my,e.b2=function(){_s.isLoading()||_s.isLoaded()||"deferred"!==ms()||gs()},e.b3=Ds,e.b4=yc,e.b5=cb,e.b6=Ze,e.b7=vm,e.b8=cd,e.b9=_c,e.bA=function(e,t){const{x:n,y:r}=e.point,i=Gu(n,r,e.worldSize/e._pixelsPerMercatorPixel,0,0);return u(i,i,ju(ku(t)))},e.bB=r,e.bC=V,e.bD=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.bE=M,e.bF=z,e.bG=N,e.bH=zg,e.bI=mg,e.bJ=Ng,e.bK=function(e,t,n,r,i){const o=5*t+2;e.float32[o+0]=n,e.float32[o+1]=r,e.float32[o+2]=i},e.bL=hy,e.bM=ae,e.bN=ue,e.bO=le,e.bP=ge,e.bQ=Re,e.bR=function(e,t,r,i){var o=new n(4);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o},e.bS=bf,e.bT=qc,e.bU=Hm,e.bV=Ad,e.bW=Uy,e.bX=Dd,e.bY=Nd,e.bZ=Ag,e.b_=__,e.ba=ra,e.bb=La,e.bc=Eu,e.bd=tl,e.be=vh,e.bf=Ay,e.bg=function(e,t){const n=Hu(t.zoom);if(0===n)return ku(e);const r=Lu(e),i=Du(r),o=Jl(r.getWest())*t.worldSize,s=Jl(r.getEast())*t.worldSize,a=Ql(r.getNorth())*t.worldSize,l=Ql(r.getSouth())*t.worldSize,u=[o,a,0],h=[s,a,0],d=[o,l,0],f=[s,l,0],p=c([],t.globeMatrix);return B(u,u,p),B(h,h,p),B(d,d,p),B(f,f,p),i[0]=Mu(i[0],d,n),i[1]=Mu(i[1],f,n),i[2]=Mu(i[2],h,n),i[3]=Mu(i[3],u,n),Uc.fromPoints(i)},e.bh=Bu,e.bi=c,e.bj=Nu,e.bk=Mu,e.bl=ia,e.bm=Su,e.bn=g,e.bo=h,e.bp=ib,e.bq=Jm,e.br=Nt,e.bs=function(e,t){const n=[];for(const r in e)r in t||n.push(r);return n},e.bt=Oe,e.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.bv=be,e.bw=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.bx=l,e.by=m,e.bz=a,e.c=ot,e.c$=45,e.c0=pb,e.c1=k,e.c2=W,e.c3=J,e.c4=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*a,e[1]=i*l-r*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},e.c5=Q,e.c6=Ye,e.c7=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.c8=y,e.c9=function(e,t,n,r,i){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+r)*(o=1/(r-i)),e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e},e.cA=gu,e.cB=Ou,e.cC=function(e,t,n,r,i,o,s,a,l){if("globe"===l.name)return Ou(e,t,new gu(n,r,i),!1);const c=N_({z:n,x:r,y:i},l);return new Uc([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.cD=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},e.cE=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},e.cF=function(e){const t=Math.round((e+45+360)%360/90)%4;return Ae[t]},e.cG=ic,e.cH=X,e.cI=zl,e.cJ=function(e){const t=l(new Float64Array(16));u(t,e.pixelMatrix,e.globeMatrix);const n=[0,Ul,0],r=[0,Vl,0];return B(n,n,t),B(r,r,t),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Wu(e,new ql(e.center.lat,90)),r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!Wu(e,new ql(e.center.lat,-90))]},e.cK=function(e,t){const{scale:n}=e.tileTransform,r=n*Lr/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return function(e,t,n){var r=t[1],i=t[2],o=t[3],s=n[0],a=n[1];return e[0]=t[0]*s,e[1]=r*s,e[2]=i*a,e[3]=o*a,e}(new Float32Array(4),t.inverseAdjustmentMatrix,[r,r])},e.cL=Ep,e.cM=v,e.cN=wp,e.cO=function(e){const t=wp(e,!0);return r([],[t[0],t[1],t[4],t[5]])},e.cP=d,e.cQ=Dc,e.cR=f,e.cS=function(e){const{x:t,y:n}=e.point,{lng:r,lat:i}=e._center;return Gu(t,n,e.worldSize,r,i)},e.cT=C,e.cU=Te,e.cV=vu,e.cW=su,e.cX=Nl,e.cY=function(e,t,n){let r=0;for(let i=0;i<2;++i){const n=0;e[i]>n&&(r+=(e[i]-n)*(e[i]-n)),t[i]<n&&(r+=(n-t[i])*(n-t[i]))}return r},e.cZ=function(e){return e*e*e*e*e},e.c_=Yl,e.ca=function(e,t,n,r,i,o,s){var a=1/(t-n),l=1/(r-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*l,e[14]=(s+o)*c,e[15]=1,e},e.cb=ec,e.cc=function(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},e.cd=hl,e.ce=pl,e.cf=dl,e.cg=fl,e.ch=yl,e.ci=ql,e.cj=iy,e.ck=function(){var e=new n(4);return n!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.cl=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+o*a,e[1]=i*l+s*a,e[2]=r*-a+o*l,e[3]=i*-a+s*l,e},e.cm=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.cn=G,e.co=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.cp=ie,e.cq=U,e.cr=_u,e.cs=3,e.ct=2,e.cu=7,e.cv=6,e.cw=F,e.cx=x,e.cy=jc,e.cz=Sp,e.d=function(e){return rt.API_TILEJSON_REGEX.test(e)},e.d$=(e,t,n,r,i,o,s,a,l,c)=>{const u=e.transform,h=u.calculatePixelsToTileUnitsMatrix(t),d="none"===n.paint.get("line-trim-color-use-theme").constantOr("default"),f=u.pitch<15?Em(.07,.7,ke((14-u.zoom)/5,0,1)):.07;return{u_matrix:Am(e,t,n,r),u_pixels_to_tile_units:h,u_device_pixel_ratio:o,u_width_scale:s,u_floor_width_scale:a,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:i,u_texsize:Pm(n)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Tm(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(d?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:f,u_tile_to_meter:lc(t.tileID.canonical,0),u_ground_shadow_factor:c}},e.d0=ml,e.d1=function(e,t,n){const r=Math.sqrt(e*e+t*t+n*n),i=r>0?Math.acos(n/r)*Se:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*Se+90:0;return o<0&&(o+=360),[r,o,i]},e.d2=S,e.d3=qe,e.d4=lc,e.d5=T,e.d6=Uc,e.d7=A,e.d8=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.d9=Gy,e.dA=Lu,e.dB=function(e){const t=ic-5;e=ke(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(Ee(e))),3);return Math.round(n*(jl.length-1))},e.dC=function(e,t,n,r){const i=t.getNorth(),o=t.getSouth(),a=t.getWest(),l=t.getEast(),c=1<<e.z,u=l-a,h=i-o,d=u/Bl,f=-h/jl[n],p=[0,d,0,f,0,0,i,a,0];if(e.z>0){const e=180/r;s(p,p,[e/u+1,0,0,0,e/h+1,0,-.5*e/d,.5*e/f,1])}return p[2]=c,p[5]=e.x,p[8]=e.y,p},e.dD=ku,e.dE=function(e,t,n){const r=l(new Float64Array(16)),i=(t/(1<<e)-.5)*Math.PI*2;return p(r,n.globeMatrix,i),Float32Array.from(r)},e.dF=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const n=t.getSource().maxzoom,r=1<<n,i=Math.floor(e.x),o=Math.floor((e.x-i)*r),s=Math.floor(e.y*r),a=this.findDEMTileFor(new yu(n,i,n,o,s));return!(!a||!a.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const r=this._source();if(!r)return t;if(e.y<0||e.y>1)return t;const i=r.getSource().maxzoom,o=1<<i,s=Math.floor(e.x),a=e.x-s,l=new yu(i,s,i,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,f=(e.y*h-c.tileID.canonical.y)*u.dim,p=Math.floor(d),m=Math.floor(f);return(n?this.exaggeration():1)*un(un(u.get(p,m),u.get(p,m+1),f-m),un(u.get(p+1,m),u.get(p+1,m+1),f-m),d-p)}getAtTileOffset(e,t,n){const r=1<<e.canonical.z;return this.getAtPointOrZero(new cc(e.wrap+(e.canonical.x+t/Lr)/r,(e.canonical.y+n/Lr)/r))}getAtTileOffsetFunc(e,t,n,r){return i=>{const o=this.getAtTileOffset(e,i.x,i.y),s=r.upVector(e.canonical,i.x,i.y);return k(s,s,o*r.upVectorScale(e.canonical,t,n).metersToTile),s}}getForTilePoints(e,t,n,r){if(this.isUsingMockSource())return!1;const i=Zy.create(this,e,r);return!!i&&(t.forEach(e=>{e[2]=this.exaggeration()*i.getElevationAt(e[0],e[1],n)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,r=t.tileID,i=1<<e.canonical.z-r.canonical.z;let o=e.canonical.x/i-r.canonical.x,s=e.canonical.y/i-r.canonical.y,a=0;for(let l=0;l<e.canonical.z-r.canonical.z&&!n.leaves[a];l++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=n.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*n.minimums[a],max:this.exaggeration()*n.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,n=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const i of e){const e=this.getMinMaxForTile(i.tileID);e&&(n=Math.min(n,e.min),r=Math.max(r,e.max),t=!0)}return t?{min:n,max:r}:null}},e.dG=fh,e.dH=Tu,e.dI=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.dJ=i,e.dK=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.dL=j,e.dM=Vu,e.dN=et,e.dO=tt,e.dP=256,e.dQ=function(e,t){const n=[0,0,0];return B(n,n,Bu(ku(t.canonical))),B(n,n,e),n},e.dR=e=>({u_matrix:new yl(e),u_texsize:new fl(e),u_pixels_to_tile_units:new bl(e),u_device_pixel_ratio:new dl(e),u_width_scale:new dl(e),u_floor_width_scale:new dl(e),u_image:new hl(e),u_units_to_pixels:new fl(e),u_tile_units_to_pixels:new dl(e),u_alpha_discard_threshold:new dl(e),u_trim_offset:new fl(e),u_trim_fade_range:new fl(e),u_trim_color:new ml(e),u_emissive_strength:new dl(e),u_zbias_factor:new dl(e),u_tile_to_meter:new dl(e),u_ground_shadow_factor:new pl(e),u_pattern_transition:new dl(e)}),e.dS=e=>({u_matrix:new yl(e),u_pixels_to_tile_units:new bl(e),u_device_pixel_ratio:new dl(e),u_width_scale:new dl(e),u_floor_width_scale:new dl(e),u_units_to_pixels:new fl(e),u_dash_image:new hl(e),u_gradient_image:new hl(e),u_image_height:new dl(e),u_texsize:new fl(e),u_tile_units_to_pixels:new dl(e),u_alpha_discard_threshold:new dl(e),u_trim_offset:new fl(e),u_trim_fade_range:new fl(e),u_trim_color:new ml(e),u_emissive_strength:new dl(e),u_zbias_factor:new dl(e),u_tile_to_meter:new dl(e),u_ground_shadow_factor:new pl(e)}),e.dT=e=>({u_camera_to_center_distance:new dl(e),u_extrude_scale:new bl(e),u_device_pixel_ratio:new dl(e),u_matrix:new yl(e),u_inv_rot_matrix:new yl(e),u_merc_center:new fl(e),u_tile_id:new pl(e),u_zoom_transition:new dl(e),u_up_dir:new pl(e),u_emissive_strength:new dl(e)}),e.dU=wa,e.dV=Gm,e.dW=Yu,e.dX=(e,t,n,r,i,o)=>{const s=e.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const e=Vu(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=s.calculatePixelsToTileUnitsMatrix(n);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ft.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Ku,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=r,c.u_merc_center=i,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Hu(s.zoom);const e=i[0]*Lr,n=i[1]*Lr;c.u_up_dir=s.projection.upVector(new gu(0,0,0),e,n)}return c},e.dY=Cm,e.dZ=zn,e.d_=(e,t,n,r,i,o,s,a,l,c)=>{const u=e.transform,h=u.pitch<15?Em(.07,.7,ke((14-u.zoom)/5,0,1)):.07,d="none"===n.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:Am(e,t,n,r),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:i,u_width_scale:o,u_floor_width_scale:s,u_image:0,u_tile_units_to_pixels:Tm(t,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(d?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:h,u_tile_to_meter:lc(t.tileID.canonical,0),u_ground_shadow_factor:l,u_pattern_transition:c}},e.da=function(e,t){return e.readFields(gv,{icons:[]},t)},e.db=Nf,e.dc=n_,e.dd=t_,e.de=Lt,e.df=ds,e.dg=mt,e.dh=Zt,e.di=Ue,e.dj=function(e){const t=e.indexOf(qs);return t>=0?e.slice(0,t):e},e.dk=function(e){return e.indexOf(qs)>=0},e.dl=function(e){const t=e.lastIndexOf(qs);return t>=0?e.slice(t+1):""},e.dm=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},e.dn=function(e,t,n,r){return"custom"===e.type?new By(e,t):new lv[e.type](e,t,n,r)},e.dp=je,e.dq=function(e){const t=e.indexOf(qs);return t>=0?e.slice(t+1):""},e.dr=class extends cb{constructor(e,t){super(e._vectorTileFeature,e._z,e._x,e._y,e.id),e.state&&(this.state=Object.assign({},e.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=e.source,this.sourceLayer=e.sourceLayer,this.layer=e.layer)}toJSON(){const e=super.toJSON();return e.target=this.target,e.namespace=this.namespace,e}},e.ds=ps,e.dt=Dt,e.du=function(e){return e({pluginStatus:us,pluginURL:hs}),ps.on("pluginStateChange",e),e},e.dv=gl,e.dw=class extends ul{constructor(e){super(e),this.current=vl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let r=0;r<9;r++)if(n[r]!==this.current[r]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},e.dx=Ce,e.dy=function(e,t,n){const r=Hu(n.zoom),i=e.style.map._antialias,o=e.terrain&&e.terrain.exaggeration()>0;return 0===r&&!i&&!o},e.dz=function(e){const t=e.pixelsPerMeter,n=t/ec(1,e.center.lat),r=l(new Float64Array(16));return h(r,r,[e.point.x,e.point.y,0]),d(r,r,[n,n,t]),Float32Array.from(r)},e.e=rt,e.e$=ms,e.e0=ze,e.e1=ph,e.e2=rc,e.e3=xu,e.e4=rf,e.e5=df,e.e6=$d,e.e7=450,e.e8=7,e.e9=sc,e.eA=function(e,t,r,i,o,s,a,l,c,u,h,d,f,p,m,g){var _=new n(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=i,_[4]=o,_[5]=s,_[6]=a,_[7]=l,_[8]=c,_[9]=u,_[10]=h,_[11]=d,_[12]=f,_[13]=p,_[14]=m,_[15]=g,_},e.eB=$l,e.eC=Ma,e.eD=ka,e.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new xe(1/0,1/0),max:new xe(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Md(new xe(0,0),new xe(Lr,Lr),e),r=[];if(t&&!Id(n,this._globalClipBounds))return r;for(const i of this._activeRegions){if(i.hiddenByOverlap)continue;if(!Id(n,i))continue;const t=Rd(i.min,i.max,e);r.push({min:t.min,max:t.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId,order:i.order,clipMask:i.clipMask,clipScope:i.clipScope})}return r}setSources(e){this._setSources(e.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const n of e.cache.getVisibleCoordinates()){const r=e.cache.getTile(n).buckets[e.layer];r&&r.updateFootprints(n.toUnwrapped(),t)}return t},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(e){const t=e.getFootprints();if(0===t.length)return;const n=e.getOrder(),r=e.getClipMask(),i=e.getClipScope();for(const o of t){if(!o.footprint)continue;const e=Md(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint,order:n,clipMask:r,clipScope:i})}this._sourceIds.push(e.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,t)=>e.priority-t.priority||Cd(e.min,t.min)||Cd(e.max,t.max)||e.order-t.order||e.clipMask-t.clipMask||function(e,t){const n=(e,t)=>e+t;return e.length-t.length||e.reduce(n,"").localeCompare(t.reduce(n,""))}(e.clipScope,t.clipScope));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0;for(;!e&&t!==this._activeRegions.length;){const n=this._activeRegions[t],r=this._prevRegions[t];e=n.priority!==r.priority||!Pd(n,r)||n.order!==r.order||n.clipMask!==r.clipMask||!be(n.clipScope,r.clipScope),++t}}if(e){++this._updateTime;for(const t of this._activeRegions)t.order!==Ed&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const n=t[e].priority;for(;e<t.length&&t[e].priority===n;)++e;return e};if(this._sourceIds.length>1){let t=0,n=e(t);for(;t!==n;){let r=t;const i=t;for(;r!==n;){const e=this._activeRegions[r];e.hiddenByOverlap=!1;for(let t=0;t<i;t++){const n=this._activeRegions[t];if(!n.hiddenByOverlap&&e.order===Ed&&Id(e,n)&&(e.hiddenByOverlap=Ld(e.footprint,e.tileId,n.footprint,n.tileId),e.hiddenByOverlap))break}++r}t=n,n=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.eF=Ed,e.eG=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const n=new ra,r=new Ea,i=[],o=e+1+2,s=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,n)=>{let r=e===o-1?e-2:0===e?e:e-1;return r+=n?24575:0,[r,t]};for(let c=0;c<o;++c)n.emplaceBack(...l(c,0,!0));for(let c=0;c<s;++c)for(let e=0;e<o;++e)n.emplaceBack(...l(e,c,(0===e||e===o-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<o;++t)n.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=r.length,s=t[c]+1+2,l=new Ea;for(let n=0;n<s-1;n++){const e=n===s-2,i=e?o*(a-t.length+c-n):o;for(let t=0;t<o-1;t++){const s=n*o+t;0===n||e||0===t||t===o-2?(l.emplaceBack(s+1,s,s+i),l.emplaceBack(s+i,s+i+1,s+1)):(r.emplaceBack(s+1,s,s+i),r.emplaceBack(s+i,s+i+1,s+1))}}const u=tl.simpleSegment(0,e,n.length,r.length-e);for(let t=0;t<l.uint16.length;t+=3)r.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const h=tl.simpleSegment(0,e,n.length,r.length-e);i.push({withoutSkirts:u,withSkirts:h})}return{vertices:n,indices:r,segments:i}}_createGrid(e){const t=this._fillGridMeshWithLods(Bl,jl);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Eu.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Ea;for(let s=0;s<=Bl;s++)t.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const n=new Pa,r=new Pa,i=new Pa,o=new Pa;this._poleSegments=[];for(let s=0,a=0;s<Nl;s++){const e=360/(1<<s);n.emplaceBack(0,-Dl,0,.5,0),r.emplaceBack(0,-Dl,0,.5,1),i.emplaceBack(0,-Dl,0,.5,.5),o.emplaceBack(0,-Dl,0,.5,.5);for(let t=0;t<=Bl;t++){let s=t/Bl,a=0;const l=un(0,e,s),[c,u,h]=Gl(Xu,Zu,l,Dl);n.emplaceBack(c,u,h,s,a),r.emplaceBack(c,u,h,s,1-a);const d=Ee(l);s=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),i.emplaceBack(c,u,h,s,a),o.emplaceBack(c,u,h,s,1-a)}this._poleSegments.push(tl.simpleSegment(a,0,66,64)),a+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,wu,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,wu,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(i,wu,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,wu,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.eH=Td,e.eI=Pe,e.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.eK=Ie,e.eL=ac,e.eM=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.eN=$,e.eO=Hl,e.eP=O,e.eQ=E,e.eR=function(e){let[t,n,r]=e;const i=Math.hypot(t,n,r),o=Math.atan2(t,r),s=.5*Math.PI-Math.acos(-n/i);return new ql(Te(o),Te(s))},e.eS=Z,e.eT=Ap,e.eU=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==Ke){const t=e.navigator?e.navigator.userAgent:null;Ke=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ke}(e)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},e.eV=function(e,t){_t=e,yt=t},e.eW=Wu,e.eX=$u,e.eY=function(e){const t=[0,0,0],n=l(new Float64Array(16));return u(n,e.pixelMatrix,e.globeMatrix),B(t,t,n),new xe(t[0],t[1])},e.eZ=function(){const e=Lf;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Mf),Lf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.e_=function(){Nf().acquire(Mf)},e.ea=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.eb=My,e.ec=ta,e.ed=za,e.ee=256,e.ef=ju,e.eg=ha,e.eh=p,e.ei=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.ej=Pa,e.ek=Ia,e.el=ho,e.em=function(e,t,n,r,i){return ke((e-t)/(n-t)*(i-r)+r,r,i)},e.en=ee,e.eo=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,f=c*o-s*l,p=n*h+r*d+i*f;return p?(e[0]=h*(p=1/p),e[1]=(-u*r+i*c)*p,e[2]=(a*r-i*s)*p,e[3]=d*p,e[4]=(u*n-i*l)*p,e[5]=(-a*n+i*o)*p,e[6]=f*p,e[7]=(-c*n+r*l)*p,e[8]=(s*n-r*o)*p,e):null},e.ep=2,e.eq=L,e.er=kp,e.es=[1,1,1],e.et=class{constructor(e,t,n,r){this.context=e,this.format=r,this.size=n,this.texture=e.gl.createTexture();const[i,o,s]=this.size,{gl:a}=e;a.bindTexture(a.TEXTURE_3D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(!1),a.texImage3D(a.TEXTURE_3D,0,this.format,i,o,s,0,hp(this.format),dp(this.format),t.data)}bind(e,t){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_3D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}},e.eu=Zy,e.ev=q,e.ew=function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e[3]=a+r*(n[3]-a),e},e.ex=Op,e.ey=va,e.ez=Ra,e.f=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t))))},e.f0=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(us===ls.deferred||us===ls.loading||us===ls.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");hs=ft.resolveURL(e),us=ls.deferred,cs=t,fs(),n||gs()},e.f1=function(e){Uf=ft.resolveURL(e),Gf||(Gf=new Of(Nf(),new en)),Gf.broadcast("setMeshoptUrl",Uf)},e.f2=Xf,e.f3=function(e){Bf=ft.resolveURL(e),Gf||(Gf=new Of(Nf(),new en)),Gf.broadcast("setDracoUrl",Bf)},e.f4=qf,e.f5=kf,e.f6=function(e){const t=wt();if(!t)return;const n=t.delete(gt);e&&n.then(()=>e()).catch(e)},e.f7=Rf,e.f8=qo,e.f9=hh,e.fa=e_,e.fb=ab,e.fc=ub,e.fd=mm,e.fe=Ac,e.ff="hd_road_elevation",e.fg=Hc,e.fh=Be,e.fi=Yh,e.fj=Zg,e.fk=qg,e.fl=function(e,t,n,r,i,o,s){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,u=arguments.length>10?arguments[10]:void 0;e.createArrays(),e.tilePixelRatio=Lr/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const h=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,f={};f.scaleFactor=a,f.textSizeScaleRange=h.get("text-size-scale-range"),f.iconSizeScaleRange=h.get("icon-size-scale-range");const[p,m]=f.textSizeScaleRange,[g,_]=f.iconSizeScaleRange;f.textScaleFactor=ke(f.scaleFactor,p,m),f.iconScaleFactor=ke(f.scaleFactor,g,_);const y=d["text-size"],v=d["icon-size"];if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;f.compositeTextSizes=[y.possiblyEvaluate(new ys(t,{worldview:u}),o),y.possiblyEvaluate(new ys(n,{worldview:u}),o)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;f.compositeIconSizes=[v.possiblyEvaluate(new ys(t,{worldview:u}),o),v.possiblyEvaluate(new ys(n,{worldview:u}),o)]}f.layoutTextSize=y.possiblyEvaluate(new ys(s+1,{worldview:u}),o),f.layoutIconSize=v.possiblyEvaluate(new ys(s+1,{worldview:u}),o),f.textMaxSize=y.possiblyEvaluate(new ys(18,{worldview:u}),o);const x=h.get("symbol-placement"),b="map"===h.get("text-rotation-alignment")&&"point"!==x,w=h.get("text-size");let S=!1;const E=[];for(const T of e.features){const s=h.get("text-font").evaluate(T,{},o).join(","),a=w.evaluate(T,{},o)*f.textScaleFactor,p=f.layoutTextSize.evaluate(T,{},o)*f.textScaleFactor,m=f.layoutIconSize.evaluate(T,{},o)*f.iconScaleFactor,g={horizontal:{},vertical:void 0},_=T.text;let y,v=[0,0];if(_){const r=_.toString(),c=h.get("text-letter-spacing").evaluate(T,{},o)*Hm,u=h.get("text-line-height").evaluate(T,{},o)*Hm,d=es(r)?c:0,f=h.get("text-anchor").evaluate(T,{},o),m=h.get("text-variable-anchor");if(!m){const e=h.get("text-radial-offset").evaluate(T,{},o);if(e)v=__(f,[e*Hm,m_]);else{const e=h.get("text-offset").evaluate(T,{},o);v=[e[0]*Hm,e[1]*Hm]}}let y=b?"center":h.get("text-justify").evaluate(T,{},o);const w="point"===x,S=w?h.get("text-max-width").evaluate(T,{},o)*Hm:1/0,E=o=>{e.allowVerticalPlacement&&Qo(r)&&(g.vertical=yg(_,t,n,i,s,S,u,f,o,d,v,mg.vertical,!0,p,a,l))};if(!b&&m){const e="auto"===y?m.map(e=>T_(e)):[y];let r=!1;for(let o=0;o<e.length;o++){const c=e[o];if(!g.horizontal[c])if(r)g.horizontal[c]=g.horizontal[0];else{const e=yg(_,t,n,i,s,S,u,"center",c,d,v,mg.horizontal,!1,p,a,l);e&&(g.horizontal[c]=e,r=1===e.positionedLines.length)}}E("left")}else{if("auto"===y&&(y=T_(f)),w||h.get("text-writing-mode").indexOf("horizontal")>=0||!Qo(r)){const e=yg(_,t,n,i,s,S,u,f,y,d,v,mg.horizontal,!1,p,a,l);e&&(g.horizontal[y]=e)}E(w?"left":y)}}let A,C,P,I,k,M,R=!1;const O=h.get("icon-text-fit").evaluate(T,{},o);if(T.icon&&T.icon.hasPrimary()){const t=x_(T.icon,e.iconSizeData,d["icon-size"],o,e.zoom,T,l,f.iconScaleFactor,u);A=t.iconPrimary,P=t.iconSecondary;const n=A.toString();if(C=r.get(n),C&&(k=h.get("icon-offset").evaluate(T,{},o),M=h.get("icon-anchor").evaluate(T,{},o),y=Ig(i.get(n),P?i.get(P.toString()):void 0,k,M),R=C.sdf,void 0===e.sdfIcons?e.sdfIcons=C.sdf:e.sdfIcons!==C.sdf&&He("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(C.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0)),P){const e=P.toString();I=r.get(e)}}S=S||!(!T.icon||!T.icon.hasSecondary());const L=M_(g.horizontal)||g.vertical;e.iconsInText||(e.iconsInText=!!L&&L.iconsInText);const D=p*f.textScaleFactor/Hm,{defaultShapedIcon:N,verticallyShapedIcon:z}=A_(e,y,h,T,o,g,D,k,O);"none"!==O&&y&&(Mg(y)||Rg(y))&&(y_(0,C,A,y,N,O,c,r,i),y_(0,I,P,y,N,O,c,r,i),z&&(y_(0,C,A,y,z,O,c,r,i),y_(0,I,P,y,z,O,c,r,i))),y=N,E.push({feature:T,shapedTextOrientations:g,shapedText:L,shapedIcon:y,iconPrimary:A,iconSecondary:P,iconOffset:k,iconAnchor:M,verticallyShapedIcon:z,layoutTextSize:p,layoutIconSize:m,textOffset:v,isSDFIcon:R,iconTextFit:O})}return{featureData:E,sizes:f,hasAnySecondaryIcon:S,textAlongLine:b,symbolPlacement:x}},e.fm=Kg,e.fn=function(e,t,n,r,i,o,s,a,l,c){const{featureData:u,hasAnySecondaryIcon:h,sizes:d,textAlongLine:f,symbolPlacement:p}=t;for(const m of u){const{shapedIcon:t,verticallyShapedIcon:n,feature:o,shapedTextOrientations:u,shapedText:g,layoutTextSize:_,textOffset:y,isSDFIcon:v,iconPrimary:x,iconSecondary:b,iconTextFit:w,iconOffset:S}=m;w_(t,c.iconPositions,x,b),w_(n,c.iconPositions,x,b),S_(u,c.iconPositions),b_(x,b,c.iconPositions),(g||t)&&C_(e,o,u,t,n,l,d,_,0,y,v,r,i,s,a,h,w,S,f,p)}n&&e.generateCollisionDebugBuffers(o,e.collisionBoxArray,d.textScaleFactor)},e.fo=Ec,e.fp=px,e.fq=vc,e.fr=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==ip){const n=new Uint32Array(e,0,7),[,,r,i,o,s]=n;t=n.byteLength+i+o+s+o,(r!==e.byteLength||t>=e.byteLength)&&He("Invalid b3dm header information.")}return up(e,t)},e.fs=function(e,t){const n=qp(e);for(const r of n){for(const e of r.meshes)Xp(e);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(Kp(r.lights,t)))}return n},e.ft=nv,e.fu=Xe,e.fv=If,e.fw=_s,e.fx=ls,e.fy=function(e){St(),null!=xt&&xt.then(t=>{t.keys().then(n=>{for(let r=0;r<n.length-e;r++)t.delete(n[r]).catch(e=>He(e.message))}).catch(e=>He(e.message))}).catch(e=>He(e.message))},e.g=function(e,t){return Dt(Le(e,{method:"GET"}),t)},e.h=Le,e.i=function(e){return rt.API_STYLE_REGEX.test(e)&&!ot(e)},e.j=function(e){return 0===e.indexOf("mapbox:")},e.k=it,e.l=Tt,e.m=function(e){return decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},e.n=function(e,t){return Dt(Le(e,{type:"json"}),t)},e.o=Ut,e.p=function(e,t){return Dt(Le(e,{method:"POST"}),t)},e.q=ft,e.r=dh,e.s=function(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}},e.t=dt,e.u=function(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()},e.v=function(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.w=He,e.x=function(){return Df||(Df=new Rf),Df},e.y=nx,e.z=Yt}),r(["./shared"],function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function n(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const r of e)t+=`${n(r)},`;return`${t}]`}let t="{";for(const r of Object.keys(e).sort())t+=`${r}:${n(e[r])},`;return`${t}}`}function r(t){let r="";for(const i of e.bu)r+=`/${n(t[i])}`;return r}class i{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,o){this._options=o;for(const n of t)this._layerConfigs[n.id]=n,(this._layers[n.id]=e.dn(n,this.scope,null,this._options)).compileFilter(o),this.keyCache[n.id]&&delete this.keyCache[n.id];for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const s=function(e,t){const i={};for(let s=0;s<e.length;s++){const o=e[s];let a=t&&t[o.id];a||("symbol"===o.type?a=o.id:(a=r(o),"line"===o.type&&o.paint&&function e(t){return"string"==typeof t&&"line-progress"===t||(Array.isArray(t)?t.some(e):!(!t||"object"!=typeof t)&&Object.values(t).some(e))}(o.paint["line-width"])&&(a+=`/${n(o.paint["line-width"])}`))),t&&(t[o.id]=a);let l=i[a];l||(l=i[a]=[]),l.push(o)}const o=[];for(const n in i)o.push(i[n]);return o}(Object.values(this._layerConfigs),this.keyCache);for(const e of s){const t=e.map(e=>this._layers[e.id]),n=t[0];if("none"===n.visibility)continue;const r=n.source||"";let i=this.familiesBySource[r];i||(i=this.familiesBySource[r]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=i[o];s||(s=i[o]=[]),s.push(t)}}}const o=1*e.fa;class s{constructor(t){const n={},r=[];for(const e in t){const i=t[e],s=n[e]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?o:1,a={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};r.push(a),s[e]=a}}const{w:i,h:s}=e.H(r),a=new e.f9({width:i||1,height:s||1});for(const l in t){const r=t[l];for(const t in r.glyphs){const i=r.glyphs[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const s=n[l][t],c=i.metrics.localGlyph?o:1;e.f9.copy(i.bitmap,a,{x:0,y:0},{x:s.x+c,y:s.y+c},i.bitmap)}}this.image=a,this.positions=n}}e.f8(s,"GlyphAtlas");class a{constructor(t){this.tileID=new e.aM(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.lut=t.lut,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.request&&t.request.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.aW(t.tileID.canonical,t.projection),this.projection=t.projection,this.worldview=t.worldview,this.localizableLayerIds=t.localizableLayerIds,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster,this.tessellationStep=t.tessellationStep,this.scaleFactor=t.scaleFactor,this.worldview=t.worldview}parse(t,n,r,i,o,a){this.status="parsing",this.data=t,this.collisionBoxArray=new e.b0;const c=new e.fb(Object.keys(t.layers).sort()),u=new e.fc(this.tileID,this.promoteId);u.bucketLayerIDs=[];const h={},d=new e.fd(256,256),f={featureIndex:u,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:d,availableImages:r,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},p=[],m=n.familiesBySource[this.source];for(const s in m){const n=t.layers[s];if(!n)continue;let o=!1,a=!1,d=!1;for(const e of m[s])"symbol"===e[0].type?o=!0:a=!0,e[0].is3D()&&"model"!==e[0].type&&(d=!0);if(this.extraShadowCaster&&!d)continue;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!a)continue;1===n.version&&e.w(`Vector tile source "${this.source}" layer "${s}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const g=c.encode(s),_=[];let y=!1;for(let t=0,r=0;t<n.length;t++){const i=n.feature(t),o=u.getId(i,s);if(this.localizableLayerIds&&this.localizableLayerIds.has(s)){const e=i.properties?i.properties.worldview:null;if(this.worldview&&"string"==typeof e)if("all"===e)i.properties.$localized=!0;else{if(!e.split(",").includes(this.worldview))continue;i.properties.$localized=!0,i.properties.worldview=this.worldview}}!y&&i.properties&&i.properties.hasOwnProperty(e.fe)&&(y=!0),_.push({feature:i,id:o,index:r,sourceLayerIndex:g}),r++}y&&!f.elevationFeatures&&t.layers.hasOwnProperty(e.ff)&&(f.elevationFeatures=e.fg.parseFrom(t.layers[e.ff],this.canonical));for(const t of m[s]){const n=t[0];if(this.extraShadowCaster&&(!n.is3D()||"model"===n.type))continue;if(void 0!==this.isSymbolTile&&"symbol"===n.type!==this.isSymbolTile)continue;if(n.minzoom&&this.zoom<Math.floor(n.minzoom))continue;if(n.maxzoom&&this.zoom>=n.maxzoom)continue;if("none"===n.visibility)continue;l(t,this.zoom,f.brightness,r,this.worldview);const o=h[n.id]=n.createBucket({index:u.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:g,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:i,worldview:this.worldview});u.bucketLayerIDs.push(t.map(t=>e.C(t.id,t.scope)));let s=o.prepare?o.prepare():null;null!=s?(s=s.then(()=>o.populate(_,f,this.tileID.canonical,this.tileTransform)),p.push(s)):o.populate(_,f,this.tileID.canonical,this.tileTransform)}}const g=()=>{let n,i,p,m,g,_;d.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},v=()=>{if(n)return this.status="done",a(n);if(this.extraShadowCaster)this.status="done",a(null,{buckets:Object.values(h).filter(e=>!e.isEmpty()),featureIndex:u,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:f.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(i&&p&&m){const t=new s(i),n=new Map;for(const[r,i]of p.entries()){const{imagePosition:t}=e.fj(r,i,e.fk);n.set(r,t)}const a={};for(const o in h){const s=h[o];s instanceof e.b1&&(l(s.layers,this.zoom,f.brightness,r,this.worldview),a[o]=e.fl(s,i,t.positions,p,n,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,g,this.worldview))}const c={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(o,p,g,()=>{c.iconsPending=!1,x(a,t,c)}),this.rasterizeIfNeeded(o,m,_,()=>{c.patternsPending=!1,x(a,t,c)})}},x=(t,n,i,o)=>{if(i.iconsPending||i.patternsPending)return;const s=new e.fm(p,m,this.lut);for(const a in h){const n=h[a];if(a in t)e.fn(n,t[a],this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,p,s);else if(n.hasPattern&&(n instanceof e.b7||n instanceof e.b8||n instanceof e.e4)){l(n.layers,this.zoom,f.brightness,r,this.worldview);const e=Object.fromEntries(s.patternPositions);n.addFeatures(f,this.tileID.canonical,e,r,this.tileTransform,this.brightness)}}this.status="done",a(null,{buckets:Object.values(h).filter(e=>!e.isEmpty()),featureIndex:u,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:n.image,lineAtlas:d,imageAtlas:s,brightness:f.brightness})};if(!this.extraShadowCaster){const t=e.fh(f.glyphDependencies,e=>Object.keys(e).map(Number));Object.keys(t).length?o.send("getGlyphs",{uid:this.uid,stacks:t},(e,t)=>{n||(n=e,i=t,v())},void 0,!1,y):i={};const r=Array.from(f.iconDependencies.keys()).map(t=>e.I.parse(t));r.length?o.send("getImages",{images:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(e,t)=>{n||(n=e,p=new Map,g=this.updateImageMapAndGetImageTaskQueue(p,t,f.iconDependencies),v())},void 0,!1,y):(p=new Map,g=new Map);const s=Array.from(f.patternDependencies.keys()).map(t=>e.I.parse(t));s.length?o.send("getImages",{images:s,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(e,t)=>{n||(n=e,m=new Map,_=this.updateImageMapAndGetImageTaskQueue(m,t,f.patternDependencies),v())},void 0,!1,y):(m=new Map,_=new Map)}if(f.elevationFeatures&&f.elevationFeatures.length>0){const n=[];for(const t of Object.values(h))if(t instanceof e.b8){const e=t.getUnevaluatedPortalGraph();e&&n.push(e)}const r=e.fi.evaluate(n);for(const i of Object.values(h))if(i instanceof e.b8){const e=t.layers[c.decode(i.sourceLayerIndex)];i.setEvaluatedPortalGraph(r,e,this.tileID.canonical,f.availableImages,f.brightness)}}v()};p.length>0?Promise.allSettled(p).then(g).catch(a):g()}rasterizeIfNeeded(e,t,n,r){Array.from(t.values()).some(e=>e.usvg)?this.rasterize(e,t,n,r):r()}updateImageMapAndGetImageTaskQueue(e,t,n){const r=new Map;for(const i of t.keys()){const o=n.get(i)||[];for(const n of o){const i=n.toString(),o=t.get(n.id.toString());o.usvg?r.has(i)||(r.set(i,n),e.set(i,Object.assign({},o))):e.set(i,o)}}return r}rasterize(e,t,n,r){this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,tasks:n},(e,n)=>{if(!e)for(const[r,i]of n.entries()){const e=Object.assign(t.get(r),{data:i});t.set(r,e)}r()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function l(t,n,r,i,o){const s=new e.aa(n,{brightness:r,worldview:o});for(const e of t)e.recalculate(s,i)}class c extends e.E{constructor(t,n,r,i,o,s,a){super(),this.actor=t,this.layerIndex=n,this.availableImages=r,this.availableModels=i,this.loadVectorData=s||e.aJ,this.loading={},this.loaded={},this.deduped=new e.aI(t.scheduler),this.isSpriteLoaded=o,this.scheduler=t.scheduler,this.brightness=a}loadTile(n,r){const i=n.uid,o=n&&n.request,s=o&&o.collectResourceTiming,l=this.loading[i]=new a(n);l.abort=this.loadVectorData(n,(a,c)=>{const u=!this.loading[i];if(delete this.loading[i],l.cancelRasterize(),u||a||!c)return l.status="done",u||(this.loaded[i]=l),r(a);const h=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.fo(new e.bq(h));const f=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(n,i)=>{if(n||!i)return r(n);const a={};if(s){const e=t(o);e.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(e)))}r(null,e.h({rawTileData:h.slice(0)},i,d,a))})};this.isSpriteLoaded?f():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(f,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):f()}),this.loaded=this.loaded||{},this.loaded[i]=l})}reloadTile(t,n){const r=this.loaded,i=t.uid;if(r&&r[i]){const o=r[i];o.scaleFactor=t.scaleFactor,o.showCollisionBoxes=t.showCollisionBoxes,o.projection=t.projection,o.brightness=t.brightness,o.tileTransform=e.aW(t.tileID.canonical,t.projection),o.extraShadowCaster=t.extraShadowCaster,o.lut=t.lut,o.worldview=t.worldview;const s=(e,t)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,r)),n(e,t)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,s):s())}else n(null,void 0)}abortTile(e,t){const n=e.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()}}class u{loadTile(t,n){const{uid:r,encoding:i,rawImageData:o,padding:s}=t,a=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,s):o;n(null,new e.fp(r,a,i,s<1))}reloadTile(e,t){t(null,null)}abortTile(e,t){t()}removeTile(e,t){t()}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}e.bp.setPbf(e.bq);class h{constructor(t){this._mrt=new e.bp(t.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=t.uid,this.tileID=t.tileID,this.source=t.source}parse(t,n){const r=this._mrt;this.status="parsing",this._entireBuffer=t;try{r.parseHeader(t),this._isHeaderLoaded=!0;const i=[];for(const n in r.layers){const o=r.getLayer(n),s=o.getDataRange(o.getBandList()),a=r.createDecodingTask(s),l=t.slice(s.firstByte,s.lastByte+1),c=e.bp.performDecoding(l,a).then(e=>a.complete(null,e)).catch(e=>a.complete(e,null));i.push(c)}Promise.allSettled(i).then(()=>n(null,r)).catch(e=>n(e))}catch(e){n(e)}}}class d{constructor(e){this.actor=e,this.loading={},this.loaded={}}loadTile(t,n){const r=t.uid,i=t.request,o=this.loading[r]=new h(t),{cancel:s}=e.br(i,(e,t,i,s)=>{const a=!this.loading[r];if(delete this.loading[r],a||e||!t)return o.status="done",a||(this.loaded[r]=o),n(e);o.parse(t,(e,t)=>{if(e||!t)return n(e);n(null,t,i,s)}),this.loaded[r]=o});o.abort=s}reloadTile(e,t){t(null,void 0)}abortTile(e,t){const n=e.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=e.uid;this.loaded[n]&&delete this.loaded[n],t()}decodeRasterArray(t,n){e.bp.performDecoding(t.buffer,t.task).then(e=>n(null,e)).catch(e=>n(e))}}const f=e.fq.prototype.toGeoJSON;class p{constructor(t){this._feature=t,this.extent=e.aj,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const r=[];for(const t of n)r.push(new e.P(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,n){return f.call(this,e,t,n)}}class m{constructor(t,n){this.name=t,this.extent=e.aj,this.length=n.length,this._jsonFeatures=n}feature(e){return new p(this._jsonFeatures[e])}}class g{constructor(t){this.layers={},this.extent=e.aj;for(const e of Object.keys(t))this.layers[e]=new m(e,t[e])}}const _=64/4096,y=128;class v{constructor(){this.features=new Map}clear(){this.features.clear()}load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;for(const n of e){const e=n.id;if(null==e)continue;let r=this.features.get(e);r&&this.updateCache(r,t),n.geometry?(r=b(n),this.updateCache(r,t),this.features.set(e,r)):this.features.delete(e),this.updateCache(r,t)}}updateCache(e,t){for(const{canonical:n,uid:r}of Object.values(t)){const{z:i,x:o,y:s}=n;x(e,Math.pow(2,i),o,s)&&delete t[r]}}getTile(e,t,n){const r=Math.pow(2,e),i=[];for(const o of this.features.values())x(o,r,t,n)&&i.push(T(o,r,t,n));return{features:i}}getFeatures(){return[...this.features.values()]}}function x(e,t,n,r){let{minX:i,minY:o,maxX:s,maxY:a}=e;return i<(n+1+_)/t&&o<(r+1+_)/t&&s>(n-_)/t&&a>(r-_)/t}function b(e){const{id:t,geometry:n,properties:r}=e;if(!n)return;if("GeometryCollection"===n.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:i,coordinates:o}=n,s={id:t,type:1,geometry:[],tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},a=s.geometry;if("Point"===i)w(o,a,s);else if("MultiPoint"===i)for(const l of o)w(l,a,s);else if("LineString"===i)s.type=2,S(o,a,s);else if("MultiLineString"===i)s.type=2,E(o,a,s);else if("Polygon"===i)s.type=3,E(o,a,s,!0);else{if("MultiPolygon"!==i)throw new Error("Input data is not a valid GeoJSON object.");s.type=3;for(const e of o)E(e,a,s,!0)}return s}function w(t,n,r){let[i,o]=t;const s=e.aD(i);let a=e.aH(o);a=a<0?0:a>1?1:a,n.push(s,a),r.minX=Math.min(r.minX,s),r.minY=Math.min(r.minY,a),r.maxX=Math.max(r.maxX,s),r.maxY=Math.max(r.maxY,a)}function S(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=[];for(const s of e)w(s,o,n);t.push(o),r&&function(e,t){let n=0;for(let r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(let r=0,i=e.length;r<i/2;r+=2){const t=e[r],n=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=t,e[i-1-r]=n}}(o,i)}function E(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let i=0;i<e.length;i++)S(e[i],t,n,r,0===i)}function T(t,n,r,i){const{id:o,type:s,geometry:a,tags:l}=t,c=[];if(1===s)!function(t,n,r,i,o){for(let s=0;s<t.length;s+=2){const a=Math.round(e.aj*(t[s+0]*n-r)),l=Math.round(e.aj*(t[s+1]*n-i));o.push([a,l])}}(a,n,r,i,c);else for(const e of a)A(e,n,r,i,c);return{id:o,type:s,geometry:c,tags:l}}function A(t,n,r,i,o){const s=-y,a=e.aj+y;let l;for(let c=0;c<t.length-2;c+=2){let u=Math.round(e.aj*(t[c+0]*n-r)),h=Math.round(e.aj*(t[c+1]*n-i)),d=Math.round(e.aj*(t[c+2]*n-r)),f=Math.round(e.aj*(t[c+3]*n-i));const p=d-u,m=f-h;u<s&&d<s||(u<s?(h+=Math.round(m*((s-u)/p)),u=s):d<s&&(f=h+Math.round(m*((s-u)/p)),d=s),h<s&&f<s||(h<s?(u+=Math.round(p*((s-h)/m)),h=s):f<s&&(d=u+Math.round(p*((s-h)/m)),f=s),u>=a&&d>=a||(u>=a?(h+=Math.round(m*((a-u)/p)),u=a):d>=a&&(f=h+Math.round(m*((a-u)/p)),d=a),h>=a&&f>=a||(h>=a?(u+=Math.round(p*((a-h)/m)),h=a):f>=a&&(d=u+Math.round(p*((a-h)/m)),f=a),l&&u===l[l.length-1][0]&&h===l[l.length-1][1]||(l=[[u,h]],o.push(l)),l.push([d,f])))))}}function C(t,n){let{name:r,features:i}=t;n.writeStringField(1,r),n.writeVarintField(5,e.aj);const o=new Map,s=new Map,a={keys:o,values:s,feature:null};for(const e of i)a.feature=e,n.writeMessage(2,P,a);for(const e of o.keys())n.writeStringField(3,e);for(const e of s.keys())n.writeMessage(4,O,e)}function P(e,t){const n=e.feature;void 0===n.id||isNaN(+n.id)||t.writeVarintField(1,+n.id),n.tags&&t.writeMessage(2,I,e),t.writeVarintField(3,n.type),t.writeMessage(4,R,n)}function I(e,t){let{keys:n,values:r,feature:i}=e;for(const o of Object.keys(i.tags)){let e=i.tags[o];if(null===e)continue;let s=n.get(o);void 0===s&&(s=n.size,n.set(o,s)),t.writeVarint(s);const a=typeof e;"string"!==a&&"boolean"!==a&&"number"!==a&&(e=JSON.stringify(e));let l=r.get(e);void 0===l&&(l=r.size,r.set(e,l)),t.writeVarint(l)}}function k(e,t){return(t<<3)+(7&e)}function M(e){return e<<1^e>>31}function R(e,t){const{geometry:n,type:r}=e;let i=0,o=0;if(1===r){t.writeVarint(k(1,n.length));for(const e of n){const n=e[0]-i,r=e[1]-o;t.writeVarint(M(n)),t.writeVarint(M(r)),i+=n,o+=r}}else for(const s of n){t.writeVarint(k(1,1));const e=s.length-(3===r?1:0);for(let n=0;n<e;n++){1===n&&t.writeVarint(k(2,e-1));const r=s[n][0]-i,a=s[n][1]-o;t.writeVarint(M(r)),t.writeVarint(M(a)),i+=r,o+=a}3===r&&t.writeVarint(k(7,1))}}function O(e,t){const n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}const L={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},D=Math.fround||(N=new Float32Array(1),e=>(N[0]=+e,N[0]));var N;const z=3,F=5,B=6;class j{constructor(e){this.options=Object.assign(Object.create(L),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:r}=this.options;t&&console.time("total time");const i=`prepare ${e.length} points`;t&&console.time(i),this.points=e;const o=[];for(let a=0;a<e.length;a++){const t=e[a];if(!t.geometry)continue;const[n,r]=t.geometry.coordinates,i=D(G(n)),s=D(H(r));o.push(i,s,1/0,a,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);t&&console.timeEnd(i);for(let a=r;a>=n;a--){const e=+Date.now();s=this.trees[a]=this._createTree(this._cluster(s,a)),t&&console.log("z%d: %d clusters in %dms",a,s.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){const e=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(G(n),H(o),G(i),H(r)),l=s.data,c=[];for(const u of a){const e=this.stride*u;c.push(l[e+F]>1?U(l,e,this.clusterProps):this.points[l[e+z]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);const o=i.data;if(t*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=i.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const c of a){const t=c*this.stride;o[t+4]===e&&l.push(o[t+F]>1?U(o,t,this.clusterProps):this.points[o[t+z]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,n){const r=[];return this._appendLeaves(r,e,t=t||10,n=n||0,0),r}getTile(e,t,n){const r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/i,c=(n+1+a)/i,u={features:[]};return this._addTileFeatures(r.range((t-a)/i,l,(t+1+a)/i,c),r.data,t,n,i,u),0===t&&this._addTileFeatures(r.range(1-a/i,l,1,c),r.data,i,n,i,u),t===i-1&&this._addTileFeatures(r.range(0,l,a/i,c),r.data,-1,n,i,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,r,i){const o=this.getChildren(t);for(const s of o){const t=s.properties;if(t&&t.cluster?i+t.point_count<=r?i+=t.point_count:i=this._appendLeaves(e,t.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i}_createTree(t){const n=new e.c0(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,r,i,o){for(const s of e){const e=s*this.stride,a=t[e+F]>1;let l,c,u;if(a)l=V(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+z]];l=n.properties;const[r,i]=n.geometry.coordinates;c=G(r),u=H(i)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*i-n)),Math.round(this.options.extent*(u*i-r))]],tags:l};let d;d=a||this.options.generateId?t[e+z]:this.points[t[e+z]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:r,reduce:i,minPoints:o}=this.options,s=n/(r*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let u=0;u<a.length;u+=c){if(a[u+2]<=t)continue;a[u+2]=t;const n=a[u],r=a[u+1],h=e.within(a[u],a[u+1],s),d=a[u+F];let f=d;for(const e of h){const n=e*c;a[n+2]>t&&(f+=a[n+F])}if(f>d&&f>=o){let e,o=n*d,s=r*d,p=-1;const m=(u/c<<5)+(t+1)+this.points.length;for(const n of h){const r=n*c;if(a[r+2]<=t)continue;a[r+2]=t;const l=a[r+F];o+=a[r]*l,s+=a[r+1]*l,a[r+4]=m,i&&(e||(e=this._map(a,u,!0),p=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(a,r)))}a[u+4]=m,l.push(o/f,s/f,1/0,m,-1,f),i&&l.push(p)}else{for(let e=0;e<c;e++)l.push(a[u+e]);if(f>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+F]>1){const r=this.clusterProps[e[t+B]];return n?Object.assign({},r):r}const r=this.points[e[t+z]].properties,i=this.options.map(r);return n&&i===r?Object.assign({},i):i}}function U(e,t,n){return{type:"Feature",id:e[t+z],properties:V(e,t,n),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),$(e[t+1])]}};var r}function V(e,t,n){const r=e[t+F],i=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=e[t+B],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+z],point_count:r,point_count_abbreviated:i})}function G(e){return e/360+.5}function H(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function $(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function W(e,t,n,r){let i=r;const o=t+(n-t>>1);let s,a=n-t;const l=e[t],c=e[t+1],u=e[n],h=e[n+1];for(let d=t+3;d<n;d+=3){const t=q(e[d],e[d+1],l,c,u,h);if(t>i)s=d,i=t;else if(t===i){const e=Math.abs(d-o);e<a&&(s=d,a=e)}}i>r&&(s-t>3&&W(e,t,s,r),e[s+2]=i,n-s>3&&W(e,s,n,r))}function q(e,t,n,r,i,o){let s=i-n,a=o-r;if(0!==s||0!==a){const l=((e-n)*s+(t-r)*a)/(s*s+a*a);l>1?(n=i,r=o):l>0&&(n+=s*l,r+=a*l)}return s=e-n,a=t-r,s*s+a*a}function X(e,t,n,r){const i={id:e??null,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)Z(i,n);else if("Polygon"===t)Z(i,n[0]);else if("MultiLineString"===t)for(const o of n)Z(i,o);else if("MultiPolygon"===t)for(const o of n)Z(i,o[0]);return i}function Z(e,t){for(let n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function K(e,t,n,r){if(!t.geometry)return;const i=t.geometry.coordinates;if(i&&0===i.length)return;const o=t.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let a=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=r||0),"Point"===o)Y(i,a);else if("MultiPoint"===o)for(const c of i)Y(c,a);else if("LineString"===o)J(i,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(const n of i)a=[],J(n,a,s,!1),e.push(X(l,"LineString",a,t.properties));return}Q(i,a,s,!1)}else if("Polygon"===o)Q(i,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const i of t.geometry.geometries)K(e,{id:l,geometry:i,properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of i){const t=[];Q(e,t,s,!0),a.push(t)}}e.push(X(l,o,a,t.properties))}function Y(e,t){t.push(ee(e[0]),te(e[1]),0)}function J(e,t,n,r){let i,o,s=0;for(let l=0;l<e.length;l++){const n=ee(e[l][0]),a=te(e[l][1]);t.push(n,a,0),l>0&&(s+=r?(i*a-n*o)/2:Math.sqrt(Math.pow(n-i,2)+Math.pow(a-o,2))),i=n,o=a}const a=t.length-3;t[2]=1,W(t,0,a,n),t[a+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function Q(e,t,n,r){for(let i=0;i<e.length;i++){const o=[];J(e[i],o,n,r),t.push(o)}}function ee(e){return e/360+.5}function te(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ne(e,t,n,r,i,o,s,a){if(r/=t,o>=(n/=t)&&s<r)return e;if(s<n||o>=r)return null;const l=[];for(const c of e){const e=c.geometry;let t=c.type;const o=0===i?c.minX:c.minY,s=0===i?c.maxX:c.maxY;if(o>=n&&s<r){l.push(c);continue}if(s<n||o>=r)continue;let u=[];if("Point"===t||"MultiPoint"===t)re(e,u,n,r,i);else if("LineString"===t)ie(e,u,n,r,i,!1,a.lineMetrics);else if("MultiLineString"===t)se(e,u,n,r,i,!1);else if("Polygon"===t)se(e,u,n,r,i,!0);else if("MultiPolygon"===t)for(const a of e){const e=[];se(a,e,n,r,i,!0),e.length&&u.push(e)}if(u.length){if(a.lineMetrics&&"LineString"===t){for(const e of u)l.push(X(c.id,t,e,c.tags));continue}"LineString"!==t&&"MultiLineString"!==t||(1===u.length?(t="LineString",u=u[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===u.length?"Point":"MultiPoint"),l.push(X(c.id,t,u,c.tags))}}return l.length?l:null}function re(e,t,n,r,i){for(let o=0;o<e.length;o+=3){const s=e[o+i];s>=n&&s<=r&&ae(t,e[o],e[o+1],e[o+2])}}function ie(e,t,n,r,i,o,s){let a=oe(e);const l=0===i?le:ce;let c,u,h=e.start;for(let g=0;g<e.length-3;g+=3){const d=e[g],f=e[g+1],p=e[g+2],m=e[g+3],_=e[g+4],y=0===i?d:f,v=0===i?m:_;let x=!1;s&&(c=Math.sqrt(Math.pow(d-m,2)+Math.pow(f-_,2))),y<n?v>n&&(u=l(a,d,f,m,_,n),s&&(a.start=h+c*u)):y>r?v<r&&(u=l(a,d,f,m,_,r),s&&(a.start=h+c*u)):ae(a,d,f,p),v<n&&y>=n&&(u=l(a,d,f,m,_,n),x=!0),v>r&&y<=r&&(u=l(a,d,f,m,_,r),x=!0),!o&&x&&(s&&(a.end=h+c*u),t.push(a),a=oe(e)),s&&(h+=c)}let d=e.length-3;const f=e[d],p=e[d+1],m=0===i?f:p;m>=n&&m<=r&&ae(a,f,p,e[d+2]),d=a.length-3,o&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&ae(a,a[0],a[1],a[2]),a.length&&t.push(a)}function oe(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function se(e,t,n,r,i,o){for(const s of e)ie(s,t,n,r,i,o,!1)}function ae(e,t,n,r){e.push(t,n,r)}function le(e,t,n,r,i,o){const s=(o-t)/(r-t);return ae(e,o,n+(i-n)*s,1),s}function ce(e,t,n,r,i,o){const s=(o-n)/(i-n);return ae(e,t+(r-t)*s,o,1),s}function ue(e,t){const n=[];for(let r=0;r<e.length;r++){const i=e[r],o=i.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=he(i.geometry,t);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const e of i.geometry)s.push(he(e,t))}else if("MultiPolygon"===o){s=[];for(const e of i.geometry){const n=[];for(const r of e)n.push(he(r,t));s.push(n)}}n.push(X(i.id,o,s,i.tags))}return n}function he(e,t){const n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(let r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function de(e,t){if(e.transformed)return e;const n=1<<e.z,r=e.x,i=e.y;for(const o of e.features){const e=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let a=0;a<e.length;a+=2)o.geometry.push(fe(e[a],e[a+1],t,n,r,i));else for(let a=0;a<e.length;a++){const s=[];for(let o=0;o<e[a].length;o+=2)s.push(fe(e[a][o],e[a][o+1],t,n,r,i));o.geometry.push(s)}}return e.transformed=!0,e}function fe(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function pe(e,t,n,r,i){const o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const a of e)me(s,a,o,i);return s}function me(e,t,n,r){const i=t.geometry,o=t.type,s=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===o||"MultiPoint"===o)for(let a=0;a<i.length;a+=3)s.push(i[a],i[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)ge(s,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let a=0;a<i.length;a++)ge(s,i[a],e,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(let a=0;a<i.length;a++){const t=i[a];for(let r=0;r<t.length;r++)ge(s,t[r],e,n,!0,0===r)}if(s.length){let n=t.tags||null;if("LineString"===o&&r.lineMetrics){n={};for(const e in t.tags)n[e]=t.tags[e];n.mapbox_clip_start=i.start/i.size,n.mapbox_clip_end=i.end/i.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:n};null!==t.id&&(a.id=t.id),e.features.push(a)}}function ge(e,t,n,r,i,o){const s=r*r;if(r>0&&t.size<(i?s:r))return void(n.numPoints+=t.length/3);const a=[];for(let l=0;l<t.length;l+=3)(0===r||t[l+2]>s)&&(n.numSimplified++,a.push(t[l],t[l+1])),n.numPoints++;i&&function(e,t){let n=0;for(let r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(let r=0,i=e.length;r<i/2;r+=2){const t=e[r],n=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=t,e[i-1-r]=n}}(a,o),e.push(a)}const _e={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ye{constructor(e,t){const n=(t=this.options=function(e,t){for(const n in t)e[n]=t[n];return e}(Object.create(_e),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(e,t){const n=[];if("FeatureCollection"===e.type)for(let r=0;r<e.features.length;r++)K(n,e.features[r],t,r);else K(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){const n=t.buffer/t.extent;let r=e;const i=ne(e,1,-1-n,n,0,-1,2,t),o=ne(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=ne(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=ue(i,1).concat(r)),o&&(r=r.concat(ue(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,n,r,i,o,s){const a=[e,t,n,r],l=this.options,c=l.debug;for(;a.length;){r=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();const u=1<<t,h=ve(t,n,r);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=pe(e,t,n,r,l),this.tileCoords.push({z:t,x:n,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e=`z${t}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==i){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===i)continue;if(null!=i){const e=i-t;if(n!==o>>e||r!==s>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const f=.5*l.buffer/l.extent,p=.5-f,m=.5+f,g=1+f;let _=null,y=null,v=null,x=null,b=ne(e,u,n-f,n+m,0,d.minX,d.maxX,l),w=ne(e,u,n+p,n+g,0,d.minX,d.maxX,l);e=null,b&&(_=ne(b,u,r-f,r+m,1,d.minY,d.maxY,l),y=ne(b,u,r+p,r+g,1,d.minY,d.maxY,l),b=null),w&&(v=ne(w,u,r-f,r+m,1,d.minY,d.maxY,l),x=ne(w,u,r+p,r+g,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(_||[],t+1,2*n,2*r),a.push(y||[],t+1,2*n,2*r+1),a.push(v||[],t+1,2*n+1,2*r),a.push(x||[],t+1,2*n+1,2*r+1)}}getTile(e,t,n){e=+e,t=+t,n=+n;const r=this.options,{extent:i,debug:o}=r;if(e<0||e>24)return null;const s=1<<e,a=ve(e,t=t+s&s-1,n);if(this.tiles[a])return de(this.tiles[a],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);let l,c=e,u=t,h=n;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[ve(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?de(this.tiles[a],i):null):null}}function ve(e,t,n){return 32*((1<<e)*n+t)+e}function xe(t,n){const r=t.tileID.canonical;if(!this._geoJSONIndex)return void n(null,null);const i=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!i)return void n(null,null);const o=e=>e.tags&&"3d_elevation_id"in e.tags&&"source"in e.tags&&"elevation"===e.tags.source,s=i.features.filter(e=>o(e));let a={_geojsonTileLayer:i.features};s.length>0&&(a={_geojsonTileLayer:i.features.filter(e=>!o(e)),hd_road_elevation:s});const l=new g(a),c=function(t){const n=new e.bq;for(const e of Object.keys(t))n.writeMessage(3,C,{name:e,features:t[e]});return n.finish()}(a).buffer;n(null,{vectorTile:l,rawData:c})}class be extends c{constructor(e,t,n,r,i,o,s){super(e,t,n,r,i,xe,s),o&&(this.loadGeoJSON=o),this._dynamicIndex=new v}loadData(n,r){const i=n&&n.request,o=i&&i.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(n,(s,a)=>{if(s||!a)return r(s);if("object"!=typeof a)return r(new Error(`Input data given to '${n.source}' is not a valid GeoJSON object.`));{try{if(n.filter){const t=e.X(n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map(e=>`${e.key}: ${e.message}`).join(", "));a.features=a.features.filter(e=>t.value.evaluate({zoom:0},e))}n.dynamic?("Feature"===a.type&&(a={type:"FeatureCollection",features:[a]}),n.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(a.features,this.loaded),n.cluster&&(a.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=n.cluster?new j(function(t){let{superclusterOptions:n,clusterProperties:r}=t;if(!r||!n)return n;const i={},o={},s={accumulated:null,zoom:0},a={properties:null},l=Object.keys(r);for(const c of l){const[t,n]=r[c],s=e.X(n),a=e.X("string"==typeof t?[t,["accumulated"],["get",c]]:t);i[c]=s.value,o[c]=a.value}return n.map=e=>{a.properties=e;const t={};for(const n of l)t[n]=i[n].evaluate(s,a);return t},n.reduce=(e,t)=>{a.properties=t;for(const n of l)s.accumulated=e[n],e[n]=o[n].evaluate(s,a)},n}(n)).load(a.features):n.dynamic?this._dynamicIndex:function(e,t){return new ye(e,t)}(a,n.geojsonVtOptions)}catch(e){return r(e)}const s={};if(o){const e=t(i);e&&(s.resourceTiming={},s.resourceTiming[n.source]=JSON.parse(JSON.stringify(e)))}r(null,s)}})}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?e.partial?t(null,void 0):super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.n(t.request,n);else{if("string"!=typeof t.data)return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class we{constructor(t,n,r){this.tileID=new e.aM(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=n,this.worldview=r}parse(t,n,r,i){this.status="parsing";const o=new e.aM(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),s=[],a=n.familiesBySource[r.source],l=new e.fc(o,r.promoteId);l.bucketLayerIDs=[],l.is3DTile=!0,e.fr(t).then(t=>{if(!t)return i(new Error("Could not parse tile"));const n=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),u=new e.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const i in a)for(const h of a[i]){const i=h[0];l.bucketLayerIDs.push(h.map(t=>e.C(t.id,t.scope))),i.recalculate(u,[]);const a=e.fs(t,1/e.d4(r.tileID.canonical)),d=new e.ft(h,a,o,n,c,this.brightness,l,this.worldview);n||(d.needsUpload=!0),s.push(d),d.evaluate(i)}this.status="done",i(null,{buckets:s,featureIndex:l,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(e=>i(new Error(e.message)))}}class Se{constructor(e,t,n,r,i,o,s,a){this.actor=e,this.layerIndex=t,this.availableImages=n,this.availableModels=r,this.brightness=s,this.loading={},this.loaded={},this.worldview=a}loadTile(t,n){const r=t.uid,i=this.loading[r]=new we(t,this.brightness,this.worldview);e.br(t.request,(e,o)=>{const s=!this.loading[r];return delete this.loading[r],s||e?(i.status="done",s||(this.loaded[r]=i),n(e)):o&&0!==o.byteLength?void i.parse(o,this.layerIndex,t,(e,t)=>{i.status="done",this.loaded=this.loaded||{},this.loaded[r]=i,e||!t?n(e):n(null,t)}):(i.status="done",this.loaded[r]=i,n())})}reloadTile(e,t){const n=this.loaded,r=e.uid;if(n&&n[r]){const i=n[r];i.projection=e.projection,i.brightness=e.brightness;const o=(n,r)=>{i.reloadCallback&&(delete i.reloadCallback,this.loadTile(e,t)),t(n,r)};"parsing"===i.status?i.reloadCallback=o:"done"===i.status&&this.loadTile(e,t)}}abortTile(e,t){const n=e.uid;this.loading[n]&&delete this.loading[n],t()}removeTile(e,t){const n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()}}class Ee{constructor(t){this.self=t,this.actor=new e.fv(t,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new e.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=e.cj({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:be,"raster-dem":u,"raster-array":d,"batched-model":Se},this.workerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.fw.isParsed())throw new Error("RTL text plugin already registered.");e.fw.setState({pluginStatus:e.fx.parsed,pluginURL:e.fw.getPluginURL()}),e.fw.applyArabicShaping=t.applyArabicShaping,e.fw.processBidirectionalText=t.processBidirectionalText,e.fw.processStyledBidirectionalText=t.processStyledBidirectionalText;for(const e of this.rtlPluginParsingListeners)e(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.availableModels[e],delete this.workerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,n){this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={});const{scope:r,isLoaded:i}=n;if(this.isSpriteLoaded[t][r]=i,this.workerSources[t]&&this.workerSources[t][r])for(const o in this.workerSources[t][r]){const n=this.workerSources[t][r][o];for(const t in n){const r=n[t];r instanceof c&&(r.isSpriteLoaded=i,r.fire(new e.A("isSpriteLoaded")))}}}setImages(e,t,n){this.availableImages[e]||(this.availableImages[e]={});const{scope:r,images:i}=t;if(this.availableImages[e][r]=i,this.workerSources[e]&&this.workerSources[e][r]){for(const t in this.workerSources[e][r]){const n=this.workerSources[e][r][t];for(const e in n)n[e].availableImages=i}n()}else n()}setModels(e,t,n){let{scope:r,models:i}=t;if(this.availableModels[e]||(this.availableModels[e]={}),this.availableModels[e][r]=i,this.workerSources[e]&&this.workerSources[e][r]){for(const t in this.workerSources[e][r]){const n=this.workerSources[e][r][t];for(const e in n)n[e].availableModels=i}n()}else n()}setProjection(t,n){this.projections[t]=e.cj(n)}setBrightness(e,t,n){this.brightness=t,n()}setWorldview(e,t,n){this.worldview=t,n()}setLayers(e,t,n){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),n()}updateLayers(e,t,n){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),n()}loadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,n)}decodeRasterArray(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).decodeRasterArray(t,n)}reloadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,n)}removeSource(e,t,n){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const r=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,r){if(e.fw.isParsed())r(null,!0);else if(e.fw.isParsing())this.rtlPluginParsingListeners.push(r);else try{e.fw.setState(n);const t=e.fw.getPluginURL();!e.fw.isLoaded()||e.fw.isParsed()||e.fw.isParsing()||null==t||(e.fw.setState({pluginStatus:e.fx.parsing,pluginURL:e.fw.getPluginURL()}),this.self.importScripts(t),e.fw.isParsed()?r(null,!0):this.rtlPluginParsingListeners.push(r))}catch(e){r(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let n=this.availableImages[e][t];return n||(n=[]),n}getAvailableModels(e,t){this.availableModels[e]||(this.availableModels[e]={});let n=this.availableModels[e][t];return n||(n={}),n}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let n=this.layerIndexes[e][t];return n||(n=this.layerIndexes[e][t]=new i,n.scope=t),n}getWorkerSource(e,t,n,r){const i=this.workerSources;return i[e]||(i[e]={}),i[e][r]||(i[e][r]={}),i[e][r][t]||(i[e][r][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),i[e][r][t][n]||(i[e][r][t][n]=new this.workerSourceTypes[t]({send:(t,n,r,i,o,s)=>this.actor.send(t,n,r,e,o,s),scheduler:this.actor.scheduler},this.getLayerIndex(e,r),this.getAvailableImages(e,r),this.getAvailableModels(e,r),this.isSpriteLoaded[e][r],void 0,this.brightness,this.worldview)),i[e][r][t][n]}rasterizeImagesWorker(e,t,n){const r=new Map;for(const[i,{image:o,imageVariant:s}]of t.tasks.entries()){const n=this.imageRasterizer.rasterize(s,o,t.scope,e);r.set(i,n)}n(void 0,r)}removeRasterizedImages(e,t,n){this.imageRasterizer.removeImagesFromCacheByIds(t.imageIds,t.scope,e),n()}enforceCacheSizeLimit(t,n){e.fy(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return e.fu(self)&&(self.worker=new Ee(self)),Ee}),r(["./shared"],function(e){var t="3.14.0";const n={create:"create",load:"load",fullLoad:"fullLoad"},r={mark(e){performance.mark(e)},measure(e,t,n){performance.measure(e,t,n)}};function i(t){const n=t.name.split("?")[0];return e.a(n)&&n.includes("mapbox-gl.js")?"javascript":e.a(n)&&n.includes("mapbox-gl.css")?"css":e.b(n)?"fontRange":e.c(n)?"sprite":e.i(n)?"style":e.d(n)?"tilejson":"other"}var o,s={},a=function(){if(o)return s;function e(e){return!t(e)}function t(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===n[r=t&&t.failIfMajorPerformanceCaveat]&&(n[r]=function(t){var n,r=function(t){var n=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,n.getContext("webgl2",r)}(t);if(!r)return!1;try{n=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!n||r.isContextLost())&&(r.shaderSource(n,"void main() {}"),r.compileShader(n),!0===r.getShaderParameter(n,r.COMPILE_STATUS))}(r)),n[r]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var r}o=1,s.supported=e,s.notSupportedReason=t;var n={};return e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},s}();function l(e,t,n){const r=document.createElement(e);return null!=t&&(r.className=t),n&&n.appendChild(r),r}function c(e,t,n){const r=document.createElementNS("http://www.w3.org/2000/svg",e);for(const i of Object.keys(t))r.setAttributeNS(null,i,String(t[i]));return n&&n.appendChild(r),r}const u="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,h=u&&void 0!==u.userSelect?"userSelect":"WebkitUserSelect";let d;function f(){u&&h&&(d=u[h],u[h]="none")}function p(){u&&h&&(u[h]=d)}function m(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",m,!0)}function g(){window.addEventListener("click",m,!0),window.setTimeout(()=>{window.removeEventListener("click",m,!0)},0)}function _(e,t){const n=e.getBoundingClientRect();return x(e,n,t)}function y(e,t){const n=e.getBoundingClientRect(),r=[];for(let i=0;i<t.length;i++)r.push(x(e,n,t[i]));return r}function v(e){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===e.button&&e.ctrlKey?0:e.button}function x(t,n,r){const i=t.offsetWidth===n.width?1:t.offsetWidth/n.width;return new e.P((r.clientX-n.left)*i,(r.clientY-n.top)*i)}const b="01",w="NO_ACCESS_TOKEN";class S{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",b,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(n,r){if(!e.j(n))return n;const i=T(n);return i.params.push(`sdk=js-${t}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||r)}normalizeGlyphsURL(t,n){if(!e.j(t))return t;const r=T(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||n)}normalizeModelURL(t,n){if(!e.j(t))return t;const r=T(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||n)}normalizeSourceURL(t,n,r,i){if(!e.j(t))return t;const o=T(t);return o.path=`/v4/${o.authority}.json`,o.params.push("secure"),r&&o.params.push(`language=${r}`),i&&o.params.push(`worldview=${i}`),this._makeAPIURL(o,this._customAccessToken||n)}normalizeIconsetURL(t,n){const r=T(t);return e.j(t)?(r.path=`/styles/v1${r.path}/iconset.pbf`,this._makeAPIURL(r,this._customAccessToken||n)):A(r)}normalizeSpriteURL(t,n,r,i){const o=T(t);return e.j(t)?(o.path=`/styles/v1${o.path}/sprite${n}${r}`,this._makeAPIURL(o,this._customAccessToken||i)):(o.path+=`${n}${r}`,A(o))}normalizeTileURL(t,n,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!e.j(t))return t;const i=T(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||r&&"raster"!==i.authority&&512===r?"@2x":""}${e.l.supported?".webp":"$1"}`),"raster"===i.authority?i.path=`/${e.e.RASTER_URL_PREFIX}${i.path}`:"rasterarrays"===i.authority?i.path=`/${e.e.RASTERARRAYS_URL_PREFIX}${i.path}`:"3dtiles"===i.authority?i.path=`/${e.e.TILES3D_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${e.e.TILE_URL_VERSION}${i.path}`);const o=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(i.params)||e.e.ACCESS_TOKEN;return e.e.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,o)}canonicalizeTileURL(t,n){const r=T(t);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let i="mapbox://";r.path.match(/^\/raster\/v1\//)?i+=`raster/${r.path.replace(`/${e.e.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?i+=`rasterarrays/${r.path.replace(`/${e.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:i+=`tiles/${r.path.replace(`/${e.e.TILE_URL_VERSION}/`,"")}`;let o=r.params;return n&&(o=o.filter(e=>!e.match(/^access_token=/))),o.length&&(i+=`?${o.join("&")}`),i}canonicalizeTileset(t,n){const r=!!n&&e.j(n),i=[];for(const o of t.tiles||[])e.k(o)?i.push(this.canonicalizeTileURL(o,r)):i.push(o);return i}_makeAPIURL(t,n){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=T(e.e.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==i.path&&(t.path=`${i.path}${t.path}`),!e.e.REQUIRE_ACCESS_TOKEN)return A(t);if(n=n||e.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===n[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(e=>-1===e.indexOf("access_token")),t.params.push(`access_token=${n||""}`),A(t)}}const E=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function T(e){const t=e.match(E);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function A(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const C="mapbox.eventData";function P(t){if(!t)return null;const n=t.split(".");if(!n||3!==n.length)return null;try{return JSON.parse(e.m(n[1]))}catch(e){return null}}class I{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=P(e.e.ACCESS_TOKEN);let r="";return r=n&&n.u?e.f(n.u):e.e.ACCESS_TOKEN||"",t?`${C}.${t}:${r}`:`${C}:${r}`}fetchEventData(){const t=e.s("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{const e=localStorage.getItem(n);e&&(this.eventData=JSON.parse(e));const t=localStorage.getItem(r);t&&(this.anonId=t)}catch(t){e.w("Unable to read from LocalStorage")}}saveEventData(){const t=e.s("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid"),i=this.anonId;if(t&&i)try{localStorage.setItem(r,i),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch(t){e.w("Unable to write to LocalStorage")}}processRequests(e){}postEvent(t,n,r,i){if(!e.e.EVENTS_URL)return;const o=T(e.e.EVENTS_URL);o.params.push(`access_token=${i||e.e.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString()},a=n?e.h(s,n):s,l={url:A(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=e.p(l,e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(i)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const k=new class extends I{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(t,n){e.e.EVENTS_URL&&e.e.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>e.j(t)||e.k(t))&&this.queueRequest(Date.now(),n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=P(e.e.ACCESS_TOKEN),i=r?r.u:e.e.ACCESS_TOKEN;let o=i!==this.eventData.tokenU;e.v(this.anonId)||(this.anonId=e.u(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(s),n=(s-this.eventData.lastSuccess)/864e5;o=o||n>=1||n<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:b,"enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=s,this.eventData.tokenU=i)},n):this.processRequests()}},M=k.postTurnstileEvent.bind(k),R=new class extends I{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,n,r,i){this.skuToken=n,this.errorCb=i,e.e.EVENTS_URL&&(r||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(w)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:i}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),e.v(this.anonId)||(this.anonId=e.u()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:b,skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):r&&(this.success[r]=!0)},n))}remove(){this.errorCb=null}},O=R.postMapLoadEvent.bind(R),L=new class extends I{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let n=this.mapInstanceIdMap.get(t);return n||(n=e.u(),this.mapInstanceIdMap.set(t,n)),n}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(t,n){const{map:r,style:i,importedStyles:o}=n;if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;const s=this.getMapInstanceId(r),a={mapInstanceId:s,eventId:this.getEventId(s),style:i};o.length&&(a.importedStyles=o),this.queueRequest({timestamp:Date.now(),payload:a},t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},e)}},D=L.postStyleLoadEvent.bind(L),N=new class extends I{constructor(){super("gljs.performance")}postPerformanceEvent(t,n){e.e.EVENTS_URL&&(t||e.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},t)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:s}=this.queue.shift(),a=function(r){const o=performance.getEntriesByType("resource"),s=performance.getEntriesByType("mark"),a=function(e){const t={};if(e)for(const n in e)if("other"!==n)for(const r of e[n]){const e=`${n}ResolveRangeMin`,i=`${n}ResolveRangeMax`,o=`${n}RequestCount`,s=`${n}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,r.startTime),t[i]=Math.max(t[i]||-1/0,r.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==r.transferSize&&0===r.transferSize&&a(s),a(o)}return t}(function(e,t){const n={};if(e)for(const r of e){const e=t(r);void 0===n[e]&&(n[e]=[]),n[e].push(r)}return n}(o,i)),l=window.devicePixelRatio,c=navigator.connection||navigator.mozConnection||navigator.webkitConnection,u=c?c.effectiveType:void 0,h={counters:[],metadata:[],attributes:[]},d=(e,t,n)=>{null!=n&&e.push({name:t,value:n.toString()})};for(const e in a)d(h.counters,e,a[e]);if(r.interactionRange[0]!==1/0&&r.interactionRange[1]!==-1/0&&(d(h.counters,"interactionRangeMin",r.interactionRange[0]),d(h.counters,"interactionRangeMax",r.interactionRange[1])),s)for(const e of Object.keys(n)){const t=n[e],r=s.find(e=>e.name===t);r&&d(h.counters,t,r.startTime)}return d(h.counters,"visibilityHidden",r.visibilityHidden),d(h.attributes,"style",function(t){if(t)for(const n of t){const t=n.name.split("?")[0];if(e.i(t)){const e=t.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(o)),d(h.attributes,"terrainEnabled",r.terrainEnabled?"true":"false"),d(h.attributes,"fogEnabled",r.fogEnabled?"true":"false"),d(h.attributes,"projection",r.projection),d(h.attributes,"zoom",r.zoom),d(h.metadata,"devicePixelRatio",l),d(h.metadata,"connectionEffectiveType",u),d(h.metadata,"navigatorUserAgent",navigator.userAgent),d(h.metadata,"screenWidth",window.screen.width),d(h.metadata,"screenHeight",window.screen.height),d(h.metadata,"windowWidth",window.innerWidth),d(h.metadata,"windowHeight",window.innerHeight),d(h.metadata,"mapWidth",r.width/l),d(h.metadata,"mapHeight",r.height/l),d(h.metadata,"webglRenderer",r.renderer),d(h.metadata,"webglVendor",r.vendor),d(h.metadata,"sdkVersion",t),d(h.metadata,"sdkIdentifier","mapbox-gl-js"),h}(s);for(const e of a.metadata);for(const e of a.counters);for(const e of a.attributes);this.postEvent(o,a,()=>{},r)}},z=N.postPerformanceEvent.bind(N),F=new class extends I{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,n,r,i){if(!e.e.API_URL||!e.e.SESSION_PATH)return;const o=T(e.e.API_URL+e.e.SESSION_PATH);o.params.push(`sku=${n||""}`),o.params.push(`access_token=${i||e.e.ACCESS_TOKEN||""}`);const s={url:A(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=e.g(s,e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(i)})}getSessionAPI(t,n,r,i){this.skuToken=n,this.errorCb=i,e.e.SESSION_PATH&&e.e.API_URL&&(r||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(w)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}remove(){this.errorCb=null}},B=F.getSessionAPI.bind(F),j=new Set;function U(e,t){t?j.add(e):j.delete(e)}class V{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(e){return this._updatedImages[e]?Array.from(this._updatedImages[e].values()):[]}updateImage(t,n){this._updatedImages[n]=this._updatedImages[n]||new Set,this._updatedImages[n].add(e.I.toString(t)),this.setDirty()}resetUpdatedImages(e){this._updatedImages[e]&&this._updatedImages[e].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function G(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class H extends e.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,"raster"!==t&&e.t()&&(this.imageRasterizerDispatcher=new e.D(e.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new e.r({width:1,height:1}))}removeScope(e){this.loaded.delete(e),this.imageProviders.delete(e),this.images.delete(e),this.updatedImages.delete(e),this.callbackDispatchedThisFrame.delete(e),this.patterns.delete(e),this.atlasImage.delete(e);const t=this.atlasTexture.get(e);t&&(t.destroy(),this.atlasTexture.delete(e))}addImageProvider(e,t){this.imageProviders.has(t)||this.imageProviders.set(t,new Map),this.imageProviders.get(t).set(e.id,e)}removeImageProvider(e,t){this.imageProviders.has(t)&&this.imageProviders.get(t).delete(e)}getPendingImageProviders(){const e=[];for(const t of this.imageProviders.values())for(const n of t.values())n.hasPendingRequests()&&e.push(n);return e}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new e.y),this._imageRasterizer}isLoaded(){for(const e of this.loaded.keys())if(!this.loaded.get(e))return!1;return!0}setLoaded(e,t){if(this.loaded.get(t)!==e&&(this.loaded.set(t,e),e)){for(const{ids:e,callback:n}of this.requestors)this._notify(e,t,n);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images.get(t).get(e.toString())}addImage(e,t,n){this._validate(e,n)&&this.images.get(t).set(e.toString(),n)}_validate(t,n){let r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),r=!1),this._validateContent(n.content,n)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let n=0;for(const r of e){if(r[0]<n||r[1]<r[0]||t<r[1])return!1;n=r[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;if(!t.usvg){if(e[0]<0||t.data.width<e[0])return!1;if(e[1]<0||t.data.height<e[1])return!1;if(e[2]<0||t.data.width<e[2])return!1;if(e[3]<0||t.data.height<e[3])return!1}return!(e[2]<e[0]||e[3]<e[1])}updateImage(e,t,n){const r=this.images.get(t).get(e.toString());n.version=r.version+1,this.images.get(t).set(e.toString(),n),this.updatedImages.get(t).add(e),this.removeFromImageRasterizerCache(e,t)}clearUpdatedImages(e){this.updatedImages.get(e).clear()}removeFromImageRasterizerCache(t,n){"raster"!==this.spriteFormat&&(e.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(e,t){const n=this.images.get(t),r=n.get(e.toString());n.delete(e.toString()),this.patterns.get(t).delete(e.toString()),this.removeFromImageRasterizerCache(e,t),r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(t=>e.I.from(t))}getImages(e,t,n){const r=[],i=[],o=this.imageProviders.get(t);for(const c of e){if(!c.iconsetId){r.push(c);continue}const e=o.get(c.iconsetId);e&&(this.getImage(c,t)?i.push(c):e.addPendingRequest(c))}if(0===r.length)return void this._notify(i,t,n);let s=!0;const a=!!this.loaded.get(t),l=this.images.get(t);if(!a)for(const c of r)l.has(c.toString())||(s=!1);a||s?this._notify(r,t,n):this.requestors.push({ids:r,scope:t,callback:n})}rasterizeImages(e,t){const n=new Map,{tasks:r,scope:i}=e;for(const[o,s]of r.entries()){const e=this.getImage(s.id,i);e&&n.set(o,{image:e,imageVariant:s})}this._rasterizeImages(i,n,t)}_rasterizeImages(t,n,r){if(e.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:n,scope:t},r);else{const e=new Map;for(const[r,{image:i,imageVariant:o}]of n.entries())e.set(r,this.imageRasterizer.rasterize(o,i,t,0));r(void 0,e)}}getUpdatedImages(e){return this.updatedImages.get(e)||new Set}_notify(t,n,r){const i=this.images.get(n),o=new Map;for(const s of t){if(!i.get(s.toString())){if(s.iconsetId)continue;this.fire(new e.A("styleimagemissing",{id:s.name}))}const t=i.get(s.toString());if(!t){e.w(`Image "${s.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const n={data:t.usvg?null:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,usvg:t.usvg,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)};t.usvg&&Object.assign(n,{width:t.icon.usvg_tree.width,height:t.icon.usvg_tree.height}),o.set(e.I.toString(s),n)}r(null,o)}getPixelSize(e){const{width:t,height:n}=this.atlasImage.get(e);return{width:t,height:n}}getPattern(t,n,r){const i=t.toString(),o=this.patterns.get(n),s=o.get(i),a=this.getImage(t,n);if(!a)return null;if(s){if(s.position.version===a.version)return s.position;s.position.version=a.version}else{if(a.usvg&&!a.data){const o=this.getPatternInFlightId(i,n);if(this.patternsInFlight.has(o))return null;this.patternsInFlight.add(o);const s=new e.B(t).scaleSelf(e.q.devicePixelRatio),l=new Map([[s.toString(),{image:a,imageVariant:s}]]);return this._rasterizeImages(n,l,(e,t)=>this.storePatternImage(s,n,a,r,t)),null}this.storePattern(t,n,a)}return this._updatePatternAtlas(n,r),o.get(i).position}getPatternInFlightId(t,n){return e.C(t,n)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(e,t,n,r,i){const o=e.toString(),s=i?i.get(o):void 0;s&&(n.data=s,this.storePattern(e.id,t,n),this._updatePatternAtlas(t,r),this.patternsInFlight.delete(this.getPatternInFlightId(e.id.toString(),t)))}storePattern(t,n,r){const i={w:r.data.width+2*e.F,h:r.data.height+2*e.F,x:0,y:0},o=new e.G(i,r,e.F);this.patterns.get(n).set(t.toString(),{bin:i,position:o})}destroyAtlasTextures(){for(const e of this.atlasTexture.values())e&&e.destroy();this.atlasTexture.clear()}bind(t,n){const r=t.gl;let i=this.atlasTexture.get(n);i?this.dirty&&(i.update(this.atlasImage.get(n)),this.dirty=!1):(i=new e.T(t,this.atlasImage.get(n),r.RGBA8),this.atlasTexture.set(n,i)),i.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const r=this.patterns.get(t),i=Array.from(r.values()).map(e=>{let{bin:t}=e;return t}),{w:o,h:s}=e.H(i),a=this.atlasImage.get(t);a.resize({width:o||1,height:s||1});const l=this.images.get(t);for(const[c,{bin:u,position:h}]of r.entries()){let t=h.padding;const r=u.x+t,i=u.y+t,o=l.get(c).data,s=o.width,d=o.height;t=t>1?t-1:t,e.r.copy(o,a,{x:0,y:0},{x:r,y:i},{width:s,height:d},n),e.r.copy(o,a,{x:0,y:d-t},{x:r,y:i-t},{width:s,height:t},n),e.r.copy(o,a,{x:0,y:0},{x:r,y:i+d},{width:s,height:t},n),e.r.copy(o,a,{x:s-t,y:0},{x:r-t,y:i},{width:t,height:d},n),e.r.copy(o,a,{x:0,y:0},{x:r+s,y:i},{width:t,height:d},n),e.r.copy(o,a,{x:s-t,y:d-t},{x:r-t,y:i-t},{width:t,height:t},n),e.r.copy(o,a,{x:0,y:d-t},{x:r+s,y:i-t},{width:t,height:t},n),e.r.copy(o,a,{x:0,y:0},{x:r+s,y:i+d},{width:t,height:t},n),e.r.copy(o,a,{x:s-t,y:0},{x:r-t,y:i+d},{width:t,height:t},n)}this.dirty=!0}beginFrame(){for(const e of this.images.keys())this.callbackDispatchedThisFrame.set(e,new Set)}dispatchRenderCallbacks(e,t){const n=this.images.get(t);for(const r of e){if(this.callbackDispatchedThisFrame.get(t).has(r.toString()))continue;this.callbackDispatchedThisFrame.get(t).add(r.toString());const e=n.get(r.toString());G(e)&&this.updateImage(r,t,e)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function $(t){const n=t.key,r=t.value,i=t.valueSpec||{},o=t.objectElementValidators||{},s=t.style,a=t.styleSpec;let l=[];const c=e.J(r);if("object"!==c)return[new e.V(n,r,`object expected, ${c} found`)];for(const u in r){const t=u.split(".")[0];let c;o[t]?c=o[t]:i[t]?c=fe:o["*"]?c=o["*"]:i["*"]&&(c=fe),c?l=l.concat(c({key:(n?`${n}.`:n)+u,value:r[u],valueSpec:i[t]||i["*"],style:s,styleSpec:a,object:r,objectKey:u},r)):l.push(new e.K(n,r[u],`unknown property "${u}"`))}for(const u in i)o[u]||i[u].required&&void 0===i[u].default&&void 0===r[u]&&l.push(new e.V(n,r,`missing required property "${u}"`));return l}function W(t){const n=t.value,r=t.valueSpec,i=t.style,o=t.styleSpec,s=t.key,a=t.arrayElementValidator||fe;if("array"!==e.J(n))return[new e.V(s,n,`array expected, ${e.J(n)} found`)];if(r.length&&n.length!==r.length)return[new e.V(s,n,`array length ${r.length} expected, length ${n.length} found`)];if(r["min-length"]&&n.length<r["min-length"])return[new e.V(s,n,`array length at least ${r["min-length"]} expected, length ${n.length} found`)];let l={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};o.$version<7&&(l.function=r.function),"object"===e.J(r.value)&&(l=r.value);let c=[];for(let e=0;e<n.length;e++)c=c.concat(a({array:n,arrayIndex:e,value:n[e],valueSpec:l,style:i,styleSpec:o,key:`${s}[${e}]`},!0));return c}function q(t){const n=t.key,r=t.value,i=t.valueSpec;let o=e.J(r);if("number"===o&&r!=r&&(o="NaN"),"number"!==o)return[new e.V(n,r,`number expected, ${o} found`)];if("minimum"in i){let o=i.minimum;if("array"===e.J(i.minimum)&&(o=i.minimum[t.arrayIndex]),r<o)return[new e.V(n,r,`${r} is less than the minimum value ${o}`)]}if("maximum"in i){let o=i.maximum;if("array"===e.J(i.maximum)&&(o=i.maximum[t.arrayIndex]),r>o)return[new e.V(n,r,`${r} is greater than the maximum value ${o}`)]}return[]}function X(t){const n=t.valueSpec,r=e.M(t.value.type);let i,o,s,a={};const l="categorical"!==r&&void 0===t.value.property,c=!l,u="array"===e.J(t.value.stops)&&"array"===e.J(t.value.stops[0])&&"object"===e.J(t.value.stops[0][0]),h=$({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===r)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let n=[];const i=t.value;return n=n.concat(W({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:d})),"array"===e.J(i)&&0===i.length&&n.push(new e.V(t.key,i,"array must have at least one stop")),n},default:function(e){return fe({key:e.key,value:e.value,valueSpec:n,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&l&&h.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===r||t.value.stops||h.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===r&&t.valueSpec.expression&&!e.N(t.valueSpec)&&h.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.O(t.valueSpec)?h.push(new e.V(t.key,t.value,"property functions not supported")):l&&!e.Q(t.valueSpec)&&h.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==r&&!u||void 0!==t.value.property||h.push(new e.V(t.key,t.value,'"property" property is required')),h;function d(t){let r=[];const i=t.value,l=t.key;if("array"!==e.J(i))return[new e.V(l,i,`array expected, ${e.J(i)} found`)];if(2!==i.length)return[new e.V(l,i,`array length 2 expected, length ${i.length} found`)];if(u){if("object"!==e.J(i[0]))return[new e.V(l,i,`object expected, ${e.J(i[0])} found`)];if(void 0===i[0].zoom)return[new e.V(l,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new e.V(l,i,"object stop key must have value")];const n=e.M(i[0].zoom);if("number"!=typeof n)return[new e.V(l,i[0].zoom,"stop zoom values must be numbers")];if(s&&s>n)return[new e.V(l,i[0].zoom,"stop zoom values must appear in ascending order")];n!==s&&(s=n,o=void 0,a={}),r=r.concat($({key:`${l}[0]`,value:i[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:q,value:f}}))}else r=r.concat(f({key:`${l}[0]`,value:i[0],style:t.style,styleSpec:t.styleSpec},i));return e.S(e.U(i[1]))?r.concat([new e.V(`${l}[1]`,i[1],"expressions are not allowed in function stops.")]):r.concat(fe({key:`${l}[1]`,value:i[1],valueSpec:n,style:t.style,styleSpec:t.styleSpec}))}function f(t,s){const l=e.J(t.value),c=e.M(t.value),u=null!==t.value?t.value:s;if(i){if(l!==i)return[new e.V(t.key,u,`${l} stop domain type must match previous stop domain type ${i}`)]}else i=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new e.V(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==r){let i=`number expected, ${l} found`;return e.O(n)&&void 0===r&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,u,i)]}return"categorical"!==r||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==r&&"number"===l&&"number"==typeof c&&"number"==typeof o&&void 0!==o&&c<o?[new e.V(t.key,u,"stop domain values must appear in ascending order")]:(o=c,"categorical"===r&&c in a?[new e.V(t.key,u,"stop domain values must be unique")]:(a[c]=!0,[])):[new e.V(t.key,u,`integer expected, found ${String(c)}`)]}}function Z(t){const n=("property"===t.expressionContext?e.W:e.X)(e.U(t.value),t.valueSpec);if("error"===n.result)return n.value.map(n=>new e.V(`${t.key}${n.key}`,t.value,n.message));const r=n.value.expression||n.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new e.V(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.Y(r))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return K(r,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.Z(r,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e._(r))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function K(t,n){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const e of n.valueSpec.expression.parameters)r.delete(e);if(0===r.size)return[];const i=[];return t instanceof e.$&&r.has(t.name)?[new e.V(n.key,n.value,`["${t.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(t.eachChild(e=>{i.push(...K(e,n))}),i)}function Y(t){const n=t.key,r=t.value,i=t.valueSpec,o=[];return Array.isArray(i.values)?-1===i.values.indexOf(e.M(r))&&o.push(new e.V(n,r,`expected one of [${i.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(i.values).indexOf(e.M(r))&&o.push(new e.V(n,r,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(r)} found`)),o}function J(t){return e.a1(e.U(t.value))?Z(e.L({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Q(t)}function Q(t){const n=t.value,r=t.key;if("array"!==e.J(n))return[new e.V(r,n,`array expected, ${e.J(n)} found`)];const i=t.styleSpec;let o,s=[];if(n.length<1)return[new e.V(r,n,"filter array must have at least 1 element")];switch(s=s.concat(Y({key:`${r}[0]`,value:n[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===e.M(n[1])&&s.push(new e.V(r,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&s.push(new e.V(r,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(o=e.J(n[1]),"string"!==o&&s.push(new e.V(`${r}[1]`,n[1],`string expected, ${o} found`)));for(let a=2;a<n.length;a++)o=e.J(n[a]),"$type"===e.M(n[1])?s=s.concat(Y({key:`${r}[${a}]`,value:n[a],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&s.push(new e.V(`${r}[${a}]`,n[a],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let e=1;e<n.length;e++)s=s.concat(Q({key:`${r}[${e}]`,value:n[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":o=e.J(n[1]),2!==n.length?s.push(new e.V(r,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==o&&s.push(new e.V(`${r}[1]`,n[1],`string expected, ${o} found`))}return s}function ee(t,n){const r=t.key,i=t.style,o=t.layer,s=t.styleSpec,a=t.value,l=t.objectKey,c=s[`${n}_${t.layerType}`];if(!c)return[];const u=l.match(/^(.*)-use-theme$/);if("paint"===n&&u&&c[u[1]])return e.S(a)?[].concat(fe({key:t.key,value:a,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:i,styleSpec:s,expressionContext:"property",propertyType:n,propertyKey:l})):fe({key:r,value:a,valueSpec:{type:"string"},style:i,styleSpec:s});const h=l.match(/^(.*)-transition$/);if("paint"===n&&h&&c[h[1]]&&c[h[1]].transition)return fe({key:r,value:a,valueSpec:s.transition,style:i,styleSpec:s});const d=t.valueSpec||c[l];if(!d)return[new e.K(r,a,`unknown property "${l}"`)];let f;if("string"===e.J(a)&&e.O(d)&&!d.tokens&&(f=/^{([^}]+)}$/.exec(a))){const t=`\`{ "type": "identity", "property": ${f?JSON.stringify(f[1]):'"_"'} }\``;return[new e.V(r,a,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const p=[];if("symbol"===t.layerType)"text-field"!==l||!i||i.glyphs||i.imports||p.push(new e.V(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.a2(e.U(a))&&"identity"===e.M(a.type)&&p.push(new e.V(r,a,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===n&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&e.O(d)&&(e.a3(d)||e.Q(d))){const t=e.W(e.U(a),d),n=t.value.expression||t.value._styleExpression.expression;n&&!e.Z(n,["measure-light"])&&("model-emissive-strength"===l&&e._(n)&&e.Y(n)||p.push(new e.V(r,a,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return p.concat(fe({key:t.key,value:a,valueSpec:d,style:i,styleSpec:s,expressionContext:"property",propertyType:n,propertyKey:l}))}function te(e){return ee(e,"paint")}function ne(e){return ee(e,"layout")}function re(t){let n=[];const r=t.value,i=t.key,o=t.style,s=t.styleSpec;r.type||r.ref||n.push(new e.V(i,r,'either "type" or "ref" is required'));let a=e.M(r.type);const l=e.M(r.ref);if(r.id){const s=e.M(r.id);for(let a=0;a<t.arrayIndex;a++){const t=o.layers[a];e.M(t.id)===s&&n.push(new e.V(i,r.id,`duplicate layer id "${r.id}", previously used at line ${t.id.__line__}`))}}if("ref"in r){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in r&&n.push(new e.V(i,r[t],`"${t}" is prohibited for ref layers`))}),o.layers.forEach(n=>{e.M(n.id)===l&&(t=n)}),t?t.ref?n.push(new e.V(i,r.ref,"ref cannot reference another ref layer")):a=e.M(t.type):"string"==typeof l&&n.push(new e.V(i,r.ref,`ref layer "${l}" not found`))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(r.source){const t=o.sources&&o.sources[r.source],s=t&&e.M(t.type);t?"vector"===s&&"raster"===a?n.push(new e.V(i,r.source,`layer "${r.id}" requires a raster source`)):"raster"===s&&"raster"!==a?n.push(new e.V(i,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==s||r["source-layer"]?"raster-dem"===s&&"hillshade"!==a?n.push(new e.V(i,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==s||["raster","raster-particle"].includes(a)?"line"===a&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&"geojson"===s&&!t.lineMetrics?n.push(new e.V(i,r,`layer "${r.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):"raster-particle"===a&&"raster-array"!==s&&n.push(new e.V(i,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):n.push(new e.V(i,r.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new e.V(i,r,`layer "${r.id}" must specify a "source-layer"`)):n.push(new e.V(i,r.source,`source "${r.source}" not found`))}else n.push(new e.V(i,r,'missing required property "source"'));return n=n.concat($({key:i,value:r,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fe({key:`${i}.type`,value:r.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:t=>J(e.L({layerType:a},t)),layout:t=>$({layer:r,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>ne(e.L({layerType:a},t))}}),paint:t=>$({layer:r,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>te(e.L({layerType:a,layer:r},t))}})}})),n}function ie(t){const n=t.value,r=t.key,i=e.J(n);return"string"!==i?[new e.V(r,n,`string expected, ${i} found`)]:[]}const oe={promoteId:function t(n){let{key:r,value:i}=n;if("string"===e.J(i))return ie({key:r,value:i});if(Array.isArray(i)){const t=[],n=e.U(i),o=e.X(n);return"error"===o.result&&o.value.forEach(n=>{t.push(new e.V(`${r}${n.key}`,null,`${n.message}`))}),e.Z(o.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||t.push(new e.V(`${r}`,null,"promoteId expression should be only feature dependent")),t}{const e=[];for(const n in i)e.push(...t({key:`${r}.${n}`,value:i[n]}));return e}}};function se(t){const n=t.value,r=t.key,i=t.styleSpec,o=t.style;if(!n.type)return[new e.V(r,n,'"type" is required')];const s=e.M(n.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(s)&&(n.url||n.tiles||a.push(new e.K(r,n,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat($({key:r,value:n,valueSpec:i[`source_${s.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:oe})),a;case"geojson":if(a=$({key:r,value:n,valueSpec:i.source_geojson,style:o,styleSpec:i,objectElementValidators:oe}),n.cluster)for(const e in n.clusterProperties){const[t,i]=n.clusterProperties[e],o="string"==typeof t?[t,["accumulated"],["get",e]]:t;a.push(...Z({key:`${r}.${e}.map`,value:i,expressionContext:"cluster-map"})),a.push(...Z({key:`${r}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return $({key:r,value:n,valueSpec:i.source_video,style:o,styleSpec:i});case"image":return $({key:r,value:n,valueSpec:i.source_image,style:o,styleSpec:i});case"canvas":return[new e.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Y({key:`${r}.type`,value:n.type,valueSpec:{values:ae(i)}})}}function ae(e){return e.source.reduce((t,n)=>{const r=e[n];return"enum"===r.type.type&&(t=t.concat(Object.keys(r.type.values))),t},[])}function le(t){const n=t.value,r=t.styleSpec,i=r.light,o=t.style;let s=[];const a=e.J(n);if(void 0===n)return s;if("object"!==a)return s=s.concat([new e.V("light",n,`object expected, ${a} found`)]),s;for(const l in n){const t=l.match(/^(.*)-transition$/),a=l.match(/^(.*)-use-theme$/);s=s.concat(a&&i[a[1]]?fe({key:l,value:n[l],valueSpec:{type:"string"},style:o,styleSpec:r}):t&&i[t[1]]&&i[t[1]].transition?fe({key:l,value:n[l],valueSpec:r.transition,style:o,styleSpec:r}):i[l]?fe({key:l,value:n[l],valueSpec:i[l],style:o,styleSpec:r}):[new e.V(l,n[l],`unknown property "${l}"`)])}return s}function ce(t){const n=t.value;let r=[];if(!n)return r;const i=e.J(n);if("object"!==i)return r=r.concat([new e.V("light-3d",n,`object expected, ${i} found`)]),r;const o=t.styleSpec,s=o["light-3d"],a=t.key,l=t.style,c=t.style.lights;for(const d of["type","id"])if(!(d in n))return r=r.concat([new e.V("light-3d",n,`missing property ${d} on light`)]),r;if(n.type&&c)for(let d=0;d<t.arrayIndex;d++){const t=e.M(n.type),i=c[d];e.M(i.type)===t&&r.push(new e.V(a,n.id,`duplicate light type "${n.type}", previously defined at line ${i.id.__line__}`))}const u=`properties_light_${n.type}`;if(!(u in o))return r=r.concat([new e.V("light-3d",n,`Invalid light type ${n.type}`)]),r;const h=o[u];for(const d in n)if("properties"===d){const i=n[d],s=e.J(i);if("object"!==s)return r=r.concat([new e.V("properties",i,`object expected, ${s} found`)]),r;for(const a in i){const s=a.match(/^(.*)-transition$/),c=a.match(/^(.*)-use-theme$/);r=r.concat(c&&h[c[1]]?fe({key:d,value:i[a],valueSpec:{type:"string"},style:l,styleSpec:o}):s&&h[s[1]]&&h[s[1]].transition?fe({key:d,value:n[d],valueSpec:o.transition,style:l,styleSpec:o}):h[a]?fe({key:a,value:i[a],valueSpec:h[a],style:l,styleSpec:o}):[new e.K(t.key,i[a],`unknown property "${a}"`)])}}else r=r.concat(s[d]?fe({key:d,value:n[d],valueSpec:s[d],style:l,styleSpec:o}):[new e.K(d,n[d],`unknown property "${d}"`)]);return r}function ue(t){const n=t.value,r=t.key,i=t.style,o=t.styleSpec,s=o.terrain;let a=[];const l=e.J(n);if(void 0===n)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new e.V("terrain",n,`object expected, ${l} found`)]),a;for(const c in n){const t=c.match(/^(.*)-transition$/),r=c.match(/^(.*)-use-theme$/);a=a.concat(r&&s[r[1]]?fe({key:c,value:n[c],valueSpec:{type:"string"},style:i,styleSpec:o}):t&&s[t[1]]&&s[t[1]].transition?fe({key:c,value:n[c],valueSpec:o.transition,style:i,styleSpec:o}):s[c]?fe({key:c,value:n[c],valueSpec:s[c],style:i,styleSpec:o}):[new e.K(c,n[c],`unknown property "${c}"`)])}if(n.source){const t=i.sources&&i.sources[n.source],o=t&&e.M(t.type);t?"raster-dem"!==o&&a.push(new e.V(r,n.source,`terrain cannot be used with a source of type ${String(o)}, it only be used with a "raster-dem" source type`)):a.push(new e.V(r,n.source,`source "${n.source}" not found`))}else a.push(new e.V(r,n,'terrain is missing required property "source"'));return a}function he(t){const n=t.value,r=t.style,i=t.styleSpec,o=i.fog;let s=[];const a=e.J(n);if(void 0===n)return s;if("object"!==a)return s=s.concat([new e.V("fog",n,`object expected, ${a} found`)]),s;for(const l in n){const t=l.match(/^(.*)-transition$/),a=l.match(/^(.*)-use-theme$/);s=s.concat(a&&o[a[1]]?fe({key:l,value:n[l],valueSpec:{type:"string"},style:r,styleSpec:i}):t&&o[t[1]]&&o[t[1]].transition?fe({key:l,value:n[l],valueSpec:i.transition,style:r,styleSpec:i}):o[l]?fe({key:l,value:n[l],valueSpec:o[l],style:r,styleSpec:i}):[new e.K(l,n[l],`unknown property "${l}"`)])}return s}const de={"*":()=>[],array:W,boolean:function(t){const n=t.value,r=t.key,i=e.J(n);return"boolean"!==i?[new e.V(r,n,`boolean expected, ${i} found`)]:[]},number:q,color:function(t){const n=t.key,r=t.value,i=e.J(r);return"string"!==i?[new e.V(n,r,`color expected, ${i} found`)]:null===e.a0.parseCSSColor(r)?[new e.V(n,r,`color expected, "${r}" found`)]:[]},enum:Y,filter:J,function:X,layer:re,object:$,source:se,model:e.a4,light:le,"light-3d":ce,terrain:ue,fog:he,string:ie,formatted:function(e){return 0===ie(e).length?[]:Z(e)},resolvedImage:function(e){return 0===ie(e).length?[]:Z(e)},projection:function(t){const n=t.value,r=t.styleSpec,i=r.projection,o=t.style;let s=[];const a=e.J(n);if("object"===a)for(const e in n)s=s.concat(fe({key:e,value:n[e],valueSpec:i[e],style:o,styleSpec:r}));else"string"!==a&&(s=s.concat([new e.V("projection",n,`object or string expected, ${a} found`)]));return s},import:function(t){const{value:n,styleSpec:r}=t,{data:i,...o}=n;Object.defineProperty(o,"__line__",{value:n.__line__,enumerable:!1});let s=$(e.L({},t,{value:o,valueSpec:r.import}));return""===e.M(o.id)&&s.push(new e.V(`${t.key}.id`,o,"import id can't be an empty string")),i&&(s=s.concat(me(i,r,{key:`${t.key}.data`}))),s},iconset:function(t){const n=t.value,r=t.key,i=t.styleSpec,o=t.style;if(!n.type)return[new e.V(r,n,'"type" is required')];const s=e.M(n.type);let a=[];if(a=a.concat($({key:r,value:n,valueSpec:i[`iconset_${s}`],style:o,styleSpec:i})),"source"===s&&n.source){const t=o.sources&&o.sources[n.source],i=t&&e.M(t.type);t?"raster-array"!==i&&a.push(new e.V(r,n.source,`iconset cannot be used with a source of type ${String(i)}, it only be used with a "raster-array" source type`)):a.push(new e.V(r,n.source,`source "${n.source}" not found`))}return a}};function fe(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=t.value,i=t.valueSpec,o=t.styleSpec;if(i.expression&&e.a2(e.M(r)))return X(t);if(i.expression&&e.S(e.U(r)))return Z(t);if(i.type&&de[i.type]){const r=de[i.type](t);return!0===n&&r.length>0&&"array"===e.J(t.value)?Z(t):r}return $(e.L({},t,{valueSpec:i.type?o[i.type]:i}))}function pe(t){const n=t.value,r=t.key,i=ie(t);return i.length||(-1===n.indexOf("{fontstack}")&&i.push(new e.V(r,n,'"glyphs" url must include a "{fontstack}" token')),-1===n.indexOf("{range}")&&i.push(new e.V(r,n,'"glyphs" url must include a "{range}" token'))),i}function me(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a5;return fe({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:t,valueSpec:n.$root,styleSpec:n,style:t,objectElementValidators:{glyphs:pe,"*":()=>[]}})}function ge(t){return Ie(me(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a5))}const _e=e=>Ie(se(e)),ye=e=>Ie(le(e)),ve=e=>Ie(ce(e)),xe=e=>Ie(ue(e)),be=e=>Ie(he(e)),we=t=>Ie(function(t){const n=t.value,r=t.style,i=t.styleSpec,o=i.snow;let s=[];const a=e.J(n);if(void 0===n)return s;if("object"!==a)return s=s.concat([new e.V("snow",n,`object expected, ${a} found`)]),s;for(const l in n){const t=l.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?fe({key:l,value:n[l],valueSpec:i.transition,style:r,styleSpec:i}):o[l]?fe({key:l,value:n[l],valueSpec:o[l],style:r,styleSpec:i}):[new e.K(l,n[l],`unknown property "${l}"`)])}return s}(t)),Se=t=>Ie(function(t){const n=t.value,r=t.style,i=t.styleSpec,o=i.rain;let s=[];const a=e.J(n);if(void 0===n)return s;if("object"!==a)return s=s.concat([new e.V("rain",n,`object expected, ${a} found`)]),s;for(const l in n){const t=l.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?fe({key:l,value:n[l],valueSpec:i.transition,style:r,styleSpec:i}):o[l]?fe({key:l,value:n[l],valueSpec:o[l],style:r,styleSpec:i}):[new e.K(l,n[l],`unknown property "${l}"`)])}return s}(t)),Ee=e=>Ie(re(e)),Te=e=>Ie(J(e)),Ae=e=>Ie(te(e)),Ce=e=>Ie(ne(e)),Pe=t=>Ie(e.a4(t));function Ie(e){return e.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function ke(t,n){let r=!1;if(n&&n.length)for(const i of n)i instanceof e.K?e.w(i.message):(t.fire(new e.z(new Error(i.message))),r=!0);return r}let Me;class Re extends e.E{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.a6(Me||(Me=new e.a7({anchor:new e.a8(e.a5.light.anchor),position:new e.a9(e.a5.light.position),color:new e.a8(e.a5.light.color),intensity:new e.a8(e.a5.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(ye,e,n)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,r){return(!r||!1!==r.validate)&&ke(this,t.call(ge,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let Oe=class extends e.E{constructor(t,n,r,i,o){super(),this.scope=r,this._transitionable=new e.a6(new e.a7({source:new e.a8(e.a5.terrain.source),exaggeration:new e.a8(e.a5.terrain.exaggeration)}),r,i),this._transitionable.setTransitionOrValue(t,i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=o}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.aa(t,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const t=this._transitionable._values.exaggeration;if(!t)return null;const n=t.value.expression;if(!n)return null;let r=-1,i=-1,o=1;for(const s of n.zoomStops)o=n.evaluate(new e.aa(s,{worldview:this.worldview})),o>.01?(r=s,i=-1):i=s;return o<.01&&r>0&&i>r?[r,i]:null}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.ab}};const Le=45,De=65,Ne=.05;function ze(t,n,r,i){const o=e.af(Le,De,r),[s,a]=Fe(t,i);let l=1-Math.min(1,Math.exp((n-s)/(a-s)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*t.alpha}function Fe(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function Be(t,n,r,i,o){const s=e.ad([],[n,r,i],o.mercatorFogMatrix);return ze(t,e.ae(s),o.pitch,o._fov)}function je(t,n,r,i,o,s,a){const l=[[r,i,0],[o,i,0],[o,s,0],[r,s,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const h of l){const t=e.ad([],h,n),r=e.ae(t);c=Math.min(c,r),u=Math.max(u,r)}return[ze(t,c,a.pitch,a._fov),ze(t,u,a.pitch,a._fov)]}class Ue extends e.E{constructor(t,n,r,i){super();const o=new e.a7({range:new e.a8(e.a5.fog.range),color:new e.a8(e.a5.fog.color),"color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new e.a8(e.a5.fog["high-color"]),"high-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new e.a8(e.a5.fog["space-color"]),"space-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new e.a8(e.a5.fog["horizon-blend"]),"star-intensity":new e.a8(e.a5.fog["star-intensity"]),"vertical-range":new e.a8(e.a5.fog["vertical-range"])});this._transitionable=new e.a6(o,r,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new e.ag(o),this.scope=r}get state(){const t=this._transform,n="globe"===t.projection.name,r=e.ah(t.zoom),i=this.properties.get("range"),o=[.5,3];return{range:n?[e.ai(o[0],i[0],r),e.ai(o[1],i[1],r)]:i,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(be,t,r))return;const i=e.h({},t);for(const o of Object.keys(e.a5.fog))void 0===i[o]&&(i[o]=e.a5.fog[o].default);this._options=i,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.af(Le,De,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(t,n,r){const i=e.ac.fromLngLat(n),o=r.elevation?r.elevation.getAtPointOrZero(i):0;return Be(t,i.x,i.y,o,r)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return je(this.state,n,0,0,e.aj,e.aj,this._transform)}getOpacityForBounds(e,t,n,r,i){return this._transform.projection.supportsFog?je(this.state,e,t,n,r,i,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Fe(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const r of n){const n=t.points[r];let i;if(n[2]>=0)i=n;else{const o=t.points[r-4];i=e.ak(o,n,o[2]/(o[2]-n[2]))}if(Be(this.state,i[0],i[1],0,this._transform)>=Ne)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,r){return(!r||!1!==r.validate)&&ke(this,t.call(ge,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let Ve,Ge,He,$e,We=class extends e.E{constructor(t,n,r,i){super();const o=Ve||(Ve=new e.a7({density:new e.a8(e.a5.snow.density),intensity:new e.a8(e.a5.snow.intensity),color:new e.a8(e.a5.snow.color),opacity:new e.a8(e.a5.snow.opacity),vignette:new e.a8(e.a5.snow.vignette),"vignette-color":new e.a8(e.a5.snow["vignette-color"]),"center-thinning":new e.a8(e.a5.snow["center-thinning"]),direction:new e.a8(e.a5.snow.direction),"flake-size":new e.a8(e.a5.snow["flake-size"])}));this._transitionable=new e.a6(o,r,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(o),this.scope=r}get state(){const t=this.properties.get("opacity"),n=this.properties.get("color"),r=this.properties.get("direction"),i=e.al(r[0]),o=-Math.max(e.al(r[1]),.01),s=[Math.cos(i)*Math.cos(o),Math.sin(i)*Math.cos(o),Math.sin(o)],a=this.properties.get("vignette"),l=this.properties.get("vignette-color");return l.a=a,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(n.r,n.g,n.b,n.a*t),direction:s,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(we,t,r))return;const i=e.h({},t);for(const o of Object.keys(e.a5.snow))void 0===i[o]&&(i[o]=e.a5.snow[o].default);this._options=i,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,r){return(!r||!1!==r.validate)&&ke(this,t.call(ge,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}},qe=class extends e.E{constructor(t,n,r,i){super();const o=Ge||(Ge=new e.a7({density:new e.a8(e.a5.rain.density),intensity:new e.a8(e.a5.rain.intensity),color:new e.a8(e.a5.rain.color),opacity:new e.a8(e.a5.rain.opacity),vignette:new e.a8(e.a5.rain.vignette),"vignette-color":new e.a8(e.a5.rain["vignette-color"]),"center-thinning":new e.a8(e.a5.rain["center-thinning"]),direction:new e.a8(e.a5.rain.direction),"droplet-size":new e.a8(e.a5.rain["droplet-size"]),"distortion-strength":new e.a8(e.a5.rain["distortion-strength"])}));this._transitionable=new e.a6(o,r,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(o),this.scope=r}get state(){const t=this.properties.get("opacity"),n=this.properties.get("color"),r=this.properties.get("direction"),i=e.al(r[0]),o=-Math.max(e.al(r[1]),.01),s=[Math.cos(i)*Math.cos(o),Math.sin(i)*Math.cos(o),Math.sin(o)],a=this.properties.get("vignette-color");return a.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(n.r,n.g,n.b,n.a*t),direction:s,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:a}}get(){return this._transitionable.serialize()}set(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Se,t,r))return;const i=e.h({},t);for(const o of Object.keys(e.a5.rain))void 0===i[o]&&(i[o]=e.a5.rain[o].default);this._options=i,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,r){return(!r||!1!==r.validate)&&ke(this,t.call(ge,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}};class Xe extends e.E{constructor(t,n,r,i){super(),this.scope=r,this._options=t,this.properties=new e.ag(n),this._transitionable=new e.a6(n,r,new Map(i)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class Ze{constructor(e,t,n){this.screenBounds=e,this.cameraPoint=n.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=t,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(t,n){let r,i;if(t instanceof e.P||"number"==typeof t[0]){const o=e.P.convert(t);r=[o],i=n.isPointAboveHorizon(o)}else{const o=e.P.convert(t[0]),s=e.P.convert(t[1]),a=o.add(s)._div(2);r=[o,s],i=e.ao(o,s).every(e=>n.isPointAboveHorizon(e))&&n.isPointAboveHorizon(a)}return new Ze(r,i,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.ao(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],i=e.ao(n,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<r.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?i[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(i[3]=this.cameraPoint)),e.ap(i,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],i=e.ao(n,r,t),o=this.cameraPoint.clone();switch(3*((o.y>n.y)+(o.y>r.y))+((o.x>n.x)+(o.x>r.x))){case 0:i[0]=o,i[4]=o.clone();break;case 1:i.splice(1,0,o);break;case 2:i[1]=o;break;case 3:i.splice(4,0,o);break;case 5:i.splice(2,0,o);break;case 6:i[3]=o;break;case 7:i.splice(3,0,o);break;case 8:i[2]=o}return i}containsTile(t,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=t.queryPadding/n._pixelsPerMercatorPixel+1,s=r?this._bufferedCameraMercator(o,n):this._bufferedScreenMercator(o,n);let a=t.tileID.wrap+(s.unwrapped?i:0);const l=s.polygon.map(n=>e.aq(t.tileTransform,n,a));if(!e.ar(l,0,0,e.aj,e.aj))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?i:0);const c=this.screenGeometryMercator.polygon.map(n=>e.as(t.tileTransform,n,a)),u=c.map(t=>new e.P(t[0],t[1])),h=n.getFreeCameraOptions().position||new e.ac(0,0,0),d=e.as(t.tileTransform,h,a),f=c.map(t=>{const n=e.at(t,t,d);return e.au(n,n),new e.av(d,n)}),p=e.aw(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:f,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.ax(l),m.min.x=e.ay(m.min.x,0,e.aj),m.min.y=e.ay(m.min.y,0,e.aj),m.max.x=e.ay(m.max.x,0,e.aj),m.max.y=e.ay(m.max.y,0,e.aj),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:p};var m}_bufferedScreenMercator(e,t){const n=Je(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[n]=r,r}}_bufferedCameraMercator(e,t){const n=Je(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[n]=r,r}}_projectAndResample(t,n){const r=function(t,n){const r=e.az([],n.pixelMatrix,n.globeMatrix),i=[0,-e.aB,0,1],o=[0,e.aB,0,1],s=[0,0,0,1];e.aA(i,i,r),e.aA(o,o,r),e.aA(s,s,r);const a=new e.P(i[0]/i[3],i[1]/i[3]),l=new e.P(o[0]/o[3],o[1]/o[3]),c=e.aC(t,a)&&i[3]<s[3],u=e.aC(t,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(e,t,n){for(let r=1;r<e.length;r++){const i=Ye(t.pointCoordinate3D(e[r-1]).x),o=Ye(t.pointCoordinate3D(e[r]).x);if(n<0){if(i<o)return{idx:r,t:-i/(o-1-i)}}else if(o<i)return{idx:r,t:(1-i)/(o+1-i)}}return null}(t,n,c?-1:1);if(!h)return null;const{idx:d,t:f}=h;let p=d>1?Ke(t.slice(0,d),n):[],m=d<t.length?Ke(t.slice(d),n):[];p=p.map(t=>new e.P(Ye(t.x),t.y)),m=m.map(t=>new e.P(Ye(t.x),t.y));const g=[...p];0===g.length&&g.push(m[m.length-1]);const _=e.ai(g[g.length-1].y,(0===m.length?p[0]:m[0]).y,f);let y;return y=c?[new e.P(0,_),new e.P(0,0),new e.P(1,0),new e.P(1,_)]:[new e.P(1,_),new e.P(1,1),new e.P(0,1),new e.P(0,_)],g.push(...y),0===m.length?g.push(p[0]):g.push(...m),{polygon:g.map(t=>new e.ac(t.x,t.y)),unwrapped:!1}}(t,n);if(r)return r;const i=function(t,n){let r=!1,i=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>i&&(i=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const n=(o+e)%(t.length-1),i=t[n],s=t[n+1];Math.abs(i.x-s.x)>.5&&(i.x<s.x?(i.x+=1,0===n&&(t[t.length-1].x+=1)):(s.x+=1,n+1===t.length-1&&(t[0].x+=1)),r=!0)}const s=e.aD(n.center.lng);return r&&s<Math.abs(s-1)&&t.forEach(e=>{e.x-=1}),{polygon:t,unwrapped:r}}(Ke(t,n).map(t=>new e.P(Ye(t.x),t.y)),n);return{polygon:i.polygon.map(t=>new e.ac(t.x,t.y)),unwrapped:i.unwrapped}}}function Ke(t,n){return e.aE(t,e=>{const t=n.pointCoordinate3D(e);e.x=t.x,e.y=t.y},1/256)}function Ye(e){return e<0?1+e%1:e%1}function Je(e){return 100*e|0}function Qe(t,n,r,i,o){const s=function(r,i){if(r)return o(r);if(i){if(t.url&&i.tiles&&t.tiles&&delete t.tiles,i.variants){if(!Array.isArray(i.variants))return o(new Error("variants must be an array"));for(const t of i.variants){if(null==t||"object"!=typeof t||t.constructor!==Object)return o(new Error("variant must be an object"));if(!Array.isArray(t.capabilities))return o(new Error("capabilities must be an array"));if(1===t.capabilities.length&&"meshopt"===t.capabilities[0]){i=e.h(i,t);break}}}const r=e.aF(e.h({},i,t),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);r.tiles=n.canonicalizeTileset(r,t.url),o(null,r)}},a=function(e,t,n){if(!e)return null;if(!t&&!n)return e;n=n||e.worldview_default;const r=Object.values(e.language||{});if(0===r.length)return null;const i=Object.values(e.worldview||{});if(0===i.length)return null;const o=r.every(e=>e===t),s=i.every(e=>e===n);return o&&s?e:t in(e.language_options||{})||n in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(t.data,r,i);return a?e.q.frame(()=>s(null,a)):t.url?e.n(n.transformRequest(n.normalizeSourceURL(t.url,null,r,i),e.R.Source),s):e.q.frame(()=>{const{data:e,...n}=t;s(null,n)})}function et(t,n){const r=Math.pow(2,n.z),i=Math.floor(e.aD(t.getWest())*r),o=Math.floor(e.aH(t.getNorth())*r),s=Math.ceil(e.aD(t.getEast())*r),a=Math.ceil(e.aH(t.getSouth())*r);return n.x>=i&&n.x<s&&n.y>=o&&n.y<a}class tt{constructor(t,n,r){this.bounds=t?e.aG.convert(this.validateBounds(t)):null,this.minzoom=n||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const n of t)this.extraBounds.push(e.aG.convert(this.validateBounds(n)))}}contains(e){if(e.z>this.maxzoom||e.z<this.minzoom)return!1;if(this.bounds&&!et(this.bounds,e))return!1;if(!this.extraBounds)return!0;for(const t of this.extraBounds)if(et(t,e))return!0;return!1}static fromTileJSON(e){if(!e.bounds&&!e.extra_bounds)return null;const t=new tt(e.bounds,e.minzoom,e.maxzoom);return t.addExtraBounds(e.extra_bounds),t}}class nt extends e.E{constructor(t,n,r,i){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.h(this,e.aF(n,["url","scheme","tileSize","promoteId"])),this._options=e.h({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new e.aI}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=Qe(this._options,this.map._requestManager,n,r,(i,o)=>{if(this._tileJSONRequest=null,this._loaded=!0,i)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),r&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new e.z(i));else if(o){if(e.h(this,o),this.hasWorldviews=!!o.worldview_options,o.worldview_default&&(this.worldviewDefault=o.worldview_default),o.vector_layers){this.vectorLayers=o.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const e of o.vector_layers)this.vectorLayerIds.push(e.id),o.worldview&&o.worldview[e.source]&&this.localizableLayerIds.add(e.id)}this.tileBounds=tt.fromTileJSON(o),M(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(i)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.h({},this._options)}loadTile(t,n){const r=t.tileID.canonical.url(this.tiles,this.scheme),i=this.map._requestManager.normalizeTileURL(r),o=this.map._requestManager.transformRequest(i,e.R.Tile),s=this.map.style?this.map.style.getLut(this.scope):null,a=s?{image:s.image.clone()}:null,l={request:o,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:a,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&e.j(r)&&(l.localizableLayerIds=this.localizableLayerIds),l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",l,c.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,c.bind(this),void 0,!0);else{const n=e.aJ.call({deduped:this._deduped},l,(e,n)=>{e||!n?c.call(this,e):(l.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},t.actor&&t.actor.send("loadTile",l,c.bind(this),void 0,!0))},!0);t.request={cancel:n}}function c(r,i){return delete t.request,t.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadVectorData(i,this.map.painter),e.aK(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rt extends e.E{constructor(t,n,r,i){super(),this.id=t,this.dispatcher=r,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.h({type:"raster"},n),e.h(this,e.aF(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=this.map.getWorldview();this._tileJSONRequest=Qe(this._options,this.map._requestManager,null,n,(n,r)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new e.z(n)):r&&(e.h(this,r),r.raster_layers&&(this.rasterLayers=r.raster_layers,this.rasterLayerIds=this.rasterLayers.map(e=>e.id)),this.tileBounds=tt.fromTileJSON(r),M(r.tiles),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.h({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,n){const r=e.q.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=e.o(this.map._requestManager.transformRequest(i,e.R.Tile),(r,i,o,s)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):r?(t.state="errored",n(r)):i?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s}),t.setTexture(i,this.map.painter),t.state="loaded",e.aK(this.dispatcher),void n(null)):n(null)))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t&&t()}unloadTile(t,n){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class it extends rt{constructor(t,n,r,i){super(t,n,r,i),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=e.h({type:"raster-array"},n)}triggerRepaint(e){const t=this.map.painter._terrain,n=this.map.style.getSourceCache(this.id);t&&t.enabled&&n&&t._clearRenderCacheForTile(n.id,e.tileID),this.map.triggerRepaint()}loadTile(t,n){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),i=this.map._requestManager.transformRequest(r,e.R.Tile),o={request:i,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=i,t.actor||(t.actor=this.dispatcher.getActor());const s=(e,r,i,o)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(e){if("AbortError"===e.name)return;return t.state="errored",n(e)}if(this.map._refreshExpiredTiles&&r&&t.setExpiryData({cacheControl:i,expires:o}),this.partial)t.state="empty";else{if(!r)return n(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=r}n(null)};t.request=this.partial?t.fetchHeader(void 0,s.bind(this)):t.actor.send("loadTile",o,s.bind(this),void 0,!0)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){const n=e.texturePerLayer;if(e.flushAllQueues(),n.size){e.destroy(!0);for(const e of n.values())this.map.painter.saveTileTexture(e)}else e.destroy()}prepareTile(t,n,r,i){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(n,r,i,(n,i)=>{if(n)return t.state="errored",this.fire(new e.z(n)),void this.triggerRepaint(t);i&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(r,i,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find(t=>{let{id:n}=t;return n===e}),n=t&&t.fields,r=n&&n.bands&&n.bands;return r?r[0]:0}getTextureDescriptor(t,n,r){if(!t)return;const i=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!i)return;let o=null;n instanceof e.aN?o=n.paint.get("raster-array-band"):n instanceof e.aO&&(o=n.paint.get("raster-particle-array-band"));const s=o||this.getInitialBand(i);if(null==s)return;if(!t.textureDescriptorPerLayer.get(n.id))return void this.prepareTile(t,i,n.id,s);if(t.updateNeeded(n.id,s)&&!r)return;const a=t.textureDescriptorPerLayer.get(n.id);return Object.assign({},a,{texture:t.texturePerLayer.get(n.id)})}getImages(t,n){const r=new Map;for(const i of t)for(const t of n){const[n,o]=t.split("/"),s=i.getLayer(n);if(!s)continue;if(!s.hasBand(o)||!s.hasDataForBand(o))continue;const{bytes:a,tileSize:l,buffer:c}=s.getBandView(o),u=l+2*c,h={data:new e.r({width:u,height:u},a),pixelRatio:2,sdf:!1,usvg:!1,version:0};r.set(t,h)}return r}}const ot={vector:nt,raster:rt,"raster-dem":class extends rt{constructor(t,n,r,i){super(t,n,r,i),this.type="raster-dem",this.maxzoom=22,this._options=e.h({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(t,n){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function i(e,r){e&&(t.state="errored",n(e)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",n(null))}t.request=e.o(this.map._requestManager.transformRequest(r,e.R.Tile),function(r,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(r)t.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const n=ImageBitmap&&o instanceof ImageBitmap&&e.t(),r=1-(o.width-e.aL(o.width))/2;r<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=n?o:e.q.getImageData(o,r),c={uid:t.uid,tileID:t.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:r};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadTile",c,i.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const n=t.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?t.wrap-1:t.wrap,s=(n.x+1+r)%r,a=n.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.aM(t.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,n.z,s,n.y).key]={backfilled:!1},n.y>0&&(l[new e.aM(t.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,n.z,s,n.y-1).key]={backfilled:!1}),n.y+1<r&&(l[new e.aM(t.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,n.z,s,n.y+1).key]={backfilled:!1}),l}},"raster-array":it,geojson:class extends e.E{constructor(t,n,r,i){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(i),this._data=n.data,this._options=e.h({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),void 0!==n.minzoom&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const o=e.aj/this.tileSize;this.workerOptions=e.h({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:e.aj,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.aj,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){if(!this._options.dynamic)return this.fire(new e.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof t&&("Feature"===t.type&&(t={type:"FeatureCollection",features:[t]}),"FeatureCollection"!==t.type))return this.fire(new e.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof t&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const e=new Map;for(const t of this._data.features)e.set(t.id,t);for(const n of t.features)e.set(n.id,n);this._data.features=[...e.values()]}else this._data=t;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},r),this}_updateWorkerData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.A("dataloading",{dataType:"source"})),this._loaded=!1;const n=e.h({append:t},this.workerOptions);n.scope=this.scope;const r=this._data;"string"==typeof r?(n.request=this.map._requestManager.transformRequest(e.q.resolveURL(r),e.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(n,r)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new e.z(n));else{const n={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(n.resourceTiming=r.resourceTiming[this.id]),t&&(this._partialReload=!0),this.fire(new e.A("data",n)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t),this._updateWorkerData()}loadTile(t,n){const r=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const i=this.map.style?this.map.style.getLut(this.scope):null,o=i?{image:i.image.clone()}:null,s=this._partialReload,a={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:o,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:s,worldview:this.map.getWorldview()};t.request=this.actor.send(r,a,(e,i)=>s&&!i?(t.state="loaded",n(null)):(delete t.request,t.destroy(),t.aborted?n(null):e?n(e):(t.loadVectorData(i,this.map.painter,"reloadTile"===r),n(null))),void 0,"loadTile"===r)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e,t){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.aP{constructor(e,t,n,r){super(e,t,n,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,e.R.Source).url);e.aQ(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new e.z(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.z(new e.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aP,model:class extends e.E{constructor(e,t,n,r){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const n in this._options.models){const r=this._options.models[n],i=e.aS(this.map._requestManager.transformRequest(r.uri,e.R.Model).url).then(t=>{if(!t)return;const i=e.aT(t),o=new e.aU(n,r.position,r.orientation,i);o.computeBoundsAndApplyParent(),this.models.push(o)}).catch(t=>{this.fire(new e.z(new Error(`Could not load model ${n} from ${r.uri}: ${t.message}`)))});t.push(i)}Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new e.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return this._options}},"batched-model":class extends e.E{constructor(e,t,n,r){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=Qe(this._options,this.map._requestManager,n,r,(i,o)=>{this._tileJSONRequest=null,this._loaded=!0,i?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new e.z(i))):o&&(e.h(this,o),o.bounds&&(this.tileBounds=new tt(o.bounds,this.minzoom,this.maxzoom)),M(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,n){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:e.q.devicePixelRatio,promoteId:this.promoteId};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=n;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",i,o.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",i,o.bind(this),void 0,!0);function o(e,r){return t.aborted?n(null):e&&404!==e.status?n(e):(this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadModelData(r,this.map.painter),t.state="loaded",void n(null))}}serialize(){return e.h({},this._options)}},canvas:class extends e.aP{constructor(t,n,r,i){super(t,n,r,i),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new e.z(new e.V(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.z(new e.V(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new e.z(new e.V(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new e.z(new e.V(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.z(new e.V(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(e){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,n,r,i){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=n,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new tt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),e.h(this,e.aF(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this.map=t,this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:n,y:r,z:i}=e.tileID.canonical,o=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:n,y:r,z:i},{signal:o.signal})).then(function(n){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===n?(e.state="errored",t(null)):null===n?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(n)?(this.loadTileData(e,n),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(n=>{"AbortError"!==n.name&&(e.state="errored",t(n))}),e.request.cancel=()=>o.abort()}loadTileData(e,t){e.setTexture(t,this.map.painter)}unloadTile(t,n){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:n,z:r}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:n,z:r})}n&&n()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t)}_update(){this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}}},st=function(t,n,r,i){const o=new ot[n.type](t,n,r,i);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.aV(["load","abort","unload","serialize","prepare"],o),o};function at(e,t){return`${arguments.length>2&&void 0!==arguments[2]?arguments[2]:""}:${t.id||""}:${t.layer.id}:${function(e){if("layerId"in e)return`layer:${e.layerId}`;{const{featuresetId:t,importId:n}=e;return`featureset:${t}${n?`:import:${n}`:""}`}}(e.target)}`}function lt(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(e.uniqueFeatureID){const i=at(e,t,r);if(n.has(i))return!0;n.add(i)}return!1}function ct(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=t.sourceCache.transform,s=t.sourceCache.tilesIn(e,t.has3DLayers,i);s.sort(dt);const a=[];for(const l of s){const e=l.tile.queryRenderedFeatures(t,l,n,r,o,i);Object.keys(e).length&&a.push({wrappedTileID:l.tile.tileID.wrapped().key,queryResults:e})}return 0===a.length?{}:function(e){const t={},n={};for(const r of e){const e=r.queryResults,i=r.wrappedTileID,o=n[i]=n[i]||{};for(const n in e){const r=e[n],i=o[n]=o[n]||{},s=t[n]=t[n]||[];for(const e of r)i[e.featureIndex]||(i[e.featureIndex]=!0,s.push(e))}}return t}(a)}function ut(e,t,n,r,i,o){const s={},a=r.queryRenderedSymbols(e),l=[];for(const c of Object.keys(a).map(Number))l.push(i[c]);l.sort(dt);for(const c of l){const e=c.featureIndex.lookupSymbolFeatures(a[c.bucketInstanceId],c.bucketIndex,c.sourceLayerIndex,t,n,o);for(const t in e){const n=s[t]=s[t]||[],r=e[t];r.sort((e,t)=>{const n=c.featureSortOrder;if(n){const r=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-r}return t.featureIndex-e.featureIndex});for(const e of r)n.push(e)}}return s}function ht(e,t){const n=e.getRenderableIds().map(t=>e.getTileByID(t)),r=[],i={};for(let o=0;o<n.length;o++){const e=n[o],s=e.tileID.canonical.key;i[s]||(i[s]=!0,e.querySourceFeatures(r,t))}return r}function dt(e,t){const n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}function ft(e,t){const n={};if(!t)return n;for(const r of e){const e=r.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)n[t.fqid]=r}}return n}const pt=32,mt=33,gt=new Uint16Array(8184);for(let zl=0;zl<2046;zl++){let e=zl+2,t=0,n=0,r=0,i=0,o=0,s=0;for(1&e?r=i=o=pt:t=n=s=pt;(e>>=1)>1;){const a=t+r>>1,l=n+i>>1;1&e?(r=t,i=n,t=o,n=s):(t=r,n=i,r=o,i=s),o=a,s=l}const a=4*zl;gt[a+0]=t,gt[a+1]=n,gt[a+2]=r,gt[a+3]=i}const _t=new Uint16Array(2178),yt=new Uint8Array(1089),vt=new Uint16Array(1089);function xt(e){return 0===e?-.03125:32===e?.03125:0}const bt={type:2,extent:e.aj,loadGeometry:()=>[[new e.P(0,0),new e.P(e.aj+1,0),new e.P(e.aj+1,e.aj+1),new e.P(0,e.aj+1),new e.P(0,0)]]};class wt{constructor(t,n,r,i,o,s){this.tileID=t,this.uid=e.a$(),this.uses=0,this.tileSize=n,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,i&&i.style&&(this._lastUpdatedBrightness=i.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection),this.worldview=s}registerFadeDuration(t){const n=t+this.timeAdded;n<e.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,r){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=ft(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.b1){if(this.hasSymbolBuckets=!0,!r)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.b1&&n.hasRTLText){this.hasRTLText=!0,e.b2();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],r=n.style.getOwnLayer(e);if(!r)continue;const i=r.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,i)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.b0}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(e,t,n){e&&(e.resourceTiming&&(this.resourceTiming=e.resourceTiming),this.buckets=Object.assign({},this.buckets,ft(e.buckets,t.style)),e.featureIndex&&(this.latestFeatureIndex=e.featureIndex))}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const n=this.buckets[e];n.uploadPending()&&n.upload(t)}const n=t.gl,r=this.imageAtlas;r&&!r.uploaded&&(this.imageAtlasTexture=new e.T(t,r.image,n.RGBA8,{useMipmap:!!r.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,n){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,n),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const r=t.style.getBrightness();(this._lastUpdatedBrightness||r)&&(this._lastUpdatedBrightness&&r&&Math.abs(this._lastUpdatedBrightness-r)<.001||(this.updateBuckets(t,this._lastUpdatedBrightness!==r),this._lastUpdatedBrightness=r))}queryRenderedFeatures(t,n,r,i,o,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const a=function(t,n){const r=e.bn([],[.5*t.width,.5*-t.height,1]);return e.bo(r,r,[1,-1,0]),e.az(r,r,t.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(r)}(o,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:a,transform:i,availableImages:r,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,n){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const i=r.loadVTLayers(),o=n?n.sourceLayer:"",s=i._geojsonTileLayer||i[o];if(!s)return;const a=e.b3(n&&n.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let d=0;d<s.length;d++){const n=s.feature(d);if(a.needGeometry){const t=e.b4(n,!0);if(!a.filter(new e.aa(this.tileID.overscaledZ,{worldview:this.worldview}),t,this.tileID.canonical))continue}else if(!a.filter(new e.aa(this.tileID.overscaledZ,{worldview:this.worldview}),n))continue;const i=r.getId(n,o),f=new e.b5(n,l,c,u,i);f.tile=h,t.push(f)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const n=e.b6(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(n)if(this.expirationTime<n)t=!0;else{const r=this.expirationTime-n;r?this.expirationTime=e+Math.max(r,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(e){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&e&&this.updateBuckets(e)}updateBuckets(t,n){if(!this.latestFeatureIndex)return;if(!t.style)return;const r=this.latestFeatureIndex.loadVTLayers(),i=t.style.listImages(),o=t.style.getBrightness();for(const s in this.buckets){if(!t.style.hasLayer(s))continue;const a=this.buckets[s],l=a.layers[0],c=l.sourceLayer||"_geojsonTileLayer",u=r[c],h=t.style.getLayerSourceCache(l);let d={};h&&(d=h._state.getState(c,void 0));const f=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},p=Object.keys(d).length>0&&!n;p&&!a.stateDependentLayers.length&&!n||a.update(d,u,i,f,p?a.stateDependentLayers:a.layers,n,o),(a instanceof e.b7||a instanceof e.b8)&&t._terrain&&t._terrain.enabled&&h&&a.uploadPending()&&t._terrain._clearRenderCacheForTile(h.id,this.tileID);const m=t&&t.style&&t.style.getOwnLayer(s);m&&(this.queryPadding=Math.max(this.queryPadding,m.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.q.now()+t}setTexture(t,n){const r=n.context,i=r.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t):(this.texture=new e.T(r,t,i.RGBA8,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(e,t){const n={};for(const r of t)n[r]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const r=e.b9(bt,this.tileID.canonical,this.tileTransform)[0],i=new e.ba,o=new e.bb;for(let e=0;e<r.length;e++){const{x:t,y:n}=r[e];i.emplaceBack(t,n),o.emplaceBack(e)}o.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(o),this._tileDebugBuffer=t.createVertexBuffer(i,e.bc.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,i.length,o.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const r=e.b9(bt,this.tileID.canonical,this.tileTransform)[0];let i,o;if(this.isRaster){const t=function(t,n){const r=e.aW(t,n),i=Math.pow(2,t.z);for(let u=0;u<mt;u++)for(let o=0;o<mt;o++){const s=e.aX((t.x+(o+xt(o))/pt)/i),a=e.aY((t.y+(u+xt(u))/pt)/i),l=n.project(s,a),c=u*mt+o;_t[2*c+0]=Math.round((l.x*r.scale-r.x)*e.aj),_t[2*c+1]=Math.round((l.y*r.scale-r.y)*e.aj)}yt.fill(0),vt.fill(0);for(let e=2045;e>=0;e--){const t=4*e,n=gt[t+0],r=gt[t+1],i=gt[t+2],o=gt[t+3],s=n+i>>1,a=r+o>>1,l=s+a-r,c=a+n-s,u=r*mt+n,h=o*mt+i,d=a*mt+s,f=Math.hypot((_t[2*u+0]+_t[2*h+0])/2-_t[2*d+0],(_t[2*u+1]+_t[2*h+1])/2-_t[2*d+1])>=16;yt[d]=yt[d]||(f?1:0),e<1022&&(yt[d]=yt[d]||yt[(r+c>>1)*mt+(n+l>>1)]||yt[(o+c>>1)*mt+(i+l>>1)])}const o=new e.aZ,s=new e.a_;let a=0;function l(t,n){const r=n*mt+t;return 0===vt[r]&&(o.emplaceBack(_t[2*r+0],_t[2*r+1],t*e.aj/pt,n*e.aj/pt),vt[r]=++a),vt[r]-1}function c(e,t,n,r,i,o){const a=e+n>>1,u=t+r>>1;if(Math.abs(e-i)+Math.abs(t-o)>1&&yt[u*mt+a])c(i,o,e,t,a,u),c(n,r,i,o,a,u);else{const a=l(e,t),c=l(n,r),u=l(i,o);s.emplaceBack(a,c,u)}}return c(0,0,pt,pt,pt,0),c(pt,pt,0,0,0,pt),{vertices:o,indices:s}}(this.tileID.canonical,n);i=t.vertices,o=t.indices}else{i=new e.aZ,o=new e.a_;for(const{x:e,y:n}of r)i.emplaceBack(e,n,0,0);const t=e.be(i.int16.subarray(0,4*i.length),void 0,4);for(let e=0;e<t.length;e+=3)o.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(i,e.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(o),this._tileBoundsSegments=e.bd.simpleSegment(0,0,i.length,o.length)}_makeGlobeTileDebugBuffers(t,n){const r=n.projection;if(!r||"globe"!==r.name||n.freezeTileCoverage)return;const i=this.tileID.canonical,o=e.bg(i,n),s=e.bh(o),a=e.ah(n.zoom);let l;a>0&&(l=e.bi(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,i,n,s,l,a),this._makeGlobeTileDebugTextBuffer(t,i,n,s,l,a)}_globePoint(t,n,r,i,o,s,a){let l=e.bj(t,n,r);if(s){const o=1<<r.z,c=e.aD(i.center.lng),u=e.aH(i.center.lat),h=(r.x+.5)/o-c;let d=0;h>.5?d=-1:h<-.5&&(d=1);let f=(t/e.aj+r.x)/o+d,p=(n/e.aj+r.y)/o;f=(f-c)*i._pixelsPerMercatorPixel+c,p=(p-u)*i._pixelsPerMercatorPixel+u;const m=[f*i.worldSize,p*i.worldSize,0];e.ad(m,m,s),l=e.bk(l,m,a)}return e.ad(l,l,o)}_makeGlobeTileDebugBorderBuffer(t,n,r,i,o,s){const a=new e.ba,l=new e.bb,c=new e.bl,u=(e,t,u,h,d)=>{const f=(u-e)/(d-1),p=(h-t)/(d-1),m=a.length;for(let g=0;g<d;g++){const u=e+g*f,h=t+g*p;a.emplaceBack(u,h);const d=this._globePoint(u,h,n,r,i,o,s);c.emplaceBack(d[0],d[1],d[2]),l.emplaceBack(m+g)}},h=e.aj;u(0,0,h,0,16),u(h,0,h,h,16),u(h,h,0,h,16),u(0,h,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,e.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.bm.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(t,n,r,i,o,s){const a=e.aj/4,l=new e.ba,c=new e.a_,u=new e.bl,h=25;c.reserve(32),l.reserve(h),u.reserve(h);const d=(e,t)=>h*e+t;for(let e=0;e<h;e++){const t=e*a;for(let e=0;e<h;e++){const c=e*a;l.emplaceBack(c,t);const h=this._globePoint(c,t,n,r,i,o,s);u.emplaceBack(h[0],h[1],h[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const n=d(e,t),r=d(e,t+1),i=d(e+1,t),o=d(e+1,t+1);c.emplaceBack(n,r,i),c.emplaceBack(i,r,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,e.bm.members),this._tileDebugTextSegments=e.bd.simpleSegment(0,0,h,32)}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}e.bp.setPbf(e.bq);class St extends wt{constructor(e,t,n,r,i){super(e,t,n,r,i),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(e){return this._mrt&&this._mrt.getLayer(e)}setTexturePerLayer(t,n,r){const i=r.context,o=i.gl;let s=this.texturePerLayer.get(t)||r.getTileTexture(n.width);s&&s instanceof e.T?s.update(n,{premultiply:!1}):s=new e.T(i,n,o.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,s)}flushQueues(e){const t=this._workQueuePerLayer.get(e)||[],n=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()();for(;n.length;)n.pop()()}flushAllQueues(){for(const e of this._workQueuePerLayer.keys()){const t=this._workQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}for(const e of this._fetchQueuePerLayer.keys()){const t=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}}fetchHeader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,n=arguments.length>1?arguments[1]:void 0;const r=this._mrt=new e.bp(30),i=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.br(i,(e,i,o,s)=>{if(e)n(e);else try{const e=r.getHeaderLength(i);if(e>t)return void(this.request=this.fetchHeader(e,n));r.parseHeader(i),this._isHeaderLoaded=!0;let a=0;for(const t of Object.values(r.layers))a=Math.max(a,t.dataIndex[t.dataIndex.length-1].lastByte);i.byteLength>=a&&(this.entireBuffer=i),n(null,this.entireBuffer||i,o,s)}catch(e){n(e)}}),this.request}fetchBand(t,n,r,i){const o=this._mrt;if(!this._isHeaderLoaded||!o)return void i(new Error("Tile header is not ready"));const s=this.actor;if(!s)return void i(new Error("Can't fetch tile band without an actor"));let a;const l=(e,o)=>{if(a.complete(e,o),e)return void i(e);this.updateTextureDescriptor(t,n,r);const s=this.textureDescriptorPerLayer.get(n);i(null,s&&s.img)},c=(e,t)=>{if(e)return i(e);const r=s.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:t,task:a},l,void 0,!0),o=this._workQueuePerLayer.get(n)||[];o.push(()=>{r&&r.cancel(),a.cancel()}),this._workQueuePerLayer.has(n)||this._workQueuePerLayer.set(n,o)},u=o.getLayer(t);if(!u)return void i(new Error(`Unknown sourceLayer "${t}"`));if(u.hasDataForBand(r)){this.updateTextureDescriptor(t,n,r);const e=this.textureDescriptorPerLayer.get(n);return void i(null,e?e.img:null)}const h=u.getDataRange([r]);if(a=o.createDecodingTask(h),!a||a.tasks.length)if(this.flushQueues(n),this.entireBuffer)c(null,this.entireBuffer.slice(h.firstByte,h.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:`bytes=${h.firstByte}-${h.lastByte}`}}),r=e.br(t,c),i=this._fetchQueuePerLayer.get(n)||[];i.push(()=>{r.cancel(),a.cancel()}),this._fetchQueuePerLayer.has(n)||this._fetchQueuePerLayer.set(n,i)}else i(null)}updateNeeded(e,t){return(!this.textureDescriptorPerLayer.get(e)||this.textureDescriptorPerLayer.get(e).band!==t)&&"errored"!==this.state}updateTextureDescriptor(t,n,r){if(!this._mrt)return;const i=this._mrt.getLayer(t);if(!i||!i.hasBand(r)||!i.hasDataForBand(r))return;const{bytes:o,tileSize:s,buffer:a,offset:l,scale:c}=i.getBandView(r),u=s+2*a,h=new e.r({width:u,height:u},o),d=this.texturePerLayer.get(n);d&&d instanceof e.T&&d.update(h,{premultiply:!1}),this.textureDescriptorPerLayer.set(n,{layer:t,band:r,img:h,buffer:a,offset:l,tileSize:s,format:i.pixelFormat,mix:[c,256*c,65536*c,16777216*c]})}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(super.destroy(t),delete this._mrt,!t)for(const n of this.texturePerLayer.values())n&&n instanceof e.T&&n.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Et{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const i={value:t,timeout:void 0};if(void 0!==n&&(i.timeout=setTimeout(()=>{this.remove(e,i)},n)),this.data[r].push(i),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,r=void 0===t?0:this.data[n].indexOf(t),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const r of this.data[n])e(r.value)||t.push(r);for(const n of t)this.remove(n.value.tileID,n)}}class Tt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,r){const i=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},e.h(this.stateChanges[t][i],r),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==i&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][i]){this.deletedStates[t][i]={};for(const e in this.state[t][i])r[e]||(this.deletedStates[t][i][e]=null)}else for(const e in r)this.deletedStates[t]&&this.deletedStates[t][i]&&null===this.deletedStates[t][i][e]&&delete this.deletedStates[t][i][e]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(n in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][n]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(t,n){const r=this.state[t]||{},i=this.stateChanges[t]||{},o=this.deletedStates[t];if(null===o)return{};if(void 0!==n){const t=String(n),s=e.h({},r[t],i[t]);if(o){const e=o[n];if(null===e)return{};for(const t in e)delete s[t]}return s}const s=e.h({},r,i);if(o)for(const e in o)delete s[e];return s}initializeTileState(e,t){e.refreshFeatureState(t)}coalesceChanges(t,n){const r={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const t={};for(const n in this.stateChanges[i])this.state[i][n]||(this.state[i][n]={}),e.h(this.state[i][n],this.stateChanges[i][n]),t[n]=this.state[i][n];r[i]=t}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const t={};if(null===this.deletedStates[i])for(const e in this.state[i])t[e]={},this.state[i][e]={};else for(const e in this.deletedStates[i]){if(null===this.deletedStates[i][e])this.state[i][e]={};else if(this.state[i][e])for(const t of Object.keys(this.deletedStates[i][e]))delete this.state[i][e][t];t[e]=this.state[i][e]}r[i]=r[i]||{},e.h(r[i],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const e in t)t[e].refreshFeatureState(n)}}class At extends e.E{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new Et(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Tt,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles)if(!this._tiles[e].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ct).map(e=>e.key)}getRenderableIds(t,n){const r=[];for(const e in this._tiles)this._isIdRenderable(+e,t,n)&&r.push(this._tiles[e]);return t?r.sort((t,n)=>{const r=t.tileID,i=n.tileID,o=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),s=new e.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-i.overscaledZ||s.y-o.y||s.x-o.x}).map(e=>e.tileID.key):r.map(e=>e.tileID).sort(Ct).map(e=>e.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(n||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(t,n,r,i){if(i)if(t.state="errored",404!==i.status)this._source.fire(new e.z(i,{tile:t}));else{if(this._source.fire(new e.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=e.q.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const i=t[r];if(e.neighboringTiles&&e.neighboringTiles[i]){const t=this.getTileByID(i);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,r),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,r){for(const i in this._tiles){let o=this._tiles[i];if(r[i]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){r[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),r=this._getLoadedTile(t);if(r)return r}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,r=Math.ceil(e.height/t)+1,i=Math.floor(n*r*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,n,r,i,o){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;this.updateCacheSize(t,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const s="batched-model"===this._source.type;let a,l=this._source.maxzoom;const c=this.map&&this.map.painter?this.map.painter._terrain:null;if(c&&c.sourceCache===this&&c.attenuationRange()){const e=c.attenuationRange()[0],t=Math.floor(e)-Math.log2(c.getDemUpscale());l>t&&(l=t)}if(this.used||this.usedForTerrain){if(this._source.tileID)a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new e.aM(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y));else if(0!==this.tileCoverLift){const i=t.clone();i.tileCoverLift=this.tileCoverLift,a=i.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:s}),this._source.minzoom<=1&&"globe"===t.projection.name&&(a.push(new e.aM(1,0,1,0,0)),a.push(new e.aM(1,0,1,1,0)),a.push(new e.aM(1,0,1,0,1)),a.push(new e.aM(1,0,1,1,1)))}else if(a=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:s}),this._source.hasTile){const e=this._source.hasTile.bind(this._source);a=a.filter(t=>e(t))}}else a=[];if(a.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Pt(this._source.type)){const e=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),l=Math.min(e,this._source.maxzoom);if(s){const e=t.extendTileCover(a,l);for(const t of e)a.push(t)}else if(o){const e=t.extendTileCoverToNearPlane(a,this.transform.getFrustum(l),l);for(const t of e)a.push(t)}else if(this.castsShadows&&i){const e=t.extendTileCover(a,l,i);for(const t of e)this._shadowCasterTiles[t.key]=!0,a.push(t)}}const u=this._updateRetainedTiles(a);if(Pt(this._source.type)&&0!==a.length){const t={},n={},r=Object.keys(u);for(const o of r){const r=u[o],i=this._tiles[o];if(!i||i.fadeEndTime&&i.fadeEndTime<=e.q.now())continue;const s=this.findLoadedParent(r,Math.max(r.overscaledZ-At.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),n[o]=r}const i=a[a.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(u[e]||!t.hasData())continue;let r=t.tileID;for(;r.overscaledZ>i;){r=r.scaledTo(r.overscaledZ-1);const i=this._tiles[r.key];if(i&&i.hasData()&&n[r.key]){u[e]=t.tileID;break}}}for(const e in t)u[e]||(this._coveredTiles[e]=!0,u[e]=t[e])}for(const e in u)this._tiles[e].clearFadeHold();const h=e.bs(this._tiles,u);for(const e of h){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},r=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),i=e[0].overscaledZ,o=Math.max(i-At.maxOverzooming,this._source.minzoom),s=Math.max(i+At.maxUnderzooming,this._source.minzoom),a={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||r<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,r,s,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let i=l.overscaledZ-1;i>=o;--i){const o=l.scaledTo(i);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&r&&(e=this._addTile(o)),e&&(t[o.key]=o,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;r=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(t){let n=this._tiles[t.key];if(n)return!0!==n.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const r=Boolean(n);if(!r){const e=this.map?this.map.painter:null,r=this._source.tileSize*t.overscaleFactor();n="raster-array"===this._source.type?new St(t,r,this.transform.tileZoom,e,this._isRaster):new wt(t,r,this.transform.tileZoom,e,this._isRaster,this._source.worldview),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n.uses++,this._tiles[t.key]=n,r||this._source.fire(new e.A("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,r){const i=[],o=this.transform;if(!o)return i;const s="globe"===o.projection.name,a=e.aD(o.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(r&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(s){const t=c.tileID.canonical;if(0===t.z){const n=[Math.abs(e.ay(a,...It(t,-1))-a),Math.abs(e.ay(a,...It(t,1))-a)];u=[0,2*n.indexOf(Math.min(...n))-1]}else{const n=[Math.abs(e.ay(a,...It(t,-1))-a),Math.abs(e.ay(a,...It(t,0))-a),Math.abs(e.ay(a,...It(t,1))-a)];u=[n.indexOf(Math.min(...n))-1]}}else u=[0];for(const e of u){const r=t.containsTile(c,o,n,e);r&&i.push(r)}}return i}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const n=this.getRenderableIds(e,t).map(e=>this._tiles[e].tileID),r="globe"===this.transform.projection.name;for(const i of n)i.projMatrix=this.transform.calculateProjMatrix(i.toUnwrapped()),i.expandedProjMatrix=r?this.transform.calculateProjMatrix(i.toUnwrapped(),!1,!0):i.projMatrix;return n}sortCoordinatesByDistance(e){const t=e.slice(),n=this.transform._camera.position,r=this.transform._camera.forward(),i={};for(const o of t){const e=1/(1<<o.canonical.z);i[o.key]=((o.canonical.x+.5)*e+o.wrap-n[0])*r[0]+((o.canonical.y+.5)*e-n[1])*r[1]-n[2]*r[2]}return t.sort((e,t)=>i[e.key]-i[t.key]),t}hasTransition(){if(this._source.hasTransition())return!0;if(Pt(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=e.q.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const r=this._tiles[e];r&&r.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(t,n){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,n))};return void this._source.on("data",e)}const r=new Map,i=Array.isArray(t)?t:[t],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(const e of i){const t=e.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const a=Array.from(r.values());e.bt(a,(e,t)=>{const n=new wt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(n,e=>{"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),t(e,n)})},n)}}function Ct(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Pt(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function It(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}At.maxOverzooming=10,At.maxUnderzooming=3;class kt{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const n in this.style._mergedLayers){const r=this.style._mergedLayers[n];if("fill-extrusion"===r.type||"building"===r.type)this.layers.push({layer:r,visible:e,visibilityChanged:t});else if("model"===r.type){const n=this.style.getLayerSource(r);n&&"batched-model"===n.type&&this.layers.push({layer:r,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const n=t.layer;let r=!1;"fill-extrusion"===n.type?r=!n.isHidden(e)&&n.paint.get("fill-extrusion-opacity")>0:"building"===n.type?r=!n.isHidden(e)&&n.paint.get("building-opacity")>0:"model"===n.type&&(r=!n.isHidden(e)&&n.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!r&&t.visible,t.visible=r}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const r of this.layers){const e=r.layer,n=this.style.getLayerSourceCache(e);let i=1;"fill-extrusion"===e.type?i=r.visible?e.paint.get("fill-extrusion-vertical-scale"):0:"building"===e.type&&(i=r.visible?e.paint.get("building-vertical-scale"):0);let o=n?n.getTile(t):null;if(!o&&n)for(const r in n._tiles){const e=n._tiles[r];if(t.canonical.isChildOf(e.tileID.canonical)){o=e;break}}this.currentBuildingBuckets.push({bucket:o?o.getBucket(e):null,tileID:o?o.tileID:t,verticalScale:i})}e.hasAnyZOffset=!1;let n=!1;for(let r=0;r<e.symbolInstances.length;r++){const i=e.symbolInstances.get(r),o=i.zOffset,s=this._getHeightAtTileOffset(t,i.tileAnchorX,i.tileAnchorY);i.zOffset=s!==Number.NEGATIVE_INFINITY?s:o,n||o===i.zOffset||(n=!0),e.hasAnyZOffset||0===i.zOffset||(e.hasAnyZOffset=!0)}n&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,r,i){let o=n,s=r;if(t.canonical.z!==i.canonical.z){const a=i.canonical,l=1/(1<<t.canonical.z-a.z);o=(n+t.canonical.x*e.aj)*l-a.x*e.aj|0,s=(r+t.canonical.y*e.aj)*l-a.y*e.aj|0}return{tileX:o,tileY:s}}_getHeightAtTileOffset(e,t,n){let r,i;for(let o=0;o<this.layers.length;++o){const s=this.layers[o].layer;if("fill-extrusion"!==s.type&&"building"!==s.type)continue;const{bucket:a,tileID:l,verticalScale:c}=this.currentBuildingBuckets[o];if(!a)continue;const{tileX:u,tileY:h}=this._mapCoordToOverlappingTile(e,t,n,l),d=a.getHeightAtTileCoord(u,h);d&&void 0!==d.height&&(d.hidden?r=d.height:i=Math.max(d.height*c,i||0))}if(void 0!==i)return i;for(let o=0;o<this.layers.length;++o){const i=this.layers[o];if("model"!==i.layer.type||!i.visible)continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,n,a),u=s.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==r?Math.min(u.maxHeight,r)*u.verticalScale:u.height?u.height*u.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Mt(t,n){const r={};for(const e in t)"ref"!==e&&(r[e]=t[e]);return e.bu.forEach(e=>{e in n&&(r[e]=n[e])}),r}function Rt(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=Mt(e[n],t[e[n].ref]));return e}const Ot={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Lt(e,t,n){n.push({command:Ot.addSource,args:[e,t[e]]})}function Dt(e,t,n){t.push({command:Ot.removeSource,args:[e]}),n[e]=!0}function Nt(e,t,n,r){Dt(e,n,r),Lt(e,t,n)}function zt(t,n,r){let i;for(i in t[r])if(t[r].hasOwnProperty(i)&&"data"!==i&&!e.bv(t[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!e.bv(t[r][i],n[r][i]))return!1;return!0}function Ft(t,n,r,i,o,s){let a;for(a in n=n||{},t=t||{})t.hasOwnProperty(a)&&(e.bv(t[a],n[a])||r.push({command:s,args:[i,a,n[a],o]}));for(a in n)n.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e.bv(t[a],n[a])||r.push({command:s,args:[i,a,n[a],o]}))}function Bt(e){return e.id}function jt(e,t){return e[t.id]=t,e}function Ut(t,n,r){const i=n.createTileMatrix(t,t.worldSize,r.toUnwrapped());return e.az(new Float32Array(16),t.projMatrix,i)}function Vt(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const r=n.clone();return r.setProjection(t.projection),Ut(r,t.getProjection(),e)}function Gt(e,t,n){return t.name===n.projection.name?e.projMatrix:Ut(n,t,e)}class Ht{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ay(t,0,1);let n=1,r=this._distances[n];const i=t*this.paddedLength+this.padding;for(;r<i&&n<this._distances.length;)r=this._distances[++n];const o=n-1,s=this._distances[o],a=r-s,l=a>0?(i-s)/a:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}class $t{constructor(e,t,n){const r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}insertCircle(e,t,n,r){this._forEachCell(t-r,n-r,t+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(r)}_insertBoxCell(e,t,n,r,i,o){this.boxCells[i].push(o)}_insertCircleCell(e,t,n,r,i,o){this.circleCells[i].push(o)}_query(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];const s=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],r=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-r,y1:n-r,x2:t+r,y2:n+r})}return o?s.filter(o):s}return this._forEachCell(e,t,n,r,this._queryCell,s,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?s.length>0:s}_queryCircle(e,t,n,r,i){const o=e-n,s=e+n,a=t-n,l=t+n;if(s<0||o>this.width||l<0||a>this.height)return!r&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},i),r?c.length>0:c}query(e,t,n,r,i){return this._query(e,t,n,r,!1,i)}hitTest(e,t,n,r,i){return this._query(e,t,n,r,!0,i)}hitTestCircle(e,t,n,r){return this._queryCircle(e,t,n,!0,r)}_queryCell(e,t,n,r,i,o,s,a){const l=s.seenUids,c=this.boxCells[i];if(null!==c){const i=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=i[c+2]&&t<=i[c+3]&&n>=i[c+0]&&r>=i[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:i[c],y1:i[c+1],x2:i[c+2],y2:i[c+3]})}}}const u=this.circleCells[i];if(null!==u){const i=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(i[u],i[u+1],i[u+2],e,t,n,r)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=i[u],t=i[u+1],n=i[u+2];o.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,r,i,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[i];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[i];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,n,r,i,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(i.call(this,e,t,n,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,r,i,o){const s=r-e,a=i-t,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,n,r,i,o,s){const a=(o-r)/2,l=Math.abs(e-(r+a));if(l>a+n)return!1;const c=(s-i)/2,u=Math.abs(t-(i+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}const Wt={unknown:0,flipRequired:1,flipNotRequired:2},qt=Math.tan(85*Math.PI/180);function Xt(t,n,r,i,o,s,a){const l=e.bz();if(r)if("globe"===s.name){const t=e.bA(o,n);e.az(l,l,t)}else{const t=e.bB([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],i||e.by(l,l,o.angle)}else e.az(l,o.labelPlaneMatrix,t);return l}function Zt(e,t,n,r,i,o,s){const a=Xt(e,t,n,r,i,o,s);return"globe"===o.name&&n||(a[2]=a[6]=a[10]=a[14]=0),a}function Kt(t,n,r,i,o,s,a){if(r){if("globe"===s.name){const l=Xt(t,n,r,i,o,s,a);return e.bi(l,l),e.az(l,t,l),l}{const n=e.bw(t),r=e.bx([]);return r[0]=a[0],r[1]=a[1],r[4]=a[2],r[5]=a[3],e.az(n,n,r),i||e.by(n,n,-o.angle),n}}return o.glCoordMatrix}function Yt(t,n,r,i){const o=[t,n,r,1];r?e.aA(o,o,i):cn(o,o,i);const s=o[3];return o[0]/=s,o[1]/=s,o[2]/=s,o}function Jt(e,t){return Math.min(.5+e/t*.5,1.5)}function Qt(e,t){const n=e[0]/e[3],r=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&r>=-t[1]&&r<=t[1]}function en(t,n,r,i,o,s,a,l,c,u){const h=r.transform,d=i?t.textSizeData:t.iconSizeData,f=e.bH(d,r.transform.zoom),p="globe"===h.projection.name,m=[256/r.width*2+1,256/r.height*2+1],g=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let _=null;p&&(_=i?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,v=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=r.transform.width/r.transform.height;let b,w=!1;for(let S=0;S<v.length;S++){const i=v.get(S),{numGlyphs:p,writingMode:E}=i;if(E!==e.bI.vertical||w||b===e.bI.horizontal||(w=!0),b=E,(i.hidden||E===e.bI.vertical)&&!w){ln(p,g);continue}w=!1;const T=new e.P(i.tileAnchorX,i.tileAnchorY);let{x:A,y:C,z:P}=h.projection.projectTilePoint(T.x,T.y,u.canonical);if(c){const[e,t,n]=c(T);A+=e,C+=t,P+=n}const I=[A,C,P,1];if(e.aA(I,I,n),!Qt(I,m)){ln(p,g);continue}const k=I[3],M=Jt(r.transform.getCameraToCenterDistance(h.projection),k),R=e.bJ(d,f,i),O=a?R/M:R*M,L=Yt(A,C,P,o);if(L[3]<=0){ln(p,g);continue}let D={};const N=e.al(t.layers[0].layout.get("text-max-angle")),z=Math.cos(N),F=a?null:c,B=rn(i,O,!1,l,n,o,s,t.glyphOffsetArray,y,g,_,L,T,D,x,F,h.projection,u,a,z);w=B.useVertical,F&&B.needsFlipping&&(D={}),(B.notEnoughRoom||w||B.needsFlipping&&rn(i,O,!0,l,n,o,s,t.glyphOffsetArray,y,g,_,L,T,D,x,F,h.projection,u,a,z).notEnoughRoom)&&ln(p,g)}i?(t.text.dynamicLayoutVertexBuffer.updateData(g),_&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),_&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(_))}function tn(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g){const{lineStartIndex:_,glyphStartIndex:y,segment:v}=a,x=y+a.numGlyphs,b=_+a.lineLength,w=t.getoffsetX(y),S=t.getoffsetX(x-1),E=an(e*w,n,r,i,o,s,v,_,b,l,c,u,h,d,!0,f,p,m,g);if(!E)return null;const T=an(e*S,n,r,i,o,s,v,_,b,l,c,u,h,d,!0,f,p,m,g);return T?{first:E,last:T}:null}function nn(t,n,r,i){return t===e.bI.horizontal&&Math.abs(i)>Math.abs(r)?{useVertical:!0}:t===e.bI.vertical?i>0?{needsFlipping:!0}:null:n!==Wt.unknown&&function(e,t){return 0===e||Math.abs(t/e)>qt}(r,i)?n===Wt.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function rn(t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x){const b=n/24,w=t.lineOffsetX*b,S=t.lineOffsetY*b,{lineStartIndex:E,glyphStartIndex:T,numGlyphs:A,segment:C,writingMode:P,flipState:I}=t,k=E+t.lineLength,M=t=>{if(h){const[n,r,i]=t.up,o=u.length;e.bK(h,o+0,n,r,i),e.bK(h,o+1,n,r,i),e.bK(h,o+2,n,r,i),e.bK(h,o+3,n,r,i)}const[n,r,i]=t.point;e.bL(u,n,r,i,t.angle)};if(A>1){const e=tn(b,l,w,S,r,d,f,t,c,s,p,g,!1,_,y,v,x);if(!e)return{notEnoughRoom:!0};if(i&&!r){let[n,r,i]=e.first.point,[o,s,l]=e.last.point;[n,r]=Yt(n,r,i,a),[o,s]=Yt(o,s,l,a);const c=nn(P,I,(o-n)*m,s-r);if(t.flipState=c&&c.needsFlipping?Wt.flipRequired:Wt.flipNotRequired,c)return c}M(e.first);for(let t=T+1;t<T+A-1;t++){const e=an(b*l.getoffsetX(t),w,S,r,d,f,C,E,k,c,s,p,g,!1,!1,_,y,v,x);if(!e)return u.length-=4*(t-T),{notEnoughRoom:!0};M(e)}M(e.last)}else{if(i&&!r){const n=Yt(f.x,f.y,0,o),r=E+C+1,i=new e.P(c.getx(r),c.gety(r)),s=Yt(i.x,i.y,0,o),a=s[3]>0?s:sn(f,i,n,1,o,void 0,_,y.canonical),l=nn(P,I,(a[0]-n[0])*m,a[1]-n[1]);if(t.flipState=l&&l.needsFlipping?Wt.flipRequired:Wt.flipNotRequired,l)return l}const n=an(b*l.getoffsetX(T),w,S,r,d,f,C,E,k,c,s,p,g,!1,!1,_,y,v,x);if(!n)return{notEnoughRoom:!0};M(n)}return{}}function on(e,t,n,r,i){const{x:o,y:s,z:a}=r.projectTilePoint(e.x,e.y,t);if(!i)return Yt(o,s,a,n);const[l,c,u]=i(e);return Yt(o+l,s+c,a+u,n)}function sn(t,n,r,i,o,s,a,l){const c=on(t.sub(n)._unit()._add(t),l,o,a,s);return e.at(c,r,c),e.au(c,c),e.bE(c,r,c,i)}function an(t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v){const x=i?t-n:t+n;let b=x>0?1:-1,w=0;i&&(b*=-1,w=Math.PI),b<0&&(w+=Math.PI);let S=l+a+(b>0?0:1)|0,E=o,T=o,A=0,C=0;const P=Math.abs(x),I=[],k=[];let M=s,R=M,O=e.bC([]);const L=()=>sn(R,M,T,P-A+1,h,f,g,_.canonical);for(;A+C<=P;){if(S+=b,S<l||S>=c)return null;if(T=E,R=M,I.push(T),p&&k.push(R),M=new e.P(u.getx(S),u.gety(S)),E=d[S],!E){const e=on(M,_.canonical,h,g,f);E=e[3]>0?d[S]=e:L()}A+=C;const t=e.at([],E,T),n=e.bD(T,E);if(r&&n>0&&C>0&&e.bG(O,t)/(C*n)<v)return null;C=n,O=t}m&&f&&(d[S]&&(E=L(),C=e.bD(T,E),O=e.at([],E,T)),d[S]=E);const D=(P-A)/C,N=M.sub(R)._mult(D)._add(R),z=e.bE([],T,O,D);let F=[0,0,1],B=O[0],j=O[1];if(y&&(F=g.upVector(_.canonical,N.x,N.y),0!==F[0]||0!==F[1]||1!==F[2])){const t=[F[2],0,-F[0]],n=e.bF([],F,t);e.au(t,t),e.au(n,n),B=e.bG(O,t),j=e.bG(O,n)}if(r){const t=e.bF([],F,O);e.au(t,t),e.bE(z,z,t,r*b)}const U=w+Math.atan2(j,B);return I.push(z),p&&k.push(N),{point:z,angle:U,path:I,tilePath:k,up:F}}function ln(e,t){const n=t.length,r=n+4*e;t.resize(r),t.float32.fill(-1/0,4*n,4*r)}function cn(e,t,n){const r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}const un=100;class hn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new $t(e.width+200,e.height+200,25),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new $t(e.width+200,e.height+200,25);this.transform=e,this.grid=n,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+un,this.screenBottomBoundary=e.height+un,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(t,n,r,i,o,s,a,l,c,u,h){let d=r.projectedAnchorX,f=r.projectedAnchorY,p=r.projectedAnchorZ;const m=r.tileAnchorX,g=r.tileAnchorY,_=r.elevation,y=r.tileID,v=t.getProjection();if(_&&y){const[e,t,n]=v.upVector(y.canonical,r.tileAnchorX,r.tileAnchorY),i=v.upVectorScale(y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;d+=e*_*i,f+=t*_*i,p+=n*_*i}const x="globe"===t.projection.name,b="globe"===t.projection.name?e.ah(this.transform.zoom):0;if(y&&x&&b<1&&!s){const t=1<<y.canonical.z,n=e.bM(m,g);e.bN(n,n,1/e.aj),e.bO(n,n,e.bM(y.canonical.x,y.canonical.y)),e.bN(n,n,1/t),e.bP(n,n,e.bM(i[0],i[1])),n[0]=e.bQ(n[0],-.5,.5),e.bN(n,n,e.aj);const r=e.bR(n[0],n[1],e.aj/(2*Math.PI),1);e.aA(r,r,o),d=e.ai(d,r[0],b),f=e.ai(f,r[1],b),p=e.ai(p,r[2],b)}const w=this.projectAndGetPerspectiveRatio(u,d,f,p,r.tileID,"globe"===v.name||!!_||this.transform.pitch>0,v),S=c*w.perspectiveRatio,E=(r.x1*n+a.x-r.padding)*S+w.point.x,T=(r.y1*n+a.y-r.padding)*S+w.point.y,A=(r.x2*n+a.x+r.padding)*S+w.point.x,C=(r.y2*n+a.y+r.padding)*S+w.point.y,P=w.perspectiveRatio<=.55||w.occluded;return!this.isInsideGrid(E,T,A,C)||!l&&this.grid.hitTest(E,T,A,C,h)||P?{box:[],offscreen:!1,occluded:w.occluded}:{box:[E,T,A,C],offscreen:this.isOffscreen(E,T,A,C),occluded:!1}}placeCollisionCircles(t,n,r,i,o,s,a,l,c,u,h,d,f,p,m){const g=[],_=this.transform.elevation,y=t.getProjection(),v=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,x=new e.P(r.tileAnchorX,r.tileAnchorY);let{x:b,y:w,z:S}=y.projectTilePoint(x.x,x.y,m.canonical);if(v){const[e,t,n]=v(x);b+=e,w+=t,S+=n}const E="globe"===y.name,T=this.projectAndGetPerspectiveRatio(a,b,w,S,m,E||!!_||this.transform.pitch>0,y),{perspectiveRatio:A}=T,C=(h?s/A:s*A)/e.bU,P=Yt(b,w,S,l),I=r.lineOffsetX*C,k=r.lineOffsetY*C,M=e.al(t.layers[0].layout.get("text-max-angle")),R=Math.cos(M),O=T.signedDistanceFromCamera>0?tn(C,o,I,k,!1,P,x,r,i,l,{},_&&!h?v:null,h&&!!_,y,m,h,R):null;let L=!1,D=!1,N=!0;if(O&&!T.occluded){const t=.5*f*A+p,r=new e.P(-100,-100),i=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new Ht,{first:s,last:a}=O,l=s.path.length;let h=[];for(let e=l-1;e>=1;e--)h.push(s.path[e]);for(let e=1;e<a.path.length;e++)h.push(a.path[e]);const m=2.5*t;c&&(h=h.map((e,t)=>{let[n,r,i]=e;return v&&!E&&(i=v(t<l-1?s.tilePath[l-1-t]:a.tilePath[t-l+2])[2]),Yt(n,r,i,c)}),h.some(e=>e[3]<=0)&&(h=[]));let _=[];if(h.length>0){let t=1/0,n=-1/0,o=1/0,s=-1/0;for(const e of h)t=Math.min(t,e[0]),o=Math.min(o,e[1]),n=Math.max(n,e[0]),s=Math.max(s,e[1]);n>=r.x&&t<=i.x&&s>=r.y&&o<=i.y&&(_=[h.map(t=>new e.P(t[0],t[1]))],(t<r.x||n>i.x||o<r.y||s>i.y)&&(_=e.bS(_,r.x,r.y,i.x,i.y)))}for(const e of _){o.reset(e,.25*t);let r=0;r=o.length<=.5*t?1:Math.ceil(o.paddedLength/m)+1;for(let e=0;e<r;e++){const i=e/Math.max(r-1,1),s=o.lerp(i),a=s.x+un,l=s.y+un;g.push(a,l,t,0);const c=a-t,h=l-t,f=a+t,p=l+t;if(N=N&&this.isOffscreen(c,h,f,p),D=D||this.isInsideGrid(c,h,f,p),!n&&this.grid.hitTestCircle(a,l,t,d)&&(L=!0,!u))return{circles:[],offscreen:!1,collisionDetected:L,occluded:!1}}}}return{circles:!u&&L||!D?[]:g,offscreen:N,collisionDetected:L,occluded:T.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let r=1/0,i=1/0,o=-1/0,s=-1/0;for(const u of t){const t=new e.P(u.x+un,u.y+un);r=Math.min(r,t.x),i=Math.min(i,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),n.push(t)}const a=this.grid.query(r,i,o,s).concat(this.ignoredGrid.query(r,i,o,s)),l={},c={};for(const u of a){const t=u.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const r=[new e.P(u.x1,u.y1),new e.P(u.x2,u.y1),new e.P(u.x2,u.y2),new e.P(u.x1,u.y2)];e.bT(n,r)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,n,r,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,r,i){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:n,featureIndex:r,collisionGroupID:i};for(let a=0;a<e.length;a+=4)o.insertCircle(s,e[a],e[a+1],e[a+2])}projectAndGetPerspectiveRatio(t,n,r,i,o,s,a){const l=[n,r,i,1];let c=!1;if(i||this.transform.pitch>0){if(e.aA(l,l,t),this.fogState&&o&&"globe"!==a.name){const t=function(t,n,r,i,o,s){const a=s.calculateFogTileMatrix(o),l=[n,r,i];return e.ad(l,l,a),ze(t,e.ae(l),s.pitch,s._fov)}(this.fogState,n,r,i,o.toUnwrapped(),this.transform);c=t>.9}}else cn(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+un,(-l[1]/u+1)/2*this.transform.height+un),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(e,t,n,r){return n<un||e>=this.screenRightBoundary||r<un||t>this.screenBottomBoundary}isInsideGrid(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.bx([]);return e.bo(t,t,[-100,-100,0]),t}}class dn{constructor(e,t,n,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class fn{constructor(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new dn(e?e.text:null,t,n,i),this.icon=new dn(e?e.icon:null,t,r,i),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class pn{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=n,this.clipped=r}}class mn{constructor(){this.invProjMatrix=e.bz(),this.viewportMatrix=e.bz(),this.circles=[]}}class gn{constructor(e,t,n,r,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i}}class _n{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function yn(t,n,r,i,o){const{horizontalAlign:s,verticalAlign:a}=e.bZ(t),l=-(s-.5)*n,c=-(a-.5)*r,u=e.b_(t,i);return new e.P(l+u[0]*o,c+u[1]*o)}function vn(t,n,r,i,o){const s=new e.P(t,n);return r&&s._rotate(i?o:-o),s}class xn{constructor(e,t,n,r,i,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new hn(this.transform,i),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new _n(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=r.getBucket(n),a=r.latestFeatureIndex;if(!s||!a||n.fqid!==s.layerIds[0])return;const l=s.layers[0].layout,c=s.layers[0].paint,u=r.collisionBoxArray,h=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),d=r.tileSize/e.aj,f=r.tileID.toUnwrapped();this.transform.setProjection(s.projection);const p=(m=r.tileID,g=s.getProjection(),_=this.transform,g.name===this.projection?_.calculateProjMatrix(m.toUnwrapped()):Ut(_,g,m));var m,g,_;const y="map"===l.get("text-pitch-alignment"),v="map"===l.get("text-rotation-alignment");n.compileFilter(n.options);const x=n.dynamicFilter(),b=n.dynamicFilterNeedsFeature(),w=this.transform.calculatePixelsToTileUnitsMatrix(r),S=Zt(p,r.tileID.canonical,y,v,this.transform,s.getProjection(),w);let E=null;const T=s.getProjection().createInversionMatrix(this.transform,r.tileID.canonical);if(y){const t=Kt(p,r.tileID.canonical,y,v,this.transform,s.getProjection(),w);E=e.az([],this.transform.labelPlaneMatrix,t)}let A=null;x&&r.latestFeatureIndex&&(A={unwrappedTileID:f,dynamicFilter:x,dynamicFilterNeedsFeature:b}),this.retainedQueryData[s.bucketInstanceId]=new gn(s.bucketInstanceId,a,s.sourceLayerIndex,s.index,r.tileID);const[C,P]=s.layers[0].layout.get("text-size-scale-range"),I=e.ay(o,C,P),[k,M]=l.get("icon-size-scale-range"),R=e.ay(o,k,M),O={bucket:s,layout:l,paint:c,posMatrix:p,invMatrix:T,mercatorCenter:[e.aD(this.transform.center.lng),e.aH(this.transform.center.lat)],textLabelPlaneMatrix:S,labelToScreenMatrix:E,clippingData:A,scale:h,textPixelRatio:d,holdingForFade:r.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:e.bH(s.textSizeData,this.transform.zoom,I),partiallyEvaluatedIconSize:e.bH(s.iconSizeData,this.transform.zoom,R),collisionGroup:this.collisionGroups.get(s.sourceID),latestFeatureIndex:r.latestFeatureIndex};if(i)for(const e of s.sortKeyRanges){const{sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i}=e;t.push({sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i,parameters:O})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:O})}attemptAnchorPlacement(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x){const{textOffset0:b,textOffset1:w,crossTileID:S}=p,E=[b,w],T=yn(e,o,s,E,a),A=this.collisionIndex.placeCollisionBox(g,a,t,n,r,i,vn(T.x,T.y,l,c,this.transform.angle),f,u,h,d.predicate);if(y){const e=g.getSymbolInstanceIconSize(x,this.transform.zoom,p.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(g,e,y,n,r,i,vn(T.x,T.y,l,c,this.transform.angle),f,u,h,d.predicate).box.length)return}if(A.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[S]&&this.prevPlacement.placements[S]&&this.prevPlacement.placements[S].text&&(t=this.prevPlacement.variableOffsets[S].anchor),this.variableOffsets[S]={textOffset:E,width:o,height:s,anchor:e,textScale:a,prevAnchor:t},this.markUsedJustification(g,e,p,_),g.allowVerticalPlacement&&(this.markUsedOrientation(g,_,p),this.placedOrientations[S]=_),{shift:T,placedGlyphBoxes:A}}}placeLayerBucketPart(t,n,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{bucket:s,layout:a,paint:l,posMatrix:c,textLabelPlaneMatrix:u,labelToScreenMatrix:h,clippingData:d,textPixelRatio:f,mercatorCenter:p,invMatrix:m,holdingForFade:g,collisionBoxArray:_,partiallyEvaluatedTextSize:y,partiallyEvaluatedIconSize:v,collisionGroup:x,latestFeatureIndex:b}=t.parameters,w=a.get("text-optional"),S=a.get("icon-optional"),E=a.get("text-allow-overlap"),T=a.get("icon-allow-overlap"),A="map"===a.get("text-rotation-alignment"),C="map"===a.get("icon-rotation-alignment"),P="map"===a.get("text-pitch-alignment"),I=l.get("symbol-z-offset"),k="sea"===a.get("symbol-elevation-reference"),M=a.get("symbol-placement"),[R,O]=a.get("text-size-scale-range"),[L,D]=a.get("icon-size-scale-range"),N=e.ay(o,R,O),z=e.ay(o,L,D),F=a.get("text-variable-anchor"),B=A&&"point"!==M,j=C&&"point"!==M,U=F&&s.hasTextData(),V=s.hasIconTextFit()&&U&&s.hasIconData();this.transform.setProjection(s.projection);const G=U||B,H=j||V;let $=E&&(T||!s.hasIconData()||S),W=T&&(E||!s.hasTextData()||w);const q=!I.isConstant();!s.collisionArrays&&_&&s.deserializeCollisionBoxes(_),r&&i&&s.updateCollisionDebugBuffers(this.transform.zoom,_,N,z);const X=(t,i,l)=>{const{crossTileID:_,numVerticalGlyphVertices:C}=t;let M=null;if(d&&d.dynamicFilterNeedsFeature||q){const e=this.retainedQueryData[s.bucketInstanceId];M=b.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(d&&!(0,d.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},M,this.retainedQueryData[s.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(d.unwrappedTileID)))return this.placements[_]=new pn(!1,!1,!1,!0),void n.add(_);const R=I.evaluate(M,{});if(n.has(_))return;if(g)return void(this.placements[_]=new pn(!1,!1,!1));let O=!1,L=!1,D=!0,N=!1,z=!1,B=null,j={box:null,offscreen:null,occluded:null},U={box:null},V=null,X=null,Z=null,K=0,Y=0,J=0;l.textFeatureIndex?K=l.textFeatureIndex:t.useRuntimeCollisionCircles&&(K=t.featureIndex),l.verticalTextFeatureIndex&&(Y=l.verticalTextFeatureIndex);const Q=e=>{e.tileID=this.retainedQueryData[s.bucketInstanceId].tileID;const n=this.transform.elevation;e.elevation=k?R:R+(n?n.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0),e.elevation+=t.zOffset},ee=l.textBox;if(ee){Q(ee);const n=n=>{let r=e.bI.horizontal;if(s.allowVerticalPlacement&&!n&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[_];e&&(this.placedOrientations[_]=e,r=e,this.markUsedOrientation(s,r,t))}return r},r=(t,n)=>{if(s.allowVerticalPlacement&&C>0&&l.verticalTextBox){for(const r of s.writingModes)if(r===e.bI.vertical?(j=n(),U=j):j=t(),j&&j.box&&j.box.length)break}else j=t()};if(F){let o=F;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_]){const e=this.prevPlacement.variableOffsets[_];o.indexOf(e.anchor)>0&&(o=o.filter(t=>t!==e.anchor),o.unshift(e.anchor))}const a=(e,n,r)=>{const a=s.getSymbolInstanceTextSize(y,t,this.transform.zoom,i),l=(e.x2-e.x1)*a+2*e.padding,u=(e.y2-e.y1)*a+2*e.padding,h=t.hasIconTextFit&&!T?n:null;h&&Q(h);let d={box:[],offscreen:!1,occluded:!1};const g=E?2*o.length:o.length;for(let _=0;_<g;++_){const n=this.attemptAnchorPlacement(o[_%o.length],e,p,m,G,l,u,a,A,P,f,c,x,_>=o.length,t,i,s,r,h,y,v);if(n&&(d=n.placedGlyphBoxes,d&&d.box&&d.box.length)){O=!0,B=n.shift;break}}return d};r(()=>a(ee,l.iconBox,e.bI.horizontal),()=>{const t=l.verticalTextBox;return t&&Q(t),s.allowVerticalPlacement&&!(j&&j.box&&j.box.length)&&C>0&&t?a(t,l.verticalIconBox,e.bI.vertical):{box:null,offscreen:null,occluded:null}}),j&&(O=j.box,D=j.offscreen,N=j.occluded);const u=n(!(!j||!j.box));if(!O&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[_];e&&(this.variableOffsets[_]=e,this.markUsedJustification(s,e.anchor,t,u))}}else{const a=(n,r)=>{const a=s.getSymbolInstanceTextSize(y,t,this.transform.zoom,i,o),l=this.collisionIndex.placeCollisionBox(s,a,n,p,m,G,new e.P(0,0),E,f,c,x.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(s,r,t),this.placedOrientations[_]=r),l};r(()=>a(ee,e.bI.horizontal),()=>{const t=l.verticalTextBox;return s.allowVerticalPlacement&&C>0&&t?(Q(t),a(t,e.bI.vertical)):{box:null,offscreen:null,occluded:null}}),n(!!(j&&j.box&&j.box.length))}}if(V=j,O=V&&V.box&&V.box.length>0,D=V&&V.offscreen,N=V&&V.occluded,t.useRuntimeCollisionCircles){const n=s.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),i=e.bJ(s.textSizeData,y,n),o=a.get("text-padding");X=this.collisionIndex.placeCollisionCircles(s,E,n,s.lineVertexArray,s.glyphOffsetArray,i,c,u,h,r,P,x.predicate,t.collisionCircleDiameter*i/e.bU,o,this.retainedQueryData[s.bucketInstanceId].tileID),O=E||X.circles.length>0&&!X.collisionDetected,D=D&&X.offscreen,N=X.occluded}if(l.iconFeatureIndex&&(J=l.iconFeatureIndex),l.iconBox){const n=n=>{Q(n);const r=t.hasIconTextFit&&B?vn(B.x,B.y,A,P,this.transform.angle):new e.P(0,0),i=s.getSymbolInstanceIconSize(v,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(s,i,n,p,m,H,r,T,f,c,x.predicate)};U&&U.box&&U.box.length&&l.verticalIconBox?(Z=n(l.verticalIconBox),L=Z.box.length>0):(Z=n(l.iconBox),L=Z.box.length>0),D=D&&Z.offscreen,z=Z.occluded}const te=w||0===t.numHorizontalGlyphVertices&&0===C,ne=S||0===t.numIconVertices;if(te||ne?ne?te||(L=L&&O):O=L&&O:L=O=L&&O,O&&V&&V.box&&this.collisionIndex.insertCollisionBox(V.box,a.get("text-ignore-placement"),s.bucketInstanceId,U&&U.box&&Y?Y:K,x.ID),L&&Z&&this.collisionIndex.insertCollisionBox(Z.box,a.get("icon-ignore-placement"),s.bucketInstanceId,J,x.ID),X&&(O&&this.collisionIndex.insertCollisionCircles(X.circles,a.get("text-ignore-placement"),s.bucketInstanceId,K,x.ID),r)){const e=s.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new mn);for(let n=0;n<X.circles.length;n+=4)t.circles.push(X.circles[n+0]),t.circles.push(X.circles[n+1]),t.circles.push(X.circles[n+2]),t.circles.push(X.collisionDetected?1:0)}const re="globe"!==s.projection.name;$=$&&(re||!N),W=W&&(re||!z),this.placements[_]=new pn(O||$,L||W,D||s.justReloaded),n.add(_)},Z=this.retainedQueryData[s.bucketInstanceId].tileID;if("offset"===s.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(s,Z),"road"===s.elevationType&&s.updateRoadElevation(Z.canonical),s.updateZOffset(),s.sortFeaturesByY){const t=s.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];X(s.symbolInstances.get(n),n,s.collisionArrays[n])}s.hasAnyZOffset&&e.w(`${s.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(s.hasAnyZOffset){const e=s.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const n=e[t];X(s.symbolInstances.get(n),n,s.collisionArrays[n])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)X(s.symbolInstances.get(e),e,s.collisionArrays[e]);if(r&&s.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[s.bucketInstanceId];e.bi(t.invProjMatrix,c),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(t,n,r,i){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=r,u=e.b$(n),h=i===e.bI.vertical?l:"left"===u?o:"center"===u?s:"right"===u?a:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(t,n,r){const i=n===e.bI.horizontal||n===e.bI.horizontalOnly?n:0,o=n===e.bI.vertical?n:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,u=t.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=i),a>=0&&(u.get(a).placedOrientation=i),l>=0&&(u.get(l).placedOrientation=i),c>=0&&(u.get(c).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const a in this.placements){const e=this.placements[a],t=i[a];t?(this.opacities[a]=new fn(t,r,e.text,e.icon,null,e.clipped),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[a]=new fn(null,r,e.text,e.icon,e.skipFade,e.clipped),n=n||e.text||e.icon)}for(const a in i){const e=i[a];if(!this.opacities[a]){const t=new fn(e,r,!1,!1);t.isHidden()||(this.opacities[a]=t,n=n||e.text.placed||e.icon.placed)}}for(const a in o)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=o[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t,n,r){const i=new Set;for(const o of t){const t=o.getBucket(e);t&&o.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,i,o,o.collisionBoxArray,n,r,o.tileID,e.scope),"offset"===t.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(t,o.tileID),"road"===t.elevationType&&t.updateRoadElevation(o.tileID.canonical),t.updateZOffset())}}updateBucketOpacities(t,n,r,i,o,s,a,l){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0].layout,u=t.layers[0].paint,h=!!t.layers[0].dynamicFilter(),d=new fn(null,0,!1,!1,!0),f=c.get("text-allow-overlap"),p=c.get("icon-allow-overlap"),m=c.get("text-variable-anchor"),g="map"===c.get("text-rotation-alignment"),_="map"===c.get("text-pitch-alignment"),y=u.get("symbol-z-offset"),v="sea"===c.get("symbol-elevation-reference"),x=!y.isConstant(),b=new fn(null,0,f&&(p||!t.hasIconData()||c.get("icon-optional")),p&&(f||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const w=(e,t,n)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(n)};let S=0;s&&t.updateReplacement(a,s);for(let E=0;E<t.symbolInstances.length;E++){const i=t.symbolInstances.get(E),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:u,crossTileID:f,numIconVertices:p,tileAnchorX:T,tileAnchorY:A}=i;let C=null;const P=this.retainedQueryData[t.bucketInstanceId];x&&i&&P&&(C=r.latestFeatureIndex.loadFeature({featureIndex:i.featureIndex,bucketIndex:P.bucketIndex,sourceLayerIndex:P.sourceLayerIndex,layoutVertexArrayOffset:0}));const I=y.evaluate(C,{}),k=n.has(f);let M=this.opacities[f];k?M=d:M||(M=b,this.opacities[f]=M),n.add(f);const R=c>0||u>0,O=p>0,L=this.placedOrientations[f],D=L===e.bI.vertical,N=L===e.bI.horizontal||L===e.bI.horizontalOnly;!R&&!O||M.isHidden()||S++;let z=!1;if((R||O)&&s)for(const n of t.activeReplacements){if(e.bV(n,o,e.bW.Symbol,l))continue;if(n.min.x>T||T>n.max.x||n.min.y>A||A>n.max.y)continue;const t=e.bX(T,A,a.canonical,n.footprintTileId.canonical);if(z=e.bY(t,n.footprint),z)break}if(R){const e=z?kn:In(M.text);w(t.text,c,D?kn:e),w(t.text,u,N?kn:e);const n=M.text.isHidden(),{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a}=i,l=t.text.placedSymbolArray,h=n||D?1:0;r>=0&&(l.get(r).hidden=h),o>=0&&(l.get(o).hidden=h),s>=0&&(l.get(s).hidden=h),a>=0&&(l.get(a).hidden=n||N?1:0);const d=this.variableOffsets[f];d&&this.markUsedJustification(t,d.anchor,i,L);const p=this.placedOrientations[f];p&&(this.markUsedJustification(t,"left",i,p),this.markUsedOrientation(t,p,i))}if(O){const e=z?kn:In(M.icon),{placedIconSymbolIndex:n,verticalPlacedIconSymbolIndex:r}=i,o=t.icon.placedSymbolArray,s=M.icon.isHidden()?1:0;n>=0&&(w(t.icon,p,D?kn:e),o.get(n).hidden=s),r>=0&&(w(t.icon,i.numVerticalIconVertices,N?kn:e),o.get(r).hidden=s)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[E];if(n){let r=new e.P(0,0),o=!0;if(n.textBox||n.verticalTextBox){if(m){const e=this.variableOffsets[f];e?(r=yn(e.anchor,e.width,e.height,e.textOffset,e.textScale),g&&r._rotate(_?this.transform.angle:-this.transform.angle)):o=!1}h&&(o=!M.clipped),n.textBox&&bn(t.textCollisionBox.collisionVertexArray,M.text.placed,!o||D,I,v,r.x,r.y),n.verticalTextBox&&bn(t.textCollisionBox.collisionVertexArray,M.text.placed,!o||N,I,v,r.x,r.y)}const s=o&&Boolean(!N&&n.verticalIconBox);n.iconBox&&bn(t.iconCollisionBox.collisionVertexArray,M.icon.placed,s,I,v,i.hasIconTextFit?r.x:0,i.hasIconTextFit?r.y:0),n.verticalIconBox&&bn(t.iconCollisionBox.collisionVertexArray,M.icon.placed,!s,I,v,i.hasIconTextFit?r.x:0,i.hasIconTextFit?r.y:0)}}}if(t.fullyClipped=0===S,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function bn(e,t,n,r,i,o,s){e.emplaceBack(t?1:0,n?1:0,o||0,s||0,r,i?1:0),e.emplaceBack(t?1:0,n?1:0,o||0,s||0,r,i?1:0),e.emplaceBack(t?1:0,n?1:0,o||0,s||0,r,i?1:0),e.emplaceBack(t?1:0,n?1:0,o||0,s||0,r,i?1:0)}const wn=Math.pow(2,25),Sn=Math.pow(2,24),En=Math.pow(2,17),Tn=Math.pow(2,16),An=Math.pow(2,9),Cn=Math.pow(2,8),Pn=Math.pow(2,1);function In(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*wn+t*Sn+n*En+t*Tn+n*An+t*Cn+n*Pn+t}const kn=0;class Mn{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,n,r,i,o){const s=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(s,r,e[this._currentTileIndex],this._sortAcrossTiles,o),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<s.length;){const e=s[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,n,0===e.symbolInstanceStart,o),this._currentPartIndex++,i())return!0}return!1}}class Rn{constructor(e,t,n,r,i,o,s,a,l){this.placement=new xn(e,i,o,s,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,n,r,i,o){const s=e.q.now(),a=()=>{const t=e.q.now()-s;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const s=n[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){const t=s,n=t.layout.get("symbol-z-elevate"),l=void 0!==t.layout.get("symbol-sort-key").constantOr(1),c=t.layout.get("symbol-z-order"),u="viewport-y"===c||"auto"===c&&!("viewport-y"!==c&&l),h=t.layout.get("text-allow-overlap")||t.layout.get("icon-allow-overlap")||t.layout.get("text-ignore-placement")||t.layout.get("icon-ignore-placement"),d=u&&h,f=this._inProgressLayer=this._inProgressLayer||new Mn(t),p=e.C(s.source,s.scope);if(f.continuePlacement(n||d?i[p]:r[p],this.placement,this._showCollisionBoxes,s,a,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const On=512/e.aj/2;class Ln{constructor(t,n,r){this.tileID=t,this.bucketInstanceId=r,this.index=new e.c0(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const i=t.canonical.x*e.aj,o=t.canonical.y*e.aj;for(let e=0;e<n.length;e++){const{key:t,crossTileID:r,tileAnchorX:s,tileAnchorY:a}=n.get(e),l=Math.floor((i+s)*On),c=Math.floor((o+a)*On);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(r)}this.index.finish()}findMatches(t,n,r){const i=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),o=On/Math.pow(2,n.canonical.z-this.tileID.canonical.z),s=n.canonical.x*e.aj,a=n.canonical.y*e.aj;for(let e=0;e<t.length;e++){const n=t.get(e);if(n.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=n,h=Math.floor((s+c)*o),d=Math.floor((a+u)*o),f=this.index.range(h-i,d-i,h+i,d+i).sort((e,t)=>e-t);for(const e of f){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!r.has(t)){r.add(t),n.crossTileID=t;break}}}}}class Dn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Nn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],r={};for(const n in e){const i=e[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),r[i.tileID.key]=i}this.indexes[n]=r}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let i=0;i<t.symbolInstances.length;i++)t.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{const o=n[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,r)}}for(let i=0;i<t.symbolInstances.length;i++){const e=t.symbolInstances.get(i);e.crossTileID||(e.crossTileID=n.generate(),r.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ln(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.crossTileIDs)this.usedCrossTileIDs[e].delete(n)}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const r=this.indexes[n];for(const i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t}}class zn{constructor(){this.layerIndexes={},this.crossTileIDs=new Dn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n,r){let i=this.layerIndexes[e.fqid];void 0===i&&(i=this.layerIndexes[e.fqid]=new Nn);let o=!1;const s={};"globe"!==r.name&&i.handleWrapJump(n);for(const a of t){const t=a.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(a.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}const Fn=771;class Bn{constructor(e,t,n,r){this.blendFunction=e,this.blendColor=t.toNonPremultipliedRenderColor(null),this.mask=n,this.blendEquation=r}}Bn.Replace=[1,0,1,0],Bn.disabled=new Bn(Bn.Replace,e.am.transparent,[!1,!1,!1,!1]),Bn.unblended=new Bn(Bn.Replace,e.am.transparent,[!0,!0,!0,!0]),Bn.alphaBlended=new Bn([1,Fn,1,Fn],e.am.transparent,[!0,!0,!0,!0]),Bn.alphaBlendedNonPremultiplied=new Bn([770,Fn,770,Fn],e.am.transparent,[!0,!0,!0,!0]),Bn.multiply=new Bn([774,0,774,0],e.am.transparent,[!0,!0,!0,!0]);class jn{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}jn.ReadOnly=!1,jn.ReadWrite=!0,jn.disabled=new jn(519,jn.ReadOnly,[0,1]);const Un=7680;class Vn{constructor(e,t,n,r,i,o){this.test=e,this.ref=t,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o}}Vn.disabled=new Vn({func:519,mask:0},0,0,Un,Un,Un);const Gn=1029,Hn=2305;class $n{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}function Wn(t,n){const r=e.c6(t,3);e.c8(t,n),e.cc(t,3,r)}function qn(t,n){const r=e.c3([]);return e.c4(r,r,-n),e.c5(r,r,-t),r}function Xn(t,n){const r=[t[0],t[1],0],i=[n[0],n[1],0];if(e.ae(r)>=1e-15){const t=e.au([],r);e.c1(i,t,e.bG(i,t)),n[0]=i[0],n[1]=i[1]}const o=e.bF([],n,t);if(e.c2(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return qn(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}$n.disabled=new $n(!1,Gn,Hn),$n.backCCW=new $n(!0,Gn,Hn),$n.backCW=new $n(!0,Gn,2304),$n.frontCW=new $n(!0,1028,2304),$n.frontCCW=new $n(!0,1028,Hn);class Zn{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const n=t instanceof e.ac?t:new e.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=e.bQ(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const r=this.position,i=this._elevation?this._elevation.getAtPointOrZero(e.ac.fromLngLat(t)):0,o=e.ac.fromLngLat(t,i),s=[o.x-r.x,o.y-r.y,o.z-r.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Xn(s,n)}setPitchBearing(t,n){this.orientation=qn(e.al(t),e.al(-n))}}class Kn{constructor(t,n){this._transform=e.bx([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new e.ac(t[0],t[1],t[2])}get position(){const t=e.c6(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&e.cc(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.c3([]),t&&Wn(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=qn(e,t),Wn(this._transform,this._orientation)}forward(){const t=e.c6(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.c6(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.c6(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const r=new Float64Array(16);return e.bi(r,this.getWorldToCamera(t,n)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,r){const i=this.position;e.c1(i,i,-t);const o=new Float64Array(16);return e.bn(o,[r,r,r]),e.bo(o,o,i),o[10]*=n,o}getWorldToCamera(t,n){const r=new Float64Array(16),i=new Float64Array(4),o=this.position;return e.c7(i,this._orientation),e.c1(o,o,-t),e.c8(r,i),e.bo(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=n,r[9]*=n,r[10]*=n,r[11]*=n,r}getCameraToClipPerspective(t,n,r,i){const o=new Float64Array(16);return e.c9(o,t,n,r,i),o}getCameraToClipOrthographic(t,n,r,i,o,s){const a=new Float64Array(16);return e.ca(a,t,n,r,i,o,s),a}getDistanceToElevation(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=0===t?0:e.cb(t,n?e.aY(this.position[1]):this.position[1]),i=this.forward();return(r-this.position[2])/i[2]}clone(){return new Kn([...this.position],[...this.orientation])}}const Yn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Jn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=r}interpolate(t,n,r){return null!=n.top&&null!=t.top&&(this.top=e.ai(t.top,n.top,r)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.ai(t.bottom,n.bottom,r)),null!=n.left&&null!=t.left&&(this.left=e.ai(t.left,n.left,r)),null!=n.right&&null!=t.right&&(this.right=e.ai(t.right,n.right,r)),this}getCenter(t,n){const r=e.ay((this.left+t-this.right)/2,0,t),i=e.ay((this.top+n-this.bottom)/2,0,n);return new e.P(r,i)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Jn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Qn=15;class er{constructor(t,n,r,i,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=r??0,this._maxPitch=i??60,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Jn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Kn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const e=new er(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e._allowWorldUnderZoom=this._allowWorldUnderZoom,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<Qn}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||n)&&this._updateCameraOnTerrain(),(e||n)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=e.cj(this.projectionOptions);const r=this.getProjection(),i=!e.bv(n,r);return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.cj({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bQ(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=e.ck(),e.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=e.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&n.exaggeration()&&this._centerAltitudeValidForExaggeration!==n.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*n.exaggeration(),this._centerAltitudeValidForExaggeration=n.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=n.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(void 0===this._centerAltitudeValidForExaggeration)return;const e=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(e)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let i=0,o=0;for(let s=0;s<n.length;s++){const a=new e.P(n[s][0]*this.width,r+n[s][1]*(this.height-r)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);i+=l[3]*c,o+=c}return 0===o?NaN:i/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*t,r=this._mercatorZfromZoom(e),i=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-n,i);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const i=e.ae(e.at([],this._camera.position,r));return e.ay(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!e.cm(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];e.cn(r,this._camera.position)||(this._setCameraPosition(r),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new Zn;return n.position=new e.ac(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!e.co(t))return!1;e.cp(t,t);const n=e.cq([],[0,0,-1],t),r=e.cq([],[0,-1,0],t);if(r[2]<0)return!1;const i=Xn(n,r);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;t[2]=e.ay(t[2],i/r,i/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const n=[new e.cr(0,t)];if(this.renderWorldCopies){const r=this.pointCoordinate(new e.P(0,0)),i=this.pointCoordinate(new e.P(this.width,0)),o=this.pointCoordinate(new e.P(this.width,this.height)),s=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(r.x,i.x,o.x,s.x)),l=Math.floor(Math.max(r.x,i.x,o.x,s.x)),c=1;for(let u=a-c;u<=l+c;u++)0!==u&&n.push(new e.cr(u,t))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,r){let i=[];const o=null!=r,s=!o;if(s&&this.zoom<n)return i;if(o&&0===r[0]&&0===r[1])return i;const a=new Set,l=(t,n,r,o,s)=>{const l=e.cV(n,t,r,o,s);a.has(l)||(i.push(new e.aM(t,n,r,o,s)),a.add(l))};for(let e=0;e<t.length;e++){const i=t[e];if(s&&i.canonical.z!==n)continue;const a=i.canonical,c=i.overscaledZ,u=i.wrap,h=1<<a.z,d=a.x+1<h,f=a.x>0,p=a.y+1<h,m=a.y>0,g=i.wrap-(f?0:1),_=i.wrap+(d?0:1),y=f?a.x-1:h-1,v=d?a.x+1:0;if(o)r[0]<0?(l(c,_,a.z,v,a.y),r[1]<0&&p&&(l(c,u,a.z,a.x,a.y+1),l(c,_,a.z,v,a.y+1)),r[1]>0&&m&&(l(c,u,a.z,a.x,a.y-1),l(c,_,a.z,v,a.y-1))):r[0]>0?(l(c,g,a.z,y,a.y),r[1]<0&&p&&(l(c,u,a.z,a.x,a.y+1),l(c,g,a.z,y,a.y+1)),r[1]>0&&m&&(l(c,u,a.z,a.x,a.y-1),l(c,g,a.z,y,a.y-1))):r[1]<0&&p?l(c,u,a.z,a.x,a.y+1):m&&l(c,u,a.z,a.x,a.y-1);else{const e=i.visibleQuadrants;1&e&&(l(c,g,a.z,y,a.y),m&&(l(c,u,a.z,a.x,a.y-1),l(c,g,a.z,y,a.y-1))),2&e&&(l(c,_,a.z,v,a.y),m&&(l(c,u,a.z,a.x,a.y-1),l(c,_,a.z,v,a.y-1))),4&e&&(l(c,g,a.z,y,a.y),p&&(l(c,u,a.z,a.x,a.y+1),l(c,g,a.z,y,a.y+1))),8&e&&(l(c,_,a.z,v,a.y),p&&(l(c,u,a.z,a.x,a.y+1),l(c,_,a.z,v,a.y+1)))}}const c=[];for(const e of i)i.some(t=>e.isChildOf(t))||c.push(e);if(i=c.filter(e=>!t.some(t=>!!(e.overscaledZ<n&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))),s){const e=1<<n,t="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),r=[e*t.x,e*t.y],o=4,s=o*o;i=i.filter(e=>{const t=e.canonical.x+.5-r[0],n=e.canonical.y+.5-r[1];return t*t+n*n<s})}return i}extendTileCoverToNearPlane(t,n,r){const i=[],o=new Set;for(const e of t)o.add(e.key);const s=(t,n,r,s,a)=>{const l=e.cV(n,t,r,s,a);o.has(l)||(i.push(new e.aM(t,n,r,s,a)),o.add(l))},a=t.reduce((e,t)=>Math.max(e,t.overscaledZ),r),l=1<<r,c=[new e.P(0,0),new e.P(e.aj,0),new e.P(e.aj,e.aj),new e.P(0,e.aj)],u=new e.P(0,0),h=new e.P(0,0),d=(t,n)=>{const i=Math.floor(t[0]),o=Math.floor(t[1]),d=(t[0]-i)*e.aj,f=(t[1]-o)*e.aj,p=Math.floor(n[0]),m=Math.floor(n[1]),g=(n[0]-p)*e.aj,_=(n[1]-m)*e.aj;for(let y=-1;y<=1;y++){const t=i+y;if(!(t<0||t>=l)){u.x=d-y*e.aj,h.x=g-(t-p)*e.aj;for(let n=-1;n<=1;n++){const i=o+n;u.y=f-n*e.aj,h.y=_-(i-m)*e.aj,e.cW(u,h,c)&&s(a,0,r,t,i)}}}},f=n.points,p=f[e.cs],m=f[e.ct],g=this._projectToGround(p,f[e.cu]),_=this._projectToGround(m,f[e.cv]);return d(p,g),d(m,_),i}_projectToGround(t,n){return e.cw(e.cx(),t,n,t[2]/(t[2]-n[2]))}coveringTiles(t){let n=this.coveringZoomLevel(t);const r=n,i=this.elevation&&this.elevation.exaggeration(),o=i&&!t.isTerrainDEM,s="mercator"===this.projection.name;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<n,u=[c*a.x,c*a.y,0],h="globe"===this.projection.name,d=!h,f=e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,d),p=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*e.cb(1,this.center.lat),g=this._camera.position[2]/e.cb(1,this.center.lat),_=[c*p.x,c*p.y,g*(d?1:m)],y=h||i,v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),x=this.isLODDisabled(!0)?n:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,S=this.projection.isReprojectedInTileSpace?e.cz(this):1,E=t=>{const n=1/4e4,r=new e.ac(t.x+n,t.y,t.z),i=new e.ac(t.x,t.y+n,t.z),o=t.toLngLat(),s=r.toLngLat(),a=i.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*S/n},T=t=>{const n=b,r=w;return{aabb:e.cC(this,c,0,0,0,t,r,n,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:n,wrap:t,fullyVisible:!1}},A=[];let C=[];const P=n,I=t.reparseOverscaled?r:n,k=(g-this._centerAltitude)*m,M=e=>{if(!this._elevation||!e.tileID||!s)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=O(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},R=(e,t)=>{if(.707*t<e)return 1;const n=t/e;return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)},O=t=>{if(t.zoom<x)return!0;if(t.zoom===P)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const n=t.aabb.distanceX(_),i=t.aabb.distanceY(_);let a=k,c=1;if(h){a=t.aabb.distanceZ(_);const n=Math.pow(2,t.zoom),r=e.aY((t.y+1)/n),i=e.aY(t.y/n),o=Math.min(Math.max(l,r),i),s=e.c_(o)/e.c_(l);if(c=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,s/this._mercatorScaleRatio),this.zoom<=e.cX&&t.zoom===P-1&&s>=.9)return!0}else if(o&&(a=t.aabb.distanceZ(_)*m),this.projection.isReprojectedInTileSpace&&r<=5){const n=Math.pow(2,t.zoom),r=E(new e.ac((t.x+.5)/n,(t.y+.5)/n));c=r>.85?1:r}if(!s){const e=Math.sqrt(n*n+i*i+a*a);let r=(1<<P-t.zoom)*v*c;return r*=R(Math.max(a,k),e),e<r}let d=Number.MAX_VALUE,f=0;const p=t.aabb.getCorners(),g=[];for(const r of p){e.at(g,r,_),h||(o?g[2]*=m:g[2]=k);const t=e.bG(g,this._camera.forward());t<d&&(d=t,f=Math.abs(g[2]))}let y=(1<<P-t.zoom)*v*c;if(y*=R(Math.max(f,k),d),d<y)return!0;const b=t.aabb.closestPoint(u);return b[0]===u[0]&&b[1]===u[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)A.push(T(-e)),A.push(T(e));for(A.push(T(0));A.length>0;){const r=A.pop(),i=r.x,a=r.y;let l=r.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===r.y||r.y===(1<<r.zoom)-1);if(!l){let t=y?r.aabb.intersects(f):r.aabb.intersectsFlat(f);if(0===t&&d()){const n=new e.cA(r.zoom,i,a);t=e.cB(this,c,n,!0).intersects(f)}if(0===t)continue;l=2===t}if(r.zoom!==P&&O(r))for(let t=0;t<4;t++){const n=(i<<1)+t%2,u=(a<<1)+(t>>1),d={aabb:s?r.aabb.quadrant(t):e.cC(this,c,r.zoom+1,n,u,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:n,y:u,wrap:r.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};o&&!h&&(d.tileID=new e.aM(r.zoom+1===P?I:r.zoom+1,r.wrap,r.zoom+1,n,u),M(d)),A.push(d)}else{const o=r.zoom===P?I:r.zoom;if(t.minzoom&&t.minzoom>o)continue;let s=0;if(!l){let n=y?r.aabb.intersectsPrecise(f):r.aabb.intersectsPreciseFlat(f);if(0===n&&d()){const t=new e.cA(r.zoom,i,a);n=e.cB(this,c,t,!0).intersectsPrecise(f)}if(0===n)continue;if(t.calculateQuadrantVisibility)if(f.containsPoint(r.aabb.center))s=15;else for(let e=0;e<4;e++)0!==r.aabb.quadrant(e).intersects(f)&&(s|=1<<e)}const h=u[0]-(.5+i+(r.wrap<<r.zoom))*(1<<n-r.zoom),p=u[1]-.5-a,m=r.tileID?r.tileID:new e.aM(o,r.wrap,r.zoom,i,a);t.calculateQuadrantVisibility&&(m.visibleQuadrants=s),C.push({tileID:m,distanceSq:h*h+p*p})}}if(this.fogCullDistSq){const n=this.fogCullDistSq,r=this.horizonLineFromTop();C=C.filter(i=>{const o=[0,0,0,1],s=[e.aj,e.aj,0,1],a=this.calculateFogTileMatrix(i.tileID.toUnwrapped());e.aA(o,o,a),e.aA(s,s,a);const l=e.cD([],o,s),c=e.cE([],o,s),u=e.cY(l,c);if(0===u)return!0;let h=!1;const d=this._elevation;if(d&&u>n&&0!==r){const n=this.calculateProjMatrix(i.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=d.getMinMaxForTile(i.tileID)),o||(o={min:w,max:b});const s=e.cF(this.rotation),a=[s[0]*e.aj,s[1]*e.aj,o.max];e.ad(a,a,n),h=(1-a[1])*this.height*.5<r}return u<n||h})}return C.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const n=e.ay(t.lat,-e.cG,e.cG),r=this.projection.project(t.lng,n);return new e.P(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let r,i;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;r=(n.x-o.x)/e,i=(n.y-o.y)/e}else{const e=this.pointCoordinate(n),t=this.pointCoordinate(o);r=e.x-t.x,i=e.y-t.y}const s=this.locationCoordinate(t);this.setLocation(new e.ac(s.x-r,s.y-i))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e,t){return this.projection.locationPoint(this,e,t)}locationPoint3D(e,t){return this.projection.locationPoint(this,e,t,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e,t){return this.coordinateLocation(this.pointCoordinate3D(e,t))}locationCoordinate(t,n){const r=n?e.cb(n,t.lat):void 0,i=this.projection.project(t.lng,t.lat);return new e.ac(i.x,i.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,n){const r=null!=n?n:this._centerAltitude,i=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.aA(i,i,this.pixelMatrixInverse),e.aA(o,o,this.pixelMatrixInverse);const s=o[3];e.cH(i,i,1/i[3]),e.cH(o,o,1/s);const a=i[2],l=o[2];return{p0:i,p1:o,t:a===l?0:(r-a)/(l-a)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return e.aA(n,n,this.pixelMatrixInverse),e.aA(r,r,this.pixelMatrixInverse),e.cH(n,n,1/n[3]),e.cH(r,r,1/r[3]),n[2]=e.cb(n[2],this._center.lat)*this.worldSize,r[2]=e.cb(r[2],this._center.lat)*this.worldSize,e.cH(n,n,1/this.worldSize),e.cH(r,r,1/this.worldSize),new e.av([n[0],n[1],n[2]],e.au([],e.at([],r,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:r,t:i}=t,o=e.cb(n[2],this._center.lat),s=e.cb(r[2],this._center.lat);return new e.ac(e.ai(n[0],r[0],i)/this.worldSize,e.ai(n[1],r[1],i)/this.worldSize,e.ai(o,s,i))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t,n){if(!this.elevation)return this.pointCoordinate(t,n);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new e.ac(r[0],r[1],r[2]);let i=0,o=this.horizonLineFromTop();if(t.y>o)return this.pointCoordinate(t,n);const s=.02*o,a=t.clone();for(let l=0;l<10&&o-i>s;l++){a.y=e.ai(i,o,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(o=a.y,r=t):i=a.y}return r?new e.ac(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.cI)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const r=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,i=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return e.aA(i,i,this.pixelMatrix),i[3]>0?new e.P(i[0]/i[3],i[1]/i[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,i=this.width-this._edgeInsets.right,o=this.pointLocation3D(new e.P(n,t)),s=this.pointLocation3D(new e.P(i,t)),a=this.pointLocation3D(new e.P(i,r)),l=this.pointLocation3D(new e.P(n,r));let c=Math.min(o.lng,s.lng,a.lng,l.lng),u=Math.max(o.lng,s.lng,a.lng,l.lng),h=Math.min(o.lat,s.lat,a.lat,l.lat),d=Math.max(o.lat,s.lat,a.lat,l.lat);const f=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,m=(t,n,r,i,o)=>{const s=(t+r)/2,a=(n+i)/2,l=new e.P(s,a),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,h-_,g-u,_-d);c=Math.min(c,g),u=Math.max(u,g),h=Math.min(h,_),d=Math.max(d,_),(o<p||y>f)&&(m(t,n,s,a,o+1),m(s,a,r,i,o+1))};if(m(n,t,i,t,1),m(i,t,i,r,1),m(i,r,n,r,1),m(n,r,n,t,1),"globe"===this.projection.name){const[t,n]=e.cJ(this);t?(d=90,u=180,c=-180):n&&(h=-90,u=180,c=-180)}return new e.aG(new e.ci(c,h),new e.ci(u,d))}_getBoundsRectangular(t,n){const{top:r,left:i}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new e.P(i,r),l=new e.P(s,r),c=new e.P(s,o),u=new e.P(i,o);let h=this.pointCoordinate(a,t),d=this.pointCoordinate(l,t);const f=this.pointCoordinate(c,n),p=this.pointCoordinate(u,n),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return h.y>1&&d.y>=0?h=new e.ac((1-p.y)/m(p,h)+p.x,1):h.y<0&&d.y<=1&&(h=new e.ac(-p.y/m(p,h)+p.x,0)),d.y>1&&h.y>=0?d=new e.ac((1-f.y)/m(f,d)+f.x,1):d.y<0&&h.y<=1&&(d=new e.ac(-f.y/m(f,d)+f.x,0)),(new e.aG).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(f))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.cG,this.maxLat=e.cG,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.aD(this.minLng)*this.tileSize,this.worldMaxX=e.aD(this.maxLng)*this.tileSize,this.worldMinY=e.aH(this.maxLat)*this.tileSize,this.worldMaxY=e.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const n=t.key,r=this._distanceTileDataCache;if(r[n])return r[n];const i=t.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(i.z),l=(i.x+Math.pow(2,i.z)*t.wrap)*a,c=i.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const h=this.angle,d=Math.sin(-h),f=-Math.cos(-h);return r[n]={bearing:[d,f],center:[(u.x-l)*o,(u.y-c)*o],scale:a/e.aj*o},r[n]}calculateFogTileMatrix(t){const n=t.key,r=this._fogTileMatrixCache;if(r[n])return r[n];const i=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.az(i,this.worldToFogMatrix,i),r[n]=new Float32Array(i),r[n]}calculateProjMatrix(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t.key;let o;if(o=r?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,o[i])return o[i];const s=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,e.az(s,a,s),o[i]=new Float32Array(s),o[i]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,r=this._pixelsToTileUnitsCache;if(r[n])return r[n];const i=e.cK(t,this);return r[n]=i,r[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,n=e.bn([],[t,t,t]);return e.az(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const n=e.cb(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),i=this._camera.forward(),o=e.cb(1,this._center.lat);r[2]/=o,i[2]/=o,e.au(i,i);const s=t.raycast(r,i,t.exaggeration());if(s){const t=e.bE([],r,i,s),n=new e.ac(t[0],t[1],e.cb(t[2],e.aY(t[1]))),a=(n.z+e.ae([n.x-r[0],n.y-r[1],n.z-r[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=n.toAltitude(),this._center=this.coordinateLocation(n),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const n=this._elevation,r=e.cb(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(r),o=n.getAtPointOrZero(new e.ac(...i)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),l=i[2]-s;if(l<=a)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),n=[i[0],i[1],t.z-i[2]],r=e.ae(n);n[2]-=(a-l)/this._pixelsPerMercatorPixel;const o=e.ae(n);if(0===o)return;e.c1(n,n,r/o*this._pixelsPerMercatorPixel),this._camera.position=[i[0],i[1],t.z*this._pixelsPerMercatorPixel-n[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const n=this.center;return n.lat=e.ay(n.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(n.lng=e.ay(n.lng,this.minLng,this.maxLng)),this.center=n,void(this._constraining=!1)}const n=this._unmodified,{x:r,y:i}=this.point;let o=0,s=r,a=i;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(i-c<u&&(a=u+c),i+c>h&&(a=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,n=this.worldSize/2-(e+t)/2;s=(r+n+this.worldSize)%this.worldSize-n,s-l<e&&(s=e+l),s+l>t&&(s=t-l),t-e<this.width&&(o=Math.max(o,this.width/(t-e)),s=(t+e)/2)}s===r&&a===i||this._allowWorldUnderZoom||(this.center=this.unproject(new e.P(s,a))),o&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n="globe"===this.projection.name,r=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.cb(1,this.center.lat)/e.cb(1,e.c$));const i=e.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,i),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?r:1,s=this._camera.getWorldToCamera(this.worldSize,o);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let n=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),r=n*this.aspect,i=-r,o=-n;r-=t.x,i-=t.x,n+=t.y,o+=t.y,a=this._camera.getCameraToClipOrthographic(i,r,o,n,this._nearZ,this._farZ),((t,n,r,i)=>{for(let o=0;o<16;o++)t[o]=e.ai(n[o],r[o],i)})(a,a,l,e.cZ(this.pitch>=Qn?1:this.pitch/Qn))}else a=l;const c=e.cM([],l,s);let u=e.cM([],a,s);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),n=e.bx([]);e.bo(n,n,[t.x*this.worldSize,t.y*this.worldSize,0]),e.az(n,n,e.cN(this)),e.bo(n,n,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.az(u,u,n),e.az(c,c,n),this.inverseAdjustmentMatrix=e.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.cP([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=e.bi(new Float64Array(16),this.projMatrix),n){const n=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);n[8]=2*-t.x/this.width,n[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.cM([],n,s)}else this.expandedFarZProjMatrix=this.projMatrix;const h=e.bi([],a);this.frustumCorners=e.cQ.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const d=new Float32Array(16);e.bx(d),e.cP(d,d,[1,-1,1]),e.cR(d,d,this._pitch),e.by(d,d,this.angle);const f=e.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.bw(f);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;f[8]=2*-t.x/this.width,f[9]=2*(t.y+p)/this.height,this.skyboxMatrix=e.az(d,f,d);const m=this.point,g=m.x,_=m.y,y=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=g-Math.round(g)+x*y+b*v,S=_-Math.round(_)+x*v+b*y,E=new Float64Array(u);if(e.bo(E,E,[w>.5?w-1:w,S>.5?S-1:S,0]),this.alignedProjMatrix=E,u=e.bz(),e.cP(u,u,[this.width/2,-this.height/2,1]),e.bo(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.bz(),e.cP(u,u,[1,-1,1]),e.bo(u,u,[-1,-1,0]),e.cP(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.az(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.bi(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.cS(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.ad(t,t,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,r=this._camera.position,i=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,n];e.c1(o,o,i),e.c1(r,r,-1),e.cT(r,r,o);const s=e.bz();e.bo(s,s,r),e.cP(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,i)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),r=this.point,i=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-n[0]*i,r.y/this.worldSize-n[1]*i,e/this.worldSize*this._centerAltitude-n[2]*i]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],i=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),i>0&&(o=Math.min((n-r)/i,1)),this._camera.position=e.bE([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:r,bearing:i}=this._camera.getPitchBearing(),o=e.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.al(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(r),s),l=this._zoomFromMercatorZ(a);e.bE(t,t,n,a),this._pitch=e.ay(r,e.al(this.minPitch),e.al(this.maxPitch)),this.angle=e.bQ(i,-Math.PI,Math.PI),this._setZoom(e.ay(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,e)*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,r=e.cI,i=0,o=1/0;for(;r-n>1e-6&&r>n;){const e=n+.5*(r-n),s=this.tileSize*Math.pow(2,e),a=this.getCameraToCenterDistance(this.projection,e,s),l=this.scaleZoom(a/(Math.max(0,t)*this.tileSize)),c=Math.abs(e-l);c<o&&(o=c,i=e),e<l?n=e:r=e}return i}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const r=Math.min(t.x,n.x),i=Math.max(t.x,n.x),o=Math.min(t.y,n.y),s=Math.max(t.y,n.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.P(r,o),new e.P(i,s),new e.P(r,s),new e.P(i,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const n=this.rayIntersectionCoordinate(t);if(n.x<l||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,n){const r=e.ae(e.at([],this._camera.position,t)),i=this._zoomFromMercatorZ(r)+n;return r-this._mercatorZfromZoom(i)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,n){let[r,i,o]=t;const s=[r,i,o,1];e.aA(s,s,n);const a=s[3]=Math.max(s[3],1e-6);return s[0]/=a,s[1]/=a,s[2]/=a,s}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const i=e.cL(t,n,this.width,this.height,1024),o=t.pixelSpaceConversion(this.center.lat,r,i);let s=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(s=e.ai(1,s,e.cZ(this.pitch>=Qn?1:this.pitch/Qn))),s}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.az(t,t,this.globeMatrix),t}getFrustum(t){return e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const tr=(t,n)=>{if(n>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),n<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=t.transform,i=Math.max(Math.abs(r._zoom-(t.minCutoffZoom-1)),1),o=r.isLODDisabled(!1)?e.af(60,45,r.pitch):e.af(30,15,r.pitch),s=r._farZ-r._nearZ,a=n*r.height,l=((1-(c=o))*r.cameraToCenterDistance+c*(r._farZ+a))*i;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(l-r._nearZ)/s,(l-a-r._nearZ)/s]}}},nr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class rr{constructor(e,t){this.aabb=e,this.lastCascade=t}}class ir{add(e,t){const n=this.receivers[e.key];void 0!==n?(n.aabb.min[0]=Math.min(n.aabb.min[0],t.min[0]),n.aabb.min[1]=Math.min(n.aabb.min[1],t.min[1]),n.aabb.min[2]=Math.min(n.aabb.min[2],t.min[2]),n.aabb.max[0]=Math.max(n.aabb.max[0],t.max[0]),n.aabb.max[1]=Math.max(n.aabb.max[1],t.max[1]),n.aabb.max[2]=Math.max(n.aabb.max[2],t.max[2])):this.receivers[e.key]=new rr(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,n,r){const i=e.d6.fromPoints(t.points);let o=0;for(const s in this.receivers){const t=this.receivers[s];if(!t)continue;if(!i.intersectsAabb(t.aabb))continue;t.aabb.min=i.closestPoint(t.aabb.min),t.aabb.max=i.closestPoint(t.aabb.max);const a=t.aabb.getCorners();for(let i=0;i<r.length;i++){let s=!0;for(const t of a){const o=[t[0]*n,t[1]*n,t[2]];if(e.ad(o,o,r[i].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){s=!1;break}}if(t.lastCascade=i,o=Math.max(o,i),s)break}}return o+1}}class or{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ir,this._depthMode=new jn(e.context.gl.LEQUAL,jn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),e.tp.registerParameter(nr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(nr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),e.tp.registerParameter(nr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const i=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||i<=0)return;if(this._shadowLayerCount=r.style.order.reduce((e,n)=>{const i=r.style._mergedLayers[n];return e+(i.hasShadowPass()&&!i.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const o=r.context,s=nr.shadowMapResolution,a=nr.shadowMapResolution;if(0===this._cascades.length||nr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<nr.cascadeCount;++t){const t=r._shadowMapDebug,n=o.gl,i=o.createFramebuffer(s,a,t,"texture"),l=new e.T(o,{width:s,height:a,data:null},n.DEPTH_COMPONENT16);if(i.depthAttachment.set(l.texture),t){const t=new e.T(o,{width:s,height:a,data:null},n.RGBA8);i.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:i,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.cy,scale:0})}}this.shadowDirection=ar(n);let l=0;if(t.elevation){const e=t.elevation,n=[1e4,-1e4];e.visibleDemTiles.filter(e=>e.dem).forEach(e=>{const t=e.dem.tree;n[0]=Math.min(n[0],t.minimums[0]),n[1]=Math.max(n[1],t.maximums[0])}),1e4!==n[0]&&(l=(n[1]-n[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let p=0;p<this._cascades.length;++p){const n=this._cascades[p];let r=t.height/50,i=1;1===nr.cascadeCount?i=u:0===p?i=c:(r=c,i=u);const[o,s]=cr(t,this.shadowDirection,r,i,nr.shadowMapResolution,l);n.scale=t.scale,n.matrix=o,n.boundingSphereRadius=s,e.bi(h,n.matrix),n.frustum=e.cy.fromInvProjectionMatrix(h,1,0,!0),n.far=i}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=i,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/nr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=nr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Yn.ShadowMap0,this._uniformValues.u_shadowmap_1=Yn.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const f=r.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(f){const n=f.getMinMaxForTile(e);n&&(t=n)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,n){if(!this.enabled)return;const r=this.painter,i=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),i.viewport.set([0,0,nr.shadowMapResolution,nr.shadowMapResolution]);for(let o=0;o<this._numCascadesToRender;++o){r.currentShadowCascade=o,i.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),i.clear({color:e.am.white,depth:1});for(const e of t.order){const i=t._mergedLayers[e];if(!i.hasShadowPass()||i.isHidden(r.transform.zoom))continue;const o=t.getLayerSourceCache(i),s=o?n[o.id]:void 0;("model"===i.type||s&&s.length)&&r.renderLayer(r,o,i,s)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,n=e.context,r=n.gl,i=t.directionalLight,o=t.ambientLight;if(!i||!o)return;const s=[],a=tr(e,e.longestCutoffRange);a.shouldRenderCutoff&&s.push("RENDER_CUTOFF"),s.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&s.push("NORMAL_OFFSET");const l=lr(t,i,o),c=new jn(r.LEQUAL,jn.ReadOnly,e.depthRangeFor3D),u=new Vn({func:r.EQUAL,mask:255},0,255,r.KEEP,r.KEEP,r.KEEP);for(const h of this._groundShadowTiles){const t=h.toUnwrapped(),i=e.isTileAffectedByFog(h),o=e.getOrCreateProgram("groundShadow",{defines:s,overrideFog:i});this.setupShadows(t,o),e.uploadCommonUniforms(n,o,t,null,a);const d={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:l};o.draw(e,r.TRIANGLES,c,u,Bn.multiply,$n.disabled,d,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,null,e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Bn.unblended:Bn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,r=n.calculatePosMatrix(t,n.worldSize);return e.az(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(t){return e.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,r){if(!this.enabled)return;const i=this.painter.transform,o=this.painter.context,s=o.gl,a=this._uniformValues,l=new Float64Array(16),c=i.calculatePosMatrix(t,i.worldSize);for(let u=0;u<this._cascades.length;u++)e.az(l,this._cascades[u].matrix,c),a[0===u?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(s.TEXTURE0+Yn.ShadowMap0+u),this._cascades[u].texture.bindExtraParam(s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE,s.GREATER);if(this.useNormalOffset=!!r,this.useNormalOffset){const n=e.d4(t.canonical),o=2/i.tileSize*e.aj/nr.shadowMapResolution,s=o*this._cascades[0].boundingSphereRadius,l=o*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===r?1:3)*function(t){const n=e.ay((t-22)/-22,0,1);return.125*(1-n)+4*n}(i.zoom);a.u_shadow_normal_offset=[n,s*c,l*c],a.u_shadow_bias=[1e-4,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(o,a)}setupShadowsFromMatrix(t,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const i=this.painter.context,o=i.gl,s=this._uniformValues,a=new Float64Array(16);for(let l=0;l<nr.cascadeCount;l++)e.az(a,this._cascades[l].matrix,t),s[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),i.activeTexture.set(o.TEXTURE0+Yn.ShadowMap0+l),this._cascades[l].texture.bindExtraParam(o.LINEAR,o.LINEAR,o.CLAMP_TO_EDGE,o.CLAMP_TO_EDGE,o.GREATER);if(this.useNormalOffset=r,r){const e=nr.normalOffset;s.u_shadow_normal_offset=[1,e,e],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(i,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,r,i){if(i[2]>=0)return{};const o=function(t,n,r){const i=r/(1<<t.canonical.z);return new e.d6([t.canonical.x*i+t.wrap*r,t.canonical.y*i+t.wrap*r,0],[(t.canonical.x+1)*i+t.wrap*r,(t.canonical.y+1)*i+t.wrap*r,n])}(t,n,r).getCorners(),s=n/-i[2];i[0]<0?(e.d5(o[0],o[0],[i[0]*s,0,0]),e.d5(o[3],o[3],[i[0]*s,0,0])):i[0]>0&&(e.d5(o[1],o[1],[i[0]*s,0,0]),e.d5(o[2],o[2],[i[0]*s,0,0])),i[1]<0?(e.d5(o[0],o[0],[0,i[1]*s,0]),e.d5(o[1],o[1],[0,i[1]*s,0])):i[1]>0&&(e.d5(o[2],o[2],[0,i[1]*s,0]),e.d5(o[3],o[3],[0,i[1]*s,0]));const a={};return a.vertices=o,a.planes=[sr(o[1],o[0],o[4]),sr(o[2],o[1],o[5]),sr(o[3],o[2],o[6]),sr(o[0],o[3],o[7])],a}addShadowReceiver(t,n,r){this._receivers.add(t,e.d6.fromTileIdAndHeight(t,n,r))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function sr(t,n,r){const i=e.at([],r,n),o=e.at([],t,n),s=e.bF([],i,o),a=e.ae(s);return 0===a?[0,0,1,0]:(e.c1(s,s,1/a),[s[0],s[1],s[2],-e.bG(s,n)])}function ar(t){const n=t.properties.get("direction"),r=e.d1(n.x,n.y,n.z);r[2]=e.ay(r[2],0,75);const i=e.d3([r[0],r[1],r[2]]);return e.d2(i.x,i.y,i.z)}function lr(t,n,r){const i="none"===n.properties.get("color-use-theme"),o=n.properties.get("color"),s=n.properties.get("intensity"),a=n.properties.get("direction"),l=[a.x,a.y,a.z],c="none"===r.properties.get("color-use-theme"),u=r.properties.get("color"),h=r.properties.get("intensity"),d=Math.max(e.bG([0,0,1],l),0),f=[0,0,0];e.c1(f,u.toPremultipliedRenderColor(c?null:t.getLut(n.scope)).toArray01Linear().slice(0,3),h);const p=[0,0,0];return e.c1(p,o.toPremultipliedRenderColor(i?null:t.getLut(r.scope)).toArray01Linear().slice(0,3),d*s),e.d8([f[0]>0?f[0]/(f[0]+p[0]):0,f[1]>0?f[1]/(f[1]+p[1]):0,f[2]>0?f[2]/(f[2]+p[2]):0])}function cr(t,n,r,i,o,s){const a=t.zoom,l=t.scale,c=t.worldSize,u=1/c,h=t.aspect,d=Math.sqrt(1+h*h)*Math.tan(.5*t.fovX),f=d*d,p=i-r,m=i+r;let g,_;f>p/m?(g=i,_=i*d):(g=.5*m*(1+f),_=.5*Math.sqrt(p*p+2*(i*i+r*r)*f+m*m*f*f));const y=t.projection.pixelsPerMeter(t.center.lat,c),v=t._camera.getCameraToWorldMercator(),x=[0,0,-g*u];e.ad(x,x,v);let b=_*u;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const n=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),o=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,r,i);o[8]=2*-t.centerOffset.x/t.width,o[9]=2*t.centerOffset.y/t.height;const s=new Float64Array(16);e.cM(s,o,n);const u=new Float64Array(16);e.bi(u,s);const h=e.cy.fromInvProjectionMatrix(u,c,a,!0);for(const r of h.points){const n=((S=r)[0]/=l,S[1]/=l,S[2]=e.cb(S[2],t._center.lat),S);b=Math.max(b,e.c2(e.d7([],x,n)))}}var S;b*=o/(o-1);const E=Math.acos(n[2]),T=Math.atan2(-n[0],-n[1]),A=new Kn;A.position=x,A.setPitchBearing(E,T);const C=A.getWorldToCamera(c,y),P=b*c,I=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*P),k=A.getCameraToClipOrthographic(-P,P,-P,P,I,(P+s*y)/n[2]),M=new Float64Array(16);e.az(M,k,C);const R=e.d2(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),O=.5*o,L=[0,0,0];e.ad(L,R,M),e.c1(L,L,O);const D=[Math.floor(L[0]),Math.floor(L[1]),Math.floor(L[2])],N=[0,0,0];e.at(N,L,D),e.c1(N,N,-1/O);const z=new Float64Array(16);return e.bx(z),e.bo(z,z,N),e.az(M,z,M),[M,P]}class ur extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,n){return e.aS(this.requestManager.transformRequest(n,e.R.Model).url).then(n=>{if(!n)return;const r=e.aT(n),i=new e.aU(t,void 0,void 0,r);return i.computeBoundsAndApplyParent(),i}).catch(r=>{if(r&&404===r.status)return null;this.fire(new e.z(new Error(`Could not load model ${t} from ${n}: ${r.message}`)))})}load(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{forceReload:!1};this.models[n]||(this.models[n]={});const i=Object.keys(t),o=[],s=[];for(const e of i){const i=t[e];this.hasURLBeenRequested(i)&&!r.forceReload||(this.modelByURL[i]={modelId:e,scope:n},o.push(this.loadModel(e,i)),s.push(e)),this.models[n][e]||(this.models[n][e]={model:null,numReferences:1})}this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+s.length,Promise.allSettled(o).then(t=>{for(let e=0;e<t.length;e++){const{status:r}=t[e];if("rejected"===r)continue;const{value:i}=t[e];this.models[n][s[e]]||(this.models[n][s[e]]={model:null,numReferences:1}),this.models[n][s[e]].model=i}this.numModelsLoading[n]-=s.length,this.fire(new e.A("data",{dataType:"style"}))}).catch(t=>{this.fire(new e.z(new Error(`Could not load models: ${t.message}`)))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!((arguments.length>2&&void 0!==arguments[2]?arguments[2]:{exactIdMatch:!1}).exactIdMatch?this.getModel(e,t):this.getModelByURL(this.modelUris[t][e]))}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}getModelByURL(e){if(!e)return null;const t=this.modelByURL[e];return t?this.models[t.scope][t.modelId].model:null}hasModelBeenAdded(e,t){return this.models[t]&&void 0!==this.models[t][e]}getModelURIs(e){return this.modelUris[e]||{}}addModel(e,t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const r=this.requestManager.normalizeModelURL(t);if((this.hasModel(e,n,{exactIdMatch:!0})||this.hasModelBeenAdded(e,n))&&this.modelUris[n][e]===r)this.models[n][e].numReferences++;else if(this.hasURLBeenRequested(r)){const{scope:e,modelId:t}=this.modelByURL[r];this.models[e][t].numReferences++}else this.modelUris[n][e]=r,this.load({[e]:this.modelUris[n][e]},n)}addModelURLs(e,t){this.models[t]||(this.models[t]={}),this.modelUris[t]||(this.modelUris[t]={});const n=this.modelUris[t];for(const r in e)n[r]=this.requestManager.normalizeModelURL(e[r])}reloadModels(e){this.load(this.modelUris[e],e,{forceReload:!0})}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const r={};for(const i of t)this.hasModel(i,n,{exactIdMatch:!0})||this.hasURLBeenRequested(i)?this.models[n][i].numReferences++:this.modelUris[n][i]&&!this.hasURLBeenRequested(i)?r[i]=this.modelUris[n][i]:!this.hasURLBeenRequested(i)&&e.d9(i,!1)&&(this.modelUris[n][i]=this.requestManager.normalizeModelURL(i),r[i]=this.modelUris[n][i]);this.load(r,n)}hasURLBeenRequested(e){return void 0!==this.modelByURL[e]}removeModel(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences||r)){const r=this.modelUris[t][e];n||delete this.modelUris[t][e],delete this.modelByURL[r];const i=this.models[t][e].model;if(!i)return;delete this.models[t][e],i.destroy()}}destroy(){for(const e of Object.keys(this.models))for(const t of Object.keys(this.models[e])){const n=this.models[e][t].model;delete this.models[e][t],n&&n.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const n in this.models[t])this.models[t][n].model&&this.models[t][n].model.upload(e.context)}}const hr=new e.a7({data:new e.a8(e.a5.colorTheme.data)});class dr{constructor(e){this._scope=e,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(e){const t=this._makeBuildingsQueryArea(e),n=this._makeFloorsQueryArea(e),r=e.queryRenderedFeatures(t,this._buildingQueryParams).filter(e=>"building"===e.properties.shape_type).reduce((e,t)=>{const n=t.properties.id;return"building"!==t.properties.shape_type||e.some(e=>e.properties.id===n)||e.push(t),e},[]),i=e.queryRenderedFeatures(n,this._floorQueryParams).filter(e=>"floor"===e.properties.shape_type).reduce((e,t)=>{const n=t.properties.id;return"floor"!==t.properties.shape_type||e.some(e=>e.properties.id===n)||e.push(t),e},[]),o=[e.getCenter().lng,e.getCenter().lat];return{floors:i,building:this._findBuildingAtCenter(o,r)||(r.length>0?r[0]:null)}}_makeBuildingsQueryArea(t){const n=t.transform.width,r=t.transform.height,i=Math.min(n,r),o=i*(1/8),s=i*(1/8),a=.5*(n-o),l=.5*(r-s);return[new e.P(a,l),new e.P(a+o,l+s)]}_makeFloorsQueryArea(t){const n=t.transform.width,r=t.transform.height,i=n*(2/3),o=r*(2/3),s=.5*(n-i),a=.5*(r-o);return[new e.P(s,a),new e.P(s+i,a+o)]}_findBuildingAtCenter(e,t){for(const n of t)if("Polygon"===n.geometry.type&&this._pointInPolygon(e,n.geometry.coordinates[0]))return n;return null}_pointInPolygon(e,t){let n=!1;for(let r=0,i=t.length-1;r<t.length;i=r++){const o=t[r][0],s=t[r][1],a=t[i][1];s>e[1]!=a>e[1]&&e[0]<(t[i][0]-o)*(e[1]-s)/(a-s)+o&&(n=!n)}return n}}class fr{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(e){this._selectedBuildingId=e}setFloors(e){if(this._floors=e.filter(e=>e.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(e=>e.properties.id).includes(this._selectedFloorId)){const e=this._floors.map(e=>({id:e.properties.id,level:e.properties.floor_level})).reduce((e,t)=>{const n=Math.abs(e.level-1),r=Math.abs(t.level-1);return r<n||r===n&&t.level>e.level?t:e});this._selectedFloorId=e.id}}setFloorId(e){this._selectedFloorId=e}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const pr={"mbx-indoor-level-selected":{default:["literal",[]]}};function mr(e){return e=e||{},Object.assign(e,pr)}class gr extends e.E{constructor(t){super(),e.aV(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new fr,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new e.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new dr(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const e=this._indoorDataQuery.execute(this._map);e&&0!==e.floors.length?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(e)):this._clearIndoorData()}_selectFloors(e){if(e.building)this._floorSelectionState.setBuildingId(e.building.properties.id),this._floorSelectionState.setFloors(e.floors),this._updateUI();else{const t=this._floorSelectionState.getSelectedFloorId();if(t&&e.floors.some(e=>e.properties.id===t))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const t=this._floorSelectionState.getCurrentBuildingFloors().map(e=>({id:e.properties.id,name:e.properties.name,shortName:e.properties.floor_level,levelOrder:e.properties.floor_level})),n=this._floorSelectionState.getSelectedFloorId();n?(this._updateIndoorConfig(),this.fire(new e.A("indoorupdate",{selectedFloorId:n,floors:t}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const e=this._floorSelectionState.getSelectedFloorId();e?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[e]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(e){this._floorSelectionState.setFloorId(e),this._updateIndoorConfig()}}function _r(t){if(!t.metadata||!t.metadata.content_area)return;const n=e.q.devicePixelRatio,{left:r,top:i,width:o,height:s}=t.metadata.content_area,a=r*n,l=i*n;return[a,l,a+o*n,l+s*n]}function yr(t){if(t)return t.map(t=>{let[n,r]=t;return[n*e.q.devicePixelRatio,r*e.q.devicePixelRatio]})}class vr{constructor(e,t,n){this.id=e,this.scope=t,this.sourceCache=n,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(e){this.missingRequests.has(e.name)||this.pendingRequests.has(e.name)||this.pendingRequests.add(e.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const n=this.sourceCache.getVisibleCoordinates();if(0===n.length)return t;const r=this.sourceCache.getSource();if(!(r instanceof it))return t;const i=n.map(e=>this.sourceCache.getTile(e)),o=r.getImages(i,Array.from(this.pendingRequests));for(const[s,a]of o)t.set(e.I.from({name:s,iconsetId:this.id}),a),this.pendingRequests.delete(s);for(const e of this.pendingRequests)this.missingRequests.add(e);return this.pendingRequests.clear(),t}}const xr=(e,t)=>ke(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),br=e.aF(Ot,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),wr=e.aF(Ot,["setCenter","setZoom","setBearing","setPitch"]),Sr=new Set(["background","sky","slot","custom"]),Er={version:8,layers:[],sources:{}},Tr={duration:300,delay:0};class Ar extends e.E{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=e.h({},Tr),this._buildingIndex=new kt(this),this.crossTileSymbolIndex=new zn,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new V,this.dispatcher=n.dispatcher?n.dispatcher:new e.D(e.db(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new H(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new e.dc(t._requestManager,n.localFontFamily?e.dd.all:n.localIdeographFontFamily?e.dd.ideographs:e.dd.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new ur(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",e.de());const r=this;this._rtlTextPluginCallback=Ar.registerForPluginStateChange(t=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(t,n)=>{if(e.df(t),n&&n.every(e=>e))for(const e in r._sourceCaches){const t=r._sourceCaches[e],n=t.getSource().type;"vector"!==n&&"geojson"!==n||t.reload()}})}),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const n in this._layers){const e=this._layers[n];e.source===t.id&&this._validateLayer(e)}})}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.j(t))return t;const n=e.dg(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch(e){return n}return n}return`json://${e.dh(JSON.stringify(t))}`}_diffStyle(t,n,r){this.globalId=this._getGlobalId(t);const i=(e,t)=>{try{t(null,this.setState(e,r))}catch(e){t(e,!1)}};if("string"==typeof t){const r=this.map._requestManager.normalizeStyleURL(t),o=this.map._requestManager.transformRequest(r,e.R.Style);e.n(o,(t,r)=>{t?this.fire(new e.z(t)):r&&i(r,n)})}else"object"==typeof t&&i(t,n)}loadURL(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.A("dataloading",{dataType:"style"}));const r="boolean"==typeof n.validate?n.validate:!e.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const i=this.importsCache.get(t);if(i)return this._load(i,r);const o=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.n(o,(n,i)=>{if(this._request=null,n)this.fire(new e.z(n));else if(i)return this.importsCache.set(t,i),this._load(i,r)})}loadJSON(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.q.frame(()=>{this._request=null,this._load(t,!1!==n.validate)})}loadEmpty(){this.fire(new e.A("dataloading",{dataType:"style"})),this._load(Er,!1)}_loadImports(t,n,r){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const i=[];for(const e of t){const t=this._createFragmentStyle(e),o=new Promise(e=>{t.once("style.import.load",e),t.once("error",e)}).then(()=>this.mergeAll());if(i.push(o),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const s=e.data||this.importsCache.get(e.url);s?(t.loadJSON(s,{validate:n}),this._isInternalStyle(s)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:n}):t.loadEmpty();const a={style:t,id:e.id,config:e.config};if(r){const e=this.fragments.findIndex(e=>{let{id:t}=e;return t===r});this.fragments=this.fragments.slice(0,e).concat(a).concat(this.fragments.slice(e))}else this.fragments.push(a)}return Promise.allSettled(i)}getImportGlobalIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const n of e.fragments)n.style.globalId&&t.add(n.style.globalId),this.getImportGlobalIds(n.style,t);return[...t.values()]}_createFragmentStyle(t){const n=this.scope?e.C(t.id,this.scope):t.id;let r;const i=this._initialConfig&&this._initialConfig[n];(t.config||i)&&(r=e.h({},t.config,i));const o=new Ar(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:r,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return o.setEventedParent(this.map,{style:o}),o}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,n){const r=t.indoor?mr(t.schema):t.schema;if(this._isInternalStyle(t)){const r=e.h({},Er,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(r,n)}if(this.updateConfig(this._config,r),n&&xr(this,ge(t)))return;this._loaded=!0,this.stylesheet=e.di(t);const i=()=>{for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const e in t.iconsets)this.addIconset(e,t.iconsets[e]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const r=Rt(this.stylesheet.layers);if(this._order=r.map(e=>e.id),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Re(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Re(this.stylesheet.light)),this._layers={};for(const t of r){const n=e.dn(t,this.scope,this._styleColorTheme.lut,this.options);0!==n.configDependencies.size&&this._configDependentLayers.add(n.fqid),n.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=n;const r=this.getOwnLayerSourceCache(n),i=!!this.directionalLight&&this.directionalLight.shadowsEnabled();r&&n.canCastShadows()&&i&&(r.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const i=this.stylesheet.terrain;i&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(i,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.A("data",{dataType:"style"}));const o=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new e.A(o?"style.load":"style.import.load"))}).catch(t=>{this.fire(new e.z(new Error("Failed to load imports",t))),this.fire(new e.A(o?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new e.A(o?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(o){const t=this._evaluateColorThemeData(o);this._loadColorTheme(t).then(()=>{i()}).catch(t=>{e.w(`Couldn't load color theme from the stylesheet: ${t}`),i()})}else this._styleColorTheme.lut=null,i()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,n,r,i,o,s,a,l,c,u;const h={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(n=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(r=e.directionalLight);i=this._prioritizeTerrain(i,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(o=e.fog),e.stylesheet.snow&&null!=e.snow&&(s=e.snow),e.stylesheet.rain&&null!=e.rain&&(a=e.rain),null!=e.stylesheet.camera&&(u=e.stylesheet.camera),null!=e.stylesheet.projection&&(l=e.stylesheet.projection),null!=e.stylesheet.transition&&(c=e.stylesheet.transition),h[e.scope]=e._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=r,this.fog=o,this.snow=s,this.rain=a,this._styleColorThemeForScope=h,null===i?delete this.terrain:this.terrain=i,this.camera=u||{"camera-projection":"perspective"},this.projection=l||{name:"mercator"},this.transition=e.h({},Tr,c),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=n=>{for(const e of n.fragments)t(e.style);e(n)};t(this)}_prioritizeTerrain(e,t,n){const r=e&&0===e.drapeRenderMode;return null===n?t&&0===t.drapeRenderMode?t:r?e:null:null!=t&&(!e||r||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)}),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const t={},n={},r={};this.forEachFragmentStyle(i=>{for(const n in i._sourceCaches){const r=e.C(n,i.scope);t[r]=i._sourceCaches[n]}for(const t in i._otherSourceCaches){const r=e.C(t,i.scope);n[r]=i._otherSourceCaches[t]}for(const t in i._symbolSourceCaches){const n=e.C(t,i.scope);r[n]=i._symbolSourceCaches[t]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=r}mergeLayers(){var t=this;const n={},r=[],i={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(t=>{for(const i of t._order){const o=t._layers[i];if("slot"===o.type){const t=e.dj(i);if(n[t])continue;n[t]=[]}o.slot&&n[o.slot]?n[o.slot].push(o):r.push(o)}}),this._mergedOrder=[];const o=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const s of r)if("slot"===s.type){const r=e.dj(s.id);n[r]&&o(n[r]),t._mergedSlots.push(r)}else{const n=e.C(s.id,s.scope);t._mergedOrder.push(n),i[n]=s,s.is3D(!!t.terrain)&&(t._has3DLayers=!0),"circle"===s.type&&(t._hasCircleLayers=!0),"symbol"===s.type&&(t._hasSymbolLayers=!0),"clip"===s.type&&(t._clipLayerPresent=!0)}};o(r),this._mergedOrder.sort((e,t)=>{const n=i[e],r=i[t];return n.hasInitialOcclusionOpacityProperties?r.is3D(!!this.terrain)?1:0:n.is3D(!!this.terrain)&&r.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(t,n,r){const i=e.h({},n);for(const s of Object.keys(e.a5.colorTheme))void 0===i[s]&&(i[s]=e.a5.colorTheme[s].default);const o=new e.a6(hr,t,new Map(r));return o.setTransitionOrValue(i,r),o.untransitioned().possiblyEvaluate(new e.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((r,i)=>{const o="data:image/png;base64,";if(!t||0===t.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void r();let s=t;s.startsWith(o)||(s=o+s);const a=e.I.from("mapbox-reserved-lut"),l=new Image;l.src=s,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,i(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void r();this._styleColorTheme.lutLoading=!1;const{width:o,height:s,data:c}=e.q.getImageData(l);if(s>32)return void i(new Error("The height of the image must be less than or equal to 32 pixels."));if(o!==s*s)return void i(new Error("The width of the image must be equal to the height squared."));this.getImage(a)&&this.removeImage(a),this.addImage(a,{data:new e.r({width:o,height:s},c),pixelRatio:1,sdf:!1,usvg:!1,version:0});const u=this.imageManager.getImage(a,this.scope);u?(this._styleColorTheme.lut={image:u.data,data:t},r()):i(new Error("Missing LUT image."))}})}getLut(e){const t=this._styleColorThemeForScope[e];return t?t.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,n,r){let i,o,s;const a=e.q.devicePixelRatio>1?"@2x":"";let l=e.n(n.transformRequest(n.normalizeSpriteURL(t,a,".json"),e.R.SpriteJSON),(e,t)=>{l=null,s||(s=e,i=t,u())}),c=e.o(n.transformRequest(n.normalizeSpriteURL(t,a,".png"),e.R.SpriteImage),(e,t)=>{c=null,s||(s=e,o=t,u())});function u(){if(s)r(s);else if(i&&o){const t=e.q.getImageData(o),n={};for(const r in i){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:f}=i[r],p=new e.r({width:o,height:s});e.r.copy(t,p,{x:a,y:l},{x:0,y:0},{width:o,height:s},null),n[r]={data:p,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:f,usvg:!1}}r(null,n)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,(t,n)=>{if(this._spriteRequest=null,t)this.fire(new e.z(t));else if(n){const t=new Map;for(const r in n)t.set(e.I.from(r),n[r]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))})}addIconset(t,n){if("sprite"===n.type)return void this._loadSprite(n.url);const r=this.getOwnSourceCache(n.source);if(!r)return void this.fire(new e.z(new Error(`Source "${n.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const i=r.getSource();if("raster-array"!==i.type)return void this.fire(new e.z(new Error(`Source "${n.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));i.partial=!1;const o=new vr(t,this.scope,r);this.imageManager.addImageProvider(o,this.scope)}removeIconset(e){this.imageManager.removeImageProvider(e,this.scope)}_loadIconset(t){if(!e.j(t)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(t);const n="auto"===this.map._spriteFormat;var r,i;this._spriteRequest=(i=(r,i)=>{if(this._spriteRequest=null,r)n?this._loadSprite(t):this.fire(new e.z(r));else if(i){const t=new Map;for(const n in i)t.set(e.I.from(n),i[n]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))},e.br((r=this.map._requestManager).transformRequest(r.normalizeIconsetURL(t),e.R.Iconset),(t,n)=>{if(t)return void i(t);const r={},o=e.da(new e.bq(n));for(const i of o.icons){const t={version:1,pixelRatio:e.q.devicePixelRatio,content:_r(i),stretchX:i.metadata?yr(i.metadata.stretch_x_areas):void 0,stretchY:i.metadata?yr(i.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:i};r[i.name]=t}i(null,r)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const r=t.sourceLayer;r&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new e.z(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(this.imageManager.hasPatternsInFlight())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,t)=>{const n=this.fragments[t];return n&&n.style&&(e.data=n.style.serialize()),e})}_serializeSources(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return e}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;if(this.hasSnowTransition())return!0;if(this.hasRainTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(e){return e?this.order:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new e.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new e.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(e,t){const n=this.map.painter;if(n)for(let r=e.minzoom||0;r<(e.maxzoom||25.5);r++){const r=e.getProgramIds();if(r)for(const i of r){const r=e.getDefaultProgramParams(i,t.zoom,this._styleColorTheme.lut);r&&(n.style=this,this.fog&&(n._fogVisible=!0,r.overrideFog=!0,n.getOrCreateProgram(i,r)),n._fogVisible=!1,r.overrideFog=!1,n.getOrCreateProgram(i,r),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(r.overrideRtt=!0,n.getOrCreateProgram(i,r)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const r=this._changes.isDirty();let i=!1;if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:n,removedIds:r}=e[t];(n||r)&&(this._updateWorkerLayers(t,n,r),i=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const o={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];o[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const n=this._mergedLayers[e];if(n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)){const e=this.getLayerSourceCache(n);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,n.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(n,t)}):this.precompilePrograms(n,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&i&&this.mergeLayers();const s=this.imageManager.getPendingImageProviders();for(const e of s)e.sourceCache.used=!0;for(const a in o){const t=this._mergedSourceCaches[a];o[a]!==t.used&&t.getSource().fire(new e.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),r&&this.fire(new e.A("data",{dataType:"style"}))}updateImageProviders(){const e=this.imageManager.getPendingImageProviders();for(const t of e){const e=t.resolvePendingRequests(),n=this.getFragmentStyle(t.scope);n&&n.addImages(e)}}_updateTilesForChangedImages(){const e={};for(const t in this._mergedSourceCaches){const n=this._mergedSourceCaches[t].getSource().scope;e[n]=e[n]||this._changes.getUpdatedImages(n),0!==e[n].length&&this._mergedSourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e[n])}for(const t in e)this._changes.resetUpdatedImages(t)}_updateWorkerLayers(e,t,n){const r=this.getFragmentStyle(e);r&&this.dispatcher.broadcast("updateLayers",{layers:t?r._serializeLayers(t):[],scope:e,removedIds:n||[],options:r.options})}setState(t,n){if(this._checkLoaded(),xr(this,ge(t)))return!1;(t=e.di(t)).layers=Rt(t.layers);const r=function(t,n){if(!t)return[{command:Ot.setStyle,args:[n]}];let r=[];try{if(!e.bv(t.version,n.version))return[{command:Ot.setStyle,args:[n]}];if(e.bv(t.center,n.center)||r.push({command:Ot.setCenter,args:[n.center]}),e.bv(t.zoom,n.zoom)||r.push({command:Ot.setZoom,args:[n.zoom]}),e.bv(t.bearing,n.bearing)||r.push({command:Ot.setBearing,args:[n.bearing]}),e.bv(t.pitch,n.pitch)||r.push({command:Ot.setPitch,args:[n.pitch]}),e.bv(t.sprite,n.sprite)||r.push({command:Ot.setSprite,args:[n.sprite]}),e.bv(t.glyphs,n.glyphs)||r.push({command:Ot.setGlyphs,args:[n.glyphs]}),e.bv(t.imports,n.imports)||function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;n=n||[];const i=(t=t||[]).map(Bt),o=n.map(Bt),s=t.reduce(jt,{}),a=n.reduce(jt,{}),l=i.slice();let c,u,h,d;for(c=0,u=0;c<i.length;c++)h=i[c],a.hasOwnProperty(h)?u++:(r.push({command:Ot.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(s.hasOwnProperty(h)?(r.push({command:Ot.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,d=l[l.length-c],r.push({command:Ot.addImport,args:[a[h],d]}),l.splice(l.length-c,0,h));for(const f of n){const t=s[f.id];t&&(delete t.data,e.bv(t,f)||r.push({command:Ot.updateImport,args:[f.id,f]}))}}(t.imports,n.imports,r),e.bv(t.transition,n.transition)||r.push({command:Ot.setTransition,args:[n.transition]}),e.bv(t.light,n.light)||r.push({command:Ot.setLight,args:[n.light]}),e.bv(t.fog,n.fog)||r.push({command:Ot.setFog,args:[n.fog]}),e.bv(t.snow,n.snow)||r.push({command:Ot.setSnow,args:[n.snow]}),e.bv(t.rain,n.rain)||r.push({command:Ot.setRain,args:[n.rain]}),e.bv(t.projection,n.projection)||r.push({command:Ot.setProjection,args:[n.projection]}),e.bv(t.lights,n.lights)||r.push({command:Ot.setLights,args:[n.lights]}),e.bv(t.camera,n.camera)||r.push({command:Ot.setCamera,args:[n.camera]}),e.bv(t.iconsets,n.iconsets)||function(t,n,r){let i;for(i in n=n||{},t=t||{})t.hasOwnProperty(i)&&(n.hasOwnProperty(i)||r.push({command:Ot.removeIconset,args:[i]}));for(i in n){if(!n.hasOwnProperty(i))continue;const o=n[i];t.hasOwnProperty(i)?e.bv(t[i],o)||(r.push({command:Ot.removeIconset,args:[i]}),r.push({command:Ot.addIconset,args:[i,o]})):r.push({command:Ot.addIconset,args:[i,o]})}}(t.iconsets,n.iconsets,r),!e.bv(t["color-theme"],n["color-theme"]))return[{command:Ot.setStyle,args:[n]}];const i={},o=[];!function(t,n,r,i){let o;for(o in n=n||{},t=t||{})t.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Dt(o,r,i));for(o in n){if(!n.hasOwnProperty(o))continue;const s=n[o];t.hasOwnProperty(o)?e.bv(t[o],s)||("geojson"===t[o].type&&"geojson"===s.type&&zt(t,n,o)?r.push({command:Ot.setGeoJSONSourceData,args:[o,s.data]}):Nt(o,n,r,i)):Lt(o,n,r)}}(t.sources,n.sources,o,i);const s=[];t.layers&&t.layers.forEach(e=>{e.source&&i[e.source]?r.push({command:Ot.removeLayer,args:[e.id]}):s.push(e)});let a=t.terrain;a&&i[a.source]&&(r.push({command:Ot.setTerrain,args:[void 0]}),a=void 0),r=r.concat(o),e.bv(a,n.terrain)||r.push({command:Ot.setTerrain,args:[n.terrain]}),function(t,n,r){n=n||[];const i=(t=t||[]).map(Bt),o=n.map(Bt),s=t.reduce(jt,{}),a=n.reduce(jt,{}),l=i.slice(),c=Object.create(null);let u,h,d,f,p,m,g;for(u=0,h=0;u<i.length;u++)d=i[u],a.hasOwnProperty(d)?h++:(r.push({command:Ot.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(r.push({command:Ot.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],r.push({command:Ot.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],f=s[d],p=a[d],!c[d]&&!e.bv(f,p))if(e.bv(f.source,p.source)&&e.bv(f["source-layer"],p["source-layer"])&&e.bv(f.type,p.type)){for(g in Ft(f.layout,p.layout,r,d,null,Ot.setLayoutProperty),Ft(f.paint,p.paint,r,d,null,Ot.setPaintProperty),e.bv(f.slot,p.slot)||r.push({command:Ot.setSlot,args:[d,p.slot]}),e.bv(f.filter,p.filter)||r.push({command:Ot.setFilter,args:[d,p.filter]}),e.bv(f.minzoom,p.minzoom)&&e.bv(f.maxzoom,p.maxzoom)||r.push({command:Ot.setLayerZoomRange,args:[d,p.minzoom,p.maxzoom]}),f)f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Ft(f[g],p[g],r,d,g.slice(6),Ot.setPaintProperty):e.bv(f[g],p[g])||r.push({command:Ot.setLayerProperty,args:[d,g,p[g]]}));for(g in p)p.hasOwnProperty(g)&&!f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Ft(f[g],p[g],r,d,g.slice(6),Ot.setPaintProperty):e.bv(f[g],p[g])||r.push({command:Ot.setLayerProperty,args:[d,g,p[g]]}))}else r.push({command:Ot.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],r.push({command:Ot.addLayer,args:[p,m]})}(s,n.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:Ot.setStyle,args:[n]}]}return r}(this.serialize(),t).filter(e=>!(e.command in wr));if(0===r.length)return!1;const i=r.filter(e=>!(e.command in br));if(i.length>0)throw new Error(`Unimplemented: ${i.map(e=>e.command).join(", ")}.`);const o=[];return r.forEach(e=>{o.push(this[e.command](...e.args))}),n&&Promise.all(o).then(n).catch(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(0===t.size)return this;for(const[n,r]of t.entries()){if(this.getImage(n))return this.fire(new e.z(new Error(`An image with the name "${n.name}" already exists.`)));this.imageManager.addImage(n,this.scope,r),this._changes.updateImage(n,this.scope)}return this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this}addImage(t,n){return this.getImage(t)?this.fire(new e.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,n),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this)}updateImage(t,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.imageManager.updateImage(t,this.scope,n),r&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})))}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new e.A("data",{dataType:"style"})),this}addModel(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(Pe,`models.${t}`,n,null,r)||(this.modelManager.addModel(t,n,this.scope),this.fire(new e.A("data",{dataType:"style"}))),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(_e,`sources.${t}`,n,null,r))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const i=st(t,n,this.dispatcher,this);i.scope=this.scope,i.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i.id),source:i.serialize(),sourceId:i.id}));const o=t=>{const n=(t?"symbol:":"other:")+i.id,r=e.C(n,this.scope),o=this._sourceCaches[n]=new At(r,i,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[i.id]=o,o.onAdd(this.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),i.onAdd&&i.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const n=Object.entries(this.stylesheet.iconsets).find(e=>{let[n,r]=e;return"source"===r.type&&r.source===t});if(n)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while iconset "${n[0]}" is using it.`)))}const r=this.getOwnSourceCaches(t);for(const i of r){const t=e.dj(i.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(i.id),i.fire(new e.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const n=this.getOwnSourceCache(t);n&&e.push(n.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const o of t){if(this._validate(ve,"lights",o))return;switch(o.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(o),e.updateTransitions(n)}else this.ambientLight=new Xe(o,He||(He=new e.a7({color:new e.a8(e.a5.properties_light_ambient.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(o),e.updateTransitions(n)}else this.directionalLight=new Xe(o,$e||($e=new e.a7({direction:new e.an(e.a5.properties_light_directional.direction),color:new e.a8(e.a5.properties_light_directional.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_directional.intensity),"cast-shadows":new e.a8(e.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new e.a8(e.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new e.a8(e.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const r=Object.assign(n,{worldview:this.map.getWorldview()}),i=new e.aa(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const r=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),i=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),o=t.properties.get("intensity"),s=t.properties.get("direction"),a=1-e.d1(s.x,s.y,s.z)[2]/90,l=r(i)*o*a,c=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),u=n.properties.get("intensity"),h=r(c)*u;return Number(((l+h)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(null==t||""===t&&this.isRootStyle())return this;if(e.dk(t)){const n=e.dl(t),r=this.fragments.find(e=>{let{id:t}=e;return t===n});if(!r)return;const i=e.dj(t);return r.style.getFragmentStyle(i)}{const e=this.fragments.find(e=>{let{id:n}=e;return n===t});return e?e.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},r=function(e){return`${e}::${arguments.length>1&&void 0!==arguments[1]?arguments[1]:""}`};this._featuresetSelectors={};for(const i in t){const o=this._featuresetSelectors[i]=[];for(const s of t[i].selectors){if(s.featureNamespace){const t=this.getOwnLayer(s.layer);if(!t){e.w(`Layer is undefined for selector: ${s.layer}`);continue}const o=r(t.source,t.sourceLayer);if(o in n&&n[o]!==s.featureNamespace){e.w(`"featureNamespace ${s.featureNamespace} of featureset ${i}'s selector is not associated to the same source, skip this selector`);continue}n[o]=s.featureNamespace}let t;if(s.properties)for(const n in s.properties){const r=e.X(s.properties[n]);"success"===r.result&&(t=t||{},t[n]=r.value)}o.push({layerId:s.layer,namespace:s.featureNamespace,properties:t,uniqueFeatureID:s._uniqueFeatureID})}}}getFeaturesetDescriptors(e){const t=this.getFragmentStyle(e);if(!t||!t.stylesheet.featuresets)return[];const n=[];for(const r in t.stylesheet.featuresets)n.push({featuresetId:r,importId:t.scope?t.scope:void 0});return n}getFeaturesetLayers(t,n){const r=this.getFragmentStyle(n),i=r.stylesheet.featuresets;if(!i||!i[t])return this.fire(new e.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const o=[];for(const e of i[t].selectors){const t=r.getOwnLayer(e.layer);t&&o.push(t)}return o}getConfigProperty(t,n){const r=this.getFragmentStyle(t);if(!r)return null;const i=e.C(n,r.scope),o=r.options.get(i),s=o?o.value||o.default:null;return s?s.serialize():null}setConfigProperty(t,n,r){const i=this.getFragmentStyle(t);if(!i)return;const o=i.stylesheet.indoor?mr(i.stylesheet.schema):i.stylesheet.schema;if(!o||!o[n])return;const s=e.X(r);if("success"!==s.result)return void xr(this,s.value);const a=s.value.expression,l=e.C(n,i.scope),c=i.options.get(l);if(!c)return;let u;const{minValue:h,maxValue:d,stepValue:f,type:p,values:m}=o[n],g=e.X(o[n].default);"success"===g.result&&(u=g.value.expression),u?(this.options.set(l,Object.assign({},c,{value:a,default:u,minValue:h,maxValue:d,stepValue:f,type:p,values:m})),this.updateConfigDependencies(n)):this.fire(new e.z(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const r=n.stylesheet.schema;if(!r)return null;const i={};for(const o in r){const t=e.C(o,n.scope),r=n.options.get(t),s=r?r.value||r.default:null;i[o]=s?s.serialize():null}return i}setConfig(e,t){const n=this.getFragmentStyle(e);n&&(n.updateConfig(t,n.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const n=this.getFragmentStyle(e);n&&(n.stylesheet.schema=t,n.updateConfig(n._config,t),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const r in n){let i,o;const s=e.X(n[r].default);if("success"===s.result&&(i=s.value.expression),t&&void 0!==t[r]){const n=e.X(t[r]);"success"===n.result&&(o=n.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:h}=n[r];if(i){const t=e.C(r,this.scope);this.options.set(t,{default:i,value:o,minValue:a,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new e.z(new Error(`No schema defined for config option "${r}".`)))}else this.fire(new e.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(e){for(const t of this._configDependentLayers){const n=this.getLayer(t);if(n){if(e&&!n.configDependencies.has(e))continue;n.possiblyEvaluateVisibility(),this._updateLayer(n)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(e=>{const t=e._styleColorTheme.colorThemeOverride?e._styleColorTheme.colorThemeOverride:e._styleColorTheme.colorTheme;if(t){const n=e._evaluateColorThemeData(t);(!e._styleColorTheme.lut&&""!==n||e._styleColorTheme.lut&&n!==e._styleColorTheme.lut.data)&&e.setColorTheme(t)}}),this._changes.setDirty()}addLayer(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=t.id;if(this._layers[i])return void this.fire(new e.z(new Error(`Layer with id "${i}" already exists on this map`)));let o;if("custom"===t.type){if(xr(this,e.dm(t)))return;o=e.dn(t,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof t.source&&(this.addSource(i,t.source),t=e.di(t),t=e.h(t,{source:i})),this._validate(Ee,`layers.${i}`,t,{arrayIndex:-1},r))return;o=e.dn(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}})}0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid);let s=this._order.length;if(n){const t=this._order.indexOf(n);if(-1===t)return void this.fire(new e.z(new Error(`Layer with id "${n}" does not exist on this map.`)));o.slot===this._layers[n].slot?s=t:e.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,i),this._layerOrderChanged=!0,this._layers[i]=o;const a=this.getOwnLayerSourceCache(o),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&o.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(o);if(c&&o.source&&a&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const t=e.C(o.source,o.scope);c.type!==o.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;if(t===n)return;const i=this._order.indexOf(t);this._order.splice(i,1);let o=this._order.length;if(n){const t=this._order.indexOf(n);if(-1===t)return void this.fire(new e.z(new Error(`Layer with id "${n}" does not exist on this map.`)));r.slot===this._layers[n].slot?o=t:e.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),delete this._layers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const r=this.getOwnLayerSourceCache(t);if(r&&r.castsShadows){let e=!1;for(const n in this._layers)if(this._layers[n].source===t.source&&this._layers[n].canCastShadows()){e=!0;break}r.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,n){this._checkLoaded();const r=this._checkLayer(e);r&&(r.minzoom===t&&r.maxzoom===n||(null!=t&&(r.minzoom=t),null!=n&&(r.maxzoom=n),this._updateLayer(r)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,t){this._checkLoaded();const n=this._checkLayer(e);n&&n.slot!==t&&(n.slot=t,this._updateLayer(n))}setFilter(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this._checkLayer(t);if(i&&!e.bv(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(Te,`layers.${i.id}.filter`,n,{layerType:i.type},r)||(i.filter=e.di(n),this._updateLayer(i)))}getFilter(t){const n=this._checkLayer(t);if(n)return e.di(n.filter)}setLayoutProperty(t,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(t);if(o&&!e.bv(o.getLayoutProperty(n),r)){if(null!=r&&(!i||!1!==i.validate)&&xr(o,Ce.call(ge,{key:`layers.${t}.layout.${n}`,layerType:o.type,objectKey:n,value:r,styleSpec:e.a5,style:{glyphs:!0,sprite:!0}})))return;o.setLayoutProperty(n,r),0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid),this._updateLayer(o)}}getLayoutProperty(e,t){const n=this._checkLayer(e);if(n)return n.getLayoutProperty(t)}setPaintProperty(t,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(t);if(!o)return;if(e.bv(o.getPaintProperty(n),r))return;if(null!=r&&(!i||!1!==i.validate)&&xr(o,Ae.call(ge,{key:`layers.${t}.paint.${n}`,layerType:o.type,objectKey:n,value:r,styleSpec:e.a5})))return;const s=o.setPaintProperty(n,r);0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid),s&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(e,t){const n=this._checkLayer(e);if(n)return n.getPaintProperty(t)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:r}=t.target,i=this.getFragmentStyle(r),o=i.getFeaturesetLayers(e);for(const{source:s,sourceLayer:a}of o)i.setFeatureState({id:t.id,source:s,sourceLayer:a},n)}else if("layerId"in t.target){const{layerId:e}=t.target,r=this.getLayer(e);this.setFeatureState({id:t.id,source:r.source,sourceLayer:r.sourceLayer},n)}return}const r=t.source,i=t.sourceLayer,o=this._checkSource(r);if(!o)return;const s=o.type;if("geojson"===s&&i)return void this.fire(new e.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!i)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(r);for(const e of a)e.setFeatureState(i,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:r}=t.target,i=this.getFragmentStyle(r),o=i.getFeaturesetLayers(e);for(const{source:s,sourceLayer:a}of o)i.removeFeatureState({id:t.id,source:s,sourceLayer:a},n)}else if("layerId"in t.target){const{layerId:e}=t.target,r=this.getLayer(e);this.removeFeatureState({id:t.id,source:r.source,sourceLayer:r.sourceLayer},n)}return}const r=t.source,i=this._checkSource(r);if(!i)return;const o=i.type,s="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.z(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(r);for(const e of a)e.removeFeatureState(s,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let n;if("featuresetId"in t.target){const{featuresetId:r,importId:i}=t.target,o=this.getFragmentStyle(i),s=o.getFeaturesetLayers(r);for(const{source:a,sourceLayer:l}of s){const r=o.getFeatureState({id:t.id,source:a,sourceLayer:l});if(r&&!n)n=r;else if(!e.bv(n,r))return void this.fire(new e.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:e}=t.target,r=this.getLayer(e);n=this.getFeatureState({id:t.id,source:r.source,sourceLayer:r.sourceLayer})}return n}const n=t.source,r=t.sourceLayer,i=this._checkSource(n);if(i){if("vector"!==i.type||r)return void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(r,t.id);this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateFilteredLayers(e){for(const t of Object.values(this._mergedLayers))e(t)&&this._updateLayer(t)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),r=e.C(t.source,t.scope),i=this._changes.getUpdatedSourceCaches();t.source&&!i[r]&&n&&"raster"!==n.getSource().type&&(this._changes.updateSourceCache(r,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>this._mergedLayers[e].is3D(!!this.terrain),n=this.order,r={},i=[];for(let s=n.length-1;s>=0;s--){const o=n[s];if(t(o)){r[o]=s;for(const t of e){const e=t[o];if(e)for(const t of e)i.push(t)}}}i.sort((e,t)=>t.intersectionZ-e.intersectionZ);const o=[];for(let s=n.length-1;s>=0;s--){const a=n[s];if(t(a))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(t.layer&&r[t.layer.id]<s)break;o.push(t),i.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)o.push(t.feature)}}return o}queryRenderedFeatures(t,n,r){let i;n&&!Array.isArray(n)&&n.filter&&(this._validate(Te,"queryRenderedFeatures.filter",n.filter,null,n),i=e.b3(n.filter));const o={},s=e=>{if(Sr.has(e.type))return;const t=this.getOwnLayerSourceCache(e),n=o[t.id]=o[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};e.is3D(!!this.terrain)&&(n.has3DLayers=!0),n.layers[e.fqid]=n.layers[e.fqid]||{styleLayer:e,targets:[]},n.layers[e.fqid].targets.push({filter:i})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.z(new Error("parameters.layers must be an Array."))),[];for(const t of n.layers){const n=this._layers[t];if(!n)return this.fire(new e.z(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];s(n)}}else for(const e in this._layers)s(this._layers[e]);const a=this._queryRenderedFeatures(t,o,r),l=this._flattenAndSortRenderedFeatures(a),c=[];for(const u of l)e.dq(u.layer.id)===this.scope&&c.push(u);return c}queryRenderedFeatureset(t,n,r){let i;n&&!Array.isArray(n)&&n.filter&&(this._validate(Te,"queryRenderedFeatures.filter",n.filter,null,n),i=e.b3(n.filter));const o="mock",s=[];if(n&&n.target)s.push(Object.assign({},n,{targetId:o,filter:i}));else{const e=this.getFeaturesetDescriptors();for(const t of e)s.push({targetId:o,filter:i,target:t});for(const{style:t}of this.fragments){const e=t.getFeaturesetDescriptors();for(const t of e)s.push({targetId:o,filter:i,target:t})}}const a=this.queryRenderedTargets(t,s,r),l=[],c=new Set;for(const u of a)for(const t of u.variants[o])lt(t,u,c)||l.push(new e.dr(u,t));return l}queryRenderedTargets(t,n,r){const i={},o=(e,t,n,r)=>{const o=i[t.id]=i[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};if(o.layers[e.fqid]=o.layers[e.fqid]||{styleLayer:e,targets:[]},e.is3D(!!this.terrain)&&(o.has3DLayers=!0),!r)return n.uniqueFeatureID=!1,void o.layers[e.fqid].targets.push(n);o.layers[e.fqid].targets.push(Object.assign({},n,{namespace:r.namespace,properties:r.properties,uniqueFeatureID:r.uniqueFeatureID}))};for(const a of n)if("featuresetId"in a.target){const{featuresetId:t,importId:n}=a.target,r=this.getFragmentStyle(n);if(!r||!r._featuresetSelectors)continue;const i=r._featuresetSelectors[t];if(!i){this.fire(new e.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const e of i){const t=r.getOwnLayer(e.layerId);t&&!Sr.has(t.type)&&o(t,r.getOwnLayerSourceCache(t),a,e)}}else if("layerId"in a.target){const{layerId:e}=a.target,t=this.getLayer(e);if(!t||Sr.has(t.type))continue;o(t,this.getLayerSourceCache(t),a)}const s=this._queryRenderedFeatures(t,i,r);return this._flattenAndSortRenderedFeatures(s)}_queryRenderedFeatures(e,t,n){const r=[],i=!!this.map._showQueryGeometry,o=Ze.createFromScreenPoints(e,n);for(const s in t){const e=ct(o,t[s],this._availableImages,n,i);Object.keys(e).length&&r.push(e)}if(this.placement)for(const s in t){if(!t[s].sourceCache._onlySymbols)continue;const e=ut(o.screenGeometry,t[s],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(e).length&&r.push(e)}return r}querySourceFeatures(e,t){const n=t&&t.filter;n&&this._validate(Te,"querySourceFeatures.filter",n,null,t);let r=[];const i=this.getOwnSourceCaches(e);for(const o of i)r=r.concat(ht(o,t));return r}addSourceType(e,t,n){return Ar.getSourceType(e)?n(new Error(`A source type called "${e}" already exists.`)):(Ar.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this.light.getLight();let o=!1;for(const a in t)if(!e.bv(t[a],i[a])){o=!0;break}if(!o)return;const s=this._getTransitionParameters();this.light.setLight(t,n,r),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===n&&delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let r=t;const i=null==t.source;if(1===n){if(this.disableElevatedTerrain)return;if("object"==typeof r.source){const t="terrain-dem-src";this.addSource(t,r.source),r=e.di(r),r=e.h(r,{source:t})}const t=e.h({},r),n={};if(this.terrain&&i){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(n.style=e.serialize())}if(this._validate(xe,"terrain",t,n))return}if(!this.terrain||this.terrain.scope!==this.scope&&!i||this.terrain&&n!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,n),this.fire(new e.A("data",{dataType:"style"}))}else{const n=this.terrain,i=n.get();for(const t of Object.keys(e.a5.terrain))!r.hasOwnProperty(t)&&e.a5.terrain[t].default&&(r[t]=e.a5.terrain[t].default);for(const r in t)if(!e.bv(t[r],i[r])){n.set(t,this.options),this.stylesheet.terrain=t;const r=this._getTransitionParameters({duration:0});n.updateTransitions(r),this.fire(new e.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new Ue(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_createSnow(e){const t=this.snow=new We(e,this.map.transform,this.scope,this.options);this.stylesheet.snow=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_createRain(e){const t=this.rain=new qe(e,this.map.transform,this.scope,this.options);this.stylesheet.rain=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const r=this._evaluateColorThemeData(n);this._loadColorTheme(r).then(()=>{this.fire(new e.A("colorthemeset")),t()}).catch(t=>{e.w(`Couldn't set color theme: ${t}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&e.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(e,t){const n=this.getFragmentStyle(e);n&&(n._styleColorTheme.colorThemeOverride=t,n._reloadColorTheme())}_getTransitionParameters(t){return{now:e.q.now(),transition:e.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const n of this._mergedOrder)this.isLayerDraped(this._mergedLayers[n])?e.push(n):t.push(n);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const n=this.terrain=new Oe(e,t,this.scope,this.options,this.map.getWorldview());1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const r=this._getTransitionParameters({duration:0});n.updateTransitions(r)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,n,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(o&&!1===o.validate)return!1;const s=e.h({},this.serialize());return xr(this,t.call(ge,e.h({key:n,style:s,value:r,styleSpec:e.a5},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const n of t)n.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}clearLayers(){for(const e in this._mergedLayers){const t=this._mergedLayers[e];t._clear&&t._clear()}}reloadSource(e){const t=this.getSourceCaches(e);for(const n of t)n.resume(),n.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(e=>{e.modelManager.reloadModels(e.scope)})}updateSources(e){let t;this.directionalLight&&(t=ar(this.directionalLight));const n=new Set;for(const r in this._mergedLayers){const e=this._mergedLayers[r];e.hasElevation()&&!n.has(e.source)&&n.add(e.source)}for(const r in this._mergedSourceCaches){const i=this._mergedSourceCaches[r],o=n.has(i._source.id);i.update(e,void 0,void 0,t,o)}}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,n,r,i,o,s){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!1,c=!1;const u={},h={};for(const d of this._mergedOrder){const t=this._mergedLayers[d];if("symbol"!==t.type)continue;const r=e.C(t.source,t.scope);let i=u[r];if(!i){const e=this.getLayerSourceCache(t);if(!e)continue;const n=e.getRenderableIds(!0).map(t=>e.getTileByID(t));h[r]=n.slice(),i=u[r]=n.sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const o=this.crossTileSymbolIndex.addLayer(t,i,n.center.lng,n.projection);l=l||o}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),a=a||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new e.A("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.q.now(),n.zoom))&&(this.pauseablePlacement=new Rn(n,this._mergedOrder,a,r,i,o,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,u,h,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.q.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(n.zoom);for(let t=0;t<this._mergedOrder.length;t++){const n=this._mergedLayers[this._mergedOrder[t]];if("symbol"!==n.type)continue;const r=this.isLayerClipped(n);this.placement.updateLayerOpacities(n,u[e.C(n.source,n.scope)],t,r?s:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.q.now())}}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const r=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==r.findIndex(e=>{let{id:n}=e;return n===t.id}))return void this.fire(new e.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return r.push(t),this._loadImports([t],!0);const i=r.findIndex(e=>{let{id:t}=e;return t===n});return-1===i&&this.fire(new e.z(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=r.slice(0,i).concat(t).concat(r.slice(i)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const r=this.stylesheet.imports||[],i=this.getImportIndex(t);return-1===i?this:"string"==typeof n?(this.setImportUrl(t,n),this):(n.url&&n.url!==r[i].url&&this.setImportUrl(t,n.url),e.bv(n.config,r[i].config)||this.setImportConfig(t,n.config,n.data.schema),e.bv(n.data,r[i].data)||this.setImportData(t,n.data),this)}moveImport(e,t){this._checkLoaded();let n=this.stylesheet.imports||[];const r=this.getImportIndex(e);if(-1===r)return this;const i=this.getImportIndex(t);if(-1===i)return this;const o=n[r],s=this.fragments[r];return n=n.filter(t=>{let{id:n}=t;return n!==e}),this.fragments=this.fragments.filter(t=>{let{id:n}=t;return n!==e}),this.stylesheet.imports=n.slice(0,i).concat(o).concat(n.slice(i)),this.fragments=this.fragments.slice(0,i).concat(s).concat(this.fragments.slice(i)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const n=this.stylesheet.imports||[],r=this.getImportIndex(e);if(-1===r)return this;n[r].url=t;const i=this.fragments[r];return i.style=this._createFragmentStyle(n[r]),i.style.on("style.import.load",()=>this.mergeAll()),i.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const n=this.getImportIndex(e),r=this.stylesheet.imports||[];return-1===n?this:t?(this.fragments[n].style.setState(t),this._reloadImports(),this):(delete r[n].data,this.setImportUrl(e,r[n].url))}setImportConfig(e,t,n){this._checkLoaded();const r=this.getImportIndex(e),i=this.stylesheet.imports||[];if(-1===r)return this;t?i[r].config=t:delete i[r].config;const o=this.fragments[r];n&&o.style.stylesheet&&(o.style.stylesheet.schema=n);const s=o.style.stylesheet&&o.style.stylesheet.schema;return o.config=t,o.style.updateConfig(t,s),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],n=this.getImportIndex(e);-1!==n&&(t.splice(n,1),this.fragments[n].style._remove(),this.fragments.splice(n,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(e=>e.id===t);return-1===n&&this.fire(new e.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const n=this._mergedOtherSourceCaches[t];n&&e.push(n.getSource())}return e}getSource(e,t){const n=this.getSourceCache(e,t);return n&&n.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,n){const r=e.C(t,n);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(t){const n=e.C(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const n=e[t];"reload"===n?this.reloadSource(t):"clear"===n&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const n of t){const t=this.getLayer(n);t&&t.updateTransitions(e)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(e){this.stylesheet.glyphs=e,this.glyphManager.setURL(e)}getImages(t,n,r){this.imageManager.getImages(n.images,n.scope,r),this._updateTilesForChangedImages();const i=t=>{if(t){const r=n.images.map(t=>e.I.toString(t));t.setDependencies(n.tileID.key,n.type,r)}},o=e.C(n.source,n.scope);i(this._mergedOtherSourceCaches[o]),i(this._mergedSymbolSourceCaches[o]),n.images.some(e=>e.iconsetId)&&this.fire(new e.A("data",{dataType:"style"}))}rasterizeImages(e,t,n){this.imageManager.rasterizeImages(t,n)}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)}getResource(t,n,r){return e.dt(n,r)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return 0===n.length?(this.fire(new e.z(new Error(`There is no source with ID '${t}'`))),!1):n.every(e=>e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,t){if(!this._clipLayerPresent&&"fill-extrusion"!==e.type&&"building"!==e.type)return!1;const n="fill-extrusion"===e.type&&("building"===e.sourceLayer||"procedural_buildings"===e.sourceLayer),r="building"===e.type;if(e.is3D(!!this.terrain)){if(n||r||t&&"batched-model"===t.type)return!0;if("model"===e.type)return!0}else if("symbol"===e.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(e=>{e.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ar.getSourceType=function(e){return ot[e]},Ar.setSourceType=function(e,t){ot[e]=t},Ar.registerForPluginStateChange=e.du;var Cr="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Pr="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Ir="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",kr="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Mr="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",Rr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Or="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Lr="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Dr="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Nr="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",zr="#ifdef RENDER_SHADOWS\nprecision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {\n#ifdef CLIP_ZERO_TO_ONE\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);\n#else\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);\n#endif\nreturn texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;\n#ifdef SHADOWS_SINGLE_CASCADE\nvec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);\n#else\nlight_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Fr=[];Hr(Cr,Fr),Hr(Ir,Fr),Hr(Pr,Fr);const Br={"_prelude_fog.vertex.glsl":Rr,"_prelude_terrain.vertex.glsl":Mr,"_prelude_shadow.vertex.glsl":Nr,"_prelude_fog.fragment.glsl":Or,"_prelude_shadow.fragment.glsl":zr,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Lr,"_prelude_raster_particle.glsl":Dr},jr={};$r("",Mr),$r(Or,Rr),$r(zr,Nr),$r(Lr,""),$r(Dr,"");const Ur=$r(Pr,Ir),Vr=Cr;var Gr={background:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nconst float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nin lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;\n#endif\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\nuniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}\n#ifdef BUILDING_FAUX_FACADE\nfloat hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;\n#if 0\nif (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;\n#else\nif (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;\n#endif\nreturn out_color;}\n#endif\nvec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;\n#ifdef BUILDING_FAUX_FACADE\nif (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}\n#endif\nvec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nshadowed_lighting_factor=dot(normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));\n#endif\ncolor.rgb=linearTosRGB(color.rgb);color*=u_opacity;\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_pos.z);\n#endif\nglFragColor=color; \n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nout lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nconst float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#ifdef BUILDING_FAUX_FACADE\nmat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}\n#endif\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;\n#ifdef BUILDING_FAUX_FACADE\nv_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}\n#endif\nv_pos=a_pos_3f;\n#ifdef RENDER_CUTOFF\nvec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=v_pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(v_pos);\n#endif\ngl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}'),buildingBloom:$r("in vec4 v_color_emissive;\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\nfloat saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;\n#ifdef HAS_ATTRIBUTE_a_bloom_attenuation\nfloat distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);\n#endif\nglFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}","in vec3 a_pos_3f;\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\nout vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\n#ifdef HAS_ATTRIBUTE_a_part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);\n#else\nv_color_emissive=vec4(1.0);\n#endif\ngl_Position=u_matrix*vec4(a_pos_3f,1.0);}"),buildingDepth:$r("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:$r("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$r('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:$r("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$r("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;\n#endif\nout float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);\n#ifdef PROJECTION_GLOBE_VIEW\n#ifndef PROJECTED_POS_ON_VIEWPORT\nvec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);\n#endif\n#endif\nvec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:$r("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:$r("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:$r("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:$r("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)\n{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nvec3 color=structure_color.xyz;\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,transformed_normal);\n#endif\ncolor=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nv_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef FLIP_Y\nv_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FLIP_Y\nv_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\n#ifdef CLIP_ZERO_TO_ONE\ncutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);\n#else\ncutoff=cutoff_opacity(u_cutoff_params,ground.z);\n#endif\nif (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:$r("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:$r('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:$r("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:$r("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:$r("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:$r("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:$r('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:$r('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef TERRAIN\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#else\nout_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n}'),terrainRaster:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:$r("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:$r('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',kr),skyboxGradient:$r('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',kr),skyboxCapture:$r("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:$r('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:$r('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\n#ifdef FLIP_Y\nT=-T;B=-B;\n#endif\nhighp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));\n#ifdef FLIP_Y\nn=normalize(cross(fdx,fdy));\n#else\nn=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\n#ifdef FEATURE_CUTOUT\nfinalColor=apply_feature_cutout(finalColor,gl_FragCoord);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:$r("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:$r("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:$r("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:$r("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:$r("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:$r("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Hr(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let r of n)if(r=r.trim(),"#"===r[0]&&r.includes("if")&&!r.includes("endif")){r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=r.split(" ");for(const n of e)t.includes(n)||t.push(n)}}function $r(e,t){const n=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let i=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);i&&(i=i.map(e=>{const t=e.split(" ");return t[t.length-1]}),i=[...new Set(i)]);const o={},s=[],a=[];if(e=e.replace(n,(e,t)=>(a.push(t),"")),(t=t.replace(n,(e,t)=>(s.push(t),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...Fr];Hr(e,l),Hr(t,l);for(const c of[...s,...a])Br[c]||console.error(`Undefined include: ${c}`),jr[c]||(jr[c]=[],Hr(Br[c],jr[c])),l=[...l,...jr[c]];return{fragmentSource:e=e.replace(r,(e,t,n,r,i)=>(o[i]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nin ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    in ${n} ${r} ${i};\n#endif\n`:"initialize-attribute"===t?"":void 0)),vertexSource:t=t.replace(r,(e,t,n,r,i)=>{const s="float"===r?"vec2":r,a=i.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\nin ${n} ${r} a_${i};\n#endif\n`:o[i]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nin ${n} ${s} a_${i};\nout ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"initialize"===t?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = unpack_mix_${a}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    in ${n} ${r} a_${i};\n    out ${n} ${r} ${i};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    ${i} = a_${i};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nin ${n} ${s} a_${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"define-instanced"===t?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${i}0;\nin vec4 a_${i}1;\nin vec4 a_${i}2;\nin vec4 a_${i}3;\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${n} ${s} a_${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    ${n} ${r} ${i} = a_${i};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = unpack_mix_${a}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`}),staticAttributes:i,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class Wr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,n,r,i,o,s,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let u=0;!l&&u<r.length;u++)this.boundPaintVertexBuffers[u]!==r[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let u=0;!c&&u<s.length;u++)this.boundDynamicVertexBuffers[u]!==s[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||l||c||this.boundIndexBuffer!==i||this.boundVertexOffset!==o)this.freshBind(t,n,r,i,o,s,a);else{e.bindVertexArrayOES.set(this.vao);for(const n of s)n&&(n.bind(),a&&n.instanceCount&&n.setVertexAttribDivisor(e.gl,t,a));i&&i.dynamicDraw&&i.bind()}}freshBind(e,t,n,r,i,o,s){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,i);for(const u of n)u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,i);for(const u of o)u&&(u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,i),s&&u.instanceCount&&u.setVertexAttribDivisor(c,e,s));r&&r.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function qr(t,n){const r=Math.pow(2,n.canonical.z),i=n.canonical.y;return[new e.ac(0,i/r).toLngLat().lat,new e.ac(0,(i+1)/r).toLngLat().lat]}function Xr(t,n,r,i,o,s,a){const l=t.context,c=l.gl,u=r.hillshadeFBO;if(!u)return;t.prepareDrawTile();const h=t.isTileAffectedByFog(n),d=t.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const f=((t,n,r,i)=>{const o=r.paint.get("hillshade-shadow-color"),s="none"===r.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),a=r.paint.get("hillshade-highlight-color"),l="none"===r.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),c=r.paint.get("hillshade-accent-color"),u="none"===r.paint.get("hillshade-accent-color-use-theme").constantOr("default"),h=r.paint.get("hillshade-emissive-strength");let d=e.al(r.paint.get("hillshade-illumination-direction"));if("viewport"===r.paint.get("hillshade-illumination-anchor"))d-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const n=t.style.directionalLight.properties.get("direction"),r=e.d1(n.x,n.y,n.z);d=e.al(r[1])}const f=!t.options.moving;return{u_matrix:i||t.transform.calculateProjMatrix(n.tileID.toUnwrapped(),f),u_image:0,u_latrange:qr(0,n.tileID),u_light:[r.paint.get("hillshade-exaggeration"),d],u_shadow:o.toPremultipliedRenderColor(s?null:r.lut),u_highlight:a.toPremultipliedRenderColor(l?null:r.lut),u_emissive_strength:h,u_accent:c.toPremultipliedRenderColor(u?null:r.lut)}})(t,r,i,t.terrain?n.projMatrix:null);t.uploadCommonUniforms(l,d,n.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=t.getTileBoundsBuffers(r);d.draw(t,c.TRIANGLES,o,s,a,$n.disabled,f,i.id,p,m,g)}function Zr(t,n,r){if(!n.needsDEMTextureUpload)return;const i=t.context,o=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(r.stride);const s=r.getPixels();n.demTexture?n.demTexture.update(s,{premultiply:!1}):n.demTexture=new e.T(i,s,o.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Kr(t,n,r){const i=t.context,o=i.gl;if(!n.dem)return;const s=n.dem;if(i.activeTexture.set(o.TEXTURE1),Zr(t,n,s),!n.demTexture)return;n.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const a=s.dim;i.activeTexture.set(o.TEXTURE0);let l=n.hillshadeFBO;if(!l){const t=new e.T(i,{width:a,height:a,data:null},o.RGBA8);t.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=n.hillshadeFBO=i.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}i.bindFramebuffer.set(l.framebuffer),i.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=t.getMercatorTileBoundsBuffers(),d=[];t.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(t,o.TRIANGLES,jn.disabled,Vn.disabled,Bn.unblended,$n.disabled,((t,n)=>{const r=n.stride,i=e.bz();return e.ca(i,0,e.aj,-e.aj,0,0,1),e.bo(i,i,[0,-e.aj,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ}})(n.tileID,s),r.id,c,u,h),n.needsHillshadePrepare=!1}class Yr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jr extends Yr{getDefault(){return e.am.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Qr extends Yr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ei extends Yr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ti extends Yr{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ni extends Yr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class ri extends Yr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ii extends Yr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class oi extends Yr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class si extends Yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class ai extends Yr{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class li extends Yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class ci extends Yr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ui extends Yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class hi extends Yr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class di extends Yr{getDefault(){return e.am.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class fi extends Yr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class pi extends Yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class mi extends Yr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class gi extends Yr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let _i=class extends Yr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class yi extends Yr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class vi extends Yr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class xi extends Yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class bi extends Yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class wi extends Yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Si extends Yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ei extends Yr{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ti extends Yr{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class Ai extends Yr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ci extends Yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Pi extends Yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ii extends Yr{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class ki extends Ii{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Mi extends Ii{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ri extends Ii{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Oi extends Mi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Li=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),Di=(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:n,u_zoom_transition:i,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:f,u_far_z_cutoff:p});function Ni(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const zi=new class{constructor(){this.operations={}}newMorphing(e,t,n,r,i){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:r,phase:0,duration:i,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},Fi={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Bi(e,t,n){if(0===t)return 0;const r=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*r}function ji(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const Ui=e=>({u_matrix:e});function Vi(t,n,r,i,o){if(o>0){const s=e.q.now(),a=(s-t.timeAdded)/o,l=n?(s-n.timeAdded)/o:-1,c=r.getSource(),u=i.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.ay(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class Gi extends At{constructor(e){const t=st("mock-dem",{type:"raster-dem",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("mock-dem",t,!1),t.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Hi extends At{constructor(e){const t=st("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,n){if(e.freezeTileCoverage)return;this.transform=e;const r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((t,n)=>{if(t[n.key]="",!this._tiles[n.key]){const t=new wt(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom,void 0,void 0,this._source.worldview);t.state="loaded",this._tiles[n.key]=t}return t},{});for(const i in this._tiles)i in r||(this.freeFBO(i),this._tiles[i].unloadVectorData(),delete this._tiles[i])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class $i extends e.aM{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class Wi extends e.dF{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,i,o]=function(){const t=new e.ba,n=new e.a_,r=131;t.reserve(17161),n.reserve(33800);const i=e.aj/128,o=e.aj+i/2,s=o+i;for(let l=-i;l<s;l+=i)for(let n=-i;n<s;n+=i){const r=n<0||n>o||l<0||l>o?24575:0,i=e.ay(Math.round(n),0,e.aj),s=e.ay(Math.round(l),0,e.aj);t.emplaceBack(i+r,s)}const a=(e,t)=>{const i=t*r+e;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)a(t,e);return[0,129].forEach(e=>{for(let t=0;t<130;t++)a(t,e),a(e,t)}),[t,n,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(r,e.bc.members),this.gridIndexBuffer=s.createIndexBuffer(i),this.gridSegments=e.bd.simpleSegment(0,0,r.length,i.length),this.gridNoSkirtSegments=e.bd.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Hi(n.map),this.orthoMatrix=e.bz(),e.ca(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.aj,0,e.aj,0,1);const a=s.gl;this._overlapStencilMode=new Vn({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gi(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,r){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const i=t.terrain.properties,o=0===t.terrain.drapeRenderMode,s=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.q.now();const a=t.terrain&&t.terrain.scope,l=i.get("source"),c=o?this._mockSourceCache:t.getSourceCache(l,a);if(!c)return void e.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=s?this.calculateExaggeration(n):i.get("exaggeration"),!n.projection.requiresDraping&&s&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(n,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),n.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,r=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=r;const i=null!=n?r-n:Number.MAX_VALUE;if(Math.abs(i)<2)return this._exaggeration;const o=t.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(o);let a=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(a=.5*(o-c+a)),a*i<0&&(c+=a)),this._evaluationZoom=c;const u=s.getExaggeration(c),h=u===s.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(a)<1e-4)&&(d=Math.min(.2,4*d)),e.ai(this._exaggeration,u,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(e.ac.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const i=this.proxyCoords=n.getIds().map(e=>{const t=n.getTileByID(e).tileID;return t.projMatrix=r.calculateProjMatrix(t.toUnwrapped()),t});!function(t,n){const r=n.transform.pointCoordinate(n.transform.getCameraPoint()),i=new e.P(r.x,r.y);t.sort((t,n)=>{if(n.overscaledZ-t.overscaledZ)return n.overscaledZ-t.overscaledZ;const r=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.P(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),s=i.mult(1<<t.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(r)-s.distSqr(o)})}(i,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},i.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const e in s){const n=s[e];if(!n.used)continue;if(n!==this.sourceCache&&this.resetTileLookupCache(n.id),this._setupProxiedCoordsForOrtho(n,t[e],o),n.usedForTerrain)continue;const r=t[e];n.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[n.id]=i.map(e=>new $i(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(i),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const n=t.tileID.key;n in a||(this._visibleDemTiles.push(t),a[n]=n)}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const r=this.terrainTileForTile[n],i=r.dem;!i||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Zr(this.painter,r,i))}}_prepareDemTileUniforms(e,t,n,r){if(!t||null==t.demTexture)return!1;const i=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-i.z),s=r||"";return n[`u_dem_tl${s}`]=[i.x*o%1,i.y*o%1],n[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0;const t=this._visibleDemTiles.reduce((t,n)=>{if(!n.dem)return t;const r=n.dem.tree.minimums[0];return r>0&&e++,t+r},0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const r=this._getLoadedAreaMinimum(),i=new e.dG({width:1,height:1},new Float32Array([r]));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(i,{premultiply:!1}):o=this._emptyDEMTexture=new e.T(t,i,n.R32F,{premultiply:!1}),o}setupElevationDraw(t,n,r){const i=this.painter.context,o=i.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(r&&r.morphing&&this._useVertexMorphing){const e=r.morphing.srcDemTile,n=r.morphing.dstDemTile;c=r.morphing.phase,e&&n&&(this._prepareDemTileUniforms(t,e,s,"_prev")&&(l=e),this._prepareDemTileUniforms(t,n,s)&&(a=n))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST;let h=null;var d;if(this.enabled?l&&a?(h=a.demTexture,i.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),s.u_dem_lerp=c):(a=this.terrainTileForTile[t.tileID.key],h=this._prepareDemTileUniforms(t,a,s)?a.demTexture:this.emptyDEMTexture):h=this.emptyDEMTexture,i.activeTexture.set(o.TEXTURE2),h&&(s.u_dem_size=1===(d=h).size[0]?1:d.size[0]-2,h.bind(u(a),o.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(r&&r.useDepthForOcclusion,n,s),r&&r.useMeterToDem&&a){const t=(1<<a.tileID.canonical.z)*e.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=t}if(r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),n.setTerrainUniformValues(i,s),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,r&&r.useDenormalizedUpVectorScale);n.setGlobeUniformValues(i,e)}}globeUniformValues(t,n,r){const i=t.projection;return{u_tile_tl_up:i.upVector(n,0,0),u_tile_tr_up:i.upVector(n,e.aj,0),u_tile_br_up:i.upVector(n,e.aj,e.aj),u_tile_bl_up:i.upVector(n,0,e.aj),u_tile_up_scale:r?e.dH(1):i.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,r=this.painter.context;0!==t.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,n,r,i,o){if("globe"===t.transform.projection.name)!function(t,n,r,i,o){const s=t.context,a=s.gl;let l,c;const u=t.transform,h=e.dy(t,s,u),d=(e,n)=>{if(c===n)return;const r=[Fi[n],"PROJECTION_GLOBE_VIEW"];h&&r.push("CUSTOM_ANTIALIASING");const i=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:r,overrideFog:i}),c=n},f=t.colorModeForRenderPass(),p=new jn(a.LEQUAL,jn.ReadWrite,t.depthRangeFor3D);zi.update(o);const m=e.dz(u),g=[e.aD(u.center.lng),e.aH(u.center.lat)],_=t.globeSharedBuffers,y=[u.width*e.q.devicePixelRatio,u.height*e.q.devicePixelRatio],v=Float32Array.from(u.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const u=t.transform,h=Bi(u.zoom,n.exaggeration(),n.sourceCache._source.tileSize);c=-1;const b=a.TRIANGLES;for(const c of i){const i=r.getTile(c),w=Vn.disabled,S=n.prevTerrainTileForTile[c.key],E=n.terrainTileForTile[c.key];Ni(S,E)&&zi.newMorphing(c.key,S,E,o,250),s.activeTexture.set(a.TEXTURE0),i.texture&&i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=zi.getMorphValuesForProxy(c.key),A=T?1:0;T&&e.L(x,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.dx(T.phase)}});const C=e.dA(c.canonical),P=e.dB(C.getCenter().lat),I=e.dC(c.canonical,C,P,u.worldSize/u._pixelsPerMercatorPixel),k=e.bh(e.dD(c.canonical)),M=Di(u.expandedFarZProjMatrix,v,m,k,e.ah(u.zoom),g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,h,u._farZ,I);if(d(c,A),l&&(n.setupElevationDraw(i,l,x),t.uploadCommonUniforms(s,l,c.toUnwrapped()),_)){const[e,n,r]=_.getGridBuffers(P,0!==h);l.draw(t,b,p,w,f,$n.backCCW,M,"globe_raster",e,n,r)}}}if(_&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:o});for(const c of i){const{x:i,y:o,z:h}=c.canonical,d=0===o,m=o===(1<<h)-1,[v,b,w,S]=_.getPoleBuffers(h,!1);if(S&&(d||m)){const o=r.getTile(c);s.activeTexture.set(a.TEXTURE0),o.texture&&o.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=e.dE(h,i,u);const E=e.bh(e.dD(c.canonical)),T=(e,n)=>e.draw(t,a.TRIANGLES,p,Vn.disabled,f,$n.disabled,Di(u.expandedFarZProjMatrix,_,_,E,0,g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0,u._farZ),"globe_pole_raster",n,w,S);n.setupElevationDraw(o,l,x),t.uploadCommonUniforms(s,l,c.toUnwrapped()),d&&t.renderDefaultNorthPole&&T(l,v),m&&t.renderDefaultSouthPole&&(_=e.cP(e.bz(),_,[1,-1,1]),T(l,b))}}}}(t,n,r,i,o);else{const s=t.context,a=s.gl;let l,c;const u=t.shadowRenderer,h=tr(t,t.longestCutoffRange),d=e=>{if(c===e)return;const n=[];n.push(Fi[e]),h.shouldRenderCutoff&&n.push("RENDER_CUTOFF"),u&&(n.push("RENDER_SHADOWS","DEPTH_TEXTURE"),u.useNormalOffset&&n.push("NORMAL_OFFSET")),l=t.getOrCreateProgram("terrainRaster",{defines:n}),c=e},f=t.colorModeForRenderPass(),p=new jn(a.LEQUAL,jn.ReadWrite,t.depthRangeFor3D);zi.update(o);const m=t.transform,g=Bi(m.zoom,n.exaggeration(),n.sourceCache._source.tileSize);let _=[0,0,0];if(u){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(_=lr(t.style,e,n))}{c=-1;const y=a.TRIANGLES,[v,x]=[n.gridIndexBuffer,n.gridSegments];for(const c of i){const i=r.getTile(c),b=Vn.disabled,w=n.prevTerrainTileForTile[c.key],S=n.terrainTileForTile[c.key];Ni(w,S)&&zi.newMorphing(c.key,w,S,o,250),s.activeTexture.set(a.TEXTURE0),i.texture&&i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const E=zi.getMorphValuesForProxy(c.key),T=E?1:0;let A;E&&(A={morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:e.dx(E.phase)}});const C=Li(c.projMatrix,ji(c.canonical,m.renderWorldCopies)?g/10:g,_);if(d(T),!l)continue;n.setupElevationDraw(i,l,A);const P=c.toUnwrapped();u&&u.setupShadows(P,l),t.uploadCommonUniforms(s,l,P,null,h),l.draw(t,y,p,b,f,$n.backCCW,C,"terrain_raster",n.gridBuffer,v,x)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const n=this.painter,r=this.painter.context,i=this.proxySourceCache,o=this.proxiedCoords[i.id],s=this._drapedRenderBatches.shift(),a=n.style.order,l=[];let c=0;for(const u of o){const o=i.getTileByID(u.proxyTileKey),h=i.proxyCachedFBO[u.key]?i.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?i.renderCache[h]:this.pool[c++],f=void 0!==h;if(o.texture=d.tex,f&&!d.dirty){l.push(o.tileID);continue}let p;r.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(r.clear({color:e.am.transparent,stencil:0}),d.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=n.style._mergedLayers[a[e]];if(t.isHidden(n.transform.zoom))continue;const i=n.style.getLayerSourceCache(t),o=i?this.proxyToSource[u.key][i.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,d.fb.width,d.fb.height]),p!==(i?i.id:null)&&(this._setupStencil(d,o,t,i),p=i?i.id:null),n.renderLayer(n,i,t,s)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=n.style._mergedLayers[a[e]];if(t.isHidden(n.transform.zoom))continue;const i=n.style.getLayerSourceCache(t),o=i?this.proxyToSource[u.key][i.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,d.fb.width,d.fb.height]),p!==(i?i.id:null)&&(this._setupStencil(d,o,t,i),p=i?i.id:null),n.renderLayer(n,i,t,s)}this.renderedToTile?(d.dirty=!0,l.push(o.tileID)):f||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,n.width,n.height]),s.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let n=-1,r=t;for(let i=0;i<t;++i)this._style.isLayerDraped(e._mergedLayers[e.order[i]])?n=Math.max(n,i):r=Math.min(r,i);return r>n}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(t=>{e=Math.min(e,t.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter(e=>e.dem).map(r=>{const i=r.tileID,o=1<<i.overscaledZ,{x:s,y:a}=i.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:r.dem.tree.raycastRoot(l,u,c,h,e,t,n),tile:r}});r.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const i of r){if(null==i.t)return null;const r=i.tile.dem.tree.raycast(i.minx,i.miny,i.maxx,i.maxy,e,t,n);if(null!=r)return r}return null}_createFBO(){const t=this.painter.context,n=t.gl,r=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const i=new e.T(t,{width:r[0],height:r[1],data:null},n.RGBA8);i.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=t.createFramebuffer(r[0],r[1],!0,null);return o.colorAttachment.set(i.texture),o.depthAttachment=new Oi(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:i,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const t=this._style._mergedLayers[e],n=t.isHidden(this.painter.transform.zoom);return"hillshade"===t.type||"custom"===t.type?!n&&t.shouldRedrape():!n&&t.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof nt){t=!0;break}if(!t)return;const n={};for(let r=0;r<this._style.order.length;++r){const t=this._style._mergedLayers[this._style.order[r]],i=this._style.getLayerSourceCache(t);if(i&&!n[i.id]&&!t.isHidden(this.painter.transform.zoom)&&"line"===t.type&&t.widthExpression()instanceof e.ab){n[i.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][i.id];if(t)for(const e of t)this._clearRenderCacheForTile(i.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n]._source instanceof rt){e=!0;break}if(!e)return;const t={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],r=this._style.getLayerSourceCache(e);if(!r||t[r.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const i=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e){const e=Vi(r.getTile(t),r.findLoadedParent(t,0),r,this.painter.transform,i);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(r.id,t)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(0===n)return;const r=[];this._pendingGroundEffectLayers=[];let i,o=0,s=this._style._mergedLayers[t[o]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++o<n;)s=this._style._mergedLayers[t[o]];for(;o<n;++o){const e=this._style._mergedLayers[t[o]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===i&&(i=o):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(o),void 0!==i&&(r.push({start:i,end:o-1}),i=void 0)))}if(void 0!==i&&r.push({start:i,end:o-1}),0!==r.length){const t=r[r.length-1];this._pendingGroundEffectLayers.every(e=>e>t.end)||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const r=Object.values(e[n]);t.renderCachePool.push(...r)}}return}this._clearRasterLayersFromRenderCache();const n=this.proxyCoords,r=this._tilesDirty;for(let o=n.length-1;o>=0;o--){const i=n[o];if(t.getTileByID(i.key),void 0!==t.proxyCachedFBO[i.key]){const n=e[i.key],o=this.proxyToSource[i.key];let s=0;for(const e in o){const t=o[e],i=n[e];if(!i||i.length!==t.length||t.some((t,n)=>t!==i[n]||r[e]&&r[e].hasOwnProperty(t.key))){s=-1;break}++s}for(const e in t.proxyCachedFBO[i.key])t.renderCache[t.proxyCachedFBO[i.key][e]].dirty=s<0||s!==Object.values(n).length}}const i=[...this._drapedRenderBatches];i.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const o of i)for(const e of n){if(t.proxyCachedFBO[e.key])continue;let n=t.renderCachePool.pop();void 0===n&&t.renderCache.length<50&&(n=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==n&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][o.start]=n,t.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,n,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,o=i.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(n.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(i.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Vn.disabled}_renderTileClippingMasks(e,t){const n=this.painter,r=this.painter.context,i=r.gl;n._tileClippingMaskIDs={},r.setColorMode(Bn.disabled),r.setDepthMode(jn.disabled);const o=n.getOrCreateProgram("clippingMask");for(const s of e){const e=n._tileClippingMaskIDs[s.key]=--t;o.draw(n,i.TRIANGLES,jn.disabled,new Vn({func:i.ALWAYS,mask:0},e,255,i.KEEP,i.KEEP,i.REPLACE),Bn.disabled,$n.disabled,Ui(s.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const r=[t.x,t.y,1,1];e.aA(r,r,n.pixelMatrixInverse),e.cH(r,r,1/r[3]),r[0]/=n.worldSize,r[1]/=n.worldSize;const i=n._camera.position,o=e.cb(1,n.center.lat),s=[i[0],i[1],i[2]/o,0],a=e.d7([],r.slice(0,3),s);e.au(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(e.bE(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}_setupProxiedCoordsForOrtho(t,n,r){if(t.getSource()instanceof e.aP)return this._setupProxiedCoordsForImageSource(t,n,r);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const i=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let e=0;e<o.length;e++){const n=o[e],s=this._findTileCoveringTileID(n,t);if(s){const e=this._createProxiedId(n,s,r[n.key]&&r[n.key][t.id]);i.push(e),this.proxyToSource[n.key][t.id]=[e]}}let s=!1;const a=new Set;for(let e=0;e<n.length;e++){const o=t.getTile(n[e]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],n=this._createProxiedId(l.tileID,o,r[l.tileID.key]&&r[l.tileID.key][t.id]);e?e.splice(e.length-1,0,n):this.proxyToSource[l.tileID.key][t.id]=[n];const c=this.proxyToSource[l.tileID.key][t.id];a.has(c)||a.add(c),i.push(n),s=!0}}if(this._sourceTilesOverlap[t.id]=s,s&&this._debugParams.sortTilesHiZFirst)for(const e of a)e.sort((e,t)=>t.overscaledZ-e.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,r){if(!t.getSource().loaded())return;const i=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=s.tileID;if(!a)return;const l=new e.P(a.x,a.y)._div(1<<a.z),c=s.coordinates.map(e.ac.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,n)=>{const r=t.wrap+t.canonical.x/(1<<t.canonical.z),i=t.canonical.y/(1<<t.canonical.z),o=e.aj/(1<<t.canonical.z),s=n.wrap+n.canonical.x/(1<<n.canonical.z),a=n.canonical.y/(1<<n.canonical.z);return r+o<s+c.min.x||r>s+c.max.x||i+o<a+c.min.y||i>a+c.max.y};for(let e=0;e<o.length;e++){const s=o[e];for(let e=0;e<n.length;e++){const o=t.getTile(n[e]);if(!o||!o.hasData())continue;if(u(s,o.tileID))continue;const a=this._createProxiedId(s,o,r[s.key]&&r[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],i.push(a)}}}_createProxiedId(t,n,r){let i=this.orthoMatrix;if(r){const e=r.find(e=>e.key===n.tileID.key);if(e)return e}if(n.tileID.key!==t.key){const r=t.canonical.z-n.tileID.canonical.z;let o,s,a;i=e.bz();const l=n.tileID.wrap-t.wrap<<t.overscaledZ;r>0?(o=e.aj>>r,s=o*((n.tileID.canonical.x<<r)-t.canonical.x+l),a=o*((n.tileID.canonical.y<<r)-t.canonical.y)):(o=e.aj<<-r,s=e.aj*(n.tileID.canonical.x-(t.canonical.x+l<<-r)),a=e.aj*(n.tileID.canonical.y-(t.canonical.y<<-r))),e.ca(i,0,o,0,o,0,1),e.bo(i,i,[s,a,0])}return new $i(n.tileID,t.key,i)}_findTileCoveringTileID(t,n){let r=n.getTile(t);if(r&&r.hasData())return r;const i=this._findCoveringTileCache[n.id],o=i[t.key];if(r=o?n.getTileByID(o):null,r&&r.hasData()||null===o)return r;let s=r?r.tileID:t,a=s.overscaledZ;const l=n.getSource().minzoom,c=[];if(!o){const i=n.getSource().maxzoom;if(t.canonical.z>=i){const r=t.canonical.z-i;n.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,n.transform.tileZoom),s=new e.aM(a,t.wrap,i,t.canonical.x>>r,t.canonical.y>>r)):0!==r&&(a=i,s=new e.aM(a,t.wrap,i,t.canonical.x>>r,t.canonical.y>>r))}s.key!==t.key&&(c.push(s.key),r=n.getTile(s))}const u=e=>{c.forEach(t=>{i[t]=e}),c.length=0};for(a-=1;a>=l&&(!r||!r.hasData());a--){r&&u(r.tileID.key);const e=s.calculateScaledKey(a);if(r=n.getTileByID(e),r&&r.hasData())break;const t=i[e];if(null===t)break;void 0===t?c.push(e):r=n.getTileByID(t)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}}function qi(t,n,r){const i=function(t,n,r){const i=e.bG(n,t),o=e.bG(r,[.2126,.7152,.0722]),s=(e,t,n)=>(1-n)*e+n*t,a=s(1-.3*Math.min(o,1),1,Math.min(i+1,1));return s(.92,1,Math.asin(e.ay(n[2],-1,1))/Math.PI+.5)*a}(t,[0,0,1],n),o=[0,0,0];e.c1(o,r.slice(0,3),i);const s=[0,0,0];e.c1(s,n.slice(0,3),t[2]);const a=[0,0,0];return e.d5(a,o,s),e.d8(a)}const Xi=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Zi=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Ki{static cacheKey(e,t,n,r){let i=`${t}${r?r.cacheKey:""}`;for(const o of n)e.usedDefines.includes(o)&&(i+=`/${o}`);return i}constructor(t,n,r,i,o,s){const a=t.gl;this.program=a.createProgram(),this.configuration=i,this.name=n,this.fixedDefines=[...s];const l=i?i.getBinderAttributes():[],c=(r.staticAttributes||[]).concat(l);let u=i?i.defines():[];u=u.concat(s.map(e=>`#define ${e}`));const h="#version 300 es\n";let d=h+u.concat("precision mediump float;",Vr,Ur.fragmentSource).join("\n");for(const e of r.fragmentIncludes)d+=`\n${Br[e]}`;d+=`\n${r.fragmentSource}`;let f=h+u.concat("precision highp float;",Vr,Ur.vertexSource).join("\n");for(const e of r.vertexIncludes)f+=`\n${Br[e]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&-1!==r.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(f+="\nuniform int u_instanceID;\n"),f+=`\n${r.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(f=f.replaceAll("gl_InstanceID","u_instanceID"));const p=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(p,d),a.compileShader(p),a.attachShader(this.program,p);const m=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(m,f),a.compileShader(m),a.attachShader(this.program,m),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:`a_${c[e]}`;a.bindAttribLocation(this.program,e,t),this.attributes[t]=e}a.linkProgram(this.program),a.deleteShader(m),a.deleteShader(p),this.fixedUniforms=o(t),this.binderUniforms=i?i.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(t=>({u_instanceID:new e.cd(t)}))(t)),(s.includes("TERRAIN")||-1!==n.indexOf("symbol")||-1!==n.indexOf("circle"))&&(this.terrainUniforms=(t=>({u_dem:new e.cd(t),u_dem_prev:new e.cd(t),u_dem_tl:new e.cg(t),u_dem_scale:new e.cf(t),u_dem_tl_prev:new e.cg(t),u_dem_scale_prev:new e.cf(t),u_dem_size:new e.cf(t),u_dem_lerp:new e.cf(t),u_exaggeration:new e.cf(t),u_depth:new e.cd(t),u_depth_size_inv:new e.cg(t),u_depth_range_unpack:new e.cg(t),u_occluder_half_size:new e.cf(t),u_occlusion_depth_offset:new e.cf(t),u_meter_to_dem:new e.cf(t),u_label_plane_matrix_inv:new e.ch(t)}))(t)),s.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.ce(t),u_tile_tr_up:new e.ce(t),u_tile_br_up:new e.ce(t),u_tile_bl_up:new e.ce(t),u_tile_up_scale:new e.cf(t)}))(t)),s.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.ch(t),u_fog_range:new e.cg(t),u_fog_color:new e.d0(t),u_fog_horizon_blend:new e.cf(t),u_fog_vertical_limit:new e.cg(t),u_fog_temporal_offset:new e.cf(t),u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_globe_pos:new e.ce(t),u_globe_radius:new e.cf(t),u_globe_transition:new e.cf(t),u_is_globe:new e.cd(t),u_viewport:new e.cg(t)}))(t)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.d0(t)}))(t)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.ce(t),u_lighting_directional_dir:new e.ce(t),u_lighting_directional_color:new e.ce(t),u_ground_radiance:new e.ce(t)}))(t)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.ch(t),u_light_matrix_1:new e.ch(t),u_fade_range:new e.cg(t),u_shadow_normal_offset:new e.ce(t),u_shadow_intensity:new e.cf(t),u_shadow_texel_size:new e.cf(t),u_shadow_map_resolution:new e.cf(t),u_shadow_direction:new e.ce(t),u_shadow_bias:new e.ce(t),u_shadowmap_0:new e.cd(t),u_shadowmap_1:new e.cd(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const n=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const n=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const n=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const n=this.shadowUniforms;e.program.set(this.program);for(const r in t)n[r].set(this.program,r,t[r])}_drawDebugWireframe(t,n,r,i,o,s,a,l,c,u){const h=t.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const d=t.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||t._terrain&&t._terrain.renderingToTexture||!Xi.includes(this.name))||!(!h.layers3D||!Zi.includes(this.name)))())return;const f=d.gl,p=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,o,d);if(!p)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const g=t.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(g.program);const _=(e,t,n)=>{if(t[e]&&n[e])for(const r in t[e])n[e][r]&&n[e][r].set(n.program,r,t[e][r].current)};c&&c.setUniforms(g.program,d,g.binderUniforms,a,{zoom:l}),_("fixedUniforms",this,g),_("terrainUniforms",this,g),_("globeUniforms",this,g),_("fogUniforms",this,g),_("lightsUniforms",this,g),_("shadowUniforms",this,g),p.bind(),d.setColorMode(new Bn([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ZERO,f.ONE],e.am.transparent,[!0,!0,!0,!1])),d.setDepthMode(new jn(n.func===f.LESS?f.LEQUAL:n.func,jn.ReadOnly,n.range)),d.setStencilMode(Vn.disabled);const y=3*s.primitiveLength*2,v=3*s.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const e=u||1;for(let t=0;t<e;++t)g.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",t),f.drawElements(f.LINES,y,f.UNSIGNED_SHORT,v)}else u&&u>1?f.drawElementsInstanced(f.LINES,y,f.UNSIGNED_SHORT,v,u):f.drawElements(f.LINES,y,f.UNSIGNED_SHORT,v);o.bind(),d.program.set(this.program),d.setDepthMode(n),d.setStencilMode(r),d.setColorMode(i)}checkUniforms(e,t,n){if(this.fixedDefines.includes(t))for(const r of Object.keys(n))if(!n[r].initialized)throw new Error(`Program '${this.name}', from draw '${e}': uniform ${r} not set but required by ${t} being defined`)}draw(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m){const g=e.context,_=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(n),g.setStencilMode(r),g.setColorMode(i),g.setCullFace(o);for(const x of Object.keys(this.fixedUniforms))this.fixedUniforms[x].set(this.program,x,s[x]);f&&f.setUniforms(this.program,g,this.binderUniforms,h,{zoom:d});const y={[_.POINTS]:1,[_.LINES]:2,[_.TRIANGLES]:3,[_.LINE_STRIP]:1}[t];this.checkUniforms(a,"RENDER_SHADOWS",this.shadowUniforms);const v=m&&m>0?1:void 0;for(const x of u.get()){const o=x.vaos||(x.vaos={});if((o[a]||(o[a]=new Wr)).bind(g,this,l,f?f.getPaintVertexBuffers():[],c,x.vertexOffset,p||[],v),this.forceManualRenderingForInstanceIDShaders){const e=m||1;for(let n=0;n<e;++n)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",n),c?_.drawElements(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2):_.drawArrays(t,x.vertexOffset,x.vertexLength)}else m&&m>1?_.drawElementsInstanced(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2,m):c?_.drawElements(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2):_.drawArrays(t,x.vertexOffset,x.vertexLength);t===_.TRIANGLES&&c&&this._drawDebugWireframe(e,n,r,i,c,x,h,d,f,m)}}}function Yi(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,t.transform.tileZoom)/i,s=o*(n.tileID.canonical.x+n.tileID.wrap*i),a=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.aw(n,1,t.transform.tileZoom),u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a],u_pattern_transition:r}}const Ji={terrain:0,flat:1},Qi=e.bz(),eo=(t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y)=>{const v=n.style.light,x=v.properties.get("position"),b=[x.x,x.y,x.z],w=e.dJ();"viewport"===v.properties.get("anchor")&&(e.dK(w,-n.transform.angle),e.dL(b,b,w));const S=v.properties.get("color").toPremultipliedRenderColor(null),E=n.transform,T={u_matrix:t,u_lightpos:b,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+r,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ji[u],u_base_type:Ji[h],u_ao:o,u_edge_radius:s,u_width_scale:a,u_flood_light_color:m,u_vertical_scale:g,u_flood_light_intensity:_,u_ground_shadow_factor:y};return"globe"===E.projection.name&&(T.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],T.u_zoom_transition=d,T.u_inv_rot_matrix=p,T.u_merc_center=f,T.u_up_dir=E.projection.upVector(new e.cA(0,0,0),f[0]*e.aj,f[1]*e.aj),T.u_height_lift=c),T},to=(e,t,n,r,i,o)=>({u_matrix:e,u_edge_radius:t,u_width_scale:n,u_vertical_scale:r,u_height_type:Ji[i],u_base_type:Ji[o]}),no=(t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y)=>{const v=eo(t,n,r,i,o,s,a,l,u,h,d,f,p,m,g,_,1,[0,0,0]),x={u_height_factor:-Math.pow(2,l.overscaledZ)/c.tileSize/8};return e.h(v,Yi(n,c,y),x)},ro=(e,t,n)=>({u_matrix:e,u_emissive_strength:t,u_ground_shadow_factor:n}),io=function(t,n,r,i,o){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return e.h(ro(t,n,o),Yi(r,i,s))},oo=(e,t,n,r)=>({u_matrix:e,u_world:n,u_emissive_strength:t,u_ground_shadow_factor:r}),so=function(t,n,r,i,o,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return e.h(io(t,n,r,i,s,a),{u_world:o})},ao=(e,t)=>({u_matrix:e,u_ground_shadow_factor:t}),lo=(e,t,n,r,i)=>({u_matrix:e,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:n,u_height_scale:r,u_reset_depth:i}),co=(e,t)=>({u_matrix:e,u_normal_matrix:t,u_opacity:1}),uo=e=>({u_matrix:e}),ho=e=>({u_matrix:e}),fo=(t,n,r,i,o,s,a,l)=>{const c=e.aj/s.tileSize;return{u_matrix:t,u_inv_rot_matrix:n,u_camera_to_center_distance:r.getCameraToCenterDistance(l),u_extrude_scale:[r.pixelsToGLUnits[0]/c,r.pixelsToGLUnits[1]/c],u_zoom_transition:i,u_tile_id:a,u_merc_center:o}},po=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},mo=e.bz(),go=(t,n,r,i,o,s,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.dM(l.zoom,n.canonical)*l._pixelsPerMercatorPixel:e.aw(r,1,s),h={u_matrix:n.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:mo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=i,h.u_merc_center=o,h.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],h.u_zoom_transition=e.ah(l.zoom);const t=o[0]*e.aj,r=o[1]*e.aj;h.u_up_dir=l.projection.upVector(new e.cA(0,0,0),t,r)}return h};function _o(e,t,n){let[r,i,o,s]=t,[a,l]=n;if(a===l)return[0,0,0,0];const c=255*(e-1)/(e*(l-a));return[r*c,i*c,o*c,s*c]}function yo(e,t,n){let[r,i]=n;return r===i?0:.5/e+(t-r)*(e-1)/(e*(i-r))}const vo=(t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b)=>({u_matrix:t,u_normalize_matrix:n,u_globe_matrix:r,u_merc_matrix:i,u_grid_matrix:o,u_tl_parent:s,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:e.dO(d.paint.get("raster-saturation")),u_contrast_factor:e.dN(d.paint.get("raster-contrast")),u_spin_weights:xo(d.paint.get("raster-hue-rotate")),u_perspective_transform:f,u_raster_elevation:p,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:_o(e.dP,g,y),u_colorization_offset:yo(e.dP,_,y),u_color_ramp:m,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b});function xo(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const bo=.05,wo=(e,t,n,r,i,o,s,a,l,c,u,h)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:r,u_grid_matrix:i,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:s,u_merc_center:a,u_cutoff_params:l}),So=(e,t,n,r,i,o,s,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:r,u_color_ramp:o,u_velocity_res:i,u_max_speed:s,u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[bo,bo]}),Eo=(e,t,n,r,i,o,s,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:r,u_max_speed:i,u_speed_factor:o,u_reset_rate:s,u_rand_seed:Math.random(),u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[bo,bo]}),To=e.bz(),Ao=(t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,S,E)=>{const T=o.transform,A={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:T.getCameraToCenterDistance(v),u_rotate_symbol:+r,u_aspect_ratio:T.width/T.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_elevation_from_sea:c?1:0,u_pitch_with_map:+i,u_texsize:h,u_texsize_icon:d,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:To,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:To,u_up_vector:[0,-1,0],u_color_adj_mat:w,u_icon_transition:S||0,u_gamma_scale:i?o.transform.getCameraToCenterDistance(v)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.q.devicePixelRatio,u_is_halo:1,u_scale_factor:E||1,u_ground_shadow_factor:x,u_inv_matrix:e.bi(e.bz(),a),u_normal_scale:b};return"globe"===v.name&&(A.u_tile_id=[p.canonical.x,p.canonical.y,1<<p.canonical.z],A.u_zoom_transition=m,A.u_inv_rot_matrix=_,A.u_merc_center=g,A.u_camera_forward=T._camera.forward(),A.u_ecef_origin=e.dQ(T.globeMatrix,p.toUnwrapped()),A.u_tile_matrix=Float32Array.from(T.globeMatrix),A.u_up_vector=y),A},Co=(e,t,n,r)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:r}),Po=(t,n,r,i,o,s,a,l,c)=>e.h(function(t,n,r,i,o,s){const{width:a,height:l}=i.imageManager.getPixelSize(n),c=Math.pow(2,s.tileID.overscaledZ),u=s.tileSize*Math.pow(2,i.transform.tileZoom)/c,h=u*(s.tileID.canonical.x+s.tileID.wrap*c),d=u*s.tileID.canonical.y;return{u_image:0,u_pattern_tl:r.tl,u_pattern_br:r.br,u_texsize:[a,l],u_pattern_size:r.displaySize,u_pattern_units_to_pixels:o?[i.transform.width,-1*i.transform.height]:[1/e.aw(s,1,i.transform.tileZoom),1/e.aw(s,1,i.transform.tileZoom)],u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(0,s,a,i,l,c),{u_matrix:t,u_emissive_strength:n,u_opacity:r}),Io=new Float32Array(e.bx([])),ko=function(t,n,r,i,o,s,a,l,c,u,h,d,f){let p=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],m=arguments.length>14?arguments[14]:void 0;const g=o.style.light,_=g.properties.get("position"),y=[-_.x,-_.y,_.z],v=e.dJ();"viewport"===g.properties.get("anchor")&&(e.dK(v,-o.transform.angle),e.dL(y,y,v));const x="MASK"===h.alphaMode,b=g.properties.get("color").toNonPremultipliedRenderColor(null),w=f.paint.get("model-ambient-occlusion-intensity"),S=f.paint.get("model-color").constantOr(e.am.white).toNonPremultipliedRenderColor(null);return S.a=f.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:t,u_lighting_matrix:n,u_normal_matrix:r,u_node_matrix:i||Io,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:p,u_opacity:s,u_baseTextureIsAlpha:0,u_alphaMask:+x,u_alphaCutoff:h.alphaCutoff,u_baseColorFactor:a.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:l.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:c,u_roughnessFactor:u,u_baseColorTexture:Yn.BaseColor,u_metallicRoughnessTexture:Yn.MetallicRoughness,u_normalTexture:Yn.Normal,u_occlusionTexture:Yn.Occlusion,u_emissionTexture:Yn.Emission,u_lutTexture:Yn.LUT,u_color_mix:S.toArray01(),u_aoIntensity:w,u_emissive_strength:d,u_occlusionTextureTransform:m||[0,0,0,0]}},Mo=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Io,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:Io}},Ro={fillExtrusion:t=>({u_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_vertical_gradient:new e.cf(t),u_opacity:new e.cf(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_ao:new e.cg(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_up_dir:new e.ce(t),u_height_lift:new e.cf(t),u_flood_light_color:new e.ce(t),u_vertical_scale:new e.cf(t),u_flood_light_intensity:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),fillExtrusionDepth:t=>({u_matrix:new e.ch(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_vertical_scale:new e.cf(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t)}),fillExtrusionPattern:t=>({u_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_vertical_gradient:new e.cf(t),u_height_factor:new e.cf(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_ao:new e.cg(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_up_dir:new e.ce(t),u_height_lift:new e.cf(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_opacity:new e.cf(t),u_pattern_transition:new e.cf(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.ch(t),u_opacity:new e.cf(t),u_ao_pass:new e.cf(t),u_meter_to_tile:new e.cf(t),u_ao:new e.cg(t),u_flood_light_intensity:new e.cf(t),u_flood_light_color:new e.ce(t),u_attenuation:new e.cf(t),u_edge_radius:new e.cf(t),u_fb:new e.cd(t),u_fb_size:new e.cf(t),u_dynamic_offset:new e.cf(t)}),fill:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),fillPattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_pattern_transition:new e.cf(t)}),fillOutline:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_world:new e.cg(t),u_ground_shadow_factor:new e.ce(t)}),fillOutlinePattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_world:new e.cg(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_pattern_transition:new e.cf(t)}),building:t=>({u_matrix:new e.ch(t),u_normal_matrix:new e.ch(t),u_opacity:new e.cf(t)}),buildingBloom:t=>({u_matrix:new e.ch(t)}),buildingDepth:t=>({u_matrix:new e.ch(t)}),elevatedStructuresDepth:t=>({u_matrix:new e.ch(t),u_depth_bias:new e.cf(t)}),elevatedStructures:t=>({u_matrix:new e.ch(t),u_ground_shadow_factor:new e.ce(t)}),elevatedStructuresDepthReconstruct:t=>({u_matrix:new e.ch(t),u_camera_pos:new e.ce(t),u_depth_bias:new e.cf(t),u_height_scale:new e.cf(t),u_reset_depth:new e.cf(t)}),circle:e.dT,collisionBox:t=>({u_matrix:new e.ch(t),u_inv_rot_matrix:new e.ch(t),u_camera_to_center_distance:new e.cf(t),u_extrude_scale:new e.cg(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_tile_id:new e.ce(t)}),collisionCircle:t=>({u_matrix:new e.ch(t),u_inv_matrix:new e.ch(t),u_camera_to_center_distance:new e.cf(t),u_viewport_size:new e.cg(t)}),debug:t=>({u_color:new e.dv(t),u_matrix:new e.ch(t),u_overlay:new e.cd(t),u_overlay_scale:new e.cf(t)}),clippingMask:t=>({u_matrix:new e.ch(t)}),heatmap:t=>({u_extrude_scale:new e.cf(t),u_intensity:new e.cf(t),u_matrix:new e.ch(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_up_dir:new e.ce(t)}),heatmapTexture:t=>({u_image:new e.cd(t),u_color_ramp:new e.cd(t),u_opacity:new e.cf(t)}),hillshade:t=>({u_matrix:new e.ch(t),u_image:new e.cd(t),u_latrange:new e.cg(t),u_light:new e.cg(t),u_shadow:new e.dv(t),u_highlight:new e.dv(t),u_emissive_strength:new e.cf(t),u_accent:new e.dv(t)}),hillshadePrepare:t=>({u_matrix:new e.ch(t),u_image:new e.cd(t),u_dimension:new e.cg(t),u_zoom:new e.cf(t)}),line:e.dS,linePattern:e.dR,raster:t=>({u_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_grid_matrix:new e.dw(t),u_tl_parent:new e.cg(t),u_scale_parent:new e.cf(t),u_fade_t:new e.cf(t),u_opacity:new e.cf(t),u_image0:new e.cd(t),u_image1:new e.cd(t),u_brightness_low:new e.cf(t),u_brightness_high:new e.cf(t),u_saturation_factor:new e.cf(t),u_contrast_factor:new e.cf(t),u_spin_weights:new e.ce(t),u_perspective_transform:new e.cg(t),u_raster_elevation:new e.cf(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_cutoff_params:new e.d0(t),u_colorization_mix:new e.d0(t),u_colorization_offset:new e.cf(t),u_color_ramp:new e.cd(t),u_texture_offset:new e.cg(t),u_texture_res:new e.cg(t),u_emissive_strength:new e.cf(t)}),rasterParticle:t=>({u_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_grid_matrix:new e.dw(t),u_tl_parent:new e.cg(t),u_scale_parent:new e.cf(t),u_fade_t:new e.cf(t),u_opacity:new e.cf(t),u_image0:new e.cd(t),u_image1:new e.cd(t),u_raster_elevation:new e.cf(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_cutoff_params:new e.d0(t)}),rasterParticleTexture:t=>({u_texture:new e.cd(t),u_opacity:new e.cf(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.cd(t),u_particle_texture_side_len:new e.cf(t),u_tile_offset:new e.cg(t),u_velocity:new e.cd(t),u_color_ramp:new e.cd(t),u_velocity_res:new e.cg(t),u_max_speed:new e.cf(t),u_uv_offset:new e.cg(t),u_data_scale:new e.cg(t),u_data_offset:new e.cf(t),u_particle_pos_scale:new e.cf(t),u_particle_pos_offset:new e.cg(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.cd(t),u_particle_texture_side_len:new e.cf(t),u_velocity:new e.cd(t),u_velocity_res:new e.cg(t),u_max_speed:new e.cf(t),u_speed_factor:new e.cf(t),u_reset_rate:new e.cf(t),u_rand_seed:new e.cf(t),u_uv_offset:new e.cg(t),u_data_scale:new e.cg(t),u_data_offset:new e.cf(t),u_particle_pos_scale:new e.cf(t),u_particle_pos_offset:new e.cg(t)}),symbol:t=>({u_is_size_zoom_constant:new e.cd(t),u_is_size_feature_constant:new e.cd(t),u_size_t:new e.cf(t),u_size:new e.cf(t),u_camera_to_center_distance:new e.cf(t),u_rotate_symbol:new e.cd(t),u_aspect_ratio:new e.cf(t),u_fade_change:new e.cf(t),u_matrix:new e.ch(t),u_label_plane_matrix:new e.ch(t),u_coord_matrix:new e.ch(t),u_is_text:new e.cd(t),u_elevation_from_sea:new e.cd(t),u_pitch_with_map:new e.cd(t),u_texsize:new e.cg(t),u_texsize_icon:new e.cg(t),u_texture:new e.cd(t),u_texture_icon:new e.cd(t),u_gamma_scale:new e.cf(t),u_device_pixel_ratio:new e.cf(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_camera_forward:new e.ce(t),u_tile_matrix:new e.ch(t),u_up_vector:new e.ce(t),u_ecef_origin:new e.ce(t),u_is_halo:new e.cd(t),u_icon_transition:new e.cf(t),u_color_adj_mat:new e.ch(t),u_scale_factor:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_inv_matrix:new e.ch(t),u_normal_scale:new e.cf(t)}),background:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_opacity:new e.cf(t),u_color:new e.dv(t)}),backgroundPattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_opacity:new e.cf(t),u_image:new e.cd(t),u_pattern_tl:new e.cg(t),u_pattern_br:new e.cg(t),u_texsize:new e.cg(t),u_pattern_size:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_pattern_units_to_pixels:new e.cg(t)}),terrainRaster:t=>({u_matrix:new e.ch(t),u_image0:new e.cd(t),u_skirt_height:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),skybox:t=>({u_matrix:new e.ch(t),u_sun_direction:new e.ce(t),u_cubemap:new e.cd(t),u_opacity:new e.cf(t),u_temporal_offset:new e.cf(t)}),skyboxGradient:t=>({u_matrix:new e.ch(t),u_color_ramp:new e.cd(t),u_center_direction:new e.ce(t),u_radius:new e.cf(t),u_opacity:new e.cf(t),u_temporal_offset:new e.cf(t)}),skyboxCapture:t=>({u_matrix_3f:new e.dw(t),u_sun_direction:new e.ce(t),u_sun_intensity:new e.cf(t),u_color_tint_r:new e.d0(t),u_color_tint_m:new e.d0(t),u_luminance:new e.cf(t)}),globeRaster:t=>({u_proj_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_image0:new e.cd(t),u_grid_matrix:new e.dw(t),u_skirt_height:new e.cf(t),u_far_z_cutoff:new e.cf(t),u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_globe_pos:new e.ce(t),u_globe_radius:new e.cf(t),u_viewport:new e.cg(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_horizon:new e.cf(t),u_transition:new e.cf(t),u_fadeout_range:new e.cf(t),u_color:new e.d0(t),u_high_color:new e.d0(t),u_space_color:new e.d0(t),u_temporal_offset:new e.cf(t),u_horizon_angle:new e.cf(t)}),model:t=>({u_matrix:new e.ch(t),u_lighting_matrix:new e.ch(t),u_normal_matrix:new e.ch(t),u_node_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_camera_pos:new e.ce(t),u_opacity:new e.cf(t),u_baseColorFactor:new e.d0(t),u_emissiveFactor:new e.d0(t),u_metallicFactor:new e.cf(t),u_roughnessFactor:new e.cf(t),u_baseTextureIsAlpha:new e.cd(t),u_alphaMask:new e.cd(t),u_alphaCutoff:new e.cf(t),u_baseColorTexture:new e.cd(t),u_metallicRoughnessTexture:new e.cd(t),u_normalTexture:new e.cd(t),u_occlusionTexture:new e.cd(t),u_emissionTexture:new e.cd(t),u_lutTexture:new e.cd(t),u_color_mix:new e.d0(t),u_aoIntensity:new e.cf(t),u_emissive_strength:new e.cf(t),u_occlusionTextureTransform:new e.d0(t)}),modelDepth:t=>({u_matrix:new e.ch(t),u_instance:new e.ch(t),u_node_matrix:new e.ch(t)}),groundShadow:t=>({u_matrix:new e.ch(t),u_ground_shadow_factor:new e.ce(t)}),stars:t=>({u_matrix:new e.ch(t),u_up:new e.ce(t),u_right:new e.ce(t),u_intensity_multiplier:new e.cf(t)}),snowParticle:t=>({u_modelview:new e.ch(t),u_projection:new e.ch(t),u_time:new e.cf(t),u_cam_pos:new e.ce(t),u_velocityConeAperture:new e.cf(t),u_velocity:new e.cf(t),u_horizontalOscillationRadius:new e.cf(t),u_horizontalOscillationRate:new e.cf(t),u_boxSize:new e.cf(t),u_billboardSize:new e.cf(t),u_simpleShapeParameters:new e.cg(t),u_screenSize:new e.cg(t),u_thinningCenterPos:new e.cg(t),u_thinningShape:new e.ce(t),u_thinningAffectedRatio:new e.cf(t),u_thinningParticleOffset:new e.cf(t),u_particleColor:new e.d0(t),u_direction:new e.ce(t)}),rainParticle:t=>({u_modelview:new e.ch(t),u_projection:new e.ch(t),u_time:new e.cf(t),u_cam_pos:new e.ce(t),u_texScreen:new e.cd(t),u_velocityConeAperture:new e.cf(t),u_velocity:new e.cf(t),u_boxSize:new e.cf(t),u_rainDropletSize:new e.cg(t),u_distortionStrength:new e.cf(t),u_rainDirection:new e.ce(t),u_color:new e.d0(t),u_screenSize:new e.cg(t),u_thinningCenterPos:new e.cg(t),u_thinningShape:new e.ce(t),u_thinningAffectedRatio:new e.cf(t),u_thinningParticleOffset:new e.cf(t),u_shapeDirectionalPower:new e.cf(t),u_shapeNormalPower:new e.cf(t),u_mode:new e.cf(t)}),vignette:t=>({u_vignetteShape:new e.ce(t),u_vignetteColor:new e.d0(t)}),occlusion:t=>({u_matrix:new e.ch(t),u_anchorPos:new e.ce(t),u_screenSizePx:new e.cg(t),u_occluderSizePx:new e.cg(t),u_color:new e.d0(t)})};class Oo{constructor(e,t,n,r){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++,this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Oo.uniqueIdxCounter=0;const Lo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Do{constructor(e,t,n,r,i,o){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.instanceCount=o,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),e.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const r=t.attributes[this.attributes[n].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,n){for(let r=0;r<this.attributes.length;r++){const i=this.attributes[r],o=t.attributes[i.name];void 0!==o&&e.vertexAttribPointer(o,i.components,e[Lo[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}setVertexAttribDivisor(e,t,n){for(let r=0;r<this.attributes.length;r++){const i=t.attributes[this.attributes[r].name];void 0!==i&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(i,n)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class No{constructor(e,t,n,r,i){this.context=e,this.width=t,this.height=n;const o=this.framebuffer=e.gl.createFramebuffer();r&&(this.colorAttachment=new ki(e,o)),i&&(this.depthAttachmentType=i,this.depthAttachment="renderbuffer"===i?new Mi(e,o):new Ri(e,o))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class zo{constructor(e,t){this.gl=e,this.clearColor=new Jr(this),this.clearDepth=new Qr(this),this.clearStencil=new ei(this),this.colorMask=new ti(this),this.depthMask=new ni(this),this.stencilMask=new ri(this),this.stencilFunc=new ii(this),this.stencilOp=new oi(this),this.stencilTest=new si(this),this.depthRange=new ai(this),this.depthTest=new li(this),this.depthFunc=new ci(this),this.blend=new ui(this),this.blendFunc=new hi(this),this.blendColor=new di(this),this.blendEquation=new fi(this),this.cullFace=new pi(this),this.cullFaceSide=new mi(this),this.frontFace=new gi(this),this.program=new _i(this),this.activeTexture=new yi(this),this.viewport=new vi(this),this.bindFramebuffer=new xi(this),this.bindRenderbuffer=new bi(this),this.bindTexture=new wi(this),this.bindVertexBuffer=new Si(this),this.bindElementBuffer=new Ei(this),this.bindVertexArrayOES=new Ti(this),this.pixelStoreUnpack=new Ai(this),this.pixelStoreUnpackPremultiplyAlpha=new Ci(this),this.pixelStoreUnpackFlipY=new Pi(this),this.options=t?Object.assign({},t):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=t&&!!t.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,n){return new Oo(this,e,t,n)}createVertexBuffer(e,t,n,r,i){return new Do(this,e,t,n,r,i)}createRenderbuffer(e,t,n){const r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,n,r){return new No(this,e,t,n,r)}clear(e){let{color:t,depth:n,stencil:r,colorMask:i}=e;const o=this.gl;let s=0;t&&(s|=o.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(i||[!0,!0,!0,!0])),void 0!==n&&(s|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==r&&(s|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),o.clear(s)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.bv(t.blendFunction,Bn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Fo;function Bo(t,n,r,i,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=[e.aD(u.center.lng),e.aH(u.center.lat)],d=r.layout.get("symbol-placement"),f=r.layout.get("text-variable-anchor"),p="map"===r.layout.get("icon-rotation-alignment"),m="map"===r.layout.get("text-rotation-alignment"),g="point"!==d,_=[];let y=0,v=0;for(let A=0;A<i.length;A++){const l=i[A],d=n.getTile(l),x=d.getBucket(r);if(!x)continue;const b=x.getProjection().createInversionMatrix(u,l.canonical),w=[],S=Vt(l,x,u),E=!a&&p&&g,T=a&&m&&g,C=f&&x.hasTextData(),P=x.hasIconTextFit()&&C&&x.hasIconData(),I=E||T||a&&C||P,k="globe"===x.projection.name,M=k?e.ah(u.zoom):0;k&&(w.push("PROJECTION_GLOBE_VIEW"),I&&w.push("PROJECTED_POS_ON_VIEWPORT"));const R=t.getOrCreateProgram("collisionBox",{defines:w});let O=S;0===o[0]&&0===o[1]||(O=t.translatePosMatrix(S,d,o,s));const L=a?x.textCollisionBox:x.iconCollisionBox,D=x.collisionCircleArray;if(D.length>0){const t=e.bz(),n=O;e.cM(t,x.placementInvProjMatrix,u.glCoordMatrix),e.cM(t,t,x.placementViewportMatrix),_.push({circleArray:D,circleOffset:v,transform:n,invTransform:t,projection:x.getProjection()}),y+=D.length/4,v=y}if(!L)continue;t.terrain&&t.terrain.setupElevationDraw(d,R);const N=k?[l.canonical.x,l.canonical.y,1<<l.canonical.z]:[0,0,0];R.draw(t,c.LINES,jn.disabled,Vn.disabled,t.colorModeForRenderPass(),$n.disabled,fo(O,b,u,M,h,d,N,x.getProjection()),r.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,null,u.zoom,null,[L.collisionVertexBuffer,L.collisionVertexBufferExt])}if(!a||!_.length)return;const x=t.getOrCreateProgram("collisionCircle"),b=new e.dU;b.resize(4*y),b._trim();let w=0;for(const e of _)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,r=e.circleArray[n+0],i=e.circleArray[n+1],o=e.circleArray[n+2],s=e.circleArray[n+3];b.emplace(w++,r,i,o,s,0),b.emplace(w++,r,i,o,s,1),b.emplace(w++,r,i,o,s,2),b.emplace(w++,r,i,o,s,3)}(!Fo||Fo.length<2*y)&&(Fo=function(t){const n=2*t,r=new e.a_;r.resize(n),r._trim();for(let e=0;e<n;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(y));const S=l.createIndexBuffer(Fo,!0),E=l.createVertexBuffer(b,e.dV.members,!0);for(const A of _){const n={u_matrix:A.transform,u_inv_matrix:A.invTransform,u_camera_to_center_distance:(T=u).getCameraToCenterDistance(A.projection),u_viewport_size:[T.width,T.height]};x.draw(t,c.TRIANGLES,jn.disabled,Vn.disabled,t.colorModeForRenderPass(),$n.disabled,n,r.id,E,S,e.bd.simpleSegment(0,2*A.circleOffset,A.circleArray.length,A.circleArray.length/2),null,u.zoom)}var T;E.destroy(),S.destroy()}const jo=e.bz();function Uo(t){const n=t._camera.getWorldToCamera(t.worldSize,1),r=e.az([],n,t.globeMatrix);e.bi(r,r);const i=[0,0,0],o=[0,1,0,0];return e.aA(o,o,r),i[0]=o[0],i[1]=o[1],i[2]=o[2],e.au(i,i),i}function Vo(t,n){let{width:r,height:i,anchor:o,textOffset:s,textScale:a}=t;const{horizontalAlign:l,verticalAlign:c}=e.bZ(o),u=-(l-.5)*r,h=-(c-.5)*i,d=e.b_(o,s);return new e.P((u/a+d[0])*n,(h/a+d[1])*n)}function Go(t,n,r,i,o,s,a,l,c,u){const h=t.text.placedSymbolArray,d=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,p={},m=t.getProjection(),g=Gt(a,m,o),_=o.elevation,y=m.upVectorScale(a.canonical,o.center.lat,o.worldSize).metersToTile;d.clear();for(let v=0;v<h.length;v++){const f=h.get(v),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=f,S=f.hidden||!f.crossTileID||t.allowVerticalPlacement&&!f.placedOrientation?null:i[f.crossTileID];if(S){let i=0,h=0,v=0;if(_){const e=_?_.getAtTileOffset(a,x,b):0,[t,n,r]=m.upVector(a.canonical,x,b);i=e*t*y,h=e*n*y,v=e*r*y}let[E,T,A,C]=Yt(f.projectedAnchorX+i,f.projectedAnchorY+h,f.projectedAnchorZ+v,r?g:s);const P=Jt(o.getCameraToCenterDistance(m),C);let I=e.bJ(t.textSizeData,c,f)*P/e.bU;r&&(I*=t.tilePixelRatio/l);const k=Vo(S,I);r?(({x:E,y:T,z:A}=m.projectTilePoint(x+k.x,b+k.y,a.canonical)),[E,T,A]=Yt(E+i,T+h,A+v,s)):(n&&k._rotate(-o.angle),E+=k.x,T+=k.y,A=0);const M=t.allowVerticalPlacement&&f.placedOrientation===e.bI.vertical?Math.PI/2:0;for(let t=0;t<w;t++)e.bL(d,E,T,A,M);u&&f.associatedIconIndex>=0&&(p[f.associatedIconIndex]={x:E,y:T,z:A,angle:M})}else ln(w,d)}if(u){f.clear();const n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){const r=n.get(t),{numGlyphs:i}=r,o=p[t];if(r.hidden||!o)ln(i,f);else{const{x:t,y:n,z:r,angle:s}=o;for(let o=0;o<i;o++)e.bL(f,t,n,r,s)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(d)}function Ho(t,n,r,i,o,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=r.paint.get("icon-translate"),c=r.paint.get("text-translate"),u=r.paint.get("icon-translate-anchor"),h=r.paint.get("text-translate-anchor"),d=r.layout.get("icon-rotation-alignment"),f=r.layout.get("text-rotation-alignment"),p=r.layout.get("icon-pitch-alignment"),m=r.layout.get("text-pitch-alignment"),g=r.layout.get("icon-keep-upright"),_=r.layout.get("text-keep-upright"),y=r.paint.get("icon-color-saturation"),v=r.paint.get("icon-color-contrast"),x=r.paint.get("icon-color-brightness-min"),b=r.paint.get("icon-color-brightness-max"),w="sea"===r.layout.get("symbol-elevation-reference"),S=t.context,E=S.gl,T=t.transform,A="map"===d,C="map"===f,P="map"===p,I="map"===m,k=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let M=!1;const R=t.depthModeForSublayer(0,jn.ReadOnly),O=new jn(t.context.gl.LEQUAL,jn.ReadOnly,t.depthRangeFor3D),L=[e.aD(T.center.lng),e.aH(T.center.lat)],D=r.layout.get("text-variable-anchor"),N="globe"===T.projection.name,z=[],F=[0,-1,0];for(const B of i){const i=n.getTile(B),o=i.getBucket(r);if(!o)continue;if("mercator"===o.projection.name&&N)continue;if(o.fullyClipped)continue;const s="globe"===o.projection.name,d=s?e.ah(T.zoom):0,f=Gt(B,o.getProjection(),T),p=T.calculatePixelsToTileUnitsMatrix(i),m=D&&o.hasTextData(),S=o.hasIconTextFit()&&m&&o.hasIconData(),j=o.getProjection().createInversionMatrix(T,B.canonical),U=(1<<i.tileID.canonical.z)*e.aj/t.transform.worldSize,V=e=>{let n=[0,0,0];if(e){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(n=lr(t.style,e,r))}return n},G=e=>{T.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||t.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"))},H=()=>{const n=A&&"point"!==r.layout.get("symbol-placement"),a=[];G(a);const c=n||S,h="road"===o.elevationType,m=t.shadowRenderer,_=h&&P&&!!m&&m.enabled,C=V(_),I=h&&P&&!t.terrain?O:R,k=r.paint.get("icon-image-cross-fade");t.terrainRenderModeElevated()&&P&&a.push("PITCH_WITH_MAP_TERRAIN"),s&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),k>0&&o.hasAnySecondaryIcon&&a.push("ICON_TRANSITION"),!o.icon.zOffsetVertexBuffer||h&&t.terrain||a.push("Z_OFFSET"),0===y&&0===v&&0===x&&1===b||a.push("COLOR_ADJUSTMENT"),o.sdfIcons&&a.push("RENDER_SDF"),_&&a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),h&&P&&!t.terrain&&o.icon.orientationVertexBuffer&&a.push("ELEVATED_ROADS");const M=o.icon.programConfigurations.get(r.id),D=t.getOrCreateProgram("symbol",{config:M,defines:a}),z=i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],H=o.iconSizeData,$=e.bH(H,T.zoom),W=P||!T.isOrthographic,q=Xt(f,i.tileID.canonical,P,A,T,o.getProjection(),p),X=Kt(f,i.tileID.canonical,P,A,T,o.getProjection(),p),Z=t.translatePosMatrix(X,i,l,u,!0),K=t.translatePosMatrix(f,i,l,u),Y=c?jo:q,J=A&&!P&&!n;let Q=F;!N&&!T.mercatorFromTransition||A||(Q=Uo(T));const ee=s?Q:F,te=r.getColorAdjustmentMatrix(y,v,x,b),ne=Ao(H.kind,$,J,P,t,K,Y,Z,w,!1,z,[0,0],0,B,d,L,j,ee,o.getProjection(),C,U,te,k,null),re=i.imageAtlasTexture?i.imageAtlasTexture:null,ie=1!==r.layout.get("icon-size").constantOr(0)||o.iconsNeedLinear,oe=o.sdfIcons||t.options.rotating||t.options.zooming||ie||W?E.LINEAR:E.NEAREST,se=o.sdfIcons&&0!==r.paint.get("icon-halo-width").constantOr(1),ae=t.terrain&&P&&n?e.bi(e.bz(),q):jo;if(n&&o.icon){const e=T.elevation,n=e?e.getAtTileOffsetFunc(B,T.center.lat,T.worldSize,o.getProjection()):null,r=Zt(f,i.tileID.canonical,P,A,T,o.getProjection(),p);en(o,f,t,!1,r,X,P,g,n,B)}return{program:D,buffers:o.icon,uniformValues:ne,atlasTexture:re,atlasTextureIcon:null,atlasInterpolation:oe,atlasInterpolationIcon:null,isSDF:o.sdfIcons,hasHalo:se,depthMode:I,tile:i,renderWithShadows:_,labelPlaneMatrixInv:ae}},$=()=>{const n=C&&"point"!==r.layout.get("symbol-placement"),a=[],l=n||D||S,u="road"===o.elevationType,m=t.shadowRenderer,g=u&&I&&!!m&&m.enabled,y=V(g),v=u&&I&&!t.terrain?O:R;t.terrainRenderModeElevated()&&I&&a.push("PITCH_WITH_MAP_TERRAIN"),s&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),!o.text.zOffsetVertexBuffer||u&&t.terrain||a.push("Z_OFFSET"),o.iconsInText&&a.push("RENDER_TEXT_AND_SYMBOL"),a.push("RENDER_SDF"),g&&a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),u&&I&&!t.terrain&&o.text.orientationVertexBuffer&&a.push("ELEVATED_ROADS"),G(a);const x=o.text.programConfigurations.get(r.id),b=t.getOrCreateProgram("symbol",{config:x,defines:a});let A,P=[0,0],k=null;const M=o.textSizeData;o.iconsInText&&(P=i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],k=i.imageAtlasTexture?i.imageAtlasTexture:null,A=I||!T.isOrthographic||t.options.rotating||t.options.zooming||"composite"===M.kind||"camera"===M.kind?E.LINEAR:E.NEAREST);const z=i.glyphAtlasTexture?i.glyphAtlasTexture.size:[0,0],H=r.layout.get("text-size-scale-range"),$=e.ay(t.scaleFactor,H[0],H[1]),W=e.bH(M,T.zoom,$),q=Xt(f,i.tileID.canonical,I,C,T,o.getProjection(),p),X=Kt(f,i.tileID.canonical,I,C,T,o.getProjection(),p),Z=t.translatePosMatrix(X,i,c,h,!0),K=t.translatePosMatrix(f,i,c,h),Y=l?jo:q,J=C&&!I&&!n;let Q=F;!N&&!T.mercatorFromTransition||C||(Q=Uo(T));const ee=Ao(M.kind,W,J,I,t,K,Y,Z,w,!0,z,P,0,B,d,L,j,s?Q:F,o.getProjection(),y,U,null,null,$),te=i.glyphAtlasTexture?i.glyphAtlasTexture:null,ne=E.LINEAR,re=0!==r.paint.get("text-halo-width").constantOr(1),ie=t.terrain&&I&&n?e.bi(e.bz(),q):jo;if(n&&o.text){const e=T.elevation,n=e?e.getAtTileOffsetFunc(B,T.center.lat,T.worldSize,o.getProjection()):null,r=Zt(f,i.tileID.canonical,I,C,T,o.getProjection(),p);en(o,f,t,!0,r,X,I,_,n,B)}return{program:b,buffers:o.text,uniformValues:ee,atlasTexture:te,atlasTextureIcon:k,atlasInterpolation:ne,atlasInterpolationIcon:A,isSDF:!0,hasHalo:re,depthMode:v,tile:i,renderWithShadows:g,labelPlaneMatrixInv:ie}},W=o.icon.segments.get().length,q=o.text.segments.get().length,X=W&&!a.onlyText?H():null,Z=q&&!a.onlyIcons?$():null,K=r.paint.get("icon-opacity").constantOr(1),Y=r.paint.get("text-opacity").constantOr(1);if(k&&o.canOverlap){M=!0;const t=K&&!a.onlyText?o.icon.segments.get():[],n=Y&&!a.onlyIcons?o.text.segments.get():[];for(const r of t)z.push({segments:new e.bd([r]),sortKey:r.sortKey,state:X});for(const r of n)z.push({segments:new e.bd([r]),sortKey:r.sortKey,state:Z})}else a.onlyText||z.push({segments:K?o.icon.segments:new e.bd([]),sortKey:0,state:X}),a.onlyIcons||z.push({segments:Y?o.text.segments:new e.bd([]),sortKey:0,state:Z})}M&&z.sort((e,t)=>e.sortKey-t.sortKey);for(const e of z){const n=e.state;if(n)if(t.terrain?t.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:T.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:n.labelPlaneMatrixInv}):t.setupDepthForOcclusion(T.depthOcclusionForSymbolsAndCircles,n.program),S.activeTexture.set(E.TEXTURE0),n.atlasTexture&&n.atlasTexture.bind(n.atlasInterpolation,E.CLAMP_TO_EDGE,!0),n.atlasTextureIcon&&(S.activeTexture.set(E.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,E.CLAMP_TO_EDGE,!0)),n.renderWithShadows&&t.shadowRenderer.setupShadows(n.tile.tileID.toUnwrapped(),n.program,"vector-tile"),t.uploadCommonLightUniforms(t.context,n.program),n.hasHalo){const i=n.uniformValues;i.u_is_halo=1,$o(n.buffers,e.segments,r,t,n.program,n.depthMode,o,s,i,2),i.u_is_halo=0}else{if(n.isSDF){const i=n.uniformValues;n.hasHalo&&(i.u_is_halo=1,$o(n.buffers,e.segments,r,t,n.program,n.depthMode,o,s,i,1)),i.u_is_halo=0}$o(n.buffers,e.segments,r,t,n.program,n.depthMode,o,s,n.uniformValues,1)}}}function $o(e,t,n,r,i,o,s,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer,e.orientationVertexBuffer];i.draw(r,r.context.gl.TRIANGLES,o,s,a,$n.disabled,l,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),u,c)}function Wo(t,n){const r=1<<t.canonical.z,i=(n.x*r-t.canonical.x-t.wrap*r)*e.aj,o=(n.y*r-t.canonical.y)*e.aj,s=e.e2(n.z,n.y);return e.d2(i,o,s)}function qo(t,n,r,i,o){if(!r.layout||"none"===r.layout.get("fill-elevation-reference"))return;const s=t.context.gl,a=new jn(t.context.gl.LEQUAL,jn.ReadWrite,t.depthRangeFor3D),l=new jn(t.context.gl.GREATER,jn.ReadWrite,t.depthRangeFor3D),c=function(t){const n=e.cU(t.pitch);let r=.01;return t.isOrthographic&&(r=e.ai(1e-4,r,e.cZ(n>=Qn?1:n/Qn))),2*r}(t.transform),u=t.transform.getFreeCameraOptions().position,h="elevatedStructuresDepthReconstruct",d=t.getOrCreateProgram(h,{defines:["DEPTH_RECONSTRUCTION"]}),f=t.getOrCreateProgram(h);for(const e of i){const i=n.getTile(e),h=i.getBucket(r);if(!h)continue;const p=h.elevatedStructures;if(!p)continue;const m=h.elevationBufferData.heightRange,g=Wo(e.toUnwrapped(),u),_=t.translatePosMatrix(e.projMatrix,i,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let y,v,x,b;if("initialize"===o){if(!m||m.min>=1||0===p.depthSegments.segments[0].primitiveLength)continue;y=lo(_,g,c,1,0),v=a,x=p.depthSegments,b=d}else if("reset"===o){if(!m||m.min>=0||0===p.maskSegments.segments[0].primitiveLength)continue;y=lo(_,g,0,0,1),v=l,x=p.maskSegments,b=d}else if("geometry"===o){if(0===p.depthSegments.segments[0].primitiveLength)continue;y=lo(_,g,c,1,0),v=a,x=p.depthSegments,b=f}b.draw(t,s.TRIANGLES,v,Vn.disabled,Bn.disabled,$n.disabled,y,r.id,p.vertexBuffer,p.indexBuffer,x,r.paint,t.transform.zoom)}}function Xo(t,n,r){const{painter:i,sourceCache:o,layer:s,coords:a,colorMode:l,elevationType:c,terrainEnabled:u,pass:h}=t,d=i.context.gl,f=s.paint.get("fill-pattern"),p=s.paint.get("fill-pattern-cross-fade"),m=f.constantOr(null);let g=c;"road"!==c||n&&!u||(g="none");const _="road"===g,y=t.painter.shadowRenderer,v=_&&!!y&&y.enabled,x=new jn(i.context.gl.LEQUAL,jn.ReadOnly,i.depthRangeFor3D);let b=[0,0,0];if(v){const e=i.style.directionalLight,t=i.style.ambientLight;e&&t&&(b=lr(i.style,e,t))}const w=f&&f.constantOr(1),S=(t,h)=>{let f,g,S,E,T;h?(f=w&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",S=d.LINES):(f=w?"fillPattern":"fill",S=d.TRIANGLES);for(const A of a){const a=o.getTile(A);if(w&&!a.patternsLoaded())continue;const C=a.getBucket(s);if(!C)continue;const P=n?C.elevationBufferData:C.bufferData;if(P.isEmpty())continue;i.prepareDrawTile();const I=P.programConfigurations.get(s.id),k=i.isTileAffectedByFog(A),M=[],R=[];_&&(M.push("ELEVATED_ROADS"),R.push(P.elevatedLayoutVertexBuffer)),v&&M.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),w&&(i.context.activeTexture.set(d.TEXTURE0),a.imageAtlasTexture&&a.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),I.updatePaintBuffers());let O=!1;if(m&&a.imageAtlas){const t=a.imageAtlas,n=e.dZ.from(m),r=n.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),i=n.getSecondary(),o=t.patternPositions.get(r),s=i?t.patternPositions.get(i.scaleSelf(e.q.devicePixelRatio).toString()):null;O=!!o&&!!s,o&&I.setConstantPatternPositions(o,s)}p>0&&(O||I.getPatternTransitionVertexBuffer("fill-pattern"))&&M.push("FILL_PATTERN_TRANSITION");const L=i.getOrCreateProgram(f,{config:I,overrideFog:k,defines:M}),D=i.translatePosMatrix(A.projMatrix,a,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));v&&y.setupShadows(a.tileID.toUnwrapped(),L,"vector-tile");const N=s.paint.get("fill-emissive-strength");if(h){E=P.lineIndexBuffer,T=P.lineSegments;const e=i.terrain&&i.terrain.renderingToTexture?i.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];g="fillOutlinePattern"===f&&w?so(D,N,i,a,e,b,p):oo(D,N,e,b)}else E=P.indexBuffer,T=P.triangleSegments,g=w?io(D,N,i,a,b,p):ro(D,N,b);i.uploadCommonUniforms(i.context,L,A.toUnwrapped());let z=t;("road"===c&&!u||"offset"===c)&&(z=x),L.draw(i,S,z,r||i.stencilModeForClipping(A),l,$n.disabled,g,s.id,P.layoutVertexBuffer,E,T,s.paint,i.transform.zoom,I,R)}};i.renderPass===h&&S(i.depthModeForSublayer(1,"opaque"===i.renderPass?jn.ReadWrite:jn.ReadOnly),!1),"none"===g&&"translucent"===i.renderPass&&s.paint.get("fill-antialias")&&S(i.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,jn.ReadOnly),!0)}function Zo(t,n,r,i,o,s,a,l){r.resetLayerRenderingStats(t);const c=t.context,u=c.gl,h=t.transform,d=r.paint.get("fill-extrusion-pattern"),f=r.paint.get("fill-extrusion-pattern-cross-fade"),p=d.constantOr(null),m=d.constantOr(1),g=r.paint.get("fill-extrusion-opacity"),_=t.style.enable3dLights(),y=r.paint.get(_&&!m?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),v=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),y],x=r.layout.get("fill-extrusion-edge-radius"),b=x>0&&!r.paint.get("fill-extrusion-rounded-roof"),w=b?0:x,S="globe"===h.projection.name?e.e5():0,E="globe"===h.projection.name,T=E?e.ah(h.zoom):0,A=[e.aD(h.center.lng),e.aH(h.center.lat)],C="none"===r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),P=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(C?null:r.lut).toArray01().slice(0,3),I=r.paint.get("fill-extrusion-flood-light-intensity"),k=r.paint.get("fill-extrusion-vertical-scale"),M=0!==r.paint.get("fill-extrusion-line-width").constantOr(1),R=r.paint.get("fill-extrusion-height-alignment"),O=r.paint.get("fill-extrusion-base-alignment"),L=tr(t,r.paint.get("fill-extrusion-cutoff-fade-range")),D=[];let N;E&&D.push("PROJECTION_GLOBE_VIEW"),v[0]>0&&D.push("FAUX_AO"),b&&D.push("ZERO_ROOF_RADIUS"),l&&D.push("HAS_CENTROID"),I>0&&D.push("FLOOD_LIGHT"),L.shouldRenderCutoff&&D.push("RENDER_CUTOFF"),M&&D.push("RENDER_WALL_MODE");const z="shadow"===t.renderPass,F=t.shadowRenderer,B=z&&!!F,j=z?$n.disabled:$n.backCCW;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let U=[0,0,0];if(F){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(U=lr(t.style,e,n)),z||(D.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&D.push("NORMAL_OFFSET")),N=D.concat(["SHADOWS_SINGLE_CASCADE"])}const V=B?"fillExtrusionDepth":m?"fillExtrusionPattern":"fillExtrusion",G=r.getLayerRenderingStats();for(const H of i){const i=n.getTile(H),d=i.getBucket(r);if(!d||d.projection.name!==h.projection.name)continue;let _=!1;F&&(_=0===F.getMaxCascadeForTile(H.toUnwrapped()));const y=t.isTileAffectedByFog(H),x=d.programConfigurations.get(r.id);let b=!1;if(p&&i.imageAtlas){const t=i.imageAtlas,n=e.dZ.from(p),r=n.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),o=n.getSecondary(),s=t.patternPositions.get(r),a=o?t.patternPositions.get(o.scaleSelf(e.q.devicePixelRatio).toString()):null;b=!!s&&!!a,s&&x.setConstantPatternPositions(s,a)}f>0&&(b||x.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&D.push("FILL_EXTRUSION_PATTERN_TRANSITION");const C=t.getOrCreateProgram(V,{config:x,defines:_?N:D,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(i,C,{useMeterToDem:!0}),!d.centroidVertexBuffer){const e=C.attributes.a_centroid_pos;void 0!==e&&u.vertexAttrib2f(e,0,0)}!z&&F&&F.setupShadows(i.tileID.toUnwrapped(),C,"vector-tile"),m&&(t.context.activeTexture.set(u.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),x.updatePaintBuffers());const B=r.paint.get("fill-extrusion-vertical-gradient"),$=1/d.tileToMeter;let W;if(z&&F){if(ns(i.tileID,d.maxHeight,t))continue;const e=F.calculateShadowPassMatrixFromTile(i.tileID.toUnwrapped());W=to(e,w,$,k,R,O)}else{const e=t.translatePosMatrix(H.expandedProjMatrix,i,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),n=h.projection.createInversionMatrix(h,H.canonical);W=m?no(e,t,B,g,v,w,$,H,i,S,R,O,T,A,n,P,k,f):eo(e,t,B,g,v,w,$,H,S,R,O,T,A,n,P,k,I,U)}t.uploadCommonUniforms(c,C,H.toUnwrapped(),null,L);let q=d.segments;if("mercator"===h.projection.name&&!z&&(q=d.getVisibleSegments(i.tileID,t.terrain,t.transform.getFrustum(0)),!q.get().length))continue;if(G)if(z)for(const e of q.get())G.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of q.get())G.numRenderedVerticesInTransparentPass+=e.primitiveLength;const X=[];(t.terrain||l)&&X.push(d.centroidVertexBuffer),E&&X.push(d.layoutVertexExtBuffer),M&&X.push(d.wallVertexBuffer),C.draw(t,c.gl.TRIANGLES,o,s,a,j,W,r.id,d.layoutVertexBuffer,d.indexBuffer,q,r.paint,t.transform.zoom,x,X)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}class Ko{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Yo(t,n,r,i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x){const b=n.context,w=b.gl,S=n.transform,E=n.transform.zoom,T=[],A=t.translate,C=t.translateAnchor,P=t.edgeRadius,I=tr(n,t.cutoffFadeRange);"clear"===h?(T.push("CLEAR_SUBPASS"),x&&(T.push("CLEAR_FROM_TEXTURE"),b.activeTexture.set(w.TEXTURE0),x.bind(w.LINEAR,w.CLAMP_TO_EDGE))):"sdf"===h&&T.push("SDF_SUBPASS"),y&&T.push("HAS_CENTROID"),I.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const k=(e,t,r,o,h)=>{const v=t.programConfigurations.get(i.id),w=n.isTileAffectedByFog(e),S=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:v,defines:T,overrideFog:w}),A=((e,t,n,r,i,o,s,a,l,c,u)=>({u_matrix:t,u_opacity:n,u_ao_pass:r?1:0,u_meter_to_tile:i,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u,u_dynamic_offset:1}))(0,o,d,u,h,[f,p*h],m,g,_,E>=17?0:P*h,x?x.size[0]:0),C=[];y&&C.push(t.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(b,S,e.toUnwrapped(),null,I),S.draw(n,b.gl.TRIANGLES,s,a,l,c,A,i.id,t.vertexBuffer,t.indexBuffer,r,i.paint,E,v,C)};for(const M of o){const t=r.getTile(M),o=t.getBucket(i);if(!o||o.projection.name!==S.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const s=o.groundEffect,a=1/o.tileToMeter;{const e=n.translatePosMatrix(M.projMatrix,t,A,C),r=s.getDefaultSegment();k(M,s,r,e,a)}if(v)for(let l=0;l<4;l++){const o=e.e3[l](M),s=r.getTile(o);if(!s)continue;const c=s.getBucket(i);if(!c||c.projection.name!==S.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let h,d;0===l?(h=[-e.aj,0,0],d=1):1===l?(h=[e.aj,0,0],d=0):2===l?(h=[0,-e.aj,0],d=3):(h=[0,e.aj,0],d=2);const f=u.regionSegments[d];if(!f)continue;const p=new Float32Array(16);e.bo(p,M.projMatrix,h),k(M,u,f,n.translatePosMatrix(p,t,A,C),a)}}}function Jo(t,n,r,i,o,s,a){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const l=s?s.findDEMTileFor(r):null;if(!(l&&l.dem||a))return;s&&l&&l.dem&&i.selfDEMTileTimestamp!==l.dem._timestamp&&(i.borderDoneWithNeighborZ=[-1,-1,-1,-1],i.selfDEMTileTimestamp=l.dem._timestamp);const c=t=>new e.P(Math.ceil((t+e.e7)*e.e8),0),u=e=>{const t=n.getSource().minzoom,r=e=>{const t=n.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},i=[0,-1,1];for(const n of i){if(e.overscaledZ+n<t)continue;const i=r(e.calculateScaledKey(e.overscaledZ+n));if(i)return i}},h=[0,0,0],d=(t,n)=>(h[0]=Math.min(t.min.y,n.min.y),h[1]=Math.max(t.max.y,n.max.y),h[2]=e.aj-n.min.x>t.max.x?n.min.x-e.aj:t.max.x,h),f=(t,n)=>(h[0]=Math.min(t.min.x,n.min.x),h[1]=Math.max(t.max.x,n.max.x),h[2]=e.aj-n.min.y>t.max.y?n.min.y-e.aj:t.max.y,h),p=[(e,t)=>d(e,t),(e,t)=>d(t,e),(e,t)=>f(e,t),(e,t)=>f(t,e)],m=(t,n,i,o,a,c,u)=>{if(!s)return 0;const h=[[c?i:t,c?t:i,0],[c?i:n,c?n:i,0]],d=u<0?e.aj+u:u,f=[c?d:(t+n)/2,c?(t+n)/2:d,0];return 0===i&&u<0||0!==i&&u>0?s.getForTilePoints(a,[f],!0,o):h.push(f),s.getForTilePoints(r,h,!0,l),Math.max(h[0][2],h[1][2],f[2])/s.exaggeration()};for(let y=0;y<4;y++){const t=i.borderFeatureIndices[y];if(0===t.length)continue;const n=e.e3[y](r),o=u(n);if(!(o&&o instanceof e.e4))continue;const l=s?s.findDEMTileFor(n):null;if(!(l&&l.dem||a))continue;if(s&&l&&l.dem&&i.borderDEMTileTimestamp[y]!==l.dem._timestamp&&(i.borderDoneWithNeighborZ[y]=-1,i.borderDEMTileTimestamp[y]=l.dem._timestamp),i.borderDoneWithNeighborZ[y]===o.canonical.z)continue;0===o.centroidVertexArray.length&&o.createCentroidsBuffer();const h=(y<2?1:5)-y,d=o.borderDoneWithNeighborZ[h]!==i.canonical.z,f=o.borderFeatureIndices[h];let v=0;if(i.canonical.z!==o.canonical.z){for(const e of t)i.showCentroid(i.featuresOnBorder[e]);if(d)for(const e of f)o.showCentroid(o.featuresOnBorder[e]);i.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[h]=i.canonical.z}for(const r of t){const t=i.featuresOnBorder[r],s=i.centroidData[t.centroidDataIndex],u=t.borders[y];let d;for(;v<f.length;){d=o.featuresOnBorder[f[v]];const e=d.borders[h];if(e[1]>u[0]+3||e[0]>u[0]-3)break;o.showCentroid(d),v++}if(d&&v<f.length){const r=v;let x=0;for(;!(d.borders[h][0]>u[1]-3)&&(x++,++v!==f.length);)d=o.featuresOnBorder[f[v]];d=o.featuresOnBorder[f[r]];let b=!1;if(x>=1){const e=d.borders[h];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(x=1,b=!0,v=r+1)}else if(0===x){i.showCentroid(t);continue}const w=o.centroidData[d.centroidDataIndex];a&&b&&(((g=s).flags|(_=w).flags)&e.e6?(g.flags|=e.e6,_.flags|=e.e6):(g.flags&=~e.e6,_.flags&=~e.e6));const S=t.intersectsCount()>1||d.intersectsCount()>1;if(x>1)v=r,s.centroidXY=w.centroidXY=new e.P(0,0);else if(l&&l.dem&&!S){const t=p[y](s,w),r=y%2?e.aj-1:0,i=m(t[0],Math.min(e.aj-1,t[1]),r,l,n,y<2,t[2]);s.centroidXY=w.centroidXY=c(i)}else S?s.centroidXY=w.centroidXY=new e.P(0,0):(s.centroidXY=i.encodeBorderCentroid(t),w.centroidXY=o.encodeBorderCentroid(d));i.writeCentroidToBuffer(s),o.writeCentroidToBuffer(w)}else i.showCentroid(t)}i.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[h]=i.canonical.z}var g,_;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(t)}const Qo=[1,0,0],es=[0,1,0],ts=[0,0,1];function ns(t,n,r){const i=r.transform,o=r.shadowRenderer;if(!o)return!0;const s=t.toUnwrapped(),a=i.tileSize*o._cascades[r.currentShadowCascade].scale;let l=n;if(i.elevation){const e=i.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(s,l,a,c);if(!u)return!1;const h=[Qo,es,ts,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===i.projection.name,f=i.scaleZoom(a),p=e.cy.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,f,!d),m=o.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(u.vertices,u.planes,h)||0===m.intersectsPrecise(u.vertices,u.planes,h)}function rs(t){const{painter:n,source:r,layer:i,coords:o}=t,s=t.defines,a=n.context,l="shadow"===n.renderPass,c="light-beam"===n.renderPass,u=n.shadowRenderer;let h;u&&(h=s.concat(["SHADOWS_SINGLE_CASCADE"]));const d=e.e9(n.transform.center.lat,n.transform.zoom);for(const f of o){const o=r.getTile(f),p=o.getBucket(i);if(!p)continue;let m=!1;u&&(m=0===u.getMaxCascadeForTile(f.toUnwrapped()));const g=p.programConfigurations.get(i.id);let _,y,v=n.translatePosMatrix(f.expandedProjMatrix,o,[0,0],"map");if(v=e.cP(e.bz(),v,[1,1,t.verticalScale]),l&&u){if(ns(o.tileID,p.maxHeight*d,n))continue;let r=u.calculateShadowPassMatrixFromTile(o.tileID.toUnwrapped());r=e.cP(e.bz(),r,[1,1,t.verticalScale]),y=ho(r),_=n.getOrCreateProgram("buildingDepth",{config:g,defines:m?h:s,overrideFog:!1})}else if(c)_=n.getOrCreateProgram("buildingBloom",{config:g,defines:m?h:s,overrideFog:!1}),y=uo(v);else{const r=n.transform.calculatePosMatrix(f.toUnwrapped(),n.transform.worldSize);e.cP(r,r,[1,1,t.verticalScale]);const i=e.bz();e.cP(i,r,[1,-1,1/d]),e.bi(i,i),e.ea(i,i),y=co(v,i),_=n.getOrCreateProgram("building",{config:g,defines:m?h:s,overrideFog:!1}),u&&u.setupShadowsFromMatrix(r,_,!0)}if(n.uploadCommonUniforms(a,_,f.toUnwrapped(),null,null),c){const e=p.bloomGeometry;_.draw(n,a.gl.TRIANGLES,t.depthMode,Vn.disabled,t.blendMode,$n.disabled,y,i.id,e.layoutVertexBuffer,e.indexBuffer,e.segmentsBucket,i.paint,n.transform.zoom,g,[e.layoutAttenuationBuffer,e.layoutColorBuffer])}else _.draw(n,a.gl.TRIANGLES,t.depthMode,Vn.disabled,t.blendMode,l?$n.disabled:$n.backCW,y,i.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,i.paint,n.transform.zoom,g,[p.layoutNormalBuffer,p.layoutColorBuffer])}}function is(t){return[t[0]*e.eb,t[1]*e.eb,t[2]*e.eb,0]}function os(t,n,r,i,o,s,a,l,c){const u=i.getSource(),h=r.globeSharedBuffers;if(!h)return;let d,f,p;if(n&&(d=i.getTile(n)),u instanceof e.aP?(f=u.texture,p=e.dE(0,0,r.transform)):d&&n&&(f=d.texture,p=e.dE(n.canonical.z,n.canonical.x,r.transform)),!f||!p)return;t||(p=e.cP(e.bz(),p,[1,-1,1]));const m=r.context,g=m.gl,_="nearest"===o.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=r.colorModeForDrapableLayerRenderPass(s),v=a.defines;v.push("GLOBE_POLES");const x=new jn(g.LEQUAL,jn.ReadWrite,r.depthRangeFor3D),b=Float32Array.from(r.transform.expandedFarZProjMatrix),w=Float32Array.from(e.bh(e.dD(new e.cA(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),m.activeTexture.set(g.TEXTURE0),f.bind(_,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE1),f.bind(_,g.CLAMP_TO_EDGE),"useMipmap"in f&&m.extTextureFilterAnisotropic&&r.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[S,E,T,A]=n?h.getPoleBuffers(n.canonical.z,!1):h.getPoleBuffers(0,!0),C=o.paint.get("raster-elevation");let P;t?(P=S,r.renderDefaultNorthPole=0!==C):(P=E,r.renderDefaultSouthPole=0!==C);const I=is(a.mix),k=((e,t,n,r,i,o,s,a,l,c,u,h,d)=>vo(e,t,n,new Float32Array(16),new Float32Array(9),[0,0],r,[0,0],[0,0,0,0],1,{opacity:1,mix:0},o,[0,0]||0,a,2,c,u,h,1,0,d))(b,w,p,e.ah(r.transform.zoom),0,o,0,C,0,I,a.offset,a.range,s),M=r.getOrCreateProgram("raster",{defines:v});r.uploadCommonUniforms(m,M,null),M.draw(r,g.TRIANGLES,x,c,y,l,k,o.id,P,T,A)}function ss(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),r=n-t,i=.2*e.height,o=t+i;return[t,n,(o-i-t)/r,(o-t)/r]}function as(e,t,n,r){if(e)return t instanceof it&&e instanceof St?t.getTextureDescriptor(e,n,!0):{texture:e.texture,mix:is(r.mix),offset:r.offset,buffer:0,tileSize:1}}var ls=e.ec([{name:"a_index",type:"Int16",components:1}]);class cs{constructor(t,n,r,i){const o={width:r[0],height:r[1],data:null},s=t.gl;this.targetColorTexture=new e.T(t,o,s.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,o,s.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,i),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const r=this.context.gl,i=n.width*n.height;this.particleTexture0=new e.T(this.context,n,r.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,n,r.RGBA8,{premultiply:!1,useMipmap:!1});const o=new e.ed;o.reserve(i);for(let e=0;e<i;e++)o.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(o,ls.members,!0),this.particleSegment=e.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function us(t,n,r){if(!t)return null;const i=n.getTextureDescriptor(t,r,!0);if(!i)return null;let{texture:o,mix:s,offset:a,tileSize:l,buffer:c,format:u}=i;if(!o||!u)return null;let h=!1;return"uint32"===u&&(h=!0,s[3]=0,s=_o(e.ee,s,[0,r.paint.get("raster-particle-max-speed")]),a=yo(e.ee,a,[0,r.paint.get("raster-particle-max-speed")])),{texture:o,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:h,scale:s,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function hs(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),r=n-t,i=.2*e.height,o=t+i;return[t,n,(o-i-t)/r,(o-t)/r]}const ds=new e.am(1,0,0,1),fs=new e.am(0,1,0,1),ps=new e.am(0,0,1,1),ms=new e.am(1,0,1,1),gs=new e.am(0,1,1,1);function _s(t,n,r,i,o,s){for(let a=0;a<r.length;a++)if(o){const o=1,l=.8,c=new e.am(i.r*l,i.g*l,i.b*l,1);ys(t,n,r[a],i,-o,-o,s),ys(t,n,r[a],i,-o,o,s),ys(t,n,r[a],i,o,o,s),ys(t,n,r[a],i,o,-o,s),ys(t,n,r[a],c,0,0,s)}else ys(t,n,r[a],i,0,0,s)}function ys(t,n,r,i,o,s,a){const l=t.context,c=t.transform,u=l.gl,h="globe"===c.projection.name,d=h?["PROJECTION_GLOBE_VIEW"]:[];let f=e.bw(r.projMatrix);if(h&&e.ah(c.zoom)>0){const t=e.bg(r.canonical,c),n=e.ef(t);f=e.az(new Float32Array(16),c.globeMatrix,n),e.az(f,c.projMatrix,f)}const p=e.bz();p[12]+=2*o/(e.q.devicePixelRatio*c.width),p[13]+=2*s/(e.q.devicePixelRatio*c.height),e.az(f,p,f);const m=t.getOrCreateProgram("debug",{defines:d}),g=n.getTileByID(r.key);t.terrain&&t.terrain.setupElevationDraw(g,m);const _=jn.disabled,y=Vn.disabled,v=t.colorModeForRenderPass(),x="$debug";l.activeTexture.set(u.TEXTURE0),t.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?g._makeGlobeTileDebugBuffers(t.context,c):g._makeDebugTileBoundsBuffers(t.context,c.projection);const b=g._tileDebugBuffer||t.debugBuffer,w=g._tileDebugIndexBuffer||t.debugIndexBuffer,S=g._tileDebugSegments||t.debugSegments;if(m.draw(t,u.LINE_STRIP,_,y,v,$n.disabled,po(f,i.toPremultipliedRenderColor(null)),x,b,w,S,null,null,null,[g._globeTileDebugBorderBuffer]),a){const e=g.latestRawTileData,n=Math.floor((e&&e.byteLength||0)/1024);let i=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(i+=` => ${r.overscaledZ}`),i+=` ${g.state}`,i+=` ${n}kb`,function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,r=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,i)}const E=n.getTile(r).tileSize,T=512/Math.min(E,512)*(r.overscaledZ/c.zoom)*.5,A=g._tileDebugTextBuffer||t.debugBuffer,C=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,P=g._tileDebugTextSegments||t.debugSegments;m.draw(t,u.TRIANGLES,_,y,Bn.alphaBlended,$n.disabled,po(f,e.am.transparent.toPremultipliedRenderColor(null),T),x,A,C,P,null,null,null,[g._globeTileDebugTextBuffer])}function vs(e,t,n,r){bs(e,0,t+n/2,e.transform.width,n,r)}function xs(e,t,n,r){bs(e,t-n/2,0,n,e.transform.height,r)}function bs(t,n,r,i,o,s){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*e.q.devicePixelRatio,r*e.q.devicePixelRatio,i*e.q.devicePixelRatio,o*e.q.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const ws=e.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ss}=ws;function Es(e,t,n,r){e.emplaceBack(t,n,r)}class Ts{constructor(t){this.vertexArray=new e.eg,this.indices=new e.a_,Es(this.vertexArray,-1,-1,1),Es(this.vertexArray,1,-1,1),Es(this.vertexArray,-1,1,1),Es(this.vertexArray,1,1,1),Es(this.vertexArray,-1,-1,-1),Es(this.vertexArray,1,-1,-1),Es(this.vertexArray,-1,1,-1),Es(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Ss),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.bd.simpleSegment(0,0,36,12)}}function As(t,n,r,i,o,s){const a=t.context.gl,l=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),u=n.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,n,r,i)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}))(e.ei(e.dJ(),i),o,u,l.toPremultipliedRenderColor(null),c.toPremultipliedRenderColor(null));a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,n.skyboxTexture,0),r.draw(t,a.TRIANGLES,jn.disabled,Vn.disabled,Bn.unblended,$n.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Cs=e.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ps{constructor(t){const n=new e.ej;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const r=new e.a_;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Cs.members),this.indexBuffer=t.createIndexBuffer(r),this.segments=e.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Is=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ks{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ms{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Bn([1,Fn,1,Fn],e.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Bn([1,0,1,0],e.am.transparent,[!1,!1,!1,!0]),this.params=new ks,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ps(n);const t=this.params.sizeRange,r=this.params.intensityRange,i=function(t){const n=e.el(30),r=[];for(let i=0;i<t;++i){const t=2*Math.PI*n(),i=Math.acos(1-2*n())-.5*Math.PI;r.push(e.d2(Math.cos(i)*Math.cos(t),Math.cos(i)*Math.sin(t),Math.sin(i)))}return r}(this.params.starsCount),o=e.el(300),s=new e.ek,a=new e.a_;let l=0;for(let n=0;n<i.length;++n){const c=e.c1([],i[n],200),u=Math.max(0,1+.01*t*(1*o()-.5)),h=Math.max(0,1+.01*r*(1*o()-.5));s.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,1,u,h),s.emplaceBack(c[0],c[1],c[2],-1,1,u,h),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=n.createVertexBuffer(s,Is.members),this.starsIdx=n.createIndexBuffer(a),this.starsSegments=e.bd.simpleSegment(0,0,s.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const r=t.context,i=r.gl,o=t.transform,s=new jn(i.LEQUAL,jn.ReadOnly,[0,1]),a=e.ah(o.zoom),l=t.style.getLut(n.scope),c="none"===n.properties.get("color-use-theme"),u=n.properties.get("color").toNonPremultipliedRenderColor(c?null:l).toArray01(),h="none"===n.properties.get("high-color-use-theme"),d=n.properties.get("high-color").toNonPremultipliedRenderColor(h?null:l).toArray01(),f="none"===n.properties.get("space-color-use-theme"),p=n.properties.get("space-color").toNonPremultipliedRenderColor(f?null:l).toArray01(),m=5e-4,g=e.em(n.properties.get("horizon-blend"),0,1,m,.25),_=e.dy(t,r,o)&&g===m?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,y=t.frameCounter/1e3%1,v=e.ae(o.globeCenterInViewSpace),x=Math.sqrt(Math.pow(v,2)-Math.pow(_,2)),b=Math.acos(x/v),w=e=>{const n="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&n.push("ALPHA_PASS");const l=t.getOrCreateProgram("globeAtmosphere",{defines:n}),c=((e,t,n,r,i,o,s,a,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:n,u_frustum_bl:r,u_horizon:i,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,a,g,u,d,p,y,b);t.uploadCommonUniforms(r,l);const h=this.atmosphereBuffer;h&&l.draw(t,i.TRIANGLES,s,Vn.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,$n.backCW,c,e?"atmosphere_glow_alpha":"atmosphere_glow",h.vertexBuffer,h.indexBuffer,h.segments)};w(!1),w(!0)}drawStars(t,n){const r=e.ay(n.properties.get("star-intensity"),0,1);if(0===r)return;const i=t.context,o=i.gl,s=t.transform,a=t.getOrCreateProgram("stars"),l=e.c3([]);e.c5(l,l,-s._pitch),e.c4(l,l,-s.angle),e.c5(l,l,e.al(s._center.lat)),e.en(l,l,-e.al(s._center.lng));const c=e.c8(new Float32Array(16),l),u=e.az([],s.starsProjMatrix,c),h=e.ei([],c),d=e.eo([],h),f=[0,1,0];e.dL(f,f,d),e.c1(f,f,this.params.sizeMultiplier);const p=[1,0,0];e.dL(p,p,d),e.c1(p,p,this.params.sizeMultiplier);const m=(g=f,_=p,y=r,{u_matrix:Float32Array.from(u),u_up:g,u_right:_,u_intensity_multiplier:y});var g,_,y;t.uploadCommonUniforms(i,a),this.starsVx&&this.starsIdx&&a.draw(t,o.TRIANGLES,jn.disabled,Vn.disabled,this.colorModeAlphaBlendedWriteRGB,$n.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Rs{constructor(){this.visibleTiles=[]}updateBorders(t,n){const r=[],i=[],o=t._getRenderableCoordinates(!1,!0);for(const e of o){const o=t.getTile(e);if(!o.hasData())continue;const s=o.getBucket(n);s&&(s.isEmpty()||(r.push(e.key),i.push({bucket:s,tileID:e.canonical})))}let s=r.length!==this.visibleTiles.length;if(!s){r.sort();for(let e=0;e<r.length;e++)if(r[e]!==this.visibleTiles[e]){s=!0;break}}if(!s)return;const a=new Set;this.visibleTiles=r,i.sort((e,t)=>e.tileID.z-t.tileID.z||e.tileID.x-t.tileID.x||e.tileID.y-t.tileID.y);for(const l of i){const t=new Array,n=new Array,r=l.bucket;for(const e of r.featuresOnBorder)a.has(e.featureId)?n.push(e.footprintIndex):(a.add(e.featureId),t.push(e.footprintIndex));r.updateFootprintHiddenFlags(t,e.ep,!1),r.updateFootprintHiddenFlags(n,e.ep,!0)}}}function Os(t,n){const r=[...t],i=n.cameraWorldSizeForFog/n.worldSize,o=e.bx([]);return e.cP(o,o,[i,i,1]),e.az(r,o,r),e.az(r,n.worldToFogMatrix,r),r}function Ls(t,n,r,i,o){const s=r.material,a=i.context,{baseColorTexture:l,metallicRoughnessTexture:c}=s.pbrMetallicRoughness,{normalTexture:u,occlusionTexture:h,emissionTexture:d}=s;function f(e,n,r){if(e&&(t.push(n),a.activeTexture.set(a.gl.TEXTURE0+r),e.gfxTexture)){const{minFilter:t,magFilter:n,wrapS:r,wrapT:i}=e.sampler;e.gfxTexture.bindExtraParam(t,n,r,i)}}f(l,"HAS_TEXTURE_u_baseColorTexture",Yn.BaseColor),f(c,"HAS_TEXTURE_u_metallicRoughnessTexture",Yn.MetallicRoughness),f(u,"HAS_TEXTURE_u_normalTexture",Yn.Normal),f(h,"HAS_TEXTURE_u_occlusionTexture",Yn.Occlusion),f(d,"HAS_TEXTURE_u_emissionTexture",Yn.Emission),o&&(o.texture||(o.texture=new e.et(i.context,o.image,[o.image.height,o.image.height,o.image.height],a.gl.RGBA8)),a.activeTexture.set(a.gl.TEXTURE0+Yn.LUT),o.texture&&o.texture.bind(a.gl.LINEAR,a.gl.CLAMP_TO_EDGE),t.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(r.texcoordBuffer)),r.colorBuffer&&(t.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(r.colorBuffer)),r.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(r.normalBuffer)),r.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(r.pbrBuffer)),"OPAQUE"!==s.alphaMode&&"MASK"!==s.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),s.defined||t.push("DIFFUSE_SHADED");const p=i.shadowRenderer;p&&(t.push("RENDER_SHADOWS","DEPTH_TEXTURE"),p.useNormalOffset&&t.push("NORMAL_OFFSET"))}function Ds(t,n,r,i,o,s){const a=r.paint.get("model-opacity").constantOr(1),l=n.context,c=new jn(n.context.gl.LEQUAL,jn.ReadWrite,n.depthRangeFor3D),u=n.transform,h=t.mesh,d=h.material,f=d.pbrMetallicRoughness,p=n.style.fog;let m;m="pixels"===n.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.az([],i.zScaleMatrix,t.nodeModelMatrix),e.az(m,i.negCameraPosMatrix,m);const g=e.bi([],m);e.ea(g,g);const _="none"===r.paint.get("model-color-use-theme").constantOr("default"),y=r.paint.get("model-emissive-strength").constantOr(0),v=ko(new Float32Array(t.worldViewProjection),new Float32Array(m),new Float32Array(g),null,n,a,f.baseColorFactor,d.emissiveFactor,f.metallicFactor,f.roughnessFactor,d,y,r),x={defines:[]},b=[],w=n.shadowRenderer;w&&(w.useNormalOffset=!1),Ls(x.defines,b,h,n,_?null:r.lut);let S=null;if(p){const e=Os(t.nodeModelMatrix,n.transform);if(S=new Float32Array(e),"globe"!==u.projection.name){const t=h.aabb.min,n=h.aabb.max,[r,i]=p.getOpacityForBounds(e,t[0],t[1],n[0],n[1]);x.overrideFog=r>=Ne||i>=Ne}}const E=tr(n,r.paint.get("model-cutoff-fade-range"));E.shouldRenderCutoff&&x.defines.push("RENDER_CUTOFF");const T=n.getOrCreateProgram("model",x);n.uploadCommonUniforms(l,T,null,S,E),"shadow"!==n.renderPass&&w&&w.setupShadowsFromMatrix(t.nodeModelMatrix,T),T.draw(n,l.gl.TRIANGLES,c,o,s,h.material.doubleSided?$n.disabled:$n.backCCW,v,r.id,h.vertexBuffer,h.indexBuffer,h.segments,r.paint,n.transform.zoom,void 0,b)}function Ns(t,n,r,i,o,s,a){let l;l="globe"===t.projection.name?e.er(r,t):[...r],e.az(l,l,n.matrix);const c=e.az([],i,l);if(n.meshes)for(const u of n.meshes){if("BLEND"!==u.material.alphaMode){a.push({mesh:u,depth:0,modelIndex:o,worldViewProjection:c,nodeModelMatrix:l});continue}const n=e.ad([],u.centroid,c);!t.isOrthographic&&n[2]<=0||s.push({mesh:u,depth:n[2],modelIndex:o,worldViewProjection:c,nodeModelMatrix:l})}if(n.children)for(const e of n.children)Ns(t,e,r,i,o,s,a)}function zs(e,t,n,r){const i=n.shadowRenderer;if(!i)return;const o=i.getShadowPassDepthMode(),s=i.getShadowPassColorMode(),a=i.calculateShadowPassMatrixFromMatrix(t),l=Mo(a);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,o,Vn.disabled,s,$n.backCCW,l,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,n.transform.zoom,void 0,void 0)}function Fs(t,n,r){const i=n.updateZoomBasedPaintProperties(),o=function(t,n,r){let i,o,s,a=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&a>0){const n=t.terrain,o=n.findDEMTileFor(r);o&&o.dem?i=e.eu.create(n,r,o):a=0}if(0===a&&(n.terrainElevationMin=0,n.terrainElevationMax=0),a===n.validForExaggeration&&(0===a||i&&i._demTile&&i._demTile.tileID===n.validForDEMTile.id&&i._dem._timestamp===n.validForDEMTile.timestamp))return!1;for(const e in n.instancesPerModel){const t=n.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const r=(i?a*i.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=r,o=o?Math.min(n.terrainElevationMin,r):r,s=s?Math.max(n.terrainElevationMax,r):r}}return n.terrainElevationMin=o||0,n.terrainElevationMax=s||0,n.validForExaggeration=a,n.validForDEMTile=i&&i._demTile?{id:i._demTile.tileID,timestamp:i._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,n,r);(i||o)&&(n.uploaded=!1,n.upload(t.context))}const Bs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.d6([0,0,0],[e.aj,e.aj,0])};function js(t,n){const r=1<<t.canonical.z,i=n.getFreeCameraOptions().position,o=n.elevation,s=t.canonical.x/r,a=(t.canonical.x+1)/r,l=t.canonical.y/r,c=(t.canonical.y+1)/r;let u=n._centerAltitude;if(o){const e=o.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const h=e.ay(i.x,s,a)-i.x,d=e.ay(i.y,l,c)-i.y,f=e.cb(u,n.center.lat)-i.z;return n._zoomFromMercatorZ(Math.sqrt(h*h+d*d+f*f))}function Us(e,t,n,r,i,o,s){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new jn(a.gl.LEQUAL,jn.ReadWrite,e.depthRangeFor3D),h=e.isTileAffectedByFog(o);if(n.meshes)for(const d of n.meshes){const f=["MODEL_POSITION_ON_GPU"],p=[];let m,g,_;r.instancedDataArray.length>20&&f.push("INSTANCED_ARRAYS");const y=tr(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&f.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:f}),g=Mo(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(n.matrix)),_=c.getShadowPassColorMode();else{Ls(f,p,d,e,"none"===t.paint.get("model-color-use-theme").constantOr("default")?null:t.lut),m=e.getOrCreateProgram("model",{defines:f,overrideFog:h});const r=d.material,l=r.pbrMetallicRoughness,u=t.paint.get("model-opacity").constantOr(1),v=t.paint.get("model-emissive-strength").constantOr(0);g=ko(o.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,e,u,l.baseColorFactor,r.emissiveFactor,l.metallicFactor,l.roughnessFactor,r,v,t,i),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile"),s.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||u<1||"OPAQUE"!==r.alphaMode?Bn.alphaBlended:Bn.unblended}e.uploadCommonUniforms(a,m,o.toUnwrapped(),null,y);const v=d.material.doubleSided?$n.disabled:$n.backCCW;if(r.instancedDataArray.length>20)p.push(r.instancedDataBuffer),m.draw(e,a.gl.TRIANGLES,u,Vn.disabled,_,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,p,r.instancedDataArray.length);else{const n=l?"u_instance":"u_normal_matrix";for(let i=0;i<r.instancedDataArray.length;++i)g[n]=new Float32Array(r.instancedDataArray.arrayBuffer,64*i,16),m.draw(e,a.gl.TRIANGLES,u,Vn.disabled,_,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,p)}}if(n.children)for(const d of n.children)Us(e,t,d,r,i,o,s)}const Vs=[1,-1,1];function Gs(t,n,r,i){if(!r.modelManager)return!0;const o=r.modelManager;if(!r.shadowRenderer)return!0;const s=r.shadowRenderer,a=n.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const n in t.instancesPerModel){const t=o.getModel(n,i);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}a.max[2]=c,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,e.ad(a.min,a.min,n.tileMatrix),e.ad(a.max,a.max,n.tileMatrix);const u=a.intersects(s.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}function Hs(t,n){const r=t.uniformValues.u_cutoff_params[0],i=t.uniformValues.u_cutoff_params[1],o=t.uniformValues.u_cutoff_params[2],s=t.uniformValues.u_cutoff_params[3];return i===r||s===o?1:e.ay(((n-r)/(i-r)-o)/(s-o),0,1)}function $s(t,n,r,i){if(n.pitch<20)return 1;const o=n.getWorldToCameraMatrix();e.az(o,o,t);const s=e.bR(r.min[0],r.min[1],r.min[2],1);let a=e.aA(e.ev(),s,o),l=a,c=a;s[1]=r.max[1],a=e.aA(e.ev(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,s[0]=r.max[0],a=e.aA(e.ev(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,s[1]=r.min[1],a=e.aA(e.ev(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c;const u=e.ay(i[0],0,1),h=100*n.pixelsPerMeter*e.ay(i[1],0,1),d=e.ay(i[2],0,1),f=e.ew(e.ev(),l,c,u),p=Math.tan(.5*n.fovX),m=-f[2]*p;if(0===h)return f[1]<-Math.abs(m)?d:1;const g=(-Math.abs(m)-f[1])/h,_=(e,t,n)=>(1-n)*e+n*t,y=e.ay(_(1,d,g),d,1);return _(1,y,e.ay((n.pitch-20)/20,0,1))}class Ws{}class qs{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,r){{const e=this._storage.get(n.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const i=r.gl,o=i.getBufferParameter(i.ELEMENT_ARRAY_BUFFER,i.BUFFER_SIZE),s=new ArrayBuffer(o),a=new Int16Array(s);i.getBufferSubData(i.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const l=new e.ey;for(let e=0;e<o/2;e+=3){const t=a[e],n=a[e+1],r=a[e+2];l.emplaceBack(t,n),l.emplaceBack(n,r),l.emplaceBack(r,t)}const c=r.bindVertexArrayOES.current,u=new Ws;return u.buf=new Oo(r,l),u.lastUsedFrameIdx=t,this._storage.set(n.id,u),r.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,n]of this._storage)e-n.lastUsedFrameIdx>30&&(n.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class Xs{constructor(e){this.occluderSize=30,this.depthOffset=-1e-4,e.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),e.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Zs=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ks{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ys{constructor(e,t){this.revealStart=11,this.revealRange=2,e.registerParameter(this,[...t,"Reveal"],"revealStart",{min:0,max:17,step:.05}),e.registerParameter(this,[...t,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Js=e.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class Qs{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const r=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const n=new e.ez,r=new e.a_;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1),r.emplaceBack(0,1,2),r.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(n,Js.members),this.vignetteIdx=t.context.createIndexBuffer(r)}const i=e.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,r);const e={u_vignetteShape:(o={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:o.vignetteColor};r.draw(t,t.context.gl.TRIANGLES,jn.disabled,Vn.disabled,Bn.alphaBlended,$n.disabled,e,"vignette",this.vignetteVx,this.vignetteIdx,i)}var o}}class ea{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const r=t.getFreeCameraOptions().position,i=r.toAltitude(),o=r.toLngLat(),s=e.al(o.lng),a=e.al(o.lat),l=t.pixelsPerMeter/n,c=s*e.eB,u=e.eB*Math.log(Math.tan(Math.PI/4+a/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const e=-this._offsetYPrev+u,t=-this._elevationPrev+i;this._accumulatedOffsetX+=(-this._offsetXPrev+c)*l,this._accumulatedOffsetY+=e*l,this._accumulatedElevation+=t*l,this._offsetXPrev=c,this._offsetYPrev=u,this._elevationPrev=i}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ta(e,t){return[-(e[0]-Math.floor(e[0]/t)*t),-(e[1]-Math.floor(e[1]/t)*t),-(e[2]-Math.floor(e[2]/t)*t)]}function na(t){const n=e.el(1323123451230),r=[];for(let i=0;i<t;++i){const t=2*n()-1,i=2*n()-1,o=2*n()-1;r.push(e.d2(t,i,o))}return r}function ra(t,n,r,i,o){const s=e.ay((o-r)/(i-r),0,1);return(1-s)*t+s*n}class ia{constructor(e){this._movement=new ea,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Qs,this._ppmScaleFactor=e}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const r=t.transform;this._movement.update(r,this._ppmScaleFactor);const i=r.starsProjMatrix,o=e.c3([]);e.c5(o,o,e.al(90)-r._pitch),e.c4(o,o,-r.angle);const s=e.c8(new Float32Array(16),o),a=e.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),l=e.ea([],a),c=e.az([],l,s),u=Date.now()/1e3;return this._accumulatedTimeFromStart+=(u-this._prevTime)*n,this._prevTime=u,{projectionMatrix:i,modelviewMatrix:c}}}class oa extends ia{constructor(e){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ys(e.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const t=na(this.particlesCount),r=new e.eC,i=new e.a_;let o=0;const s=e.el(1323123451230);for(let e=0;e<t.length;++e){const n=t[e],a=[2*s()-1,s(),s(),s()];r.emplaceBack(n[0],n[1],n[2],-1,-1,...a),r.emplaceBack(n[0],n[1],n[2],1,-1,...a),r.emplaceBack(n[0],n[1],n[2],1,1,...a),r.emplaceBack(n[0],n[1],n[2],-1,1,...a),i.emplaceBack(o+0,o+1,o+2),i.emplaceBack(o+0,o+2,o+3),o+=4}this.particlesVx=n.createVertexBuffer(r,Zs.members),this.particlesIdx=n.createIndexBuffer(i)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},r=t.transform.zoom;if(n.revealStart>r)return;const i=ra(0,1,n.revealStart,n.revealStart+n.revealRange,r);if(!this.particlesVx||!this.particlesIdx)return;const o=structuredClone(this._params);let s=[-o.direction.x,o.direction.y,-100];e.au(s,s);const a=structuredClone(this._vignetteParams);a.strength*=i,o.overrideStyleParameters||(o.intensity=t.style.rain.state.density,o.timeFactor=t.style.rain.state.intensity,o.color=structuredClone(t.style.rain.state.color),s=structuredClone(t.style.rain.state.direction),o.screenThinning.intensity=t.style.rain.state.centerThinning,o.dropletSizeX=t.style.rain.state.dropletSize[0],o.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],o.distortionStrength=100*t.style.rain.state.distortionStrength,a.strength=1,a.color=structuredClone(t.style.rain.state.vignetteColor));const l=this.updateOnRender(t,o.timeFactor),c=t.context,u=c.gl,h=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new e.T(c,{width:t.width,height:t.height,data:null},u.RGBA8)),o.distortionStrength>0&&(c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexSubImage2D(u.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const d=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(c,d),c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE);const f=[o.color.r,o.color.g,o.color.b,o.color.a],p=(n,r)=>{const i=ta(this._movement.getPosition(),n),a=o.dropletSizeX,c=o.dropletSizeX*o.dropletSizeYScale,p=t.width/2,m=t.height/2,g=ra(0,o.screenThinning.start,0,1,o.screenThinning.intensity),_=ra(.001,o.screenThinning.range,0,1,o.screenThinning.intensity),y=ra(0,o.screenThinning.particleOffset,0,1,o.screenThinning.intensity),v=(x={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:i,velocityConeAperture:o.velocityConeAperture,velocity:o.velocity,boxSize:n,rainDropletSize:[a,c],distortionStrength:o.distortionStrength,rainDirection:s,color:f,screenSize:[h.width,h.height],thinningCenterPos:[p,m],thinningShape:[g,_,Math.pow(10,o.screenThinning.fadePower)],thinningAffectedRatio:o.screenThinning.affectedRatio,thinningParticleOffset:y,shapeDirectionalPower:o.shapeDirPower,shapeNormalPower:o.shapeNormalPower,mode:r?0:1},{u_modelview:Float32Array.from(x.modelview),u_projection:Float32Array.from(x.projection),u_time:x.time,u_cam_pos:x.camPos,u_texScreen:0,u_velocityConeAperture:x.velocityConeAperture,u_velocity:x.velocity,u_boxSize:x.boxSize,u_rainDropletSize:x.rainDropletSize,u_distortionStrength:x.distortionStrength,u_rainDirection:x.rainDirection,u_color:x.color,u_screenSize:x.screenSize,u_thinningCenterPos:x.thinningCenterPos,u_thinningShape:x.thinningShape,u_thinningAffectedRatio:x.thinningAffectedRatio,u_thinningParticleOffset:x.thinningParticleOffset,u_shapeDirectionalPower:x.shapeDirectionalPower,u_shapeNormalPower:x.shapeNormalPower,u_mode:x.mode});var x;const b=Math.round(o.intensity*this.particlesCount),w=e.bd.simpleSegment(0,0,4*b,2*b);d.draw(t,u.TRIANGLES,jn.disabled,Vn.disabled,Bn.alphaBlended,$n.disabled,v,"rain_particles",this.particlesVx,this.particlesIdx,w)};o.distortionStrength>0&&p(o.boxSize,!0),p(o.boxSize,!1),this._vignette.draw(t,a)}}const sa=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class aa extends ia{constructor(e){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ys(e.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const t=na(this.particlesCount),r=new e.eD,i=new e.a_;let o=0;const s=e.el(1323123451230);for(let e=0;e<t.length;++e){const n=t[e],a=s(),l=s(),c=s(),u=[e/t.length,a,l,c],h=[s(),s()];r.emplaceBack(n[0],n[1],n[2],-1,-1,...u,...h),r.emplaceBack(n[0],n[1],n[2],1,-1,...u,...h),r.emplaceBack(n[0],n[1],n[2],1,1,...u,...h),r.emplaceBack(n[0],n[1],n[2],-1,1,...u,...h),i.emplaceBack(o+0,o+1,o+2),i.emplaceBack(o+0,o+2,o+3),o+=4}this.particlesVx=n.createVertexBuffer(r,sa.members),this.particlesIdx=n.createIndexBuffer(i)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let r=[-n.direction.x,n.direction.y,-100];e.au(r,r);const i=structuredClone(this._vignetteParams),o=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},s=t.transform.zoom;if(o.revealStart>s)return;const a=ra(0,1,o.revealStart,o.revealStart+o.revealRange,s);i.strength*=a,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),r=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,i.strength=1,i.color=structuredClone(t.style.snow.state.vignetteColor));const l=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const c=t.context,u=c.gl,h=t.transform,d=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(c,d),((n,i,o)=>{const s=ta(this._movement.getPosition(),n),a=h.width/2,c=h.height/2,f=ra(0,o.screenThinning.start,0,1,o.screenThinning.intensity),p=ra(.001,o.screenThinning.range,0,1,o.screenThinning.intensity),m=ra(0,o.screenThinning.particleOffset,0,1,o.screenThinning.intensity),g=(_={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:s,velocityConeAperture:o.velocityConeAperture,velocity:o.velocity,horizontalOscillationRadius:o.horizontalOscillationRadius,horizontalOscillationRate:o.horizontalOscillationRate,boxSize:n,billboardSize:1*o.billboardSize,simpleShapeParameters:[o.shapeFadeStart,o.shapeFadePower],screenSize:[h.width,h.height],thinningCenterPos:[a,c],thinningShape:[f,p,Math.pow(10,o.screenThinning.fadePower)],thinningAffectedRatio:o.screenThinning.affectedRatio,thinningParticleOffset:m,color:[o.color.r,o.color.g,o.color.b,o.color.a],direction:r},{u_modelview:Float32Array.from(_.modelview),u_projection:Float32Array.from(_.projection),u_time:_.time,u_cam_pos:_.camPos,u_velocityConeAperture:_.velocityConeAperture,u_velocity:_.velocity,u_horizontalOscillationRadius:_.horizontalOscillationRadius,u_horizontalOscillationRate:_.horizontalOscillationRate,u_boxSize:_.boxSize,u_billboardSize:_.billboardSize,u_simpleShapeParameters:_.simpleShapeParameters,u_screenSize:_.screenSize,u_thinningCenterPos:_.thinningCenterPos,u_thinningShape:_.thinningShape,u_thinningAffectedRatio:_.thinningAffectedRatio,u_thinningParticleOffset:_.thinningParticleOffset,u_particleColor:_.color,u_direction:_.direction});var _;const y=Math.round(o.intensity*this.particlesCount),v=e.bd.simpleSegment(0,0,4*y,2*y);this.particlesVx&&this.particlesIdx&&d.draw(t,u.TRIANGLES,jn.disabled,Vn.disabled,Bn.alphaBlended,$n.disabled,g,"snow_particles",this.particlesVx,this.particlesIdx,v)})(n.boxSize,0,n),this._vignette.draw(t,i)}}const la={symbol:function(t,n,r,i,o){if("translucent"!==t.renderPass)return;const s=Vn.disabled,a=t.colorModeForRenderPass(),l=r.layout.get("text-variable-anchor"),c=r.layout.get("text-size-scale-range"),u=e.ay(t.scaleFactor,c[0],c[1]);l&&function(t,n,r,i,o,s,a,l){const c=n.transform,u="map"===o,h="map"===s;for(const d of t){const t=i.getTile(d),n=t.getBucket(r);if(!n||!n.text||!n.text.segments.get().length)continue;const o=e.bH(n.textSizeData,c.zoom,l),s=Gt(d,n.getProjection(),c),f=c.calculatePixelsToTileUnitsMatrix(t),p=Xt(s,t.tileID.canonical,h,u,c,n.getProjection(),f),m=n.hasIconTextFit()&&n.hasIconData();o&&Go(n,u,h,a,c,p,d,Math.pow(2,c.zoom-t.tileID.overscaledZ),o,m)}}(i,t,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o,u);const h=0!==r.paint.get("icon-opacity").constantOr(1),d=0!==r.paint.get("text-opacity").constantOr(1);void 0!==r.layout.get("symbol-sort-key").constantOr(1)&&(h||d)?Ho(t,n,r,i,s,a):(h&&Ho(t,n,r,i,s,a,{onlyIcons:!0}),d&&Ho(t,n,r,i,s,a,{onlyText:!0})),n.map.showCollisionBoxes&&(Bo(t,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Bo(t,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(t,n,r,i){if("translucent"!==t.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1),c=r.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const u=t.context,h=u.gl,d=t.transform,f=!(!t.terrain||!t.terrain.enabled),p=r.layout.get("circle-elevation-reference"),m=t.depthModeForSublayer(0,jn.ReadOnly),g=new jn(t.context.gl.LEQUAL,jn.ReadOnly,t.depthRangeFor3D),_="none"===p||f?m:g,y=Vn.disabled,v=t.colorModeForDrapableLayerRenderPass(c),x="globe"===d.projection.name,b=[e.aD(d.center.lng),e.aH(d.center.lat)],w=[];for(let E=0;E<i.length;E++){const o=i[E],s=n.getTile(o),a=s.getBucket(r);if(!a||a.projection.name!==d.projection.name)continue;const c=a.programConfigurations.get(r.id),u=a.layoutVertexBuffer,h=a.globeExtVertexBuffer,f=a.indexBuffer,p=e.dW(r),m=[h],g=t.isTileAffectedByFog(o);x&&p.push("PROJECTION_GLOBE_VIEW"),p.push("DEPTH_D24"),t.terrain&&d.depthOcclusionForSymbolsAndCircles&&p.push("DEPTH_OCCLUSION"),a.hasElevation&&!t.terrain&&(p.push("ELEVATED_ROADS"),m.push(a.elevatedLayoutVertexBuffer));const _=t.getOrCreateProgram("circle",{config:c,defines:p,overrideFog:g}),y=d.projection.createInversionMatrix(d,o.canonical),v={programConfiguration:c,program:_,layoutVertexBuffer:u,dynamicBuffers:m,indexBuffer:f,uniformValues:e.dX(t,o,s,y,b,r),tile:s};if(l){const t=a.segments.get();for(const n of t)w.push({segments:new e.bd([n]),sortKey:n.sortKey,state:v})}else w.push({segments:a.segments,sortKey:0,state:v})}l&&w.sort((e,t)=>e.sortKey-t.sortKey);const S={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const e of w){const{programConfiguration:n,program:i,layoutVertexBuffer:o,dynamicBuffers:s,indexBuffer:a,uniformValues:l,tile:c}=e.state,f=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,i,S),t.uploadCommonUniforms(u,i,c.tileID.toUnwrapped()),i.draw(t,h.TRIANGLES,_,y,v,$n.disabled,l,r.id,o,a,f,r.paint,d.zoom,n,s)}},heatmap:function(t,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=Vn.disabled,l=new Bn([s.ONE,s.ONE,s.ONE,s.ONE],e.am.transparent,[!0,!0,!0,!0]);!function(e,t,n,r){const i=e.gl,o=t.width*r,s=t.height*r;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,o,s]);let a=n.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),a=n.heatmapFbo=e.createFramebuffer(o,s,!0,null),function(e,t,n,r,i,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,i,o,0,s.RGBA,e.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(e,0,t,a,o,s)}else i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(o,t,r,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.am.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],d=u?$n.frontCCW:$n.disabled,f=[e.aD(c.center.lng),e.aH(c.center.lat)];for(let e=0;e<i.length;e++){const p=i[e];if(n.hasRenderableParent(p))continue;const m=n.getTile(p),g=m.getBucket(r);if(!g||g.projection.name!==c.projection.name)continue;const _=t.isTileAffectedByFog(p),y=g.programConfigurations.get(r.id),v=t.getOrCreateProgram("heatmap",{config:y,defines:h,overrideFog:_}),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(m,v),t.uploadCommonUniforms(o,v,p.toUnwrapped());const b=c.projection.createInversionMatrix(c,p.canonical);v.draw(t,s.TRIANGLES,jn.disabled,a,l,d,go(t,p,m,b,f,x,r.paint.get("heatmap-intensity")),r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,t.transform.zoom,y,u?[g.globeExtVertexBuffer]:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){const r=t.context,i=r.gl,o=n.heatmapFbo;if(!o)return;r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);let s=n.colorRampTexture;s||(s=n.colorRampTexture=new e.T(r,n.colorRamp,i.RGBA8)),s.bind(i.LINEAR,i.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,i.TRIANGLES,jn.disabled,Vn.disabled,t.colorModeForRenderPass(),$n.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}(t,r))},line:function(t,n,r,i){if("translucent"!==t.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=r.paint.get("line-emissive-strength"),l=r.paint.get("line-occlusion-opacity"),c=r.layout.get("line-elevation-reference"),u="meters"===r.layout.get("line-width-unit"),h="sea"===c,d=!(!t.terrain||!t.terrain.enabled),f=t.context,p=f.gl;if(r.hasElevatedBuckets&&"globe"===t.transform.projection.name)return;const m=r.layout.get("line-cross-slope"),g=void 0!==m,_=m<1,y=t.colorModeForDrapableLayerRenderPass(a),v=t.terrain&&t.terrain.renderingToTexture,x=v?1:e.q.devicePixelRatio,b=r.paint.get("line-dasharray"),w=b.constantOr(1),S=r.layout.get("line-cap"),E=b.constantOr(null),T=S.constantOr(null),A=r.paint.get("line-pattern"),C=A.constantOr(1),P=r.paint.get("line-pattern-cross-fade"),I=A.constantOr(null),k=r.paint.get("line-opacity").constantOr(1);let M=!C&&1!==k||t.depthOcclusion&&l>0&&l<1;const R=r.paint.get("line-gradient"),O=C?"linePattern":"line",L=e.dY(r);let D;if(v&&t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(M=!1),0!==l&&t.depthOcclusion){const t=r.paint._values["line-opacity"];t&&t.value&&"constant"===t.value.kind?D=t.value:e.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}"constant"!==s.value.kind&&!1===s.value.isLineProgressConstant&&L.push("VARIABLE_LINE_WIDTH");const N=(i,o,s,a,c,d)=>{for(const m of i){const i=n.getTile(m);if(C&&!i.patternsLoaded())continue;const g=i.getBucket(r);if(!g)continue;if("none"!==g.elevationType&&!c||"none"===g.elevationType&&c)continue;t.prepareDrawTile();const _=[...o],b=t.shadowRenderer,S="road"===g.elevationType&&!!b&&b.enabled;let A=[0,0,0];if(S){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(A=lr(t.style,e,n)),_.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const L=g.programConfigurations.get(r.id);let N=!1;if(I&&i.imageAtlas){const t=e.dZ.from(I),n=t.getPrimary().scaleSelf(x).toString(),r=i.imageAtlas.patternPositions.get(n),o=t.getSecondary(),s=o?i.imageAtlas.patternPositions.get(o.scaleSelf(x).toString()):null;N=!!r&&!!s,r&&L.setConstantPatternPositions(r,s)}P>0&&(N||L.getPatternTransitionVertexBuffer("line-pattern"))&&_.push("LINE_PATTERN_TRANSITION");const z=t.isTileAffectedByFog(m),F=t.getOrCreateProgram(O,{config:L,defines:_,overrideFog:z});if(!C&&E&&T&&i.lineAtlas){const e=i.lineAtlas.getDash(E,T);e&&L.setConstantPatternPositions(e)}S&&b.setupShadows(i.tileID.toUnwrapped(),F,"vector-tile");let[B,j]=r.paint.get("line-trim-offset");if("round"===T||"square"===T){const e=1;B!==j&&(0===B&&(B-=e),1===j&&(j+=e))}const U=v?m.projMatrix:null,V=u?1/g.tileToMeter/e.aw(i,1,t.transform.zoom):1,G=u?1/g.tileToMeter/e.aw(i,1,Math.floor(t.transform.zoom)):1,H=C?e.d_(t,i,r,U,x,V,G,[B,j],A,P):e.d$(t,i,r,U,g.lineClipsArray.length,x,V,G,[B,j],A);if(R){const i=g.gradients[r.id];let o=i.texture;if(r.gradientVersion!==i.version){let s=256;if(r.stepInterpolant){const r=n.getSource().maxzoom,i=m.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-m.canonical.z):1;s=e.ay(e.e0(g.maxLineLength/e.aj*1024*i),256,f.maxTextureSize)}i.gradient=e.e1({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:i.gradient||void 0,clips:g.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new e.T(f,i.gradient,p.RGBA8),i.version=r.gradientVersion,o=i.texture}f.activeTexture.set(p.TEXTURE1),o.bind(r.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE)}w&&(f.activeTexture.set(p.TEXTURE0),i.lineAtlasTexture&&i.lineAtlasTexture.bind(p.LINEAR,p.REPEAT),L.updatePaintBuffers()),C&&(f.activeTexture.set(p.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),L.updatePaintBuffers()),c&&!h&&t.terrain.setupElevationDraw(i,F),t.uploadCommonUniforms(f,F,m.toUnwrapped());const $=e=>{null!=D&&(D.value=k*l),F.draw(t,p.TRIANGLES,s,e,y,$n.disabled,H,r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,t.transform.zoom,L,[g.layoutVertexBuffer2,g.patternVertexBuffer,g.zOffsetVertexBuffer]),null!=D&&(D.value=k)};if(M&&!c){const e=t.stencilModeForClipping(m).ref;0===e&&v&&f.clear({stencil:0});const n={func:p.EQUAL,mask:255};H.u_alpha_discard_threshold=.8,$(new Vn(n,e,255,p.KEEP,p.KEEP,p.INVERT)),H.u_alpha_discard_threshold=0,$(new Vn(n,e,255,p.KEEP,p.KEEP,p.KEEP))}else H.u_alpha_discard_threshold=M&&c&&d?.8:0,$(c?a:t.stencilModeForClipping(m))}};let z=t.depthModeForSublayer(0,jn.ReadOnly);const F=new jn(t.depthOcclusion?p.GREATER:p.LEQUAL,jn.ReadOnly,t.depthRangeFor3D);if(r.hasNonElevatedBuckets){const n=!v&&t.terrain;0!==l&&n?e.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):n?e.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):N(i,L,z,Vn.disabled,!1,!0)}if(r.hasElevatedBuckets){"hd-road-markup"===c?d||(z=F,L.push("ELEVATED_ROADS")):(L.push("ELEVATED"),z=F,g&&L.push(_?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),h&&L.push("ELEVATION_REFERENCE_SEA"));const e=M?t.stencilModeFor3D():Vn.disabled;t.forceTerrainMode=!0,N(i,L,z,e,!0,!0),M&&N(i,L,z,e,!0,!1),t.forceTerrainMode=!1}M&&(t.resetStencilClippingMasks(),v&&f.clear({stencil:0})),0===l||t.depthOcclusion||v||t.layersWithOcclusionOpacity.push(t.currentLayer)},fill:function(t,n,r,i){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=r.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=r.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(e.am.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";let h="none";"none"!==r.layout.get("fill-elevation-reference")?h="road":0!==r.paint.get("fill-z-offset").constantOr(1)&&(h="offset");const d=!(!t.terrain||!t.terrain.enabled),f={painter:t,sourceCache:n,layer:r,coords:i,colorMode:l,elevationType:h,terrainEnabled:d,pass:u};if("shadow"!==t.renderPass)if("offset"!==h){if(Xo(f,!1),"road"===h){const e=!d&&"translucent"===t.renderPass;e&&qo(t,n,r,i,"geometry"),Xo(f,!0,Vn.disabled),e&&function(e){const{painter:t,sourceCache:n,layer:r,coords:i,colorMode:o}=e,s=t.context.gl,a=e.painter.shadowRenderer,l=!!a&&a.enabled,c=new jn(t.context.gl.LEQUAL,jn.ReadOnly,t.depthRangeFor3D);let u=[0,0,0];if(l){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(u=lr(t.style,e,n))}const h=e=>{for(const h of i){const i=n.getTile(h),d=i.getBucket(r);if(!d)continue;const f=d.elevatedStructures;if(!f)continue;let p,m;if(e?(p=f.renderableBridgeSegments,m=f.bridgeProgramConfigurations.get(r.id)):(p=f.renderableTunnelSegments,m=f.tunnelProgramConfigurations.get(r.id)),!p||0===p.segments[0].primitiveLength)continue;m.updatePaintBuffers(),t.prepareDrawTile();const g=t.isTileAffectedByFog(h),_=[];l&&_.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const y=t.getOrCreateProgram("elevatedStructures",{config:m,overrideFog:g,defines:_}),v=t.translatePosMatrix(h.projMatrix,i,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));l&&a.setupShadows(i.tileID.toUnwrapped(),y,"vector-tile");const x=ao(v,u);t.uploadCommonUniforms(t.context,y,h.toUnwrapped()),y.draw(t,s.TRIANGLES,c,Vn.disabled,o,$n.backCCW,x,r.id,f.vertexBuffer,f.indexBuffer,p,r.paint,t.transform.zoom,m,[f.vertexBufferNormal])}};h(!0),h(!1)}(f)}}else Xo(f,!1,t.stencilModeFor3D());else t.shadowRenderer&&"road"===h&&!d&&function(e){const{painter:t,sourceCache:n,layer:r,coords:i}=e,o=t.context.gl,s=e.painter.shadowRenderer;for(const a of i){const e=n.getTile(a),i=e.getBucket(r);if(!i)continue;const l=i.elevatedStructures;if(!l)continue;if(!l.shadowCasterSegments||0===l.shadowCasterSegments.segments[0].primitiveLength)continue;t.prepareDrawTile();const c=i.bufferData.programConfigurations.get(r.id),u=t.isTileAffectedByFog(a),h=t.getOrCreateProgram("elevatedStructuresDepth",{config:c,overrideFog:u}),d=s.calculateShadowPassMatrixFromTile(e.tileID.toUnwrapped());t.uploadCommonUniforms(t.context,h,a.toUnwrapped());const f={u_matrix:d,u_depth_bias:0};h.draw(t,o.TRIANGLES,s.getShadowPassDepthMode(),Vn.disabled,s.getShadowPassColorMode(),$n.disabled,f,r.id,l.vertexBuffer,l.indexBuffer,l.shadowCasterSegments,r.paint,t.transform.zoom,c)}}(f)},"fill-extrusion":function(t,n,r,i){const o=r.paint.get("fill-extrusion-opacity"),s=t.context,a=s.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u=t.conflationActive&&t.style.isLayerClipped(r,n.getSource()),h=t.style.order.indexOf(r.fqid);if(u&&function(e,t,n,r,i){for(const o of r){const r=t.getTile(o).getBucket(n);r&&(r.updateReplacement(o,e.replacementSource,i),r.uploadCentroid(e.context))}}(t,n,r,i,h),l||u)for(const e of i){const i=n.getTile(e).getBucket(r);i&&Jo(t.context,n,e,i,r,l,u)}if("shadow"===t.renderPass&&t.shadowRenderer){const s=t.shadowRenderer;if(l&&o<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.ab)return;const a=s.getShadowPassDepthMode(),c=s.getShadowPassColorMode();Zo(t,n,r,i,a,Vn.disabled,c,u)}else if("translucent"===t.renderPass){const h=!r.paint.get("fill-extrusion-pattern").constantOr(1),d=r.paint.get("fill-extrusion-color").constantOr(e.am.white);if(!c&&0!==d.a){const e=new jn(t.context.gl.LEQUAL,jn.ReadWrite,t.depthRangeFor3D);1===o&&h?Zo(t,n,r,i,e,Vn.disabled,Bn.unblended,u):(Zo(t,n,r,i,e,Vn.disabled,Bn.disabled,u),Zo(t,n,r,i,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),u),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!l&&"globe"!==t.transform.projection.name||c)){const o=r.paint.get("fill-extrusion-opacity"),h=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),f=r.paint.get("fill-extrusion-flood-light-intensity"),p="none"===r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),m=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(p?null:r.lut).toArray01().slice(0,3),g=h>0&&d>0,_=f>0,y=(e,t,n)=>(1-n)*e+n*t,v=new Ko;v.translate=r.paint.get("fill-extrusion-translate"),v.translateAnchor=r.paint.get("fill-extrusion-translate-anchor"),v.edgeRadius=r.layout.get("fill-extrusion-edge-radius"),v.cutoffFadeRange=r.paint.get("fill-extrusion-cutoff-fade-range");const x=s=>{const l=t.depthModeForSublayer(1,jn.ReadOnly,a.LEQUAL,!0),c=r.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),p=y(.1,3,c),g=t._showOverdrawInspector;if(!g){const c=new Vn({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new Bn([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0],a.MIN);Yo(v,t,n,r,i,l,c,g,$n.disabled,s,"sdf",o,h,d,f,m,p,u,!1)}{const c=g?Vn.disabled:new Vn({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=g?t.colorModeForRenderPass():new Bn([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],e.am.transparent,[!0,!0,!0,!0]);Yo(v,t,n,r,i,l,c,_,$n.disabled,s,"color",o,h,d,f,m,p,u,!1)}};if(c){const c=(s,l,c)=>{const p=t.depthModeForSublayer(1,jn.ReadOnly,a.LEQUAL,!1),g=r.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_=y(.1,3,g);{const c=new Bn([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0]);Yo(v,t,n,r,i,p,Vn.disabled,c,$n.disabled,s,"clear",o,h,d,f,m,_,u,l)}{const c=new Vn({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new Bn([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0],a.MIN);Yo(v,t,n,r,i,p,c,g,$n.disabled,s,"sdf",o,h,d,f,m,_,u,l)}{const c=s?a.ZERO:a.ONE_MINUS_DST_ALPHA,g=new Vn({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),y=new Bn([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],e.am.transparent,[!0,!0,!0,!0]);Yo(v,t,n,r,i,p,g,y,$n.disabled,s,"color",o,h,d,f,m,_,u,l)}{const g=new Bn([a.ONE,a.ONE,a.ONE,s?a.ZERO:a.ONE],e.am.transparent,[!1,!1,!1,!0],s?a.FUNC_ADD:a.MAX);Yo(v,t,n,r,i,p,Vn.disabled,g,$n.disabled,s,"clear",o,h,d,f,m,_,u,l,c)}};if(g||_){let n;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],r=l.drapeBufferSize[1];n=l.framebufferCopyTexture,n&&(!n||n.size[0]===t&&n.size[1]===r)||(n&&n.destroy(),n=l.framebufferCopyTexture=new e.T(s,new e.r({width:t,height:r}),a.RGBA8)),n.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexSubImage2D(a.TEXTURE_2D,0,0,0,0,0,t,r)}g&&c(!0,!1,n),_&&c(!1,!0,n)}}else g&&x(!0),_&&x(!1),(g||_)&&t.resetStencilClippingMasks()}}},building:function(t,n,r,i){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);const o=r.paint.get("building-ambient-occlusion-ground-intensity"),s=r.paint.get("building-ambient-occlusion-ground-radius"),a=r.paint.get("building-ambient-occlusion-ground-attenuation");let l=o>0&&s>0,c=!0;const u=r.paint.get("building-vertical-scale");u<1&&(c=!1);const h=t.conflationActive&&t.style.isLayerClipped(r,n.getSource()),d=t.style.order.indexOf(r.fqid);if(function(e,t,n,r,i,o){for(const s of o){const o=t.getTile(s).getBucket(n);o&&(i&&o.updateReplacement(s,e.replacementSource,r),o.uploadUpdatedIndexBuffer(e.context))}}(t,n,r,d,h,i),function(e,t,n,r){for(const i of r){const r=t.getTile(i).getBucket(n);r&&r.needsEvaluation(e,n)&&(r.evaluate(n),r.uploadUpdatedColorBuffer(e.context))}}(t,n,r,i),r.resetLayerRenderingStats(t),t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0),"shadow"===t.renderPass&&t.shadowRenderer){const e=t.shadowRenderer,o=[],s=e.getShadowPassDepthMode();rs({painter:t,source:n,layer:r,coords:i,defines:o,blendMode:e.getShadowPassColorMode(),depthMode:s,verticalScale:u})}else if("translucent"===t.renderPass){l&&function(t,n,r,i,o,s,a,l,c,u,h,d){const f=t.context.gl,p=t.depthModeForSublayer(1,jn.ReadOnly,f.LEQUAL,!0),m=.1*(1-(g=h))+3*g;var g;const _=t._showOverdrawInspector,y=d,v=new Ko;_||Yo(v,t,n,r,i,p,new Vn({func:f.ALWAYS,mask:255},255,255,f.KEEP,f.KEEP,f.REPLACE),new Bn([f.ONE,f.ONE,f.ONE,f.ONE],e.am.transparent,[!1,!1,!1,!0],f.MIN),$n.disabled,o,"sdf",1,a,l,0,u,m,y,!1);{const s=_?Vn.disabled:new Vn({func:f.EQUAL,mask:255},255,255,f.KEEP,f.DECR,f.DECR),c=_?t.colorModeForRenderPass():new Bn([f.ONE_MINUS_DST_ALPHA,f.DST_ALPHA,f.ONE,f.ONE],e.am.transparent,[!0,!0,!0,!0]);Yo(v,t,n,r,i,p,s,c,$n.disabled,o,"color",1,a,l,0,u,m,y,!1)}}(t,n,r,i,!0,0,o,s,0,[0,0,0],a,h);let d=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];c&&(d=d.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),t.shadowRenderer.useNormalOffset&&(d=d.concat("NORMAL_OFFSET"));const f=new jn(t.context.gl.LEQUAL,jn.ReadWrite,t.depthRangeFor3D),p=t.colorModeForRenderPass();rs({painter:t,source:n,layer:r,coords:i,defines:d,blendMode:p,depthMode:f,verticalScale:u})}else if("light-beam"===t.renderPass){const e=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],o=new jn(t.context.gl.LEQUAL,jn.ReadOnly,t.depthRangeFor3D);rs({painter:t,source:n,layer:r,coords:i,defines:e,blendMode:Bn.alphaBlended,depthMode:o,verticalScale:u})}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1),t.resetStencilClippingMasks()},hillshade:function(e,t,n,r){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const i=e.context,o=e.terrain&&e.terrain.renderingToTexture,[s,a]="translucent"!==e.renderPass||o?[{},r]:e.stencilConfigForOverlap(r);for(const l of a){const r=t.getTile(l);if(r.needsHillshadePrepare&&"offscreen"===e.renderPass)Kr(e,r,n);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,jn.ReadOnly),i=n.paint.get("hillshade-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(i),c=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):s[l.overscaledZ];Xr(e,l,r,n,t,c,a)}}i.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,n,r,i,o,s){if("translucent"!==t.renderPass)return;if(0===r.paint.get("raster-opacity"))return;const a="globe"===t.transform.projection.name,l=0!==r.paint.get("raster-elevation"),c=l&&a;if(t.renderElevatedRasterBackface&&!c)return;const u=t.context,h=u.gl,d=n.getSource(),f=function(t,n,r,i){const o=n.paint.get("raster-color"),s="raster-array"===t.type,a=[],l=n.paint.get("raster-resampling"),c=n.paint.get("raster-color-mix");let u=n.paint.get("raster-color-range");const h=[c[0],c[1],c[2],0],d=c[3];let f="nearest"===l?i.NEAREST:i.LINEAR;if(s&&(a.push("RASTER_ARRAY"),o||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),f=i.NEAREST,!u&&t.rasterLayers)){const e=t.rasterLayers.find(e=>{let{id:t}=e;return t===n.sourceLayer});e&&e.fields&&e.fields.range&&(u=e.fields.range)}if(u=u||[0,1],o){a.push("RASTER_COLOR"),r.activeTexture.set(i.TEXTURE2),n.updateColorRamp(u);let t=n.colorRampTexture;t||(t=n.colorRampTexture=new e.T(r,n.colorRamp,i.RGBA8)),t.bind(i.LINEAR,i.CLAMP_TO_EDGE)}return{mix:h,range:u,offset:d,defines:a,resampling:f}}(d,r,u,h);if(d instanceof e.aP&&!i.length&&!a)return;const p=r.paint.get("raster-emissive-strength"),m=t.colorModeForDrapableLayerRenderPass(p),g=t.terrain&&t.terrain.renderingToTexture,_=!t.options.moving,y="nearest"===r.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(d instanceof e.aP&&!i.length&&(d.onNorthPole||d.onSouthPole)){const e=l?t.stencilModeFor3D():Vn.disabled;return void os(!!d.onNorthPole,null,t,n,r,p,f,$n.disabled,e)}if(!i.length)return;const[v,x]=d instanceof e.aP||g?[{},i]:t.stencilConfigForOverlap(i),b=x[x.length-1].overscaledZ;c&&f.defines.push("PROJECTION_GLOBE_VIEW"),l&&f.defines.push("RENDER_CUTOFF");const w=(i,o,x)=>{for(const w of i){const i=w.toUnwrapped(),S=n.getTile(w);if(g&&(!S||!S.hasData()))continue;u.activeTexture.set(h.TEXTURE0);const E=as(S,d,r,f);if(!E||!E.texture)continue;const{texture:T,mix:A,offset:C,tileSize:P,buffer:I}=E;let k,M;g?(k=jn.disabled,M=w.projMatrix):l?(k=new jn(h.LEQUAL,jn.ReadWrite,t.depthRangeFor3D),M=a?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(i,_)):(k=t.depthModeForSublayer(w.overscaledZ-b,1===r.paint.get("raster-opacity")?jn.ReadWrite:jn.ReadOnly,h.LESS),M=t.transform.calculateProjMatrix(i,_));const R=t.terrain&&g?t.terrain.stencilModeForRTTOverlap(w):v[w.overscaledZ],O=s?0:r.paint.get("raster-fade-duration");S.registerFadeDuration(O);const L=n.findLoadedParent(w,0),D=Vi(S,L,n,t.transform,O);let N,z;t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(h.TEXTURE0),T.bind(y,h.CLAMP_TO_EDGE),u.activeTexture.set(h.TEXTURE1),L?(L.texture&&L.texture.bind(y,h.CLAMP_TO_EDGE),N=Math.pow(2,L.tileID.overscaledZ-S.tileID.overscaledZ),z=[S.tileID.canonical.x*N%1,S.tileID.canonical.y*N%1]):T.bind(y,h.CLAMP_TO_EDGE),"useMipmap"in T&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const F=t.transform;let B;const j=l?ss(F):[0,0,0,0];let U,V,G,H,$,W=0;if(c&&d instanceof e.aP&&d.coordinates.length>3)U=Float32Array.from(e.bh(e.dD(new e.cA(0,0,0)))),V=Float32Array.from(F.globeMatrix),G=Float32Array.from(e.dz(F)),H=[e.aD(F.center.lng),e.aH(F.center.lat)],B=d.elevatedGlobePerspectiveTransform,$=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.dA(w.canonical);W=e.dB(t.getCenter().lat),U=Float32Array.from(e.bh(e.dD(w.canonical))),V=Float32Array.from(F.globeMatrix),G=Float32Array.from(e.dz(F)),H=[e.aD(F.center.lng),e.aH(F.center.lat)],B=[0,0],$=Float32Array.from(e.dC(w.canonical,t,W,F.worldSize/F._pixelsPerMercatorPixel))}else B=d instanceof e.aP?d.perspectiveTransform:[0,0],U=new Float32Array(16),V=new Float32Array(9),G=new Float32Array(16),H=[0,0],$=new Float32Array(9);const q=vo(M,U,V,G,$,z||[0,0],e.ah(t.transform.zoom),H,j,N||1,D,r,B,l?r.paint.get("raster-elevation"):0,2,A,C,f.range,P,I,p),X=t.isTileAffectedByFog(w),Z=t.getOrCreateProgram("raster",{defines:f.defines,overrideFog:X});if(t.uploadCommonUniforms(u,Z,i),d instanceof e.aP){const n=d.elevatedGlobeVertexBuffer,i=d.elevatedGlobeIndexBuffer;if(g||!a)d.boundsBuffer&&d.boundsSegments&&Z.draw(t,h.TRIANGLES,k,Vn.disabled,m,$n.disabled,q,r.id,d.boundsBuffer,t.quadTriangleIndexBuffer,d.boundsSegments);else if(n&&i){const s=F.zoom<=e.cX?d.elevatedGlobeSegments:d.getSegmentsForLongitude(F.center.lng);s&&Z.draw(t,h.TRIANGLES,k,Vn.disabled,m,o,q,r.id,n,i,s)}}else if(c){k=new jn(h.LEQUAL,jn.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[n,i,s]=e.getGridBuffers(W,!1);Z.draw(t,h.TRIANGLES,k,x||R,t.colorModeForRenderPass(),o,q,r.id,n,i,s)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:n,tileBoundsSegments:i}=t.getTileBoundsBuffers(S);Z.draw(t,h.TRIANGLES,k,R,m,$n.disabled,q,r.id,e,n,i)}}if(!(d instanceof e.aP)&&c)for(const e of i){const i=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&os(!0,e,t,n,r,p,f,o,x||Vn.disabled),i&&os(!1,e,t,n,r,p,f,o===$n.frontCW?$n.backCW:$n.frontCW,x||Vn.disabled)}};c?w(x,t.renderElevatedRasterBackface?$n.backCW:$n.frontCW,t.stencilModeFor3D()):w(x,$n.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,n,r,i,o,s){"offscreen"===t.renderPass&&function(t,n,r,i){if(!i.length)return;const o=t.context,s=o.gl,a=n.getSource();if(!(a instanceof it))return;const l=Math.ceil(Math.sqrt(r.paint.get("raster-particle-count")));let c=r.particlePositionRGBAImage;if(!c||c.width!==l){const t=function(e){const t=e*e,n=new Uint8Array(4*t),r=function(e){return e|=0,e=Math.imul(2747636419^e,2654435769),e=Math.imul(e^e>>>16,2654435769),((e=Math.imul(e^e>>>16,2654435769))>>>0)/4294967296},i=1/1.1;for(let o=0;o<t;o++){const e=i*(r(2*o+0)+bo),t=i*(r(2*o+1)+bo),s=255*e%1,a=255*t%1,l=s,c=t-a/255,u=a;n[4*o+0]=255*(e-s/255),n[4*o+1]=255*l,n[4*o+2]=255*c,n[4*o+3]=255*u}return n}(l);c=r.particlePositionRGBAImage=new e.r({width:l,height:l},t)}let u=r.particleFramebuffer;u?u.width!==l&&(u.destroy(),u=r.particleFramebuffer=o.createFramebuffer(l,l,!0,null)):u=r.particleFramebuffer=o.createFramebuffer(l,l,!0,null);const h=[];for(const e of i){const t=n.getTile(e);if(!(t instanceof St))continue;const i=us(t,a,r);if(!i)continue;const s=[t.tileSize,t.tileSize];let u=r.tileFramebuffer;u||(u=r.tileFramebuffer=o.createFramebuffer(s[0],s[1],!0,null));let d=t.rasterParticleState;d||(d=t.rasterParticleState=new cs(o,e,s,c));const f=d.update(r.lastInvalidatedAt);d.particleTextureDimension!==l&&d.updateParticleTexture(e,c);const p=d.targetColorTexture;d.targetColorTexture=d.backgroundColorTexture,d.backgroundColorTexture=p;const m=d.particleTexture0;d.particleTexture0=d.particleTexture1,d.particleTexture1=m,h.push([e,i,d,f])}if(0===h.length)return;const d=e.q.now(),f=r.previousDrawTimestamp?.001*(d-r.previousDrawTimestamp):.0167;if(r.previousDrawTimestamp=d,r.hasColorMap()){o.activeTexture.set(s.TEXTURE0+2);let t=r.colorRampTexture;t||(t=r.colorRampTexture=new e.T(o,r.colorRamp,s.RGBA8)),t.bind(s.LINEAR,s.CLAMP_TO_EDGE)}o.bindFramebuffer.set(r.tileFramebuffer.framebuffer),function(t,n,r){const i=t.context,o=i.gl,s=n.tileFramebuffer;i.activeTexture.set(o.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=n.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const u of r){const[,,r,c]=u;s.colorAttachment.set(r.targetColorTexture.texture),i.viewport.set([0,0,s.width,s.height]),i.clear({color:e.am.transparent}),c&&(r.backgroundColorTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.draw(t,o.TRIANGLES,jn.disabled,Vn.disabled,Bn.alphaBlended,$n.disabled,a,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,r,h),function(t,n,r,i){const o=t.context,s=o.gl,a=r.tileFramebuffer,l="globe"===t.transform.projection.name,c=r.paint.get("raster-particle-max-speed");for(const u of i){const[i,h,d]=u;o.activeTexture.set(s.TEXTURE0+0),h.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a.colorAttachment.set(d.targetColorTexture.texture);const f=t.getOrCreateProgram("rasterParticleDraw",{defines:h.defines,overrideFog:!1});o.activeTexture.set(s.TEXTURE0+1);const p=h.scalarData?[]:[0,1,2,3].map(t=>e.e3[t](i));p.push(i);const m=i.canonical.x,g=i.canonical.y;for(const e of p){const o=n.getTile(l?e.wrapped():e);if(!o)continue;const a=o.rasterParticleState;if(!a)continue;const u=e.canonical.x+(1<<e.canonical.z)*(e.wrap-i.wrap),d=e.canonical.y;a.particleTexture0.bind(s.NEAREST,s.CLAMP_TO_EDGE);const p=So(1,a.particleTexture0.size[0],[u-m,d-g],0,h.texture.size,2,c,h.textureOffset,h.scale,h.offset);f.draw(t,s.POINTS,jn.disabled,Vn.disabled,Bn.alphaBlended,$n.disabled,p,r.id,a.particleIndexBuffer,void 0,a.particleSegment)}}}(t,n,r,h),o.bindFramebuffer.set(r.particleFramebuffer.framebuffer),function(t,n,r,i){const o=t.context,s=o.gl,a=n.paint.get("raster-particle-max-speed"),l=i*n.paint.get("raster-particle-speed-factor")*.15,c=function(e){return Math.pow(e,6)}(.01+1*n.paint.get("raster-particle-reset-rate-factor")),u=n.particleFramebuffer;o.viewport.set([0,0,u.width,u.height]);for(const h of r){const[,r,i]=h;o.activeTexture.set(s.TEXTURE0+0),r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE0+1);const d=i.particleTexture0;d.bind(s.NEAREST,s.CLAMP_TO_EDGE);const f=Eo(1,d.size[0],0,r.texture.size,a,l,c,r.textureOffset,r.scale,r.offset);u.colorAttachment.set(i.particleTexture1.texture),o.clear({color:e.am.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:r.defines}).draw(t,s.TRIANGLES,jn.disabled,Vn.disabled,Bn.unblended,$n.disabled,f,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,r,h,f)}(t,n,r,i),"translucent"===t.renderPass&&(function(t,n,r,i){const o=t.context,s=o.gl,a=n.getSource().tileSize,l=5*(1-e.af(e.cI,e.cI+1,t.transform.zoom))*a+r.paint.get("raster-particle-elevation"),c=!t.options.moving,u="globe"===t.transform.projection.name;if(!i.length)return;const[h,d]=t.stencilConfigForOverlap(i),f=[];u&&f.push("PROJECTION_GLOBE_VIEW");const p=t.stencilModeFor3D();for(const m of d){const i=m.toUnwrapped(),a=n.getTile(m);if(!a.rasterParticleState)continue;const d=a.rasterParticleState,g=100;a.registerFadeDuration(g);const _=n.findLoadedParent(m,0),y=Vi(a,_,n,t.transform,g);let v,x;t.terrain&&t.terrain.prepareDrawTile(),o.activeTexture.set(s.TEXTURE0),d.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE1),_&&_.rasterParticleState?(_.rasterParticleState.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),v=Math.pow(2,_.tileID.overscaledZ-a.tileID.overscaledZ),x=[a.tileID.canonical.x*v%1,a.tileID.canonical.y*v%1]):d.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const b=u?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(i,c),w=t.transform,S=hs(w),E=e.dA(m.canonical),T=e.dB(E.getCenter().lat);let A,C,P,I,k;u?(A=Float32Array.from(e.bh(e.dD(m.canonical))),C=Float32Array.from(w.globeMatrix),P=Float32Array.from(e.dz(w)),I=[e.aD(w.center.lng),e.aH(w.center.lat)],k=Float32Array.from(e.dC(m.canonical,E,T,w.worldSize/w._pixelsPerMercatorPixel))):(A=new Float32Array(16),C=new Float32Array(9),P=new Float32Array(16),I=[0,0],k=new Float32Array(9));const M=wo(b,A,C,P,k,x||[0,0],e.ah(t.transform.zoom),I,S,v||1,y,l),R=t.isTileAffectedByFog(m),O=t.getOrCreateProgram("rasterParticle",{defines:f,overrideFog:R});if(t.uploadCommonUniforms(o,O,i),u){const e=new jn(s.LEQUAL,jn.ReadOnly,t.depthRangeFor3D),n=0,i=t.globeSharedBuffers;if(i){const[o,a,l]=i.getGridBuffers(T,0!==n);O.draw(t,s.TRIANGLES,e,p,Bn.alphaBlended,t.renderElevatedRasterBackface?$n.frontCCW:$n.backCCW,M,r.id,o,a,l)}}else{const e=t.depthModeForSublayer(0,jn.ReadOnly),n=h[m.overscaledZ],{tileBoundsBuffer:i,tileBoundsIndexBuffer:o,tileBoundsSegments:l}=t.getTileBoundsBuffers(a);O.draw(t,s.TRIANGLES,e,n,Bn.alphaBlended,$n.disabled,M,r.id,i,o,l)}}t.resetStencilClippingMasks()}(t,n,r,i),t.style.map.triggerRepaint())},background:function(t,n,r,i){const o=r.paint.get("background-color"),s="none"===r.paint.get("background-color-use-theme").constantOr("default"),a=r.paint.get("background-opacity"),l=r.paint.get("background-emissive-strength"),c="viewport"===r.paint.get("background-pitch-alignment");if(0===a)return;const u=t.context,h=u.gl,d=t.transform,f=d.tileSize,p=r.paint.get("background-pattern");let m;if(void 0!==p){if(null===p)return;if(m=t.imageManager.getPattern(e.I.from(p.toString()),r.scope,t.style.getLut(r.scope)),!m)return}const g=!p&&1===o.a&&1===a&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==g)return;const _=Vn.disabled,y=t.depthModeForSublayer(0,"opaque"===g?jn.ReadWrite:jn.ReadOnly),v=t.colorModeForDrapableLayerRenderPass(l),x=p?"backgroundPattern":"background";let b,w=i;if(w||(b=t.getBackgroundTiles(),w=Object.values(b).map(e=>e.tileID)),p&&(u.activeTexture.set(h.TEXTURE0),t.imageManager.bind(t.context,r.scope)),c){const n=t.getOrCreateProgram(x,{overrideFog:!1,overrideRtt:!0}),i=new Float32Array(e.bx([])),u=new e.aM(0,0,0,0,0),d=p?Po(i,l,a,t,0,r.scope,m,c,{tileID:u,tileSize:f}):Co(i,l,a,o.toPremultipliedRenderColor(s?null:r.lut));n.draw(t,h.TRIANGLES,y,_,v,$n.disabled,d,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}else for(const e of w){const g=t.isTileAffectedByFog(e),w=t.getOrCreateProgram(x,{overrideFog:g}),S=e.toUnwrapped(),E=i?e.projMatrix:t.transform.calculateProjMatrix(S);t.prepareDrawTile();const T=n?n.getTile(e):b?b[e.key]:new wt(e,f,d.zoom,t),A=p?Po(E,l,a,t,0,r.scope,m,c,{tileID:e,tileSize:f}):Co(E,l,a,o.toPremultipliedRenderColor(s?null:r.lut));t.uploadCommonUniforms(u,w,S);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:P,tileBoundsSegments:I}=t.getTileBoundsBuffers(T);w.draw(t,h.TRIANGLES,y,_,v,$n.disabled,A,r.id,C,P,I)}},sky:function(t,n,r){const i=t._atmosphere?e.ah(t.transform.zoom):1,o=r.paint.get("sky-opacity")*i;if(0===o)return;const s=t.context,a=r.paint.get("sky-type"),l=new jn(s.gl.LEQUAL,jn.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===t.renderPass?r.needsSkyboxCapture(t)&&(function(t,n){const r=t.context,i=r.gl;let o=n.skyboxFbo;if(!o){o=n.skyboxFbo=r.createFramebuffer(32,32,!0,null),n.skyboxGeometry=new Ts(r),n.skyboxTexture=r.gl.createTexture(),i.bindTexture(i.TEXTURE_CUBE_MAP,n.skyboxTexture),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);for(let e=0;e<6;++e)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,i.RGBA,32,32,0,i.RGBA,i.UNSIGNED_BYTE,null)}r.bindFramebuffer.set(o.framebuffer),r.viewport.set([0,0,32,32]);const s=n.getCenter(t,!0),a=t.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);e.bx(l),e.eh(l,l,.5*-Math.PI),As(t,n,a,l,s,0),e.bx(l),e.eh(l,l,.5*Math.PI),As(t,n,a,l,s,1),e.bx(l),e.cR(l,l,.5*-Math.PI),As(t,n,a,l,s,2),e.bx(l),e.cR(l,l,.5*Math.PI),As(t,n,a,l,s,3),e.bx(l),As(t,n,a,l,s,4),e.bx(l),e.eh(l,l,Math.PI),As(t,n,a,l,s,5),r.viewport.set([0,0,t.width,t.height])}(t,r),r.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,n,r,i){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,n,r,i)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:i}))(a.skyboxMatrix,t.getCenter(e,!1),0,r,i);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,n,Vn.disabled,e.colorModeForRenderPass(),$n.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,r,l,o,c):"gradient"===a&&"sky"===t.renderPass&&function(t,n,r,i,o){const s=t.context,a=s.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new Ts(s)),s.activeTexture.set(a.TEXTURE0);let u=n.colorRampTexture;u||(u=n.colorRampTexture=new e.T(s,n.colorRamp,a.RGBA8)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,n,r,i,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:n,u_radius:e.al(r),u_opacity:i,u_temporal_offset:o}))(l.skyboxMatrix,n.getCenter(t,!1),n.paint.get("sky-gradient-radius"),i,o);t.uploadCommonUniforms(s,c),c.draw(t,a.TRIANGLES,r,Vn.disabled,t.colorModeForRenderPass(),$n.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,r,l,o,c)},custom:function(t,n,r,i){const o=t.context,s=r.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&r.isDraped(n)){if("offscreen"===t.renderPass){const n=s.prerender;if(n){if(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const r=t.transform.pointMerc;n.call(s,o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ah(t.transform.zoom),[r.x,r.y],t.transform.pixelsPerMeterRatio)}else n.call(s,o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const e=s.renderToTile;if(e){const n=i[0].canonical,r={x:n.x+i[0].wrap*(s.wrapTileId?0:1<<n.z),y:n.y,z:n.z};o.setDepthMode(jn.disabled),o.setStencilMode(Vn.disabled),o.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),e.call(s,o.gl,r),o.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(Vn.disabled);const n="3d"===s.renderingMode?new jn(t.context.gl.LEQUAL,jn.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,jn.ReadOnly);if(o.setDepthMode(n),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;s.render(o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ah(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else s.render(o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,n,r,i){if("opaque"===t.renderPass)return;const o=r.paint.get("model-opacity").constantOr(1);if(0===o)return;const s=r.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!s)return;if(t.terrain&&o<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof e.ab)return}const a=t.shadowRenderer,l=r.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},u=n.getSource();if("light-beam"===t.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(t,n,r,i,o){const s=t.transform;if("mercator"!==s.projection.name)return void e.w(`Drawing 3D models for ${s.projection.name} projection is not yet implemented`);const a=s.getFreeCameraOptions().position;if(!t.modelManager)return;const l=t.modelManager;r.modelManager=l;const c=t.shadowRenderer;if(!r._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const u=r._unevaluatedLayout._values["model-id"],h=Object.assign({},r.layout.get("model-id").parameters),d=t.style.order.indexOf(r.fqid);for(const f of i){const i=n.getTile(f).getBucket(r);if(!i||i.projection.name!==s.projection.name)continue;const p=i.getModelUris();p&&!i.modelsRequested&&(l.addModelsFromBucket(p,o),i.modelsRequested=!0);const m=js(f,s);h.zoom=m;const g=u.possiblyEvaluate(h);if(Fs(t,i,f),Bs.shadowUniformsInitialized=!1,Bs.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(f.toUnwrapped()),"shadow"===t.renderPass&&c){if(1===t.currentShadowCascade&&i.isInsideFirstShadowMapFrustum)continue;const n=s.calculatePosMatrix(f.toUnwrapped(),s.worldSize);if(Bs.tileMatrix.set(n),Bs.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(n)),Bs.aabb.min.fill(0),Bs.aabb.max[0]=Bs.aabb.max[1]=e.aj,Bs.aabb.max[2]=0,Gs(i,Bs,t,r.scope))continue}const _=1<<f.canonical.z,y=[((a.x-f.wrap)*_-f.canonical.x)*e.aj,(a.y*_-f.canonical.y)*e.aj,a.z*_*e.aj];t.conflationActive&&Object.keys(i.instancesPerModel).length>0&&t.style.isLayerClipped(r,n.getSource())&&i.updateReplacement(f,t.replacementSource,d,o)&&(i.uploaded=!1,i.upload(t.context));for(let e in i.instancesPerModel){const n=i.instancesPerModel[e];n.features.length>0&&(e=g.evaluate(n.features[0].feature,{}));const s=l.getModel(e,o);if(s||l.hasURLBeenRequested(e)||i.modelUris.includes(e)||(i.modelUris.push(e),i.modelsRequested=!1),s&&s.uploaded)for(const e of s.nodes)Us(t,r,e,n,y,f,Bs)}}}(t,n,r,i,"vector"===u.type?r.scope:""),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(t,n,r,i){r.resetLayerRenderingStats(t);const o=t.context,s=t.transform,a=t.style.fog,l=t.shadowRenderer;if("mercator"!==s.projection.name)return void e.w(`Drawing 3D landmark models for ${s.projection.name} projection is not yet implemented`);const c=t.transform.getFreeCameraOptions().position,u=e.c1([],[c.x,c.y,c.z],t.transform.worldSize),h=e.eq([],u),d=e.bx([]),f=e.e9(s.center.lat,s.zoom),p=e.bn([],[1,1,1/f]);e.bo(d,d,h);const m=r.paint.get("model-opacity").constantOr(1),g=new jn(o.gl.LEQUAL,jn.ReadWrite,t.depthRangeFor3D),_=new jn(o.gl.LEQUAL,jn.ReadOnly,t.depthRangeFor3D),y=new e.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),v="shadow"===t.renderPass,x=v&&l?l.getCurrentCascadeFrustum():s.getFrustum(s.scaleZoom(s.worldSize)),b=r.paint.get("model-front-cutoff"),w=b[2]<1,S=tr(t,r.paint.get("model-cutoff-fade-range")),E=r.getLayerRenderingStats();(function(e,t,n,r){const i=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const s of r){const r=t.getTile(s).getBucket(n);r&&(r.setFilter(n.filter),e.conflationActive&&r.updateReplacement(s,e.replacementSource),r.evaluateTransform(e,n),e.terrain&&i>0&&r.elevationUpdate(e.terrain,i,s,n.source),r.needsReEvaluation(e,o,n)&&r.evaluate(n))}})(t,n,r,i),function(){let c,h,T;w?(c=i.length-1,h=-1,T=-1):(c=0,h=i.length,T=1);const A=new Float64Array(16),C=e.cx(),P=new e.P(0,0);for(let I=c;I!==h;I+=T){const c=i[I],h=n.getTile(c).getBucket(r);if(!h||!h.uploaded)continue;let T=!1;l&&(T=0===l.getMaxCascadeForTile(c.toUnwrapped()));const k=s.calculatePosMatrix(c.toUnwrapped(),s.worldSize),M=h.modelTraits;!v&&w&&(e.bi(A,k),e.ad(C,u,A),P.x=C[0],P.y=C[1]);const R=[];h.setFilter(r.filter);for(const n of h.getNodesInfo()){if(n.hiddenByReplacement)continue;if(!n.node.meshes)continue;const r=n.node;let i=0;t.terrain&&r.elevation&&(i=r.elevation*t.terrain.exaggeration());const o=(()=>{const t=n.aabb;return y.min=[...t.min],y.max=[...t.max],y.min[2]+=i,y.max[2]+=i,e.ad(y.min,y.min,k),e.ad(y.max,y.max,k),y})(),a=n.evaluatedScale;if(a[0]<=1&&a[1]<=1&&a[2]<=1&&0===o.intersects(x))continue;if(!v&&w){const t=1/6;n.cameraCollisionOpacity=u[0]>o.min[0]&&u[0]<o.max[0]&&u[1]>o.min[1]&&u[1]<o.max[1]&&u[2]*f<o.max[2]&&r.footprint&&e.bY(P,r.footprint)?Math.max(n.cameraCollisionOpacity-t,0):Math.min(1,n.cameraCollisionOpacity+t)}const l=[...k],h=1/e.d4(c.canonical),d=r.anchor?r.anchor[0]:0,p=r.anchor?r.anchor[1]:0;e.bo(l,l,[d*(a[0]-1)+n.evaluatedTranslation[0]*h,p*(a[1]-1)+n.evaluatedTranslation[1]*h,i+n.evaluatedTranslation[2]]),e.cn(a,e.es)||e.cP(l,l,a);const g=e.az([],l,r.matrix),_=e.az([],s.expandedFarZProjMatrix,g),E=e.az([],s.expandedFarZProjMatrix,l),T=e.aA([],[d,p,i,1],_)[2];r.hidden=!1;let A=m;v||(w&&(A*=n.cameraCollisionOpacity,A*=$s(l,s,n.aabb,b)),A*=Hs(S,T)),0!==A?R.push({nodeInfo:n,depth:T,opacity:A,wvpForNode:_,wvpForTile:E,nodeModelMatrix:g,tileModelMatrix:l}):r.hidden=!0}v||R.sort((e,t)=>!w||1===e.opacity&&1===t.opacity?e.depth<t.depth?-1:1:1===e.opacity?-1:1===t.opacity?1:e.depth>t.depth?-1:1);for(const n of R){const i=n.nodeInfo,c=i.node;let u=e.az([],p,n.tileModelMatrix);e.az(u,d,u);const h=e.bi([],u);e.ea(h,h),e.cP(h,h,Vs),u=e.az(u,u,c.matrix);const f="light-beam"===t.renderPass,m="none"===r.paint.get("model-color-use-theme").constantOr("default"),y=M&e.ex.HasMapboxMeshFeatures,x=y?0:i.evaluatedRMEA[0][2];for(let e=0;e<c.meshes.length;++e){const d=c.meshes[e],p=e===c.lightMeshIndex;let b=n.wvpForNode;if(p){if(!f&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}b=n.wvpForTile}else if(f)continue;const w={defines:[]},S=[];if(!v&&l&&(l.useNormalOffset=!!d.normalBuffer),Ls(w.defines,S,d,t,m?null:r.lut),y||w.defines.push("DIFFUSE_SHADED"),T&&w.defines.push("SHADOWS_SINGLE_CASCADE"),E&&(v?E.numRenderedVerticesInShadowPass+=d.vertexArray.length:E.numRenderedVerticesInTransparentPass+=d.vertexArray.length),v){zs(d,n.nodeModelMatrix,t,r);continue}let A=null;if(a){const e=Os(n.nodeModelMatrix,t.transform);if(A=new Float32Array(e),"globe"!==s.projection.name){const t=d.aabb.min,n=d.aabb.max,[r,i]=a.getOpacityForBounds(e,t[0],t[1],n[0],n[1]);w.overrideFog=r>=Ne||i>=Ne}}const C=d.material;let P;C.occlusionTexture&&C.occlusionTexture.offsetScale&&(P=C.occlusionTexture.offsetScale,w.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const I=t.getOrCreateProgram("model",w);!v&&l&&l.setupShadowsFromMatrix(n.tileModelMatrix,I,l.useNormalOffset),t.uploadCommonUniforms(o,I,null,A);const k=C.pbrMetallicRoughness;k.metallicFactor=.9,k.roughnessFactor=.5;const M=ko(new Float32Array(b),new Float32Array(u),new Float32Array(h),new Float32Array(c.matrix),t,n.opacity,k.baseColorFactor,C.emissiveFactor,k.metallicFactor,k.roughnessFactor,C,x,r,[0,0,0],P);!p&&(i.hasTranslucentParts||n.opacity<1)&&I.draw(t,o.gl.TRIANGLES,g,Vn.disabled,Bn.disabled,$n.backCCW,M,r.id,d.vertexBuffer,d.indexBuffer,d.segments,r.paint,t.transform.zoom,void 0,S),I.draw(t,o.gl.TRIANGLES,p?_:g,Vn.disabled,p||n.opacity<1||i.hasTranslucentParts?Bn.alphaBlended:Bn.unblended,$n.backCCW,M,r.id,d.vertexBuffer,d.indexBuffer,d.segments,r.paint,t.transform.zoom,void 0,S)}}}}()}(t,n,r,i),void c();if("model"!==u.type)return;const h=u.getModels(),d=[],f=t.transform.getFreeCameraOptions().position,p=e.c1([],[f.x,f.y,f.z],t.transform.worldSize);e.eq(p,p);const m=[],g=[];let _=0;for(const y of h){const n=r.paint.get("model-rotation").constantOr(null),i=r.paint.get("model-scale").constantOr(null),o=r.paint.get("model-translation").constantOr(null);y.computeModelMatrix(t,n,i,o,!0,!0,!1);const s=e.bx([]),a=e.e9(y.position.lat,t.transform.zoom),l=e.bn([],[1,1,1/a]);e.bo(s,s,p),d.push({zScaleMatrix:l,negCameraPosMatrix:s});for(const e of y.nodes)Ns(t.transform,e,y.matrix,t.transform.expandedFarZProjMatrix,_,m,g);_++}if(m.sort((e,t)=>t.depth-e.depth),"shadow"!==t.renderPass){if(1===o)for(const e of g)Ds(e,t,r,d[e.modelIndex],Vn.disabled,t.colorModeForRenderPass());else{for(const e of g)Ds(e,t,r,d[e.modelIndex],Vn.disabled,Bn.disabled);for(const e of g)Ds(e,t,r,d[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of m)Ds(e,t,r,d[e.modelIndex],Vn.disabled,t.colorModeForRenderPass());c()}else{for(const e of g)zs(e.mesh,e.nodeModelMatrix,t,r);for(const e of m)zs(e.mesh,e.nodeModelMatrix,t,r);c()}}},ca={line:function(e,t,n){if(e.hasElevatedBuckets=!1,e.hasNonElevatedBuckets=!1,void 0!==e._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==e._unevaluatedLayout.getValue("line-z-offset")){if(t){const n=t.getVisibleCoordinates();for(const r of n){const n=t.getTile(r).getBucket(e);if(n&&("none"!==n.elevationType?e.hasElevatedBuckets=!0:e.hasNonElevatedBuckets=!0,e.hasElevatedBuckets&&e.hasNonElevatedBuckets))break}}}else e.hasNonElevatedBuckets=!0},model:function(e,t,n){const r=t.getSource();if(!r.loaded())return;if("vector"===r.type||"geojson"===r.type)return void(n.modelManager&&n.modelManager.upload(n,"vector"===r.type?e.scope:""));if("batched-model"===r.type)return;if("model"!==r.type)return;const i=r.getModels();for(const o of i)o.upload(n.context)},raster:function(e,t,n){const r=t.getSource();if(!(r instanceof it&&r.loaded()))return;const i=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!i)return;const o=e.paint.get("raster-array-band")||r.getInitialBand(i);if(null==o)return;const s=t.getIds().map(e=>t.getTileByID(e));for(const a of s)a.updateNeeded(e.id,o)&&r.prepareTile(a,i,e.id,o)},"raster-particle":function(e,t,n){const r=t.getSource();if(!(r instanceof it&&r.loaded()))return;const i=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!i)return;const o=e.paint.get("raster-particle-array-band")||r.getInitialBand(i);if(null==o)return;const s=t.getIds().map(e=>t.getTileByID(e));for(const a of s)a.updateNeeded(e.id,o)&&r.prepareTile(a,i,e.id,o)}},ua={fill:qo},ha={fill:function(e,t,n,r){if(!n.layout||"none"===n.layout.get("fill-elevation-reference"))return;const i=e.context.gl,o=new jn(i.LEQUAL,jn.ReadOnly,e.depthRangeFor3D),s=new Vn({func:i.ALWAYS,mask:255},255,255,i.KEEP,i.KEEP,i.REPLACE),a=e.transform.getFreeCameraOptions().position,l=e.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const c of r){const r=t.getTile(c),u=r.getBucket(n);if(!u)continue;const h=u.elevatedStructures;if(!h||0===h.depthSegments.segments[0].primitiveLength)continue;const d=Wo(c.toUnwrapped(),a),f=e.translatePosMatrix(c.projMatrix,r,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),p=lo(f,d,0,1,0);l.draw(e,i.TRIANGLES,o,s,Bn.disabled,$n.disabled,p,n.id,h.vertexBuffer,h.indexBuffer,h.depthSegments,n.paint,e.transform.zoom)}}};class da{constructor(t,n,r,i,o,s){this.context=new zo(t,n),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=o,this._timeStamp=e.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const a=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const e of a)this._debugParams.enabledLayers[e]=!0;o.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),o.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),o.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),o.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),o.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),o.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const e of a)o.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.occlusionParams=new Xs(o),this.setup(),this.numSublayers=At.maxUnderzooming+At.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new or(this),this._wireframeDebugCache=new qs,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const l=new e.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,l,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=i,this.worldview=s}updateTerrain(e,t){const n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wi(this,e));const r=this._terrain;this.transform.elevation=n?r:null,r.update(e,this.transform,t),this.transform.elevation&&!r.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,r]=t.getFovAdjustedRange(this.transform._fov);if(n>r)return void(this.transform.fogCullDistSq=null);const i=n+.78*(r-n);this.transform.fogCullDistSq=i*i}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new Wi(this,this.style)),this._forceTerrainMode=e}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*e.q.devicePixelRatio,this.height=n*e.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,n=new e.ba;n.emplaceBack(0,0),n.emplaceBack(e.aj,0),n.emplaceBack(0,e.aj),n.emplaceBack(e.aj,e.aj),this.tileExtentBuffer=t.createVertexBuffer(n,e.bc.members),this.tileExtentSegments=e.bd.simpleSegment(0,0,4,2);const r=new e.ba;r.emplaceBack(0,0),r.emplaceBack(e.aj,0),r.emplaceBack(0,e.aj),r.emplaceBack(e.aj,e.aj),this.debugBuffer=t.createVertexBuffer(r,e.bc.members),this.debugSegments=e.bd.simpleSegment(0,0,4,5);const i=new e.ba;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(i,e.bc.members),this.viewportSegments=e.bd.simpleSegment(0,0,4,2);const o=new e.aZ;o.emplaceBack(0,0,0,0),o.emplaceBack(e.aj,0,e.aj,0),o.emplaceBack(0,e.aj,0,e.aj),o.emplaceBack(e.aj,e.aj,e.aj,e.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.bf.members),this.mercatorBoundsSegments=e.bd.simpleSegment(0,0,4,2);const s=new e.a_;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new e.bb;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.T(t,new e.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=e.bz();const l=this.context.gl;this.stencilClearMode=new Vn({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,jn.disabled,this.stencilClearMode,Bn.disabled,$n.disabled,Ui(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,n){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const r=this.context,i=r.gl;this.nextStencilID+n.length>256&&this.clearStencil(),r.setColorMode(Bn.disabled),r.setDepthMode(jn.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of n){const e=t.getTile(s),n=this._tileClippingMaskIDs[s.key]=this.nextStencilID++,{tileBoundsBuffer:r,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);o.draw(this,i.TRIANGLES,jn.disabled,new Vn({func:i.ALWAYS,mask:0},n,255,i.KEEP,i.KEEP,i.REPLACE),Bn.disabled,$n.disabled,Ui(s.projMatrix),"$clipping",r,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Vn({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new Vn({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,n=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),r=n[n.length-1].overscaledZ,i=n[0].overscaledZ-r+1;if(i>1){this.currentStencilSource=void 0,this.nextStencilID+i>256&&this.clearStencil();const e={};for(let n=0;n<i;n++)e[n+r]=new Vn({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[e,n]}return[{[r]:Vn.disabled},n]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new Bn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.am(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Bn.unblended:Bn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Bn([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new e.am(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.depthOcclusion)return new jn(this.context.gl.GREATER,jn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!r)return jn.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new jn(n||this.context.gl.LEQUAL,t,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),r=Math.ceil(this.height),i=this.context.bindFramebuffer.get(),o=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===r||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==n&&0!==r&&(this.depthFBO=new No(this.context,n,r,!1,"texture"),this.depthTexture=new e.T(this.context,{width:n,height:r,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(i),t.bindTexture(t.TEXTURE_2D,o),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,r,0,0,n,r,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((e,t)=>e+t/this._fpsHistory.length,0))}render(t,n){const r=e.q.now();this._dt=r-this._timeStamp,this._timeStamp=r,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const i=this.style._mergedLayers,o=!(!this.terrain||!this.terrain.enabled),s=()=>this.style._getOrder(o).filter(e=>{const t=i[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]});let a=s(),l=!1,c=!1,u=null;for(const e of a){const t=i[e];"circle"===t.type?l=!0:"building"===t.type?u=t:"symbol"===t.type&&(t.hasInitialOcclusionOpacityProperties?c=!0:l=!0)}let h=a.map(e=>i[e]);const d=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.q.now()),this.imageManager.beginFrame();let f=0,p=!1;for(const e in d){const t=d[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++f)}let m=!1;for(const e of h)e.isHidden(this.transform.zoom)||("clip"===e.type&&(m=!0),this.prepareLayer(e));const g={},_={},y={},v={},x={};for(const e in d){const t=d[e];g[e]=t.getVisibleCoordinates(),_[e]=g[e].slice().reverse(),y[e]=t.getVisibleCoordinates(!0).reverse(),v[e]=t.getShadowCasterCoordinates(),x[e]=t.sortCoordinatesByDistance(g[e])}const b=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(f||m||this._clippingActiveLastFrame){const t=[],n=[];let r=0;for(const e of h)this.isSourceForClippingOrConflation(e,b(e))&&(t.push(e),n.push(r)),r++;if(t&&(m||t.length>1)||this._clippingActiveLastFrame){m=!1;const r=[];for(let i=0;i<t.length;i++){const o=t[i],s=n[i],a=this.style.getLayerSourceCache(o);if(!a||!a.used||!a.getSource().usedInConflation&&"clip"!==o.type&&"building"!==o.type)continue;let l=e.eF,c=e.bW.None;const u=[];let h=!0;if("building"===o.type)l=e.eH;else if("clip"===o.type){l=s;for(const t of o.layout.get("clip-layer-types"))c|="model"===t?e.bW.Model:"symbol"===t?e.bW.Symbol:e.bW.FillExtrusion;for(const e of o.layout.get("clip-layer-scope"))u.push(e);o.isHidden(this.transform.zoom)?h=!1:m=!0}h&&r.push({layer:o.fqid,cache:a,order:l,clipMask:c,clipScope:u})}this.replacementSource.setSources(r),p=!0}}this._clippingActiveLastFrame=m,p||this.replacementSource.clear(),this.conflationActive=p,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<h.length;e++){const t=h[e],n=t.cutoffRange();if(this.longestCutoffRange=Math.max(n,this.longestCutoffRange),n>0){const e=b(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}t.is3D(o)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e)}const w=this.style&&this.style.fog;w?(this._fogVisible=0!==w.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0,a=s(),h=a.map(e=>i[e]));const S=this._shadowRenderer;if(S){S.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in d)for(const t of g[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),S.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ms(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const E=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),T=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(E&&!this._snow&&(this._snow=new aa(this)),!E&&this._snow&&(this._snow.destroy(),delete this._snow),T&&!this._rain&&(this._rain=new oa(this)),!T&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),u){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Rs);const e=this.style.getLayerSourceCache(u);this.buildingTileBorderManager.updateBorders(e,u)}if(!j.has(this.context.gl))return;this.renderPass="offscreen";for(const e of h){const n=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const r=n?_[n.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||r&&r.length)&&this.renderLayer(this,n,e,r)}this.depthRangeFor3D=[0,1-(h.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const A="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),C=(()=>{if(n.showOverdrawInspector)return e.am.black;const t=this.style.fog;if(t&&this.transform.projection.supportsFog){const n=this.style.getLut(t.scope);if(!A){const r="none"===t.properties.get("color-use-theme"),i=t.properties.get("color").toNonPremultipliedRenderColor(r?null:n).toArray01();return new e.am(...i)}if(A){const r="none"===t.properties.get("space-color-use-theme"),i=t.properties.get("space-color").toNonPremultipliedRenderColor(r?null:n).toArray01();return new e.am(...i)}}return e.am.transparent})();if(this.context.clear({color:C,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&A&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const e=h[this.currentLayer],n=t.getLayerSourceCache(e);if(e.isSky())continue;const r=n?(e.is3D(o)?x:_)[n.id]:void 0;this._renderTileClippingMasks(e,n,r),this.renderLayer(this,n,e,r)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&A&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.ah(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const e=h[this.currentLayer],n=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,n,e,n?_[n.id]:void 0)}function P(e,t){let n;return t&&(n=("symbol"===e.type?y:e.is3D(o)?x:_)[t.id]),n}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<a.length;){const e=h[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){const n=t.getLayerSourceCache(e);this.renderLayer(this,n,e,P(e,n))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let I=0;S&&(I=S.getShadowCastingLayerCount());let k=!1,M=-1;for(let e=0;e<a.length;++e){const t=h[e];t.isHidden(this.transform.zoom)||t.is3D(o)&&(M=e)}c&&-1===M&&(l=!0);let R=!1;for(;this.currentLayer<a.length;){const e=h[this.currentLayer],n=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!R&&e.is3D(o)&&!o){const e=this.currentLayer,t=e=>{for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const t=h[this.currentLayer];if(ua[t.type]){const n=this.style.getLayerSourceCache(t);ua[t.type](this,n,t,P(t,n),e)}}};t("initialize"),t("reset"),this.currentLayer=e,R=!0}if(l&&!k&&this.terrain&&!this.transform.isOrthographic&&(k=!0,this.blitDepth()),c&&-1!==M&&this.currentLayer===M+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(e,n,n?g[n.id]:void 0),this.renderLayer(this,n,e,P(e,n)),!this.terrain&&S&&I>0&&e.hasShadowPass()&&0==--I){{this.clearStencil(),this.resetStencilClippingMasks();const e=this.currentLayer;for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const e=h[this.currentLayer];if(ha[e.type]){const t=this.style.getLayerSourceCache(e);ha[e.type](this,t,e,P(e,t))}}this.currentLayer=e}if(S.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=h[this.currentLayer];if(!e.hasLightBeamPass())continue;const n=t.getLayerSourceCache(e);this.renderLayer(this,n,e,n?_[n.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const e=this.currentLayer;this.depthOcclusion=!0;for(const n of this.layersWithOcclusionOpacity){this.currentLayer=n;const e=h[this.currentLayer],r=t.getLayerSourceCache(e),i=r?_[r.id]:void 0;this.terrain||this._renderTileClippingMasks(e,r,r?g[r.id]:void 0),this.renderLayer(this,r,e,i)}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let n=null;h.forEach(e=>{const r=t.getLayerSourceCache(e);r&&!e.isHidden(this.transform.zoom)&&r.getVisibleCoordinates().length&&(!n||n.getSource().maxzoom<r.getSource().maxzoom)&&(n=r)}),n&&this.options.showTileBoundaries&&_s(this,n,n.getVisibleCoordinates(),e.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&_s(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;vs(e,e.transform.height-(t.top||0),3,ds),vs(e,t.bottom||0,3,fs),xs(e,t.left||0,3,ps),xs(e,e.transform.width-(t.right||0),3,ms);const n=e.transform.centerPoint;!function(e,t,n,r){bs(e,t-1,n-10,2,20,r),bs(e,t-10,n-1,20,2,r)}(e,n.x,e.transform.height-n.y,gs)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),p||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,n=!t||!t.includes(e.type);if(ca[e.type]&&(n||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);ca[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||"model"===n.type||"raster"===n.type||"raster-particle"===n.type||r&&r.length)&&(this.id=n.id,this.gpuTimingStart(n),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(n.type)&&(!e.terrain||"custom"!==n.type)||"clip"===n.type||la[n.type](e,t,n,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,n=this.context.gl;let r=this.gpuTimers[e.id];r||(r=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:n.createQuery()}),r.calls++,n.beginQuery(t.TIME_ELAPSED_EXT,r.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,n=t.createQuery();this.deferredRenderGpuTimeQueries.push(n),t.beginQuery(e.TIME_ELAPSED_EXT,n)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const n in e){const r=e[n],i=this.context.extTimerQuery,o=i.getQueryParameter(r.query,this.context.gl.QUERY_RESULT)/1e6;i.deleteQueryEXT(r.query),t[n]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.gl;let n=0;for(const r of e)n+=t.getQueryParameter(r,t.QUERY_RESULT)/1e6,t.deleteQuery(r);return n}translatePosMatrix(t,n,r,i,o){if(!r[0]&&!r[1])return t;const s=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}const a=[o?r[0]:e.aw(n,r[0],this.transform.zoom),o?r[1]:e.aw(n,r[1],this.transform.zoom),0],l=new Float32Array(16);return e.bo(l,t,a),l}saveTileTexture(e){if(e.context!==this.context)return;const t=e.size[0],n=this._tileTextures[t];n?n.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,n){const r=void 0===n?this.terrain&&this.terrain.renderingToTexture:n,i=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(i.push("LIGHTING_3D_MODE"),i.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):r||i.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||i.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(i.push("TERRAIN"),this.linearFloatFilteringSupported()&&i.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&i.push("GLOBE"),!this._fogVisible||r||void 0!==t&&!t||i.push("FOG","FOG_DITHERING"),r&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}getOrCreateProgram(e,t){this.cache=this.cache||{};const n=t&&t.defines||[],r=t&&t.config,i=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(n),o=Ki.cacheKey(Gr[e],e,i,r);return this.cache[o]||(this.cache[o]=new Ki(this.context,e,Gr[e],r,Ro[e],i)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const r=this.style.directionalLight,i=this.style.ambientLight;if(r&&i){const o=((t,n,r)=>{const i=t.properties.get("direction"),o="none"===t.properties.get("color-use-theme"),s=t.properties.get("color").toNonPremultipliedRenderColor(o?null:r.getLut(t.scope)).toArray01(),a=t.properties.get("intensity"),l="none"===n.properties.get("color-use-theme"),c=n.properties.get("color").toNonPremultipliedRenderColor(l?null:r.getLut(n.scope)).toArray01(),u=n.properties.get("intensity"),h=[i.x,i.y,i.z],d=e.dI(c,u),f=e.dI(s,a);return{u_lighting_ambient_color:d,u_lighting_directional_dir:h,u_lighting_directional_color:f,u_ground_radiance:qi(h,f,d)}})(r,i,this.style);n.setLightsUniformValues(t,o)}}}uploadCommonUniforms(t,n,r,i,o){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const o=s.getOpacity(this.transform.pitch),a=((t,n,r,i,o,s,a,l,c,u,h,d)=>{const f=t.transform,p="none"===n.properties.get("color-use-theme"),m=n.properties.get("color").toNonPremultipliedRenderColor(p?null:t.style.getLut(n.scope)).toArray01();m[3]=i;const g=t.frameCounter/1e3%1,[_,y]=n.properties.get("vertical-range");return{u_fog_matrix:r?f.calculateFogTileMatrix(r):d||t.identityMat,u_fog_range:n.getFovAdjustedRange(f._fov),u_fog_color:m,u_fog_horizon_blend:n.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_,y),y],u_fog_temporal_offset:g,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.ah(f.zoom),u_is_globe:+("globe"===f.projection.name)}})(this,s,r,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.q.devicePixelRatio,this.transform.height*e.q.devicePixelRatio],i);n.setFogUniformValues(t,a)}o&&n.setCutoffUniformValues(t,o.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const r of n)t[r.key]=e[r.key]||new wt(r,512,this.transform.tileZoom,this,void 0,this.worldview);return t}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(e,t){return!(!e.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==e.type&&"building"!==e.type&&(e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==e.sourceLayer&&"procedural_buildings"!==e.sourceLayer)&&(!t||"batched-model"!==t.type)))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=Ne||t[1]>=Ne}setupDepthForOcclusion(e,t,n){const r=this.context,i=r.gl,o=!!n;var s;n||(n={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),r.activeTexture.set(i.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),n.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],n.u_depth_range_unpack=[2/((s=this.depthRangeFor3D)[1]-s[0]),-1-2*s[0]/(s[1]-s[0])],n.u_occluder_half_size=.5*this.occlusionParams.occluderSize,n.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),r.activeTexture.set(i.TEXTURE0),o||t.setTerrainUniformValues(r,n)}}function fa(e,t){let n=!1,r=null;const i=()=>{r=null,n&&(e(),r=setTimeout(i,t),n=!1)};return()=>(n=!0,r||i(),r)}class pa{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=fa(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=ma(e);if(this._hashName){const e=this._hashName;let n=!1;const r=location.hash.slice(1).split("&").map(r=>{const i=r.split("=")[0];return i===e?(n=!0,`${i}=${t}`):r}).filter(e=>e);return n||r.push(`${e}=${t}`),`#${r.join("&")}`}return`#${t}`}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some(e=>isNaN(Number(e)))){const n=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ma(e,t){const n=e.getCenter(),r=Math.round(100*e.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),s=Math.round(n.lng*o)/o,a=Math.round(n.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?`/${s}/${a}/${r}`:`${r}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const ga={linearity:.3,easing:e.eI(0,0,.3,1)},_a=e.h({deceleration:2500,maxSpeed:1400},ga),ya=e.h({deceleration:20,maxSpeed:1400},ga),va=e.h({deceleration:1e3,maxSpeed:360},ga),xa=e.h({deceleration:1e3,maxSpeed:90},ga);class ba{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=e.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(n.pan.mag()){const o=Sa(n.pan.mag(),r,e.h({},_a,t||{}));i.offset=n.pan.mult(o.amount/n.pan.mag()),i.center=this._map.transform.center,wa(i,o)}if(n.zoom){const e=Sa(n.zoom,r,ya);i.zoom=this._map.transform.zoom+e.amount,wa(i,e)}if(n.bearing){const t=Sa(n.bearing,r,va);i.bearing=this._map.transform.bearing+e.ay(t.amount,-179,179),wa(i,t)}if(n.pitch){const e=Sa(n.pitch,r,xa);i.pitch=this._map.transform.pitch+e.amount,wa(i,e)}if(i.zoom||i.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;i.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),i.noMoveStart=!0,i}}function wa(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Sa(t,n,r){const{maxSpeed:i,linearity:o,deceleration:s}=r,a=e.ay(t*o/(n/1e3),-i,i),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class Ea extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=_(n.getCanvasContainer(),r),s=n.unproject(o);super(t,e.h({point:o,lngLat:s,originalEvent:r},i)),this._defaultPrevented=!1,this.target=n}}class Ta extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,r){const i="touchend"===t?r.changedTouches:r.touches,o=y(n.getCanvasContainer(),i),s=o.map(e=>n.unproject(e)),a=o.reduce((e,t,n,r)=>e.add(t.div(r.length)),new e.P(0,0));super(t,{points:o,point:a,lngLats:s,lngLat:n.unproject(a),originalEvent:r}),this._defaultPrevented=!1}}class Aa extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t){super("wheel",{originalEvent:t}),this._defaultPrevented=!1}}class Ca{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new Aa(this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Ea(e.type,this._map,e))}mouseup(e){this._map.fire(new Ea(e.type,this._map,e))}preclick(t){const n=e.h({},t);n.type="preclick",this._map.fire(new Ea(n.type,this._map,n))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Ea(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Ea(e.type,this._map,e))}mouseover(e){this._map.fire(new Ea(e.type,this._map,e))}mouseout(e){this._map.fire(new Ea(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ta(e.type,this._map,e))}touchmove(e){this._map.fire(new Ta(e.type,this._map,e))}touchend(e){this._map.fire(new Ta(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ta(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pa{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new Ea(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ea("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Ea(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ia{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(f(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t,r=this._startPos,i=this._lastPos;if(!r||!i||i.equals(n)||!this._box&&n.dist(r)<this._clickTolerance)return;this._lastPos=n,this._box||(this._box=l("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(r.x,n.x),s=Math.max(r.x,n.x),a=Math.min(r.y,n.y),c=Math.max(r.y,n.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${o}px,${a}px)`,this._box.style.width=s-o+"px",this._box.style.height=c-a+"px")})}mouseupWindow(t,n){if(!this._active)return;const r=this._startPos,i=n;if(r&&0===t.button){if(this.reset(),g(),r.x!==i.x||r.y!==i.y)return this._map.fire(new e.A("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(r,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),p(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.A(t,{originalEvent:n}))}}function ka(e,t){const n={};for(let r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}class Ma{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const n=new e.P(0,0);for(const e of t)n._add(e);return n.div(t.length)}(n),this.touches=ka(r,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const r=ka(n,t);for(const i in this.touches){const e=r[i];(!e||e.dist(this.touches[i])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Ra{constructor(e){this.singleTap=new Ma(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const r=this.singleTap.touchend(e,t,n);if(r){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(r)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Oa{constructor(){this._zoomIn=new Ra({numTouches:1,numTaps:2}),this._zoomOut=new Ra({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const r=this._zoomIn.touchend(e,t,n),i=this._zoomOut.touchend(e,t,n);return r?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(i)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const La={0:1,2:2},Da={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Na{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=v(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const n=La[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&v(e)===this._eventButton&&(this._moved&&g(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class za extends Na{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Fa extends Na{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?Da[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class Ba extends Na{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?Da[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class ja{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),e.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(t,n,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length&&!e.eJ())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,r)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,r){r.length>0&&(this._active=!0);const i=ka(r,n),o=new e.P(0,0),s=new e.P(0,0);let a=0;for(const e in i){const t=i[e],n=this._touches[e];n&&(o._add(t),s._add(t.sub(n)),a++,i[e]=t)}if(this._touches=i,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ua{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){const r=this._firstTwoTouches;if(!r)return;e.preventDefault();const[i,o]=r,s=Va(n,t,i),a=Va(n,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[r,i]=this._firstTwoTouches,o=Va(n,t,r),s=Va(n,t,i);o&&s||(this._active&&g(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Va(e,t,n){for(let r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function Ga(e,t){return Math.log(e/t)/Math.LN2}class Ha extends Ua{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ga(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ga(this._distance,n),pinchAround:t}}}function $a(e,t){return 180*e.angleWith(t)/Math.PI}class Wa extends Ua{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$a(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;const r=$a(e,n);return Math.abs(r)<t}}function qa(e){return Math.abs(e.y)>Math.abs(e.x)}class Xa extends Ua{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,qa(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,n,r){const i=this._lastPoints;if(!i)return;const o=t[0].sub(i[0]),s=t[1].sub(i[1]);return this._map._cooperativeGestures&&!e.eJ()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,r.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,i=t.mag()>=2;if(!r&&!i)return;if(!r||!i)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return qa(e)&&qa(t)&&o}}const Za={panStep:100,bearingStep:15,pitchStep:10};class Ka{constructor(){const e=Za;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,r=0,i=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,r=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Ya,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+n*this._bearingStep,pitch:s.getPitch()+r*this._pitchStep,offset:[-i*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ya(e){return e*(2-e)}const Ja=4.000244140625,Qa=1/450;class el{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Qa,e.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.eJ()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=e.q.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%Ja==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=_(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Ja?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const i=n(),o=Math.pow(2,i),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*r))),"wheel"===this._type&&(this._startZoom=i,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:n(),i=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&i&&o){const t=Math.min((e.q.now()-this._lastWheelEventTime)/200,1),n=o(t);s=e.ai(i,r,n),t<1?this._frameId||(this._frameId=!0):a=!0}else s=r,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let l=s-n();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.eK;if(this._prevEase){const t=this._prevEase,r=(e.q.now()-t.start)/t.duration,i=t.easing(r+.01)-t.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=e.eI(o,s,.25,1)}return this._prevEase={start:e.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class tl{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rl{constructor(){this._tap=new Ra({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ol{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class sl{constructor(e,t,n,r){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const al=e=>e.zoom||e.drag||e.pitch||e.rotate;class ll extends e.A{}class cl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const r=e.at([],n,t);this.radius=e.ae(r[2]<0?e.eM([],r,this.constants):[r[0],r[1],0])}projectRay(t){e.eM(t,t,this.constants),e.au(t,t),e.eN(t,t,this.constants);const n=e.c1([],t,this.radius);if(n[2]>0){const t=e.c1([],[0,0,1],e.bG(n,[0,0,1])),r=e.c1([],e.au([],[n[0],n[1],0]),this.radius),i=e.d5([],n,e.c1([],e.at([],e.d5([],r,t),n),2));n[0]=i[0],n[1]=i[1]}return n}}function ul(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class hl{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ba(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),e.aV(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,i,o]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(i,t,o)}}destroy(){for(const[e,t,n]of this._listeners){const r=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,r,n)}}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Ca(t,e));const r=t.boxZoom=new Ia(t,e);this._add("boxZoom",r);const i=new Oa,o=new nl;t.doubleClickZoom=new tl(o,i),this._add("tapZoom",i),this._add("clickZoom",o);const s=new rl;this._add("tapDragZoom",s);const a=t.touchPitch=new Xa(t);this._add("touchPitch",a);const l=new Fa(e),c=new Ba(e);t.dragRotate=new ol(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new za(e),h=new ja(t,e);t.dragPan=new il(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Wa,f=new Ha;t.touchZoomRotate=new sl(n,f,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Pa(t));const p=t.scrollZoom=new el(t,this);this._add("scrollZoom",p,["mousePan"]);const m=t.keyboard=new Ka;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!al(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,n){for(const r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){this._updatingCamera=!0;const n="renderFrame"===e.type,r=n?void 0:e,i={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?y(this._el,a):n?void 0:_(this._el,e);for(const{handlerName:h,handler:d,allowed:f}of this._handlers){if(!d.isEnabled())continue;let n;this._blockedByActive(s,f,h)?d.reset():d[t||e.type]&&(n=d[t||e.type](e,l,a),this.mergeHandlerResult(i,o,n,h,r),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||d.isActive())&&(s[h]=d)}const c={};for(const h in this._previousActiveHandlers)s[h]||(c[h]=r);this._previousActiveHandlers=s,(Object.keys(c).length||ul(i))&&(this._changes.push([i,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||ul(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=i;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,n,r,i,o){if(!r)return;e.h(t,r);const s={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=s),void 0!==r.panDelta&&(n.drag=s),void 0!==r.pitchDelta&&(n.pitch=s),void 0!==r.bearingDelta&&(n.rotate=s)}_applyChanges(){const t={},n={},r={};for(const[i,o,s]of this._changes)i.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(i.panDelta)),i.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(t.around=i.around),void 0!==i.aroundCoord&&(t.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(t.pinchAround=i.pinchAround),i.noInertia&&(t.noInertia=i.noInertia),e.h(n,o),e.h(r,s);this._updateMapTransform(t,n,r),this._changes=[]}_updateMapTransform(t,n,r){const i=this._map,o=i.transform,s=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!ul(t)){const e=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),e!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&i._stop(!0),!ul(t))return void this._fireEvents(n,r,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:f}=t;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==f&&(h=f),(l||(e=>n[e]&&!this._eventsInProgress[e])("drag"))&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",i._stop(!0),h=h||i.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const p=[0,0,0];if(a)if("mercator"===o.projection.name){const e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(a)).dir);p[0]=t[0]-e[0],p[1]=t[1]-e[1]}else{const t=o.pointCoordinate(h);if("globe"===o.projection.name){a=a.rotate(-o.angle);const n=o._pixelsPerMercatorPixel/o.worldSize;p[0]=-a.x*e.eL(e.aY(t.y))*n,p[1]=-a.y*e.eL(o.center.lat)*n}else{const e=o.pointCoordinate(h.sub(a));t&&e&&(p[0]=e.x-t.x,p[1]=e.y-t.y)}}const m=o.zoom,g=[0,0,0];if(l){const t=s(d||o.pointCoordinate3D(h)),n={dir:e.au([],e.at([],t,o._camera.position))};if(n.dir[2]<0){const r=o.zoomDeltaToMovement(t,l);e.c1(g,n.dir,r)}}const _=e.d5(p,p,g);o._translateCameraConstrained(_),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,r,!0)}_fireEvents(t,n,r){const i=al(this._eventsInProgress),o=al(t),s={};for(const e in t){const{originalEvent:n}=t[e];this._eventsInProgress[e]||(s[`${e}start`]=n),this._eventsInProgress[e]=t[e]}!i&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in s)this._fireEvent(e,s[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:n}=t[e];this._fireEvent(e,n)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=n[t]||r,a[`${e}end`]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=al(this._eventsInProgress);if(r&&(i||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(n(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.A("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.A(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new ll("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const dl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class fl extends e.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,e.aV(["_renderFrameCallback"],this)}getCenter(){return new e.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,n,r){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.h({offset:t},n),r)}panTo(t,n,r){return this.easeTo(e.h({center:t},n),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,n,r){return this.easeTo(e.h({zoom:t},n),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,n,r){return this.easeTo(e.h({bearing:t},n),r)}resetNorth(t,n){return this.rotateTo(0,e.h({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.h({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,n){t=e.aG.convert(t);const r=n&&n.bearing||0,i=n&&n.pitch||0,o=t.getNorthWest(),s=t.getSouthEast();return this._cameraForBounds(this.transform,o,s,r,i,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return null==t?e.h({},n,this.transform.padding):"number"==typeof t?{top:t,bottom:t,right:t,left:t}:e.h({},n,t)}_extendCameraOptions(t){return(t=e.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(e,t){const n=t.max[0]-t.min[0],r=t.max[1]-t.min[1];return n/r>e.aspect?n/(2*Math.tan(.5*e.fovX)*e.aspect):r/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,n,r,i,o,s){const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=i,a.pitch=o;const c=e.ci.convert(n),u=e.ci.convert(r),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),f=e.eO(h,d),p=e.au([],f),m=e.au([],e.bF([],p,[0,1,0])),g=e.bF([],m,p),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,p[0],p[1],p[2],0,0,0,0,1],y=[f,e.eO(c.lat,c.lng),e.eO(u.lat,c.lng),e.eO(u.lat,u.lng),e.eO(c.lat,u.lng),e.eO(h,c.lng),e.eO(h,u.lng),e.eO(c.lat,d),e.eO(u.lat,d)];let v=e.d6.fromPoints(y.map(t=>[e.bG(m,t),e.bG(g,t),e.bG(p,t)]));const x=e.ad([],v.center,_);0===e.eP(x)&&e.eQ(x,0,0,1),e.au(x,x),e.c1(x,x,e.aB),a.center=e.eR(x);const b=a.getWorldToCameraMatrix(),w=e.bi(new Float64Array(16),b);v=e.d6.applyTransform(v,e.az([],b,_));const S=this._extendAABB(v,a,l,i);if(!S)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=S,e.ad(x,x,b);const E=.5*(v.max[2]-v.min[2]),T=this._minimumAABBFrustumDistance(a,v),A=e.c1([],[0,0,1],E),C=e.d5(A,x,A),P=T+(0===a.pitch?0:e.bD(x,C)),I=a.globeCenterInViewSpace,k=e.at([],x,[I[0],I[1],I[2]]);e.au(k,k),e.c1(k,k,P);const M=e.d5([],x,k);e.ad(M,M,w);const R=e.eB/e.aB,O=e.ae(M),L=e.cb(Math.max(O*R-e.eB,Number.EPSILON),0),D=Math.min(a.zoomFromMercatorZAdjusted(L),l.maxZoom);return D>.5*(e.cX+e.cI)?(a.setProjection({name:"mercator"}),a.zoom=D,this._cameraForBounds(a,n,r,i,o,s)):{center:a.center,zoom:D,bearing:i,pitch:o}}_extendAABB(t,n,r,i){const o=.5*((r.padding.left||0)+(r.padding.right||0)),s=.5*((r.padding.top||0)+(r.padding.bottom||0)),a=s,l=o,c=o,u=s,h=n.width-(l+c),d=n.height-(a+u),f=e.at([],t.max,t.min),p=Math.min(h/f[0],d/f[1]),m=Math.min(n.scaleZoom(n.scale*p),r.maxZoom);if(isNaN(m))return null;const g=n.scale/n.zoomScale(m),_=new e.d6([t.min[0]-l*g,t.min[1]-u*g,t.min[2]],[t.max[0]+c*g,t.max[1]+a*g,t.max[2]]),y=("number"==typeof r.offset.x&&"number"==typeof r.offset.y?new e.P(r.offset.x,r.offset.y):e.P.convert(r.offset)).rotate(-e.al(i));return _.center[0]-=y.x*g,_.center[1]+=y.y*g,_}queryTerrainElevation(t,n){const r=this.transform.elevation;return r?(n=e.h({},{exaggerated:!0},n),r.getAtPoint(e.ac.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,r,i,o,s){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,n,r,i,o,s);const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=i,a.pitch=o;const c=e.ci.convert(n),u=e.ci.convert(r),h=new e.ci(c.lng,u.lat),d=new e.ci(u.lng,c.lat),f=a.project(c),p=a.project(u),m=this.queryTerrainElevation(c),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),v=[[f.x,f.y,Math.min(m||0,g||0,_||0,y||0)],[p.x,p.y,Math.max(m||0,g||0,_||0,y||0)]];let x=e.d6.fromPoints(v);const b=a.getWorldToCameraMatrix(),w=e.bi(new Float64Array(16),b);x=e.d6.applyTransform(x,b);const S=this._extendAABB(x,a,l,i);if(!S)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=S;const E=.5*e.at([],x.max,x.min)[2],T=this._minimumAABBFrustumDistance(a,x),A=[0,0,1,0];e.aA(A,A,b),e.eS(A,A);const C=e.c1([],A,T+E),P=e.d5([],x.center,C);e.ad(x.center,x.center,w),e.ad(P,P,w);const I=a.unproject(new e.P(x.center[0],x.center[1])),k=e.eT(a.projection,I),M=Math.pow(2,k),R=Math.min(a._zoomFromMercatorZ(P[2]*a.pixelsPerMeter*M/a.worldSize),l.maxZoom);return a.mercatorFromTransition&&R<.5*(e.cX+e.cI)?(a.setProjection({name:"globe"}),a.zoom=R,this._cameraForBounds(a,n,r,i,o,s)):{center:I,zoom:R,bearing:i,pitch:o}}fitBounds(e,t,n){const r=this.cameraForBounds(e,t);return this._fitInternal(r,t,n)}fitScreenCoordinates(t,n,r,i,o){const s=e.P.convert(t),a=e.P.convert(n),l=new e.P(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new e.P(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.P(l.x,c.y)),f=this.transform.pointLocation3D(new e.P(c.x,l.y)),p=[Math.min(u.lng,h.lng,d.lng,f.lng),Math.min(u.lat,h.lat,d.lat,f.lat)],m=[Math.max(u.lng,h.lng,d.lng,f.lng),Math.max(u.lat,h.lat,d.lat,f.lat)],g=i&&i.pitch?i.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,p,m,r,g,i);return this._fitInternal(_,i,o)}_fitInternal(t,n,r){return t?(n=e.h(t,n)).linear?this.easeTo(n,r):this.flyTo(n,r):this}jumpTo(t,n){this.stop();const r=t.preloadOnly?this.transform.clone():this.transform;let i=!1,o=!1,s=!1;"zoom"in t&&r.zoom!==+t.zoom&&(i=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.ci.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(o=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(s=!0,r.pitch=+t.pitch);const a="number"==typeof t.padding?this._extendPadding(t.padding):t.padding;if(null!=t.padding&&!r.isPaddingEqual(a))if(!1===t.retainPadding){const e=r.clone();e.padding=a,r.setLocationAtPoint(r.center,e.centerPoint)}else r.padding=a;return t.preloadOnly?(this._preloadTiles(r),this):(this.fire(new e.A("movestart",n)).fire(new e.A("move",n)),i&&this.fire(new e.A("zoomstart",n)).fire(new e.A("zoom",n)).fire(new e.A("zoomend",n)),o&&this.fire(new e.A("rotatestart",n)).fire(new e.A("rotate",n)).fire(new e.A("rotateend",n)),s&&this.fire(new e.A("pitchstart",n)).fire(new e.A("pitch",n)).fire(new e.A("pitchend",n)),this.fire(new e.A("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(dl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const r=this.transform;if(!r.projection.supportsFreeCamera)return e.w(dl),this;this.stop();const i=r.zoom,o=r.pitch,s=r.bearing;r.setFreeCameraOptions(t);const a=i!==r.zoom,l=o!==r.pitch,c=s!==r.bearing;return this.fire(new e.A("movestart",n)).fire(new e.A("move",n)),a&&this.fire(new e.A("zoomstart",n)).fire(new e.A("zoom",n)).fire(new e.A("zoomend",n)),c&&this.fire(new e.A("rotatestart",n)).fire(new e.A("rotate",n)).fire(new e.A("rotateend",n)),l&&this.fire(new e.A("pitchstart",n)).fire(new e.A("pitch",n)).fire(new e.A("pitchend",n)),this.fire(new e.A("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.h({offset:[0,0],duration:500,easing:e.eK},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const r=this.transform,i=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:i,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h=this._extendPadding(t.padding),d=e.P.convert(t.offset);let f,p,m;if("globe"===r.projection.name){const n=e.ac.fromLngLat(r.center),i=d.rotate(-r.angle);n.x+=i.x/r.worldSize,n.y+=i.y/r.worldSize;const o=n.toLngLat(),s=e.ci.convert(t.center||o);this._normalizeCenter(s),f=r.centerPoint.add(i),p=new e.P(n.x,n.y).mult(r.worldSize),m=new e.P(e.aD(s.lng),e.aH(s.lat)).mult(r.worldSize).sub(p)}else{f=r.centerPoint.add(d);const n=r.pointLocation(f),i=e.ci.convert(t.center||n);this._normalizeCenter(i),p=r.project(n),m=r.project(i).sub(p)}const g=r.zoomScale(l-i);let _,y;t.around&&(_=e.ci.convert(t.around),y=r.locationPoint(_));const v=this._zooming||l!==i,x=this._rotating||o!==c,b=this._pitching||u!==s,w=!r.isPaddingEqual(h),S=!1===t.retainPadding?r.clone():r,E=r=>E=>{if(v&&(r.zoom=e.ai(i,l,E)),x&&(r.bearing=e.ai(o,c,E)),b&&(r.pitch=e.ai(s,u,E)),w&&(S.interpolatePadding(a,h,E),f=S.centerPoint.add(d)),_)r.setLocationAtPoint(_,y);else{const e=r.zoomScale(r.zoom-i),t=l>i?Math.min(2,g):Math.max(.5,g),n=Math.pow(t,1-E),o=r.unproject(p.add(m.mult(E*n)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,f)}return t.preloadOnly||this._fireMoveEvents(n),r};if(t.preloadOnly){const e=this._emulate(E,t.duration,r);return this._preloadTiles(e),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,T),this._ease(E(r),e=>{"sea"===r.cameraElevationReference&&r.recenterOnTerrain(),this._afterEase(n,e)},t),this}_prepareEase(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||r.moving||this.fire(new e.A("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.A("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.A("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.A("move",t)),this._zooming&&this.fire(new e.A("zoom",t)),this._rotating&&this.fire(new e.A("rotate",t)),this._pitching&&this.fire(new e.A("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.A("zoomend",t)),i&&this.fire(new e.A("rotateend",t)),o&&this.fire(new e.A("pitchend",t)),this.fire(new e.A("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const r=e.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(r,n)}this.stop(),t=e.h({offset:[0,0],speed:1.2,curve:1.42,easing:e.eK},t);const r=this.transform,i=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.ay(+t.zoom,r.minZoom,r.maxZoom):i,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h=this._extendPadding(t.padding),d=r.zoomScale(l-i),f=e.P.convert(t.offset);let p=r.centerPoint.add(f);const m=r.pointLocation(p),g=e.ci.convert(t.center||m);this._normalizeCenter(g);const _=r.project(m),y=r.project(g).sub(_);let v=t.curve;const x=Math.max(r.width,r.height),b=x/d,w=y.mag();if("minZoom"in t){const n=e.ay(Math.min(t.minZoom,i,l),r.minZoom,r.maxZoom),o=x/r.zoomScale(n-i);v=Math.sqrt(o/w*2)}const S=v*v;function E(e){const t=(b*b-x*x+(e?-1:1)*S*S*w*w)/(2*(e?b:x)*S*w);return Math.log(Math.sqrt(t*t+1)-t)}function T(e){return(Math.exp(e)-Math.exp(-e))/2}function A(e){return(Math.exp(e)+Math.exp(-e))/2}const C=E(0);let P=function(e){return A(C)/A(C+v*e)},I=function(e){return x*((A(C)*(T(t=C+v*e)/A(t))-T(C))/S)/w;var t},k=(E(1)-C)/v;if(Math.abs(w)<1e-6||!isFinite(k)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,n);const e=b<x?-1:1;k=Math.abs(Math.log(b/x))/v,I=function(){return 0},P=function(t){return Math.exp(e*v*t)}}t.duration="duration"in t?+t.duration:1e3*k/("screenSpeed"in t?+t.screenSpeed/v:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const M=o!==c,R=u!==s,O=!r.isPaddingEqual(h),L=!1===t.retainPadding?r.clone():r,D=r=>d=>{const m=d*k,v=1/P(m);r.zoom=1===d?l:i+r.scaleZoom(v),M&&(r.bearing=e.ai(o,c,d)),R&&(r.pitch=e.ai(s,u,d)),O&&(L.interpolatePadding(a,h,d),p=L.centerPoint.add(f));const x=1===d?g:r.unproject(_.add(y.mult(I(m))).mult(v));return r.setLocationAtPoint(r.renderWorldCopies?x.wrap():x,p),r._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),r};if(t.preloadOnly){const e=this._emulate(D,t.duration,r);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=M,this._pitching=R,this._padding=O,this._prepareEase(n,!1),this._ease(D(r),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,n,r){!1===r.animate||0===r.duration?(t(1),n()):(this._easeStart=e.q.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=e.bQ(t,-180,180);const r=Math.abs(t-n);return Math.abs(t-360-n)<r&&(t-=360),Math.abs(t+360-n)<r&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,n){const r=Math.ceil(15*t/1e3),i=[],o=e(n.clone());for(let s=0;s<=r;s++){const e=o(s/r);i.push(e.clone())}return i}_preloadTiles(e,t){}}class pl{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact,n=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=l("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",n);const r=l("span","mapboxgl-ctrl-icon",this._compactButton);return r.setAttribute("aria-hidden","true"),r.setAttribute("title",n),this._innerContainer=l("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.e.ACCESS_TOKEN}];if(t){const r=n.reduce((e,t,r)=>(t.value&&(e+=`${t.key}=${t.value}${r<n.length-1?"&":""}`),e),"?");t.href=`${e.e.FEEDBACK_URL}/${r}#${ma(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const r in t){const n=t[r];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort((e,t)=>e.length-t.length),e=e.filter((t,n)=>{for(let r=n+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ml{constructor(){e.aV(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=l("div","mapboxgl-ctrl");const t=l("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class gl{constructor(){e.aV(["_onIndoorUpdate"],this)}onAdd(e){return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",e=>this._onIndoorUpdate({selectedFloorId:e.selectedFloorId,floors:e.floors})),this._container}_createButton(e,t){const n=l("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){this._map&&(e.setAttribute("aria-label",t),e.innerHTML=`<strong>${t}</strong>`,e.firstElementChild&&e.firstElementChild.setAttribute("title",t))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(e){if(!e||!e.floors)return void(this._container.style.display="none");const t=this._model;this._model=e,this._container.style.display="inline-block";const n=e.floors.sort((e,t)=>e.levelOrder-t.levelOrder);t?(Array.from(this._container.children).forEach(e=>e.remove()),this.addCurrentFloors(n)):this.addCurrentFloors(n)}addCurrentFloors(e){for(const t of e){const e=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(t.id),Array.from(this._container.children).forEach(e=>{e.classList.remove("mapboxgl-ctrl-level-button-selected")}),e.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(e,t.shortName),this._model&&t.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(t.id),e.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(e)}}}class _l{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const r of n)if(r.id===e)return void(r.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class yl{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=e.dx((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const vl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class xl extends e.A{constructor(e,t,n,r){const{point:i,lngLat:o,originalEvent:s,target:a}=e;super(e.type,{point:i,lngLat:o,originalEvent:s,target:a}),this.preventDefault=()=>{e.preventDefault()},this.id=t,this.interaction=n,this.feature=r}}class bl{constructor(e){this.map=e,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const r=n.filter;let i=n.type;r&&this.filters.set(t,e.b3(r)),"mouseover"===i&&(i="mouseenter"),"mouseout"===i&&(i="mouseleave");const o=this.interactionsByType.get(i)||new Map;"mouseenter"===i||"mouseleave"===i?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):0===o.size&&this.map.on(i,this.handleType),0===o.size&&this.interactionsByType.set(i,o),o.set(t,n),this.typeById.set(t,i)}get(e){const t=this.typeById.get(e);if(!t)return;const n=this.interactionsByType.get(t);return n?n.get(e):void 0}remove(e){const t=this.typeById.get(e);if(!t)return;this.typeById.delete(e),this.filters.delete(e);const n=this.interactionsByType.get(t);n&&(n.delete(e),"mouseenter"===t||"mouseleave"===t?(this.delegatedInteractions.delete(e),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===n.size&&this.map.off(t,this.handleType))}queryTargets(e,t){const n=[];for(const[r,i]of t)i.target&&n.push({targetId:r,target:i.target,filter:this.filters.get(r)});return this.map.style.queryRenderedTargets(e,n,this.map.transform)}handleMove(e){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const t=this.queryTargets(e.point,Array.from(this.delegatedInteractions).reverse());t.length&&(e.type="mouseenter",this.handleType(e,t));const n=new Map;for(const[r,{feature:i}]of this.prevHoveredFeatures)this.hoveredFeatures.has(r)||n.set(i.id,i);n.size&&(e.type="mouseleave",this.handleType(e,Array.from(n.values())))}handleOut(e){const t=Array.from(this.hoveredFeatures.values()).map(e=>{let{feature:t}=e;return t});t.length&&(e.type="mouseleave",this.handleType(e,t)),this.hoveredFeatures.clear()}handleType(t,n){const r="mouseenter"===t.type;if(r&&!this.interactionsByType.has(t.type))return void e.w("mouseenter interaction required for mouseleave to work.");const i=Array.from(this.interactionsByType.get(t.type)).reverse(),o=!!n;n=n||this.queryTargets(t.point,i);let s=!1;const a=new Set;for(const l of n){for(const[n,c]of i){if(!c.target)continue;const i=l.variants?l.variants[n]:null;if(i){for(const u of i){if(lt(u,l,a,n))continue;const i=new e.dr(l,u),h=at(u,l,n);o&&(i.state=this.map.getFeatureState(i));const d=r?this.prevHoveredFeatures.get(h):null,f=new xl(t,n,c,i),p=d?d.stop:c.handler(f);if(r&&this.hoveredFeatures.set(h,{feature:l,stop:p}),!1!==p){s=!0;break}}if(s)break}}if(s)break}if(!s)for(const[e,l]of i){const{handler:n,target:r}=l;if(!r&&!1!==n(new xl(t,e,l,null)))break}}}function wl(t,n){if(Array.isArray(t)&&Array.isArray(n)){const e=new Set(t),r=new Set(n);return e.size===r.size&&t.every(e=>r.has(e))}return e.bv(t,n)}const Sl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},El={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tl{constructor(t,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=n,this.mouseRotate=new Fa({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new Ba({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),f()}move(e,t){const n=this.map,r=this.mouseRotate.mousemoveWindow(e,t),i=r&&r.bearingDelta;if(i&&n.setBearing(n.getBearing()+i),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t),i=r&&r.pitchDelta;i&&n.setPitch(n.getPitch()+i)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){p(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),_(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,_(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=y(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=y(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Al(t,n,r){if(t=new e.ci(t.lng,t.lat),n){const i=new e.ci(t.lng-360,t.lat),o=new e.ci(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-r.center.lng)/360),a=r.locationPoint3D(t).distSqr(n),l=n.x<0||n.y<0||n.x>r.width||n.y>r.height;r.locationPoint3D(i).distSqr(n)<a&&(l||Math.abs(i.lng-r.center.lng)<s)?t=i:r.locationPoint3D(o).distSqr(n)<a&&(l||Math.abs(o.lng-r.center.lng)<s)&&(t=o)}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint3D(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}const Cl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Pl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Il extends e.E{constructor(t,n){super(),(t instanceof HTMLElement||n)&&(t=e.h({element:t},n)),e.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:r="center",color:i="#3FB1CE",scale:o=1,draggable:s=!1,clickTolerance:a=0,rotation:l=Pl.rotation,rotationAlignment:c=Pl.rotationAlignment,pitchAlignment:u=Pl.pitchAlignment,occludedOpacity:h=Pl.occludedOpacity,altitude:d=Pl.altitude}=t||{};this._anchor=r,this._color=i,this._scale=o,this._draggable=s,this._clickTolerance=a,this._rotation=l,this._rotationAlignment=c,this._pitchAlignment=u,this._occludedOpacity=h,this._altitude=d,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=e.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const f=this._element.classList;for(const e in Cl)f.remove(`mapboxgl-marker-anchor-${e}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=t&&t.className?t.className.trim().split(/\s+/):[];f.add(...p),this._popup=null}_createDefaultMarker(){const e=l("div"),t=c("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},e);if(0===this._altitude){const e=c("radialGradient",{id:"shadowGradient"},c("defs",{},t));c("stop",{offset:"10%","stop-opacity":.4},e),c("stop",{offset:"100%","stop-opacity":.05},e),c("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},t)}return c("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},t),c("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},t),c("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},t),e}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.ci.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(e){return e===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==e||0!==this._altitude&&0===e)&&(this._element=this._createDefaultMarker()),this._altitude=e||Pl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,r=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-n+r)],"bottom-right":[-r,-1*(t-n+r)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,e._marker=this,e._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const n=e.unproject(t,this._altitude),r=e.getFreeCameraOptions();if(!r.position)return!1;const i=r.position.toLngLat();return i.distanceTo(n)<.9*i.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(n,this._altitude);let i;t._showingGlobe()&&e.eW(t.transform,this._lngLat)?i=0:(i=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(i*=this._occludedOpacity)),this._element.style.opacity=`${i}`,this._element.style.pointerEvents=i>0?"auto":"none",this._popup&&this._popup._setOpacity(i),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${Cl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const t=this._pos,n=this._map,r=this.getPitchAlignment();if(!n||!t||"map"!==r)return"";if(!n._showingGlobe()){const e=n.getPitch();return e?`rotateX(${e}deg)`:""}const i=e.cU(e.eX(n.transform,this._lngLat)),o=t.sub(e.eY(n.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";const a=i/s;return`rotateX(${-o.y*a}deg) rotateY(${o.x*a}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let r=0;const i=this.getRotationAlignment();if("map"===i)if(n._showingGlobe()){const t=n.project(new e.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),i=n.project(new e.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(t);r=e.cU(Math.atan2(i.y,i.x))-90}else r=-n.getBearing();else if("horizon"===i){const i=e.af(4,6,n.getZoom()),o=e.eY(n.transform);o.y+=i*n.transform.height;const s=t.sub(o),a=e.cU(Math.atan2(s.y,s.x));r=(a>90?a-270:a+90)*(1-i)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=Al(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat,this._altitude),!0===e?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),t._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const n=this._map;if(!n)return;const r=this._pointerdownPos,i=this._positionDelta;if(r&&i){if(!this._isDragging){const e=this._clickTolerance||n._clickTolerance;if(t.point.dist(r)<e)return;this._isDragging=!0}this._pos=t.point.sub(i),this._lngLat=n.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.A("dragstart"))),this.fire(new e.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.A("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,n=this._pos;t&&n&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(n),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||Pl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||Pl.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||Pl.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||Pl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const kl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ml={maxWidth:100,unit:"metric"},Rl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ol={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ll=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Dl(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const r=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(n){case"top":return new e.P(0,t);case"top-left":return new e.P(r,r);case"top-right":return new e.P(-r,r);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(r,-r);case"bottom-right":return new e.P(-r,-r);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[n]||[0,0])}const Nl={version:t,supported:a.supported,setRTLTextPlugin:e.f0,getRTLTextPluginStatus:e.e$,Map:class extends fl{constructor(t){r.mark(n.create);const i=t;if(null!=(t=e.h({},Sl,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.eU(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new er(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies,null,null),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new _l,this._domRenderTaskQueue=new _l,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.a$(),this._locale=e.h({},vl,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._tessellationStep=t.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=t.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new yl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=t.scaleFactor,this._requestManager=new S(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?Object.assign({},t.contextCreateOptions):{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error(`Container '${t.container.toString()}' not found.`);this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),this._spriteFormat=t.spriteFormat,e.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ks),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new hl(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.e.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this.indoor=new gr(this),t.hash&&(this._hash=new pa("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const n=t.bounds;n&&(this.resize(),this.fitBounds(n,e.h({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new pl({customAttribution:t.customAttribution})),this._logoControl=new ml,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new e.A(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new e.A(`${t.dataType}dataloading`,t))}),this._interactions=new bl(this)}_getMapId(){return this._mapId}addControl(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this);this._controls.push(t);const i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new e.A("movestart",t)).fire(new e.A("move",t)),this.fire(new e.A("resize",t)),n&&this.fire(new e.A("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.aG.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(e){return this._scaleFactor=e,this.painter.scaleFactor=e,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(e=>"symbol"===e.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?navigator.language:e):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,n=t.projection.name;let r;"globe"===n&&t.zoom>=e.cI?(t.setMercatorFromTransition(),r=!0):"mercator"===n&&t.zoom<e.cI&&(t.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let n;return n="globe"===t.name&&this.transform.zoom>=e.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t,n){return this.transform.locationPoint3D(e.ci.convert(t),n)}unproject(t,n){return this.transform.pointLocation3D(e.P.convert(t),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){const r=e=>{let n=[];if(Array.isArray(t)){const r=t.filter(e=>this.getLayer(e));n=r.length?this.queryRenderedFeatures(e,{layers:r}):[]}else n=this.queryRenderedFeatures(e,{target:t});return n};if("mouseenter"===e||"mouseover"===e){let i=!1;const o=t=>{const o=r(t.point);o.length?i||(i=!0,n.call(this,new Ea(e,this,t.originalEvent,{features:o}))):i=!1};return{listener:n,targets:t,delegates:{mousemove:o,mouseout:()=>{i=!1}}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const o=t=>{r(t.point).length?i=!0:i&&(i=!1,n.call(this,new Ea(e,this,t.originalEvent)))},s=t=>{i&&(i=!1,n.call(this,new Ea(e,this,t.originalEvent)))};return{listener:n,targets:t,delegates:{mousemove:o,mouseout:s}}}{const i=e=>{const t=r(e.point);t.length&&(e.features=t,n.call(this,e),delete e.features)};return{listener:n,targets:t,delegates:{[e]:i}}}}on(e,t,n){if("function"==typeof t||void 0===n)return super.on(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const r=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const i in r.delegates)this.on(i,r.delegates[i]);return this}once(e,t,n){if("function"==typeof t||void 0===n)return super.once(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const r=this._createDelegatedListener(e,t,n);for(const i in r.delegates)this.once(i,r.delegates[i]);return this}off(e,t,n){if("function"==typeof t||void 0===n)return super.off(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const i=e[r];if(i.listener===n&&wl(i.targets,t)){for(const e in i.delegates)this.off(e,i.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,n){if(!this.style)return[];if(void 0===t||t instanceof e.P||Array.isArray(t)||void 0!==n||(n=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],!n){const e=this.style.queryRenderedFeatures(t,void 0,this.transform),n=this.style.queryRenderedFeatureset(t,void 0,this.transform);return e.concat(n)}let r=!0;if(n.target&&(r=this._isTargetValid(n.target),r&&!n.layers))return this.style.queryRenderedFeatureset(t,n,this.transform);let i=!0;if(n.layers&&Array.isArray(n.layers)){for(const e of n.layers)if(!this._isValidId(e)){i=!1;break}if(i&&!n.target)return this.style.queryRenderedFeatures(t,n,this.transform)}let o=[];return i&&(o=o.concat(this.style.queryRenderedFeatures(t,n,this.transform))),r&&(o=o.concat(this.style.queryRenderedFeatureset(t,n,this.transform))),o}querySourceFeatures(e,t){return!e||"string"==typeof e&&!this._isValidId(e)?[]:this.style.querySourceFeatures(e,t)}isPointOnSurface(t){const{name:n}=this.transform.projection;return"globe"!==n&&"mercator"!==n&&e.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.P.convert(t))}addInteraction(e,t){return this._interactions.add(e,t),this}removeInteraction(e){return this._interactions.remove(e),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this}setStyle(t,n){return n=e.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&t&&!1!==n.diff&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(t,(r,i)=>{if(r){const i="string"==typeof r?r:r instanceof Error?r.message:r.error;e.w(`Unable to perform style diff: ${i}. Rebuilding the style from scratch.`),this._updateStyle(t,n)}else i&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(t,n))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(t,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t){const r=e.h({},n);n&&n.config&&(r.initialConfig=n.config,delete r.config),this.style=new Ar(this,r).load(t),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ar(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.z(new Error("IDs can't be empty."))),!1):!e.dk(t)||(this.fire(new e.z(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}_isTargetValid(e){return"featuresetId"in e?this._isValidId("importId"in e?e.importId:e.featuresetId):"layerId"in e&&this._isValidId(e.layerId)}_areTargetsValid(e){if(Array.isArray(e)){for(const t of e)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(e)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,n){let{pixelRatio:r=1,sdf:i=!1,stretchX:o,stretchY:s,content:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._lazyInitEmptyStyle();const l=e.I.from(t);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:t,height:c,data:u}=e.q.getImageData(n);this.style.addImage(l,{data:new e.r({width:t,height:c},u),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:i,version:0,usvg:!1})}else if(void 0===n.width||void 0===n.height)this.fire(new e.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:u}=n,h=n;this.style.addImage(l,{data:new e.r({width:c,height:u},new Uint8Array(h.data)),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:i,usvg:!1,version:0,userImage:h}),h.onAdd&&h.onAdd(this,t)}}updateImage(t,n){this._lazyInitEmptyStyle();const r=e.I.from(t),i=this.style.getImage(r);if(!i)return void this.fire(new e.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?e.q.getImageData(n):n,{width:s,height:a,data:l}=o;if(void 0===s||void 0===a)return void this.fire(new e.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==(i.usvg?i.icon.usvg_tree.width:i.data.width)||a!==(i.usvg?i.icon.usvg_tree.height:i.data.height))return void this.fire(new e.z(new Error(`The width and height of the updated image (${s}, ${a})\n                must be that same as the previous version of the image\n                (${i.data.width}, ${i.data.height})`)));const c=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let u=!1;i.usvg?(i.data=new e.r({width:s,height:a},new Uint8Array(l)),i.usvg=!1,i.icon=void 0,u=!0):i.data.replace(l,c),this.style.updateImage(r,i,u)}hasImage(t){return t?!!this.style&&!!this.style.getImage(e.I.from(t)):(this.fire(new e.z(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(e.I.from(t))}loadImage(t,n){e.o(this._requestManager.transformRequest(t,e.R.Image),(t,r)=>{n(t,r instanceof HTMLImageElement?e.q.getImageData(r):r)})}listImages(){return this.style.listImages().map(e=>e.name)}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.z(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(t,n){return this.style.addImport(t,n).catch(t=>this.fire(new e.z(new Error("Failed to add import",t)))),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;const t=this.style.getOwnLayer(e);return t?"custom"===t.type?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,r),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,r),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(e){return this.style.setGlyphsUrl(e),this._update(!0)}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}getFeaturesetDescriptors(e){return this.style.getFeaturesetDescriptors(e)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(e){return this._lazyInitEmptyStyle(),this.style.setSnow(e),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(e){return this._lazyInitEmptyStyle(),this.style.setRain(e),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setImportColorTheme(e,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(e,t),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.ci.convert(t),this.transform):0}setFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.setFeatureState(e,t),this._update())}removeFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.removeFeatureState(e,t),this._update())}getFeatureState(e){return e.source&&!this._isValidId(e.source)?null:this.style.getFeatureState(e)}_selectIndoorFloor(e){this.indoor.selectFloor(e)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new gl),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,r,i,o=this._container;for(;o&&(!r||!i);){const e=window.getComputedStyle(o).transform;e&&"none"!==e&&(n=e.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(r=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(i=n[3])),o=o.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=i?Math.abs(t/i):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=l("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=l("div","mapboxgl-canvas-container",e);this._canvas=l("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=l("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(e=>{r[e]=l("div",`mapboxgl-ctrl-${e}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,n){const r=e.q.devicePixelRatio||1;this._canvas.width=r*Math.ceil(t),this._canvas.height=r*Math.ceil(n),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${n}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.h({},a.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",t);n?(U(n,!0),this.painter=new da(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),e.l.testSupport(n)):this.fire(new e.z(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.A("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new e.A("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;this.fire(new e.A("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,s=e.q.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=a.createQuery(),a.beginQuery(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=this.transform.pitch,r=e.q.now(),i=new e.aa(t,{now:r,fadeDuration:l,pitch:n,transition:this.style.transition,worldview:this._worldview});this.style.update(i)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(s),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(s);const u=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),u&&(this._placementDirty=u.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.mark(n.load),this.fire(new e.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.q.now()-s;a.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const n=a.getQueryParameter(i,a.QUERY_RESULT)/1e6;a.deleteQuery(i),this.fire(new e.A("gpu-timing-frame",{cpuTime:t,gpuTime:n}))},50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout(()=>{const n=this.painter.queryGpuTimers(t);this.fire(new e.A("gpu-timing-layer",{layerTimes:n}))},50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const n=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.A("gpu-timing-deferred-render",{gpuTime:n}))},50)}const h=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(h||this._repaint)this.triggerRepaint();else{const t=this.idle();if(t&&(c=this._updateAverageElevation(s,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.A("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,r.mark(n.fullLoad),this._performanceMetricsCollection&&z(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let i=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(i)?i=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-i);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(i),n(i);this._averageElevation.easeTo(i,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(i),n(i)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){B(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===w||401===t.status)){const t=this.painter.context.gl;U(t,!1),this._logoControl instanceof ml&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),O(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&D(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,r=n.createFramebuffer();function i(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,r),this._canvasPixelComparison(i(e),t.canvasCopies.map(i),t.timeStamps)}_canvasPixelComparison(e,t,n){let r=n[1]-n[0];const i=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);r+=(n[o+2]-n[o+1])*(1-a/i)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),j.delete(this.painter.context.gl),F.remove(),R.remove(),this._removed=!0,this.fire(new e.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.q.frame(e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_preloadTiles(t){const n=this.style?this.style.getSourceCaches():[];return e.bt(n,(e,n)=>e._preloadTiles(t,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update())}_setCacheLimits(t,n){e.eV(t,n)}get version(){return t}},NavigationControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e.h({},El,t),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(e.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),l("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),l("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))}),this._compassIcon=l("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tl(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=l("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends e.E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const n=navigator.geolocation;this.options=e.h({geolocation:n},kl,t),e.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=fa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const n=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=n,e(n)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(e=>n("denied"!==e.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.A("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("geolocate",t)),this._finish()}}_updateCamera(t){const n=new e.ci(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,i=this._map.getBearing(),o=e.h({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})}_updateMarker(t){if(t){const n=new e.ci(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,n=e.cb(1,t._center.lat)*t.worldSize,r=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=l("button","mapboxgl-ctrl-geolocate",this._container),l("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=l("div","mapboxgl-user-location"),this._dotElement.appendChild(l("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(l("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Il({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=l("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Il({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.A("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:pl,ScaleControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e.h({},Ml,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,r=t._containerWidth/2-e/2,i=t.unproject([r,n]),o=t.unproject([r+e,n]),s=i.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*s;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,n){this._map._requestDomTask(()=>{const r=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(t),i=r/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(r):`${r}&nbsp;${Rl[n]}`,this._container.style.width=e*i+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=l("button","mapboxgl-ctrl-fullscreen",this._controlContainer);l("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:gl,Popup:class extends e.E{constructor(t){super(),this.options=e.h(Object.create(Ol),t),this._altitude=this.options.altitude,e.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.A("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.ci.convert(t),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(e){return this._altitude=e,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),n=document.createElement("body");let r;for(n.innerHTML=e;r=n.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=l("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=l("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.innerHTML='<span aria-hidden="true">&#215;</span>',e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,r=this._pos;if(!t||!n||!r)return"bottom";const i=n.offsetWidth,o=n.offsetHeight,s=r.x<i/2,a=r.x>t.transform.width-i/2;if(r.y+e<o)return s?"top-left":a?"top-right":"top";if(r.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const n=this._map,r=this._content;if(!n||!this._lngLat&&!this._trackPointer||!r)return;let i=this._container;if(i||(i=this._container=l("div","mapboxgl-popup",n.getContainer()),this._tip=l("div","mapboxgl-popup-tip",i),i.appendChild(r)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Al(this._lngLat,this._pos,n.transform)),!this._trackPointer||t){const r=this._pos=this._trackPointer&&t instanceof e.P?t:n.project(this._lngLat,this._altitude),i=Dl(this.options.offset),o=this._anchor=this._getAnchor(i.y),s=Dl(this.options.offset,o),a=r.add(s).round();n._requestDomTask(()=>{this._container&&o&&(this._container.style.transform=`${Cl[o]} translate(${a.x}px,${a.y}px)`)})}if(!this._marker&&n._showingGlobe()){const t=e.eW(n.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Ll);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Il,Style:Ar,LngLat:e.ci,LngLatBounds:e.aG,Point:e.P,MercatorCoordinate:e.ac,FreeCameraOptions:Zn,Evented:e.E,config:e.e,prewarm:e.e_,clearPrewarmedResources:e.eZ,get accessToken(){return e.e.ACCESS_TOKEN},set accessToken(t){e.e.ACCESS_TOKEN=t},get baseApiUrl(){return e.e.API_URL},set baseApiUrl(t){e.e.API_URL=t},get workerCount(){return e.f7.workerCount},set workerCount(t){e.f7.workerCount=t},get maxParallelImageRequests(){return e.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.e.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.f6(t)},get workerUrl(){return e.f5.workerUrl},set workerUrl(t){e.f5.workerUrl=t},get workerClass(){return e.f5.workerClass},set workerClass(t){e.f5.workerClass=t},get workerParams(){return e.f5.workerParams},set workerParams(t){e.f5.workerParams=t},get dracoUrl(){return e.f4()},set dracoUrl(t){e.f3(t)},get meshoptUrl(){return e.f2()},set meshoptUrl(t){e.f1(t)},setNow:e.q.setNow,restoreNow:e.q.restoreNow};return Nl}),n}()},973:e=>{"use strict";function t(e,t,r){r=r||2;var o,s,a,l,h,d,p,m=t&&t.length,g=m?t[0]*r:e.length,_=n(e,0,g,r,!0),y=[];if(!_||_.next===_.prev)return y;if(m&&(_=function(e,t,r,i){var o,s,a,l=[];for(o=0,s=t.length;o<s;o++)(a=n(e,t[o]*i,o<s-1?t[o+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),l.push(f(a));for(l.sort(c),o=0;o<l.length;o++)r=u(l[o],r);return r}(e,t,_,r)),e.length>80*r){o=a=e[0],s=l=e[1];for(var v=r;v<g;v+=r)(h=e[v])<o&&(o=h),(d=e[v+1])<s&&(s=d),h>a&&(a=h),d>l&&(l=d);p=0!==(p=Math.max(a-o,l-s))?32767/p:0}return i(_,y,r,o,s,p,0),y}function n(e,t,n,r,i){var o,s;if(i===A(e,t,n,r)>0)for(o=t;o<n;o+=r)s=S(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=S(o,e[o],e[o+1],s);return s&&_(s,s.next)&&(E(s),s=s.next),s}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!_(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(E(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,c,u,h,f){if(e){!f&&h&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=d(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(e,c,u,h);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,h?s(e,c,u,h):o(e))t.push(p.i/n|0),t.push(e.i/n|0),t.push(m.i/n|0),E(e),e=m.next,g=m.next;else if((e=m)===g){f?1===f?i(e=a(r(e),t,n),t,n,c,u,h,2):2===f&&l(e,t,n,c,u,h):i(r(e),t,n,c,u,h,1);break}}}function o(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,s=r.x,a=t.y,l=n.y,c=r.y,u=i<o?i<s?i:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=i>o?i>s?i:s:o>s?o:s,f=a>l?a>c?a:c:l>c?l:c,m=r.next;m!==t;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=f&&p(i,a,o,l,s,c,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function s(e,t,n,r){var i=e.prev,o=e,s=e.next;if(g(i,o,s)>=0)return!1;for(var a=i.x,l=o.x,c=s.x,u=i.y,h=o.y,f=s.y,m=a<l?a<c?a:c:l<c?l:c,_=u<h?u<f?u:f:h<f?h:f,y=a>l?a>c?a:c:l>c?l:c,v=u>h?u>f?u:f:h>f?h:f,x=d(m,_,t,n,r),b=d(y,v,t,n,r),w=e.prevZ,S=e.nextZ;w&&w.z>=x&&S&&S.z<=b;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=v&&w!==i&&w!==s&&p(a,u,l,h,c,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,S.x>=m&&S.x<=y&&S.y>=_&&S.y<=v&&S!==i&&S!==s&&p(a,u,l,h,c,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.nextZ}for(;w&&w.z>=x;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=v&&w!==i&&w!==s&&p(a,u,l,h,c,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;S&&S.z<=b;){if(S.x>=m&&S.x<=y&&S.y>=_&&S.y<=v&&S!==i&&S!==s&&p(a,u,l,h,c,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function a(e,t,n){var i=e;do{var o=i.prev,s=i.next.next;!_(o,s)&&y(o,i,i.next,s)&&b(o,s)&&b(s,o)&&(t.push(o.i/n|0),t.push(i.i/n|0),t.push(s.i/n|0),E(i),E(i.next),i=e=s),i=i.next}while(i!==e);return r(i)}function l(e,t,n,o,s,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=w(l,c);return l=r(l,l.next),u=r(u,u.next),i(l,t,n,o,s,a,0),void i(u,t,n,o,s,a,0)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function u(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s&&(s=a,n=r.x<r.next.x?r:r.next,a===i))return n}r=r.next}while(r!==t);if(!n)return null;var l,c=n,u=n.x,d=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&p(o<d?i:s,o,u,d,o<d?s:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),b(r,e)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,f=l)),r=r.next}while(r!==c);return n}(e,t);if(!n)return t;var i=w(n,e);return r(i,i.next),r(n,n.next)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function p(e,t,n,r,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(i-s)*(r-a)}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||_(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,r){var i=x(g(e,t,n)),o=x(g(e,t,r)),s=x(g(n,r,e)),a=x(g(n,r,t));return i!==o&&s!==a||(!(0!==i||!v(e,n,t))||(!(0!==o||!v(e,r,t))||(!(0!==s||!v(n,e,r))||!(0!==a||!v(n,t,r)))))}function v(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function x(e){return e>0?1:e<0?-1:0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var n=new T(e.i,e.x,e.y),r=new T(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function S(e,t,n,r){var i=new T(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,n,r){for(var i=0,o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,s=Math.abs(A(e,0,o,n));if(i)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;s-=Math.abs(A(e,c,u,n))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*n,f=r[a+1]*n,p=r[a+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[i][o][s]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},1112:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.CFB=function(){var e=t.lib.BlockCipherMode.extend();function n(e,t,n,r){var i,o=this._iv;o?(i=o.slice(0),this._iv=void 0):i=this._prevBlock,r.encryptBlock(i,0);for(var s=0;s<n;s++)e[t+s]^=i[s]}return e.Encryptor=e.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize;n.call(this,e,t,i,r),this._prevBlock=e.slice(t,t+i)}}),e.Decryptor=e.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,o=e.slice(t,t+i);n.call(this,e,t,i,r),this._prevBlock=o}}),e}(),t.mode.CFB)}()},1203:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(8420);t.isArrayLike=function(e){return null!=e&&"function"!==typeof e&&r.isLength(e.length)}},1293:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(4830);t.debounce=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"!==typeof n&&(n={});const{leading:i=!1,trailing:o=!0,maxWait:s}=n,a=Array(2);let l;i&&(a[0]="leading"),o&&(a[1]="trailing");let c=null;const u=r.debounce(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];l=e.apply(this,n),c=null},t,{edges:a}),h=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null!=s&&(null===c&&(c=Date.now()),Date.now()-c>=s)?(l=e.apply(this,n),c=Date.now(),u.cancel(),u.schedule(),l):(u.apply(this,n),l)};return h.cancel=u.cancel,h.flush=()=>(u.flush(),l),h}},1444:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toPath=function(e){const t=[],n=e.length;if(0===n)return t;let r=0,i="",o="",s=!1;for(46===e.charCodeAt(0)&&(t.push(""),r++);r<n;){const a=e[r];o?"\\"===a&&r+1<n?(r++,i+=e[r]):a===o?o="":i+=a:s?'"'===a||"'"===a?o=a:"]"===a?(s=!1,t.push(i),i=""):i+=a:"["===a?(s=!0,i&&(t.push(i),i="")):"."===a?i&&(t.push(i),i=""):i+=a,r++}return i&&t.push(i),t}},1641:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(6368),function(){var e=t,n=e.lib.WordArray,r=e.algo,i=r.SHA256,o=r.SHA224=i.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=i._createHelper(o),e.HmacSHA224=i._createHmacHelper(o)}(),t.SHA224)}()},1659:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.StreamCipher,r=e.algo,i=[],o=[],s=[],a=r.RabbitLegacy=n.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)l.call(this);for(i=0;i<8;i++)r[i]^=n[i+4&7];if(t){var o=t.words,s=o[0],a=o[1],c=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),h=c>>>16|4294901760&u,d=u<<16|65535&c;for(r[0]^=c,r[1]^=h,r[2]^=u,r[3]^=d,r[4]^=c,r[5]^=h,r[6]^=u,r[7]^=d,i=0;i<4;i++)l.call(this)}},_doProcessBlock:function(e,t){var n=this._X;l.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,n=0;n<8;n++)o[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,n=0;n<8;n++){var r=e[n]+t[n],i=65535&r,a=r>>>16,l=((i*i>>>17)+i*a>>>15)+a*a,c=((4294901760&r)*r|0)+((65535&r)*r|0);s[n]=l^c}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.RabbitLegacy=n._createHelper(a)}(),t.RabbitLegacy)}()},1884:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,r=4*t,i=r-n%r,o=n+i-1;e.clamp(),e.words[o>>>2]|=i<<24-o%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},t.pad.Ansix923)}()},2002:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib,r=n.WordArray,i=n.Hasher,o=e.algo,s=[],a=o.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],l=n[4],c=0;c<80;c++){if(c<16)s[c]=0|e[t+c];else{var u=s[c-3]^s[c-8]^s[c-14]^s[c-16];s[c]=u<<1|u>>>31}var h=(r<<5|r>>>27)+l+s[c];h+=c<20?1518500249+(i&o|~i&a):c<40?1859775393+(i^o^a):c<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,l=a,a=o,o=i<<30|i>>>2,i=r,r=h}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=i._createHelper(a),e.HmacSHA1=i._createHmacHelper(a)}(),t.SHA1)}()},2104:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(1203),i=n(9921);t.isArrayLikeObject=function(e){return i.isObjectLike(e)&&r.isArrayLike(e)}},2132:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(8268),i=n(870),o=n(4803),s=n(9972);function a(e,t,n,r){if(t===e)return!0;switch(typeof t){case"object":return function(e,t,n,r){if(null==t)return!0;if(Array.isArray(t))return l(e,t,n,r);if(t instanceof Map)return function(e,t,n,r){if(0===t.size)return!0;if(!(e instanceof Map))return!1;for(const[i,o]of t.entries()){if(!1===n(e.get(i),o,i,e,t,r))return!1}return!0}(e,t,n,r);if(t instanceof Set)return c(e,t,n,r);const i=Object.keys(t);if(null==e)return 0===i.length;if(0===i.length)return!0;if(r&&r.has(t))return r.get(t)===e;r&&r.set(t,e);try{for(let s=0;s<i.length;s++){const a=i[s];if(!o.isPrimitive(e)&&!(a in e))return!1;if(void 0===t[a]&&void 0!==e[a])return!1;if(null===t[a]&&null!==e[a])return!1;if(!n(e[a],t[a],a,e,t,r))return!1}return!0}finally{r&&r.delete(t)}}(e,t,n,r);case"function":return Object.keys(t).length>0?a(e,{...t},n,r):s.eq(e,t);default:return i.isObject(e)?"string"!==typeof t||""===t:s.eq(e,t)}}function l(e,t,n,r){if(0===t.length)return!0;if(!Array.isArray(e))return!1;const i=new Set;for(let o=0;o<t.length;o++){const s=t[o];let a=!1;for(let l=0;l<e.length;l++){if(i.has(l))continue;let c=!1;if(n(e[l],s,o,e,t,r)&&(c=!0),c){i.add(l),a=!0;break}}if(!a)return!1}return!0}function c(e,t,n,r){return 0===t.size||e instanceof Set&&l([...e],[...t],n,r)}t.isMatchWith=function(e,t,n){return"function"!==typeof n?r.isMatch(e,t):a(e,t,function e(t,r,i,o,s,l){const c=n(t,r,i,o,s,l);return void 0!==c?Boolean(c):a(t,r,e,l)},new Map)},t.isSetMatch=c},2204:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(5316),i=n(7312),o=n(3799);t.sortBy=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const a=n.length;return a>1&&o.isIterateeCall(e,n[0],n[1])?n=[]:a>2&&o.isIterateeCall(n[0],n[1],n[2])&&(n=[n[0]]),r.orderBy(e,i.flatten(n),["asc"])}},2238:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8211),void(t.lib.Cipher||function(e){var n=t,r=n.lib,i=r.Base,o=r.WordArray,s=r.BufferedBlockAlgorithm,a=n.enc,l=(a.Utf8,a.Base64),c=n.algo.EvpKDF,u=r.Cipher=s.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?v:_}return function(t){return{encrypt:function(n,r,i){return e(r).encrypt(t,n,r,i)},decrypt:function(n,r,i){return e(r).decrypt(t,n,r,i)}}}}()}),h=(r.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),n.mode={}),d=r.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=h.CBC=function(){var t=d.extend();function n(t,n,r){var i,o=this._iv;o?(i=o,this._iv=e):i=this._prevBlock;for(var s=0;s<r;s++)t[n+s]^=i[s]}return t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize;n.call(this,e,t,i),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),t.Decryptor=t.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,o=e.slice(t,t+i);r.decryptBlock(e,t),n.call(this,e,t,i),this._prevBlock=o}}),t}(),p=(n.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,i=r<<24|r<<16|r<<8|r,s=[],a=0;a<r;a+=4)s.push(i);var l=o.create(s,r);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},m=(r.BlockCipher=u.extend({cfg:u.cfg.extend({mode:f,padding:p}),reset:function(){var e;u.reset.call(this);var t=this.cfg,n=t.iv,r=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(r,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=(n.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?o.create([1398893684,1701076831]).concat(n).concat(t):t).toString(l)},parse:function(e){var t,n=l.parse(e),r=n.words;return 1398893684==r[0]&&1701076831==r[1]&&(t=o.create(r.slice(2,4)),r.splice(0,4),n.sigBytes-=16),m.create({ciphertext:n,salt:t})}},_=r.SerializableCipher=i.extend({cfg:i.extend({format:g}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r),o=i.finalize(t),s=i.cfg;return m.create({ciphertext:o,key:n,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),y=(n.kdf={}).OpenSSL={execute:function(e,t,n,r,i){if(r||(r=o.random(8)),i)s=c.create({keySize:t+n,hasher:i}).compute(e,r);else var s=c.create({keySize:t+n}).compute(e,r);var a=o.create(s.words.slice(t),4*n);return s.sigBytes=4*t,m.create({key:s,iv:a,salt:r})}},v=r.PasswordBasedCipher=_.extend({cfg:_.cfg.extend({kdf:y}),encrypt:function(e,t,n,r){var i=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize,r.salt,r.hasher);r.iv=i.iv;var o=_.encrypt.call(this,e,t,i.key,r);return o.mixIn(i),o},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var i=r.kdf.execute(n,e.keySize,e.ivSize,t.salt,r.hasher);return r.iv=i.iv,_.decrypt.call(this,e,t,i.key,r)}})}()))}()},2330:(e,t,n)=>{"use strict";var r=n(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=r.useState,s=r.useEffect,a=r.useLayoutEffect,l=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(r){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=o({inst:{value:n,getSnapshot:t}}),i=r[0].inst,u=r[1];return a(function(){i.value=n,i.getSnapshot=t,c(i)&&u({inst:i})},[e,n,t]),s(function(){return c(i)&&u({inst:i}),e(function(){c(i)&&u({inst:i})})},[e]),l(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},2489:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isDeepKey=function(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}},2682:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isPlainObject=function(e){if("object"!==typeof e)return!1;if(null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){const t=e[Symbol.toStringTag];if(null==t)return!1;return!!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable&&e.toString()===`[object ${t}]`}let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}},2715:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(9599),i=n(7330),o=n(3808),s=n(8845);t.iteratee=function(e){if(null==e)return r.identity;switch(typeof e){case"function":return e;case"object":return Array.isArray(e)&&2===e.length?s.matchesProperty(e[0],e[1]):o.matches(e);case"string":case"symbol":case"number":return i.property(e)}}},2777:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isSymbol=function(e){return"symbol"===typeof e||e instanceof Symbol}},2799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function i(e,t,r){var i=null;if(void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),"key"in t)for(var o in r={},t)"key"!==o&&(r[o]=t[o]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:i,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=i,t.jsxs=i},3240:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=function(e){return"function"===typeof Array.isArray?Array.isArray(e):"[object Array]"===n.call(e)},s=function(e){if(!e||"[object Object]"!==n.call(e))return!1;var r,i=t.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!i&&!o)return!1;for(r in e);return"undefined"===typeof r||t.call(e,r)},a=function(e,t){r&&"__proto__"===t.name?r(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},l=function(e,n){if("__proto__"===n){if(!t.call(e,n))return;if(i)return i(e,n).value}return e[n]};e.exports=function e(){var t,n,r,i,c,u,h=arguments[0],d=1,f=arguments.length,p=!1;for("boolean"===typeof h&&(p=h,h=arguments[1]||{},d=2),(null==h||"object"!==typeof h&&"function"!==typeof h)&&(h={});d<f;++d)if(null!=(t=arguments[d]))for(n in t)r=l(h,n),h!==(i=l(t,n))&&(p&&i&&(s(i)||(c=o(i)))?(c?(c=!1,u=r&&o(r)?r:[]):u=r&&s(r)?r:{},a(h,{name:n,newValue:e(p,u,i)})):"undefined"!==typeof i&&a(h,{name:n,newValue:i}));return h}},3272:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toKey=function(e){return"string"===typeof e||"symbol"===typeof e?e:Object.is(e?.valueOf?.(),-0)?"-0":String(e)}},3757:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isTypedArray=function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}},3799:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(4704),i=n(1203),o=n(870),s=n(9972);t.isIterateeCall=function(e,t,n){return!!o.isObject(n)&&(!!("number"===typeof t&&i.isArrayLike(n)&&r.isIndex(t)&&t<n.length||"string"===typeof t&&t in n)&&s.eq(n[t],e))}},3808:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(8268),i=n(5261);t.matches=function(e){return e=i.cloneDeep(e),t=>r.isMatch(t,e)}},3821:(e,t,n)=>{e.exports=n(2204).sortBy},3930:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(6368),n(4220),function(){var e=t,n=e.lib,r=n.Base,i=n.WordArray,o=e.algo,s=o.SHA256,a=o.HMAC,l=o.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:s,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=a.create(n.hasher,e),o=i.create(),s=i.create([1]),l=o.words,c=s.words,u=n.keySize,h=n.iterations;l.length<u;){var d=r.update(t).finalize(s);r.reset();for(var f=d.words,p=f.length,m=d,g=1;g<h;g++){m=r.finalize(m),r.reset();for(var _=m.words,y=0;y<p;y++)f[y]^=_[y]}o.concat(d),c[0]++}return o.sigBytes=4*u,o}});e.PBKDF2=function(e,t,n){return l.create(n).compute(e,t)}}(),t.PBKDF2)}()},4087:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding)}()},4199:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(e){var n=t,r=n.lib,i=r.WordArray,o=r.Hasher,s=n.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var l=s.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,s=e[t+0],l=e[t+1],f=e[t+2],p=e[t+3],m=e[t+4],g=e[t+5],_=e[t+6],y=e[t+7],v=e[t+8],x=e[t+9],b=e[t+10],w=e[t+11],S=e[t+12],E=e[t+13],T=e[t+14],A=e[t+15],C=o[0],P=o[1],I=o[2],k=o[3];C=c(C,P,I,k,s,7,a[0]),k=c(k,C,P,I,l,12,a[1]),I=c(I,k,C,P,f,17,a[2]),P=c(P,I,k,C,p,22,a[3]),C=c(C,P,I,k,m,7,a[4]),k=c(k,C,P,I,g,12,a[5]),I=c(I,k,C,P,_,17,a[6]),P=c(P,I,k,C,y,22,a[7]),C=c(C,P,I,k,v,7,a[8]),k=c(k,C,P,I,x,12,a[9]),I=c(I,k,C,P,b,17,a[10]),P=c(P,I,k,C,w,22,a[11]),C=c(C,P,I,k,S,7,a[12]),k=c(k,C,P,I,E,12,a[13]),I=c(I,k,C,P,T,17,a[14]),C=u(C,P=c(P,I,k,C,A,22,a[15]),I,k,l,5,a[16]),k=u(k,C,P,I,_,9,a[17]),I=u(I,k,C,P,w,14,a[18]),P=u(P,I,k,C,s,20,a[19]),C=u(C,P,I,k,g,5,a[20]),k=u(k,C,P,I,b,9,a[21]),I=u(I,k,C,P,A,14,a[22]),P=u(P,I,k,C,m,20,a[23]),C=u(C,P,I,k,x,5,a[24]),k=u(k,C,P,I,T,9,a[25]),I=u(I,k,C,P,p,14,a[26]),P=u(P,I,k,C,v,20,a[27]),C=u(C,P,I,k,E,5,a[28]),k=u(k,C,P,I,f,9,a[29]),I=u(I,k,C,P,y,14,a[30]),C=h(C,P=u(P,I,k,C,S,20,a[31]),I,k,g,4,a[32]),k=h(k,C,P,I,v,11,a[33]),I=h(I,k,C,P,w,16,a[34]),P=h(P,I,k,C,T,23,a[35]),C=h(C,P,I,k,l,4,a[36]),k=h(k,C,P,I,m,11,a[37]),I=h(I,k,C,P,y,16,a[38]),P=h(P,I,k,C,b,23,a[39]),C=h(C,P,I,k,E,4,a[40]),k=h(k,C,P,I,s,11,a[41]),I=h(I,k,C,P,p,16,a[42]),P=h(P,I,k,C,_,23,a[43]),C=h(C,P,I,k,x,4,a[44]),k=h(k,C,P,I,S,11,a[45]),I=h(I,k,C,P,A,16,a[46]),C=d(C,P=h(P,I,k,C,f,23,a[47]),I,k,s,6,a[48]),k=d(k,C,P,I,y,10,a[49]),I=d(I,k,C,P,T,15,a[50]),P=d(P,I,k,C,g,21,a[51]),C=d(C,P,I,k,S,6,a[52]),k=d(k,C,P,I,p,10,a[53]),I=d(I,k,C,P,b,15,a[54]),P=d(P,I,k,C,l,21,a[55]),C=d(C,P,I,k,v,6,a[56]),k=d(k,C,P,I,A,10,a[57]),I=d(I,k,C,P,_,15,a[58]),P=d(P,I,k,C,E,21,a[59]),C=d(C,P,I,k,m,6,a[60]),k=d(k,C,P,I,w,10,a[61]),I=d(I,k,C,P,f,15,a[62]),P=d(P,I,k,C,x,21,a[63]),o[0]=o[0]+C|0,o[1]=o[1]+P|0,o[2]=o[2]+I|0,o[3]=o[3]+k|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296),s=r;n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var u=l[c];l[c]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return a},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,n,r,i,o,s){var a=e+(t&n|~t&r)+i+s;return(a<<o|a>>>32-o)+t}function u(e,t,n,r,i,o,s){var a=e+(t&r|n&~r)+i+s;return(a<<o|a>>>32-o)+t}function h(e,t,n,r,i,o,s){var a=e+(t^n^r)+i+s;return(a<<o|a>>>32-o)+t}function d(e,t,n,r,i,o,s){var a=e+(n^(t|~r))+i+s;return(a<<o|a>>>32-o)+t}n.MD5=o._createHelper(l),n.HmacMD5=o._createHmacHelper(l)}(Math),t.MD5)}()},4208:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.uniqBy=function(e,t){const n=new Map;for(let r=0;r<e.length;r++){const i=e[r],o=t(i);n.has(o)||n.set(o,i)}return Array.from(n.values())}},4220:function(e,t,n){!function(){var t;e.exports=(t=n(4488),void function(){var e=t,n=e.lib.Base,r=e.enc.Utf8;e.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,l=s.words,c=0;c<n;c++)a[c]^=1549556828,l[c]^=909522486;o.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}())}()},4222:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=null;if(!e||"string"!==typeof e)return n;var r=(0,i.default)(e),o="function"===typeof t;return r.forEach(function(e){if("declaration"===e.type){var r=e.property,i=e.value;o?t(r,i,e):i&&((n=n||{})[r]=i)}}),n};var i=r(n(4403))},4250:(e,t,n)=>{e.exports=n(8182).isEqual},4288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=_.prototype;var x=v.prototype=new y;x.constructor=v,m(x,_.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},S=Object.prototype.hasOwnProperty;function E(e,t,r,i,o,s){return r=s.ref,{$$typeof:n,type:e,key:t,ref:void 0!==r?r:null,props:s}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function P(){}function I(e,t,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(a){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0;break;case d:return I((u=e._init)(e._payload),t,i,o,s)}}if(u)return s=s(e),u=""===o?"."+C(e,0):o,b(s)?(i="",null!=u&&(i=u.replace(A,"$&/")+"/"),I(s,t,i,"",function(e){return e})):null!=s&&(T(s)&&(l=s,c=i+(null==s.key||e&&e.key===s.key?"":(""+s.key).replace(A,"$&/")+"/")+u,s=E(l.type,c,void 0,0,0,l.props)),t.push(s)),1;u=0;var h,p=""===o?".":o+":";if(b(e))for(var m=0;m<e.length;m++)u+=I(o=e[m],t,i,a=p+C(o,m),s);else if("function"===typeof(m=null===(h=e)||"object"!==typeof h?null:"function"===typeof(h=f&&h[f]||h["@@iterator"])?h:null))for(e=m.call(e),m=0;!(o=e.next()).done;)u+=I(o=o.value,t,i,a=p+C(o,m++),s);else if("object"===a){if("function"===typeof e.then)return I(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(P,P):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,i,o,s);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function k(e,t,n){if(null==e)return e;var r=[],i=0;return I(e,r,"","",function(e){return t.call(n,e,i++)}),r}function M(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function O(){}t.Children={map:k,forEach:function(e,t,n){k(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return k(e,function(){t++}),t},toArray:function(e){return k(e,function(e){return e})||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=i,t.Profiler=s,t.PureComponent=v,t.StrictMode=o,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=m({},e.props),i=e.key;if(null!=t)for(o in void 0!==t.ref&&void 0,void 0!==t.key&&(i=""+t.key),t)!S.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(r[o]=t[o]);var o=arguments.length-2;if(1===o)r.children=n;else if(1<o){for(var s=Array(o),a=0;a<o;a++)s[a]=arguments[a+2];r.children=s}return E(e.type,i,void 0,0,0,r)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},t.createElement=function(e,t,n){var r,i={},o=null;if(null!=t)for(r in void 0!==t.key&&(o=""+t.key),t)S.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var a=Array(s),l=0;l<s;l++)a[l]=arguments[l+2];i.children=a}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===i[r]&&(i[r]=s[r]);return E(e,o,void 0,0,0,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=w.T,n={};w.T=n;try{var r=e(),i=w.S;null!==i&&i(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(O,R)}catch(o){R(o)}finally{w.T=t}},t.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},t.use=function(e){return w.H.use(e)},t.useActionState=function(e,t,n){return w.H.useActionState(e,t,n)},t.useCallback=function(e,t){return w.H.useCallback(e,t)},t.useContext=function(e){return w.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var r=w.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},t.useId=function(){return w.H.useId()},t.useImperativeHandle=function(e,t,n){return w.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return w.H.useMemo(e,t)},t.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return w.H.useReducer(e,t,n)},t.useRef=function(e){return w.H.useRef(e)},t.useState=function(e){return w.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return w.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return w.H.useTransition()},t.version="19.1.1"},4332:(e,t,n)=>{e.exports=n(5053).uniqBy},4385:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isPlainObject=function(e){if(!e||"object"!==typeof e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t))&&"[object Object]"===Object.prototype.toString.call(e)}},4391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(7004)},4403:e=>{var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,n=/\n/g,r=/^\s*/,i=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,o=/^:\s*/,s=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,a=/^[;\s]*/,l=/^\s+|\s+$/g,c="";function u(e){return e?e.replace(l,c):c}e.exports=function(e,l){if("string"!==typeof e)throw new TypeError("First argument must be a string");if(!e)return[];l=l||{};var h=1,d=1;function f(e){var t=e.match(n);t&&(h+=t.length);var r=e.lastIndexOf("\n");d=~r?e.length-r:d+e.length}function p(){var e={line:h,column:d};return function(t){return t.position=new m(e),v(),t}}function m(e){this.start=e,this.end={line:h,column:d},this.source=l.source}m.prototype.content=e;var g=[];function _(t){var n=new Error(l.source+":"+h+":"+d+": "+t);if(n.reason=t,n.filename=l.source,n.line=h,n.column=d,n.source=e,!l.silent)throw n;g.push(n)}function y(t){var n=t.exec(e);if(n){var r=n[0];return f(r),e=e.slice(r.length),n}}function v(){y(r)}function x(e){var t;for(e=e||[];t=b();)!1!==t&&e.push(t);return e}function b(){var t=p();if("/"==e.charAt(0)&&"*"==e.charAt(1)){for(var n=2;c!=e.charAt(n)&&("*"!=e.charAt(n)||"/"!=e.charAt(n+1));)++n;if(n+=2,c===e.charAt(n-1))return _("End of comment missing");var r=e.slice(2,n-2);return d+=2,f(r),e=e.slice(n),d+=2,t({type:"comment",comment:r})}}function w(){var e=p(),n=y(i);if(n){if(b(),!y(o))return _("property missing ':'");var r=y(s),l=e({type:"declaration",property:u(n[0].replace(t,c)),value:r?u(r[0].replace(t,c)):c});return y(a),l}}return v(),function(){var e,t=[];for(x(t);e=w();)!1!==e&&(t.push(e),x(t));return t}()}},4423:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.Iso97971={pad:function(e,n){e.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(e,n)},unpad:function(e){t.pad.ZeroPadding.unpad(e),e.sigBytes--}},t.pad.Iso97971)}()},4488:function(e,t,n){e.exports=function(){var e=e||function(e,t){var r;if("undefined"!==typeof window&&window.crypto&&(r=window.crypto),"undefined"!==typeof self&&self.crypto&&(r=self.crypto),"undefined"!==typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!==typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&"undefined"!==typeof n.g&&n.g.crypto&&(r=n.g.crypto),!r)try{r=n(477)}catch(g){}var i=function(){if(r){if("function"===typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(g){}if("function"===typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),s={},a=s.lib={},l=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=l.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new c.init(t,e)}}),u=s.enc={},h=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},f=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,s=this.blockSize,a=o/(4*s),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,u=e.min(4*l,o);if(l){for(var h=0;h<l;h+=s)this._doProcessBlock(i,h);n=i.splice(0,l),r.sigBytes-=u}return new c.init(n,u)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(a.Hasher=p.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}}),s.algo={});return s}(Math);return e}()},4503:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){if("function"==typeof ArrayBuffer){var e=t.lib.WordArray,n=e.init,r=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!==typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,r=[],i=0;i<t;i++)r[i>>>2]|=e[i]<<24-i%4*8;n.call(this,r,t)}else n.apply(this,arguments)};r.prototype=e}}(),t.lib.WordArray)}()},4646:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib.WordArray;function r(e,t,r){for(var i=[],o=0,s=0;s<t;s++)if(s%4){var a=r[e.charCodeAt(s-1)]<<s%4*2|r[e.charCodeAt(s)]>>>6-s%4*2;i[o>>>2]|=a<<24-o%4*8,o++}return n.create(i,o)}e.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var n=e.words,r=e.sigBytes,i=t?this._safe_map:this._map;e.clamp();for(var o=[],s=0;s<r;s+=3)for(var a=(n[s>>>2]>>>24-s%4*8&255)<<16|(n[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|n[s+2>>>2]>>>24-(s+2)%4*8&255,l=0;l<4&&s+.75*l<r;l++)o.push(i.charAt(a>>>6*(3-l)&63));var c=i.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(e,t){void 0===t&&(t=!0);var n=e.length,i=t?this._safe_map:this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var s=0;s<i.length;s++)o[i.charCodeAt(s)]=s}var a=i.charAt(64);if(a){var l=e.indexOf(a);-1!==l&&(n=l)}return r(e,n,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),t.enc.Base64url)}()},4704:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=/^(?:0|[1-9]\d*)$/;t.isIndex=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_SAFE_INTEGER;switch(typeof e){case"number":return Number.isInteger(e)&&e>=0&&e<t;case"symbol":return!1;case"string":return n.test(e)}}},4708:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),function(){var e=t,n=e.lib.CipherParams,r=e.enc.Hex;e.format.Hex={stringify:function(e){return e.ciphertext.toString(r)},parse:function(e){var t=r.parse(e);return n.create({ciphertext:t})}}}(),t.format.Hex)}()},4737:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.noop=function(){}},4803:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isPrimitive=function(e){return null==e||"object"!==typeof e&&"function"!==typeof e}},4830:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.debounce=function(e,t){let n,{signal:r,edges:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=null;const s=null!=i&&i.includes("leading"),a=null==i||i.includes("trailing"),l=()=>{null!==o&&(e.apply(n,o),n=void 0,o=null)};let c=null;const u=()=>{null!=c&&clearTimeout(c),c=setTimeout(()=>{c=null,a&&l(),h()},t)},h=()=>{null!==c&&(clearTimeout(c),c=null),n=void 0,o=null},d=function(){if(r?.aborted)return;n=this;for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];o=t;const a=null==c;u(),s&&a&&l()};return d.schedule=u,d.cancel=h,d.flush=()=>{l()},r?.addEventListener("abort",h,{once:!0}),d}},4879:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6770);t.toFinite=function(e){if(!e)return 0===e?e:0;if((e=r.toNumber(e))===1/0||e===-1/0){return(e<0?-1:1)*Number.MAX_VALUE}return e===e?e:0}},5043:(e,t,n)=>{"use strict";e.exports=n(4288)},5053:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(4208),i=n(9599),o=n(2104),s=n(2715);t.uniqBy=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.identity;return o.isArrayLikeObject(e)?r.uniqBy(Array.from(e),s.iteratee(t)):[]}},5261:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6433);t.cloneDeep=function(e){return r.cloneDeepWithImpl(e,void 0,e,new Map,void 0)}},5303:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(2489),i=n(4704),o=n(6321),s=n(1444);t.has=function(e,t){let n;if(n=Array.isArray(t)?t:"string"===typeof t&&r.isDeepKey(t)&&null==e?.[t]?s.toPath(t):[t],0===n.length)return!1;let a=e;for(let r=0;r<n.length;r++){const e=n[r];if(null==a||!Object.hasOwn(a,e)){if(!((Array.isArray(a)||o.isArguments(a))&&i.isIndex(e)&&e<a.length))return!1}a=a[e]}return!0}},5316:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(9709),i=n(7043),o=n(1444);t.orderBy=function(e,t,n,s){if(null==e)return[];n=s?void 0:n,Array.isArray(e)||(e=Object.values(e)),Array.isArray(t)||(t=null==t?[null]:[t]),0===t.length&&(t=[null]),Array.isArray(n)||(n=null==n?[]:[n]),n=n.map(e=>String(e));const a=(e,t)=>{let n=e;for(let r=0;r<t.length&&null!=n;++r)n=n[t[r]];return n},l=t.map(e=>(Array.isArray(e)&&1===e.length&&(e=e[0]),null==e||"function"===typeof e||Array.isArray(e)||i.isKey(e)?e:{key:e,path:o.toPath(e)}));return e.map(e=>({original:e,criteria:l.map(t=>((e,t)=>null==t||null==e?t:"object"===typeof e&&"key"in e?Object.hasOwn(t,e.key)?t[e.key]:a(t,e.path):"function"===typeof e?e(t):Array.isArray(e)?a(t,e):"object"===typeof t?t[e]:t)(t,e))})).slice().sort((e,t)=>{for(let i=0;i<l.length;i++){const o=r.compareValues(e.criteria[i],t.criteria[i],n[i]);if(0!==o)return o}return 0}).map(e=>e.original)}},5414:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(1293);t.throttle=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{leading:i=!0,trailing:o=!0}=n;return r.debounce(e,t,{leading:i,maxWait:t,trailing:o})}},5508:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6433),i=n(7599);t.cloneDeepWith=function(e,t){return r.cloneDeepWith(e,(n,o,s,a)=>{const l=t?.(n,o,s,a);if(null!=l)return l;if("object"===typeof e)switch(Object.prototype.toString.call(e)){case i.numberTag:case i.stringTag:case i.booleanTag:{const t=new e.constructor(e?.valueOf());return r.copyProperties(t,e),t}case i.argumentsTag:{const t={};return r.copyProperties(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}},5896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<i&&0>o(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else{if(!(c<i&&0>o(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,_=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(g=!1,b(e),!m)if(null!==r(c))m=!0,E||(E=!0,S());else{var t=r(u);null!==t&&R(w,t.startTime-e)}}var S,E=!1,T=-1,A=5,C=-1;function P(){return!!_||!(t.unstable_now()-C<A)}function I(){if(_=!1,E){var e=t.unstable_now();C=e;var n=!0;try{e:{m=!1,g&&(g=!1,v(T),T=-1),p=!0;var o=f;try{t:{for(b(e),d=r(c);null!==d&&!(d.expirationTime>e&&P());){var s=d.callback;if("function"===typeof s){d.callback=null,f=d.priorityLevel;var a=s(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof a){d.callback=a,b(e),n=!0;break t}d===r(c)&&i(c),b(e)}else i(c);d=r(c)}if(null!==d)n=!0;else{var l=r(u);null!==l&&R(w,l.startTime-e),n=!1}}break e}finally{d=null,f=o,p=!1}n=void 0}}finally{n?S():E=!1}}}if("function"===typeof x)S=function(){x(I)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,M=k.port2;k.port1.onmessage=I,S=function(){M.postMessage(null)}}else S=function(){y(I,0)};function R(e,n){T=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_requestPaint=function(){_=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===r(c)&&e===r(u)&&(g?(v(T),T=-1):g=!0,R(w,o-s))):(e.sortIndex=a,n(c,e),m||p||(m=!0,E||(E=!0,S()))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},5990:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.getTag=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}},6111:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(9749),n(4503),n(8168),n(8523),n(4646),n(4199),n(2002),n(6368),n(1641),n(7061),n(9092),n(6600),n(7423),n(4220),n(3930),n(8211),n(2238),n(1112),n(7962),n(8049),n(6380),n(8099),n(1884),n(9132),n(4423),n(548),n(4087),n(4708),n(7780),n(9475),n(9638),n(8875),n(1659),n(6501),t)}()},6321:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(5990);t.isArguments=function(e){return null!==e&&"object"===typeof e&&"[object Arguments]"===r.getTag(e)}},6368:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(e){var n=t,r=n.lib,i=r.WordArray,o=r.Hasher,s=n.algo,a=[],l=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(a[i]=n(e.pow(r,.5))),l[i]=n(e.pow(r,1/3)),i++),r++}();var c=[],u=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],u=n[5],h=n[6],d=n[7],f=0;f<64;f++){if(f<16)c[f]=0|e[t+f];else{var p=c[f-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,g=c[f-2],_=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;c[f]=m+c[f-7]+_+c[f-16]}var y=r&i^r&o^i&o,v=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),x=d+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&u^~a&h)+l[f]+c[f];d=h,h=u,u=a,a=s+x|0,s=o,o=i,i=r,r=x+(v+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+u|0,n[6]=n[6]+h|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=o._createHelper(u),n.HmacSHA256=o._createHmacHelper(u)}(Math),t.SHA256)}()},6380:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.OFB=function(){var e=t.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,o=this._keystream;i&&(o=this._keystream=i.slice(0),this._iv=void 0),n.encryptBlock(o,0);for(var s=0;s<r;s++)e[t+s]^=o[s]}});return e.Decryptor=n,e}(),t.mode.OFB)}()},6392:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.last=function(e){return e[e.length-1]}},6433:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6443),i=n(5990),o=n(7599),s=n(4803),a=n(3757);function l(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const h=u?.(e,t,n,r);if(null!=h)return h;if(s.isPrimitive(e))return e;if(r.has(e))return r.get(e);if(Array.isArray(e)){const t=new Array(e.length);r.set(e,t);for(let i=0;i<e.length;i++)t[i]=l(e[i],i,n,r,u);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){const t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){const t=new Map;r.set(e,t);for(const[i,o]of e)t.set(i,l(o,i,n,r,u));return t}if(e instanceof Set){const t=new Set;r.set(e,t);for(const i of e)t.add(l(i,void 0,n,r,u));return t}if("undefined"!==typeof Buffer&&Buffer.isBuffer(e))return e.subarray();if(a.isTypedArray(e)){const t=new(Object.getPrototypeOf(e).constructor)(e.length);r.set(e,t);for(let i=0;i<e.length;i++)t[i]=l(e[i],i,n,r,u);return t}if(e instanceof ArrayBuffer||"undefined"!==typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){const t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return r.set(e,t),c(t,e,n,r,u),t}if("undefined"!==typeof File&&e instanceof File){const t=new File([e],e.name,{type:e.type});return r.set(e,t),c(t,e,n,r,u),t}if(e instanceof Blob){const t=new Blob([e],{type:e.type});return r.set(e,t),c(t,e,n,r,u),t}if(e instanceof Error){const t=new e.constructor;return r.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,c(t,e,n,r,u),t}if("object"===typeof e&&function(e){switch(i.getTag(e)){case o.argumentsTag:case o.arrayTag:case o.arrayBufferTag:case o.dataViewTag:case o.booleanTag:case o.dateTag:case o.float32ArrayTag:case o.float64ArrayTag:case o.int8ArrayTag:case o.int16ArrayTag:case o.int32ArrayTag:case o.mapTag:case o.numberTag:case o.objectTag:case o.regexpTag:case o.setTag:case o.stringTag:case o.symbolTag:case o.uint8ArrayTag:case o.uint8ClampedArrayTag:case o.uint16ArrayTag:case o.uint32ArrayTag:return!0;default:return!1}}(e)){const t=Object.create(Object.getPrototypeOf(e));return r.set(e,t),c(t,e,n,r,u),t}return e}function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;const s=[...Object.keys(t),...r.getSymbols(t)];for(let r=0;r<s.length;r++){const a=s[r],c=Object.getOwnPropertyDescriptor(e,a);(null==c||c.writable)&&(e[a]=l(t[a],a,n,i,o))}}t.cloneDeepWith=function(e,t){return l(e,void 0,e,new Map,t)},t.cloneDeepWithImpl=l,t.copyProperties=c},6440:e=>{"use strict";var t=function(){};e.exports=t},6443:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.getSymbols=function(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}},6501:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.BlockCipher,r=e.algo;const i=16,o=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],s=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var a={pbox:[],sbox:[]};function l(e,t){let n=t>>24&255,r=t>>16&255,i=t>>8&255,o=255&t,s=e.sbox[0][n]+e.sbox[1][r];return s^=e.sbox[2][i],s+=e.sbox[3][o],s}function c(e,t,n){let r,o=t,s=n;for(let a=0;a<i;++a)o^=e.pbox[a],s=l(e,o)^s,r=o,o=s,s=r;return r=o,o=s,s=r,s^=e.pbox[i],o^=e.pbox[i+1],{left:o,right:s}}function u(e,t,n){let r,o=t,s=n;for(let a=i+1;a>1;--a)o^=e.pbox[a],s=l(e,o)^s,r=o,o=s,s=r;return r=o,o=s,s=r,s^=e.pbox[1],o^=e.pbox[0],{left:o,right:s}}function h(e,t,n){for(let i=0;i<4;i++){e.sbox[i]=[];for(let t=0;t<256;t++)e.sbox[i][t]=s[i][t]}let r=0;for(let s=0;s<i+2;s++)e.pbox[s]=o[s]^t[r],r++,r>=n&&(r=0);let a=0,l=0,u=0;for(let o=0;o<i+2;o+=2)u=c(e,a,l),a=u.left,l=u.right,e.pbox[o]=a,e.pbox[o+1]=l;for(let i=0;i<4;i++)for(let t=0;t<256;t+=2)u=c(e,a,l),a=u.left,l=u.right,e.sbox[i][t]=a,e.sbox[i][t+1]=l;return!0}var d=r.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4;h(a,t,n)}},encryptBlock:function(e,t){var n=c(a,e[t],e[t+1]);e[t]=n.left,e[t+1]=n.right},decryptBlock:function(e,t){var n=u(a,e[t],e[t+1]);e[t]=n.left,e[t+1]=n.right},blockSize:2,keySize:4,ivSize:2});e.Blowfish=n._createHelper(d)}(),t.Blowfish)}()},6600:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(9749),function(e){var n=t,r=n.lib,i=r.WordArray,o=r.Hasher,s=n.x64.Word,a=n.algo,l=[],c=[],u=[];!function(){for(var e=1,t=0,n=0;n<24;n++){l[e+5*t]=(n+1)*(n+2)/2%64;var r=(2*e+3*t)%5;e=t%5,t=r}for(e=0;e<5;e++)for(t=0;t<5;t++)c[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,o=0;o<24;o++){for(var a=0,h=0,d=0;d<7;d++){if(1&i){var f=(1<<d)-1;f<32?h^=1<<f:a^=1<<f-32}128&i?i=i<<1^113:i<<=1}u[o]=s.create(a,h)}}();var h=[];!function(){for(var e=0;e<25;e++)h[e]=s.create()}();var d=a.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,r=this.blockSize/2,i=0;i<r;i++){var o=e[t+2*i],s=e[t+2*i+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),(P=n[i]).high^=s,P.low^=o}for(var a=0;a<24;a++){for(var d=0;d<5;d++){for(var f=0,p=0,m=0;m<5;m++)f^=(P=n[d+5*m]).high,p^=P.low;var g=h[d];g.high=f,g.low=p}for(d=0;d<5;d++){var _=h[(d+4)%5],y=h[(d+1)%5],v=y.high,x=y.low;for(f=_.high^(v<<1|x>>>31),p=_.low^(x<<1|v>>>31),m=0;m<5;m++)(P=n[d+5*m]).high^=f,P.low^=p}for(var b=1;b<25;b++){var w=(P=n[b]).high,S=P.low,E=l[b];E<32?(f=w<<E|S>>>32-E,p=S<<E|w>>>32-E):(f=S<<E-32|w>>>64-E,p=w<<E-32|S>>>64-E);var T=h[c[b]];T.high=f,T.low=p}var A=h[0],C=n[0];for(A.high=C.high,A.low=C.low,d=0;d<5;d++)for(m=0;m<5;m++){var P=n[b=d+5*m],I=h[b],k=h[(d+1)%5+5*m],M=h[(d+2)%5+5*m];P.high=I.high^~k.high&M.high,P.low=I.low^~k.low&M.low}P=n[0];var R=u[a];P.high^=R.high,P.low^=R.low}},_doFinalize:function(){var t=this._data,n=t.words,r=(this._nDataBytes,8*t.sigBytes),o=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(e.ceil((r+1)/o)*o>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var s=this._state,a=this.cfg.outputLength/8,l=a/8,c=[],u=0;u<l;u++){var h=s[u],d=h.high,f=h.low;d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c.push(f),c.push(d)}return new i.init(c,a)},clone:function(){for(var e=o.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});n.SHA3=o._createHelper(d),n.HmacSHA3=o._createHmacHelper(d)}(Math),t.SHA3)}()},6672:(e,t,n)=>{"use strict";var r=n(5043);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var s={d:{f:o,r:function(){throw Error(i(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},a=Symbol.for("react.portal");var l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=s.p;try{if(l.T=null,s.p=2,e)return e()}finally{l.T=t,s.p=n,s.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,s.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&s.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin),i="string"===typeof t.integrity?t.integrity:void 0,o="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?s.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:o}):"script"===n&&s.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:o,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin);s.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);s.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else s.d.m(e)},t.requestFormReset=function(e){s.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.1.1"},6770:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(2777);t.toNumber=function(e){return r.isSymbol(e)?NaN:Number(e)}},7004:(e,t,n)=>{"use strict";var r=n(8853),i=n(5043),o=n(7950);function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(l(e)!==e)throw Error(s(188))}function h(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=h(e)))return t;e=e.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),x=Symbol.for("react.consumer"),b=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope");var C=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var P=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var I=Symbol.iterator;function k(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=I&&e[I]||e["@@iterator"])?e:null}var M=Symbol.for("react.client.reference");function R(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===M?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case y:return"Profiler";case _:return"StrictMode";case S:return"Suspense";case E:return"SuspenseList";case C:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case m:return"Portal";case b:return(e.displayName||"Context")+".Provider";case x:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case T:return null!==(t=e.displayName||null)?t:R(e.type)||"Memo";case A:t=e._payload,e=e._init;try{return R(e(t))}catch(n){}}return null}var O=Array.isArray,L=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,N={pending:!1,data:null,method:null,action:null},z=[],F=-1;function B(e){return{current:e}}function j(e){0>F||(e.current=z[F],z[F]=null,F--)}function U(e,t){F++,z[F]=e.current,e.current=t}var V=B(null),G=B(null),H=B(null),$=B(null);function W(e,t){switch(U(H,t),U(G,e),U(V,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?ih(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=oh(t=ih(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}j(V),U(V,e)}function q(){j(V),j(G),j(H)}function X(e){null!==e.memoizedState&&U($,e);var t=V.current,n=oh(t,e.type);t!==n&&(U(G,e),U(V,n))}function Z(e){G.current===e&&(j(V),j(G)),$.current===e&&(j($),Xh._currentValue=N)}var K=Object.prototype.hasOwnProperty,Y=r.unstable_scheduleCallback,J=r.unstable_cancelCallback,Q=r.unstable_shouldYield,ee=r.unstable_requestPaint,te=r.unstable_now,ne=r.unstable_getCurrentPriorityLevel,re=r.unstable_ImmediatePriority,ie=r.unstable_UserBlockingPriority,oe=r.unstable_NormalPriority,se=r.unstable_LowPriority,ae=r.unstable_IdlePriority,le=r.log,ce=r.unstable_setDisableYieldValue,ue=null,he=null;function de(e){if("function"===typeof le&&ce(e),he&&"function"===typeof he.setStrictMode)try{he.setStrictMode(ue,e)}catch(t){}}var fe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(pe(e)/me|0)|0},pe=Math.log,me=Math.LN2;var ge=256,_e=4194304;function ye(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ve(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var i=0,o=e.suspendedLanes,s=e.pingedLanes;e=e.warmLanes;var a=134217727&r;return 0!==a?0!==(r=a&~o)?i=ye(r):0!==(s&=a)?i=ye(s):n||0!==(n=a&~e)&&(i=ye(n)):0!==(a=r&~o)?i=ye(a):0!==s?i=ye(s):n||0!==(n=r&~e)&&(i=ye(n)),0===i?0:0!==t&&t!==i&&0===(t&o)&&((o=i&-i)>=(n=t&-t)||32===o&&0!==(4194048&n))?t:i}function xe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function be(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function we(){var e=ge;return 0===(4194048&(ge<<=1))&&(ge=256),e}function Se(){var e=_e;return 0===(62914560&(_e<<=1))&&(_e=4194304),e}function Ee(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Te(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ae(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-fe(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194090&n}function Ce(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-fe(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function Pe(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ie(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function ke(){var e=D.p;return 0!==e?e:void 0===(e=window.event)?32:cd(e.type)}var Me=Math.random().toString(36).slice(2),Re="__reactFiber$"+Me,Oe="__reactProps$"+Me,Le="__reactContainer$"+Me,De="__reactEvents$"+Me,Ne="__reactListeners$"+Me,ze="__reactHandles$"+Me,Fe="__reactResources$"+Me,Be="__reactMarker$"+Me;function je(e){delete e[Re],delete e[Oe],delete e[De],delete e[Ne],delete e[ze]}function Ue(e){var t=e[Re];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Le]||n[Re]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=vh(e);null!==e;){if(n=e[Re])return n;e=vh(e)}return t}n=(e=n).parentNode}return null}function Ve(e){if(e=e[Re]||e[Le]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ge(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(s(33))}function He(e){var t=e[Fe];return t||(t=e[Fe]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function $e(e){e[Be]=!0}var We=new Set,qe={};function Xe(e,t){Ze(e,t),Ze(e+"Capture",t)}function Ze(e,t){for(qe[e]=t,e=0;e<t.length;e++)We.add(t[e])}var Ke,Ye,Je=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qe={},et={};function tt(e,t,n){if(i=t,K.call(et,i)||!K.call(Qe,i)&&(Je.test(i)?et[i]=!0:(Qe[i]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function rt(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function it(e){if(void 0===Ke)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ke=t&&t[1]||"",Ye=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ke+e+Ye}var ot=!1;function st(e,t){if(!e||ot)return"";ot=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(o){r=o}e.call(n.prototype)}}else{try{throw Error()}catch(s){r=s}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(a){if(a&&r&&"string"===typeof a.stack)return[a.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=r.DetermineComponentFrameRoot(),s=o[0],a=o[1];if(s&&a){var l=s.split("\n"),c=a.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i);break}}}finally{ot=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?it(n):""}function at(e){switch(e.tag){case 26:case 27:case 5:return it(e.type);case 16:return it("Lazy");case 13:return it("Suspense");case 19:return it("SuspenseList");case 0:case 15:return st(e.type,!1);case 11:return st(e.type.render,!1);case 1:return st(e.type,!0);case 31:return it("Activity");default:return""}}function lt(e){try{var t="";do{t+=at(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ht(e){e._valueTracker||(e._valueTracker=function(e){var t=ut(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function dt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ut(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function ft(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var pt=/[\n"\\]/g;function mt(e){return e.replace(pt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,n,r,i,o,s,a){e.name="",null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?yt(e,s,ct(t)):null!=n?yt(e,s,ct(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=o&&(e.defaultChecked=!!o),null!=i&&(e.checked=i&&"function"!==typeof i&&"symbol"!==typeof i),null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.name=""+ct(a):e.removeAttribute("name")}function _t(e,t,n,r,i,o,s,a){if(null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.type=o),null!=t||null!=n){if(!("submit"!==o&&"reset"!==o||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,a||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:i)&&"symbol"!==typeof r&&!!r,e.checked=a?e.checked:!!r,e.defaultChecked=!!r,null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.name=s)}function yt(e,t,n){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function vt(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function xt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function bt(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(s(92));if(O(r)){if(1<r.length)throw Error(s(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function wt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var St=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Et(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||St.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Tt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(s(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var i in t)r=t[i],t.hasOwnProperty(i)&&n[i]!==r&&Et(e,i,r)}else for(var o in t)t.hasOwnProperty(o)&&Et(e,o,t[o])}function At(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ct=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Pt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function It(e){return Pt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var kt=null;function Mt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Rt=null,Ot=null;function Lt(e){var t=Ve(e);if(t&&(e=t.stateNode)){var n=e[Oe]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+mt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=r[Oe]||null;if(!i)throw Error(s(90));gt(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&dt(r)}break e;case"textarea":xt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&vt(e,!!n.multiple,t,!1)}}}var Dt=!1;function Nt(e,t,n){if(Dt)return e(t,n);Dt=!0;try{return e(t)}finally{if(Dt=!1,(null!==Rt||null!==Ot)&&(Uc(),Rt&&(t=Rt,e=Ot,Ot=Rt=null,Lt(t),e)))for(t=0;t<e.length;t++)Lt(e[t])}}function zt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Oe]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Ft=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Bt=!1;if(Ft)try{var jt={};Object.defineProperty(jt,"passive",{get:function(){Bt=!0}}),window.addEventListener("test",jt,jt),window.removeEventListener("test",jt,jt)}catch(Od){Bt=!1}var Ut=null,Vt=null,Gt=null;function Ht(){if(Gt)return Gt;var e,t,n=Vt,r=n.length,i="value"in Ut?Ut.value:Ut.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return Gt=i.slice(e,1<t?1-t:void 0)}function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Wt(){return!0}function qt(){return!1}function Xt(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Wt:qt,this.isPropagationStopped=qt,this}return d(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Wt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Wt)},persist:function(){},isPersistent:Wt}),t}var Zt,Kt,Yt,Jt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qt=Xt(Jt),en=d({},Jt,{view:0,detail:0}),tn=Xt(en),nn=d({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Yt&&(Yt&&"mousemove"===e.type?(Zt=e.screenX-Yt.screenX,Kt=e.screenY-Yt.screenY):Kt=Zt=0,Yt=e),Zt)},movementY:function(e){return"movementY"in e?e.movementY:Kt}}),rn=Xt(nn),on=Xt(d({},nn,{dataTransfer:0})),sn=Xt(d({},en,{relatedTarget:0})),an=Xt(d({},Jt,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=Xt(d({},Jt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),cn=Xt(d({},Jt,{data:0})),un={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=dn[e])&&!!t[e]}function pn(){return fn}var mn=Xt(d({},en,{key:function(e){if(e.key){var t=un[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),gn=Xt(d({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),_n=Xt(d({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),yn=Xt(d({},Jt,{propertyName:0,elapsedTime:0,pseudoElement:0})),vn=Xt(d({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xn=Xt(d({},Jt,{newState:0,oldState:0})),bn=[9,13,27,32],wn=Ft&&"CompositionEvent"in window,Sn=null;Ft&&"documentMode"in document&&(Sn=document.documentMode);var En=Ft&&"TextEvent"in window&&!Sn,Tn=Ft&&(!wn||Sn&&8<Sn&&11>=Sn),An=String.fromCharCode(32),Cn=!1;function Pn(e,t){switch(e){case"keyup":return-1!==bn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function In(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var kn=!1;var Mn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Mn[e.type]:"textarea"===t}function On(e,t,n,r){Rt?Ot?Ot.push(r):Ot=[r]:Rt=r,0<(t=Hu(t,"onChange")).length&&(n=new Qt("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ln=null,Dn=null;function Nn(e){Nu(e,0)}function zn(e){if(dt(Ge(e)))return e}function Fn(e,t){if("change"===e)return t}var Bn=!1;if(Ft){var jn;if(Ft){var Un="oninput"in document;if(!Un){var Vn=document.createElement("div");Vn.setAttribute("oninput","return;"),Un="function"===typeof Vn.oninput}jn=Un}else jn=!1;Bn=jn&&(!document.documentMode||9<document.documentMode)}function Gn(){Ln&&(Ln.detachEvent("onpropertychange",Hn),Dn=Ln=null)}function Hn(e){if("value"===e.propertyName&&zn(Dn)){var t=[];On(t,Dn,e,Mt(e)),Nt(Nn,t)}}function $n(e,t,n){"focusin"===e?(Gn(),Dn=n,(Ln=t).attachEvent("onpropertychange",Hn)):"focusout"===e&&Gn()}function Wn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return zn(Dn)}function qn(e,t){if("click"===e)return zn(t)}function Xn(e,t){if("input"===e||"change"===e)return zn(t)}var Zn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Kn(e,t){if(Zn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!K.call(t,i)||!Zn(e[i],t[i]))return!1}return!0}function Yn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Jn(e,t){var n,r=Yn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Yn(r)}}function Qn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Qn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function er(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=ft((e=t.contentWindow).document)}return t}function tr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var nr=Ft&&"documentMode"in document&&11>=document.documentMode,rr=null,ir=null,or=null,sr=!1;function ar(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;sr||null==rr||rr!==ft(r)||("selectionStart"in(r=rr)&&tr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},or&&Kn(or,r)||(or=r,0<(r=Hu(ir,"onSelect")).length&&(t=new Qt("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=rr)))}function lr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var cr={animationend:lr("Animation","AnimationEnd"),animationiteration:lr("Animation","AnimationIteration"),animationstart:lr("Animation","AnimationStart"),transitionrun:lr("Transition","TransitionRun"),transitionstart:lr("Transition","TransitionStart"),transitioncancel:lr("Transition","TransitionCancel"),transitionend:lr("Transition","TransitionEnd")},ur={},hr={};function dr(e){if(ur[e])return ur[e];if(!cr[e])return e;var t,n=cr[e];for(t in n)if(n.hasOwnProperty(t)&&t in hr)return ur[e]=n[t];return e}Ft&&(hr=document.createElement("div").style,"AnimationEvent"in window||(delete cr.animationend.animation,delete cr.animationiteration.animation,delete cr.animationstart.animation),"TransitionEvent"in window||delete cr.transitionend.transition);var fr=dr("animationend"),pr=dr("animationiteration"),mr=dr("animationstart"),gr=dr("transitionrun"),_r=dr("transitionstart"),yr=dr("transitioncancel"),vr=dr("transitionend"),xr=new Map,br="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wr(e,t){xr.set(e,t),Xe(t,[e])}br.push("scrollEnd");var Sr=new WeakMap;function Er(e,t){if("object"===typeof e&&null!==e){var n=Sr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:lt(t)},Sr.set(e,t),t)}return{value:e,source:t,stack:lt(t)}}var Tr=[],Ar=0,Cr=0;function Pr(){for(var e=Ar,t=Cr=Ar=0;t<e;){var n=Tr[t];Tr[t++]=null;var r=Tr[t];Tr[t++]=null;var i=Tr[t];Tr[t++]=null;var o=Tr[t];if(Tr[t++]=null,null!==r&&null!==i){var s=r.pending;null===s?i.next=i:(i.next=s.next,s.next=i),r.pending=i}0!==o&&Rr(n,i,o)}}function Ir(e,t,n,r){Tr[Ar++]=e,Tr[Ar++]=t,Tr[Ar++]=n,Tr[Ar++]=r,Cr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function kr(e,t,n,r){return Ir(e,t,n,r),Or(e)}function Mr(e,t){return Ir(e,null,null,t),Or(e)}function Rr(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(r=o.alternate)&&(r.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(i=!0)),e=o,o=o.return;return 3===e.tag?(o=e.stateNode,i&&null!==t&&(i=31-fe(n),null===(r=(e=o.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),o):null}function Or(e){if(50<Rc)throw Rc=0,Oc=null,Error(s(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Lr={};function Dr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nr(e,t,n,r){return new Dr(e,t,n,r)}function zr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Fr(e,t){var n=e.alternate;return null===n?((n=Nr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Br(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function jr(e,t,n,r,i,o){var a=0;if(r=e,"function"===typeof e)zr(e)&&(a=1);else if("string"===typeof e)a=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,V.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case C:return(e=Nr(31,n,t,i)).elementType=C,e.lanes=o,e;case g:return Ur(n.children,i,o,t);case _:a=8,i|=24;break;case y:return(e=Nr(12,n,t,2|i)).elementType=y,e.lanes=o,e;case S:return(e=Nr(13,n,t,i)).elementType=S,e.lanes=o,e;case E:return(e=Nr(19,n,t,i)).elementType=E,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case v:case b:a=10;break e;case x:a=9;break e;case w:a=11;break e;case T:a=14;break e;case A:a=16,r=null;break e}a=29,n=Error(s(130,null===e?"null":typeof e,"")),r=null}return(t=Nr(a,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Ur(e,t,n,r){return(e=Nr(7,e,r,t)).lanes=n,e}function Vr(e,t,n){return(e=Nr(6,e,null,t)).lanes=n,e}function Gr(e,t,n){return(t=Nr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hr=[],$r=0,Wr=null,qr=0,Xr=[],Zr=0,Kr=null,Yr=1,Jr="";function Qr(e,t){Hr[$r++]=qr,Hr[$r++]=Wr,Wr=e,qr=t}function ei(e,t,n){Xr[Zr++]=Yr,Xr[Zr++]=Jr,Xr[Zr++]=Kr,Kr=e;var r=Yr;e=Jr;var i=32-fe(r)-1;r&=~(1<<i),n+=1;var o=32-fe(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Yr=1<<32-fe(t)+i|n<<i|r,Jr=o+e}else Yr=1<<o|n<<i|r,Jr=e}function ti(e){null!==e.return&&(Qr(e,1),ei(e,1,0))}function ni(e){for(;e===Wr;)Wr=Hr[--$r],Hr[$r]=null,qr=Hr[--$r],Hr[$r]=null;for(;e===Kr;)Kr=Xr[--Zr],Xr[Zr]=null,Jr=Xr[--Zr],Xr[Zr]=null,Yr=Xr[--Zr],Xr[Zr]=null}var ri=null,ii=null,oi=!1,si=null,ai=!1,li=Error(s(519));function ci(e){throw mi(Er(Error(s(418,"")),e)),li}function ui(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Re]=e,t[Oe]=r,n){case"dialog":zu("cancel",t),zu("close",t);break;case"iframe":case"object":case"embed":zu("load",t);break;case"video":case"audio":for(n=0;n<Lu.length;n++)zu(Lu[n],t);break;case"source":zu("error",t);break;case"img":case"image":case"link":zu("error",t),zu("load",t);break;case"details":zu("toggle",t);break;case"input":zu("invalid",t),_t(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),ht(t);break;case"select":zu("invalid",t);break;case"textarea":zu("invalid",t),bt(t,r.value,r.defaultValue,r.children),ht(t)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||Ku(t.textContent,n)?(null!=r.popover&&(zu("beforetoggle",t),zu("toggle",t)),null!=r.onScroll&&zu("scroll",t),null!=r.onScrollEnd&&zu("scrollend",t),null!=r.onClick&&(t.onclick=Yu),t=!0):t=!1,t||ci(e)}function hi(e){for(ri=e.return;ri;)switch(ri.tag){case 5:case 13:return void(ai=!1);case 27:case 3:return void(ai=!0);default:ri=ri.return}}function di(e){if(e!==ri)return!1;if(!oi)return hi(e),oi=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||sh(e.type,e.memoizedProps)),t=!t),t&&ii&&ci(e),hi(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){ii=_h(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}ii=null}}else 27===n?(n=ii,fh(e.type)?(e=yh,yh=null,ii=e):ii=n):ii=ri?_h(e.stateNode.nextSibling):null;return!0}function fi(){ii=ri=null,oi=!1}function pi(){var e=si;return null!==e&&(null===vc?vc=e:vc.push.apply(vc,e),si=null),e}function mi(e){null===si?si=[e]:si.push(e)}var gi=B(null),_i=null,yi=null;function vi(e,t,n){U(gi,t._currentValue),t._currentValue=n}function xi(e){e._currentValue=gi.current,j(gi)}function bi(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function wi(e,t,n,r){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var o=i.dependencies;if(null!==o){var a=i.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=i;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),bi(o.return,n,e),r||(a=null);break e}o=l.next}}else if(18===i.tag){if(null===(a=i.return))throw Error(s(341));a.lanes|=n,null!==(o=a.alternate)&&(o.lanes|=n),bi(a,n,e),a=null}else a=i.child;if(null!==a)a.return=i;else for(a=i;null!==a;){if(a===e){a=null;break}if(null!==(i=a.sibling)){i.return=a.return,a=i;break}a=a.return}i=a}}function Si(e,t,n,r){e=null;for(var i=t,o=!1;null!==i;){if(!o)if(0!==(524288&i.flags))o=!0;else if(0!==(262144&i.flags))break;if(10===i.tag){var a=i.alternate;if(null===a)throw Error(s(387));if(null!==(a=a.memoizedProps)){var l=i.type;Zn(i.pendingProps.value,a.value)||(null!==e?e.push(l):e=[l])}}else if(i===$.current){if(null===(a=i.alternate))throw Error(s(387));a.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(Xh):e=[Xh])}i=i.return}null!==e&&wi(t,e,n,r),t.flags|=262144}function Ei(e){for(e=e.firstContext;null!==e;){if(!Zn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ti(e){_i=e,yi=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ai(e){return Pi(_i,e)}function Ci(e,t){return null===_i&&Ti(e),Pi(e,t)}function Pi(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===yi){if(null===e)throw Error(s(308));yi=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else yi=yi.next=t;return n}var Ii="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},ki=r.unstable_scheduleCallback,Mi=r.unstable_NormalPriority,Ri={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Oi(){return{controller:new Ii,data:new Map,refCount:0}}function Li(e){e.refCount--,0===e.refCount&&ki(Mi,function(){e.controller.abort()})}var Di=null,Ni=0,zi=0,Fi=null;function Bi(){if(0===--Ni&&null!==Di){null!==Fi&&(Fi.status="fulfilled");var e=Di;Di=null,zi=0,Fi=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var ji=L.S;L.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Di){var n=Di=[];Ni=0,zi=Iu(),Fi={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ni++,t.then(Bi,Bi)}(0,t),null!==ji&&ji(e,t)};var Ui=B(null);function Vi(){var e=Ui.current;return null!==e?e:rc.pooledCache}function Gi(e,t){U(Ui,null===t?Ui.current:t.pool)}function Hi(){var e=Vi();return null===e?null:{parent:Ri._currentValue,pool:e}}var $i=Error(s(460)),Wi=Error(s(474)),qi=Error(s(542)),Xi={then:function(){}};function Zi(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Ki(){}function Yi(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Ki,Ki),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw eo(e=t.reason),e;default:if("string"===typeof t.status)t.then(Ki,Ki);else{if(null!==(e=rc)&&100<e.shellSuspendCounter)throw Error(s(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw eo(e=t.reason),e}throw Ji=t,$i}}var Ji=null;function Qi(){if(null===Ji)throw Error(s(459));var e=Ji;return Ji=null,e}function eo(e){if(e===$i||e===qi)throw Error(s(483))}var to=!1;function no(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ro(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function io(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function oo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&nc)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=Or(e),Rr(e,null,n),t}return Ir(e,r,t,n),Or(e)}function so(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ce(e,n)}}function ao(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var lo=!1;function co(){if(lo){if(null!==Fi)throw Fi}}function uo(e,t,n,r){lo=!1;var i=e.updateQueue;to=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=i.baseState;for(s=0,u=c=l=null,a=o;;){var f=-536870913&a.lane,p=f!==a.lane;if(p?(oc&f)===f:(r&f)===f){0!==f&&f===zi&&(lo=!0),null!==u&&(u=u.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});e:{var m=e,g=a;f=t;var _=n;switch(g.tag){case 1:if("function"===typeof(m=g.payload)){h=m.call(_,h,f);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(f="function"===typeof(m=g.payload)?m.call(_,h,f):m)||void 0===f)break e;h=d({},h,f);break e;case 2:to=!0}}null!==(f=a.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=i.callbacks)?i.callbacks=[f]:p.push(f))}else p={lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=f;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(p=a).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===o&&(i.shared.lanes=0),fc|=s,e.lanes=s,e.memoizedState=h}}function ho(e,t){if("function"!==typeof e)throw Error(s(191,e));e.call(t)}function fo(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ho(n[e],t)}var po=B(null),mo=B(0);function go(e,t){U(mo,e=hc),U(po,t),hc=e|t.baseLanes}function _o(){U(mo,hc),U(po,po.current)}function yo(){hc=mo.current,j(po),j(mo)}var vo=0,xo=null,bo=null,wo=null,So=!1,Eo=!1,To=!1,Ao=0,Co=0,Po=null,Io=0;function ko(){throw Error(s(321))}function Mo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Zn(e[n],t[n]))return!1;return!0}function Ro(e,t,n,r,i,o){return vo=o,xo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,L.H=null===e||null===e.memoizedState?Ws:qs,To=!1,o=n(r,i),To=!1,Eo&&(o=Lo(t,n,r,i)),Oo(e),o}function Oo(e){L.H=$s;var t=null!==bo&&null!==bo.next;if(vo=0,wo=bo=xo=null,So=!1,Co=0,Po=null,t)throw Error(s(300));null===e||Ca||null!==(e=e.dependencies)&&Ei(e)&&(Ca=!0)}function Lo(e,t,n,r){xo=e;var i=0;do{if(Eo&&(Po=null),Co=0,Eo=!1,25<=i)throw Error(s(301));if(i+=1,wo=bo=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}L.H=Xs,o=t(n,r)}while(Eo);return o}function Do(){var e=L.H,t=e.useState()[0];return t="function"===typeof t.then?Uo(t):t,e=e.useState()[0],(null!==bo?bo.memoizedState:null)!==e&&(xo.flags|=1024),t}function No(){var e=0!==Ao;return Ao=0,e}function zo(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Fo(e){if(So){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}So=!1}vo=0,wo=bo=xo=null,Eo=!1,Co=Ao=0,Po=null}function Bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wo?xo.memoizedState=wo=e:wo=wo.next=e,wo}function jo(){if(null===bo){var e=xo.alternate;e=null!==e?e.memoizedState:null}else e=bo.next;var t=null===wo?xo.memoizedState:wo.next;if(null!==t)wo=t,bo=e;else{if(null===e){if(null===xo.alternate)throw Error(s(467));throw Error(s(310))}e={memoizedState:(bo=e).memoizedState,baseState:bo.baseState,baseQueue:bo.baseQueue,queue:bo.queue,next:null},null===wo?xo.memoizedState=wo=e:wo=wo.next=e}return wo}function Uo(e){var t=Co;return Co+=1,null===Po&&(Po=[]),e=Yi(Po,e,t),t=xo,null===(null===wo?t.memoizedState:wo.next)&&(t=t.alternate,L.H=null===t||null===t.memoizedState?Ws:qs),e}function Vo(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Uo(e);if(e.$$typeof===b)return Ai(e)}throw Error(s(438,String(e)))}function Go(e){var t=null,n=xo.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=xo.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=P;return t.index++,n}function Ho(e,t){return"function"===typeof t?t(e):t}function $o(e){return Wo(jo(),bo,e)}function Wo(e,t,n){var r=e.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=n;var i=e.baseQueue,o=r.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}t.baseQueue=i=o,r.pending=null}if(o=e.baseState,null===i)e.memoizedState=o;else{var l=a=null,c=null,u=t=i.next,h=!1;do{var d=-536870913&u.lane;if(d!==u.lane?(oc&d)===d:(vo&d)===d){var f=u.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===zi&&(h=!0);else{if((vo&f)===f){u=u.next,f===zi&&(h=!0);continue}d={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=d,a=o):c=c.next=d,xo.lanes|=f,fc|=f}d=u.action,To&&n(o,d),o=u.hasEagerState?u.eagerState:n(o,d)}else f={lane:d,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,a=o):c=c.next=f,xo.lanes|=d,fc|=d;u=u.next}while(null!==u&&u!==t);if(null===c?a=o:c.next=l,!Zn(o,e.memoizedState)&&(Ca=!0,h&&null!==(n=Fi)))throw n;e.memoizedState=o,e.baseState=a,e.baseQueue=c,r.lastRenderedState=o}return null===i&&(r.lanes=0),[e.memoizedState,r.dispatch]}function qo(e){var t=jo(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);Zn(o,t.memoizedState)||(Ca=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Xo(e,t,n){var r=xo,i=jo(),o=oi;if(o){if(void 0===n)throw Error(s(407));n=n()}else n=t();var a=!Zn((bo||i).memoizedState,n);if(a&&(i.memoizedState=n,Ca=!0),i=i.queue,_s(2048,8,Yo.bind(null,r,i,e),[e]),i.getSnapshot!==t||a||null!==wo&&1&wo.memoizedState.tag){if(r.flags|=2048,ps(9,{destroy:void 0,resource:void 0},Ko.bind(null,r,i,n,t),null),null===rc)throw Error(s(349));o||0!==(124&vo)||Zo(r,t,n)}return n}function Zo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=xo.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ko(e,t,n,r){t.value=n,t.getSnapshot=r,Jo(t)&&Qo(e)}function Yo(e,t,n){return n(function(){Jo(t)&&Qo(e)})}function Jo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Zn(e,n)}catch(r){return!0}}function Qo(e){var t=Mr(e,2);null!==t&&Nc(t,e,2)}function es(e){var t=Bo();if("function"===typeof e){var n=e;if(e=n(),To){de(!0);try{n()}finally{de(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:e},t}function ts(e,t,n,r){return e.baseState=n,Wo(e,bo,"function"===typeof r?r:Ho)}function ns(e,t,n,r,i){if(Vs(e))throw Error(s(485));if(null!==(e=t.action)){var o={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==L.T?n(!0):o.isTransition=!1,r(o),null===(n=t.pending)?(o.next=t.pending=o,rs(t,o)):(o.next=n.next,t.pending=n.next=o)}}function rs(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var o=L.T,s={};L.T=s;try{var a=n(i,r),l=L.S;null!==l&&l(s,a),is(e,t,a)}catch(c){ss(e,t,c)}finally{L.T=o}}else try{is(e,t,o=n(i,r))}catch(u){ss(e,t,u)}}function is(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){os(e,t,n)},function(n){return ss(e,t,n)}):os(e,t,n)}function os(e,t,n){t.status="fulfilled",t.value=n,as(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,rs(e,n)))}function ss(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,as(t),t=t.next}while(t!==r)}e.action=null}function as(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ls(e,t){return t}function cs(e,t){if(oi){var n=rc.formState;if(null!==n){e:{var r=xo;if(oi){if(ii){t:{for(var i=ii,o=ai;8!==i.nodeType;){if(!o){i=null;break t}if(null===(i=_h(i.nextSibling))){i=null;break t}}i="F!"===(o=i.data)||"F"===o?i:null}if(i){ii=_h(i.nextSibling),r="F!"===i.data;break e}}ci(r)}r=!1}r&&(t=n[0])}}return(n=Bo()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ls,lastRenderedState:t},n.queue=r,n=Bs.bind(null,xo,r),r.dispatch=n,r=es(!1),o=Us.bind(null,xo,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=Bo()).queue=i,n=ns.bind(null,xo,i,o,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function us(e){return hs(jo(),bo,e)}function hs(e,t,n){if(t=Wo(e,t,ls)[0],e=$o(Ho)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var r=Uo(t)}catch(s){if(s===$i)throw qi;throw s}else r=t;var i=(t=jo()).queue,o=i.dispatch;return n!==t.memoizedState&&(xo.flags|=2048,ps(9,{destroy:void 0,resource:void 0},ds.bind(null,i,n),null)),[r,o,e]}function ds(e,t){e.action=t}function fs(e){var t=jo(),n=bo;if(null!==n)return hs(t,n,e);jo(),t=t.memoizedState;var r=(n=jo()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function ps(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=xo.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function ms(){return jo().memoizedState}function gs(e,t,n,r){var i=Bo();r=void 0===r?null:r,xo.flags|=e,i.memoizedState=ps(1|t,{destroy:void 0,resource:void 0},n,r)}function _s(e,t,n,r){var i=jo();r=void 0===r?null:r;var o=i.memoizedState.inst;null!==bo&&null!==r&&Mo(r,bo.memoizedState.deps)?i.memoizedState=ps(t,o,n,r):(xo.flags|=e,i.memoizedState=ps(1|t,o,n,r))}function ys(e,t){gs(8390656,8,e,t)}function vs(e,t){_s(2048,8,e,t)}function xs(e,t){return _s(4,2,e,t)}function bs(e,t){return _s(4,4,e,t)}function ws(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Ss(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,_s(4,4,ws.bind(null,t,e),n)}function Es(){}function Ts(e,t){var n=jo();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&Mo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function As(e,t){var n=jo();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&Mo(t,r[1]))return r[0];if(r=e(),To){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[r,t],r}function Cs(e,t,n){return void 0===n||0!==(1073741824&vo)?e.memoizedState=t:(e.memoizedState=n,e=Dc(),xo.lanes|=e,fc|=e,n)}function Ps(e,t,n,r){return Zn(n,t)?n:null!==po.current?(e=Cs(e,n,r),Zn(e,t)||(Ca=!0),e):0===(42&vo)?(Ca=!0,e.memoizedState=n):(e=Dc(),xo.lanes|=e,fc|=e,t)}function Is(e,t,n,r,i){var o=D.p;D.p=0!==o&&8>o?o:8;var s=L.T,a={};L.T=a,Us(e,!1,t,n);try{var l=i(),c=L.S;if(null!==c&&c(a,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)js(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}(l,r),Lc());else js(e,t,r,Lc())}catch(u){js(e,t,{then:function(){},status:"rejected",reason:u},Lc())}finally{D.p=o,L.T=s}}function ks(){}function Ms(e,t,n,r){if(5!==e.tag)throw Error(s(476));var i=Rs(e).queue;Is(e,i,t,N,null===n?ks:function(){return Os(e),n(r)})}function Rs(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:N,baseState:N,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:N},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Os(e){js(e,Rs(e).next.queue,{},Lc())}function Ls(){return Ai(Xh)}function Ds(){return jo().memoizedState}function Ns(){return jo().memoizedState}function zs(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Lc(),r=oo(t,e=io(n),n);return null!==r&&(Nc(r,t,n),so(r,t,n)),t={cache:Oi()},void(e.payload=t)}t=t.return}}function Fs(e,t,n){var r=Lc();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Vs(e)?Gs(t,n):null!==(n=kr(e,t,n,r))&&(Nc(n,e,r),Hs(n,t,r))}function Bs(e,t,n){js(e,t,n,Lc())}function js(e,t,n,r){var i={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Vs(e))Gs(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,Zn(a,s))return Ir(e,t,i,0),null===rc&&Pr(),!1}catch(l){}if(null!==(n=kr(e,t,i,r)))return Nc(n,e,r),Hs(n,t,r),!0}return!1}function Us(e,t,n,r){if(r={lane:2,revertLane:Iu(),action:r,hasEagerState:!1,eagerState:null,next:null},Vs(e)){if(t)throw Error(s(479))}else null!==(t=kr(e,n,r,2))&&Nc(t,e,2)}function Vs(e){var t=e.alternate;return e===xo||null!==t&&t===xo}function Gs(e,t){Eo=So=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Hs(e,t,n){if(0!==(4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ce(e,n)}}var $s={readContext:Ai,use:Vo,useCallback:ko,useContext:ko,useEffect:ko,useImperativeHandle:ko,useLayoutEffect:ko,useInsertionEffect:ko,useMemo:ko,useReducer:ko,useRef:ko,useState:ko,useDebugValue:ko,useDeferredValue:ko,useTransition:ko,useSyncExternalStore:ko,useId:ko,useHostTransitionStatus:ko,useFormState:ko,useActionState:ko,useOptimistic:ko,useMemoCache:ko,useCacheRefresh:ko},Ws={readContext:Ai,use:Vo,useCallback:function(e,t){return Bo().memoizedState=[e,void 0===t?null:t],e},useContext:Ai,useEffect:ys,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,gs(4194308,4,ws.bind(null,t,e),n)},useLayoutEffect:function(e,t){return gs(4194308,4,e,t)},useInsertionEffect:function(e,t){gs(4,2,e,t)},useMemo:function(e,t){var n=Bo();t=void 0===t?null:t;var r=e();if(To){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Bo();if(void 0!==n){var i=n(t);if(To){de(!0);try{n(t)}finally{de(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=Fs.bind(null,xo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Bo().memoizedState=e},useState:function(e){var t=(e=es(e)).queue,n=Bs.bind(null,xo,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Es,useDeferredValue:function(e,t){return Cs(Bo(),e,t)},useTransition:function(){var e=es(!1);return e=Is.bind(null,xo,e.queue,!0,!1),Bo().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=xo,i=Bo();if(oi){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===rc)throw Error(s(349));0!==(124&oc)||Zo(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,ys(Yo.bind(null,r,o,e),[e]),r.flags|=2048,ps(9,{destroy:void 0,resource:void 0},Ko.bind(null,r,o,n,t),null),n},useId:function(){var e=Bo(),t=rc.identifierPrefix;if(oi){var n=Jr;t="\xab"+t+"R"+(n=(Yr&~(1<<32-fe(Yr)-1)).toString(32)+n),0<(n=Ao++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Io++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Ls,useFormState:cs,useActionState:cs,useOptimistic:function(e){var t=Bo();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Us.bind(null,xo,!0,n),n.dispatch=t,[e,t]},useMemoCache:Go,useCacheRefresh:function(){return Bo().memoizedState=zs.bind(null,xo)}},qs={readContext:Ai,use:Vo,useCallback:Ts,useContext:Ai,useEffect:vs,useImperativeHandle:Ss,useInsertionEffect:xs,useLayoutEffect:bs,useMemo:As,useReducer:$o,useRef:ms,useState:function(){return $o(Ho)},useDebugValue:Es,useDeferredValue:function(e,t){return Ps(jo(),bo.memoizedState,e,t)},useTransition:function(){var e=$o(Ho)[0],t=jo().memoizedState;return["boolean"===typeof e?e:Uo(e),t]},useSyncExternalStore:Xo,useId:Ds,useHostTransitionStatus:Ls,useFormState:us,useActionState:us,useOptimistic:function(e,t){return ts(jo(),0,e,t)},useMemoCache:Go,useCacheRefresh:Ns},Xs={readContext:Ai,use:Vo,useCallback:Ts,useContext:Ai,useEffect:vs,useImperativeHandle:Ss,useInsertionEffect:xs,useLayoutEffect:bs,useMemo:As,useReducer:qo,useRef:ms,useState:function(){return qo(Ho)},useDebugValue:Es,useDeferredValue:function(e,t){var n=jo();return null===bo?Cs(n,e,t):Ps(n,bo.memoizedState,e,t)},useTransition:function(){var e=qo(Ho)[0],t=jo().memoizedState;return["boolean"===typeof e?e:Uo(e),t]},useSyncExternalStore:Xo,useId:Ds,useHostTransitionStatus:Ls,useFormState:fs,useActionState:fs,useOptimistic:function(e,t){var n=jo();return null!==bo?ts(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Go,useCacheRefresh:Ns},Zs=null,Ks=0;function Ys(e){var t=Ks;return Ks+=1,null===Zs&&(Zs=[]),Yi(Zs,e,t)}function Js(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Qs(e,t){if(t.$$typeof===f)throw Error(s(525));throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ea(e){return(0,e._init)(e._payload)}function ta(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=Fr(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Vr(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===g?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===A&&ea(o)===t.type)?(Js(t=i(t,n.props),n),t.return=e,t):(Js(t=jr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gr(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,o){return null===t||7!==t.tag?((t=Ur(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Vr(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case p:return Js(n=jr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case m:return(t=Gr(t,e.mode,n)).return=e,t;case A:return d(e,t=(0,t._init)(t._payload),n)}if(O(t)||k(t))return(t=Ur(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return d(e,Ys(t),n);if(t.$$typeof===b)return d(e,Ci(e,t),n);Qs(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case p:return n.key===i?c(e,t,n,r):null;case m:return n.key===i?u(e,t,n,r):null;case A:return f(e,t,n=(i=n._init)(n._payload),r)}if(O(n)||k(n))return null!==i?null:h(e,t,n,r,null);if("function"===typeof n.then)return f(e,t,Ys(n),r);if(n.$$typeof===b)return f(e,t,Ci(e,n),r);Qs(e,n)}return null}function _(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case p:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case m:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case A:return _(e,t,n,r=(0,r._init)(r._payload),i)}if(O(r)||k(r))return h(t,e=e.get(n)||null,r,i,null);if("function"===typeof r.then)return _(e,t,n,Ys(r),i);if(r.$$typeof===b)return _(e,t,n,Ci(t,r),i);Qs(t,r)}return null}function y(l,c,u,h){if("object"===typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case p:e:{for(var v=u.key;null!==c;){if(c.key===v){if((v=u.type)===g){if(7===c.tag){n(l,c.sibling),(h=i(c,u.props.children)).return=l,l=h;break e}}else if(c.elementType===v||"object"===typeof v&&null!==v&&v.$$typeof===A&&ea(v)===c.type){n(l,c.sibling),Js(h=i(c,u.props),u),h.return=l,l=h;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===g?((h=Ur(u.props.children,l.mode,h,u.key)).return=l,l=h):(Js(h=jr(u.type,u.key,u.props,null,l.mode,h),u),h.return=l,l=h)}return a(l);case m:e:{for(v=u.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(h=i(c,u.children||[])).return=l,l=h;break e}n(l,c);break}t(l,c),c=c.sibling}(h=Gr(u,l.mode,h)).return=l,l=h}return a(l);case A:return y(l,c,u=(v=u._init)(u._payload),h)}if(O(u))return function(i,s,a,l){for(var c=null,u=null,h=s,p=s=0,m=null;null!==h&&p<a.length;p++){h.index>p?(m=h,h=null):m=h.sibling;var g=f(i,h,a[p],l);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(i,h),s=o(g,s,p),null===u?c=g:u.sibling=g,u=g,h=m}if(p===a.length)return n(i,h),oi&&Qr(i,p),c;if(null===h){for(;p<a.length;p++)null!==(h=d(i,a[p],l))&&(s=o(h,s,p),null===u?c=h:u.sibling=h,u=h);return oi&&Qr(i,p),c}for(h=r(h);p<a.length;p++)null!==(m=_(h,i,p,a[p],l))&&(e&&null!==m.alternate&&h.delete(null===m.key?p:m.key),s=o(m,s,p),null===u?c=m:u.sibling=m,u=m);return e&&h.forEach(function(e){return t(i,e)}),oi&&Qr(i,p),c}(l,c,u,h);if(k(u)){if("function"!==typeof(v=k(u)))throw Error(s(150));return function(i,a,l,c){if(null==l)throw Error(s(151));for(var u=null,h=null,p=a,m=a=0,g=null,y=l.next();null!==p&&!y.done;m++,y=l.next()){p.index>m?(g=p,p=null):g=p.sibling;var v=f(i,p,y.value,c);if(null===v){null===p&&(p=g);break}e&&p&&null===v.alternate&&t(i,p),a=o(v,a,m),null===h?u=v:h.sibling=v,h=v,p=g}if(y.done)return n(i,p),oi&&Qr(i,m),u;if(null===p){for(;!y.done;m++,y=l.next())null!==(y=d(i,y.value,c))&&(a=o(y,a,m),null===h?u=y:h.sibling=y,h=y);return oi&&Qr(i,m),u}for(p=r(p);!y.done;m++,y=l.next())null!==(y=_(p,i,m,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?m:y.key),a=o(y,a,m),null===h?u=y:h.sibling=y,h=y);return e&&p.forEach(function(e){return t(i,e)}),oi&&Qr(i,m),u}(l,c,u=v.call(u),h)}if("function"===typeof u.then)return y(l,c,Ys(u),h);if(u.$$typeof===b)return y(l,c,Ci(l,u),h);Qs(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(h=i(c,u)).return=l,l=h):(n(l,c),(h=Vr(u,l.mode,h)).return=l,l=h),a(l)):n(l,c)}return function(e,t,n,r){try{Ks=0;var i=y(e,t,n,r);return Zs=null,i}catch(s){if(s===$i||s===qi)throw s;var o=Nr(29,s,null,e.mode);return o.lanes=r,o.return=e,o}}}var na=ta(!0),ra=ta(!1),ia=B(null),oa=null;function sa(e){var t=e.alternate;U(ua,1&ua.current),U(ia,e),null===oa&&(null===t||null!==po.current||null!==t.memoizedState)&&(oa=e)}function aa(e){if(22===e.tag){if(U(ua,ua.current),U(ia,e),null===oa){var t=e.alternate;null!==t&&null!==t.memoizedState&&(oa=e)}}else la()}function la(){U(ua,ua.current),U(ia,ia.current)}function ca(e){j(ia),oa===e&&(oa=null),j(ua)}var ua=B(0);function ha(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||gh(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function da(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:d({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var fa={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Lc(),i=io(r);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=oo(e,i,r))&&(Nc(t,e,r),so(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Lc(),i=io(r);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=oo(e,i,r))&&(Nc(t,e,r),so(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Lc(),r=io(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=oo(e,r,n))&&(Nc(t,e,n),so(t,e,n))}};function pa(e,t,n,r,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!Kn(n,r)||!Kn(i,o))}function ma(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&fa.enqueueReplaceState(t,t.state,null)}function ga(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=d({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}var _a="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function ya(e){_a(e)}function va(e){console.error(e)}function xa(e){_a(e)}function ba(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function wa(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Sa(e,t,n){return(n=io(n)).tag=3,n.payload={element:null},n.callback=function(){ba(e,t)},n}function Ea(e){return(e=io(e)).tag=3,e}function Ta(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"===typeof i){var o=r.value;e.payload=function(){return i(o)},e.callback=function(){wa(t,n,r)}}var s=n.stateNode;null!==s&&"function"===typeof s.componentDidCatch&&(e.callback=function(){wa(t,n,r),"function"!==typeof i&&(null===Ec?Ec=new Set([this]):Ec.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Aa=Error(s(461)),Ca=!1;function Pa(e,t,n,r){t.child=null===e?ra(t,null,n,r):na(t,e.child,n,r)}function Ia(e,t,n,r,i){n=n.render;var o=t.ref;if("ref"in r){var s={};for(var a in r)"ref"!==a&&(s[a]=r[a])}else s=r;return Ti(t),r=Ro(e,t,n,s,o,i),a=No(),null===e||Ca?(oi&&a&&ti(t),t.flags|=1,Pa(e,t,r,i),t.child):(zo(e,t,i),Za(e,t,i))}function ka(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||zr(o)||void 0!==o.defaultProps||null!==n.compare?((e=jr(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ma(e,t,o,r,i))}if(o=e.child,!Ka(e,i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:Kn)(s,r)&&e.ref===t.ref)return Za(e,t,i)}return t.flags|=1,(e=Fr(o,r)).ref=t.ref,e.return=t,t.child=e}function Ma(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(Kn(o,r)&&e.ref===t.ref){if(Ca=!1,t.pendingProps=r=o,!Ka(e,i))return t.lanes=e.lanes,Za(e,t,i);0!==(131072&e.flags)&&(Ca=!0)}}return Da(e,t,n,r,i)}function Ra(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode){if(0!==(128&t.flags)){if(r=null!==o?o.baseLanes|n:n,null!==e){for(i=t.child=e.child,o=0;null!==i;)o=o|i.lanes|i.childLanes,i=i.sibling;t.childLanes=o&~r}else t.childLanes=0,t.child=null;return Oa(e,t,r,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Oa(e,t,null!==o?o.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Gi(0,null!==o?o.cachePool:null),null!==o?go(t,o):_o(),aa(t)}else null!==o?(Gi(0,o.cachePool),go(t,o),la(),t.memoizedState=null):(null!==e&&Gi(0,null),_o(),la());return Pa(e,t,i,n),t.child}function Oa(e,t,n,r){var i=Vi();return i=null===i?null:{parent:Ri._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&Gi(0,null),_o(),aa(t),null!==e&&Si(e,t,r,!0),null}function La(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(s(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Da(e,t,n,r,i){return Ti(t),n=Ro(e,t,n,r,void 0,i),r=No(),null===e||Ca?(oi&&r&&ti(t),t.flags|=1,Pa(e,t,n,i),t.child):(zo(e,t,i),Za(e,t,i))}function Na(e,t,n,r,i,o){return Ti(t),t.updateQueue=null,n=Lo(t,r,n,i),Oo(e),r=No(),null===e||Ca?(oi&&r&&ti(t),t.flags|=1,Pa(e,t,n,o),t.child):(zo(e,t,o),Za(e,t,o))}function za(e,t,n,r,i){if(Ti(t),null===t.stateNode){var o=Lr,s=n.contextType;"object"===typeof s&&null!==s&&(o=Ai(s)),o=new n(r,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=fa,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=r,o.state=t.memoizedState,o.refs={},no(t),s=n.contextType,o.context="object"===typeof s&&null!==s?Ai(s):Lr,o.state=t.memoizedState,"function"===typeof(s=n.getDerivedStateFromProps)&&(da(t,n,s,r),o.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(s=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),s!==o.state&&fa.enqueueReplaceState(o,o.state,null),uo(t,r,o,i),co(),o.state=t.memoizedState),"function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){o=t.stateNode;var a=t.memoizedProps,l=ga(n,a);o.props=l;var c=o.context,u=n.contextType;s=Lr,"object"===typeof u&&null!==u&&(s=Ai(u));var h=n.getDerivedStateFromProps;u="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate,a=t.pendingProps!==a,u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a||c!==s)&&ma(t,o,r,s),to=!1;var d=t.memoizedState;o.state=d,uo(t,r,o,i),co(),c=t.memoizedState,a||d!==c||to?("function"===typeof h&&(da(t,n,h,r),c=t.memoizedState),(l=to||pa(t,n,l,r,d,c,s))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=s,r=l):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,ro(e,t),u=ga(n,s=t.memoizedProps),o.props=u,h=t.pendingProps,d=o.context,c=n.contextType,l=Lr,"object"===typeof c&&null!==c&&(l=Ai(c)),(c="function"===typeof(a=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==l)&&ma(t,o,r,l),to=!1,d=t.memoizedState,o.state=d,uo(t,r,o,i),co();var f=t.memoizedState;s!==h||d!==f||to||null!==e&&null!==e.dependencies&&Ei(e.dependencies)?("function"===typeof a&&(da(t,n,a,r),f=t.memoizedState),(u=to||pa(t,n,u,r,d,f,l)||null!==e&&null!==e.dependencies&&Ei(e.dependencies))?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=l,r=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return o=r,La(e,t),r=0!==(128&t.flags),o||r?(o=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&r?(t.child=na(t,e.child,null,i),t.child=na(t,null,n,i)):Pa(e,t,n,i),t.memoizedState=o.state,e=t.child):e=Za(e,t,i),e}function Fa(e,t,n,r){return fi(),t.flags|=256,Pa(e,t,n,r),t.child}var Ba={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ja(e){return{baseLanes:e,cachePool:Hi()}}function Ua(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=gc),e}function Va(e,t,n){var r,i=t.pendingProps,o=!1,a=0!==(128&t.flags);if((r=a)||(r=(null===e||null!==e.memoizedState)&&0!==(2&ua.current)),r&&(o=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(oi){if(o?sa(t):la(),oi){var l,c=ii;if(l=c){e:{for(l=c,c=ai;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=_h(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Kr?{id:Yr,overflow:Jr}:null,retryLane:536870912,hydrationErrors:null},(l=Nr(18,null,null,0)).stateNode=c,l.return=t,t.child=l,ri=t,ii=null,l=!0):l=!1}l||ci(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return gh(c)?t.lanes=32:t.lanes=536870912,null;ca(t)}return c=i.children,i=i.fallback,o?(la(),c=Ha({mode:"hidden",children:c},o=t.mode),i=Ur(i,o,n,null),c.return=t,i.return=t,c.sibling=i,t.child=c,(o=t.child).memoizedState=ja(n),o.childLanes=Ua(e,r,n),t.memoizedState=Ba,i):(sa(t),Ga(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(a)256&t.flags?(sa(t),t.flags&=-257,t=$a(e,t,n)):null!==t.memoizedState?(la(),t.child=e.child,t.flags|=128,t=null):(la(),o=i.fallback,c=t.mode,i=Ha({mode:"visible",children:i.children},c),(o=Ur(o,c,n,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,na(t,e.child,null,n),(i=t.child).memoizedState=ja(n),i.childLanes=Ua(e,r,n),t.memoizedState=Ba,t=o);else if(sa(t),gh(c)){if(r=c.nextSibling&&c.nextSibling.dataset)var u=r.dgst;r=u,(i=Error(s(419))).stack="",i.digest=r,mi({value:i,source:null,stack:null}),t=$a(e,t,n)}else if(Ca||Si(e,t,n,!1),r=0!==(n&e.childLanes),Ca||r){if(null!==(r=rc)&&(0!==(i=0!==((i=0!==(42&(i=n&-n))?1:Pe(i))&(r.suspendedLanes|n))?0:i)&&i!==l.retryLane))throw l.retryLane=i,Mr(e,i),Nc(r,e,i),Aa;"$?"===c.data||qc(),t=$a(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,ii=_h(c.nextSibling),ri=t,oi=!0,si=null,ai=!1,null!==e&&(Xr[Zr++]=Yr,Xr[Zr++]=Jr,Xr[Zr++]=Kr,Yr=e.id,Jr=e.overflow,Kr=t),(t=Ga(t,i.children)).flags|=4096);return t}return o?(la(),o=i.fallback,c=t.mode,u=(l=e.child).sibling,(i=Fr(l,{mode:"hidden",children:i.children})).subtreeFlags=65011712&l.subtreeFlags,null!==u?o=Fr(u,o):(o=Ur(o,c,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,null===(c=e.child.memoizedState)?c=ja(n):(null!==(l=c.cachePool)?(u=Ri._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Hi(),c={baseLanes:c.baseLanes|n,cachePool:l}),o.memoizedState=c,o.childLanes=Ua(e,r,n),t.memoizedState=Ba,i):(sa(t),e=(n=e.child).sibling,(n=Fr(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Ga(e,t){return(t=Ha({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ha(e,t){return(e=Nr(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function $a(e,t,n){return na(t,e.child,null,n),(e=Ga(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Wa(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),bi(e.return,t,n)}function qa(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Xa(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Pa(e,t,r.children,n),0!==(2&(r=ua.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Wa(e,n,t);else if(19===e.tag)Wa(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(U(ua,r),i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ha(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),qa(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ha(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}qa(t,!0,n,null,o);break;case"together":qa(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Za(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),fc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Si(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Fr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Fr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ka(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Ei(e))}function Ya(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ca=!0;else{if(!Ka(e,n)&&0===(128&t.flags))return Ca=!1,function(e,t,n){switch(t.tag){case 3:W(t,t.stateNode.containerInfo),vi(0,Ri,e.memoizedState.cache),fi();break;case 27:case 5:X(t);break;case 4:W(t,t.stateNode.containerInfo);break;case 10:vi(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(sa(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Va(e,t,n):(sa(t),null!==(e=Za(e,t,n))?e.sibling:null);sa(t);break;case 19:var i=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(Si(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return Xa(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),U(ua,ua.current),r)break;return null;case 22:case 23:return t.lanes=0,Ra(e,t,n);case 24:vi(0,Ri,e.memoizedState.cache)}return Za(e,t,n)}(e,t,n);Ca=0!==(131072&e.flags)}else Ca=!1,oi&&0!==(1048576&t.flags)&&ei(t,qr,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,i=r._init;if(r=i(r._payload),t.type=r,"function"!==typeof r){if(void 0!==r&&null!==r){if((i=r.$$typeof)===w){t.tag=11,t=Ia(null,t,r,e,n);break e}if(i===T){t.tag=14,t=ka(null,t,r,e,n);break e}}throw t=R(r)||r,Error(s(306,t,""))}zr(r)?(e=ga(r,e),t.tag=1,t=za(null,t,r,e,n)):(t.tag=0,t=Da(null,t,r,e,n))}return t;case 0:return Da(e,t,t.type,t.pendingProps,n);case 1:return za(e,t,r=t.type,i=ga(r,t.pendingProps),n);case 3:e:{if(W(t,t.stateNode.containerInfo),null===e)throw Error(s(387));r=t.pendingProps;var o=t.memoizedState;i=o.element,ro(e,t),uo(t,r,null,n);var a=t.memoizedState;if(r=a.cache,vi(0,Ri,r),r!==o.cache&&wi(t,[Ri],n,!0),co(),r=a.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:a.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Fa(e,t,r,n);break e}if(r!==i){mi(i=Er(Error(s(424)),t)),t=Fa(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ii=_h(e.firstChild),ri=t,oi=!0,si=null,ai=!0,n=ra(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fi(),r===i){t=Za(e,t,n);break e}Pa(e,t,r,n)}t=t.child}return t;case 26:return La(e,t),null===e?(n=Ph(t.type,null,t.pendingProps,null))?t.memoizedState=n:oi||(n=t.type,e=t.pendingProps,(r=rh(H.current).createElement(n))[Re]=t,r[Oe]=e,eh(r,n,e),$e(r),t.stateNode=r):t.memoizedState=Ph(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return X(t),null===e&&oi&&(r=t.stateNode=xh(t.type,t.pendingProps,H.current),ri=t,ai=!0,i=ii,fh(t.type)?(yh=i,ii=_h(r.firstChild)):ii=i),Pa(e,t,t.pendingProps.children,n),La(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&oi&&((i=r=ii)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[Be])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var o=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===o)return e}if(null===(e=_h(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,ai))?(t.stateNode=r,ri=t,ii=_h(r.firstChild),ai=!1,i=!0):i=!1),i||ci(t)),X(t),i=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,r=o.children,sh(i,o)?r=null:null!==a&&sh(i,a)&&(t.flags|=32),null!==t.memoizedState&&(i=Ro(e,t,Do,null,null,n),Xh._currentValue=i),La(e,t),Pa(e,t,r,n),t.child;case 6:return null===e&&oi&&((e=n=ii)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=_h(e.nextSibling)))return null}return e}(n,t.pendingProps,ai))?(t.stateNode=n,ri=t,ii=null,e=!0):e=!1),e||ci(t)),null;case 13:return Va(e,t,n);case 4:return W(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=na(t,null,r,n):Pa(e,t,r,n),t.child;case 11:return Ia(e,t,t.type,t.pendingProps,n);case 7:return Pa(e,t,t.pendingProps,n),t.child;case 8:case 12:return Pa(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,vi(0,t.type,r.value),Pa(e,t,r.children,n),t.child;case 9:return i=t.type._context,r=t.pendingProps.children,Ti(t),r=r(i=Ai(i)),t.flags|=1,Pa(e,t,r,n),t.child;case 14:return ka(e,t,t.type,t.pendingProps,n);case 15:return Ma(e,t,t.type,t.pendingProps,n);case 19:return Xa(e,t,n);case 31:return r=t.pendingProps,n=t.mode,r={mode:r.mode,children:r.children},null===e?((n=Ha(r,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Fr(e.child,r)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Ra(e,t,n);case 24:return Ti(t),r=Ai(Ri),null===e?(null===(i=Vi())&&(i=rc,o=Oi(),i.pooledCache=o,o.refCount++,null!==o&&(i.pooledCacheLanes|=n),i=o),t.memoizedState={parent:r,cache:i},no(t),vi(0,Ri,i)):(0!==(e.lanes&n)&&(ro(e,t),uo(t,null,null,n),co()),i=e.memoizedState,o=t.memoizedState,i.parent!==r?(i={parent:r,cache:r},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),vi(0,Ri,r)):(r=o.cache,vi(0,Ri,r),r!==i.cache&&wi(t,[Ri],n,!0))),Pa(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function Ja(e){e.flags|=4}function Qa(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Uh(t)){if(null!==(t=ia.current)&&((4194048&oc)===oc?null!==oa:(62914560&oc)!==oc&&0===(536870912&oc)||t!==oa))throw Ji=Xi,Wi;e.flags|=8192}}function el(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Se():536870912,e.lanes|=t,_c|=t)}function tl(e,t){if(!oi)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function nl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function rl(e,t,n){var r=t.pendingProps;switch(ni(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nl(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),xi(Ri),q(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(di(t)?Ja(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,pi())),nl(t),null;case 26:return n=t.memoizedState,null===e?(Ja(t),null!==n?(nl(t),Qa(t,n)):(nl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Ja(t),nl(t),Qa(t,n)):(nl(t),t.flags&=-16777217):(e.memoizedProps!==r&&Ja(t),nl(t),t.flags&=-16777217),null;case 27:Z(t),n=H.current;var i=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Ja(t);else{if(!r){if(null===t.stateNode)throw Error(s(166));return nl(t),null}e=V.current,di(t)?ui(t):(e=xh(i,r,n),t.stateNode=e,Ja(t))}return nl(t),null;case 5:if(Z(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Ja(t);else{if(!r){if(null===t.stateNode)throw Error(s(166));return nl(t),null}if(e=V.current,di(t))ui(t);else{switch(i=rh(H.current),e){case 1:e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=i.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof r.is?i.createElement("select",{is:r.is}):i.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"===typeof r.is?i.createElement(n,{is:r.is}):i.createElement(n)}}e[Re]=t,e[Oe]=r;e:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;null===i.sibling;){if(null===i.return||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}t.stateNode=e;e:switch(eh(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Ja(t)}}return nl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Ja(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(e=H.current,di(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(i=ri))switch(i.tag){case 27:case 5:r=i.memoizedProps}e[Re]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||Ku(e.nodeValue,n)))||ci(t)}else(e=rh(e).createTextNode(r))[Re]=t,t.stateNode=e}return nl(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=di(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(s(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(s(317));i[Re]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nl(t),i=!1}else i=pi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0;if(!i)return 256&t.flags?(ca(t),t):(ca(t),null)}if(ca(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){i=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(i=r.alternate.memoizedState.cachePool.pool);var o=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(o=r.memoizedState.cachePool.pool),o!==i&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),el(t,t.updateQueue),nl(t),null;case 4:return q(),null===e&&ju(t.stateNode.containerInfo),nl(t),null;case 10:return xi(t.type),nl(t),null;case 19:if(j(ua),null===(i=t.memoizedState))return nl(t),null;if(r=0!==(128&t.flags),null===(o=i.rendering))if(r)tl(i,!1);else{if(0!==dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=ha(e))){for(t.flags|=128,tl(i,!1),e=o.updateQueue,t.updateQueue=e,el(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Br(n,e),n=n.sibling;return U(ua,1&ua.current|2),t.child}e=e.sibling}null!==i.tail&&te()>wc&&(t.flags|=128,r=!0,tl(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ha(o))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,el(t,e),tl(i,!0),null===i.tail&&"hidden"===i.tailMode&&!o.alternate&&!oi)return nl(t),null}else 2*te()-i.renderingStartTime>wc&&536870912!==n&&(t.flags|=128,r=!0,tl(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=i.last)?e.sibling=o:t.child=o,i.last=o)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=te(),t.sibling=null,e=ua.current,U(ua,r?1&e|2:1&e),t):(nl(t),null);case 22:case 23:return ca(t),yo(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(nl(t),6&t.subtreeFlags&&(t.flags|=8192)):nl(t),null!==(n=t.updateQueue)&&el(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&j(Ui),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),xi(Ri),nl(t),null;case 25:case 30:return null}throw Error(s(156,t.tag))}function il(e,t){switch(ni(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return xi(Ri),q(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Z(t),null;case 13:if(ca(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return j(ua),null;case 4:return q(),null;case 10:return xi(t.type),null;case 22:case 23:return ca(t),yo(),null!==e&&j(Ui),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return xi(Ri),null;default:return null}}function ol(e,t){switch(ni(t),t.tag){case 3:xi(Ri),q();break;case 26:case 27:case 5:Z(t);break;case 4:q();break;case 13:ca(t);break;case 19:j(ua);break;case 10:xi(t.type);break;case 22:case 23:ca(t),yo(),null!==e&&j(Ui);break;case 24:xi(Ri)}}function sl(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var o=n.create,s=n.inst;r=o(),s.destroy=r}n=n.next}while(n!==i)}}catch(a){uu(t,t.return,a)}}function al(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var o=i.next;r=o;do{if((r.tag&e)===e){var s=r.inst,a=s.destroy;if(void 0!==a){s.destroy=void 0,i=t;var l=n,c=a;try{c()}catch(u){uu(i,l,u)}}}r=r.next}while(r!==o)}}catch(u){uu(t,t.return,u)}}function ll(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{fo(t,n)}catch(r){uu(e,e.return,r)}}}function cl(e,t,n){n.props=ga(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){uu(e,t,r)}}function ul(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(i){uu(e,t,i)}}function hl(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(i){uu(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(o){uu(e,t,o)}else n.current=null}function dl(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(i){uu(e,e.return,i)}}function fl(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,o=null,a=null,l=null,c=null,u=null,h=null;for(p in n){var d=n[p];if(n.hasOwnProperty(p)&&null!=d)switch(p){case"checked":case"value":break;case"defaultValue":c=d;default:r.hasOwnProperty(p)||Ju(e,t,p,null,r,d)}}for(var f in r){var p=r[f];if(d=n[f],r.hasOwnProperty(f)&&(null!=p||null!=d))switch(f){case"type":o=p;break;case"name":i=p;break;case"checked":u=p;break;case"defaultChecked":h=p;break;case"value":a=p;break;case"defaultValue":l=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(s(137,t));break;default:p!==d&&Ju(e,t,f,p,r,d)}}return void gt(e,a,l,c,u,h,o,i);case"select":for(o in p=a=l=f=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":p=c;default:r.hasOwnProperty(o)||Ju(e,t,o,null,r,c)}for(i in r)if(o=r[i],c=n[i],r.hasOwnProperty(i)&&(null!=o||null!=c))switch(i){case"value":f=o;break;case"defaultValue":l=o;break;case"multiple":a=o;default:o!==c&&Ju(e,t,i,o,r,c)}return t=l,n=a,r=p,void(null!=f?vt(e,!!n,f,!1):!!r!==!!n&&(null!=t?vt(e,!!n,t,!0):vt(e,!!n,n?[]:"",!1)));case"textarea":for(l in p=f=null,n)if(i=n[l],n.hasOwnProperty(l)&&null!=i&&!r.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Ju(e,t,l,null,r,i)}for(a in r)if(i=r[a],o=n[a],r.hasOwnProperty(a)&&(null!=i||null!=o))switch(a){case"value":f=i;break;case"defaultValue":p=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(s(91));break;default:i!==o&&Ju(e,t,a,i,r,o)}return void xt(e,f,p);case"option":for(var m in n)if(f=n[m],n.hasOwnProperty(m)&&null!=f&&!r.hasOwnProperty(m))if("selected"===m)e.selected=!1;else Ju(e,t,m,null,r,f);for(c in r)if(f=r[c],p=n[c],r.hasOwnProperty(c)&&f!==p&&(null!=f||null!=p))if("selected"===c)e.selected=f&&"function"!==typeof f&&"symbol"!==typeof f;else Ju(e,t,c,f,r,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)f=n[g],n.hasOwnProperty(g)&&null!=f&&!r.hasOwnProperty(g)&&Ju(e,t,g,null,r,f);for(u in r)if(f=r[u],p=n[u],r.hasOwnProperty(u)&&f!==p&&(null!=f||null!=p))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(s(137,t));break;default:Ju(e,t,u,f,r,p)}return;default:if(At(t)){for(var _ in n)f=n[_],n.hasOwnProperty(_)&&void 0!==f&&!r.hasOwnProperty(_)&&Qu(e,t,_,void 0,r,f);for(h in r)f=r[h],p=n[h],!r.hasOwnProperty(h)||f===p||void 0===f&&void 0===p||Qu(e,t,h,f,r,p);return}}for(var y in n)f=n[y],n.hasOwnProperty(y)&&null!=f&&!r.hasOwnProperty(y)&&Ju(e,t,y,null,r,f);for(d in r)f=r[d],p=n[d],!r.hasOwnProperty(d)||f===p||null==f&&null==p||Ju(e,t,d,f,r,p)}(r,e.type,n,t),r[Oe]=t}catch(i){uu(e,e.return,i)}}function pl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&fh(e.type)||4===e.tag}function ml(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||pl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&fh(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Yu));else if(4!==r&&(27===r&&fh(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(gl(e,t,n),e=e.sibling;null!==e;)gl(e,t,n),e=e.sibling}function _l(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&fh(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(_l(e,t,n),e=e.sibling;null!==e;)_l(e,t,n),e=e.sibling}function yl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);eh(t,r,n),t[Re]=e,t[Oe]=n}catch(o){uu(e,e.return,o)}}var vl=!1,xl=!1,bl=!1,wl="function"===typeof WeakSet?WeakSet:Set,Sl=null;function El(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:zl(e,n),4&r&&sl(5,n);break;case 1:if(zl(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){uu(n,n.return,s)}else{var i=ga(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(a){uu(n,n.return,a)}}64&r&&ll(n),512&r&&ul(n,n.return);break;case 3:if(zl(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{fo(e,t)}catch(s){uu(n,n.return,s)}}break;case 27:null===t&&4&r&&yl(n);case 26:case 5:zl(e,n),null===t&&4&r&&dl(n),512&r&&ul(n,n.return);break;case 12:zl(e,n);break;case 13:zl(e,n),4&r&&kl(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=pu.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||vl)){t=null!==t&&null!==t.memoizedState||xl,i=vl;var o=xl;vl=r,(xl=t)&&!o?Bl(e,n,0!==(8772&n.subtreeFlags)):zl(e,n),vl=i,xl=o}break;case 30:break;default:zl(e,n)}}function Tl(e){var t=e.alternate;null!==t&&(e.alternate=null,Tl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&je(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Al=null,Cl=!1;function Pl(e,t,n){for(n=n.child;null!==n;)Il(e,t,n),n=n.sibling}function Il(e,t,n){if(he&&"function"===typeof he.onCommitFiberUnmount)try{he.onCommitFiberUnmount(ue,n)}catch(o){}switch(n.tag){case 26:xl||hl(n,t),Pl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:xl||hl(n,t);var r=Al,i=Cl;fh(n.type)&&(Al=n.stateNode,Cl=!1),Pl(e,t,n),bh(n.stateNode),Al=r,Cl=i;break;case 5:xl||hl(n,t);case 6:if(r=Al,i=Cl,Al=null,Pl(e,t,n),Cl=i,null!==(Al=r))if(Cl)try{(9===Al.nodeType?Al.body:"HTML"===Al.nodeName?Al.ownerDocument.body:Al).removeChild(n.stateNode)}catch(s){uu(n,t,s)}else try{Al.removeChild(n.stateNode)}catch(s){uu(n,t,s)}break;case 18:null!==Al&&(Cl?(ph(9===(e=Al).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Cd(e)):ph(Al,n.stateNode));break;case 4:r=Al,i=Cl,Al=n.stateNode.containerInfo,Cl=!0,Pl(e,t,n),Al=r,Cl=i;break;case 0:case 11:case 14:case 15:xl||al(2,n,t),xl||al(4,n,t),Pl(e,t,n);break;case 1:xl||(hl(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&cl(n,t,r)),Pl(e,t,n);break;case 21:Pl(e,t,n);break;case 22:xl=(r=xl)||null!==n.memoizedState,Pl(e,t,n),xl=r;break;default:Pl(e,t,n)}}function kl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Cd(e)}catch(n){uu(t,t.return,n)}}function Ml(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new wl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new wl),t;default:throw Error(s(435,e.tag))}}(e);t.forEach(function(t){var r=mu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function Rl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r],o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 27:if(fh(l.type)){Al=l.stateNode,Cl=!1;break e}break;case 5:Al=l.stateNode,Cl=!1;break e;case 3:case 4:Al=l.stateNode.containerInfo,Cl=!0;break e}l=l.return}if(null===Al)throw Error(s(160));Il(o,a,i),Al=null,Cl=!1,null!==(o=i.alternate)&&(o.return=null),i.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Ll(t,e),t=t.sibling}var Ol=null;function Ll(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Rl(t,e),Dl(e),4&r&&(al(3,e,e.return),sl(3,e),al(5,e,e.return));break;case 1:Rl(t,e),Dl(e),512&r&&(xl||null===n||hl(n,n.return)),64&r&&vl&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var i=Ol;if(Rl(t,e),Dl(e),512&r&&(xl||null===n||hl(n,n.return)),4&r){var o=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,i=i.ownerDocument||i;t:switch(r){case"title":(!(o=i.getElementsByTagName("title")[0])||o[Be]||o[Re]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=i.createElement(r),i.head.insertBefore(o,i.querySelector("head > title"))),eh(o,r,n),o[Re]=e,$e(o),r=o;break e;case"link":var a=Bh("link","href",i).get(r+(n.href||""));if(a)for(var l=0;l<a.length;l++)if((o=a[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){a.splice(l,1);break t}eh(o=i.createElement(r),r,n),i.head.appendChild(o);break;case"meta":if(a=Bh("meta","content",i).get(r+(n.content||"")))for(l=0;l<a.length;l++)if((o=a[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){a.splice(l,1);break t}eh(o=i.createElement(r),r,n),i.head.appendChild(o);break;default:throw Error(s(468,r))}o[Re]=e,$e(o),r=o}e.stateNode=r}else jh(i,e.type,e.stateNode);else e.stateNode=Lh(i,r,e.memoizedProps);else o!==r?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===r?jh(i,e.type,e.stateNode):Lh(i,r,e.memoizedProps)):null===r&&null!==e.stateNode&&fl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Rl(t,e),Dl(e),512&r&&(xl||null===n||hl(n,n.return)),null!==n&&4&r&&fl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Rl(t,e),Dl(e),512&r&&(xl||null===n||hl(n,n.return)),32&e.flags){i=e.stateNode;try{wt(i,"")}catch(p){uu(e,e.return,p)}}4&r&&null!=e.stateNode&&fl(e,i=e.memoizedProps,null!==n?n.memoizedProps:i),1024&r&&(bl=!0);break;case 6:if(Rl(t,e),Dl(e),4&r){if(null===e.stateNode)throw Error(s(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(p){uu(e,e.return,p)}}break;case 3:if(Fh=null,i=Ol,Ol=Eh(t.containerInfo),Rl(t,e),Ol=i,Dl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Cd(t.containerInfo)}catch(p){uu(e,e.return,p)}bl&&(bl=!1,Nl(e));break;case 4:r=Ol,Ol=Eh(e.stateNode.containerInfo),Rl(t,e),Dl(e),Ol=r;break;case 12:default:Rl(t,e),Dl(e);break;case 13:Rl(t,e),Dl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(bc=te()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Ml(e,r)));break;case 22:i=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=vl,h=xl;if(vl=u||i,xl=h||c,Rl(t,e),xl=h,vl=u,Dl(e),8192&r)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===n||c||vl||xl||Fl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(o=c.stateNode,i)"function"===typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var d=c.memoizedProps.style,f=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(p){uu(c,c.return,p)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(p){uu(c,c.return,p)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,Ml(e,n))));break;case 19:Rl(t,e),Dl(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Ml(e,r)));case 30:case 21:}}function Dl(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(pl(r)){n=r;break}r=r.return}if(null==n)throw Error(s(160));switch(n.tag){case 27:var i=n.stateNode;_l(e,ml(e),i);break;case 5:var o=n.stateNode;32&n.flags&&(wt(o,""),n.flags&=-33),_l(e,ml(e),o);break;case 3:case 4:var a=n.stateNode.containerInfo;gl(e,ml(e),a);break;default:throw Error(s(161))}}catch(l){uu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Nl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Nl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function zl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)El(e,t.alternate,t),t=t.sibling}function Fl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:al(4,t,t.return),Fl(t);break;case 1:hl(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&cl(t,t.return,n),Fl(t);break;case 27:bh(t.stateNode);case 26:case 5:hl(t,t.return),Fl(t);break;case 22:null===t.memoizedState&&Fl(t);break;default:Fl(t)}e=e.sibling}}function Bl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,o=t,s=o.flags;switch(o.tag){case 0:case 11:case 15:Bl(i,o,n),sl(4,o);break;case 1:if(Bl(i,o,n),"function"===typeof(i=(r=o).stateNode).componentDidMount)try{i.componentDidMount()}catch(c){uu(r,r.return,c)}if(null!==(i=(r=o).updateQueue)){var a=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)ho(l[i],a)}catch(c){uu(r,r.return,c)}}n&&64&s&&ll(o),ul(o,o.return);break;case 27:yl(o);case 26:case 5:Bl(i,o,n),n&&null===r&&4&s&&dl(o),ul(o,o.return);break;case 12:Bl(i,o,n);break;case 13:Bl(i,o,n),n&&4&s&&kl(i,o);break;case 22:null===o.memoizedState&&Bl(i,o,n),ul(o,o.return);break;case 30:break;default:Bl(i,o,n)}t=t.sibling}}function jl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Li(n))}function Ul(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Li(e))}function Vl(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Gl(e,t,n,r),t=t.sibling}function Gl(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:Vl(e,t,n,r),2048&i&&sl(9,t);break;case 1:case 13:default:Vl(e,t,n,r);break;case 3:Vl(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Li(e)));break;case 12:if(2048&i){Vl(e,t,n,r),e=t.stateNode;try{var o=t.memoizedProps,s=o.id,a=o.onPostCommit;"function"===typeof a&&a(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){uu(t,t.return,l)}}else Vl(e,t,n,r);break;case 23:break;case 22:o=t.stateNode,s=t.alternate,null!==t.memoizedState?2&o._visibility?Vl(e,t,n,r):$l(e,t):2&o._visibility?Vl(e,t,n,r):(o._visibility|=2,Hl(e,t,n,r,0!==(10256&t.subtreeFlags))),2048&i&&jl(s,t);break;case 24:Vl(e,t,n,r),2048&i&&Ul(t.alternate,t)}}function Hl(e,t,n,r,i){for(i=i&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var o=e,s=t,a=n,l=r,c=s.flags;switch(s.tag){case 0:case 11:case 15:Hl(o,s,a,l,i),sl(8,s);break;case 23:break;case 22:var u=s.stateNode;null!==s.memoizedState?2&u._visibility?Hl(o,s,a,l,i):$l(o,s):(u._visibility|=2,Hl(o,s,a,l,i)),i&&2048&c&&jl(s.alternate,s);break;case 24:Hl(o,s,a,l,i),i&&2048&c&&Ul(s.alternate,s);break;default:Hl(o,s,a,l,i)}t=t.sibling}}function $l(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:$l(n,r),2048&i&&jl(r.alternate,r);break;case 24:$l(n,r),2048&i&&Ul(r.alternate,r);break;default:$l(n,r)}t=t.sibling}}var Wl=8192;function ql(e){if(e.subtreeFlags&Wl)for(e=e.child;null!==e;)Xl(e),e=e.sibling}function Xl(e){switch(e.tag){case 26:ql(e),e.flags&Wl&&null!==e.memoizedState&&function(e,t,n){if(null===Vh)throw Error(s(475));var r=Vh;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var i=Ih(n.href),o=e.querySelector(kh(i));if(o)return null!==(e=o._p)&&"object"===typeof e&&"function"===typeof e.then&&(r.count++,r=Hh.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=o,void $e(o);o=e.ownerDocument||e,n=Mh(n),(i=wh.get(i))&&Nh(n,i),$e(o=o.createElement("link"));var a=o;a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),eh(o,"link",n),t.instance=o}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(r.count++,t=Hh.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(Ol,e.memoizedState,e.memoizedProps);break;case 5:default:ql(e);break;case 3:case 4:var t=Ol;Ol=Eh(e.stateNode.containerInfo),ql(e),Ol=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Wl,Wl=16777216,ql(e),Wl=t):ql(e))}}function Zl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Kl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Sl=r,Ql(r,e)}Zl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Yl(e),e=e.sibling}function Yl(e){switch(e.tag){case 0:case 11:case 15:Kl(e),2048&e.flags&&al(9,e,e.return);break;case 3:case 12:default:Kl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Jl(e)):Kl(e)}}function Jl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Sl=r,Ql(r,e)}Zl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:al(8,t,t.return),Jl(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Jl(t));break;default:Jl(t)}e=e.sibling}}function Ql(e,t){for(;null!==Sl;){var n=Sl;switch(n.tag){case 0:case 11:case 15:al(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Li(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Sl=r;else e:for(n=e;null!==Sl;){var i=(r=Sl).sibling,o=r.return;if(Tl(r),r===n){Sl=null;break e}if(null!==i){i.return=o,Sl=i;break e}Sl=o}}}var ec={getCacheForType:function(e){var t=Ai(Ri),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tc="function"===typeof WeakMap?WeakMap:Map,nc=0,rc=null,ic=null,oc=0,sc=0,ac=null,lc=!1,cc=!1,uc=!1,hc=0,dc=0,fc=0,pc=0,mc=0,gc=0,_c=0,yc=null,vc=null,xc=!1,bc=0,wc=1/0,Sc=null,Ec=null,Tc=0,Ac=null,Cc=null,Pc=0,Ic=0,kc=null,Mc=null,Rc=0,Oc=null;function Lc(){if(0!==(2&nc)&&0!==oc)return oc&-oc;if(null!==L.T){return 0!==zi?zi:Iu()}return ke()}function Dc(){0===gc&&(gc=0===(536870912&oc)||oi?we():536870912);var e=ia.current;return null!==e&&(e.flags|=32),gc}function Nc(e,t,n){(e!==rc||2!==sc&&9!==sc)&&null===e.cancelPendingCommit||(Gc(e,0),jc(e,oc,gc,!1)),Te(e,n),0!==(2&nc)&&e===rc||(e===rc&&(0===(2&nc)&&(pc|=n),4===dc&&jc(e,oc,gc,!1)),wu(e))}function zc(e,t,n){if(0!==(6&nc))throw Error(s(327));for(var r=!n&&0===(124&t)&&0===(t&e.expiredLanes)||xe(e,t),i=r?function(e,t){var n=nc;nc|=2;var r=$c(),i=Wc();rc!==e||oc!==t?(Sc=null,wc=te()+500,Gc(e,t)):cc=xe(e,t);e:for(;;)try{if(0!==sc&&null!==ic){t=ic;var o=ac;t:switch(sc){case 1:sc=0,ac=null,Qc(e,t,o,1);break;case 2:case 9:if(Zi(o)){sc=0,ac=null,Jc(t);break}t=function(){2!==sc&&9!==sc||rc!==e||(sc=7),wu(e)},o.then(t,t);break e;case 3:sc=7;break e;case 4:sc=5;break e;case 7:Zi(o)?(sc=0,ac=null,Jc(t)):(sc=0,ac=null,Qc(e,t,o,7));break;case 5:var a=null;switch(ic.tag){case 26:a=ic.memoizedState;case 5:case 27:var l=ic;if(!a||Uh(a)){sc=0,ac=null;var c=l.sibling;if(null!==c)ic=c;else{var u=l.return;null!==u?(ic=u,eu(u)):ic=null}break t}}sc=0,ac=null,Qc(e,t,o,5);break;case 6:sc=0,ac=null,Qc(e,t,o,6);break;case 8:Vc(),dc=6;break e;default:throw Error(s(462))}}Kc();break}catch(h){Hc(e,h)}return yi=_i=null,L.H=r,L.A=i,nc=n,null!==ic?0:(rc=null,oc=0,Pr(),dc)}(e,t):Xc(e,t,!0),o=r;;){if(0===i){cc&&!r&&jc(e,t,0,!1);break}if(n=e.current.alternate,!o||Bc(n)){if(2===i){if(o=t,e.errorRecoveryDisabledLanes&o)var a=0;else a=0!==(a=-536870913&e.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){t=a;e:{var l=e;i=yc;var c=l.current.memoizedState.isDehydrated;if(c&&(Gc(l,a).flags|=256),2!==(a=Xc(l,a,!1))){if(uc&&!c){l.errorRecoveryDisabledLanes|=o,pc|=o,i=4;break e}o=vc,vc=i,null!==o&&(null===vc?vc=o:vc.push.apply(vc,o))}i=a}if(o=!1,2!==i)continue}}if(1===i){Gc(e,0),jc(e,t,0,!0);break}e:{switch(r=e,o=i){case 0:case 1:throw Error(s(345));case 4:if((4194048&t)!==t)break;case 6:jc(r,t,gc,!lc);break e;case 2:vc=null;break;case 3:case 5:break;default:throw Error(s(329))}if((62914560&t)===t&&10<(i=bc+300-te())){if(jc(r,t,gc,!lc),0!==ve(r,0,!0))break e;r.timeoutHandle=lh(Fc.bind(null,r,n,vc,Sc,xc,t,gc,pc,_c,lc,o,2,-0,0),i)}else Fc(r,n,vc,Sc,xc,t,gc,pc,_c,lc,o,0,-0,0)}break}i=Xc(e,t,!1),o=!1}wu(e)}function Fc(e,t,n,r,i,o,a,l,c,u,h,d,f,p){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||16785408===(16785408&d))&&(Vh={stylesheets:null,count:0,unsuspend:Gh},Xl(t),null!==(d=function(){if(null===Vh)throw Error(s(475));var e=Vh;return e.stylesheets&&0===e.count&&Wh(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Wh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=d(nu.bind(null,e,t,o,n,r,i,a,l,c,h,1,f,p)),void jc(e,o,a,!u);nu(e,t,o,n,r,i,a,l,c)}function Bc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!Zn(o(),i))return!1}catch(s){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function jc(e,t,n,r){t&=~mc,t&=~pc,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var o=31-fe(i),s=1<<o;r[o]=-1,i&=~s}0!==n&&Ae(e,n,t)}function Uc(){return 0!==(6&nc)||(Su(0,!1),!1)}function Vc(){if(null!==ic){if(0===sc)var e=ic.return;else yi=_i=null,Fo(e=ic),Zs=null,Ks=0,e=ic;for(;null!==e;)ol(e.alternate,e),e=e.return;ic=null}}function Gc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,ch(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Vc(),rc=e,ic=n=Fr(e.current,null),oc=t,sc=0,ac=null,lc=!1,cc=xe(e,t),uc=!1,_c=gc=mc=pc=fc=dc=0,vc=yc=null,xc=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-fe(r),o=1<<i;t|=e[i],r&=~o}return hc=t,Pr(),n}function Hc(e,t){xo=null,L.H=$s,t===$i||t===qi?(t=Qi(),sc=3):t===Wi?(t=Qi(),sc=4):sc=t===Aa?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,ac=t,null===ic&&(dc=1,ba(e,Er(t,e.current)))}function $c(){var e=L.H;return L.H=$s,null===e?$s:e}function Wc(){var e=L.A;return L.A=ec,e}function qc(){dc=4,lc||(4194048&oc)!==oc&&null!==ia.current||(cc=!0),0===(134217727&fc)&&0===(134217727&pc)||null===rc||jc(rc,oc,gc,!1)}function Xc(e,t,n){var r=nc;nc|=2;var i=$c(),o=Wc();rc===e&&oc===t||(Sc=null,Gc(e,t)),t=!1;var s=dc;e:for(;;)try{if(0!==sc&&null!==ic){var a=ic,l=ac;switch(sc){case 8:Vc(),s=6;break e;case 3:case 2:case 9:case 6:null===ia.current&&(t=!0);var c=sc;if(sc=0,ac=null,Qc(e,a,l,c),n&&cc){s=0;break e}break;default:c=sc,sc=0,ac=null,Qc(e,a,l,c)}}Zc(),s=dc;break}catch(u){Hc(e,u)}return t&&e.shellSuspendCounter++,yi=_i=null,nc=r,L.H=i,L.A=o,null===ic&&(rc=null,oc=0,Pr()),s}function Zc(){for(;null!==ic;)Yc(ic)}function Kc(){for(;null!==ic&&!Q();)Yc(ic)}function Yc(e){var t=Ya(e.alternate,e,hc);e.memoizedProps=e.pendingProps,null===t?eu(e):ic=t}function Jc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Na(n,t,t.pendingProps,t.type,void 0,oc);break;case 11:t=Na(n,t,t.pendingProps,t.type.render,t.ref,oc);break;case 5:Fo(t);default:ol(n,t),t=Ya(n,t=ic=Br(t,hc),hc)}e.memoizedProps=e.pendingProps,null===t?eu(e):ic=t}function Qc(e,t,n,r){yi=_i=null,Fo(t),Zs=null,Ks=0;var i=t.return;try{if(function(e,t,n,r,i){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&Si(t,n,i,!0),null!==(n=ia.current)){switch(n.tag){case 13:return null===oa?qc():null===n.alternate&&0===dc&&(dc=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===Xi?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),hu(e,r,i)),!1;case 22:return n.flags|=65536,r===Xi?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),hu(e,r,i)),!1}throw Error(s(435,n.tag))}return hu(e,r,i),qc(),!1}if(oi)return null!==(t=ia.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,r!==li&&mi(Er(e=Error(s(422),{cause:r}),n))):(r!==li&&mi(Er(t=Error(s(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,r=Er(r,n),ao(e,i=Sa(e.stateNode,r,i)),4!==dc&&(dc=2)),!1;var o=Error(s(520),{cause:r});if(o=Er(o,n),null===yc?yc=[o]:yc.push(o),4!==dc&&(dc=2),null===t)return!0;r=Er(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,ao(n,e=Sa(n.stateNode,r,e)),!1;case 1:if(t=n.type,o=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==o&&"function"===typeof o.componentDidCatch&&(null===Ec||!Ec.has(o))))return n.flags|=65536,i&=-i,n.lanes|=i,Ta(i=Ea(i),e,n,r),ao(n,i),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,oc))return dc=1,ba(e,Er(n,e.current)),void(ic=null)}catch(o){if(null!==i)throw ic=i,o;return dc=1,ba(e,Er(n,e.current)),void(ic=null)}32768&t.flags?(oi||1===r?e=!0:cc||0!==(536870912&oc)?e=!1:(lc=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=ia.current)&&13===r.tag&&(r.flags|=16384))),tu(t,e)):eu(t)}function eu(e){var t=e;do{if(0!==(32768&t.flags))return void tu(t,lc);e=t.return;var n=rl(t.alternate,t,hc);if(null!==n)return void(ic=n);if(null!==(t=t.sibling))return void(ic=t);ic=t=e}while(null!==t);0===dc&&(dc=5)}function tu(e,t){do{var n=il(e.alternate,e);if(null!==n)return n.flags&=32767,void(ic=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(ic=e);ic=e=n}while(null!==e);dc=6,ic=null}function nu(e,t,n,r,i,o,a,l,c){e.cancelPendingCommit=null;do{au()}while(0!==Tc);if(0!==(6&nc))throw Error(s(327));if(null!==t){if(t===e.current)throw Error(s(177));if(o=t.lanes|t.childLanes,function(e,t,n,r,i,o){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var a=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var u=31-fe(n),h=1<<u;a[u]=0,l[u]=-1;var d=c[u];if(null!==d)for(c[u]=null,u=0;u<d.length;u++){var f=d[u];null!==f&&(f.lane&=-536870913)}n&=~h}0!==r&&Ae(e,r,0),0!==o&&0===i&&0!==e.tag&&(e.suspendedLanes|=o&~(s&~t))}(e,n,o|=Cr,a,l,c),e===rc&&(ic=rc=null,oc=0),Cc=t,Ac=e,Pc=n,Ic=o,kc=i,Mc=r,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,Y(oe,function(){return lu(),null})):(e.callbackNode=null,e.callbackPriority=0),r=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||r){r=L.T,L.T=null,i=D.p,D.p=2,a=nc,nc|=4;try{!function(e,t){if(e=e.containerInfo,th=nd,tr(e=er(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(g){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(l=a+i),d!==o||0!==r&&3!==d.nodeType||(c=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++u===i&&(l=a),f===o&&++h===r&&(c=a),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nh={focusedElem:e,selectionRange:n},nd=!1,Sl=t;null!==Sl;)if(e=(t=Sl).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,Sl=e;else for(;null!==Sl;){switch(o=(t=Sl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==o){e=void 0,n=t,i=o.memoizedProps,o=o.memoizedState,r=n.stateNode;try{var m=ga(n.type,i,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(m,o),r.__reactInternalSnapshotBeforeUpdate=e}catch(_){uu(n,n.return,_)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))mh(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":mh(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(s(163))}if(null!==(e=t.sibling)){e.return=t.return,Sl=e;break}Sl=t.return}}(e,t)}finally{nc=a,D.p=i,L.T=r}}Tc=1,ru(),iu(),ou()}}function ru(){if(1===Tc){Tc=0;var e=Ac,t=Cc,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=L.T,L.T=null;var r=D.p;D.p=2;var i=nc;nc|=4;try{Ll(t,e);var o=nh,s=er(e.containerInfo),a=o.focusedElem,l=o.selectionRange;if(s!==a&&a&&a.ownerDocument&&Qn(a.ownerDocument.documentElement,a)){if(null!==l&&tr(a)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in a)a.selectionStart=c,a.selectionEnd=Math.min(u,a.value.length);else{var h=a.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var f=d.getSelection(),p=a.textContent.length,m=Math.min(l.start,p),g=void 0===l.end?m:Math.min(l.end,p);!f.extend&&m>g&&(s=g,g=m,m=s);var _=Jn(a,m),y=Jn(a,g);if(_&&y&&(1!==f.rangeCount||f.anchorNode!==_.node||f.anchorOffset!==_.offset||f.focusNode!==y.node||f.focusOffset!==y.offset)){var v=h.createRange();v.setStart(_.node,_.offset),f.removeAllRanges(),m>g?(f.addRange(v),f.extend(y.node,y.offset)):(v.setEnd(y.node,y.offset),f.addRange(v))}}}}for(h=[],f=a;f=f.parentNode;)1===f.nodeType&&h.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"===typeof a.focus&&a.focus(),a=0;a<h.length;a++){var x=h[a];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}nd=!!th,nh=th=null}finally{nc=i,D.p=r,L.T=n}}e.current=t,Tc=2}}function iu(){if(2===Tc){Tc=0;var e=Ac,t=Cc,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=L.T,L.T=null;var r=D.p;D.p=2;var i=nc;nc|=4;try{El(e,t.alternate,t)}finally{nc=i,D.p=r,L.T=n}}Tc=3}}function ou(){if(4===Tc||3===Tc){Tc=0,ee();var e=Ac,t=Cc,n=Pc,r=Mc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Tc=5:(Tc=0,Cc=Ac=null,su(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(Ec=null),Ie(n),t=t.stateNode,he&&"function"===typeof he.onCommitFiberRoot)try{he.onCommitFiberRoot(ue,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==r){t=L.T,i=D.p,D.p=2,L.T=null;try{for(var o=e.onRecoverableError,s=0;s<r.length;s++){var a=r[s];o(a.value,{componentStack:a.stack})}}finally{L.T=t,D.p=i}}0!==(3&Pc)&&au(),wu(e),i=e.pendingLanes,0!==(4194090&n)&&0!==(42&i)?e===Oc?Rc++:(Rc=0,Oc=e):Rc=0,Su(0,!1)}}function su(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Li(t)))}function au(e){return ru(),iu(),ou(),lu()}function lu(){if(5!==Tc)return!1;var e=Ac,t=Ic;Ic=0;var n=Ie(Pc),r=L.T,i=D.p;try{D.p=32>n?32:n,L.T=null,n=kc,kc=null;var o=Ac,a=Pc;if(Tc=0,Cc=Ac=null,Pc=0,0!==(6&nc))throw Error(s(331));var l=nc;if(nc|=4,Yl(o.current),Gl(o,o.current,a,n),nc=l,Su(0,!1),he&&"function"===typeof he.onPostCommitFiberRoot)try{he.onPostCommitFiberRoot(ue,o)}catch(c){}return!0}finally{D.p=i,L.T=r,su(e,t)}}function cu(e,t,n){t=Er(n,t),null!==(e=oo(e,t=Sa(e.stateNode,t,2),2))&&(Te(e,2),wu(e))}function uu(e,t,n){if(3===e.tag)cu(e,e,n);else for(;null!==t;){if(3===t.tag){cu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ec||!Ec.has(r))){e=Er(n,e),null!==(r=oo(t,n=Ea(2),2))&&(Ta(n,r,t,e),Te(r,2),wu(r));break}}t=t.return}}function hu(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new tc;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(uc=!0,i.add(n),e=du.bind(null,e,t,n),t.then(e,e))}function du(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,rc===e&&(oc&n)===n&&(4===dc||3===dc&&(62914560&oc)===oc&&300>te()-bc?0===(2&nc)&&Gc(e,0):mc|=n,_c===oc&&(_c=0)),wu(e)}function fu(e,t){0===t&&(t=Se()),null!==(e=Mr(e,t))&&(Te(e,t),wu(e))}function pu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),fu(e,n)}function mu(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(s(314))}null!==r&&r.delete(t),fu(e,n)}var gu=null,_u=null,yu=!1,vu=!1,xu=!1,bu=0;function wu(e){e!==_u&&null===e.next&&(null===_u?gu=_u=e:_u=_u.next=e),vu=!0,yu||(yu=!0,hh(function(){0!==(6&nc)?Y(re,Eu):Tu()}))}function Su(e,t){if(!xu&&vu){xu=!0;do{for(var n=!1,r=gu;null!==r;){if(!t)if(0!==e){var i=r.pendingLanes;if(0===i)var o=0;else{var s=r.suspendedLanes,a=r.pingedLanes;o=(1<<31-fe(42|e)+1)-1,o=201326741&(o&=i&~(s&~a))?201326741&o|1:o?2|o:0}0!==o&&(n=!0,Pu(r,o))}else o=oc,0===(3&(o=ve(r,r===rc?o:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||xe(r,o)||(n=!0,Pu(r,o));r=r.next}}while(n);xu=!1}}function Eu(){Tu()}function Tu(){vu=yu=!1;var e=0;0!==bu&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ah&&(ah=e,!0);return ah=null,!1}()&&(e=bu),bu=0);for(var t=te(),n=null,r=gu;null!==r;){var i=r.next,o=Au(r,t);0===o?(r.next=null,null===n?gu=i:n.next=i,null===i&&(_u=n)):(n=r,(0!==e||0!==(3&o))&&(vu=!0)),r=i}Su(e,!1)}function Au(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var s=31-fe(o),a=1<<s,l=i[s];-1===l?0!==(a&n)&&0===(a&r)||(i[s]=be(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}if(n=oc,n=ve(e,e===(t=rc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===sc||9===sc)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&J(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||xe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&J(r),Ie(n)){case 2:case 8:n=ie;break;case 32:default:n=oe;break;case 268435456:n=ae}return r=Cu.bind(null,e),n=Y(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&J(r),e.callbackPriority=2,e.callbackNode=null,2}function Cu(e,t){if(0!==Tc&&5!==Tc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(au()&&e.callbackNode!==n)return null;var r=oc;return 0===(r=ve(e,e===rc?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(zc(e,r,t),Au(e,te()),null!=e.callbackNode&&e.callbackNode===n?Cu.bind(null,e):null)}function Pu(e,t){if(au())return null;zc(e,t,!0)}function Iu(){return 0===bu&&(bu=we()),bu}function ku(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:It(""+e)}function Mu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Ru=0;Ru<br.length;Ru++){var Ou=br[Ru];wr(Ou.toLowerCase(),"on"+(Ou[0].toUpperCase()+Ou.slice(1)))}wr(fr,"onAnimationEnd"),wr(pr,"onAnimationIteration"),wr(mr,"onAnimationStart"),wr("dblclick","onDoubleClick"),wr("focusin","onFocus"),wr("focusout","onBlur"),wr(gr,"onTransitionRun"),wr(_r,"onTransitionStart"),wr(yr,"onTransitionCancel"),wr(vr,"onTransitionEnd"),Ze("onMouseEnter",["mouseout","mouseover"]),Ze("onMouseLeave",["mouseout","mouseover"]),Ze("onPointerEnter",["pointerout","pointerover"]),Ze("onPointerLeave",["pointerout","pointerover"]),Xe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xe("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Du=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Lu));function Nu(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;o=a,i.currentTarget=c;try{o(i)}catch(u){_a(u)}i.currentTarget=null,o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;o=a,i.currentTarget=c;try{o(i)}catch(u){_a(u)}i.currentTarget=null,o=l}}}}function zu(e,t){var n=t[De];void 0===n&&(n=t[De]=new Set);var r=e+"__bubble";n.has(r)||(Uu(t,e,2,!1),n.add(r))}function Fu(e,t,n){var r=0;t&&(r|=4),Uu(n,e,r,t)}var Bu="_reactListening"+Math.random().toString(36).slice(2);function ju(e){if(!e[Bu]){e[Bu]=!0,We.forEach(function(t){"selectionchange"!==t&&(Du.has(t)||Fu(t,!1,e),Fu(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bu]||(t[Bu]=!0,Fu("selectionchange",!1,t))}}function Uu(e,t,n,r){switch(cd(t)){case 2:var i=rd;break;case 8:i=id;break;default:i=od}n=i.bind(null,t,n,e),i=void 0,!Bt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Vu(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i)break;if(4===s)for(s=r.return;null!==s;){var c=s.tag;if((3===c||4===c)&&s.stateNode.containerInfo===i)return;s=s.return}for(;null!==a;){if(null===(s=Ue(a)))return;if(5===(c=s.tag)||6===c||26===c||27===c){r=o=s;continue e}a=a.parentNode}}r=r.return}Nt(function(){var r=o,i=Mt(n),s=[];e:{var a=xr.get(e);if(void 0!==a){var c=Qt,u=e;switch(e){case"keypress":if(0===$t(n))break e;case"keydown":case"keyup":c=mn;break;case"focusin":u="focus",c=sn;break;case"focusout":u="blur",c=sn;break;case"beforeblur":case"afterblur":c=sn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=_n;break;case fr:case pr:case mr:c=an;break;case vr:c=yn;break;case"scroll":case"scrollend":c=tn;break;case"wheel":c=vn;break;case"copy":case"cut":case"paste":c=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=gn;break;case"toggle":case"beforetoggle":c=xn}var h=0!==(4&t),d=!h&&("scroll"===e||"scrollend"===e),f=h?null!==a?a+"Capture":null:a;h=[];for(var p,m=r;null!==m;){var g=m;if(p=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===p||null===f||null!=(g=zt(m,f))&&h.push(Gu(m,g,p)),d)break;m=m.return}0<h.length&&(a=new c(a,u,null,n,i),s.push({event:a,listeners:h}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===kt||!(u=n.relatedTarget||n.fromElement)||!Ue(u)&&!u[Le])&&(c||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?Ue(u):null)&&(d=l(u),h=u.tag,u!==d||5!==h&&27!==h&&6!==h)&&(u=null)):(c=null,u=r),c!==u)){if(h=rn,g="onMouseLeave",f="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(h=gn,g="onPointerLeave",f="onPointerEnter",m="pointer"),d=null==c?a:Ge(c),p=null==u?a:Ge(u),(a=new h(g,m+"leave",c,n,i)).target=d,a.relatedTarget=p,g=null,Ue(i)===r&&((h=new h(f,m+"enter",u,n,i)).target=p,h.relatedTarget=d,g=h),d=g,c&&u)e:{for(f=u,m=0,p=h=c;p;p=$u(p))m++;for(p=0,g=f;g;g=$u(g))p++;for(;0<m-p;)h=$u(h),m--;for(;0<p-m;)f=$u(f),p--;for(;m--;){if(h===f||null!==f&&h===f.alternate)break e;h=$u(h),f=$u(f)}h=null}else h=null;null!==c&&Wu(s,a,c,h,!1),null!==u&&null!==d&&Wu(s,d,u,h,!0)}if("select"===(c=(a=r?Ge(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var _=Fn;else if(Rn(a))if(Bn)_=Xn;else{_=Wn;var y=$n}else!(c=a.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==a.type&&"radio"!==a.type?r&&At(r.elementType)&&(_=Fn):_=qn;switch(_&&(_=_(e,r))?On(s,_,n,i):(y&&y(e,a,r),"focusout"===e&&r&&"number"===a.type&&null!=r.memoizedProps.value&&yt(a,"number",a.value)),y=r?Ge(r):window,e){case"focusin":(Rn(y)||"true"===y.contentEditable)&&(rr=y,ir=r,or=null);break;case"focusout":or=ir=rr=null;break;case"mousedown":sr=!0;break;case"contextmenu":case"mouseup":case"dragend":sr=!1,ar(s,n,i);break;case"selectionchange":if(nr)break;case"keydown":case"keyup":ar(s,n,i)}var v;if(wn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else kn?Pn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Tn&&"ko"!==n.locale&&(kn||"onCompositionStart"!==x?"onCompositionEnd"===x&&kn&&(v=Ht()):(Vt="value"in(Ut=i)?Ut.value:Ut.textContent,kn=!0)),0<(y=Hu(r,x)).length&&(x=new cn(x,e,null,n,i),s.push({event:x,listeners:y}),v?x.data=v:null!==(v=In(n))&&(x.data=v))),(v=En?function(e,t){switch(e){case"compositionend":return In(t);case"keypress":return 32!==t.which?null:(Cn=!0,An);case"textInput":return(e=t.data)===An&&Cn?null:e;default:return null}}(e,n):function(e,t){if(kn)return"compositionend"===e||!wn&&Pn(e,t)?(e=Ht(),Gt=Vt=Ut=null,kn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Tn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=Hu(r,"onBeforeInput")).length&&(y=new cn("onBeforeInput","beforeinput",null,n,i),s.push({event:y,listeners:x}),y.data=v)),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var o=ku((i[Oe]||null).action),s=r.submitter;s&&null!==(t=(t=s[Oe]||null)?ku(t.formAction):s.getAttribute("formAction"))&&(o=t,s=null);var a=new Qt("action","action",null,r,i);e.push({event:a,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==bu){var e=s?Mu(i,s):new FormData(i);Ms(n,{pending:!0,data:e,method:i.method,action:o},null,e)}}else"function"===typeof o&&(a.preventDefault(),e=s?Mu(i,s):new FormData(i),Ms(n,{pending:!0,data:e,method:i.method,action:o},o,e))},currentTarget:i}]})}}(s,e,r,n,i)}Nu(s,t)})}function Gu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hu(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===o||(null!=(i=zt(e,n))&&r.unshift(Gu(e,i,o)),null!=(i=zt(e,t))&&r.push(Gu(e,i,o))),3===e.tag)return r;e=e.return}return[]}function $u(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Wu(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===r)break;5!==a&&26!==a&&27!==a||null===c||(l=c,i?null!=(c=zt(n,o))&&s.unshift(Gu(n,c,l)):i||null!=(c=zt(n,o))&&s.push(Gu(n,c,l))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var qu=/\r\n?/g,Xu=/\u0000|\uFFFD/g;function Zu(e){return("string"===typeof e?e:""+e).replace(qu,"\n").replace(Xu,"")}function Ku(e,t){return t=Zu(t),Zu(e)===t}function Yu(){}function Ju(e,t,n,r,i,o){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||wt(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&wt(e,""+r);break;case"className":nt(e,"class",r);break;case"tabIndex":nt(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,r);break;case"style":Tt(e,r,o);break;case"data":if("object"!==t){nt(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=It(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof o&&("formAction"===n?("input"!==t&&Ju(e,t,"name",i.name,i,null),Ju(e,t,"formEncType",i.formEncType,i,null),Ju(e,t,"formMethod",i.formMethod,i,null),Ju(e,t,"formTarget",i.formTarget,i,null)):(Ju(e,t,"encType",i.encType,i,null),Ju(e,t,"method",i.method,i,null),Ju(e,t,"target",i.target,i,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=It(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Yu);break;case"onScroll":null!=r&&zu("scroll",e);break;case"onScrollEnd":null!=r&&zu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(s(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(s(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=It(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":zu("beforetoggle",e),zu("toggle",e),tt(e,"popover",r);break;case"xlinkActuate":rt(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":rt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":rt(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":rt(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":rt(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":rt(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":rt(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":rt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":rt(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":tt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=Ct.get(n)||n,r)}}function Qu(e,t,n,r,i,o){switch(n){case"style":Tt(e,r,o);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(s(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(s(60));e.innerHTML=n}}break;case"children":"string"===typeof r?wt(e,r):("number"===typeof r||"bigint"===typeof r)&&wt(e,""+r);break;case"onScroll":null!=r&&zu("scroll",e);break;case"onScrollEnd":null!=r&&zu("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Yu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:qe.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"===typeof(o=null!=(o=e[Oe]||null)?o[n]:null)&&e.removeEventListener(t,o,i),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):tt(e,n,r):("function"!==typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,i)))}}function eh(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":zu("error",e),zu("load",e);var r,i=!1,o=!1;for(r in n)if(n.hasOwnProperty(r)){var a=n[r];if(null!=a)switch(r){case"src":i=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Ju(e,t,r,a,n,null)}}return o&&Ju(e,t,"srcSet",n.srcSet,n,null),void(i&&Ju(e,t,"src",n.src,n,null));case"input":zu("invalid",e);var l=r=a=o=null,c=null,u=null;for(i in n)if(n.hasOwnProperty(i)){var h=n[i];if(null!=h)switch(i){case"name":o=h;break;case"type":a=h;break;case"checked":c=h;break;case"defaultChecked":u=h;break;case"value":r=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(s(137,t));break;default:Ju(e,t,i,h,n,null)}}return _t(e,r,l,c,u,a,o,!1),void ht(e);case"select":for(o in zu("invalid",e),i=a=r=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":r=l;break;case"defaultValue":a=l;break;case"multiple":i=l;default:Ju(e,t,o,l,n,null)}return t=r,n=a,e.multiple=!!i,void(null!=t?vt(e,!!i,t,!1):null!=n&&vt(e,!!i,n,!0));case"textarea":for(a in zu("invalid",e),r=o=i=null,n)if(n.hasOwnProperty(a)&&null!=(l=n[a]))switch(a){case"value":i=l;break;case"defaultValue":o=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(s(91));break;default:Ju(e,t,a,l,n,null)}return bt(e,i,o,r),void ht(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(i=n[c]))if("selected"===c)e.selected=i&&"function"!==typeof i&&"symbol"!==typeof i;else Ju(e,t,c,i,n,null);return;case"dialog":zu("beforetoggle",e),zu("toggle",e),zu("cancel",e),zu("close",e);break;case"iframe":case"object":zu("load",e);break;case"video":case"audio":for(i=0;i<Lu.length;i++)zu(Lu[i],e);break;case"image":zu("error",e),zu("load",e);break;case"details":zu("toggle",e);break;case"embed":case"source":case"link":zu("error",e),zu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(i=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Ju(e,t,u,i,n,null)}return;default:if(At(t)){for(h in n)n.hasOwnProperty(h)&&(void 0!==(i=n[h])&&Qu(e,t,h,i,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(i=n[l])&&Ju(e,t,l,i,n,null))}var th=null,nh=null;function rh(e){return 9===e.nodeType?e:e.ownerDocument}function ih(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function oh(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function sh(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ah=null;var lh="function"===typeof setTimeout?setTimeout:void 0,ch="function"===typeof clearTimeout?clearTimeout:void 0,uh="function"===typeof Promise?Promise:void 0,hh="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof uh?function(e){return uh.resolve(null).then(e).catch(dh)}:lh;function dh(e){setTimeout(function(){throw e})}function fh(e){return"head"===e}function ph(e,t){var n=t,r=0,i=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0<r&&8>r){n=r;var s=e.ownerDocument;if(1&n&&bh(s.documentElement),2&n&&bh(s.body),4&n)for(bh(n=s.head),s=n.firstChild;s;){var a=s.nextSibling,l=s.nodeName;s[Be]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===s.rel.toLowerCase()||n.removeChild(s),s=a}}if(0===i)return e.removeChild(o),void Cd(t);i--}else"$"===n||"$?"===n||"$!"===n?i++:r=n.charCodeAt(0)-48;else r=0;n=o}while(n);Cd(t)}function mh(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":mh(n),je(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function gh(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function _h(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var yh=null;function vh(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function xh(e,t,n){switch(t=rh(n),e){case"html":if(!(e=t.documentElement))throw Error(s(452));return e;case"head":if(!(e=t.head))throw Error(s(453));return e;case"body":if(!(e=t.body))throw Error(s(454));return e;default:throw Error(s(451))}}function bh(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);je(e)}var wh=new Map,Sh=new Set;function Eh(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Th=D.d;D.d={f:function(){var e=Th.f(),t=Uc();return e||t},r:function(e){var t=Ve(e);null!==t&&5===t.tag&&"form"===t.type?Os(t):Th.r(e)},D:function(e){Th.D(e),Ch("dns-prefetch",e,null)},C:function(e,t){Th.C(e,t),Ch("preconnect",e,t)},L:function(e,t,n){Th.L(e,t,n);var r=Ah;if(r&&e&&t){var i='link[rel="preload"][as="'+mt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+mt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(i+='[imagesizes="'+mt(n.imageSizes)+'"]')):i+='[href="'+mt(e)+'"]';var o=i;switch(t){case"style":o=Ih(e);break;case"script":o=Rh(e)}wh.has(o)||(e=d({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),wh.set(o,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(kh(o))||"script"===t&&r.querySelector(Oh(o))||(eh(t=r.createElement("link"),"link",e),$e(t),r.head.appendChild(t)))}},m:function(e,t){Th.m(e,t);var n=Ah;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+mt(r)+'"][href="'+mt(e)+'"]',o=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=Rh(e)}if(!wh.has(o)&&(e=d({rel:"modulepreload",href:e},t),wh.set(o,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Oh(o)))return}eh(r=n.createElement("link"),"link",e),$e(r),n.head.appendChild(r)}}},X:function(e,t){Th.X(e,t);var n=Ah;if(n&&e){var r=He(n).hoistableScripts,i=Rh(e),o=r.get(i);o||((o=n.querySelector(Oh(i)))||(e=d({src:e,async:!0},t),(t=wh.get(i))&&zh(e,t),$e(o=n.createElement("script")),eh(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}},S:function(e,t,n){Th.S(e,t,n);var r=Ah;if(r&&e){var i=He(r).hoistableStyles,o=Ih(e);t=t||"default";var s=i.get(o);if(!s){var a={loading:0,preload:null};if(s=r.querySelector(kh(o)))a.loading=5;else{e=d({rel:"stylesheet",href:e,"data-precedence":t},n),(n=wh.get(o))&&Nh(e,n);var l=s=r.createElement("link");$e(l),eh(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){a.loading|=1}),l.addEventListener("error",function(){a.loading|=2}),a.loading|=4,Dh(s,t,r)}s={type:"stylesheet",instance:s,count:1,state:a},i.set(o,s)}}},M:function(e,t){Th.M(e,t);var n=Ah;if(n&&e){var r=He(n).hoistableScripts,i=Rh(e),o=r.get(i);o||((o=n.querySelector(Oh(i)))||(e=d({src:e,async:!0,type:"module"},t),(t=wh.get(i))&&zh(e,t),$e(o=n.createElement("script")),eh(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}}};var Ah="undefined"===typeof document?null:document;function Ch(e,t,n){var r=Ah;if(r&&"string"===typeof t&&t){var i=mt(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"===typeof n&&(i+='[crossorigin="'+n+'"]'),Sh.has(i)||(Sh.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(eh(t=r.createElement("link"),"link",e),$e(t),r.head.appendChild(t)))}}function Ph(e,t,n,r){var i,o,a,l,c=(c=H.current)?Eh(c):null;if(!c)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Ih(n.href),(r=(n=He(c).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Ih(n.href);var u=He(c).hoistableStyles,h=u.get(e);if(h||(c=c.ownerDocument||c,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,h),(u=c.querySelector(kh(e)))&&!u._p&&(h.instance=u,h.state.loading=5),wh.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},wh.set(e,n),u||(i=c,o=e,a=n,l=h.state,i.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=i.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),eh(o,"link",a),$e(o),i.head.appendChild(o))))),t&&null===r)throw Error(s(528,""));return h}if(t&&null!==r)throw Error(s(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Rh(n),(r=(n=He(c).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function Ih(e){return'href="'+mt(e)+'"'}function kh(e){return'link[rel="stylesheet"]['+e+"]"}function Mh(e){return d({},e,{"data-precedence":e.precedence,precedence:null})}function Rh(e){return'[src="'+mt(e)+'"]'}function Oh(e){return"script[async]"+e}function Lh(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+mt(n.href)+'"]');if(r)return t.instance=r,$e(r),r;var i=d({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return $e(r=(e.ownerDocument||e).createElement("style")),eh(r,"style",i),Dh(r,n.precedence,e),t.instance=r;case"stylesheet":i=Ih(n.href);var o=e.querySelector(kh(i));if(o)return t.state.loading|=4,t.instance=o,$e(o),o;r=Mh(n),(i=wh.get(i))&&Nh(r,i),$e(o=(e.ownerDocument||e).createElement("link"));var a=o;return a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),eh(o,"link",r),t.state.loading|=4,Dh(o,n.precedence,e),t.instance=o;case"script":return o=Rh(n.src),(i=e.querySelector(Oh(o)))?(t.instance=i,$e(i),i):(r=n,(i=wh.get(o))&&zh(r=d({},n),i),$e(i=(e=e.ownerDocument||e).createElement("script")),eh(i,"link",r),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(s(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Dh(r,n.precedence,e));return t.instance}function Dh(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,o=i,s=0;s<r.length;s++){var a=r[s];if(a.dataset.precedence===t)o=a;else if(o!==i)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Nh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function zh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Fh=null;function Bh(e,t,n){if(null===Fh){var r=new Map,i=Fh=new Map;i.set(n,r)}else(r=(i=Fh).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var o=n[i];if(!(o[Be]||o[Re]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var s=o.getAttribute(t)||"";s=e+s;var a=r.get(s);a?a.push(o):r.set(s,[o])}}return r}function jh(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Uh(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Vh=null;function Gh(){}function Hh(){if(this.count--,0===this.count)if(this.stylesheets)Wh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var $h=null;function Wh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,$h=new Map,t.forEach(qh,e),$h=null,Hh.call(e))}function qh(e,t){if(!(4&t.state.loading)){var n=$h.get(e);if(n)var r=n.get(null);else{n=new Map,$h.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<i.length;o++){var s=i[o];"LINK"!==s.nodeName&&"not all"===s.getAttribute("media")||(n.set(s.dataset.precedence,s),r=s)}r&&n.set(null,r)}s=(i=t.instance).getAttribute("data-precedence"),(o=n.get(s)||r)===r&&n.set(null,i),n.set(s,i),this.count++,r=Hh.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),o?o.parentNode.insertBefore(i,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var Xh={$$typeof:b,Provider:null,Consumer:null,_currentValue:N,_currentValue2:N,_threadCount:0};function Zh(e,t,n,r,i,o,s,a){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ee(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ee(0),this.hiddenUpdates=Ee(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=o,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function Kh(e,t,n,r,i,o,s,a,l,c,u,h){return e=new Zh(e,t,n,s,a,l,c,h),t=1,!0===o&&(t|=24),o=Nr(3,null,null,t),e.current=o,o.stateNode=e,(t=Oi()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:r,isDehydrated:n,cache:t},no(o),e}function Yh(e){return e?e=Lr:Lr}function Jh(e,t,n,r,i,o){i=Yh(i),null===r.context?r.context=i:r.pendingContext=i,(r=io(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(r.callback=o),null!==(n=oo(e,r,t))&&(Nc(n,0,t),so(n,e,t))}function Qh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ed(e,t){Qh(e,t),(e=e.alternate)&&Qh(e,t)}function td(e){if(13===e.tag){var t=Mr(e,67108864);null!==t&&Nc(t,0,67108864),ed(e,67108864)}}var nd=!0;function rd(e,t,n,r){var i=L.T;L.T=null;var o=D.p;try{D.p=2,od(e,t,n,r)}finally{D.p=o,L.T=i}}function id(e,t,n,r){var i=L.T;L.T=null;var o=D.p;try{D.p=8,od(e,t,n,r)}finally{D.p=o,L.T=i}}function od(e,t,n,r){if(nd){var i=sd(r);if(null===i)Vu(e,t,r,ad,n),yd(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return hd=vd(hd,e,t,n,r,i),!0;case"dragenter":return dd=vd(dd,e,t,n,r,i),!0;case"mouseover":return fd=vd(fd,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return pd.set(o,vd(pd.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,md.set(o,vd(md.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(yd(e,r),4&t&&-1<_d.indexOf(e)){for(;null!==i;){var o=Ve(i);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var s=ye(o.pendingLanes);if(0!==s){var a=o;for(a.pendingLanes|=2,a.entangledLanes|=2;s;){var l=1<<31-fe(s);a.entanglements[1]|=l,s&=~l}wu(o),0===(6&nc)&&(wc=te()+500,Su(0,!1))}}break;case 13:null!==(a=Mr(o,2))&&Nc(a,0,2),Uc(),ed(o,2)}if(null===(o=sd(r))&&Vu(e,t,r,ad,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Vu(e,t,r,null,n)}}function sd(e){return ld(e=Mt(e))}var ad=null;function ld(e){if(ad=null,null!==(e=Ue(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return ad=e,null}function cd(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case re:return 2;case ie:return 8;case oe:case se:return 32;case ae:return 268435456;default:return 32}default:return 32}}var ud=!1,hd=null,dd=null,fd=null,pd=new Map,md=new Map,gd=[],_d="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yd(e,t){switch(e){case"focusin":case"focusout":hd=null;break;case"dragenter":case"dragleave":dd=null;break;case"mouseover":case"mouseout":fd=null;break;case"pointerover":case"pointerout":pd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":md.delete(t.pointerId)}}function vd(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=Ve(t))&&td(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function xd(e){var t=Ue(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void function(e,t){var n=D.p;try{return D.p=e,t()}finally{D.p=n}}(e.priority,function(){if(13===n.tag){var e=Lc();e=Pe(e);var t=Mr(n,e);null!==t&&Nc(t,0,e),ed(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function bd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=sd(e.nativeEvent);if(null!==n)return null!==(t=Ve(n))&&td(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);kt=r,n.target.dispatchEvent(r),kt=null,t.shift()}return!0}function wd(e,t,n){bd(e)&&n.delete(t)}function Sd(){ud=!1,null!==hd&&bd(hd)&&(hd=null),null!==dd&&bd(dd)&&(dd=null),null!==fd&&bd(fd)&&(fd=null),pd.forEach(wd),md.forEach(wd)}function Ed(e,t){e.blockedOn===t&&(e.blockedOn=null,ud||(ud=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Sd)))}var Td=null;function Ad(e){Td!==e&&(Td=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Td===e&&(Td=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if("function"!==typeof r){if(null===ld(r||n))continue;break}var o=Ve(n);null!==o&&(e.splice(t,3),t-=3,Ms(o,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function Cd(e){function t(t){return Ed(t,e)}null!==hd&&Ed(hd,e),null!==dd&&Ed(dd,e),null!==fd&&Ed(fd,e),pd.forEach(t),md.forEach(t);for(var n=0;n<gd.length;n++){var r=gd[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<gd.length&&null===(n=gd[0]).blockedOn;)xd(n),null===n.blockedOn&&gd.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],s=i[Oe]||null;if("function"===typeof o)s||Ad(n);else if(s){var a=null;if(o&&o.hasAttribute("formAction")){if(i=o,s=o[Oe]||null)a=s.formAction;else if(null!==ld(i))continue}else a=s.action;"function"===typeof a?n[r+1]=a:(n.splice(r,3),r-=3),Ad(n)}}}function Pd(e){this._internalRoot=e}function Id(e){this._internalRoot=e}Id.prototype.render=Pd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Jh(t.current,Lc(),e,t,null,null)},Id.prototype.unmount=Pd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Jh(e.current,2,null,e,null,null),Uc(),t[Le]=null}},Id.prototype.unstable_scheduleHydration=function(e){if(e){var t=ke();e={blockedOn:null,target:e,priority:t};for(var n=0;n<gd.length&&0!==t&&t<gd[n].priority;n++);gd.splice(n,0,e),0===n&&xd(e)}};var kd=i.version;if("19.1.1"!==kd)throw Error(s(527,kd,"19.1.1"));D.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return u(i),e;if(o===r)return u(i),t;o=o.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,c=i.child;c;){if(c===n){a=!0,n=i,r=o;break}if(c===r){a=!0,r=i,n=o;break}c=c.sibling}if(!a){for(c=o.child;c;){if(c===n){a=!0,n=o,r=i;break}if(c===r){a=!0,r=o,n=i;break}c=c.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?h(e):null)?null:e.stateNode};var Md={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.1.1"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Rd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rd.isDisabled&&Rd.supportsFiber)try{ue=Rd.inject(Md),he=Rd}catch(Ld){}}t.createRoot=function(e,t){if(!a(e))throw Error(s(299));var n=!1,r="",i=ya,o=va,l=xa;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Kh(e,1,!1,null,0,n,r,i,o,l,0,null),e[Le]=t.current,ju(e),new Pd(t)},t.hydrateRoot=function(e,t,n){if(!a(e))throw Error(s(299));var r=!1,i="",o=ya,l=va,c=xa,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onUncaughtError&&(o=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=Kh(e,1,!0,t,0,r,i,o,l,c,0,u)).context=Yh(null),n=t.current,(i=io(r=Pe(r=Lc()))).callback=null,oo(n,i,r),n=r,t.current.lanes=n,Te(t,n),wu(t),e[Le]=t.current,ju(e),new Id(t)},t.version="19.1.1"},7043:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(2777),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;t.isKey=function(e,t){return!Array.isArray(e)&&(!("number"!==typeof e&&"boolean"!==typeof e&&null!=e&&!r.isSymbol(e))||("string"===typeof e&&(o.test(e)||!i.test(e))||null!=t&&Object.hasOwn(t,e)))}},7061:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(9749),function(){var e=t,n=e.lib.Hasher,r=e.x64,i=r.Word,o=r.WordArray,s=e.algo;function a(){return i.create.apply(i,arguments)}var l=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],c=[];!function(){for(var e=0;e<80;e++)c[e]=a()}();var u=s.SHA512=n.extend({_doReset:function(){this._hash=new o.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],u=n[5],h=n[6],d=n[7],f=r.high,p=r.low,m=i.high,g=i.low,_=o.high,y=o.low,v=s.high,x=s.low,b=a.high,w=a.low,S=u.high,E=u.low,T=h.high,A=h.low,C=d.high,P=d.low,I=f,k=p,M=m,R=g,O=_,L=y,D=v,N=x,z=b,F=w,B=S,j=E,U=T,V=A,G=C,H=P,$=0;$<80;$++){var W,q,X=c[$];if($<16)q=X.high=0|e[t+2*$],W=X.low=0|e[t+2*$+1];else{var Z=c[$-15],K=Z.high,Y=Z.low,J=(K>>>1|Y<<31)^(K>>>8|Y<<24)^K>>>7,Q=(Y>>>1|K<<31)^(Y>>>8|K<<24)^(Y>>>7|K<<25),ee=c[$-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ie=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),oe=c[$-7],se=oe.high,ae=oe.low,le=c[$-16],ce=le.high,ue=le.low;q=(q=(q=J+se+((W=Q+ae)>>>0<Q>>>0?1:0))+re+((W+=ie)>>>0<ie>>>0?1:0))+ce+((W+=ue)>>>0<ue>>>0?1:0),X.high=q,X.low=W}var he,de=z&B^~z&U,fe=F&j^~F&V,pe=I&M^I&O^M&O,me=k&R^k&L^R&L,ge=(I>>>28|k<<4)^(I<<30|k>>>2)^(I<<25|k>>>7),_e=(k>>>28|I<<4)^(k<<30|I>>>2)^(k<<25|I>>>7),ye=(z>>>14|F<<18)^(z>>>18|F<<14)^(z<<23|F>>>9),ve=(F>>>14|z<<18)^(F>>>18|z<<14)^(F<<23|z>>>9),xe=l[$],be=xe.high,we=xe.low,Se=G+ye+((he=H+ve)>>>0<H>>>0?1:0),Ee=_e+me;G=U,H=V,U=B,V=j,B=z,j=F,z=D+(Se=(Se=(Se=Se+de+((he+=fe)>>>0<fe>>>0?1:0))+be+((he+=we)>>>0<we>>>0?1:0))+q+((he+=W)>>>0<W>>>0?1:0))+((F=N+he|0)>>>0<N>>>0?1:0)|0,D=O,N=L,O=M,L=R,M=I,R=k,I=Se+(ge+pe+(Ee>>>0<_e>>>0?1:0))+((k=he+Ee|0)>>>0<he>>>0?1:0)|0}p=r.low=p+k,r.high=f+I+(p>>>0<k>>>0?1:0),g=i.low=g+R,i.high=m+M+(g>>>0<R>>>0?1:0),y=o.low=y+L,o.high=_+O+(y>>>0<L>>>0?1:0),x=s.low=x+N,s.high=v+D+(x>>>0<N>>>0?1:0),w=a.low=w+F,a.high=b+z+(w>>>0<F>>>0?1:0),E=u.low=E+j,u.high=S+B+(E>>>0<j>>>0?1:0),A=h.low=A+V,h.high=T+U+(A>>>0<V>>>0?1:0),P=d.low=P+H,d.high=C+G+(P>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=n._createHelper(u),e.HmacSHA512=n._createHmacHelper(u)}(),t.SHA512)}()},7231:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(3799),i=n(4879);t.range=function(e,t,n){n&&"number"!==typeof n&&r.isIterateeCall(e,t,n)&&(t=n=void 0),e=i.toFinite(e),void 0===t?(t=e,e=0):t=i.toFinite(t),n=void 0===n?e<t?1:-1:i.toFinite(n);const o=Math.max(Math.ceil((t-e)/(n||1)),0),s=new Array(o);for(let r=0;r<o;r++)s[r]=e,e+=n;return s}},7237:(e,t,n)=>{"use strict";n(8365)},7260:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isUnsafeProperty=function(e){return"__proto__"===e}},7283:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!==typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,o),!0;case 6:return u.fn.call(u.context,t,r,i,o,s),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[o]=1===c.length?c[0]:c:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},7294:function(e,t,n){"use strict";var r=(this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(n(4222)),i=n(8146);function o(e,t){var n={};return e&&"string"===typeof e?((0,r.default)(e,function(e,r){e&&r&&(n[(0,i.camelCase)(e,t)]=r)}),n):n}o.default=o,e.exports=o},7312:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.flatten=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=[],r=Math.floor(t),i=(e,t)=>{for(let o=0;o<e.length;o++){const s=e[o];Array.isArray(s)&&t<r?i(s,t+1):n.push(s)}};return i(e,0),n}},7330:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(9323);t.property=function(e){return function(t){return r.get(t,e)}}},7423:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib,r=n.WordArray,i=n.Hasher,o=e.algo,s=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),a=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),u=r.create([0,1518500249,1859775393,2400959708,2840853838]),h=r.create([1352829926,1548603684,1836072691,2053994217,0]),d=o.RIPEMD160=i.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o,d,v,x,b,w,S,E,T,A,C,P=this._hash.words,I=u.words,k=h.words,M=s.words,R=a.words,O=l.words,L=c.words;for(w=o=P[0],S=d=P[1],E=v=P[2],T=x=P[3],A=b=P[4],n=0;n<80;n+=1)C=o+e[t+M[n]]|0,C+=n<16?f(d,v,x)+I[0]:n<32?p(d,v,x)+I[1]:n<48?m(d,v,x)+I[2]:n<64?g(d,v,x)+I[3]:_(d,v,x)+I[4],C=(C=y(C|=0,O[n]))+b|0,o=b,b=x,x=y(v,10),v=d,d=C,C=w+e[t+R[n]]|0,C+=n<16?_(S,E,T)+k[0]:n<32?g(S,E,T)+k[1]:n<48?m(S,E,T)+k[2]:n<64?p(S,E,T)+k[3]:f(S,E,T)+k[4],C=(C=y(C|=0,L[n]))+A|0,w=A,A=T,T=y(E,10),E=S,S=C;C=P[1]+v+T|0,P[1]=P[2]+x+A|0,P[2]=P[3]+b+w|0,P[3]=P[4]+o+S|0,P[4]=P[0]+d+E|0,P[0]=C},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,o=i.words,s=0;s<5;s++){var a=o[s];o[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return i},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function f(e,t,n){return e^t^n}function p(e,t,n){return e&t|~e&n}function m(e,t,n){return(e|~t)^n}function g(e,t,n){return e&n|t&~n}function _(e,t,n){return e^(t|~n)}function y(e,t){return e<<t|e>>>32-t}e.RIPEMD160=i._createHelper(d),e.HmacRIPEMD160=i._createHmacHelper(d)}(Math),t.RIPEMD160)}()},7599:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});t.argumentsTag="[object Arguments]",t.arrayBufferTag="[object ArrayBuffer]",t.arrayTag="[object Array]",t.bigInt64ArrayTag="[object BigInt64Array]",t.bigUint64ArrayTag="[object BigUint64Array]",t.booleanTag="[object Boolean]",t.dataViewTag="[object DataView]",t.dateTag="[object Date]",t.errorTag="[object Error]",t.float32ArrayTag="[object Float32Array]",t.float64ArrayTag="[object Float64Array]",t.functionTag="[object Function]",t.int16ArrayTag="[object Int16Array]",t.int32ArrayTag="[object Int32Array]",t.int8ArrayTag="[object Int8Array]",t.mapTag="[object Map]",t.numberTag="[object Number]",t.objectTag="[object Object]",t.regexpTag="[object RegExp]",t.setTag="[object Set]",t.stringTag="[object String]",t.symbolTag="[object Symbol]",t.uint16ArrayTag="[object Uint16Array]",t.uint32ArrayTag="[object Uint32Array]",t.uint8ArrayTag="[object Uint8Array]",t.uint8ClampedArrayTag="[object Uint8ClampedArray]"},7770:(e,t,n)=>{e.exports=n(9323).get},7780:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.BlockCipher,r=e.algo,i=[],o=[],s=[],a=[],l=[],c=[],u=[],h=[],d=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,r=0;for(t=0;t<256;t++){var p=r^r<<1^r<<2^r<<3^r<<4;p=p>>>8^255&p^99,i[n]=p,o[p]=n;var m=e[n],g=e[m],_=e[g],y=257*e[p]^16843008*p;s[n]=y<<24|y>>>8,a[n]=y<<16|y>>>16,l[n]=y<<8|y>>>24,c[n]=y,y=16843009*_^65537*g^257*m^16843008*n,u[p]=y<<24|y>>>8,h[p]=y<<16|y>>>16,d[p]=y<<8|y>>>24,f[p]=y,n?(n=m^e[e[e[_^m]]],r^=e[e[r]]):n=r=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],m=r.AES=n.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=4*((this._nRounds=n+6)+1),o=this._keySchedule=[],s=0;s<r;s++)s<n?o[s]=t[s]:(c=o[s-1],s%n?n>6&&s%n==4&&(c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c]):(c=i[(c=c<<8|c>>>24)>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c],c^=p[s/n|0]<<24),o[s]=o[s-n]^c);for(var a=this._invKeySchedule=[],l=0;l<r;l++){if(s=r-l,l%4)var c=o[s];else c=o[s-4];a[l]=l<4||s<=4?c:u[i[c>>>24]]^h[i[c>>>16&255]]^d[i[c>>>8&255]]^f[i[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,a,l,c,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,h,d,f,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,o,s,a){for(var l=this._nRounds,c=e[t]^n[0],u=e[t+1]^n[1],h=e[t+2]^n[2],d=e[t+3]^n[3],f=4,p=1;p<l;p++){var m=r[c>>>24]^i[u>>>16&255]^o[h>>>8&255]^s[255&d]^n[f++],g=r[u>>>24]^i[h>>>16&255]^o[d>>>8&255]^s[255&c]^n[f++],_=r[h>>>24]^i[d>>>16&255]^o[c>>>8&255]^s[255&u]^n[f++],y=r[d>>>24]^i[c>>>16&255]^o[u>>>8&255]^s[255&h]^n[f++];c=m,u=g,h=_,d=y}m=(a[c>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^n[f++],g=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&c])^n[f++],_=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[c>>>8&255]<<8|a[255&u])^n[f++],y=(a[d>>>24]<<24|a[c>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^n[f++],e[t]=m,e[t+1]=g,e[t+2]=_,e[t+3]=y},keySize:8});e.AES=n._createHelper(m)}(),t.AES)}()},7820:(e,t,n)=>{e.exports=n(5414).throttle},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(6672)},7962:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.CTR=function(){var e=t.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,o=this._counter;i&&(o=this._counter=i.slice(0),this._iv=void 0);var s=o.slice(0);n.encryptBlock(s,0),o[r-1]=o[r-1]+1|0;for(var a=0;a<r;a++)e[t+a]^=s[a]}});return e.Decryptor=n,e}(),t.mode.CTR)}()},8049:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.CTRGladman=function(){var e=t.lib.BlockCipherMode.extend();function n(e){if(255===(e>>24&255)){var t=e>>16&255,n=e>>8&255,r=255&e;255===t?(t=0,255===n?(n=0,255===r?r=0:++r):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=r}else e+=1<<24;return e}function r(e){return 0===(e[0]=n(e[0]))&&(e[1]=n(e[1])),e}var i=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=this._iv,s=this._counter;o&&(s=this._counter=o.slice(0),this._iv=void 0),r(s);var a=s.slice(0);n.encryptBlock(a,0);for(var l=0;l<i;l++)e[t+l]^=a[l]}});return e.Decryptor=i,e}(),t.mode.CTRGladman)}()},8099:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.ECB=function(){var e=t.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),e}(),t.mode.ECB)}()},8146:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.camelCase=void 0;var n=/^--[a-zA-Z0-9_-]+$/,r=/-([a-z])/g,i=/^[^-]+$/,o=/^-(webkit|moz|ms|o|khtml)-/,s=/^-(ms)-/,a=function(e,t){return t.toUpperCase()},l=function(e,t){return"".concat(t,"-")};t.camelCase=function(e,t){return void 0===t&&(t={}),function(e){return!e||i.test(e)||n.test(e)}(e)?e:(e=e.toLowerCase(),(e=t.reactCompat?e.replace(s,l):e.replace(o,l)).replace(r,a))}},8168:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib.WordArray,r=e.enc;function i(e){return e<<8&4278255360|e>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i+=2){var o=t[i>>>2]>>>16-i%4*8&65535;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return n.create(r,2*t)}},r.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o+=2){var s=i(t[o>>>2]>>>16-o%4*8&65535);r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o++)r[o>>>1]|=i(e.charCodeAt(o)<<16-o%2*16);return n.create(r,2*t)}}}(),t.enc.Utf16)}()},8182:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(9330),i=n(4737);t.isEqual=function(e,t){return r.isEqualWith(e,t,i.noop)}},8210:function(e,t,n){var r;!function(){"use strict";var i,o=1e9,s={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},a=!0,l="[DecimalError] ",c=l+"Invalid argument: ",u=l+"Exponent out of range: ",h=Math.floor,d=Math.pow,f=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,p=1e7,m=9007199254740991,g=h(1286742750677284.5),_={};function y(e,t){var n,r,i,o,s,l,c,u,h=e.constructor,d=h.precision;if(!e.s||!t.s)return t.s||(t=new h(e)),a?P(t,d):t;if(c=e.d,u=t.d,s=e.e,i=t.e,c=c.slice(),o=s-i){for(o<0?(r=c,o=-o,l=u.length):(r=u,i=s,l=c.length),o>(l=(s=Math.ceil(d/7))>l?s+1:l+1)&&(o=l,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for((l=c.length)-(o=u.length)<0&&(o=l,r=u,u=c,c=r),n=0;o;)n=(c[--o]=c[o]+u[o]+n)/p|0,c[o]%=p;for(n&&(c.unshift(n),++i),l=c.length;0==c[--l];)c.pop();return t.d=c,t.e=i,a?P(t,d):t}function v(e,t,n){if(e!==~~e||e<t||e>n)throw Error(c+e)}function x(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)(n=7-(r=e[t]+"").length)&&(o+=T(n)),o+=r;(n=7-(r=(s=e[t])+"").length)&&(o+=T(n))}else if(0===s)return"0";for(;s%10===0;)s/=10;return o+s}_.absoluteValue=_.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e},_.comparedTo=_.cmp=function(e){var t,n,r,i,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(t=0,n=(r=o.d.length)<(i=e.d.length)?r:i;t<n;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return r===i?0:r>i^o.s<0?1:-1},_.decimalPlaces=_.dp=function(){var e=this,t=e.d.length-1,n=7*(t-e.e);if(t=e.d[t])for(;t%10==0;t/=10)n--;return n<0?0:n},_.dividedBy=_.div=function(e){return b(this,new this.constructor(e))},_.dividedToIntegerBy=_.idiv=function(e){var t=this.constructor;return P(b(this,new t(e),0,1),t.precision)},_.equals=_.eq=function(e){return!this.cmp(e)},_.exponent=function(){return S(this)},_.greaterThan=_.gt=function(e){return this.cmp(e)>0},_.greaterThanOrEqualTo=_.gte=function(e){return this.cmp(e)>=0},_.isInteger=_.isint=function(){return this.e>this.d.length-2},_.isNegative=_.isneg=function(){return this.s<0},_.isPositive=_.ispos=function(){return this.s>0},_.isZero=function(){return 0===this.s},_.lessThan=_.lt=function(e){return this.cmp(e)<0},_.lessThanOrEqualTo=_.lte=function(e){return this.cmp(e)<1},_.logarithm=_.log=function(e){var t,n=this,r=n.constructor,o=r.precision,s=o+5;if(void 0===e)e=new r(10);else if((e=new r(e)).s<1||e.eq(i))throw Error(l+"NaN");if(n.s<1)throw Error(l+(n.s?"NaN":"-Infinity"));return n.eq(i)?new r(0):(a=!1,t=b(A(n,s),A(e,s),s),a=!0,P(t,o))},_.minus=_.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?I(t,e):y(t,(e.s=-e.s,e))},_.modulo=_.mod=function(e){var t,n=this,r=n.constructor,i=r.precision;if(!(e=new r(e)).s)throw Error(l+"NaN");return n.s?(a=!1,t=b(n,e,0,1).times(e),a=!0,n.minus(t)):P(new r(n),i)},_.naturalExponential=_.exp=function(){return w(this)},_.naturalLogarithm=_.ln=function(){return A(this)},_.negated=_.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e},_.plus=_.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?y(t,e):I(t,(e.s=-e.s,e))},_.precision=_.sd=function(e){var t,n,r,i=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(c+e);if(t=S(i)+1,n=7*(r=i.d.length-1)+1,r=i.d[r]){for(;r%10==0;r/=10)n--;for(r=i.d[0];r>=10;r/=10)n++}return e&&t>n?t:n},_.squareRoot=_.sqrt=function(){var e,t,n,r,i,o,s,c=this,u=c.constructor;if(c.s<1){if(!c.s)return new u(0);throw Error(l+"NaN")}for(e=S(c),a=!1,0==(i=Math.sqrt(+c))||i==1/0?(((t=x(c.d)).length+e)%2==0&&(t+="0"),i=Math.sqrt(t),e=h((e+1)/2)-(e<0||e%2),r=new u(t=i==1/0?"5e"+e:(t=i.toExponential()).slice(0,t.indexOf("e")+1)+e)):r=new u(i.toString()),i=s=(n=u.precision)+3;;)if(r=(o=r).plus(b(c,o,s+2)).times(.5),x(o.d).slice(0,s)===(t=x(r.d)).slice(0,s)){if(t=t.slice(s-3,s+1),i==s&&"4999"==t){if(P(o,n+1,0),o.times(o).eq(c)){r=o;break}}else if("9999"!=t)break;s+=4}return a=!0,P(r,n)},_.times=_.mul=function(e){var t,n,r,i,o,s,l,c,u,h=this,d=h.constructor,f=h.d,m=(e=new d(e)).d;if(!h.s||!e.s)return new d(0);for(e.s*=h.s,n=h.e+e.e,(c=f.length)<(u=m.length)&&(o=f,f=m,m=o,s=c,c=u,u=s),o=[],r=s=c+u;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,i=c+r;i>r;)l=o[i]+m[r]*f[i-r-1]+t,o[i--]=l%p|0,t=l/p|0;o[i]=(o[i]+t)%p|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=n,a?P(e,d.precision):e},_.toDecimalPlaces=_.todp=function(e,t){var n=this,r=n.constructor;return n=new r(n),void 0===e?n:(v(e,0,o),void 0===t?t=r.rounding:v(t,0,8),P(n,e+S(n)+1,t))},_.toExponential=function(e,t){var n,r=this,i=r.constructor;return void 0===e?n=k(r,!0):(v(e,0,o),void 0===t?t=i.rounding:v(t,0,8),n=k(r=P(new i(r),e+1,t),!0,e+1)),n},_.toFixed=function(e,t){var n,r,i=this,s=i.constructor;return void 0===e?k(i):(v(e,0,o),void 0===t?t=s.rounding:v(t,0,8),n=k((r=P(new s(i),e+S(i)+1,t)).abs(),!1,e+S(r)+1),i.isneg()&&!i.isZero()?"-"+n:n)},_.toInteger=_.toint=function(){var e=this,t=e.constructor;return P(new t(e),S(e)+1,t.rounding)},_.toNumber=function(){return+this},_.toPower=_.pow=function(e){var t,n,r,o,s,c,u=this,d=u.constructor,f=+(e=new d(e));if(!e.s)return new d(i);if(!(u=new d(u)).s){if(e.s<1)throw Error(l+"Infinity");return u}if(u.eq(i))return u;if(r=d.precision,e.eq(i))return P(u,r);if(c=(t=e.e)>=(n=e.d.length-1),s=u.s,c){if((n=f<0?-f:f)<=m){for(o=new d(i),t=Math.ceil(r/7+4),a=!1;n%2&&M((o=o.times(u)).d,t),0!==(n=h(n/2));)M((u=u.times(u)).d,t);return a=!0,e.s<0?new d(i).div(o):P(o,r)}}else if(s<0)throw Error(l+"NaN");return s=s<0&&1&e.d[Math.max(t,n)]?-1:1,u.s=1,a=!1,o=e.times(A(u,r+12)),a=!0,(o=w(o)).s=s,o},_.toPrecision=function(e,t){var n,r,i=this,s=i.constructor;return void 0===e?r=k(i,(n=S(i))<=s.toExpNeg||n>=s.toExpPos):(v(e,1,o),void 0===t?t=s.rounding:v(t,0,8),r=k(i=P(new s(i),e,t),e<=(n=S(i))||n<=s.toExpNeg,e)),r},_.toSignificantDigits=_.tosd=function(e,t){var n=this.constructor;return void 0===e?(e=n.precision,t=n.rounding):(v(e,1,o),void 0===t?t=n.rounding:v(t,0,8)),P(new n(this),e,t)},_.toString=_.valueOf=_.val=_.toJSON=function(){var e=this,t=S(e),n=e.constructor;return k(e,t<=n.toExpNeg||t>=n.toExpPos)};var b=function(){function e(e,t){var n,r=0,i=e.length;for(e=e.slice();i--;)n=e[i]*t+r,e[i]=n%p|0,r=n/p|0;return r&&e.unshift(r),e}function t(e,t,n,r){var i,o;if(n!=r)o=n>r?1:-1;else for(i=o=0;i<n;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function n(e,t,n){for(var r=0;n--;)e[n]-=r,r=e[n]<t[n]?1:0,e[n]=r*p+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(r,i,o,s){var a,c,u,h,d,f,m,g,_,y,v,x,b,w,E,T,A,C,I=r.constructor,k=r.s==i.s?1:-1,M=r.d,R=i.d;if(!r.s)return new I(r);if(!i.s)throw Error(l+"Division by zero");for(c=r.e-i.e,A=R.length,E=M.length,g=(m=new I(k)).d=[],u=0;R[u]==(M[u]||0);)++u;if(R[u]>(M[u]||0)&&--c,(x=null==o?o=I.precision:s?o+(S(r)-S(i))+1:o)<0)return new I(0);if(x=x/7+2|0,u=0,1==A)for(h=0,R=R[0],x++;(u<E||h)&&x--;u++)b=h*p+(M[u]||0),g[u]=b/R|0,h=b%R|0;else{for((h=p/(R[0]+1)|0)>1&&(R=e(R,h),M=e(M,h),A=R.length,E=M.length),w=A,y=(_=M.slice(0,A)).length;y<A;)_[y++]=0;(C=R.slice()).unshift(0),T=R[0],R[1]>=p/2&&++T;do{h=0,(a=t(R,_,A,y))<0?(v=_[0],A!=y&&(v=v*p+(_[1]||0)),(h=v/T|0)>1?(h>=p&&(h=p-1),1==(a=t(d=e(R,h),_,f=d.length,y=_.length))&&(h--,n(d,A<f?C:R,f))):(0==h&&(a=h=1),d=R.slice()),(f=d.length)<y&&d.unshift(0),n(_,d,y),-1==a&&(a=t(R,_,A,y=_.length))<1&&(h++,n(_,A<y?C:R,y)),y=_.length):0===a&&(h++,_=[0]),g[u++]=h,a&&_[0]?_[y++]=M[w]||0:(_=[M[w]],y=1)}while((w++<E||void 0!==_[0])&&x--)}return g[0]||g.shift(),m.e=c,P(m,s?o+S(m)+1:o)}}();function w(e,t){var n,r,o,s,l,c=0,h=0,f=e.constructor,p=f.precision;if(S(e)>16)throw Error(u+S(e));if(!e.s)return new f(i);for(null==t?(a=!1,l=p):l=t,s=new f(.03125);e.abs().gte(.1);)e=e.times(s),h+=5;for(l+=Math.log(d(2,h))/Math.LN10*2+5|0,n=r=o=new f(i),f.precision=l;;){if(r=P(r.times(e),l),n=n.times(++c),x((s=o.plus(b(r,n,l))).d).slice(0,l)===x(o.d).slice(0,l)){for(;h--;)o=P(o.times(o),l);return f.precision=p,null==t?(a=!0,P(o,p)):o}o=s}}function S(e){for(var t=7*e.e,n=e.d[0];n>=10;n/=10)t++;return t}function E(e,t,n){if(t>e.LN10.sd())throw a=!0,n&&(e.precision=n),Error(l+"LN10 precision limit exceeded");return P(new e(e.LN10),t)}function T(e){for(var t="";e--;)t+="0";return t}function A(e,t){var n,r,o,s,c,u,h,d,f,p=1,m=e,g=m.d,_=m.constructor,y=_.precision;if(m.s<1)throw Error(l+(m.s?"NaN":"-Infinity"));if(m.eq(i))return new _(0);if(null==t?(a=!1,d=y):d=t,m.eq(10))return null==t&&(a=!0),E(_,d);if(d+=10,_.precision=d,r=(n=x(g)).charAt(0),s=S(m),!(Math.abs(s)<15e14))return h=E(_,d+2,y).times(s+""),m=A(new _(r+"."+n.slice(1)),d-10).plus(h),_.precision=y,null==t?(a=!0,P(m,y)):m;for(;r<7&&1!=r||1==r&&n.charAt(1)>3;)r=(n=x((m=m.times(e)).d)).charAt(0),p++;for(s=S(m),r>1?(m=new _("0."+n),s++):m=new _(r+"."+n.slice(1)),u=c=m=b(m.minus(i),m.plus(i),d),f=P(m.times(m),d),o=3;;){if(c=P(c.times(f),d),x((h=u.plus(b(c,new _(o),d))).d).slice(0,d)===x(u.d).slice(0,d))return u=u.times(2),0!==s&&(u=u.plus(E(_,d+2,y).times(s+""))),u=b(u,new _(p),d),_.precision=y,null==t?(a=!0,P(u,y)):u;u=h,o+=2}}function C(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;48===t.charCodeAt(r);)++r;for(i=t.length;48===t.charCodeAt(i-1);)--i;if(t=t.slice(r,i)){if(i-=r,n=n-r-1,e.e=h(n/7),e.d=[],r=(n+1)%7,n<0&&(r+=7),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=7;r<i;)e.d.push(+t.slice(r,r+=7));r=7-(t=t.slice(r)).length}else r-=i;for(;r--;)t+="0";if(e.d.push(+t),a&&(e.e>g||e.e<-g))throw Error(u+n)}else e.s=0,e.e=0,e.d=[0];return e}function P(e,t,n){var r,i,o,s,l,c,f,m,_=e.d;for(s=1,o=_[0];o>=10;o/=10)s++;if((r=t-s)<0)r+=7,i=t,f=_[m=0];else{if((m=Math.ceil((r+1)/7))>=(o=_.length))return e;for(f=o=_[m],s=1;o>=10;o/=10)s++;i=(r%=7)-7+s}if(void 0!==n&&(l=f/(o=d(10,s-i-1))%10|0,c=t<0||void 0!==_[m+1]||f%o,c=n<4?(l||c)&&(0==n||n==(e.s<0?3:2)):l>5||5==l&&(4==n||c||6==n&&(r>0?i>0?f/d(10,s-i):0:_[m-1])%10&1||n==(e.s<0?8:7))),t<1||!_[0])return c?(o=S(e),_.length=1,t=t-o-1,_[0]=d(10,(7-t%7)%7),e.e=h(-t/7)||0):(_.length=1,_[0]=e.e=e.s=0),e;if(0==r?(_.length=m,o=1,m--):(_.length=m+1,o=d(10,7-r),_[m]=i>0?(f/d(10,s-i)%d(10,i)|0)*o:0),c)for(;;){if(0==m){(_[0]+=o)==p&&(_[0]=1,++e.e);break}if(_[m]+=o,_[m]!=p)break;_[m--]=0,o=1}for(r=_.length;0===_[--r];)_.pop();if(a&&(e.e>g||e.e<-g))throw Error(u+S(e));return e}function I(e,t){var n,r,i,o,s,l,c,u,h,d,f=e.constructor,m=f.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new f(e),a?P(t,m):t;if(c=e.d,d=t.d,r=t.e,u=e.e,c=c.slice(),s=u-r){for((h=s<0)?(n=c,s=-s,l=d.length):(n=d,r=u,l=c.length),s>(i=Math.max(Math.ceil(m/7),l)+2)&&(s=i,n.length=1),n.reverse(),i=s;i--;)n.push(0);n.reverse()}else{for((h=(i=c.length)<(l=d.length))&&(l=i),i=0;i<l;i++)if(c[i]!=d[i]){h=c[i]<d[i];break}s=0}for(h&&(n=c,c=d,d=n,t.s=-t.s),l=c.length,i=d.length-l;i>0;--i)c[l++]=0;for(i=d.length;i>s;){if(c[--i]<d[i]){for(o=i;o&&0===c[--o];)c[o]=p-1;--c[o],c[i]+=p}c[i]-=d[i]}for(;0===c[--l];)c.pop();for(;0===c[0];c.shift())--r;return c[0]?(t.d=c,t.e=r,a?P(t,m):t):new f(0)}function k(e,t,n){var r,i=S(e),o=x(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+T(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i<0?"e":"e+")+i):i<0?(o="0."+T(-i-1)+o,n&&(r=n-s)>0&&(o+=T(r))):i>=s?(o+=T(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+T(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=T(r))),e.s<0?"-"+o:o}function M(e,t){if(e.length>t)return e.length=t,!0}function R(e){if(!e||"object"!==typeof e)throw Error(l+"Object expected");var t,n,r,i=["precision",1,o,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<i.length;t+=3)if(void 0!==(r=e[n=i[t]])){if(!(h(r)===r&&r>=i[t+1]&&r<=i[t+2]))throw Error(c+n+": "+r);this[n]=r}if(void 0!==(r=e[n="LN10"])){if(r!=Math.LN10)throw Error(c+n+": "+r);this[n]=new this(r)}return this}s=function e(t){var n,r,i;function o(e){var t=this;if(!(t instanceof o))return new o(e);if(t.constructor=o,e instanceof o)return t.s=e.s,t.e=e.e,void(t.d=(e=e.d)?e.slice():e);if("number"===typeof e){if(0*e!==0)throw Error(c+e);if(e>0)t.s=1;else{if(!(e<0))return t.s=0,t.e=0,void(t.d=[0]);e=-e,t.s=-1}return e===~~e&&e<1e7?(t.e=0,void(t.d=[e])):C(t,e.toString())}if("string"!==typeof e)throw Error(c+e);if(45===e.charCodeAt(0)?(e=e.slice(1),t.s=-1):t.s=1,!f.test(e))throw Error(c+e);C(t,e)}if(o.prototype=_,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.clone=e,o.config=o.set=R,void 0===t&&(t={}),t)for(i=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<i.length;)t.hasOwnProperty(r=i[n++])||(t[r]=this[r]);return o.config(t),o}(s),s.default=s.Decimal=s,i=new s(1),void 0===(r=function(){return s}.call(t,n,t,e))||(e.exports=r)}()},8211:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2002),n(4220),function(){var e=t,n=e.lib,r=n.Base,i=n.WordArray,o=e.algo,s=o.MD5,a=o.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,o=r.hasher.create(),s=i.create(),a=s.words,l=r.keySize,c=r.iterations;a.length<l;){n&&o.update(n),n=o.update(e).finalize(t),o.reset();for(var u=1;u<c;u++)n=o.finalize(n),o.reset();s.concat(n)}return s.sigBytes=4*l,s}});e.EvpKDF=function(e,t,n){return a.create(n).compute(e,t)}}(),t.EvpKDF)}()},8268:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(2132);t.isMatch=function(e,t){return r.isMatchWith(e,t,()=>{})}},8346:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toArray=function(e){return Array.isArray(e)?e:Array.from(e)}},8365:(e,t,n)=>{"use strict";var r=n(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=r.useSyncExternalStore,s=r.useRef,a=r.useEffect,l=r.useMemo,c=r.useDebugValue},8396:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(5508);t.cloneDeep=function(e){return r.cloneDeepWith(e)}},8420:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isLength=function(e){return Number.isSafeInteger(e)&&e>=0}},8443:(e,t,n)=>{"use strict";e.exports=n(9717)},8523:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib.WordArray;function r(e,t,r){for(var i=[],o=0,s=0;s<t;s++)if(s%4){var a=r[e.charCodeAt(s-1)]<<s%4*2|r[e.charCodeAt(s)]>>>6-s%4*2;i[o>>>2]|=a<<24-o%4*8,o++}return n.create(i,o)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var l=r.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<n.length;o++)i[n.charCodeAt(o)]=o}var s=n.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return r(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64)}()},8845:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(8268),i=n(3272),o=n(8396),s=n(9323),a=n(5303);t.matchesProperty=function(e,t){switch(typeof e){case"object":Object.is(e?.valueOf(),-0)&&(e="-0");break;case"number":e=i.toKey(e)}return t=o.cloneDeep(t),function(n){const i=s.get(n,e);return void 0===i?a.has(n,e):void 0===t?void 0===i:r.isMatch(i,t)}}},8853:(e,t,n)=>{"use strict";e.exports=n(5896)},8875:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.StreamCipher,r=e.algo,i=[],o=[],s=[],a=r.Rabbit=n.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)l.call(this);for(n=0;n<8;n++)i[n]^=r[n+4&7];if(t){var o=t.words,s=o[0],a=o[1],c=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),h=c>>>16|4294901760&u,d=u<<16|65535&c;for(i[0]^=c,i[1]^=h,i[2]^=u,i[3]^=d,i[4]^=c,i[5]^=h,i[6]^=u,i[7]^=d,n=0;n<4;n++)l.call(this)}},_doProcessBlock:function(e,t){var n=this._X;l.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,n=0;n<8;n++)o[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,n=0;n<8;n++){var r=e[n]+t[n],i=65535&r,a=r>>>16,l=((i*i>>>17)+i*a>>>15)+a*a,c=((4294901760&r)*r|0)+((65535&r)*r|0);s[n]=l^c}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.Rabbit=n._createHelper(a)}(),t.Rabbit)}()},9092:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(9749),n(7061),function(){var e=t,n=e.x64,r=n.Word,i=n.WordArray,o=e.algo,s=o.SHA512,a=o.SHA384=s.extend({_doReset:function(){this._hash=new i.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=s._createHelper(a),e.HmacSHA384=s._createHmacHelper(a)}(),t.SHA384)}()},9132:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.Iso10126={pad:function(e,n){var r=4*n,i=r-e.sigBytes%r;e.concat(t.lib.WordArray.random(i-1)).concat(t.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},t.pad.Iso10126)}()},9323:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(7260),i=n(2489),o=n(3272),s=n(1444);t.get=function e(t,n,a){if(null==t)return a;switch(typeof n){case"string":{if(r.isUnsafeProperty(n))return a;const o=t[n];return void 0===o?i.isDeepKey(n)?e(t,s.toPath(n),a):a:o}case"number":case"symbol":{"number"===typeof n&&(n=o.toKey(n));const e=t[n];return void 0===e?a:e}default:{if(Array.isArray(n))return function(e,t,n){if(0===t.length)return n;let i=e;for(let o=0;o<t.length;o++){if(null==i)return n;if(r.isUnsafeProperty(t[o]))return n;i=i[t[o]]}if(void 0===i)return n;return i}(t,n,a);if(n=Object.is(n?.valueOf(),-0)?"-0":String(n),r.isUnsafeProperty(n))return a;const e=t[n];return void 0===e?a:e}}}},9330:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(4385),i=n(6443),o=n(5990),s=n(7599),a=n(9972);function l(e,t,n,r,i,o,s){const a=s(e,t,n,r,i,o);if(void 0!==a)return a;if(typeof e===typeof t)switch(typeof e){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return e===t;case"number":return e===t||Object.is(e,t);case"object":return c(e,t,o,s)}return c(e,t,o,s)}function c(e,t,n,u){if(Object.is(e,t))return!0;let h=o.getTag(e),d=o.getTag(t);if(h===s.argumentsTag&&(h=s.objectTag),d===s.argumentsTag&&(d=s.objectTag),h!==d)return!1;switch(h){case s.stringTag:return e.toString()===t.toString();case s.numberTag:{const n=e.valueOf(),r=t.valueOf();return a.eq(n,r)}case s.booleanTag:case s.dateTag:case s.symbolTag:return Object.is(e.valueOf(),t.valueOf());case s.regexpTag:return e.source===t.source&&e.flags===t.flags;case s.functionTag:return e===t}const f=(n=n??new Map).get(e),p=n.get(t);if(null!=f&&null!=p)return f===t;n.set(e,t),n.set(t,e);try{switch(h){case s.mapTag:if(e.size!==t.size)return!1;for(const[r,i]of e.entries())if(!t.has(r)||!l(i,t.get(r),r,e,t,n,u))return!1;return!0;case s.setTag:{if(e.size!==t.size)return!1;const r=Array.from(e.values()),i=Array.from(t.values());for(let o=0;o<r.length;o++){const s=r[o],a=i.findIndex(r=>l(s,r,void 0,e,t,n,u));if(-1===a)return!1;i.splice(a,1)}return!0}case s.arrayTag:case s.uint8ArrayTag:case s.uint8ClampedArrayTag:case s.uint16ArrayTag:case s.uint32ArrayTag:case s.bigUint64ArrayTag:case s.int8ArrayTag:case s.int16ArrayTag:case s.int32ArrayTag:case s.bigInt64ArrayTag:case s.float32ArrayTag:case s.float64ArrayTag:if("undefined"!==typeof Buffer&&Buffer.isBuffer(e)!==Buffer.isBuffer(t))return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!l(e[r],t[r],r,e,t,n,u))return!1;return!0;case s.arrayBufferTag:return e.byteLength===t.byteLength&&c(new Uint8Array(e),new Uint8Array(t),n,u);case s.dataViewTag:return e.byteLength===t.byteLength&&e.byteOffset===t.byteOffset&&c(new Uint8Array(e),new Uint8Array(t),n,u);case s.errorTag:return e.name===t.name&&e.message===t.message;case s.objectTag:{if(!(c(e.constructor,t.constructor,n,u)||r.isPlainObject(e)&&r.isPlainObject(t)))return!1;const o=[...Object.keys(e),...i.getSymbols(e)],s=[...Object.keys(t),...i.getSymbols(t)];if(o.length!==s.length)return!1;for(let r=0;r<o.length;r++){const i=o[r],s=e[i];if(!Object.hasOwn(t,i))return!1;if(!l(s,t[i],i,e,t,n,u))return!1}return!0}default:return!1}}finally{n.delete(e),n.delete(t)}}t.isEqualWith=function(e,t,n){return l(e,t,void 0,void 0,void 0,void 0,n)}},9397:(e,t,n)=>{e.exports=n(2682).isPlainObject},9461:(e,t,n)=>{"use strict";e.exports=n(2330)},9475:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib,r=n.WordArray,i=n.BlockCipher,o=e.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],c=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=o.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var r=s[n]-1;t[n]=e[r>>>5]>>>31-r%32&1}for(var i=this._subKeys=[],o=0;o<16;o++){var c=i[o]=[],u=l[o];for(n=0;n<24;n++)c[n/6|0]|=t[(a[n]-1+u)%28]<<31-n%6,c[4+(n/6|0)]|=t[28+(a[n+24]-1+u)%28]<<31-n%6;for(c[0]=c[0]<<1|c[0]>>>31,n=1;n<7;n++)c[n]=c[n]>>>4*(n-1)+3;c[7]=c[7]<<5|c[7]>>>27}var h=this._invSubKeys=[];for(n=0;n<16;n++)h[n]=i[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],d.call(this,4,252645135),d.call(this,16,65535),f.call(this,2,858993459),f.call(this,8,16711935),d.call(this,1,1431655765);for(var r=0;r<16;r++){for(var i=n[r],o=this._lBlock,s=this._rBlock,a=0,l=0;l<8;l++)a|=c[l][((s^i[l])&u[l])>>>0];this._lBlock=s,this._rBlock=o^a}var h=this._lBlock;this._lBlock=this._rBlock,this._rBlock=h,d.call(this,1,1431655765),f.call(this,8,16711935),f.call(this,2,858993459),d.call(this,16,65535),d.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function d(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function f(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=i._createHelper(h);var p=o.TripleDES=i.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),n=e.length<4?e.slice(0,2):e.slice(2,4),i=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=h.createEncryptor(r.create(t)),this._des2=h.createEncryptor(r.create(n)),this._des3=h.createEncryptor(r.create(i))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=i._createHelper(p)}(),t.TripleDES)}()},9599:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.identity=function(e){return e}},9638:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.StreamCipher,r=e.algo,i=r.RC4=n.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,r=this._S=[],i=0;i<256;i++)r[i]=i;i=0;for(var o=0;i<256;i++){var s=i%n,a=t[s>>>2]>>>24-s%4*8&255;o=(o+r[i]+a)%256;var l=r[i];r[i]=r[o],r[o]=l}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=o.call(this)},keySize:8,ivSize:0});function o(){for(var e=this._S,t=this._i,n=this._j,r=0,i=0;i<4;i++){n=(n+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[n],e[n]=o,r|=e[(e[t]+e[n])%256]<<24-8*i}return this._i=t,this._j=n,r}e.RC4=n._createHelper(i);var s=r.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)o.call(this)}});e.RC4Drop=n._createHelper(s)}(),t.RC4)}()},9645:(e,t,n)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6392),i=n(8346),o=n(1203);t.last=function(e){if(o.isArrayLike(e))return r.last(i.toArray(e))}},9709:(e,t)=>{"use strict";function n(e){return"symbol"===typeof e?1:null===e?2:void 0===e?3:e!==e?4:0}Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});t.compareValues=(e,t,r)=>{if(e!==t){const i=n(e),o=n(t);if(i===o&&0===i){if(e<t)return"desc"===r?1:-1;if(e>t)return"desc"===r?-1:1}return"desc"===r?o-i:i-o}return 0}},9717:(e,t,n)=>{"use strict";var r=n(5043),i=n(9461);var o="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},s=i.useSyncExternalStore,a=r.useRef,l=r.useEffect,c=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var h=a(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=c(function(){function e(e){if(!l){if(l=!0,s=e,e=r(e),void 0!==i&&d.hasValue){var t=d.value;if(i(t,e))return a=t}return a=e}if(t=a,o(s,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(s=e,t):(s=e,a=n)}var s,a,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,r,i]);var f=s(e,h[0],h[1]);return l(function(){d.hasValue=!0,d.value=f},[f]),u(f),f}},9749:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(e){var n=t,r=n.lib,i=r.Base,o=r.WordArray,s=n.x64={};s.Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=i.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:8*t.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var i=e[r];n.push(i.high),n.push(i.low)}return o.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}})}(),t)}()},9859:(e,t,n)=>{e.exports=n(7231).range},9921:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isObjectLike=function(e){return"object"===typeof e&&null!==e}},9972:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.eq=function(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var o=Object.create(null);n.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&i&&r;("object"==typeof a||"function"==typeof a)&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>s[e]=()=>r[e]);return s.default=()=>r,n.d(o,s),o}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+".53a7b47a.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="oceanographic-platform:";n.l=(r,i,o,s)=>{if(e[r])e[r].push(i);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+o){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=r),e[r]=[i];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach(e=>e(n)),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise((n,r)=>i=e[t]=[n,r]);r.push(i[2]=o);var s=n.p+n.u(t),a=new Error;n.l(s,r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,i[1](a)}},"chunk-"+t,t)}};var t=(t,r)=>{var i,o,s=r[0],a=r[1],l=r[2],c=0;if(s.some(t=>0!==e[t])){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)l(n)}for(t&&t(r);c<s.length;c++)o=s[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkoceanographic_platform=self.webpackChunkoceanographic_platform||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{scaleBand:()=>kz,scaleDiverging:()=>EV,scaleDivergingLog:()=>TV,scaleDivergingPow:()=>CV,scaleDivergingSqrt:()=>PV,scaleDivergingSymlog:()=>AV,scaleIdentity:()=>yB,scaleImplicit:()=>Pz,scaleLinear:()=>_B,scaleLog:()=>CB,scaleOrdinal:()=>Iz,scalePoint:()=>Rz,scalePow:()=>NB,scaleQuantile:()=>XB,scaleQuantize:()=>ZB,scaleRadial:()=>BB,scaleSequential:()=>_V,scaleSequentialLog:()=>yV,scaleSequentialPow:()=>xV,scaleSequentialQuantile:()=>wV,scaleSequentialSqrt:()=>bV,scaleSequentialSymlog:()=>vV,scaleSqrt:()=>zB,scaleSymlog:()=>MB,scaleThreshold:()=>KB,scaleTime:()=>fV,scaleUtc:()=>pV,tickFormat:()=>mB});var t={};n.r(t),n.d(t,{boolean:()=>j1,booleanish:()=>U1,commaOrSpaceSeparated:()=>W1,commaSeparated:()=>$1,number:()=>G1,overloadedBoolean:()=>V1,spaceSeparated:()=>H1});var r={};n.r(r),n.d(r,{attentionMarkers:()=>w4,contentInitial:()=>g4,disable:()=>S4,document:()=>m4,flow:()=>y4,flowInitial:()=>_4,insideSpan:()=>b4,string:()=>v4,text:()=>x4});var i=n(5043),o=n.t(i,2),s=n(4391),a="popstate";function l(){return m(function(e,t){let{pathname:n,search:r,hash:i}=e.location;return d("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:f(t)},null,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function c(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function u(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(_t){}}}function h(e,t){return{usr:e.state,key:e.key,idx:t}}function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return{pathname:"string"===typeof e?e:e.pathname,search:"",hash:"",..."string"===typeof t?p(t):t,state:n,key:t&&t.key||r||Math.random().toString(36).substring(2,10)}}function f(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function p(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function m(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:i=document.defaultView,v5Compat:o=!1}=r,s=i.history,l="POP",c=null,u=f();function f(){return(s.state||{idx:null}).idx}function p(){l="POP";let e=f(),t=null==e?null:e-u;u=e,c&&c({action:l,location:_.location,delta:t})}function m(e){return g(e)}null==u&&(u=0,s.replaceState({...s.state,idx:u},""));let _={get action(){return l},get location(){return e(i,s)},listen(e){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(a,p),c=e,()=>{i.removeEventListener(a,p),c=null}},createHref:e=>t(i,e),createURL:m,encodeLocation(e){let t=m(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l="PUSH";let r=d(_.location,e,t);n&&n(r,e),u=f()+1;let a=h(r,u),p=_.createHref(r);try{s.pushState(a,"",p)}catch(m){if(m instanceof DOMException&&"DataCloneError"===m.name)throw m;i.location.assign(p)}o&&c&&c({action:l,location:_.location,delta:1})},replace:function(e,t){l="REPLACE";let r=d(_.location,e,t);n&&n(r,e),u=f();let i=h(r,u),a=_.createHref(r);s.replaceState(i,"",a),o&&c&&c({action:l,location:_.location,delta:0})},go:e=>s.go(e)};return _}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="http://localhost";"undefined"!==typeof window&&(n="null"!==window.location.origin?window.location.origin:window.location.href),c(n,"No window.location.(origin|href) available to create URL");let r="string"===typeof e?e:f(e);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=n+r),new URL(r,n)}new WeakMap;function _(e,t){return y(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function y(e,t,n,r){let i=O(("string"===typeof t?p(t):t).pathname||"/",n);if(null==i)return null;let o=v(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(o);let s=null;for(let a=0;null==s&&a<o.length;++a){let e=R(i);s=I(o[a],e,r)}return s}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=function(e,o){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,a=arguments.length>3?arguments[3]:void 0,l={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:o,route:e};if(l.relativePath.startsWith("/")){if(!l.relativePath.startsWith(r)&&s)return;c(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length)}let u=F([r,l.relativePath]),h=n.concat(l);e.children&&e.children.length>0&&(c(!0!==e.index,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),v(e.children,t,h,u,s)),(null!=e.path||e.index)&&t.push({path:u,score:P(u,e.index),routesMeta:h})};return e.forEach((e,t)=>{if(""!==e.path&&e.path?.includes("?"))for(let n of x(e.path))o(e,t,!0,n);else o(e,t)}),t}function x(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let s=x(r.join("/")),a=[];return a.push(...s.map(e=>""===e?o:[o,e].join("/"))),i&&a.push(...s),a.map(t=>e.startsWith("/")&&""===t?"/":t)}var b=/^:[\w-]+$/,w=3,S=2,E=1,T=10,A=-2,C=e=>"*"===e;function P(e,t){let n=e.split("/"),r=n.length;return n.some(C)&&(r+=A),t&&(r+=S),n.filter(e=>!C(e)).reduce((e,t)=>e+(b.test(t)?w:""===t?E:T),r)}function I(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:r}=e,i={},o="/",s=[];for(let a=0;a<r.length;++a){let e=r[a],l=a===r.length-1,c="/"===o?t:t.slice(o.length)||"/",u=k({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),h=e.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=k({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),s.push({params:i,pathname:F([o,u.pathname]),pathnameBase:B(F([o,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(o=F([o,u.pathnameBase]))}return s}function k(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=M(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1),l=r.reduce((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=a[n]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const l=a[n];return e[r]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{});return{params:l,pathname:o,pathnameBase:s,pattern:e}}function M(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];u("*"===e||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),r]}function R(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return u(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function O(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function L(e,t,n,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function D(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function N(e){let t=D(e);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function z(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof e?r=p(e):(r={...e},c(!r.pathname||!r.pathname.includes("?"),L("?","pathname","search",r)),c(!r.pathname||!r.pathname.includes("#"),L("#","pathname","hash",r)),c(!r.search||!r.search.includes("#"),L("#","search","hash",r)));let o,s=""===e||""===r.pathname,a=s?"/":r.pathname;if(null==a)o=n;else{let e=t.length-1;if(!i&&a.startsWith("..")){let t=a.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}o=e>=0?t[e]:"/"}let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:n,search:r="",hash:i=""}="string"===typeof e?p(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:j(r),hash:U(i)}}(r,o),u=a&&"/"!==a&&a.endsWith("/"),h=(s||"."===a)&&n.endsWith("/");return l.pathname.endsWith("/")||!u&&!h||(l.pathname+="/"),l}var F=e=>e.join("/").replace(/\/\/+/g,"/"),B=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),j=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",U=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function V(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}var G=["POST","PUT","PATCH","DELETE"],H=(new Set(G),["GET",...G]);new Set(H),Symbol("ResetLoaderData");var $=i.createContext(null);$.displayName="DataRouter";var W=i.createContext(null);W.displayName="DataRouterState";var q=i.createContext(!1);var X=i.createContext({isTransitioning:!1});X.displayName="ViewTransition";var Z=i.createContext(new Map);Z.displayName="Fetchers";var K=i.createContext(null);K.displayName="Await";var Y=i.createContext(null);Y.displayName="Navigation";var J=i.createContext(null);J.displayName="Location";var Q=i.createContext({outlet:null,matches:[],isDataRoute:!1});Q.displayName="Route";var ee=i.createContext(null);ee.displayName="RouteError";function te(){return null!=i.useContext(J)}function ne(){return c(te(),"useLocation() may be used only in the context of a <Router> component."),i.useContext(J).location}var re="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function ie(e){i.useContext(Y).static||i.useLayoutEffect(e)}function oe(){let{isDataRoute:e}=i.useContext(Q);return e?function(){let{router:e}=pe("useNavigate"),t=ge("useNavigate"),n=i.useRef(!1);ie(()=>{n.current=!0});let r=i.useCallback(async function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(n.current,re),n.current&&("number"===typeof r?e.navigate(r):await e.navigate(r,{fromRouteId:t,...i}))},[e,t]);return r}():function(){c(te(),"useNavigate() may be used only in the context of a <Router> component.");let e=i.useContext($),{basename:t,navigator:n}=i.useContext(Y),{matches:r}=i.useContext(Q),{pathname:o}=ne(),s=JSON.stringify(N(r)),a=i.useRef(!1);ie(()=>{a.current=!0});let l=i.useCallback(function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(a.current,re),!a.current)return;if("number"===typeof r)return void n.go(r);let l=z(r,JSON.parse(s),o,"path"===i.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:F([t,l.pathname])),(i.replace?n.replace:n.push)(l,i.state,i)},[t,n,s,o,e]);return l}()}i.createContext(null);function se(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:n}=i.useContext(Q),{pathname:r}=ne(),o=JSON.stringify(N(n));return i.useMemo(()=>z(e,JSON.parse(o),r,"path"===t),[e,o,r,t])}function ae(e,t,n,r,o){c(te(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=i.useContext(Y),{matches:a}=i.useContext(Q),l=a[a.length-1],h=l?l.params:{},d=l?l.pathname:"/",f=l?l.pathnameBase:"/",m=l&&l.route;{let e=m&&m.path||"";ve(d,!m||e.endsWith("*")||e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="${e}"> to <Route path="${"/"===e?"*":`${e}/*`}">.`)}let g,y=ne();if(t){let e="string"===typeof t?p(t):t;c("/"===f||e.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${e.pathname}" was given in the \`location\` prop.`),g=e}else g=y;let v=g.pathname||"/",x=v;if("/"!==f){let e=f.replace(/^\//,"").split("/");x="/"+v.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=_(e,{pathname:x});u(m||null!=b,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),u(null==b||void 0!==b[b.length-1].route.element||void 0!==b[b.length-1].route.Component||void 0!==b[b.length-1].route.lazy,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let w=de(b&&b.map(e=>Object.assign({},e,{params:Object.assign({},h,e.params),pathname:F([f,s.encodeLocation?s.encodeLocation(e.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?f:F([f,s.encodeLocation?s.encodeLocation(e.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathnameBase])})),a,n,r,o);return t&&w?i.createElement(J.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},w):w}function le(){let e=_e(),t=V(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",e),a=i.createElement(i.Fragment,null,i.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),i.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",i.createElement("code",{style:s},"ErrorBoundary")," or"," ",i.createElement("code",{style:s},"errorElement")," prop on your route.")),i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},t),n?i.createElement("pre",{style:o},n):null,a)}var ce=i.createElement(le,null),ue=class extends i.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.unstable_onError?this.props.unstable_onError(e,t):console.error("React Router caught the following error during render",e)}render(){return void 0!==this.state.error?i.createElement(Q.Provider,{value:this.props.routeContext},i.createElement(ee.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function he(e){let{routeContext:t,match:n,children:r}=e,o=i.useContext($);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),i.createElement(Q.Provider,{value:t},r)}function de(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==t.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let o=e,s=n?.errors;if(null!=s){let e=o.findIndex(e=>e.route.id&&void 0!==s?.[e.route.id]);c(e>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),o=o.slice(0,Math.min(o.length,e+1))}let a=!1,l=-1;if(n)for(let i=0;i<o.length;i++){let e=o[i];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(l=i),e.route.id){let{loaderData:t,errors:r}=n,i=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!r||void 0===r[e.route.id]);if(e.route.lazy||i){a=!0,o=l>=0?o.slice(0,l+1):[o[0]];break}}}return o.reduceRight((e,c,u)=>{let h,d=!1,f=null,p=null;n&&(h=s&&c.route.id?s[c.route.id]:void 0,f=c.route.errorElement||ce,a&&(l<0&&0===u?(ve("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,p=null):l===u&&(d=!0,p=c.route.hydrateFallbackElement||null)));let m=t.concat(o.slice(0,u+1)),g=()=>{let t;return t=h?f:d?p:c.route.Component?i.createElement(c.route.Component,null):c.route.element?c.route.element:e,i.createElement(he,{match:c,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:t})};return n&&(c.route.ErrorBoundary||c.route.errorElement||0===u)?i.createElement(ue,{location:n.location,revalidation:n.revalidation,component:f,error:h,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0},unstable_onError:r}):g()},null)}function fe(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function pe(e){let t=i.useContext($);return c(t,fe(e)),t}function me(e){let t=i.useContext(W);return c(t,fe(e)),t}function ge(e){let t=function(e){let t=i.useContext(Q);return c(t,fe(e)),t}(e),n=t.matches[t.matches.length-1];return c(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function _e(){let e=i.useContext(ee),t=me("useRouteError"),n=ge("useRouteError");return void 0!==e?e:t.errors?.[n]}var ye={};function ve(e,t,n){t||ye[e]||(ye[e]=!0,u(!1,n))}var xe={};function be(e,t){e||xe[t]||(xe[t]=!0,console.warn(t))}i.memo(function(e){let{routes:t,future:n,state:r,unstable_onError:i}=e;return ae(t,void 0,r,i,n)});function we(e){c(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Se(e){let{basename:t="/",children:n=null,location:r,navigationType:o="POP",navigator:s,static:a=!1}=e;c(!te(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=t.replace(/^\/*/,"/"),h=i.useMemo(()=>({basename:l,navigator:s,static:a,future:{}}),[l,s,a]);"string"===typeof r&&(r=p(r));let{pathname:d="/",search:f="",hash:m="",state:g=null,key:_="default"}=r,y=i.useMemo(()=>{let e=O(d,l);return null==e?null:{location:{pathname:e,search:f,hash:m,state:g,key:_},navigationType:o}},[l,d,f,m,g,_,o]);return u(null!=y,`<Router basename="${l}"> is not able to match the URL "${d}${f}${m}" because it does not start with the basename, so the <Router> won't render anything.`),null==y?null:i.createElement(Y.Provider,{value:h},i.createElement(J.Provider,{children:n,value:y}))}function Ee(e){let{children:t,location:n}=e;return ae(Te(t),n)}i.Component;function Te(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return i.Children.forEach(e,(e,r)=>{if(!i.isValidElement(e))return;let o=[...t,r];if(e.type===i.Fragment)return void n.push.apply(n,Te(e.props.children,o));c(e.type===we,`[${"string"===typeof e.type?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),c(!e.props.index||!e.props.children,"An index route cannot have child routes.");let s={id:e.props.id||o.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,middleware:e.props.middleware,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(s.children=Te(e.props.children,o)),n.push(s)}),n}var Ae="get",Ce="application/x-www-form-urlencoded";function Pe(e){return null!=e&&"string"===typeof e.tagName}var Ie=null;var ke=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Me(e){return null==e||ke.has(e)?e:(u(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ce}"`),null)}function Re(e,t){let n,r,i,o,s;if(function(e){return Pe(e)&&"form"===e.tagName.toLowerCase()}(e)){let s=e.getAttribute("action");r=s?O(s,t):null,n=e.getAttribute("method")||Ae,i=Me(e.getAttribute("enctype"))||Ce,o=new FormData(e)}else if(function(e){return Pe(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return Pe(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let s=e.form;if(null==s)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let a=e.getAttribute("formaction")||s.getAttribute("action");if(r=a?O(a,t):null,n=e.getAttribute("formmethod")||s.getAttribute("method")||Ae,i=Me(e.getAttribute("formenctype"))||Me(s.getAttribute("enctype"))||Ce,o=new FormData(s,e),!function(){if(null===Ie)try{new FormData(document.createElement("form"),0),Ie=!1}catch(_t){Ie=!0}return Ie}()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?`${t}.`:"";o.append(`${e}x`,"0"),o.append(`${e}y`,"0")}else t&&o.append(t,r)}}else{if(Pe(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Ae,r=null,i=Ce,s=e}return o&&"text/plain"===i&&(s=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");"undefined"!==typeof window?window:"undefined"!==typeof globalThis&&globalThis;function Oe(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}Symbol("SingleFetchRedirect");function Le(e,t,n){let r="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return"/"===r.pathname?r.pathname=`_root.${n}`:t&&"/"===O(r.pathname,t)?r.pathname=`${t.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function De(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Ne(e){return null!=e&&"string"===typeof e.page}function ze(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function Fe(e,t,n,r,i,o){let s=(e,t)=>!n[t]||e.route.id!==n[t].route.id,a=(e,t)=>n[t].pathname!==e.pathname||n[t].route.path?.endsWith("*")&&n[t].params["*"]!==e.params["*"];return"assets"===o?t.filter((e,t)=>s(e,t)||a(e,t)):"data"===o?t.filter((t,o)=>{let l=r.routes[t.route.id];if(!l||!l.hasLoader)return!1;if(s(t,o)||a(t,o))return!0;if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof r)return r}return!0}):[]}function Be(e,t){let{includeHydrateFallback:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=e.map(e=>{let r=t.routes[e.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1),[...new Set(r)];var r}function je(e,t){let n=new Set,r=new Set(t);return e.reduce((e,i)=>{if(t&&!Ne(i)&&"script"===i.as&&i.href&&r.has(i.href))return e;let o=JSON.stringify(function(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}(i));return n.has(o)||(n.add(o),e.push({key:o,link:i})),e},[])}function Ue(e,t){return"lazy"===e.mode&&!0===t}function Ve(){let e=i.useContext($);return Oe(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function Ge(){let e=i.useContext(W);return Oe(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var He=i.createContext(void 0);function $e(){let e=i.useContext(He);return Oe(e,"You must render this element inside a <HydratedRouter> element"),e}function We(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function qe(e,t,n){if(n&&!Ye)return[e[0]];if(t){let n=e.findIndex(e=>void 0!==t[e.route.id]);return e.slice(0,n+1)}return e}He.displayName="FrameworkContext";function Xe(e){let{page:t,...n}=e,{router:r}=Ve(),o=i.useMemo(()=>_(r.routes,t,r.basename),[r.routes,t,r.basename]);return o?i.createElement(Ke,{page:t,matches:o,...n}):null}function Ze(e){let{manifest:t,routeModules:n}=$e(),[r,o]=i.useState([]);return i.useEffect(()=>{let r=!1;return async function(e,t,n){let r=await Promise.all(e.map(async e=>{let r=t.routes[e.route.id];if(r){let e=await De(r,n);return e.links?e.links():[]}return[]}));return je(r.flat(1).filter(ze).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?{...e,rel:"prefetch",as:"style"}:{...e,rel:"prefetch"}))}(e,t,n).then(e=>{r||o(e)}),()=>{r=!0}},[e,t,n]),r}function Ke(e){let{page:t,matches:n,...r}=e,o=ne(),{manifest:s,routeModules:a}=$e(),{basename:l}=Ve(),{loaderData:c,matches:u}=Ge(),h=i.useMemo(()=>Fe(t,n,u,s,o,"data"),[t,n,u,s,o]),d=i.useMemo(()=>Fe(t,n,u,s,o,"assets"),[t,n,u,s,o]),f=i.useMemo(()=>{if(t===o.pathname+o.search+o.hash)return[];let e=new Set,r=!1;if(n.forEach(t=>{let n=s.routes[t.route.id];n&&n.hasLoader&&(!h.some(e=>e.route.id===t.route.id)&&t.route.id in c&&a[t.route.id]?.shouldRevalidate||n.hasClientLoader?r=!0:e.add(t.route.id))}),0===e.size)return[];let i=Le(t,l,"data");return r&&e.size>0&&i.searchParams.set("_routes",n.filter(t=>e.has(t.route.id)).map(e=>e.route.id).join(",")),[i.pathname+i.search]},[l,c,o,s,h,n,t,a]),p=i.useMemo(()=>Be(d,s),[d,s]),m=Ze(d);return i.createElement(i.Fragment,null,f.map(e=>i.createElement("link",{key:e,rel:"prefetch",as:"fetch",href:e,...r})),p.map(e=>i.createElement("link",{key:e,rel:"modulepreload",href:e,...r})),m.map(e=>{let{key:t,link:n}=e;return i.createElement("link",{key:t,nonce:r.nonce,...n})}))}var Ye=!1;function Je(e){let{manifest:t,serverHandoffString:n,isSpaMode:r,renderMeta:o,routeDiscovery:s,ssr:a}=$e(),{router:l,static:c,staticContext:u}=Ve(),{matches:h}=Ge(),d=i.useContext(q),f=Ue(s,a);o&&(o.didRenderScripts=!0);let p=qe(h,null,r);i.useEffect(()=>{0},[]);let m=i.useMemo(()=>{if(d)return null;let r=u?`window.__reactRouterContext = ${n};window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());`:" ",o=c?`${t.hmr?.runtime?`import ${JSON.stringify(t.hmr.runtime)};`:""}${f?"":`import ${JSON.stringify(t.url)}`};\n${p.map((e,n)=>{let r=`route${n}`,i=t.routes[e.route.id];Oe(i,`Route ${e.route.id} not found in manifest`);let{clientActionModule:o,clientLoaderModule:s,clientMiddlewareModule:a,hydrateFallbackModule:l,module:c}=i,u=[...o?[{module:o,varName:`${r}_clientAction`}]:[],...s?[{module:s,varName:`${r}_clientLoader`}]:[],...a?[{module:a,varName:`${r}_clientMiddleware`}]:[],...l?[{module:l,varName:`${r}_HydrateFallback`}]:[],{module:c,varName:`${r}_main`}];return 1===u.length?`import * as ${r} from ${JSON.stringify(c)};`:[u.map(e=>`import * as ${e.varName} from "${e.module}";`).join("\n"),`const ${r} = {${u.map(e=>`...${e.varName}`).join(",")}};`].join("\n")}).join("\n")}\n  ${f?`window.__reactRouterManifest = ${JSON.stringify(function(e,t){let{sri:n,...r}=e,i=new Set(t.state.matches.map(e=>e.route.id)),o=t.state.location.pathname.split("/").filter(Boolean),s=["/"];for(o.pop();o.length>0;)s.push(`/${o.join("/")}`),o.pop();s.forEach(e=>{let n=_(t.routes,e,t.basename);n&&n.forEach(e=>i.add(e.route.id))});let a=[...i].reduce((e,t)=>Object.assign(e,{[t]:r.routes[t]}),{});return{...r,routes:a,sri:!!n||void 0}}(t,l),null,2)};`:""}\n  window.__reactRouterRouteModules = {${p.map((e,t)=>`${JSON.stringify(e.route.id)}:route${t}`).join(",")}};\n\nimport(${JSON.stringify(t.entry.module)});`:" ";return i.createElement(i.Fragment,null,i.createElement("script",{...e,suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:r},type:void 0}),i.createElement("script",{...e,suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:o},type:"module",async:!0}))},[]),g=Ye||d?[]:function(e){return[...new Set(e)]}(t.entry.imports.concat(Be(p,t,{includeHydrateFallback:!0}))),y="object"===typeof t.sri?t.sri:{};return be(!d,"The <Scripts /> element is a no-op when using RSC and can be safely removed."),Ye||d?null:i.createElement(i.Fragment,null,"object"===typeof t.sri?i.createElement("script",{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:y})}}):null,f?null:i.createElement("link",{rel:"modulepreload",href:t.url,crossOrigin:e.crossOrigin,integrity:y[t.url],suppressHydrationWarning:!0}),i.createElement("link",{rel:"modulepreload",href:t.entry.module,crossOrigin:e.crossOrigin,integrity:y[t.entry.module],suppressHydrationWarning:!0}),g.map(t=>i.createElement("link",{key:t,rel:"modulepreload",href:t,crossOrigin:e.crossOrigin,integrity:y[t],suppressHydrationWarning:!0})),m)}function Qe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{t.forEach(t=>{"function"===typeof t?t(e):null!=t&&(t.current=e)})}}i.Component;function et(e){let{error:t,isOutsideRemixApp:n}=e;console.error(t);let r,o=i.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information."\n        );\n      '}});if(V(t))return i.createElement(tt,{title:"Unhandled Thrown Response!"},i.createElement("h1",{style:{fontSize:"24px"}},t.status," ",t.statusText),o);if(t instanceof Error)0;else{let e=null==t?"Unknown Error":"object"===typeof t&&"toString"in t?t.toString():JSON.stringify(t);new Error(e)}return i.createElement(tt,{title:"Application Error!",isOutsideRemixApp:n},i.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),i.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},r.stack),o)}function tt(e){let{title:t,renderScripts:n,isOutsideRemixApp:r,children:o}=e,{routeModules:s}=$e();return s.root?.Layout&&!r?o:i.createElement("html",{lang:"en"},i.createElement("head",null,i.createElement("meta",{charSet:"utf-8"}),i.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),i.createElement("title",null,t)),i.createElement("body",null,i.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},o,n?i.createElement(Je,null):null)))}var nt="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{nt&&(window.__reactRouterVersion="7.9.2")}catch(_t){}function rt(e){let{basename:t,children:n,window:r}=e,o=i.useRef();null==o.current&&(o.current=l({window:r,v5Compat:!0}));let s=o.current,[a,c]=i.useState({action:s.action,location:s.location}),u=i.useCallback(e=>{i.startTransition(()=>c(e))},[c]);return i.useLayoutEffect(()=>s.listen(u),[s,u]),i.createElement(Se,{basename:t,children:n,location:a.location,navigationType:a.action,navigator:s})}var it=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ot=i.forwardRef(function(e,t){let n,{onClick:r,discover:o="render",prefetch:s="none",relative:a,reloadDocument:l,replace:h,state:d,target:p,to:m,preventScrollReset:g,viewTransition:_,...y}=e,{basename:v}=i.useContext(Y),x="string"===typeof m&&it.test(m),b=!1;if("string"===typeof m&&x&&(n=m,nt))try{let e=new URL(window.location.href),t=m.startsWith("//")?new URL(e.protocol+m):new URL(m),n=O(t.pathname,v);t.origin===e.origin&&null!=n?m=n+t.search+t.hash:b=!0}catch(_t){u(!1,`<Link to="${m}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let w=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(te(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=i.useContext(Y),{hash:o,pathname:s,search:a}=se(e,{relative:t}),l=s;return"/"!==n&&(l="/"===s?n:F([n,s])),r.createHref({pathname:l,search:a,hash:o})}(m,{relative:a}),[S,E,T]=function(e,t){let n=i.useContext(He),[r,o]=i.useState(!1),[s,a]=i.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:u,onMouseLeave:h,onTouchStart:d}=t,f=i.useRef(null);i.useEffect(()=>{if("render"===e&&a(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{a(e.isIntersecting)})},{threshold:.5});return f.current&&e.observe(f.current),()=>{e.disconnect()}}},[e]),i.useEffect(()=>{if(r){let e=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(e)}}},[r]);let p=()=>{o(!0)},m=()=>{o(!1),a(!1)};return n?"intent"!==e?[s,f,{}]:[s,f,{onFocus:We(l,p),onBlur:We(c,m),onMouseEnter:We(u,p),onMouseLeave:We(h,m),onTouchStart:We(d,p)}]:[!1,f,{}]}(s,y),A=function(e){let{target:t,replace:n,state:r,preventScrollReset:o,relative:s,viewTransition:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=oe(),c=ne(),u=se(e,{relative:s});return i.useCallback(i=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(i,t)){i.preventDefault();let t=void 0!==n?n:f(c)===f(u);l(e,{replace:t,state:r,preventScrollReset:o,relative:s,viewTransition:a})}},[c,l,u,n,r,t,e,o,s,a])}(m,{replace:h,state:d,target:p,preventScrollReset:g,relative:a,viewTransition:_});let C=i.createElement("a",{...y,...T,href:n||w,onClick:b||l?r:function(e){r&&r(e),e.defaultPrevented||A(e)},ref:Qe(t,E),target:p,"data-discover":x||"render"!==o?void 0:"true"});return S&&!x?i.createElement(i.Fragment,null,C,i.createElement(Xe,{page:w})):C});ot.displayName="Link";var st=i.forwardRef(function(e,t){let{"aria-current":n="page",caseSensitive:r=!1,className:o="",end:s=!1,style:a,to:l,viewTransition:u,children:h,...d}=e,f=se(l,{relative:d.relative}),p=ne(),m=i.useContext(W),{navigator:g,basename:_}=i.useContext(Y),y=null!=m&&function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.useContext(X);c(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=ct("useViewTransitionState"),o=se(e,{relative:t});if(!n.isTransitioning)return!1;let s=O(n.currentLocation.pathname,r)||n.currentLocation.pathname,a=O(n.nextLocation.pathname,r)||n.nextLocation.pathname;return null!=k(o.pathname,a)||null!=k(o.pathname,s)}(f)&&!0===u,v=g.encodeLocation?g.encodeLocation(f).pathname:f.pathname,x=p.pathname,b=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;r||(x=x.toLowerCase(),b=b?b.toLowerCase():null,v=v.toLowerCase()),b&&_&&(b=O(b,_)||b);const w="/"!==v&&v.endsWith("/")?v.length-1:v.length;let S,E=x===v||!s&&x.startsWith(v)&&"/"===x.charAt(w),T=null!=b&&(b===v||!s&&b.startsWith(v)&&"/"===b.charAt(v.length)),A={isActive:E,isPending:T,isTransitioning:y},C=E?n:void 0;S="function"===typeof o?o(A):[o,E?"active":null,T?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let P="function"===typeof a?a(A):a;return i.createElement(ot,{...d,"aria-current":C,className:S,ref:t,style:P,to:l,viewTransition:u},"function"===typeof h?h(A):h)});st.displayName="NavLink";var at=i.forwardRef((e,t)=>{let{discover:n="render",fetcherKey:r,navigate:o,reloadDocument:s,replace:a,state:l,method:u=Ae,action:h,onSubmit:d,relative:p,preventScrollReset:m,viewTransition:g,..._}=e,y=dt(),v=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:n}=i.useContext(Y),r=i.useContext(Q);c(r,"useFormAction must be used inside a RouteContext");let[o]=r.matches.slice(-1),s={...se(e||".",{relative:t})},a=ne();if(null==e){s.search=a.search;let e=new URLSearchParams(s.search),t=e.getAll("index"),n=t.some(e=>""===e);if(n){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let n=e.toString();s.search=n?`?${n}`:""}}e&&"."!==e||!o.route.index||(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index");"/"!==n&&(s.pathname="/"===s.pathname?n:F([n,s.pathname]));return f(s)}(h,{relative:p}),x="get"===u.toLowerCase()?"get":"post",b="string"===typeof h&&it.test(h);return i.createElement("form",{ref:t,method:x,action:v,onSubmit:s?d:e=>{if(d&&d(e),e.defaultPrevented)return;e.preventDefault();let t=e.nativeEvent.submitter,n=t?.getAttribute("formmethod")||u;y(t||e.currentTarget,{fetcherKey:r,method:n,navigate:o,replace:a,state:l,relative:p,preventScrollReset:m,viewTransition:g})},..._,"data-discover":b||"render"!==n?void 0:"true"})});function lt(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ct(e){let t=i.useContext($);return c(t,lt(e)),t}at.displayName="Form";var ut=0,ht=()=>`__${String(++ut)}__`;function dt(){let{router:e}=ct("useSubmit"),{basename:t}=i.useContext(Y),n=ge("useRouteId");return i.useCallback(async function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:o,method:s,encType:a,formData:l,body:c}=Re(r,t);if(!1===i.navigate){let t=i.fetcherKey||ht();await e.fetch(t,n,i.action||o,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||s,formEncType:i.encType||a,flushSync:i.flushSync})}else await e.navigate(i.action||o,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||s,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[e,t,n])}var ft=function(e,t){return ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ft(e,t)};var pt=function(){return pt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},pt.apply(this,arguments)};function mt(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(_t){o(_t)}}function a(e){try{l(r.throw(e))}catch(_t){o(_t)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())})}function gt(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"===typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(_t){a=[6,_t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function _t(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}"function"===typeof SuppressedError&&SuppressedError,"function"==typeof SuppressedError&&SuppressedError;var yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function vt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function xt(e,t){return e(t={exports:{}},t.exports),t.exports}var bt=xt(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){var e=this;this.locked=new Map,this.addToLocked=function(t,n){var r=e.locked.get(t);void 0===r?void 0===n?e.locked.set(t,[]):e.locked.set(t,[n]):void 0!==n&&(r.unshift(n),e.locked.set(t,r))},this.isLocked=function(t){return e.locked.has(t)},this.lock=function(t){return new Promise(function(n,r){e.isLocked(t)?e.addToLocked(t,n):(e.addToLocked(t),n())})},this.unlock=function(t){var n=e.locked.get(t);if(void 0!==n&&0!==n.length){var r=n.pop();e.locked.set(t,n),void 0!==r&&setTimeout(r,0)}else e.locked.delete(t)}}return e.getInstance=function(){return void 0===e.instance&&(e.instance=new e),e.instance},e}();t.default=function(){return n.getInstance()}});vt(bt);var wt=vt(xt(function(e,t){var n=yt&&yt.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},r=yt&&yt.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=yt;Object.defineProperty(t,"__esModule",{value:!0});var o="browser-tabs-lock-key",s={key:function(e){return n(i,void 0,void 0,function(){return r(this,function(e){throw new Error("Unsupported")})})},getItem:function(e){return n(i,void 0,void 0,function(){return r(this,function(e){throw new Error("Unsupported")})})},clear:function(){return n(i,void 0,void 0,function(){return r(this,function(e){return[2,window.localStorage.clear()]})})},removeItem:function(e){return n(i,void 0,void 0,function(){return r(this,function(e){throw new Error("Unsupported")})})},setItem:function(e,t){return n(i,void 0,void 0,function(){return r(this,function(e){throw new Error("Unsupported")})})},keySync:function(e){return window.localStorage.key(e)},getItemSync:function(e){return window.localStorage.getItem(e)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(e){return window.localStorage.removeItem(e)},setItemSync:function(e,t){return window.localStorage.setItem(e,t)}};function a(e){return new Promise(function(t){return setTimeout(t,e)})}function l(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="",r=0;r<e;r++)n+=t[Math.floor(61*Math.random())];return n}var c=function(){function e(t){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+l(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=t,void 0===e.waiters&&(e.waiters=[])}return e.prototype.acquireLock=function(t,i){return void 0===i&&(i=5e3),n(this,void 0,void 0,function(){var n,c,u,h,d,f,p;return r(this,function(r){switch(r.label){case 0:n=Date.now()+l(4),c=Date.now()+i,u=o+"-"+t,h=void 0===this.storageHandler?s:this.storageHandler,r.label=1;case 1:return Date.now()<c?[4,a(30)]:[3,8];case 2:return r.sent(),null!==h.getItemSync(u)?[3,5]:(d=this.id+"-"+t+"-"+n,[4,a(Math.floor(25*Math.random()))]);case 3:return r.sent(),h.setItemSync(u,JSON.stringify({id:this.id,iat:n,timeoutKey:d,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,a(30)];case 4:return r.sent(),null!==(f=h.getItemSync(u))&&(p=JSON.parse(f)).id===this.id&&p.iat===n?(this.acquiredIatSet.add(n),this.refreshLockWhileAcquired(u,n),[2,!0]):[3,7];case 5:return e.lockCorrector(void 0===this.storageHandler?s:this.storageHandler),[4,this.waitForSomethingToChange(c)];case 6:r.sent(),r.label=7;case 7:return n=Date.now()+l(4),[3,1];case 8:return[2,!1]}})})},e.prototype.refreshLockWhileAcquired=function(e,t){return n(this,void 0,void 0,function(){var i=this;return r(this,function(o){return setTimeout(function(){return n(i,void 0,void 0,function(){var n,i,o;return r(this,function(r){switch(r.label){case 0:return[4,bt.default().lock(t)];case 1:return r.sent(),this.acquiredIatSet.has(t)?(n=void 0===this.storageHandler?s:this.storageHandler,null===(i=n.getItemSync(e))?(bt.default().unlock(t),[2]):((o=JSON.parse(i)).timeRefreshed=Date.now(),n.setItemSync(e,JSON.stringify(o)),bt.default().unlock(t),this.refreshLockWhileAcquired(e,t),[2])):(bt.default().unlock(t),[2])}})})},1e3),[2]})})},e.prototype.waitForSomethingToChange=function(t){return n(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n){var r=!1,i=Date.now(),o=!1;function s(){if(o||(window.removeEventListener("storage",s),e.removeFromWaiting(s),clearTimeout(a),o=!0),!r){r=!0;var t=50-(Date.now()-i);t>0?setTimeout(n,t):n(null)}}window.addEventListener("storage",s),e.addToWaiting(s);var a=setTimeout(s,Math.max(0,t-Date.now()))})];case 1:return n.sent(),[2]}})})},e.addToWaiting=function(t){this.removeFromWaiting(t),void 0!==e.waiters&&e.waiters.push(t)},e.removeFromWaiting=function(t){void 0!==e.waiters&&(e.waiters=e.waiters.filter(function(e){return e!==t}))},e.notifyWaiters=function(){void 0!==e.waiters&&e.waiters.slice().forEach(function(e){return e()})},e.prototype.releaseLock=function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,this.releaseLock__private__(e)];case 1:return[2,t.sent()]}})})},e.prototype.releaseLock__private__=function(t){return n(this,void 0,void 0,function(){var n,i,a,l;return r(this,function(r){switch(r.label){case 0:return n=void 0===this.storageHandler?s:this.storageHandler,i=o+"-"+t,null===(a=n.getItemSync(i))?[2]:(l=JSON.parse(a)).id!==this.id?[3,2]:[4,bt.default().lock(l.iat)];case 1:r.sent(),this.acquiredIatSet.delete(l.iat),n.removeItemSync(i),bt.default().unlock(l.iat),e.notifyWaiters(),r.label=2;case 2:return[2]}})})},e.lockCorrector=function(t){for(var n=Date.now()-5e3,r=t,i=[],s=0;;){var a=r.keySync(s);if(null===a)break;i.push(a),s++}for(var l=!1,c=0;c<i.length;c++){var u=i[c];if(u.includes(o)){var h=r.getItemSync(u);if(null!==h){var d=JSON.parse(h);(void 0===d.timeRefreshed&&d.timeAcquired<n||void 0!==d.timeRefreshed&&d.timeRefreshed<n)&&(r.removeItemSync(u),l=!0)}}}l&&e.notifyWaiters()},e.waiters=void 0,e}();t.default=c}));const St={timeoutInSeconds:60},Et={name:"auth0-spa-js",version:"2.4.1"},Tt=()=>Date.now();class At extends Error{constructor(e,t){super(t),this.error=e,this.error_description=t,Object.setPrototypeOf(this,At.prototype)}static fromPayload(e){let{error:t,error_description:n}=e;return new At(t,n)}}class Ct extends At{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e,t),this.state=n,this.appState=r,Object.setPrototypeOf(this,Ct.prototype)}}class Pt extends At{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,Pt.prototype)}}class It extends Pt{constructor(e){super(),this.popup=e,Object.setPrototypeOf(this,It.prototype)}}class kt extends At{constructor(e){super("cancelled","Popup closed"),this.popup=e,Object.setPrototypeOf(this,kt.prototype)}}class Mt extends At{constructor(e,t,n){super(e,t),this.mfa_token=n,Object.setPrototypeOf(this,Mt.prototype)}}class Rt extends At{constructor(e,t){super("missing_refresh_token",`Missing Refresh Token (audience: '${Lt(e,["default"])}', scope: '${Lt(t)}')`),this.audience=e,this.scope=t,Object.setPrototypeOf(this,Rt.prototype)}}class Ot extends At{constructor(e){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=e,Object.setPrototypeOf(this,Ot.prototype)}}function Lt(e){return e&&!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).includes(e)?e:""}const Dt=()=>window.crypto,Nt=()=>{const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.";let t="";return Array.from(Dt().getRandomValues(new Uint8Array(43))).forEach(n=>t+=e[n%66]),t},zt=e=>btoa(e),Ft=e=>{var{clientId:t}=e,n=_t(e,["clientId"]);return new URLSearchParams((e=>Object.keys(e).filter(t=>void 0!==e[t]).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:e[n]}),{}))(Object.assign({client_id:t},n))).toString()},Bt=e=>(e=>decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("")))(e.replace(/_/g,"/").replace(/-/g,"+")),jt=new TextEncoder,Ut=new TextDecoder;function Vt(e){return"string"==typeof e?jt.encode(e):Ut.decode(e)}function Gt(e){if("number"!=typeof e.modulusLength||e.modulusLength<2048)throw new qt(`${e.name} modulusLength must be at least 2048 bits`)}let Ht;if(Uint8Array.prototype.toBase64)Ht=e=>(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.toBase64({alphabet:"base64url",omitPadding:!0}));else{const e=32768;Ht=t=>{t instanceof ArrayBuffer&&(t=new Uint8Array(t));const n=[];for(let r=0;r<t.byteLength;r+=e)n.push(String.fromCharCode.apply(null,t.subarray(r,r+e)));return btoa(n.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}}function $t(e){return Ht(e)}class Wt extends Error{constructor(e){var t;super(null!=e?e:"operation not supported"),this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}class qt extends Error{constructor(e){var t;super(e),this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}function Xt(e){switch(e.algorithm.name){case"RSA-PSS":return function(e){if("SHA-256"===e.algorithm.hash.name)return"PS256";throw new Wt("unsupported RsaHashedKeyAlgorithm hash name")}(e);case"RSASSA-PKCS1-v1_5":return function(e){if("SHA-256"===e.algorithm.hash.name)return"RS256";throw new Wt("unsupported RsaHashedKeyAlgorithm hash name")}(e);case"ECDSA":return function(e){if("P-256"===e.algorithm.namedCurve)return"ES256";throw new Wt("unsupported EcKeyAlgorithm namedCurve")}(e);case"Ed25519":return"Ed25519";default:throw new Wt("unsupported CryptoKey algorithm name")}}function Zt(e){return e instanceof CryptoKey}function Kt(e){return Zt(e)&&"public"===e.type}async function Yt(e,t,n,r,i,o){const s=null==e?void 0:e.privateKey,a=null==e?void 0:e.publicKey;if(!Zt(l=s)||"private"!==l.type)throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var l;if(!Kt(a))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(!0!==a.extractable)throw new TypeError('"keypair.publicKey.extractable" must be true');if("string"!=typeof t)throw new TypeError('"htu" must be a string');if("string"!=typeof n)throw new TypeError('"htm" must be a string');if(void 0!==r&&"string"!=typeof r)throw new TypeError('"nonce" must be a string or undefined');if(void 0!==i&&"string"!=typeof i)throw new TypeError('"accessToken" must be a string or undefined');if(void 0!==o&&("object"!=typeof o||null===o||Array.isArray(o)))throw new TypeError('"additional" must be an object');return async function(e,t,n){if(!1===n.usages.includes("sign"))throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const r=`${$t(Vt(JSON.stringify(e)))}.${$t(Vt(JSON.stringify(t)))}`;return`${r}.${$t(await crypto.subtle.sign(function(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return Gt(e.algorithm),{name:e.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return Gt(e.algorithm),{name:e.algorithm.name};case"Ed25519":return{name:e.algorithm.name}}throw new Wt}(n),n,Vt(r)))}`}({alg:Xt(s),typ:"dpop+jwt",jwk:await Jt(a)},Object.assign(Object.assign({},o),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:n,nonce:r,htu:t,ath:i?$t(await crypto.subtle.digest("SHA-256",Vt(i))):void 0}),s)}async function Jt(e){const{kty:t,e:n,n:r,x:i,y:o,crv:s}=await crypto.subtle.exportKey("jwk",e);return{kty:t,crv:s,e:n,n:r,x:i,y:o}}const Qt=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange"];const en=async(e,t)=>{const n=await fetch(e,t);return{ok:n.ok,json:await n.json(),headers:(r=n.headers,[...r].reduce((e,t)=>{let[n,r]=t;return e[n]=r,e},{}))};var r},tn=async function(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4;return i?(async(e,t,n,r,i,o,s)=>{return a={auth:{audience:t,scope:n},timeout:i,fetchUrl:e,fetchOptions:r,useFormData:s},l=o,new Promise(function(e,t){const n=new MessageChannel;n.port1.onmessage=function(r){r.data.error?t(new Error(r.data.error)):e(r.data),n.port1.close()},l.postMessage(a,[n.port2])});var a,l})(e,t,n,r,s,i,o):(async(e,t,n)=>{const r=new AbortController;let i;return t.signal=r.signal,Promise.race([en(e,t),new Promise((e,t)=>{i=setTimeout(()=>{r.abort(),t(new Error("Timeout when executing 'fetch'"))},n)})]).finally(()=>{clearTimeout(i)})})(e,r,s)};async function nn(e,t,n,r,i,o,s,a,l){if(a){const t=await a.generateProof({url:e,method:i.method||"GET",nonce:await a.getNonce()});i.headers=Object.assign(Object.assign({},i.headers),{dpop:t})}let c,u=null;for(let y=0;y<3;y++)try{c=await tn(e,n,r,i,o,s,t),u=null;break}catch(_t){u=_t}if(u)throw u;const h=c.json,{error:d,error_description:f}=h,p=_t(h,["error","error_description"]),{headers:m,ok:g}=c;let _;if(a&&(_=m["dpop-nonce"],_&&await a.setNonce(_)),!g){const c=f||`HTTP error. Unable to fetch ${e}`;if("mfa_required"===d)throw new Mt(d,c,p.mfa_token);if("missing_refresh_token"===d)throw new Rt(n,r);if("use_dpop_nonce"===d){if(!a||!_||l)throw new Ot(_);return nn(e,t,n,r,i,o,s,a,!0)}throw new At(d||"request_error",c)}return p}async function rn(e,t){var{baseUrl:n,timeout:r,audience:i,scope:o,auth0Client:s,useFormData:a,dpop:l}=e,c=_t(e,["baseUrl","timeout","audience","scope","auth0Client","useFormData","dpop"]);const u="urn:ietf:params:oauth:grant-type:token-exchange"===c.grant_type,h=Object.assign(Object.assign(Object.assign({},c),u&&i&&{audience:i}),u&&o&&{scope:o}),d=a?Ft(h):JSON.stringify(h),f=(p=c.grant_type,Qt.includes(p));var p;return await nn(`${n}/oauth/token`,r,i||"default",o,{method:"POST",body:d,headers:{"Content-Type":a?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(s||Et))}},t,a,f?l:void 0)}const on=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(r=t.filter(Boolean).join(" ").trim().split(/\s+/),Array.from(new Set(r))).join(" ");var r};class sn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"@@auth0spajs@@",n=arguments.length>2?arguments[2]:void 0;this.prefix=t,this.suffix=n,this.clientId=e.clientId,this.scope=e.scope,this.audience=e.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(e){const[t,n,r,i]=e.split("::");return new sn({clientId:n,scope:i,audience:r},t)}static fromCacheEntry(e){const{scope:t,audience:n,client_id:r}=e;return new sn({scope:t,audience:n,clientId:r})}}class an{set(e,t){localStorage.setItem(e,JSON.stringify(t))}get(e){const t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return}}remove(e){localStorage.removeItem(e)}allKeys(){return Object.keys(window.localStorage).filter(e=>e.startsWith("@@auth0spajs@@"))}}class ln{constructor(){this.enclosedCache=function(){let e={};return{set(t,n){e[t]=n},get(t){const n=e[t];if(n)return n},remove(t){delete e[t]},allKeys:()=>Object.keys(e)}}()}}class cn{constructor(e,t,n){this.cache=e,this.keyManifest=t,this.nowProvider=n||Tt}async setIdToken(e,t,n){var r;const i=this.getIdTokenCacheKey(e);await this.cache.set(i,{id_token:t,decodedToken:n}),await(null===(r=this.keyManifest)||void 0===r?void 0:r.add(i))}async getIdToken(e){const t=await this.cache.get(this.getIdTokenCacheKey(e.clientId));if(!t&&e.scope&&e.audience){const t=await this.get(e);if(!t)return;if(!t.id_token||!t.decodedToken)return;return{id_token:t.id_token,decodedToken:t.decodedToken}}if(t)return{id_token:t.id_token,decodedToken:t.decodedToken}}async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var n;let r=await this.cache.get(e.toKey());if(!r){const t=await this.getCacheKeys();if(!t)return;const n=this.matchExistingCacheKey(e,t);n&&(r=await this.cache.get(n))}if(!r)return;const i=await this.nowProvider(),o=Math.floor(i/1e3);return r.expiresAt-t<o?r.body.refresh_token?(r.body={refresh_token:r.body.refresh_token},await this.cache.set(e.toKey(),r),r.body):(await this.cache.remove(e.toKey()),void await(null===(n=this.keyManifest)||void 0===n?void 0:n.remove(e.toKey()))):r.body}async set(e){var t;const n=new sn({clientId:e.client_id,scope:e.scope,audience:e.audience}),r=await this.wrapCacheEntry(e);await this.cache.set(n.toKey(),r),await(null===(t=this.keyManifest)||void 0===t?void 0:t.add(n.toKey()))}async clear(e){var t;const n=await this.getCacheKeys();n&&(await n.filter(t=>!e||t.includes(e)).reduce(async(e,t)=>{await e,await this.cache.remove(t)},Promise.resolve()),await(null===(t=this.keyManifest)||void 0===t?void 0:t.clear()))}async wrapCacheEntry(e){const t=await this.nowProvider();return{body:e,expiresAt:Math.floor(t/1e3)+e.expires_in}}async getCacheKeys(){var e;return this.keyManifest?null===(e=await this.keyManifest.get())||void 0===e?void 0:e.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(e){return new sn({clientId:e},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(e,t){return t.filter(t=>{var n;const r=sn.fromKey(t),i=new Set(r.scope&&r.scope.split(" ")),o=(null===(n=e.scope)||void 0===n?void 0:n.split(" "))||[],s=r.scope&&o.reduce((e,t)=>e&&i.has(t),!0);return"@@auth0spajs@@"===r.prefix&&r.clientId===e.clientId&&r.audience===e.audience&&s})[0]}}class un{constructor(e,t,n){this.storage=e,this.clientId=t,this.cookieDomain=n,this.storageKey=`a0.spajs.txs.${this.clientId}`}create(e){this.storage.save(this.storageKey,e,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const hn=e=>"number"==typeof e,dn=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"];var fn=xt(function(e,t){var n=yt&&yt.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t){if(!t)return"";var n="; "+e;return!0===t?n:n+"="+t}function i(e,t,n){return encodeURIComponent(e).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(t).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(e){if("number"==typeof e.expires){var t=new Date;t.setMilliseconds(t.getMilliseconds()+864e5*e.expires),e.expires=t}return r("Expires",e.expires?e.expires.toUTCString():"")+r("Domain",e.domain)+r("Path",e.path)+r("Secure",e.secure)+r("SameSite",e.sameSite)}(n)}function o(e){for(var t={},n=e?e.split("; "):[],r=/(%[\dA-F]{2})+/gi,i=0;i<n.length;i++){var o=n[i].split("="),s=o.slice(1).join("=");'"'===s.charAt(0)&&(s=s.slice(1,-1));try{t[o[0].replace(r,decodeURIComponent)]=s.replace(r,decodeURIComponent)}catch(e){}}return t}function s(){return o(document.cookie)}function a(e,t,r){document.cookie=i(e,t,n({path:"/"},r))}t.__esModule=!0,t.encode=i,t.parse=o,t.getAll=s,t.get=function(e){return s()[e]},t.set=a,t.remove=function(e,t){a(e,"",n(n({},t),{expires:-1}))}});vt(fn),fn.encode,fn.parse,fn.getAll;var pn=fn.get,mn=fn.set,gn=fn.remove;const _n={get(e){const t=pn(e);if(void 0!==t)return JSON.parse(t)},save(e,t,n){let r={};"https:"===window.location.protocol&&(r={secure:!0,sameSite:"none"}),(null==n?void 0:n.daysUntilExpire)&&(r.expires=n.daysUntilExpire),(null==n?void 0:n.cookieDomain)&&(r.domain=n.cookieDomain),mn(e,JSON.stringify(t),r)},remove(e,t){let n={};(null==t?void 0:t.cookieDomain)&&(n.domain=t.cookieDomain),gn(e,n)}},yn={get:e=>_n.get(e)||_n.get(`_legacy_${e}`),save(e,t,n){let r={};"https:"===window.location.protocol&&(r={secure:!0}),(null==n?void 0:n.daysUntilExpire)&&(r.expires=n.daysUntilExpire),(null==n?void 0:n.cookieDomain)&&(r.domain=n.cookieDomain),mn(`_legacy_${e}`,JSON.stringify(t),r),_n.save(e,t,n)},remove(e,t){let n={};(null==t?void 0:t.cookieDomain)&&(n.domain=t.cookieDomain),gn(e,n),_n.remove(e,t),_n.remove(`_legacy_${e}`,t)}},vn={get(e){if("undefined"==typeof sessionStorage)return;const t=sessionStorage.getItem(e);return null!=t?JSON.parse(t):void 0},save(e,t){sessionStorage.setItem(e,JSON.stringify(t))},remove(e){sessionStorage.removeItem(e)}};var xn,bn=function(e){return xn=xn||function(e,t,n){var r=void 0===t?null:t,i=function(e,t){var n=atob(e);if(t){for(var r=new Uint8Array(n.length),i=0,o=n.length;i<o;++i)r[i]=n.charCodeAt(i);return String.fromCharCode.apply(null,new Uint16Array(r.buffer))}return n}(e,void 0!==n&&n),o=i.indexOf("\n",10)+1,s=i.substring(o)+(r?"//# sourceMappingURL="+r:""),a=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(a)}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHIsdCl7c3VwZXIodCksdGhpcy5lcnJvcj1yLHRoaXMuZXJyb3JfZGVzY3JpcHRpb249dCxPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHtlcnJvcjpyLGVycm9yX2Rlc2NyaXB0aW9uOnR9KXtyZXR1cm4gbmV3IGUocix0KX19Y2xhc3MgciBleHRlbmRzIGV7Y29uc3RydWN0b3IoZSxzKXtzdXBlcigibWlzc2luZ19yZWZyZXNoX3Rva2VuIixgTWlzc2luZyBSZWZyZXNoIFRva2VuIChhdWRpZW5jZTogJyR7dChlLFsiZGVmYXVsdCJdKX0nLCBzY29wZTogJyR7dChzKX0nKWApLHRoaXMuYXVkaWVuY2U9ZSx0aGlzLnNjb3BlPXMsT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsci5wcm90b3R5cGUpfX1mdW5jdGlvbiB0KGUscj1bXSl7cmV0dXJuIGUmJiFyLmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDpyfT1lLHQ9ZnVuY3Rpb24oZSxyKXt2YXIgdD17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmci5pbmRleE9mKHMpPDAmJih0W3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspci5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYodFtzW29dXT1lW3Nbb11dKX1yZXR1cm4gdH0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHI9PnZvaWQgMCE9PWVbcl0pKS5yZWR1Y2UoKChyLHQpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scikse1t0XTplW3RdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnJ9LHQpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSxyKT0+YCR7ZX18JHtyfWA7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jKHtkYXRhOnt0aW1lb3V0OmUsYXV0aDp0LGZldGNoVXJsOmMsZmV0Y2hPcHRpb25zOmksdXNlRm9ybURhdGE6YX0scG9ydHM6W3BdfSk9PntsZXQgZix1PXt9O2NvbnN0e2F1ZGllbmNlOmQsc2NvcGU6aH09dHx8e307dHJ5e2NvbnN0IHQ9YT8oZT0+e2NvbnN0IHI9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSx0PXt9O3JldHVybiByLmZvckVhY2goKChlLHIpPT57dFtyXT1lfSkpLHR9KShpLmJvZHkpOkpTT04ucGFyc2UoaS5ib2R5KTtpZighdC5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT10LmdyYW50X3R5cGUpe2NvbnN0IGU9KChlLHIpPT5vW24oZSxyKV0pKGQsaCk7aWYoIWUpdGhyb3cgbmV3IHIoZCxoKTtpLmJvZHk9YT9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSx0KSx7cmVmcmVzaF90b2tlbjplfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSx0KSx7cmVmcmVzaF90b2tlbjplfSkpfWxldCB5LE87ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKHk9bmV3IEFib3J0Q29udHJvbGxlcixpLnNpZ25hbD15LnNpZ25hbCk7dHJ5e089YXdhaXQgUHJvbWlzZS5yYWNlKFsoZz1lLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsZykpKSksZmV0Y2goYyxPYmplY3QuYXNzaWduKHt9LGkpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHAucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFPKXJldHVybiB5JiZ5LmFib3J0KCksdm9pZCBwLnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO2w9Ty5oZWFkZXJzLHU9Wy4uLmxdLnJlZHVjZSgoKGUsW3IsdF0pPT4oZVtyXT10LGUpKSx7fSksZj1hd2FpdCBPLmpzb24oKSxmLnJlZnJlc2hfdG9rZW4/KCgoZSxyLHQpPT57b1tuKHIsdCldPWV9KShmLnJlZnJlc2hfdG9rZW4sZCxoKSxkZWxldGUgZi5yZWZyZXNoX3Rva2VuKTooKGUscik9PntkZWxldGUgb1tuKGUscildfSkoZCxoKSxwLnBvc3RNZXNzYWdlKHtvazpPLm9rLGpzb246ZixoZWFkZXJzOnV9KX1jYXRjaChlKXtwLnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcjplLmVycm9yLGVycm9yX2Rlc2NyaXB0aW9uOmUubWVzc2FnZX0saGVhZGVyczp1fSl9dmFyIGwsZ30pKX0oKTsKCg==",null,false),new Worker(xn,e)};const wn={};class Sn{constructor(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(e){var t;const n=new Set((null===(t=await this.cache.get(this.manifestKey))||void 0===t?void 0:t.keys)||[]);n.add(e),await this.cache.set(this.manifestKey,{keys:[...n]})}async remove(e){const t=await this.cache.get(this.manifestKey);if(t){const n=new Set(t.keys);return n.delete(e),n.size>0?await this.cache.set(this.manifestKey,{keys:[...n]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(e){return`@@auth0spajs@@::${e}`}}const En={memory:()=>(new ln).enclosedCache,localstorage:()=>new an},Tn=e=>En[e],An=e=>{const{openUrl:t,onRedirect:n}=e,r=_t(e,["openUrl","onRedirect"]);return Object.assign(Object.assign({},r),{openUrl:!1===t||t?t:n})},Cn={NONCE:"nonce",KEYPAIR:"keypair"};class Pn{constructor(e){this.clientId=e}getVersion(){return 1}createDbHandle(){const e=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((t,n)=>{e.onupgradeneeded=()=>Object.values(Cn).forEach(t=>e.result.createObjectStore(t)),e.onerror=()=>n(e.error),e.onsuccess=()=>t(e.result)})}async getDbHandle(){return this.dbHandle||(this.dbHandle=await this.createDbHandle()),this.dbHandle}async executeDbRequest(e,t,n){const r=n((await this.getDbHandle()).transaction(e,t).objectStore(e));return new Promise((e,t)=>{r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}buildKey(e){const t=e?`_${e}`:"auth0";return`${this.clientId}::${t}`}setNonce(e,t){return this.save(Cn.NONCE,this.buildKey(t),e)}setKeyPair(e){return this.save(Cn.KEYPAIR,this.buildKey(),e)}async save(e,t,n){await this.executeDbRequest(e,"readwrite",e=>e.put(n,t))}findNonce(e){return this.find(Cn.NONCE,this.buildKey(e))}findKeyPair(){return this.find(Cn.KEYPAIR,this.buildKey())}find(e,t){return this.executeDbRequest(e,"readonly",e=>e.get(t))}async deleteBy(e,t){const n=await this.executeDbRequest(e,"readonly",e=>e.getAllKeys());null==n||n.filter(t).map(t=>this.executeDbRequest(e,"readwrite",e=>e.delete(t)))}deleteByClientId(e,t){return this.deleteBy(e,e=>"string"==typeof e&&e.startsWith(`${t}::`))}clearNonces(){return this.deleteByClientId(Cn.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(Cn.KEYPAIR,this.clientId)}}class In{constructor(e){this.storage=new Pn(e)}getNonce(e){return this.storage.findNonce(e)}setNonce(e,t){return this.storage.setNonce(e,t)}async getOrGenerateKeyPair(){let e=await this.storage.findKeyPair();return e||(e=await async function(e,t){var n;let r;return r={name:"ECDSA",namedCurve:"P-256"},crypto.subtle.generateKey(r,null!==(n=null==t?void 0:t.extractable)&&void 0!==n&&n,["sign","verify"])}(0,{extractable:!1}),await this.storage.setKeyPair(e)),e}async generateProof(e){const t=await this.getOrGenerateKeyPair();return function(e){let{keyPair:t,url:n,method:r,nonce:i,accessToken:o}=e;const s=function(e){const t=new URL(e);return t.search="",t.hash="",t.href}(n);return Yt(t,s,r,i,o)}(Object.assign({keyPair:t},e))}async calculateThumbprint(){return function(e){return async function(e){if(!Kt(e))throw new TypeError('"publicKey" must be a public CryptoKey');if(!0!==e.extractable)throw new TypeError('"publicKey.extractable" must be true');const t=await Jt(e);let n;switch(t.kty){case"EC":n={crv:t.crv,kty:t.kty,x:t.x,y:t.y};break;case"OKP":n={crv:t.crv,kty:t.kty,x:t.x};break;case"RSA":n={e:t.e,kty:t.kty,n:t.n};break;default:throw new Wt("unsupported JWK kty")}return $t(await crypto.subtle.digest({name:"SHA-256"},Vt(JSON.stringify(n))))}(e.publicKey)}(await this.getOrGenerateKeyPair())}async clear(){await Promise.all([this.storage.clearNonces(),this.storage.clearKeyPairs()])}}class kn{constructor(e,t){this.hooks=t,this.config=Object.assign(Object.assign({},e),{fetch:e.fetch||("undefined"==typeof window?fetch:window.fetch.bind(window))})}isAbsoluteUrl(e){return/^(https?:)?\/\//i.test(e)}buildUrl(e,t){if(t){if(this.isAbsoluteUrl(t))return t;if(e)return`${e.replace(/\/?\/$/,"")}/${t.replace(/^\/+/,"")}`}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(){return this.config.getAccessToken?this.config.getAccessToken():this.hooks.getAccessToken()}buildBaseRequest(e,t){const n=new Request(e,t);return this.config.baseUrl?new Request(this.buildUrl(this.config.baseUrl,n.url),n):n}async setAuthorizationHeader(e,t){e.headers.set("authorization",`${this.config.dpopNonceId?"DPoP":"Bearer"} ${t}`)}async setDpopProofHeader(e,t){if(!this.config.dpopNonceId)return;const n=await this.hooks.getDpopNonce(),r=await this.hooks.generateDpopProof({accessToken:t,method:e.method,nonce:n,url:e.url});e.headers.set("dpop",r)}async prepareRequest(e){const t=await this.getAccessToken();this.setAuthorizationHeader(e,t),await this.setDpopProofHeader(e,t)}getHeader(e,t){return Array.isArray(e)?new Headers(e).get(t)||"":"function"==typeof e.get?e.get(t)||"":e[t]||""}hasUseDpopNonceError(e){return 401===e.status&&this.getHeader(e.headers,"www-authenticate").includes("use_dpop_nonce")}async handleResponse(e,t){const n=this.getHeader(e.headers,"dpop-nonce");if(n&&await this.hooks.setDpopNonce(n),!this.hasUseDpopNonceError(e))return e;if(!n||!t.onUseDpopNonceError)throw new Ot(n);return t.onUseDpopNonceError()}async internalFetchWithAuth(e,t,n){const r=this.buildBaseRequest(e,t);await this.prepareRequest(r);const i=await this.config.fetch(r);return this.handleResponse(i,n)}fetchWithAuth(e,t){const n={onUseDpopNonceError:()=>this.internalFetchWithAuth(e,t,Object.assign(Object.assign({},n),{onUseDpopNonceError:void 0}))};return this.internalFetchWithAuth(e,t,n)}}const Mn=new wt;class Rn{constructor(e){let t,n;if(this.userCache=(new ln).enclosedCache,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=async()=>{await Mn.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),e.authorizationParams)}),"undefined"!=typeof window&&(()=>{if(!Dt())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(void 0===Dt().subtle)throw new Error("\n      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.\n    ")})(),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)n=e.cache;else{if(t=e.cacheLocation||"memory",!Tn(t))throw new Error(`Invalid cache location "${t}"`);n=Tn(t)()}this.httpTimeoutMs=e.httpTimeoutInSeconds?1e3*e.httpTimeoutInSeconds:1e4,this.cookieStorage=!1===e.legacySameSiteCookie?_n:yn,this.orgHintCookieName=`auth0.${this.options.clientId}.organization_hint`,this.isAuthenticatedCookieName=(()=>`auth0.${this.options.clientId}.is.authenticated`)(),this.sessionCheckExpiryDays=e.sessionCheckExpiryDays||1;const r=e.useCookiesForTransactions?this.cookieStorage:vn;var i;this.scope=on("openid",this.options.authorizationParams.scope,this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new un(r,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||Tt,this.cacheManager=new cn(n,n.allKeys?void 0:new Sn(n,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new In(this.options.clientId):void 0,this.domainUrl=(i=this.options.domain,/^https?:\/\//.test(i)?i:`https://${i}`),this.tokenIssuer=((e,t)=>e?e.startsWith("https://")?e:`https://${e}/`:`${t}/`)(this.options.issuer,this.domainUrl),"undefined"!=typeof window&&window.Worker&&this.options.useRefreshTokens&&"memory"===t&&(this.options.workerUrl?this.worker=new Worker(this.options.workerUrl):this.worker=new bn)}_url(e){const t=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||Et)));return`${this.domainUrl}${e}&auth0Client=${t}`}_authorizeUrl(e){return this._url(`/authorize?${Ft(e)}`)}async _verifyIdToken(e,t,n){const r=await this.nowProvider();return(e=>{if(!e.id_token)throw new Error("ID token is required but missing");const t=(e=>{const t=e.split("."),[n,r,i]=t;if(3!==t.length||!n||!r||!i)throw new Error("ID token could not be decoded");const o=JSON.parse(Bt(r)),s={__raw:e},a={};return Object.keys(o).forEach(e=>{s[e]=o[e],dn.includes(e)||(a[e]=o[e])}),{encoded:{header:n,payload:r,signature:i},header:JSON.parse(Bt(n)),claims:s,user:a}})(e.id_token);if(!t.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(t.claims.iss!==e.iss)throw new Error(`Issuer (iss) claim mismatch in the ID token; expected "${e.iss}", found "${t.claims.iss}"`);if(!t.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==t.header.alg)throw new Error(`Signature algorithm of "${t.header.alg}" is not supported. Expected the ID token to be signed with "RS256".`);if(!t.claims.aud||"string"!=typeof t.claims.aud&&!Array.isArray(t.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e.aud))throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${e.aud}" but was not one of "${t.claims.aud.join(", ")}"`);if(t.claims.aud.length>1){if(!t.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(t.claims.azp!==e.aud)throw new Error(`Authorized Party (azp) claim mismatch in the ID token; expected "${e.aud}", found "${t.claims.azp}"`)}}else if(t.claims.aud!==e.aud)throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${e.aud}" but found "${t.claims.aud}"`);if(e.nonce){if(!t.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(t.claims.nonce!==e.nonce)throw new Error(`Nonce (nonce) claim mismatch in the ID token; expected "${e.nonce}", found "${t.claims.nonce}"`)}if(e.max_age&&!hn(t.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(null==t.claims.exp||!hn(t.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!hn(t.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const n=e.leeway||60,r=new Date(e.now||Date.now()),i=new Date(0);if(i.setUTCSeconds(t.claims.exp+n),r>i)throw new Error(`Expiration Time (exp) claim error in the ID token; current time (${r}) is after expiration time (${i})`);if(null!=t.claims.nbf&&hn(t.claims.nbf)){const e=new Date(0);if(e.setUTCSeconds(t.claims.nbf-n),r<e)throw new Error(`Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (${r}) is before ${e}`)}if(null!=t.claims.auth_time&&hn(t.claims.auth_time)){const i=new Date(0);if(i.setUTCSeconds(parseInt(t.claims.auth_time)+e.max_age+n),r>i)throw new Error(`Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (${r}) is after last auth at ${i}`)}if(e.organization){const n=e.organization.trim();if(n.startsWith("org_")){const e=n;if(!t.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(e!==t.claims.org_id)throw new Error(`Organization ID (org_id) claim mismatch in the ID token; expected "${e}", found "${t.claims.org_id}"`)}else{const e=n.toLowerCase();if(!t.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(e!==t.claims.org_name)throw new Error(`Organization Name (org_name) claim mismatch in the ID token; expected "${e}", found "${t.claims.org_name}"`)}}return t})({iss:this.tokenIssuer,aud:this.options.clientId,id_token:e,nonce:t,organization:n,leeway:this.options.leeway,max_age:(i=this.options.authorizationParams.max_age,"string"!=typeof i?i:parseInt(i,10)||void 0),now:r});var i}_processOrgHint(e){e?this.cookieStorage.save(this.orgHintCookieName,e,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(e,t,n){var r;const i=zt(Nt()),o=zt(Nt()),s=Nt(),a=(e=>{const t=new Uint8Array(e);return(e=>{const t={"+":"-","/":"_","=":""};return e.replace(/[+/=]/g,e=>t[e])})(window.btoa(String.fromCharCode(...Array.from(t))))})(await(async e=>{const t=Dt().subtle.digest({name:"SHA-256"},(new TextEncoder).encode(e));return await t})(s)),l=await(null===(r=this.dpop)||void 0===r?void 0:r.calculateThumbprint()),c=((e,t,n,r,i,o,s,a,l)=>Object.assign(Object.assign(Object.assign({client_id:e.clientId},e.authorizationParams),n),{scope:on(t,n.scope),response_type:"code",response_mode:a||"query",state:r,nonce:i,redirect_uri:s||e.authorizationParams.redirect_uri,code_challenge:o,code_challenge_method:"S256",dpop_jkt:l}))(this.options,this.scope,e,i,o,a,e.redirect_uri||this.options.authorizationParams.redirect_uri||n,null==t?void 0:t.response_mode,l),u=this._authorizeUrl(c);return{nonce:o,code_verifier:s,scope:c.scope,audience:c.audience||"default",redirect_uri:c.redirect_uri,state:i,url:u}}async loginWithPopup(e,t){var n;if(e=e||{},!(t=t||{}).popup&&(t.popup=(()=>{const e=window.screenX+(window.innerWidth-400)/2,t=window.screenY+(window.innerHeight-600)/2;return window.open("","auth0:authorize:popup",`left=${e},top=${t},width=400,height=600,resizable,scrollbars=yes,status=1`)})(),!t.popup))throw new Error("Unable to open a popup for loginWithPopup - window.open returned `null`");const r=await this._prepareAuthorizeUrl(e.authorizationParams||{},{response_mode:"web_message"},window.location.origin);t.popup.location.href=r.url;const i=await(e=>new Promise((t,n)=>{let r;const i=setInterval(()=>{e.popup&&e.popup.closed&&(clearInterval(i),clearTimeout(o),window.removeEventListener("message",r,!1),n(new kt(e.popup)))},1e3),o=setTimeout(()=>{clearInterval(i),n(new It(e.popup)),window.removeEventListener("message",r,!1)},1e3*(e.timeoutInSeconds||60));r=function(s){if(s.data&&"authorization_response"===s.data.type){if(clearTimeout(o),clearInterval(i),window.removeEventListener("message",r,!1),e.popup.close(),s.data.response.error)return n(At.fromPayload(s.data.response));t(s.data.response)}},window.addEventListener("message",r)}))(Object.assign(Object.assign({},t),{timeoutInSeconds:t.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}));if(r.state!==i.state)throw new At("state_mismatch","Invalid state");const o=(null===(n=e.authorizationParams)||void 0===n?void 0:n.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:r.audience,scope:r.scope,code_verifier:r.code_verifier,grant_type:"authorization_code",code:i.code,redirect_uri:r.redirect_uri},{nonceIn:r.nonce,organization:o})}async getUser(){var e;const t=await this._getIdTokenFromCache();return null===(e=null==t?void 0:t.decodedToken)||void 0===e?void 0:e.user}async getIdTokenClaims(){var e;const t=await this._getIdTokenFromCache();return null===(e=null==t?void 0:t.decodedToken)||void 0===e?void 0:e.claims}async loginWithRedirect(){var e;const t=An(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),{openUrl:n,fragment:r,appState:i}=t,o=_t(t,["openUrl","fragment","appState"]),s=(null===(e=o.authorizationParams)||void 0===e?void 0:e.organization)||this.options.authorizationParams.organization,a=await this._prepareAuthorizeUrl(o.authorizationParams||{}),{url:l}=a,c=_t(a,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},c),{appState:i}),s&&{organization:s}));const u=r?`${l}#${r}`:l;n?await n(u):window.location.assign(u)}async handleRedirectCallback(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href).split("?").slice(1);if(0===e.length)throw new Error("There are no query params available for parsing.");const{state:t,code:n,error:r,error_description:i}=(e=>{e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#")));const t=new URLSearchParams(e);return{state:t.get("state"),code:t.get("code")||void 0,error:t.get("error")||void 0,error_description:t.get("error_description")||void 0}})(e.join("")),o=this.transactionManager.get();if(!o)throw new At("missing_transaction","Invalid state");if(this.transactionManager.remove(),r)throw new Ct(r,i||r,t,o.appState);if(!o.code_verifier||o.state&&o.state!==t)throw new At("state_mismatch","Invalid state");const s=o.organization,a=o.nonce,l=o.redirect_uri;return await this._requestToken(Object.assign({audience:o.audience,scope:o.scope,code_verifier:o.code_verifier,grant_type:"authorization_code",code:n},l?{redirect_uri:l}:{}),{nonceIn:a,organization:s}),{appState:o.appState}}async checkSession(e){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(e)}catch(e){}}async getTokenSilently(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;const n=Object.assign(Object.assign({cacheMode:"on"},e),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),e.authorizationParams),{scope:on(this.scope,null===(t=e.authorizationParams)||void 0===t?void 0:t.scope)})}),r=await((e,t)=>{let n=wn[t];return n||(n=e().finally(()=>{delete wn[t],n=null}),wn[t]=n),n})(()=>this._getTokenSilently(n),`${this.options.clientId}::${n.authorizationParams.audience}::${n.authorizationParams.scope}`);return e.detailedResponse?r:null==r?void 0:r.access_token}async _getTokenSilently(e){const{cacheMode:t}=e,n=_t(e,["cacheMode"]);if("off"!==t){const e=await this._getEntryFromCache({scope:n.authorizationParams.scope,audience:n.authorizationParams.audience||"default",clientId:this.options.clientId});if(e)return e}if("cache-only"!==t){if(!await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let n=0;n<t;n++)if(await e())return!0;return!1}(()=>Mn.acquireLock("auth0.lock.getTokenSilently",5e3),10))throw new Pt;try{if(window.addEventListener("pagehide",this._releaseLockOnPageHide),"off"!==t){const e=await this._getEntryFromCache({scope:n.authorizationParams.scope,audience:n.authorizationParams.audience||"default",clientId:this.options.clientId});if(e)return e}const e=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(n):await this._getTokenFromIFrame(n),{id_token:r,token_type:i,access_token:o,oauthTokenScope:s,expires_in:a}=e;return Object.assign(Object.assign({id_token:r,token_type:i,access_token:o},s?{scope:s}:null),{expires_in:a})}finally{await Mn.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)}}}async getTokenWithPopup(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const r=Object.assign(Object.assign({},e),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),e.authorizationParams),{scope:on(this.scope,null===(n=e.authorizationParams)||void 0===n?void 0:n.scope)})});return t=Object.assign(Object.assign({},St),t),await this.loginWithPopup(r,t),(await this.cacheManager.get(new sn({scope:r.authorizationParams.scope,audience:r.authorizationParams.audience||"default",clientId:this.options.clientId}))).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(e){null!==e.clientId?e.clientId=e.clientId||this.options.clientId:delete e.clientId;const t=e.logoutParams||{},{federated:n}=t,r=_t(t,["federated"]),i=n?"&federated":"";return this._url(`/v2/logout?${Ft(Object.assign({clientId:e.clientId},r))}`)+i}async logout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;const n=An(e),{openUrl:r}=n,i=_t(n,["openUrl"]);null===e.clientId?await this.cacheManager.clear():await this.cacheManager.clear(e.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@"),await(null===(t=this.dpop)||void 0===t?void 0:t.clear());const o=this._buildLogoutUrl(i);r?await r(o):!1!==r&&window.location.assign(o)}async _getTokenFromIFrame(e){const t=Object.assign(Object.assign({},e.authorizationParams),{prompt:"none"}),n=this.cookieStorage.get(this.orgHintCookieName);n&&!t.organization&&(t.organization=n);const{url:r,state:i,nonce:o,code_verifier:s,redirect_uri:a,scope:l,audience:c}=await this._prepareAuthorizeUrl(t,{response_mode:"web_message"},window.location.origin);try{if(window.crossOriginIsolated)throw new At("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const n=e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds;let u;try{u=new URL(this.domainUrl).origin}catch(e){u=this.domainUrl}const h=await function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return new Promise((r,i)=>{const o=window.document.createElement("iframe");o.setAttribute("width","0"),o.setAttribute("height","0"),o.style.display="none";const s=()=>{window.document.body.contains(o)&&(window.document.body.removeChild(o),window.removeEventListener("message",a,!1))};let a;const l=setTimeout(()=>{i(new Pt),s()},1e3*n);a=function(e){if(e.origin!=t)return;if(!e.data||"authorization_response"!==e.data.type)return;const n=e.source;n&&n.close(),e.data.response.error?i(At.fromPayload(e.data.response)):r(e.data.response),clearTimeout(l),window.removeEventListener("message",a,!1),setTimeout(s,2e3)},window.addEventListener("message",a,!1),window.document.body.appendChild(o),o.setAttribute("src",e)})}(r,u,n);if(i!==h.state)throw new At("state_mismatch","Invalid state");const d=await this._requestToken(Object.assign(Object.assign({},e.authorizationParams),{code_verifier:s,code:h.code,grant_type:"authorization_code",redirect_uri:a,timeout:e.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:o,organization:t.organization});return Object.assign(Object.assign({},d),{scope:l,oauthTokenScope:d.scope,audience:c})}catch(e){throw"login_required"===e.error&&this.logout({openUrl:!1}),e}}async _getTokenUsingRefreshToken(e){const t=await this.cacheManager.get(new sn({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId}));if(!(t&&t.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw new Rt(e.authorizationParams.audience||"default",e.authorizationParams.scope)}const n=e.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,r="number"==typeof e.timeoutInSeconds?1e3*e.timeoutInSeconds:null;try{const i=await this._requestToken(Object.assign(Object.assign(Object.assign({},e.authorizationParams),{grant_type:"refresh_token",refresh_token:t&&t.refresh_token,redirect_uri:n}),r&&{timeout:r}));return Object.assign(Object.assign({},i),{scope:e.authorizationParams.scope,oauthTokenScope:i.scope,audience:e.authorizationParams.audience||"default"})}catch(t){if((t.message.indexOf("Missing Refresh Token")>-1||t.message&&t.message.indexOf("invalid refresh token")>-1)&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw t}}async _saveEntryInCache(e){const{id_token:t,decodedToken:n}=e,r=_t(e,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:t,decodedToken:n}),await this.cacheManager.setIdToken(this.options.clientId,e.id_token,e.decodedToken),await this.cacheManager.set(r)}async _getIdTokenFromCache(){const e=this.options.authorizationParams.audience||"default",t=await this.cacheManager.getIdToken(new sn({clientId:this.options.clientId,audience:e,scope:this.scope})),n=this.userCache.get("@@user@@");return t&&t.id_token===(null==n?void 0:n.id_token)?n:(this.userCache.set("@@user@@",t),t)}async _getEntryFromCache(e){let{scope:t,audience:n,clientId:r}=e;const i=await this.cacheManager.get(new sn({scope:t,audience:n,clientId:r}),60);if(i&&i.access_token){const{token_type:e,access_token:t,oauthTokenScope:n,expires_in:r}=i,o=await this._getIdTokenFromCache();return o&&Object.assign(Object.assign({id_token:o.id_token,token_type:e||"Bearer",access_token:t},n?{scope:n}:null),{expires_in:r})}}async _requestToken(e,t){const{nonceIn:n,organization:r}=t||{},i=await rn(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs,dpop:this.dpop},e),this.worker),o=await this._verifyIdToken(i.id_token,n,r);return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},i),{decodedToken:o,scope:e.scope,audience:e.audience||"default"}),i.scope?{oauthTokenScope:i.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(r||o.claims.org_id),Object.assign(Object.assign({},i),{decodedToken:o})}async exchangeToken(e){return this._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:e.subject_token,subject_token_type:e.subject_token_type,scope:on(e.scope,this.scope),audience:e.audience||this.options.authorizationParams.audience})}_assertDpop(e){if(!e)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(e){return this._assertDpop(this.dpop),this.dpop.getNonce(e)}setDpopNonce(e,t){return this._assertDpop(this.dpop),this.dpop.setNonce(e,t)}generateDpopProof(e){return this._assertDpop(this.dpop),this.dpop.generateProof(e)}createFetcher(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.options.useDpop&&!e.dpopNonceId)throw new TypeError("When `useDpop` is enabled, `dpopNonceId` must be set when calling `createFetcher()`.");return new kn(e,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:()=>this.getTokenSilently(),getDpopNonce:()=>this.getDpopNonce(e.dpopNonceId),setDpopNonce:e=>this.setDpopNonce(e),generateDpopProof:e=>this.generateDpopProof(e)})}}var On={isAuthenticated:!1,isLoading:!0,error:void 0,user:void 0},Ln=function(){throw new Error("You forgot to wrap your component in <Auth0Provider>.")},Dn=pt(pt({},On),{buildAuthorizeUrl:Ln,buildLogoutUrl:Ln,getAccessTokenSilently:Ln,getAccessTokenWithPopup:Ln,getIdTokenClaims:Ln,loginWithRedirect:Ln,loginWithPopup:Ln,logout:Ln,handleRedirectCallback:Ln,getDpopNonce:Ln,setDpopNonce:Ln,generateDpopProof:Ln,createFetcher:Ln}),Nn=(0,i.createContext)(Dn),zn=function(e){function t(n,r){var i=e.call(this,null!==r&&void 0!==r?r:n)||this;return i.error=n,i.error_description=r,Object.setPrototypeOf(i,t.prototype),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ft(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error),Fn=/[?&]code=[^&]+/,Bn=/[?&]state=[^&]+/,jn=/[?&]error=[^&]+/,Un=function(e){return function(t){return t instanceof Error?t:null!==t&&"object"===typeof t&&"error"in t&&"string"===typeof t.error?"error_description"in t&&"string"===typeof t.error_description?new zn(t.error,t.error_description):new zn(t.error):new Error(e)}},Vn=Un("Login failed"),Gn=Un("Get access token failed"),Hn=function(e){var t,n;(null===e||void 0===e?void 0:e.redirectUri)&&(console.warn("Using `redirectUri` has been deprecated, please use `authorizationParams.redirect_uri` instead as `redirectUri` will be no longer supported in a future version"),e.authorizationParams=null!==(t=e.authorizationParams)&&void 0!==t?t:{},e.authorizationParams.redirect_uri=e.redirectUri,delete e.redirectUri),(null===(n=null===e||void 0===e?void 0:e.authorizationParams)||void 0===n?void 0:n.redirectUri)&&(console.warn("Using `authorizationParams.redirectUri` has been deprecated, please use `authorizationParams.redirect_uri` instead as `authorizationParams.redirectUri` will be removed in a future version"),e.authorizationParams.redirect_uri=e.authorizationParams.redirectUri,delete e.authorizationParams.redirectUri)},$n=function(e,t){switch(t.type){case"LOGIN_POPUP_STARTED":return pt(pt({},e),{isLoading:!0});case"LOGIN_POPUP_COMPLETE":case"INITIALISED":return pt(pt({},e),{isAuthenticated:!!t.user,user:t.user,isLoading:!1,error:void 0});case"HANDLE_REDIRECT_COMPLETE":case"GET_ACCESS_TOKEN_COMPLETE":return e.user===t.user?e:pt(pt({},e),{isAuthenticated:!!t.user,user:t.user});case"LOGOUT":return pt(pt({},e),{isAuthenticated:!1,user:void 0});case"ERROR":return pt(pt({},e),{isLoading:!1,error:t.error})}},Wn=function(e){var t;window.history.replaceState({},document.title,null!==(t=null===e||void 0===e?void 0:e.returnTo)&&void 0!==t?t:window.location.pathname)},qn=function(e){var t=e.children,n=e.skipRedirectCallback,r=e.onRedirectCallback,o=void 0===r?Wn:r,s=e.context,a=void 0===s?Nn:s,l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["children","skipRedirectCallback","onRedirectCallback","context"]),c=(0,i.useState)(function(){return new Rn(function(e){return Hn(e),pt(pt({},e),{auth0Client:{name:"auth0-react",version:"2.5.0"}})}(l))})[0],u=(0,i.useReducer)($n,On),h=u[0],d=u[1],f=(0,i.useRef)(!1),p=(0,i.useCallback)(function(e){return d({type:"ERROR",error:e}),e},[]);(0,i.useEffect)(function(){f.current||(f.current=!0,mt(void 0,void 0,void 0,function(){var e,t,r;return gt(this,function(i){switch(i.label){case 0:return i.trys.push([0,7,,8]),e=void 0,void 0===s&&(s=window.location.search),!Fn.test(s)&&!jn.test(s)||!Bn.test(s)||n?[3,3]:[4,c.handleRedirectCallback()];case 1:return t=i.sent().appState,[4,c.getUser()];case 2:return e=i.sent(),o(t,e),[3,6];case 3:return[4,c.checkSession()];case 4:return i.sent(),[4,c.getUser()];case 5:e=i.sent(),i.label=6;case 6:return d({type:"INITIALISED",user:e}),[3,8];case 7:return r=i.sent(),p(Vn(r)),[3,8];case 8:return[2]}var s})}))},[c,o,n,p]);var m=(0,i.useCallback)(function(e){return Hn(e),c.loginWithRedirect(e)},[c]),g=(0,i.useCallback)(function(e,t){return mt(void 0,void 0,void 0,function(){var n,r;return gt(this,function(i){switch(i.label){case 0:d({type:"LOGIN_POPUP_STARTED"}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,c.loginWithPopup(e,t)];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),p(Vn(n)),[2];case 4:return[4,c.getUser()];case 5:return r=i.sent(),d({type:"LOGIN_POPUP_COMPLETE",user:r}),[2]}})})},[c,p]),_=(0,i.useCallback)(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return mt(void 0,function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([],e,!0),void 0,function(e){return void 0===e&&(e={}),gt(this,function(t){switch(t.label){case 0:return[4,c.logout(e)];case 1:return t.sent(),(e.openUrl||!1===e.openUrl)&&d({type:"LOGOUT"}),[2]}})})},[c]),y=(0,i.useCallback)(function(e){return mt(void 0,void 0,void 0,function(){var t,n,r,i;return gt(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,3,5]),[4,c.getTokenSilently(e)];case 1:return t=o.sent(),[3,5];case 2:throw n=o.sent(),Gn(n);case 3:return r=d,i={type:"GET_ACCESS_TOKEN_COMPLETE"},[4,c.getUser()];case 4:return r.apply(void 0,[(i.user=o.sent(),i)]),[7];case 5:return[2,t]}})})},[c]),v=(0,i.useCallback)(function(e,t){return mt(void 0,void 0,void 0,function(){var n,r,i,o;return gt(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,3,5]),[4,c.getTokenWithPopup(e,t)];case 1:return n=s.sent(),[3,5];case 2:throw r=s.sent(),Gn(r);case 3:return i=d,o={type:"GET_ACCESS_TOKEN_COMPLETE"},[4,c.getUser()];case 4:return i.apply(void 0,[(o.user=s.sent(),o)]),[7];case 5:return[2,n]}})})},[c]),x=(0,i.useCallback)(function(){return c.getIdTokenClaims()},[c]),b=(0,i.useCallback)(function(e){return mt(void 0,void 0,void 0,function(){var t,n,r;return gt(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,3,5]),[4,c.handleRedirectCallback(e)];case 1:return[2,i.sent()];case 2:throw t=i.sent(),Gn(t);case 3:return n=d,r={type:"HANDLE_REDIRECT_COMPLETE"},[4,c.getUser()];case 4:return n.apply(void 0,[(r.user=i.sent(),r)]),[7];case 5:return[2]}})})},[c]),w=(0,i.useCallback)(function(e){return c.getDpopNonce(e)},[c]),S=(0,i.useCallback)(function(e,t){return c.setDpopNonce(e,t)},[c]),E=(0,i.useCallback)(function(e){return c.generateDpopProof(e)},[c]),T=(0,i.useCallback)(function(e){return c.createFetcher(e)},[c]),A=(0,i.useMemo)(function(){return pt(pt({},h),{getAccessTokenSilently:y,getAccessTokenWithPopup:v,getIdTokenClaims:x,loginWithRedirect:m,loginWithPopup:g,logout:_,handleRedirectCallback:b,getDpopNonce:w,setDpopNonce:S,generateDpopProof:E,createFetcher:T})},[h,y,v,x,m,g,_,b,w,S,E,T]);return i.createElement(a.Provider,{value:A},t)},Xn=function(e){return void 0===e&&(e=Nn),(0,i.useContext)(e)},Zn=n(6111),Kn=n.n(Zn);"https://demo-chat.isdata.ai".startsWith("https://")||console.warn("Insecure API endpoint configured for production environment. Please use https.");const Yn="https://demo-chat.isdata.ai",Jn="/data/query",Qn="0S0290SN1929VM192SDSsld239092@%^&*341267812",er=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{area:t="USM",startDate:n=new Date("Fri Aug 01 2025 11:00:00 GMT-0700 (Pacific Daylight Time)"),endDate:r}=e,i=`SELECT lat, lon, depth, direction, ndirection, salinity, temp, nspeed, time, ssh, pressure_dbars, sound_speed_ms FROM \`isdata-usmcom.usm_com.${(e=>{const t={MBL:"mbl_ngofs2",MSR:"msr_ngofs2",USM:"usm_ngofs2"};return t[e]||t.USM})(t)}\``,o=[];if(n&&r){const e=n.toISOString(),t=r.toISOString();o.push(`time BETWEEN TIMESTAMP('${e}') AND TIMESTAMP('${t}')`)}let s=i;o.length>0&&(s+=` WHERE ${o.join(" AND ")}`),s+=" ORDER BY time DESC LIMIT 10000";try{const e=`${Yn}${Jn}?query=${encodeURIComponent(s)}`,n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization",`Bearer ${Qn}`);const r={method:"GET",headers:n,redirect:"follow"},i=await fetch(e,r);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const o=await i.json();return{allData:o.map(e=>({...e,model:"NGOFS2",area:t,_source_file:`API_${t}`,_loaded_at:(new Date).toISOString()}))}}catch(a){return console.error(`Failed to load data for area ${t} with params ${JSON.stringify(e)}:`,a),{allData:[]}}},tr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||0===e.length)return console.log("No data to process"),[];let r=e.filter(e=>{if(null===e.nspeed||void 0===e.nspeed||""===e.nspeed)return!1;if(void 0!==e.depth&&null!==e.depth&&void 0!==t){return Math.abs(e.depth-t)<=5}return!0});r.sort((e,t)=>e.time&&t.time?new Date(e.time)-new Date(t.time):0);return(n?r.slice(-n):r).map((e,t)=>({depth:e.depth||0,time:nr(e.time),timestamp:e.time?new Date(e.time):new Date,heading:e.direction||0,currentSpeed:e.nspeed||0,soundSpeed:e.sound_speed_ms||0,waveHeight:e.ssh||0,temperature:e.temp||null,latitude:e.lat,longitude:e.lon,salinity:e.salinity||null,pressure:e.pressure_dbars||null,sourceFile:e._source_file,model:e.model,area:e.area}))},nr=e=>{if(!e)return"00:00";try{return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch(t){return"00:00"}},rr=e=>{if(!e||0===e.length)return[];const t=new Map,n=e.length>0?e[0].area:null;return e.forEach((e,r)=>{if(e.lat&&e.lon&&!isNaN(e.lat)&&!isNaN(e.lon)){const i=4,o=`${e.lat.toFixed(i)},${e.lon.toFixed(i)}`;t.has(o)||t.set(o,{name:`Station at ${e.lat.toFixed(4)}, ${e.lon.toFixed(4)}`,coordinates:[e.lon,e.lat],exactLat:e.lat,exactLon:e.lon,type:"api_station",color:[255*Math.random(),255*Math.random(),255*Math.random()],dataPoints:0,sourceFiles:new Set,allDataPoints:[],model:"NGOFS2",area:n});const s=t.get(o);s.dataPoints++,e._source_file&&s.sourceFiles.add(e._source_file),s.allDataPoints.push({...e,rowIndex:r})}}),Array.from(t.values()).map(e=>({...e,sourceFiles:Array.from(e.sourceFiles)}))};"https://demo-chat.isdata.ai".startsWith("https://")||console.warn("Insecure API endpoint configured for production environment. Please use https.");const ir="https://demo-chat.isdata.ai",or="https://demo-chat.isdata.ai/healthz",sr="/chat/",ar=6e5,lr="0S0290SN1929VM192SDSsld239092@%^&*341267812",cr=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const r=await ur(e,t,n);if(r)return r;throw new Error("Empty response from API")}catch(r){throw console.error("API request failed:",r.message),new Error(`AI service unavailable: ${r.message}`)}},ur=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new AbortController,i=setTimeout(()=>r.abort(),ar);try{const o=hr(e,t,n),s=new Headers;s.append("Authorization",`Bearer ${lr}`),s.append("Content-Type","application/json");const a={method:"POST",headers:s,body:JSON.stringify(o),signal:r.signal},l=await fetch(`${ir}${sr}`,a);if(clearTimeout(i),!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const c=await l.json();return dr(c)}catch(o){if(clearTimeout(i),"AbortError"===o.name)throw new Error("API request timed out");throw o}},hr=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const{currentData:r,timeSeriesData:i=[],dataSource:o="simulated",selectedDepth:s=0,selectedModel:a="NGOSF2",selectedParameter:l="Current Speed",selectedArea:c="USM",playbackSpeed:u=1,holoOceanPOV:h={x:0,y:0,depth:0},currentFrame:d=0,totalFrames:f=24,startDate:p,endDate:m,envData:g={}}=t,_=e=>(e&&e instanceof Date&&!isNaN(e)?e:new Date("2025-08-01T12:00:00Z")).toISOString().split("T")[0],y=`${_(p)} to ${_(m||p)}`;return{input:e,filters:{area:c,date_range:y,depth:`${s} meters`,domain:"oceanography",model:a,parameter:l,data_source:o,frame:d,total_frames:f,playback_speed:u,data_points:i.length,pov_x:h.x,pov_y:h.y,pov_depth:h.depth,current_speed:r?r.currentSpeed:null,heading:r?r.heading:null,wave_height:r?r.waveHeight:null,temperature:r?r.temperature:null,system_prompt:`You are CubeAI, an expert oceanographic analysis assistant for the University of Southern Mississippi's marine science platform. \n    You analyze real-time ocean data including currents, waves, temperature, and environmental conditions. \n    Provide technical yet accessible responses focused on maritime safety, research insights, and data interpretation.\n    Current context: ${c} at ${s} meters depth using ${a} model for the date range ${y}.`},thread_id:n||`ocean_session_${Date.now()}`}},dr=e=>{if(e.run_items&&Array.isArray(e.run_items))for(const t of e.run_items)if(t.content&&Array.isArray(t.content))for(const e of t.content)if("output_text"===e.type&&e.text)return e.text;if(e.response)return e.response;if(e.message)return e.message;if(e.content)return e.content;if(e.text)return e.text;if(e.output)return e.output;if(e.result)return e.result;if("string"===typeof e)return e;throw new Error("Invalid API response format")},fr=async()=>{try{const e=new AbortController,t=setTimeout(()=>e.abort(),6e5),n=new Headers;n.append("Authorization",`Bearer ${lr}`),n.append("Content-Type","application/json");const r={method:"GET",headers:n,signal:e.signal},i=await fetch(`${or}`,r);return clearTimeout(t),i.ok}catch(e){return!1}},pr=async()=>({connected:await fr(),endpoint:`${ir}${sr}`,timestamp:(new Date).toISOString(),hasApiKey:!0});let mr=null;const gr=()=>mr,_r={setItem:(e,t)=>{const n=gr();if(n){const r=Kn().AES.encrypt(JSON.stringify(t),n).toString();localStorage.setItem(e,r)}else console.warn("Session key not set. Data will not be encrypted."),localStorage.setItem(e,JSON.stringify(t))},getItem:e=>{const t=gr(),n=localStorage.getItem(e);if(t&&n)try{const e=Kn().AES.decrypt(n,t).toString(Kn().enc.Utf8);return JSON.parse(e)}catch(r){return console.error("Error decrypting data from localStorage:",r),null}else try{return JSON.parse(n)}catch(r){return n}},removeItem:e=>{localStorage.removeItem(e)}},yr=_r,vr=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(null),[o,s]=(0,i.useState)(!1),[a,l]=(0,i.useState)("Analyzing..."),[c,u]=(0,i.useState)({maxMessages:100,autoScroll:!0,showTimestamps:!0,showSources:!0,persistHistory:!1}),h=(0,i.useCallback)(()=>{if(!n){const e=`thread_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return r(e),e}return n},[n]),d=(0,i.useCallback)(e=>{const n={id:e.id||Date.now(),content:e.content||"",isUser:e.isUser||!1,timestamp:e.timestamp||new Date,source:e.source||"unknown",retryAttempt:e.retryAttempt||0,responseTime:e.responseTime||null,metadata:e.metadata||{}};return t(e=>{const t=[...e,n];return t.length>c.maxMessages?t.slice(-c.maxMessages):t}),n},[c.maxMessages]),f=(0,i.useCallback)(e=>d({content:e,isUser:!0,source:"user"}),[d]),p=(0,i.useCallback)(function(e){return d({content:e,isUser:!1,source:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"api",metadata:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}})},[d]),m=(0,i.useCallback)(async(n,r)=>{if(!(e.length>0))try{const e=await n("Generate a welcome message for CubeAI oceanographic analysis platform",r);t([{id:1,content:e,isUser:!1,timestamp:new Date,source:"api"}])}catch(i){t([{id:1,content:"Welcome to CubeAI! I can analyze currents, wave patterns, temperature gradients, and provide real-time insights. What would you like to explore?",isUser:!1,timestamp:new Date,source:"local"}])}},[e.length]),g=(0,i.useCallback)(()=>{t([]),r(null)},[]),_=(0,i.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),y=(0,i.useCallback)((e,n)=>{t(t=>t.map(t=>t.id===e?{...t,...n}:t))},[]),v=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Analyzing...";s(!0),l(e)},[]),x=(0,i.useCallback)(()=>{s(!1),l("Analyzing...")},[]),b=(0,i.useCallback)(e=>{u(t=>({...t,...e}))},[]),w=(0,i.useMemo)(()=>{const t=e,n=t.filter(e=>e.isUser),r=t.filter(e=>!e.isUser),i=r.filter(e=>"api"===e.source),o=r.filter(e=>"local"===e.source),s=r.filter(e=>"error"===e.source),a=r.length,l=a>0?i.length/a*100:0,c=i.filter(e=>e.responseTime),u=c.length>0?c.reduce((e,t)=>e+t.responseTime,0)/c.length:0;return{totalMessages:e.length,userMessages:n.length,totalResponses:a,apiResponses:i.length,localResponses:o.length,errorResponses:s.length,apiSuccessRate:parseFloat(l.toFixed(1)),avgResponseTime:Math.round(u)}},[e]),S=(0,i.useCallback)(t=>e.filter(e=>e.source===t),[e]),E=(0,i.useCallback)(t=>e.filter(e=>e.isUser===t),[e]),T=(0,i.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return e.slice(-t)},[e]),A=(0,i.useMemo)(()=>{const t=e.filter(e=>e.isUser),n=e.filter(e=>!e.isUser),r=t.map(e=>{const t=e.content.toLowerCase();return t.includes("current")||t.includes("flow")?"current_analysis":t.includes("wave")||t.includes("swell")?"wave_analysis":t.includes("temperature")||t.includes("thermal")?"temperature_analysis":t.includes("predict")||t.includes("forecast")?"prediction":t.includes("safety")||t.includes("risk")?"safety_assessment":"general_inquiry"}),i=r.reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),o=n.filter(e=>e.retryAttempt>0).length,s=n.filter(e=>"error"===e.source).length;return{conversationLength:t.length,topIntents:Object.entries(i).sort((e,t)=>{let[,n]=e,[,r]=t;return r-n}).slice(0,3).map(e=>{let[t,n]=e;return{intent:t,count:n}}),retryRate:n.length>0?(o/n.length*100).toFixed(1):0,errorRate:n.length>0?(s/n.length*100).toFixed(1):0}},[e]),C=(0,i.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json";const r={timestamp:(new Date).toISOString(),threadId:n,messageCount:e.length,metrics:w,analysis:A,messages:e.map(e=>({id:e.id,content:e.content,isUser:e.isUser,timestamp:e.timestamp,source:e.source,retryAttempt:e.retryAttempt,responseTime:e.responseTime}))};if("json"===t){const e=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=`chat_history_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),URL.revokeObjectURL(t),document.body.removeChild(n)}return r},[e,w,A,n]),P=(0,i.useCallback)(function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{caseSensitive:r=!1,source:i=null,isUser:o=null,dateRange:s=null}=n;return e.filter(e=>{const n=r?e.content:e.content.toLowerCase(),a=r?t:t.toLowerCase();if(!n.includes(a))return!1;if(i&&e.source!==i)return!1;if(null!==o&&e.isUser!==o)return!1;if(s){const t=new Date(e.timestamp);if(s.start&&t<new Date(s.start))return!1;if(s.end&&t>new Date(s.end))return!1}return!0})},[e]);return{chatMessages:e,isTyping:o,typingMessage:a,chatConfig:c,threadId:n,addChatMessage:d,addUserMessage:f,addAIResponse:p,initializeWithAPI:m,clearChatMessages:g,removeMessage:_,updateMessage:y,getThreadId:h,startTyping:v,stopTyping:x,updateChatConfig:b,chatMetrics:w,analyzeConversation:A,getMessagesBySource:S,getMessagesByType:E,getRecentMessages:T,searchMessages:P,exportChatHistory:C,messageCount:e.length,hasMessages:e.length>0,lastMessage:e[e.length-1]||null,lastUserMessage:e.filter(e=>e.isUser).pop()||null,lastAIResponse:e.filter(e=>!e.isUser).pop()||null}},xr=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{pauseAnimation:r=()=>{},togglePlay:o=()=>{}}=n,[s,a]=(0,i.useState)(0),[l,c]=(0,i.useState)(10),[u,h]=(0,i.useState)("Once"),[d,f]=(0,i.useState)(1),[p,m]=(0,i.useState)({smoothTransitions:!0,autoResetOnComplete:!1,syncWithRealTime:!1,frameSkipping:!1}),[g,_]=(0,i.useState)(0),[y,v]=(0,i.useState)(null),x=(0,i.useRef)(null),b=(0,i.useRef)(Date.now()),w=(0,i.useCallback)(e=>{const t=Math.max(.1,Math.min(20,e));c(t)},[]),S=(0,i.useCallback)(t=>{const n=Math.max(0,Math.min(t,e-1));a(n)},[e]),E=(0,i.useCallback)(()=>{a(0),r&&r(),_(0),v(null),f(1)},[r]),T=(0,i.useCallback)(e=>{S(e),t&&(b.current=Date.now())},[S,t]),A=(0,i.useCallback)(()=>{S(s+1)},[s,S]),C=(0,i.useCallback)(()=>{S(s-1)},[s,S]),P=(0,i.useCallback)(()=>{S(0)},[S]),I=(0,i.useCallback)(()=>{S(e-1)},[e,S]),k=(0,i.useCallback)(e=>{["Repeat","Once","PingPong"].includes(e)&&(h(e),f(1))},[]),M=(0,i.useCallback)(e=>{m(t=>({...t,...e}))},[]),R=(0,i.useCallback)((t,n)=>{switch(u){case"Once":return t>=e-1?(r&&r(),t):t+1;case"PingPong":let i=t+n,o=n;return i>=e-1?(i=e-1,o=-1):i<=0&&(i=0,o=1),f(o),i;default:return t>=e-1?0:t+1}},[u,e,r]),O=(0,i.useMemo)(()=>e<=1?100:s/(e-1)*100,[s,e]),L=(0,i.useMemo)(()=>e<=1?"no-data":t?"playing":0===s?"ready":s===e-1?"complete":"paused",[t,s,e]),[D,N]=(0,i.useState)(0),z=(0,i.useRef)([]);(0,i.useEffect)(()=>(t&&e>1?(y||v(Date.now()),b.current=Date.now(),x.current=setInterval(()=>{const e=Date.now(),t=e-b.current;z.current.push(t),z.current.length>10&&z.current.shift();const n=z.current.reduce((e,t)=>e+t,0)/z.current.length;N(n>0?Math.round(1e3/n):0),a(e=>R(e,d)),_(e=>e+t),b.current=e},1e3/l)):(x.current&&(clearInterval(x.current),x.current=null),v(null)),()=>{x.current&&(clearInterval(x.current),x.current=null)}),[t,l,e,R,d,y]);const F=(0,i.useCallback)(e=>{switch(e.key){case" ":e.preventDefault(),o&&o();break;case"ArrowRight":e.preventDefault(),A();break;case"ArrowLeft":e.preventDefault(),C();break;case"Home":e.preventDefault(),P();break;case"End":e.preventDefault(),I();break;case"r":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),E())}},[o,A,C,P,I,E]),B={"Very Slow":.25,Slow:.5,Normal:1,Fast:2,"Very Fast":4,"Ultra Fast":8},j=(0,i.useCallback)(e=>{B[e]&&w(B[e])},[w]),U=(0,i.useCallback)(e=>{const t=Math.floor(e/1e3);return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`},[]),V=(0,i.useMemo)(()=>({currentFrame:s+1,totalFrames:e,progress:O,status:L,speed:l,mode:u,fps:D,elapsedTime:U(g),direction:d>0?"forward":"backward"}),[s,e,O,L,l,u,D,g,U,d]);return(0,i.useEffect)(()=>()=>{x.current&&clearInterval(x.current)},[]),{currentFrame:s,playbackSpeed:l,loopMode:u,direction:d,animationConfig:p,updateAnimationConfig:M,setCurrentFrame:S,setPlaybackSpeed:w,setLoopMode:k,handleReset:E,jumpToFrame:T,stepForward:A,stepBackward:C,jumpToStart:P,jumpToEnd:I,speedPresets:B,setSpeedPreset:j,handleKeyboardControl:F,animationInfo:V,animationProgress:O,animationStatus:L,currentFPS:D,elapsedTime:g,isAtStart:0===s,isAtEnd:s===e-1,canPlay:e>1,frameRate:l,minSpeed:.1,maxSpeed:20}},br=new Date("2025-08-01T00:00:00Z"),wr=new Date(br);wr.setDate(wr.getDate()+1);const Sr=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"password";const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const[o,s]=(0,i.useState)("USM"),[a,l]=(0,i.useState)("NGOFS2"),[c,u]=(0,i.useState)(0),[h,d]=(0,i.useState)(""),[f,p]=(0,i.useState)(""),[m,g]=(0,i.useState)(null),[_,y]=(0,i.useState)("oceanCurrents"),[v,x]=(0,i.useState)({oceanCurrents:!0,temperature:!1,stations:!0,currentSpeed:!1,currentDirection:!1,ssh:!1,waveDirection:!1,salinity:!1,pressure:!1,windSpeed:!1,windDirection:!1,windVelocity:!1}),[b,w]=(0,i.useState)(1),[S,E]=(0,i.useState)(2e3),[T,A]=(0,i.useState)(.9),[C,P]=(0,i.useState)(1.2),[I,k]=(0,i.useState)({autoSelectDefaults:!0,validateSelections:!0,persistSelections:!1}),M=v.temperature,R=(0,i.useCallback)(()=>{},[]),O=(0,i.useCallback)(e=>{x(t=>(!t[e]&&y(e),{...t,[e]:!t[e]}))},[]),L=(0,i.useMemo)(()=>[{value:"MBL",label:"MBL",region:"Gulf Coast"},{value:"MSR",label:"MSR",region:"Gulf Coast"},{value:"USM",label:"USM",region:"Gulf Coast"}],[]),D=(0,i.useMemo)(()=>["NGOFS2"],[]),N=(0,i.useCallback)(e=>{const t=L.find(t=>t.value===e);!t&&I.validateSelections||s(e)},[L,I.validateSelections]),z=(0,i.useCallback)(t=>{!(e.length>0?e:D).includes(t)&&I.validateSelections||l(t)},[e,D,I.validateSelections]),F=(0,i.useCallback)(e=>{!t.includes(e)&&null!==e&&I.validateSelections||u(e)},[t,I.validateSelections]),B=(0,i.useCallback)(e=>{""!==e&&!n.includes(e)&&I.validateSelections||d(e)},[n,I.validateSelections]),j=(0,i.useCallback)(e=>{""!==e&&!r.includes(e)&&I.validateSelections||p(e)},[r,I.validateSelections]),U=(0,i.useMemo)(()=>{const i=[],s=[],l=e.length>0?e:D;return L.find(e=>e.value===o)||s.push(`Selected area "${o}" may not be available`),l.length>0&&!l.includes(a)&&i.push(`Selected model "${a}" is not available`),t.length>0&&null!==c&&!t.includes(c)&&i.push(`Selected depth "${c}ft" is not available`),n.length>0&&h&&!n.includes(h)&&i.push(`Selected date "${h}" is not available`),r.length>0&&f&&!r.includes(f)&&i.push(`Selected time "${f}" is not available`),{isValid:0===i.length,errors:i,warnings:s}},[o,a,c,h,f,L,e,D,t,n,r]),V=(0,i.useMemo)(()=>{const i=L.find(e=>e.value===o),s=e.length>0?e:D;return{area:{value:o,label:(null===i||void 0===i?void 0:i.label)||o,region:(null===i||void 0===i?void 0:i.region)||"Unknown"},model:{value:a,available:s.includes(a)},depth:{value:c,available:null===c||t.includes(c),unit:"ft"},parameter:{value:_,label:_,category:"Unknown"},date:{value:h,available:!h||n.includes(h)},time:{value:f,available:!f||r.includes(f)},station:m}},[o,a,c,_,h,f,m,L,e,D,t,n,r]),G=(0,i.useCallback)(e=>{void 0!==e.area&&N(e.area),void 0!==e.model&&z(e.model),void 0!==e.depth&&F(e.depth),void 0!==e.parameter&&y(e.parameter),void 0!==e.date&&B(e.date),void 0!==e.time&&j(e.time),void 0!==e.station&&g(e.station)},[N,z,F,B,j]),H=(0,i.useCallback)(()=>{const i=e.length>0?e:D;s("USM"),l(i[0]||"NGOFS2"),u(t[0]||0),y("oceanCurrents"),d(n[0]||""),p(r[0]||""),g(null)},[e,D,t,n,r]),$=(0,i.useCallback)(e=>{k(t=>({...t,...e}))},[]),W=(0,i.useCallback)(()=>{const i=e.length>0?e:D;return{timestamp:(new Date).toISOString(),selections:{area:o,model:a,depth:c,activeParameter:_,date:h,time:f,station:(null===m||void 0===m?void 0:m.name)||null},validation:U,availableOptions:{models:i,depths:t,areas:L.map(e=>e.value),dates:n,times:r}}},[o,a,c,_,h,f,m,U,e,D,t,L,n,r]),q=(0,i.useCallback)(()=>{if(0===t.length)return;const e=(t.indexOf(c)+1)%t.length;F(t[e])},[t,c,F]),X=(0,i.useCallback)(()=>{if(0===t.length)return;const e=t.indexOf(c),n=e<=0?t.length-1:e-1;F(t[n])},[t,c,F]),Z=(0,i.useCallback)(()=>{const t=e.length>0?e:D;if(0===t.length)return;const n=(t.indexOf(a)+1)%t.length;z(t[n])},[e,D,a,z]);return{selectedArea:o,selectedModel:a,selectedDepth:c,selectedParameter:_,currentDate:h,currentTime:f,selectedStation:m,mapLayerVisibility:v,isSstHeatmapVisible:M,heatmapScale:b,setHeatmapScale:w,windVelocityParticleCount:S,setWindVelocityParticleCount:E,windVelocityParticleOpacity:T,setWindVelocityParticleOpacity:A,windVelocityParticleSpeed:C,setWindVelocityParticleSpeed:P,setSelectedArea:N,setSelectedModel:z,setSelectedDepth:u,setSelectedParameter:y,setSelectedDate:B,setSelectedTime:j,setSelectedStation:g,toggleSstHeatmap:R,toggleMapLayer:O,availableAreas:L,defaultOceanModels:D,uiConfig:I,updateUiConfig:$,updateSelections:G,resetToDefaults:H,selectNextDepth:q,selectPreviousDepth:X,selectNextModel:Z,selectionValidation:U,currentSelections:V,exportConfiguration:W,hasValidSelections:U.isValid,selectedAreaInfo:V.area,selectedParameterInfo:V.parameter,isDepthSelected:null!==c,isStationSelected:null!==m}}(),[n,r]=(0,i.useState)(.009),[o,s]=(0,i.useState)("speed"),[a,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)(1),h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const[t,n]=(0,i.useState)(e||[]),[r,o]=(0,i.useState)(br),[s,a]=(0,i.useState)(wr),[l,c]=(0,i.useState)("UTC"),[u,h]=(0,i.useState)({format24Hour:!0,showSeconds:!1,autoSync:!0,timeStep:36e5}),d=(0,i.useCallback)(e=>{n(e||[])},[]),f=(0,i.useMemo)(()=>{if(!t||0===t.length)return null;const e=t.map(e=>e.time?new Date(e.time):null).filter(Boolean).sort((e,t)=>e-t);if(0===e.length)return null;const n=e[0],r=e[e.length-1],i=r-n;return{start:n.toISOString(),end:r.toISOString(),duration:i,durationDays:Math.round(i/864e5),durationHours:Math.round(i/36e5),totalDataPoints:e.length}},[t]);(0,i.useEffect)(()=>{!f||r||s||(o(new Date(f.start)),a(new Date(f.end)))},[f,r,s]);const p=(0,i.useCallback)(e=>{let{startDate:t,endDate:n}=e;o(t),a(n)},[]),m=(0,i.useCallback)(e=>{if(!e||"string"!==typeof e)return;const[t,n]=e.split(":").map(Number);isNaN(t)||isNaN(n)||o(e=>{const r=e?new Date(e):new Date;return r.setHours(t,n,0,0),r})},[]),g=(0,i.useCallback)(e=>{if(!t||0===t.length||!e)return{index:0,dataPoint:null,timeDiff:0};let n=0,r=1/0,i=null;return t.forEach((t,o)=>{if(t.time){const s=new Date(t.time),a=Math.abs(s-e);a<r&&(r=a,n=o,i=t)}}),{index:n,dataPoint:i,timeDiff:r}},[t]),_=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;if(!e)return"";const n=new Date(e),r={year:"numeric",month:"short",day:"numeric",hour:u.format24Hour?"2-digit":"numeric",minute:"2-digit",...u.showSeconds&&{second:"2-digit"},timeZone:t,hour12:!u.format24Hour};return n.toLocaleString("en-US",r)},[l,u.format24Hour,u.showSeconds]),y=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;if(!e)return"";const n=new Date(e),r={hour:u.format24Hour?"2-digit":"numeric",minute:"2-digit",...u.showSeconds&&{second:"2-digit"},timeZone:t,hour12:!u.format24Hour};return n.toLocaleTimeString("en-US",r)},[l,u.format24Hour,u.showSeconds]),v=(0,i.useMemo)(()=>{if(!f)return null;if(!t||0===t.length)return null;const e=[],n=[],r=[...t].sort((e,t)=>new Date(e.time)-new Date(t.time));for(let t=1;t<r.length;t++){var i,o;const s=null===(i=r[t-1])||void 0===i?void 0:i.time,a=null===(o=r[t])||void 0===o?void 0:o.time;if(s&&a){const t=new Date(a)-new Date(s);n.push(t),t>2*u.timeStep&&e.push({start:s,end:a,duration:t})}}const s=n.length>0?n.reduce((e,t)=>e+t,0)/n.length:0;return{averageInterval:s,averageIntervalHours:Math.round(s/36e5*100)/100,dataGaps:e.length,largestGap:e.length>0?Math.max(...e.map(e=>e.duration)):0,dataFrequency:s>0?Math.round(36e5/s*100)/100:0}},[t,f,u.timeStep]),x=(0,i.useCallback)(e=>{h(t=>({...t,...e}))},[]);return{startDate:r,endDate:s,currentDate:r,currentEndDate:s,timeZone:l,setTimeZone:c,setCurrentDate:o,setCurrentEndDate:a,setCurrentTime:m,timeConfig:u,updateTimeConfig:x,handleDateRangeChange:p,processRawData:d,findClosestDataPoint:g,formatDateTime:_,formatTimeOnly:y,getTimeRange:f,timeStatistics:v,hasTimeData:t&&t.length>0,isValidDateRange:r&&s&&r<s}}(),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"MBL",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"password";const{getAccessTokenSilently:u,isAuthenticated:h}=Xn(),[d,f]=(0,i.useState)([]),[p,m]=(0,i.useState)(!1),[g,_]=(0,i.useState)("simulated"),[y,v]=(0,i.useState)([]),[x,b]=(0,i.useState)(!0),[w,S]=(0,i.useState)(null),[E,T]=(0,i.useState)([]),[A,C]=(0,i.useState)([]),[P,I]=(0,i.useState)([]),[k,M]=(0,i.useState)([]),[R,O]=(0,i.useState)(null),[L,D]=(0,i.useState)({filterByDepth:!0,sortByTime:!0,skipNullValues:!0}),N=(0,i.useCallback)(async()=>{if("auth0"===c&&h)try{return await u()}catch(e){return console.warn("Failed to get Auth0 token:",e),null}return null},[c,h,u]),z=(0,i.useCallback)(async()=>{b(!0),S(null);try{const i=await N(),o={area:e,model:t,date:n,time:r,startDate:a,endDate:l};console.log("useDataManagement: Calling loadAllData with params:",o);const{allData:s}=await er(o,i);if(s.length>0){f(s),_("api");const e=[...new Set(s.map(e=>e.model).filter(Boolean))].sort();T(e);const t=[...new Set(s.map(e=>e.depth).filter(e=>null!==e&&void 0!==e))].sort((e,t)=>e-t);C(t);const n=[...new Set(s.map(e=>e.time?new Date(e.time).toISOString().split("T")[0]:null).filter(Boolean))].sort(),r=[...new Set(s.map(e=>e.time?new Date(e.time).toTimeString().split(" ")[0].substring(0,5):null).filter(Boolean))].sort();I(n),M(r)}else S("No data returned from the source."),_("none")}catch(i){console.error("Critical error during data loading:",i),S(i.message||"An unknown error occurred."),_("none")}finally{b(!1),m(!0)}},[e,t,n,r,a,l,N]),F=(0,i.useMemo)(()=>d.map(e=>({...e,lat:parseFloat(e.lat),lon:parseFloat(e.lon),direction:parseFloat(e.direction),speed:parseFloat(e.speed),nspeed:parseFloat(e.nspeed),ndirection:parseFloat(e.ndirection),temp:parseFloat(e.temp),salinity:parseFloat(e.salinity),depth:parseFloat(e.depth),ssh:parseFloat(e.ssh),pressure_dbars:parseFloat(e.pressure_dbars),sound_speed_ms:parseFloat(e.sound_speed_ms),time:e.time})).filter(e=>!isNaN(e.lat)&&!isNaN(e.lon)),[d]),B=(0,i.useMemo)(()=>{if(!s||!s.coordinates||0===F.length)return[];const[e,t]=s.coordinates;return F.filter(n=>Math.abs(n.lon-e)<1e-5&&Math.abs(n.lat-t)<1e-5)},[F,s]),j=(0,i.useMemo)(()=>{const e=s?B:F;return 0===e.length||null===o?[]:tr(e,o,R)},[s,B,F,o,R]),U=(0,i.useMemo)(()=>y.length>0?y:[{name:"USM-1 (Fallback)",coordinates:[-89.1,30.3],color:[244,63,94],type:"usm"},{name:"NDBC-42012 (Fallback)",coordinates:[-88.8,30.1],color:[251,191,36],type:"ndbc"}],[y]),V=(0,i.useMemo)(()=>{if(0===d.length)return{available:!1,count:0,coverage:0};const e=d.filter(e=>null!==e.direction&&void 0!==e.direction&&!isNaN(e.direction)).length,t=d.filter(e=>null!==e.nspeed&&void 0!==e.nspeed&&!isNaN(e.nspeed)).length,n=d.filter(e=>null!==e.direction&&void 0!==e.direction&&!isNaN(e.direction)&&null!==e.nspeed&&void 0!==e.nspeed&&!isNaN(e.nspeed)).length,r=d.length>0?n/d.length*100:0;return{available:n>0,count:n,coverage:Math.round(r),directionRecords:e,speedRecords:t,totalRecords:d.length}},[d]),G=(0,i.useMemo)(()=>{var e;if(!p)return{status:"loading",score:0,stations:0,measurements:0,lastUpdate:null,coverage:{temporal:0,spatial:0,depth:0,currents:0},completeness:0};const t=d.length,n=y.length,r=d.length>0&&null!==(e=d[d.length-1])&&void 0!==e&&e.time?new Date(d[d.length-1].time):null,i=P.length,o=y.length,s=A.length,a=V.coverage,l=d.filter(e=>e.lat&&e.lon&&null!==e.nspeed&&e.time).length,c=t>0?l/t*100:0;let u,h;return 0===t?(u="no-data",h=0):t<100||c<50?(u="limited",h=25):t<1e3||c<80?(u="good",h=75):(u="excellent",h=95),{status:u,score:h,stations:n,measurements:t,lastUpdate:r,coverage:{temporal:i,spatial:o,depth:s,currents:a},completeness:Math.round(c)}},[p,d,y,P,A,V]),H=(0,i.useMemo)(()=>{if(0===d.length)return null;const e=d.filter(e=>null!==e.nspeed&&void 0!==e.nspeed),t=d.filter(e=>null!==e.temp&&void 0!==e.temp),n=d.filter(e=>null!==e.salinity&&void 0!==e.salinity),r=d.filter(e=>null!==e.direction&&void 0!==e.direction&&null!==e.nspeed&&void 0!==e.nspeed);return{totalRecords:d.length,validMeasurements:e.length,temperatureReadings:t.length,salinityReadings:n.length,currentsReadings:r.length,dateRange:{start:P[0]||null,end:P[P.length-1]||null},depthRange:{min:Math.min(...A),max:Math.max(...A)},models:E,sources:[...new Set(d.map(e=>e._source_file).filter(Boolean))],currentsStats:V}},[d,P,A,E,V]),$=(0,i.useCallback)(()=>{if(0===d.length)return{valid:!1,errors:["No data loaded"]};const e=[],t=[],n=d.filter(e=>e.lat&&e.lon).length,r=d.filter(e=>null!==e.nspeed&&void 0!==e.nspeed).length,i=d.filter(e=>e.time).length,o=d.filter(e=>null!==e.direction&&void 0!==e.direction).length;return 0===n&&e.push("No valid coordinates found"),0===r&&e.push("No speed measurements found"),0===i&&t.push("No timestamp data found"),0===o&&t.push("No current direction data found"),n<.8*d.length&&t.push("More than 20% of records missing coordinates"),r<.5*d.length&&t.push("More than 50% of records missing speed data"),o<.5*d.length&&t.push("More than 50% of records missing direction data"),{valid:0===e.length,errors:e,warnings:t,coverage:{coordinates:(n/d.length*100).toFixed(1),speed:(r/d.length*100).toFixed(1),time:(i/d.length*100).toFixed(1),direction:(o/d.length*100).toFixed(1)}}},[d]),W=(0,i.useCallback)(e=>{D(t=>({...t,...e}))},[]),q=(0,i.useCallback)(e=>{O(e)},[]);return(0,i.useEffect)(()=>{z()},[z]),(0,i.useEffect)(()=>{if(d.length>0)try{const e=rr(d);v(e)}catch(e){console.error("Error generating station data:",e),S(t=>t||e.message),v([])}},[d]),{apiData:d,rawApiData:d,rawData:F,timeSeriesData:j,stationData:U,selectedStationEnvironmentalData:B,dataLoaded:p,dataSource:g,isLoading:x,hasError:!!w,errorMessage:w,availableModels:E,availableDepths:A,availableDates:P,availableTimes:k,dataQuality:G,dataStatistics:H,currentsDataStats:V,maxDataPoints:R,dataProcessingOptions:L,refreshData:z,validateData:$,updateDataProcessingOptions:W,setMaxDataPointsLimit:q,totalFrames:d.length,data:F}}(t.selectedArea,t.selectedModel,null,null,t.selectedDepth,null,h.startDate,h.endDate,e);(0,i.useEffect)(()=>{d.availableModels.length>0&&(d.availableModels.includes(t.selectedModel)||t.setSelectedModel(d.availableModels[0]))},[d.availableModels,t.selectedModel,t.setSelectedModel]),(0,i.useEffect)(()=>{if(d.availableDepths.length>0){(null===t.selectedDepth||!d.availableDepths.includes(t.selectedDepth))&&(console.warn("SELECTION IS INVALID. Resetting depth to:",d.availableDepths[0]),t.setSelectedDepth(d.availableDepths[0]))}else console.log("No available depths to check against yet.")},[d.availableDepths,t.setSelectedDepth]),(0,i.useEffect)(()=>{d.rawData&&h.processRawData(d.rawData)},[d.rawData,h]);const f=xr(d.totalFrames),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const[r,o]=(0,i.useState)({temperature:null,salinity:null,pressure:null,depth:0,soundSpeed:null,density:null,currentSpeed:null,currentDirection:null,windSpeed:null,windDirection:null,seaSurfaceHeight:null}),[s,a]=(0,i.useState)({x:0,y:0,depth:0,heading:0,pitch:0,roll:0}),l=(0,i.useCallback)((e,t,n)=>{if(null===e||null===t)return null;const r=t,i=999.842594+.06793952*e-.00909529*e*e+.0001001685*e*e*e-1120083e-12*e*e*e*e+6.536336e-9*e*e*e*e*e+(.824493-.0040899*e+76438e-9*e*e-8.2467e-7*e*e*e+5.3875e-9*e*e*e*e)*r+(10227e-8*e-.00572466-16546e-10*e*e)*r*Math.sqrt(r)+48314e-8*r*r;return Math.round(100*i)/100},[]),c=(0,i.useCallback)(()=>{if(e.length>0&&t<e.length){const v=e[t];var r,i,s,a,c,u,h,d,f,p,m,g,_,y;v&&o({temperature:null!==(r=null!==(i=v.temp)&&void 0!==i?i:v.temperature)&&void 0!==r?r:null,salinity:null!==(s=v.salinity)&&void 0!==s?s:null,pressure:null!==(a=null!==(c=v.pressure_dbars)&&void 0!==c?c:v.pressure)&&void 0!==a?a:null,depth:null!==(u=v.depth)&&void 0!==u?u:n,soundSpeed:null!==(h=v.sound_speed_ms)&&void 0!==h?h:null,currentSpeed:null!==(d=v.speed)&&void 0!==d?d:null,currentDirection:null!==(f=v.direction)&&void 0!==f?f:null,windSpeed:null!==(p=v.nspeed)&&void 0!==p?p:null,windDirection:null!==(m=v.ndirection)&&void 0!==m?m:null,seaSurfaceHeight:null!==(g=v.ssh)&&void 0!==g?g:null,density:l(null!==(_=v.temp)&&void 0!==_?_:v.temperature,v.salinity,null!==(y=v.pressure_dbars)&&void 0!==y?y:v.pressure)})}},[e,t,n,l]),u=(0,i.useCallback)(e=>{o(t=>({...t,...e}))},[]),h=(0,i.useCallback)(e=>{a(t=>({...t,...e}))},[]),d=(0,i.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"temperature";if(0===e.length)return[];const n=new Map;return e.forEach(e=>{null!==e.depth&&null!==e[t]&&(n.has(e.depth)||n.set(e.depth,[]),n.get(e.depth).push(e[t]))}),Array.from(n.entries()).map(e=>{let[t,n]=e;return{depth:t,value:n.reduce((e,t)=>e+t,0)/n.length,count:n.length}}).sort((e,t)=>e.depth-t.depth)},[e]),f=(0,i.useCallback)(function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"temperature",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;if(0===e.length)return[];const i=Math.max(0,t-r),o=Math.min(e.length-1,t),s=[];for(let t=i;t<=o;t++){const r=e[t];r&&null!==r[n]&&s.push({frame:t,timestamp:r.time,value:r[n],depth:r.depth})}return s},[e,t]),p=(0,i.useCallback)(()=>{if(null===r.currentSpeed||null===r.currentDirection)return{u:null,v:null,magnitude:null,direction:null};const e=r.currentSpeed,t=r.currentDirection,n=t*Math.PI/180;return{u:e*Math.sin(n),v:e*Math.cos(n),magnitude:e,direction:t}},[r.currentSpeed,r.currentDirection]),m=(0,i.useCallback)(()=>{if(null===r.windSpeed||null===r.windDirection)return{u:null,v:null,magnitude:null,direction:null};const e=r.windSpeed,t=r.windDirection,n=t*Math.PI/180;return{u:e*Math.sin(n),v:e*Math.cos(n),magnitude:e,direction:t}},[r.windSpeed,r.windDirection]);return(0,i.useEffect)(()=>{if(e.length>0&&t<e.length){const v=e[t];var r,i,s,a,c,u,h,d,f,p,m,g,_,y;v&&o({temperature:null!==(r=null!==(i=v.temp)&&void 0!==i?i:v.temperature)&&void 0!==r?r:null,salinity:null!==(s=v.salinity)&&void 0!==s?s:null,pressure:null!==(a=null!==(c=v.pressure_dbars)&&void 0!==c?c:v.pressure)&&void 0!==a?a:null,depth:null!==(u=v.depth)&&void 0!==u?u:n,soundSpeed:null!==(h=v.sound_speed_ms)&&void 0!==h?h:null,currentSpeed:null!==(d=v.speed)&&void 0!==d?d:null,currentDirection:null!==(f=v.direction)&&void 0!==f?f:null,windSpeed:null!==(p=v.nspeed)&&void 0!==p?p:null,windDirection:null!==(m=v.ndirection)&&void 0!==m?m:null,seaSurfaceHeight:null!==(g=v.ssh)&&void 0!==g?g:null,density:l(null!==(_=v.temp)&&void 0!==_?_:v.temperature,v.salinity,null!==(y=v.pressure_dbars)&&void 0!==y?y:v.pressure)})}},[e,t,n,l]),(0,i.useEffect)(()=>{a(e=>({...e,depth:n}))},[n]),{envData:r,setEnvData:u,holoOceanPOV:s,setHoloOceanPOV:h,updateFromCurrentFrame:c,calculateSeawaterDensity:l,getWaterColumnProfile:d,getEnvironmentalTrends:f,getCurrentVector:p,getWindVector:m,hasEnvironmentalData:Object.values(r).some(e=>null!==e),currentTemperature:r.temperature,currentSalinity:r.salinity,currentPressure:r.pressure,currentDepth:r.depth,waterDensity:r.density,currentSpeed:r.currentSpeed,currentDirection:r.currentDirection,windSpeed:r.windSpeed,windDirection:r.windDirection,seaSurfaceHeight:r.seaSurfaceHeight,currentVector:p(),windVector:m()}}(d.rawData,f.currentFrame,t.selectedDepth),m=(0,i.useMemo)(()=>{if(!d.rawData||0===d.rawData.length)return{type:"FeatureCollection",features:[]};return{type:"FeatureCollection",features:d.rawData.map(e=>({type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(e.lon),parseFloat(e.lat)]},properties:{direction:parseFloat(e.direction),speed:parseFloat(e.nspeed)}})).filter(e=>!isNaN(e.geometry.coordinates[0])&&!isNaN(e.geometry.coordinates[1])&&!isNaN(e.properties.direction)&&!isNaN(e.properties.speed))}},[d.rawData]),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"password";const{getAccessTokenSilently:t,isAuthenticated:n}=Xn(),[r,o]=(0,i.useState)({connected:!1,endpoint:"",timestamp:null,hasApiKey:!1,lastError:null,lastSuccessTime:null,responseTime:null}),[s,a]=(0,i.useState)({enabled:!0,timeout:1e4,retries:2,fallbackToLocal:!0,autoRetry:!0,retryDelay:1e3,maxRetryDelay:8e3}),[l,c]=(0,i.useState)({totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,lastRequestTime:null,uptime:0,downtimeEvents:[],requestHistory:[]}),[u,h]=(0,i.useState)("unknown"),[d,f]=(0,i.useState)(!1),p=(0,i.useRef)(null),m=(0,i.useRef)(null),g=(0,i.useCallback)(async()=>{if("auth0"===e&&n)try{return await t()}catch(r){return console.warn("Failed to get Auth0 token:",r),null}return null},[e,n,t]),_=(0,i.useCallback)(async()=>{const e=Date.now();try{await g();const t=await pr(),n=Date.now()-e;return o(e=>({...e,...t,lastError:null,responseTime:n,lastSuccessTime:t.connected?(new Date).toISOString():e.lastSuccessTime})),t.connected?h(n<1e3?"excellent":n<3e3?"good":"poor"):h("offline"),t.connected}catch(t){const n=Date.now()-e;return o(e=>({...e,connected:!1,lastError:t.message,timestamp:(new Date).toISOString(),responseTime:n})),h("offline"),c(e=>({...e,downtimeEvents:[...e.downtimeEvents.slice(-9),{timestamp:(new Date).toISOString(),error:t.message,duration:n}]})),!1}},[g]),y=(0,i.useCallback)(async()=>{try{await g();const e=await fr();return e?(o(e=>({...e,connected:!0,lastError:null,lastSuccessTime:(new Date).toISOString()})),h("good")):(o(e=>({...e,connected:!1,lastError:"Connection test failed"})),h("offline")),e}catch(e){return o(t=>({...t,connected:!1,lastError:e.message})),h("offline"),!1}},[g]),v=(0,i.useCallback)(e=>{a(t=>{const n={...t,...e};try{yr.setItem("ocean-api-config",{timeout:n.timeout,retries:n.retries,fallbackToLocal:n.fallbackToLocal})}catch(r){console.warn("Failed to persist API config:",r)}return n})},[]),x=(0,i.useCallback)(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r={timestamp:(new Date).toISOString(),success:e,responseTime:t,error:n};c(t=>{const n=[...t.requestHistory.slice(-99),r],i=t.totalRequests+1,o=t.successfulRequests+(e?1:0),s=t.failedRequests+(e?0:1),a=n.filter(e=>e.success&&e.responseTime),l=a.length>0?a.reduce((e,t)=>e+t.responseTime,0)/a.length:0;return{...t,totalRequests:i,successfulRequests:o,failedRequests:s,averageResponseTime:Math.round(l),lastRequestTime:(new Date).toISOString(),requestHistory:n}})},[]),b=(0,i.useCallback)(()=>{c({totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,lastRequestTime:null,uptime:0,downtimeEvents:[],requestHistory:[]})},[]),w=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e4;d||(f(!0),m.current=setInterval(()=>{_()},e),p.current=setInterval(()=>{y()},5*e))},[d,_,y]),S=(0,i.useCallback)(()=>{f(!1),m.current&&(clearInterval(m.current),m.current=null),p.current&&(clearInterval(p.current),p.current=null)},[]),E=(0,i.useMemo)(()=>{const e=l.totalRequests>0?(l.successfulRequests/l.totalRequests*100).toFixed(1):0,t=l.requestHistory.slice(-10),n=t.length>0?(t.filter(e=>e.success).length/t.length*100).toFixed(1):0;return{overall:{successRate:parseFloat(e),totalRequests:l.totalRequests,averageResponseTime:l.averageResponseTime},recent:{successRate:parseFloat(n),requestCount:t.length},status:r.connected?"online":"offline",quality:u,lastCheck:r.timestamp}},[l,r,u]);(0,i.useEffect)(()=>{try{const e=yr.getItem("ocean-api-config");e&&a(t=>({...t,...e}))}catch(e){console.warn("Failed to load saved API config:",e)}},[]),(0,i.useEffect)(()=>{_()},[_]),(0,i.useEffect)(()=>(s.enabled?w():S(),()=>S()),[s.enabled]);const T=(0,i.useMemo)(()=>{if(!r.connected)return"disconnected";switch(u){case"excellent":return"excellent";case"good":return"connected";case"poor":return"poor";default:return"unknown"}},[r.connected,u]),A=(0,i.useMemo)(()=>({api:r.connected,endpoint:r.endpoint,hasApiKey:r.hasApiKey,responseTime:r.responseTime,lastError:r.lastError,quality:u,monitoring:d}),[r,u,d]);return(0,i.useEffect)(()=>()=>{S()},[S]),{apiStatus:r,connectionStatus:T,connectionDetails:A,connectionQuality:u,apiConfig:s,updateApiConfig:v,apiMetrics:l,apiHealthSummary:E,recordApiRequest:x,resetApiMetrics:b,checkAPIStatus:_,testConnection:y,isMonitoring:d,startMonitoring:w,stopMonitoring:S,isConnected:r.connected,hasApiKey:r.hasApiKey,isEnabled:s.enabled,shouldFallback:!r.connected&&s.fallbackToLocal}}(e),_=vr(),y=(()=>{const[e,t]=(0,i.useState)(!1),[n,r]=(0,i.useState)(0),[o,s]=(0,i.useState)(!1),[a,l]=(0,i.useState)(()=>!yr.getItem("ocean-monitor-tutorial-completed")),[c,u]=(0,i.useState)({autoStart:!0,skipEnabled:!0,highlightEnabled:!0,animationsEnabled:!0,keyboardNavigation:!0}),[h,d]=(0,i.useState)({startTime:null,completedSteps:[],skippedSteps:[],timeSpentPerStep:{}}),f=(0,i.useMemo)(()=>[{id:0,title:"Welcome to Ocean Monitor",content:"This interactive tutorial will guide you through the platform's features. You can navigate using the buttons or arrow keys.",target:null,position:"center",skippable:!1},{id:1,title:"Control Panel",content:"Control oceanographic models, depths, and playback settings. Select different areas and parameters to analyze.",target:'[data-tutorial="control-panel"]',position:"bottom",skippable:!0},{id:2,title:"Interactive Map",content:"Visualize oceanographic data with real-time station markers. Click stations for detailed analysis.",target:'[data-tutorial="map-container"]',position:"left",skippable:!0},{id:3,title:"Data Panels",content:"View environmental data, charts, and real-time measurements. Monitor temperature, salinity, and current conditions.",target:'[data-tutorial="data-panels"]',position:"top",skippable:!0},{id:4,title:"Analysis Output",content:"Track AI analysis responses with source indicators. Export data and view response history.",target:'[data-tutorial="output-module"]',position:"left",skippable:!0},{id:5,title:"CubeAI Assistant",content:"Chat with our AI assistant for oceanographic insights. Ask about currents, waves, temperature, and safety assessments.",target:'[data-tutorial="chatbot"]',position:"left",skippable:!0}],[]),p=(0,i.useCallback)(()=>{t(e=>{const t=!e;return s(t),t&&(r(0),d(e=>({...e,startTime:(new Date).toISOString(),completedSteps:[],skippedSteps:[]}))),t})},[]),m=(0,i.useCallback)(e=>{const t=Math.max(0,Math.min(e,f.length-1)),i=(new Date).toISOString();if(h.startTime&&n!==t){var o;const e=null===(o=h.timeSpentPerStep[n])||void 0===o?void 0:o.startTime;if(e){const t=Date.now()-new Date(e).getTime();d(e=>({...e,timeSpentPerStep:{...e.timeSpentPerStep,[n]:{...e.timeSpentPerStep[n],endTime:i,duration:t}}}))}}r(t),t>n&&d(e=>({...e,completedSteps:[...new Set([...e.completedSteps,n])],timeSpentPerStep:{...e.timeSpentPerStep,[t]:{startTime:i}}}))},[n,f.length,h.startTime,h.timeSpentPerStep]),g=(0,i.useCallback)(()=>{n<f.length-1?m(n+1):v()},[n,f.length,m]),_=(0,i.useCallback)(()=>{n>0&&m(n-1)},[n,m]),y=(0,i.useCallback)(()=>{const e=f[n];null!==e&&void 0!==e&&e.skippable&&(d(e=>({...e,skippedSteps:[...e.skippedSteps,n]})),g())},[n,f,g]),v=(0,i.useCallback)(()=>{const e=(new Date).toISOString(),n=h.startTime?Date.now()-new Date(h.startTime).getTime():0;yr.setItem("ocean-monitor-tutorial-completed","true"),yr.setItem("ocean-monitor-tutorial-stats",{completedAt:e,totalDuration:n,stepsCompleted:h.completedSteps.length,stepsSkipped:h.skippedSteps.length,timeSpentPerStep:h.timeSpentPerStep}),l(!1),t(!1),s(!1),r(0)},[h]),x=(0,i.useCallback)(()=>{yr.removeItem("ocean-monitor-tutorial-completed"),yr.removeItem("ocean-monitor-tutorial-stats"),l(!0),r(0),d({startTime:null,completedSteps:[],skippedSteps:[],timeSpentPerStep:{}})},[]),b=(0,i.useCallback)(e=>{u(t=>({...t,...e}))},[]),w=(0,i.useCallback)(t=>{if(e&&c.keyboardNavigation)switch(t.key){case"ArrowRight":case" ":t.preventDefault(),g();break;case"ArrowLeft":t.preventDefault(),_();break;case"Escape":t.preventDefault(),p();break;case"s":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),y())}},[e,c.keyboardNavigation,g,_,y,p]),S=(0,i.useMemo)(()=>{const e=f[n],t=f.length,r=n/(t-1)*100;return{currentStep:n+1,totalSteps:t,progressPercent:Math.round(r),isComplete:n===t-1,canGoBack:n>0,canGoForward:n<t-1,canSkip:(null===e||void 0===e?void 0:e.skippable)||!1,stepInfo:e}},[n,f]);(0,i.useEffect)(()=>{if(a&&c.autoStart&&!e){const e=setTimeout(()=>{p()},2e3);return()=>clearTimeout(e)}},[a,c.autoStart,e,p]);const E=(0,i.useCallback)(()=>{try{return yr.getItem("ocean-monitor-tutorial-stats")}catch(e){return null}},[]);return{showTutorial:e,tutorialStep:n,tutorialMode:o,isFirstTimeUser:a,tutorialSteps:f,tutorialConfig:c,updateTutorialConfig:b,tutorialProgress:h,tutorialAnalytics:S,handleTutorialToggle:p,nextStep:g,prevStep:_,skipStep:y,goToStep:m,handleTutorialComplete:v,resetTutorial:x,handleKeyboardNavigation:w,getTutorialStats:E,isActive:e,currentStepInfo:f[n],isLastStep:n===f.length-1,isFirstStep:0===n,progressPercent:S.progressPercent}})(),v=(0,i.useCallback)(e=>{e&&(e.area&&e.area!==t.selectedArea&&t.setSelectedArea(e.area),e.model&&e.model!==t.selectedModel&&t.setSelectedModel(e.model),void 0!==e.depth&&e.depth!==t.selectedDepth&&t.setSelectedDepth(e.depth),e.startDate&&e.endDate&&(e.startDate!==h.startDate||e.endDate!==h.endDate)&&h.handleDateRangeChange({startDate:e.startDate,endDate:e.endDate}))},[t,h]);return{isLoading:d.isLoading,hasError:d.hasError,errorMessage:d.errorMessage,dataLoaded:d.dataLoaded,dataSource:d.dataSource,dataQuality:d.dataQuality,connectionStatus:g.connectionStatus,connectionDetails:g.connectionDetails,rawData:d.rawData,data:d.data,timeSeriesData:d.timeSeriesData,totalFrames:d.totalFrames,currentsGeoJSON:m,selectedArea:t.selectedArea,selectedModel:t.selectedModel,selectedDepth:t.selectedDepth,selectedParameter:t.selectedParameter,setSelectedArea:t.setSelectedArea,setSelectedModel:t.setSelectedModel,setSelectedDepth:t.setSelectedDepth,setSelectedParameter:t.setSelectedParameter,availableAreas:t.availableAreas,availableParameters:t.availableParameters,availableModels:d.availableModels,availableDepths:d.availableDepths,mapLayerVisibility:t.mapLayerVisibility,isSstHeatmapVisible:t.isSstHeatmapVisible,heatmapScale:t.heatmapScale,windVelocityParticleCount:t.windVelocityParticleCount,windVelocityParticleOpacity:t.windVelocityParticleOpacity,windVelocityParticleSpeed:t.windVelocityParticleSpeed,oceanBaseOpacity:c,currentsVectorScale:n,currentsColorBy:o,isPlaying:f.isPlaying,currentFrame:f.currentFrame,playbackSpeed:f.playbackSpeed,loopMode:f.loopMode,setIsPlaying:f.setIsPlaying,setCurrentFrame:f.setCurrentFrame,setPlaybackSpeed:f.setPlaybackSpeed,setLoopMode:f.setLoopMode,handlePlayToggle:f.handlePlayToggle,handleReset:f.handleReset,startDate:h.startDate,endDate:h.endDate,currentDate:h.currentDate,timeZone:h.timeZone,setCurrentDate:h.setCurrentDate,setCurrentTime:h.setCurrentTime,setTimeZone:h.setTimeZone,availableDates:h.availableDates,availableTimes:h.availableTimes,onDateRangeChange:h.handleDateRangeChange,envData:p.envData,holoOceanPOV:p.holoOceanPOV,setEnvData:p.setEnvData,setHoloOceanPOV:p.setHoloOceanPOV,chatMessages:_.chatMessages,isTyping:_.isTyping,setIsTyping:_.startTyping,addChatMessage:_.addChatMessage,clearChatMessages:_.clearChatMessages,showTutorial:y.showTutorial,tutorialStep:y.tutorialStep,tutorialMode:y.tutorialMode,isFirstTimeUser:y.isFirstTimeUser,handleTutorialToggle:y.handleTutorialToggle,handleTutorialComplete:y.handleTutorialComplete,handleTutorialStepChange:y.goToStep,fetchData:v,handleFrameChange:e=>{var t;if(f.jumpToFrame(e),d.rawData.length>e&&null!==(t=d.rawData[e])&&void 0!==t&&t.time){const t=d.rawData[e],n=new Date(t.time);h.setCurrentDate(n)}},handlePointAnalysis:e=>{const t=d.rawData.filter(t=>{if(!t.lat||!t.lon)return!1;const n=Math.abs(t.lat-e.latitude),r=Math.abs(t.lon-e.longitude);return n<.001&&r<.001}),n=t[t.length-1],r=`Point Analysis: ${t.length} measurements found at [${e.latitude}, ${e.longitude}]. `+(n?`Latest temp: ${n.temp||"N/A"}\xc3\u201a\xc2\xb0C, current speed: ${n.nspeed||"N/A"} m/s`:"No recent measurements.");_.addAIResponse(r,"system")},refreshData:d.refreshData,handleDateTimeChange:(e,t)=>{const n=h.handleDateTimeChange(e,t);return n&&void 0!==n.index&&f.jumpToFrame(n.index),n},toggleMapLayer:t.toggleMapLayer,toggleSstHeatmap:t.toggleSstHeatmap,onHeatmapScaleChange:t.setHeatmapScale,onWindVelocityParticleCountChange:t.setWindVelocityParticleCount,onWindVelocityParticleOpacityChange:t.setWindVelocityParticleOpacity,onWindVelocityParticleSpeedChange:t.setWindVelocityParticleSpeed,handleCurrentsScaleChange:e=>{r(e)},handleCurrentsColorChange:e=>{s(e)},handleOceanBaseToggle:()=>{l(e=>!e)},handleOceanBaseOpacityChange:e=>{u(e)}}};let Er;if(!"ws://bluemvmt-holoocean-1-ws.ngrok.dev".startsWith("wss://"))throw new Error("REACT_APP_HOLOOCEAN_ENDPOINT in production must start with wss://");Er="ws://bluemvmt-holoocean-1-ws.ngrok.dev";const Tr=Er,Ar=new class{constructor(e){this.endpoint=e,this.ws=null,this.isConnected=!1,this.isSubscribed=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=10,this.reconnectDelay=1e3,this.maxReconnectDelay=3e4,this.reconnectTimer=null,this.pingTimer=null,this.shouldReconnect=!0,this.eventHandlers={connected:[],disconnected:[],status:[],targetUpdated:[],error:[],connectionError:[]},this.lastStatus=null}on(e,t){this.eventHandlers[e]&&this.eventHandlers[e].push(t)}off(e,t){if(this.eventHandlers[e]){const n=this.eventHandlers[e].indexOf(t);n>-1&&this.eventHandlers[e].splice(n,1)}}emit(e,t){this.eventHandlers[e]&&this.eventHandlers[e].forEach(n=>{try{n(t)}catch(r){console.error(`Error in ${e} event handler:`,r)}})}validateCoordinates(e,t,n){const r=[];return("number"!==typeof e||e<-90||e>90)&&r.push("Latitude must be a number between -90 and 90"),("number"!==typeof t||t<-180||t>180)&&r.push("Longitude must be a number between -180 and 180"),("number"!==typeof n||n<-11e3||n>11e3)&&r.push("Depth must be a number between -11000 and 11000 meters"),{isValid:0===r.length,errors:r}}validateTime(e){if(!e)return!0;try{const t=new Date(e);return!isNaN(t.getTime())&&e.includes("T")}catch{return!1}}connect(e){return new Promise((t,n)=>{try{this.shouldReconnect=!0;const r=e?`${this.endpoint}?token=${e}`:this.endpoint;this.ws=new WebSocket(r),this.ws.onopen=()=>{console.log("HoloOcean WebSocket connected"),this.isConnected=!0,this.reconnectAttempts=0,this.reconnectDelay=1e3,this.clearReconnectTimer(),this.emit("connected",{endpoint:this.endpoint}),t()},this.ws.onclose=e=>{console.log("HoloOcean WebSocket disconnected:",e.code,e.reason),this.handleDisconnection(),e.wasClean&&t()},this.ws.onerror=e=>{console.error("HoloOcean WebSocket error:",e),this.emit("connectionError",{error:e.message||"WebSocket error"}),this.isConnected||n(new Error("Failed to connect to HoloOcean WebSocket"))},this.ws.onmessage=e=>{this.handleMessage(e.data)},setTimeout(()=>{this.isConnected||(this.ws.close(),n(new Error("Connection timeout")))},1e4)}catch(r){n(r)}})}handleDisconnection(){this.isConnected=!1,this.isSubscribed=!1,this.clearPingTimer(),this.emit("disconnected",{willReconnect:this.shouldReconnect&&this.reconnectAttempts<this.maxReconnectAttempts}),this.shouldReconnect&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect()}scheduleReconnect(){this.clearReconnectTimer(),this.reconnectAttempts++;const e=Math.min(this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.maxReconnectDelay);console.log(`Scheduling HoloOcean reconnect attempt ${this.reconnectAttempts} in ${e}ms`),this.reconnectTimer=setTimeout(()=>{this.shouldReconnect&&(console.log(`Attempting HoloOcean reconnect ${this.reconnectAttempts}/${this.maxReconnectAttempts}`),this.connect().catch(e=>{console.error("Reconnection failed:",e)}))},e)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}clearPingTimer(){this.pingTimer&&(clearTimeout(this.pingTimer),this.pingTimer=null)}handleMessage(e){try{const t=JSON.parse(e);switch(t.event){case"target_updated":this.emit("targetUpdated",t.target);break;case"status":this.lastStatus=t.status,this.emit("status",t.status);break;default:t.hasOwnProperty("ok")&&(t.ok?"target_updated"===t.event?this.emit("targetUpdated",t.target):t.status&&(this.lastStatus=t.status,this.emit("status",t.status)):(console.error("HoloOcean server error:",t.error),this.emit("error",{type:"server_error",message:t.error})))}}catch(t){console.error("Error parsing HoloOcean message:",t),this.emit("error",{type:"parse_error",message:"Failed to parse server message",rawData:e})}}sendCommand(e){return new Promise((t,n)=>{if(this.isConnected&&this.ws&&this.ws.readyState===WebSocket.OPEN)try{const n=JSON.stringify(e);this.ws.send(n),t()}catch(r){n(new Error(`Failed to send command: ${r.message}`))}else n(new Error("WebSocket not connected"))})}async setTarget(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=this.validateCoordinates(e,t,n);if(!i.isValid)throw new Error(`Invalid coordinates: ${i.errors.join(", ")}`);if(r&&!this.validateTime(r))throw new Error('Invalid time format. Use ISO-8601 format (e.g., "2025-08-14T00:00:00Z")');const o={type:"set_target",lat:e,lon:t,depth:n};r&&(o.time=r);try{await this.sendCommand(o),console.log("Target set:",o)}catch(s){throw console.error("Failed to set target:",s),s}}async getStatus(){try{await this.sendCommand({type:"get_status"}),console.log("Status requested")}catch(e){throw console.error("Failed to get status:",e),e}}async subscribe(){try{await this.sendCommand({type:"subscribe"}),this.isSubscribed=!0,console.log("Subscribed to status updates")}catch(e){throw console.error("Failed to subscribe:",e),e}}unsubscribe(){this.isSubscribed=!1,console.log("Unsubscribed from status updates")}disconnect(){this.shouldReconnect=!1,this.clearReconnectTimer(),this.clearPingTimer(),this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close(1e3,"Client disconnect"),this.isConnected=!1,this.isSubscribed=!1,this.ws=null,console.log("HoloOcean WebSocket disconnected")}getConnectionStatus(){return{isConnected:this.isConnected,isSubscribed:this.isSubscribed,reconnectAttempts:this.reconnectAttempts,maxReconnectAttempts:this.maxReconnectAttempts,endpoint:this.endpoint,readyState:this.ws?this.ws.readyState:WebSocket.CLOSED,lastStatus:this.lastStatus}}getLastStatus(){return this.lastStatus}resetReconnection(){this.reconnectAttempts=0,this.reconnectDelay=1e3}reconnect(e){return this.ws&&this.disconnect(),this.shouldReconnect=!0,this.resetReconnection(),this.connect(e)}areCoordinatesValid(e,t,n){return this.validateCoordinates(e,t,n).isValid}formatCoordinates(e,t,n){const r=e>=0?"N":"S",i=t>=0?"E":"W";return`${Math.abs(e).toFixed(6)}\xb0${r}, ${Math.abs(t).toFixed(6)}\xb0${i}, ${n}m depth`}getCurrentTime(){return(new Date).toISOString()}parseTime(e){if(!e)return null;try{const t=new Date(e);return isNaN(t.getTime())?null:t}catch{return null}}calculateDistance(e,t,n,r){const i=e*Math.PI/180,o=n*Math.PI/180,s=(n-e)*Math.PI/180,a=(r-t)*Math.PI/180,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}getReadyStateString(){if(!this.ws)return"CLOSED";switch(this.ws.readyState){case WebSocket.CONNECTING:return"CONNECTING";case WebSocket.OPEN:return"OPEN";case WebSocket.CLOSING:return"CLOSING";case WebSocket.CLOSED:return"CLOSED";default:return"UNKNOWN"}}ping(){this.isConnected&&this.ws&&this.ws.readyState===WebSocket.OPEN&&this.getStatus().catch(e=>{console.warn("Ping failed:",e)})}startPingTimer(){this.clearPingTimer(),this.pingTimer=setInterval(()=>{this.ping()},25e3)}stopPingTimer(){this.clearPingTimer()}getStats(){return{isConnected:this.isConnected,isSubscribed:this.isSubscribed,reconnectAttempts:this.reconnectAttempts,maxReconnectAttempts:this.maxReconnectAttempts,currentDelay:this.reconnectDelay,maxDelay:this.maxReconnectDelay,hasLastStatus:!!this.lastStatus,readyState:this.getReadyStateString(),endpoint:this.endpoint,shouldReconnect:this.shouldReconnect,eventHandlerCounts:Object.keys(this.eventHandlers).reduce((e,t)=>(e[t]=this.eventHandlers[t].length,e),{})}}cleanup(){this.shouldReconnect=!1,this.disconnect(),this.clearReconnectTimer(),this.clearPingTimer(),Object.keys(this.eventHandlers).forEach(e=>{this.eventHandlers[e]=[]}),this.lastStatus=null}}(Tr),Cr=Ar,Pr=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{getAccessTokenSilently:t}=Xn(),[n,r]=(0,i.useState)(!1),[o,s]=(0,i.useState)(!1),[a,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)(0),[h,d]=(0,i.useState)(null),[f,p]=(0,i.useState)(null),[m,g]=(0,i.useState)(null),[_,y]=(0,i.useState)(null),[v,x]=(0,i.useState)(null),[b,w]=(0,i.useState)(null),[S,E]=(0,i.useState)(null),[T,A]=(0,i.useState)(null),[C,P]=(0,i.useState)(!1),[I,k]=(0,i.useState)(!1),M=(0,i.useRef)({}),R=(0,i.useRef)(!0),O=(0,i.useCallback)(e=>{R.current&&(r(!0),s(!1),u(0),d(null),E(null),console.log("HoloOcean connected to:",e.endpoint))},[]),L=(0,i.useCallback)(e=>{R.current&&(r(!1),s(!1),l(!1),console.log("HoloOcean disconnected, will reconnect:",e.willReconnect))},[]),D=(0,i.useCallback)(e=>{R.current&&(p(e),g(e.target||null),y(e.current||null),x(e.holoocean||null),w(e.updated_at||(new Date).toISOString()),E(null))},[]),N=(0,i.useCallback)(e=>{R.current&&(g(e),console.log("Target updated:",e))},[]),z=(0,i.useCallback)(e=>{R.current&&("server_error"===e.type?A(e.message):E(e.message),console.error("HoloOcean error:",e))},[]),F=(0,i.useCallback)(e=>{if(!R.current)return;d(e.error),s(!1);const t=Cr.getConnectionStatus();u(t.reconnectAttempts)},[]);(0,i.useEffect)(()=>{M.current={connected:O,disconnected:L,status:D,targetUpdated:N,error:z,connectionError:F},Object.keys(M.current).forEach(e=>{Cr.on(e,M.current[e])});const t=Cr.getConnectionStatus();return r(t.isConnected),l(t.isSubscribed),u(t.reconnectAttempts),p(t.lastStatus),t.lastStatus&&(g(t.lastStatus.target||null),y(t.lastStatus.current||null),x(t.lastStatus.holoocean||null),w(t.lastStatus.updated_at||null)),e&&!t.isConnected&&B(),()=>{R.current=!1,Object.keys(M.current).forEach(e=>{Cr.off(e,M.current[e])})}},[e,O,L,D,N,z,F]);const B=(0,i.useCallback)(async()=>{if(!o&&!n){s(!0),d(null),E(null);try{const e=await t();await Cr.connect(e)}catch(S){throw R.current&&(d(S.message),s(!1)),S}}},[o,n,t]),j=(0,i.useCallback)(()=>{Cr.disconnect(),r(!1),s(!1),l(!1),d(null)},[]),U=(0,i.useCallback)(async()=>{s(!0),d(null),E(null);try{const e=await t();await Cr.reconnect(e)}catch(S){throw R.current&&(d(S.message),s(!1)),S}},[t]),V=(0,i.useCallback)(async function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!n)throw new Error("Not connected to HoloOcean service");P(!0),E(null),A(null);try{await Cr.setTarget(e,t,r,i)}catch(S){throw R.current&&E(S.message),S}finally{R.current&&P(!1)}},[n]),G=(0,i.useCallback)(async()=>{if(!n)throw new Error("Not connected to HoloOcean service");k(!0),E(null),A(null);try{await Cr.getStatus()}catch(S){throw R.current&&E(S.message),S}finally{R.current&&k(!1)}},[n]),H=(0,i.useCallback)(async()=>{if(!n)throw new Error("Not connected to HoloOcean service");if(a)console.log("Already subscribed to HoloOcean status updates");else{E(null),A(null);try{await Cr.subscribe(),l(!0)}catch(S){throw R.current&&E(S.message),S}}},[n,a]),$=(0,i.useCallback)(()=>{Cr.unsubscribe(),l(!1)},[]),W=(0,i.useCallback)(()=>{E(null),A(null),d(null)},[]),q=(0,i.useCallback)((e,t,n)=>Cr.validateCoordinates(e,t,n),[]),X=(0,i.useCallback)((e,t,n)=>Cr.formatCoordinates(e,t,n),[]),Z=(0,i.useCallback)((e,t,n,r)=>Cr.calculateDistance(e,t,n,r),[]),K=(null===v||void 0===v?void 0:v.running)||!1,Y=(null===v||void 0===v?void 0:v.tick_count)||0,J=(null===v||void 0===v?void 0:v.last_error)||null,Q=m&&"number"===typeof m.lat&&"number"===typeof m.lon,ee=_&&"number"===typeof _.lat&&"number"===typeof _.lon,te=Q&&ee?Z(_.lat,_.lon,m.lat,m.lon):null,ne=Q&&ee&&"number"===typeof _.depth&&"number"===typeof m.depth?Math.abs(_.depth-m.depth):null,re=null!==te&&null!==ne&&(te<10&&ne<1),ie={isConnected:n,isConnecting:o,reconnectAttempts:c,maxAttempts:Cr.maxReconnectAttempts,readyState:Cr.getReadyStateString(),endpoint:Cr.endpoint};return{isConnected:n,isConnecting:o,reconnectAttempts:c,connectionError:h,connectionStatus:ie,isSubscribed:a,status:f,target:m,current:_,holoOceanState:v,lastUpdated:b,isHoloOceanRunning:K,tickCount:Y,holoOceanError:J,hasTarget:Q,hasCurrent:ee,distanceToTarget:te,depthDifference:ne,isAtTarget:re,error:S,serverError:T,isSettingTarget:C,isGettingStatus:I,connect:B,disconnect:j,reconnect:U,setTarget:V,getStatus:G,subscribe:H,unsubscribe:$,clearError:W,validateCoordinates:q,formatCoordinates:X,calculateDistance:Z,summary:{connection:ie,subscription:{isSubscribed:a},simulation:{isRunning:K,tickCount:Y,error:J},position:{hasTarget:Q,hasCurrent:ee,target:m,current:_,distanceToTarget:te,depthDifference:ne,isAtTarget:re},lastUpdated:b,errors:{connection:h,general:S,server:T}},service:Cr}},Ir=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kr=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},Mr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},Rr=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var Or={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Lr=(0,i.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:s,className:a="",children:l,iconNode:c,...u}=e;return(0,i.createElement)("svg",{ref:t,...Or,width:r,height:r,stroke:n,strokeWidth:s?24*Number(o)/Number(r):o,className:Mr("lucide",a),...!l&&!Rr(u)&&{"aria-hidden":"true"},...u},[...c.map(e=>{let[t,n]=e;return(0,i.createElement)(t,n)}),...Array.isArray(l)?l:[l]])}),Dr=(e,t)=>{const n=(0,i.forwardRef)((n,r)=>{let{className:o,...s}=n;return(0,i.createElement)(Lr,{ref:r,iconNode:t,className:Mr(`lucide-${Ir(kr(e))}`,`lucide-${e}`,o),...s})});return n.displayName=kr(e),n},Nr=Dr("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),zr=Dr("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),Fr=Dr("waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),Br=Dr("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var jr=n(579);const Ur=e=>{let{title:t="Loading Oceanographic Data",message:n="Loading data...",type:r="data",progress:i=null,details:o=null}=e;const s=(()=>{switch(r){case"data":default:return{title:"text-blue-300",message:"text-slate-400",progress:"bg-blue-400"};case"processing":return{title:"text-green-300",message:"text-slate-400",progress:"bg-green-400"};case"connecting":return{title:"text-cyan-300",message:"text-slate-400",progress:"bg-cyan-400"}}})();return(0,jr.jsx)("div",{className:"min-h-screen bg-slate-900 text-white flex items-center justify-center px-4",children:(0,jr.jsxs)("div",{className:"text-center max-w-md w-full",children:[(()=>{switch(r){case"data":return(0,jr.jsxs)("div",{className:"w-16 h-16 mx-auto mb-4 relative",children:[(0,jr.jsx)("div",{className:"absolute inset-0 border-4 border-blue-400/30 rounded-full animate-ping"}),(0,jr.jsx)("div",{className:"absolute inset-2 border-4 border-blue-400/50 rounded-full animate-pulse"}),(0,jr.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,jr.jsx)(Nr,{className:"w-6 h-6 text-blue-400 animate-pulse"})})]});case"processing":return(0,jr.jsxs)("div",{className:"w-16 h-16 mx-auto mb-4 relative",children:[(0,jr.jsx)("div",{className:"absolute inset-0 border-4 border-green-400/30 rounded-full animate-spin"}),(0,jr.jsx)("div",{className:"absolute inset-2 border-4 border-green-400/50 rounded-full animate-spin",style:{animationDirection:"reverse"}}),(0,jr.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,jr.jsx)(zr,{className:"w-6 h-6 text-green-400 animate-pulse"})})]});case"connecting":return(0,jr.jsxs)("div",{className:"w-16 h-16 mx-auto mb-4 relative",children:[(0,jr.jsx)("div",{className:"absolute inset-0 border-4 border-cyan-400/30 rounded-full animate-ping"}),(0,jr.jsx)("div",{className:"absolute inset-2 border-4 border-cyan-400/50 rounded-full animate-pulse"}),(0,jr.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,jr.jsx)(Fr,{className:"w-6 h-6 text-cyan-400 animate-bounce"})})]});default:return(0,jr.jsxs)("div",{className:"w-16 h-16 mx-auto mb-4 relative",children:[(0,jr.jsx)("div",{className:"absolute inset-0 border-4 border-blue-400/30 rounded-full animate-ping"}),(0,jr.jsx)("div",{className:"absolute inset-2 border-4 border-blue-400/50 rounded-full animate-pulse"}),(0,jr.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,jr.jsx)(Br,{className:"w-6 h-6 text-blue-400 animate-spin"})})]})}})(),(0,jr.jsx)("h2",{className:`text-lg md:text-xl font-semibold ${s.title} mb-2`,children:t}),(0,jr.jsx)("p",{className:`text-sm md:text-base ${s.message} mb-4`,children:n}),null!==i&&(0,jr.jsxs)("div",{className:"mb-4",children:[(0,jr.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-2 mb-2",children:(0,jr.jsx)("div",{className:`h-2 rounded-full ${s.progress} transition-all duration-300 ease-out`,style:{width:`${Math.max(0,Math.min(100,i))}%`}})}),(0,jr.jsxs)("div",{className:"text-xs text-slate-500",children:[Math.round(i),"% Complete"]})]}),o&&o.length>0&&(0,jr.jsxs)("div",{className:"text-left bg-slate-800/50 rounded-lg p-4 mt-4",children:[(0,jr.jsx)("div",{className:"text-xs font-semibold text-slate-300 mb-2",children:"Loading Progress:"}),(0,jr.jsx)("div",{className:"space-y-1",children:o.map((e,t)=>(0,jr.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[(0,jr.jsx)("div",{className:"w-1.5 h-1.5 rounded-full "+("completed"===e.status?"bg-green-400":"loading"===e.status?"bg-yellow-400 animate-pulse":"error"===e.status?"bg-red-400":"bg-slate-600")}),(0,jr.jsx)("span",{className:"completed"===e.status?"text-green-300":"loading"===e.status?"text-yellow-300":"error"===e.status?"text-red-300":"text-slate-400",children:e.message})]},t))})]}),(0,jr.jsxs)("div",{className:"mt-8 text-xs text-slate-500 space-y-1",children:[(0,jr.jsx)("div",{children:"University of Southern Mississippi"}),(0,jr.jsx)("div",{children:"Roger F. Wicker Center for Ocean Enterprise"}),(0,jr.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-2",children:[(0,jr.jsx)("div",{className:"w-1 h-1 bg-slate-500 rounded-full"}),(0,jr.jsx)("div",{children:"Powered by CubeAI Technology"}),(0,jr.jsx)("div",{className:"w-1 h-1 bg-slate-500 rounded-full"})]})]}),(0,jr.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,jr.jsx)("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-blue-500/5 rounded-full animate-pulse"}),(0,jr.jsx)("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-cyan-500/5 rounded-full animate-pulse delay-1000"})]})]})})},Vr=Ur,Gr=Dr("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),Hr=Dr("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),$r=Dr("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Wr=Dr("settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),qr=Dr("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Xr=Dr("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Zr=Dr("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Kr=Dr("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),Yr=Dr("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Jr=e=>{let{type:t="general",title:n,message:r,details:i,onRetry:o,onGoHome:s,showContactInfo:a=!0,customActions:l=[]}=e;const c=(()=>{switch(t){case"no-data":return{icon:Nr,iconColor:"text-red-400",bgColor:"from-red-900/20 to-red-800/10",borderColor:"border-red-500/30",title:n||"No Data Available",message:r||"API endpoint is not available.",suggestions:["Contact Admin"]};case"network":return{icon:Gr,iconColor:"text-orange-400",bgColor:"from-orange-900/20 to-orange-800/10",borderColor:"border-orange-500/30",title:n||"Network Connection Error",message:r||"Unable to connect to data sources or external services.",suggestions:["Check your internet connection","Verify API endpoints are accessible","Check firewall and proxy settings","Try refreshing the page"]};case"validation":return{icon:Hr,iconColor:"text-yellow-400",bgColor:"from-yellow-900/20 to-yellow-800/10",borderColor:"border-yellow-500/30",title:n||"Data Validation Error",message:r||"The loaded data contains invalid or corrupted information.",suggestions:["Check the data format and required fields","Verify latitude/longitude coordinates are valid","Ensure date/time fields are properly formatted","Remove any special characters or empty rows"]};case"map":return{icon:$r,iconColor:"text-purple-400",bgColor:"from-purple-900/20 to-purple-800/10",borderColor:"border-purple-500/30",title:n||"Map Initialization Error",message:r||"Unable to initialize the interactive map component.",suggestions:["Check Mapbox access token configuration","Verify WebGL support in your browser","Clear browser cache and reload","Try using a different browser"]};case"api":return{icon:Wr,iconColor:"text-indigo-400",bgColor:"from-indigo-900/20 to-indigo-800/10",borderColor:"border-indigo-500/30",title:n||"API Connection Error",message:r||"Unable to connect to the oceanographic data API.",suggestions:["Verify API endpoint URL is correct","Check API authentication credentials","Confirm API server is running and accessible","Review API rate limits and quotas"]};default:return{icon:qr,iconColor:"text-red-400",bgColor:"from-red-900/20 to-slate-800/10",borderColor:"border-red-500/30",title:n||"Application Error",message:r||"An unexpected error occurred while running the oceanographic platform.",suggestions:["Try refreshing the browser page","Clear browser cache and cookies","Check browser console for error details","Contact support if the issue persists"]}}})(),u=c.icon;return(0,jr.jsx)("div",{className:"min-h-screen bg-slate-900 text-white flex items-center justify-center px-4",children:(0,jr.jsxs)("div",{className:`text-center max-w-2xl w-full bg-gradient-to-b ${c.bgColor} border ${c.borderColor} rounded-lg p-6 md:p-8`,children:[(0,jr.jsxs)("div",{className:"w-16 h-16 md:w-20 md:h-20 mx-auto mb-6 relative",children:[(0,jr.jsx)("div",{className:"absolute inset-0 bg-slate-800 rounded-full flex items-center justify-center",children:(0,jr.jsx)(u,{className:`w-8 h-8 md:w-10 md:h-10 ${c.iconColor}`})}),(0,jr.jsx)("div",{className:"absolute inset-0 border-2 border-slate-600 rounded-full animate-pulse"})]}),(0,jr.jsx)("h2",{className:"text-xl md:text-2xl font-bold text-white mb-4",children:c.title}),(0,jr.jsx)("p",{className:"text-sm md:text-base text-slate-300 mb-6 leading-relaxed",children:c.message}),i&&(0,jr.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4 mb-6 text-left",children:[(0,jr.jsxs)("h4",{className:"font-semibold text-slate-200 mb-2 flex items-center gap-2",children:[(0,jr.jsx)(Xr,{className:"w-4 h-4 text-yellow-400"}),"Error Details"]}),(0,jr.jsx)("div",{className:"text-sm text-slate-400 font-mono bg-slate-900/50 p-3 rounded border overflow-x-auto",children:"string"===typeof i?i:JSON.stringify(i,null,2)})]}),(0,jr.jsxs)("div",{className:"bg-slate-800/30 border border-slate-700 rounded-lg p-4 mb-6 text-left",children:[(0,jr.jsxs)("h4",{className:"font-semibold text-slate-200 mb-3 flex items-center gap-2",children:[(0,jr.jsx)(Zr,{className:"w-4 h-4 text-blue-400"}),"Suggested Solutions"]}),(0,jr.jsx)("ul",{className:"space-y-2",children:c.suggestions.map((e,t)=>(0,jr.jsxs)("li",{className:"flex items-start gap-2 text-sm text-slate-300",children:[(0,jr.jsx)("span",{className:"text-blue-400 mt-1",children:"\u2022"}),(0,jr.jsx)("span",{children:e})]},t))})]}),(0,jr.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[o&&(0,jr.jsxs)("button",{onClick:o,className:"flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg transition-colors font-medium",children:[(0,jr.jsx)(Br,{className:"w-4 h-4"}),"Try Again"]}),s&&(0,jr.jsxs)("button",{onClick:s,className:"flex items-center justify-center gap-2 bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded-lg transition-colors font-medium",children:[(0,jr.jsx)(Kr,{className:"w-4 h-4"}),"Go Home"]}),l.map((e,t)=>(0,jr.jsxs)("button",{onClick:e.onClick,className:`flex items-center justify-center gap-2 px-6 py-3 rounded-lg transition-colors font-medium ${e.className||"bg-slate-700 hover:bg-slate-600"}`,children:[e.icon&&(0,jr.jsx)(e.icon,{className:"w-4 h-4"}),e.label]},t))]}),a&&(0,jr.jsx)("div",{className:"mt-8 pt-6 border-t border-slate-700",children:(0,jr.jsxs)("div",{className:"text-xs text-slate-400 space-y-1",children:[(0,jr.jsx)("div",{className:"font-semibold text-slate-300 mb-2",children:"Need Additional Help?"}),(0,jr.jsx)("div",{children:"University of Southern Mississippi"}),(0,jr.jsx)("div",{children:"Roger F. Wicker Center for Ocean Enterprise"}),(0,jr.jsxs)("div",{className:"flex items-center justify-center gap-4 mt-3",children:[(0,jr.jsxs)("a",{href:"#",className:"flex items-center gap-1 text-blue-400 hover:text-blue-300 transition-colors",children:[(0,jr.jsx)(Yr,{className:"w-3 h-3"}),"Documentation"]}),(0,jr.jsxs)("a",{href:"#",className:"flex items-center gap-1 text-blue-400 hover:text-blue-300 transition-colors",children:[(0,jr.jsx)(Yr,{className:"w-3 h-3"}),"Support"]})]})]})}),(0,jr.jsxs)("div",{className:"absolute inset-0 overflow-hidden rounded-lg pointer-events-none",children:[(0,jr.jsx)("div",{className:"absolute -top-20 -right-20 w-40 h-40 bg-red-500/5 rounded-full"}),(0,jr.jsx)("div",{className:"absolute -bottom-20 -left-20 w-40 h-40 bg-blue-500/5 rounded-full"})]})]})})},Qr=Jr,ei=(0,i.createContext)(null),ti=()=>{const e=(0,i.useContext)(ei);if(null===e)throw new Error("useOcean must be used within an OceanDataProvider");return e},ni=e=>{let{children:t,authMethod:n="password"}=e;const r=Sr(n),[o,s]=(0,i.useState)(!1),a=(0,i.useCallback)(()=>s(!0),[]),l=(0,i.useCallback)(()=>s(!1),[]),c=(0,i.useCallback)(()=>s(e=>!e),[]),u=xr(r.totalFrames,o,{pauseAnimation:l,togglePlay:c}),h=Pr(),d={...r,...u,isPlaying:o,playAnimation:a,pauseAnimation:l,togglePlay:c,holoOcean:h,authMethod:n};return d.isLoading&&!d.dataLoaded?(0,jr.jsx)(Vr,{}):d.hasError?(0,jr.jsx)(Qr,{message:d.errorMessage}):(0,jr.jsx)(ei.Provider,{value:d,children:t})},ri=Dr("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),ii=Dr("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),oi=Dr("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),si=Dr("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),ai=n.p+"static/media/roger_wicker_center_ocean_enterprise.e696743fb27ec20af6a9.png",li=n.p+"static/media/powered_by_bluemvmt.7e4978300374c9501478.png",ci=e=>{let{isConnected:t,isConnecting:n,reconnectAttempts:r=0,error:i=null,className:o=""}=e;const s=i?{status:"error",text:"Connection Error",color:"text-red-400",bgColor:"bg-red-900/20",borderColor:"border-red-700/30",icon:(0,jr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}:n?{status:"connecting",text:r>0?`Reconnecting (${r})`:"Connecting",color:"text-yellow-400",bgColor:"bg-yellow-900/20",borderColor:"border-yellow-700/30",icon:(0,jr.jsx)("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}:t?{status:"connected",text:"Connected",color:"text-green-400",bgColor:"bg-green-900/20",borderColor:"border-green-700/30",icon:(0,jr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}:{status:"disconnected",text:"Disconnected",color:"text-gray-400",bgColor:"bg-gray-900/20",borderColor:"border-gray-700/30",icon:(0,jr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 5.636l-12.728 12.728m0-12.728l12.728 12.728"})})};return(0,jr.jsxs)("div",{className:`flex items-center gap-2 ${o}`,children:[(0,jr.jsxs)("div",{className:`\n        flex items-center gap-2 px-3 py-1 rounded-full border\n        ${s.bgColor} ${s.borderColor} ${s.color}\n      `,children:[s.icon,(0,jr.jsx)("span",{className:"text-sm font-medium",children:s.text})]}),t&&(0,jr.jsxs)("div",{className:"relative",children:[(0,jr.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,jr.jsx)("div",{className:"absolute top-0 left-0 w-3 h-3 bg-green-500 rounded-full animate-ping opacity-75"})]}),i&&(0,jr.jsxs)("div",{className:"relative group",children:[(0,jr.jsx)("svg",{className:"w-4 h-4 text-red-400 cursor-help",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,jr.jsx)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-slate-900 border border-slate-600 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity z-10 whitespace-nowrap",children:i})]})]})},ui=e=>{let{onSetTarget:t,isLoading:n=!1,validateCoordinates:r,formatCoordinates:o,className:s=""}=e;const[a,l]=(0,i.useState)({lat:"",lon:"",depth:"",time:""}),[c,u]=(0,i.useState)([]),[h,d]=(0,i.useState)({}),[f,p]=(0,i.useState)(!1),[m,g]=(0,i.useState)(!1),_=(0,i.useCallback)((e,t)=>{l(n=>({...n,[e]:t})),h[e]&&d(t=>({...t,[e]:null})),c.length>0&&u([])},[h,c]),y=(0,i.useCallback)(()=>{const e=[],t={},n=parseFloat(a.lat),i=parseFloat(a.lon),o=parseFloat(a.depth);if(a.lat.trim()?isNaN(n)&&(t.lat="Latitude must be a number",e.push("Latitude must be a valid number")):(t.lat="Latitude is required",e.push("Latitude is required")),a.lon.trim()?isNaN(i)&&(t.lon="Longitude must be a number",e.push("Longitude must be a valid number")):(t.lon="Longitude is required",e.push("Longitude is required")),a.depth.trim()?isNaN(o)&&(t.depth="Depth must be a number",e.push("Depth must be a valid number")):(t.depth="Depth is required",e.push("Depth is required")),!isNaN(n)&&!isNaN(i)&&!isNaN(o)){const s=r(n,i,o);s.isValid||s.errors.forEach(n=>{n.includes("Latitude")?t.lat=n:n.includes("Longitude")?t.lon=n:n.includes("Depth")&&(t.depth=n),e.push(n)})}if(a.time.trim())try{const n=new Date(a.time);isNaN(n.getTime())&&(t.time="Invalid time format",e.push("Time must be in ISO-8601 format (e.g., 2025-08-14T12:00:00Z)"))}catch{t.time="Invalid time format",e.push("Time must be in ISO-8601 format")}return u(e),d(t),0===e.length},[a,r]),v=(0,i.useCallback)(async e=>{if(e.preventDefault(),!y())return;const n=parseFloat(a.lat),r=parseFloat(a.lon),i=parseFloat(a.depth),o=a.time.trim()||null;try{await t(n,r,i,o),console.log("Target set successfully")}catch(s){console.error("Failed to set target:",s),u([s.message])}},[a,t,y]),x=(0,i.useCallback)(e=>{l({lat:e.lat.toString(),lon:e.lon.toString(),depth:e.depth.toString(),time:a.time}),g(!1),u([]),d({})},[a.time]),b=(0,i.useCallback)(()=>{const e=(new Date).toISOString();l(t=>({...t,time:e}))},[]),w=(0,i.useCallback)(()=>{l(e=>({...e,time:""}))},[]),S=(0,i.useCallback)(()=>{const e=parseFloat(a.lat),t=parseFloat(a.lon),n=parseFloat(a.depth);if(isNaN(e)||isNaN(t)||isNaN(n))return null;return r(e,t,n).isValid?o(e,t,n):null},[a,r,o]);return(0,jr.jsxs)("div",{className:`p-4 border border-slate-600 rounded-lg ${s}`,children:[(0,jr.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,jr.jsx)("h3",{className:"text-lg font-semibold text-gray-100",children:"Set Target Position"}),(0,jr.jsx)("button",{type:"button",onClick:()=>g(!m),className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",children:m?"Hide Presets":"Show Presets"})]}),m&&(0,jr.jsxs)("div",{className:"mb-4 p-3 bg-slate-900 rounded border border-slate-600",children:[(0,jr.jsx)("h4",{className:"text-sm font-medium text-gray-200 mb-2",children:"Quick Presets"}),(0,jr.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[{name:"Mariana Trench",lat:11.35,lon:142.2,depth:10900,description:"Deepest point on Earth"},{name:"Mid-Atlantic Ridge",lat:0,lon:-25,depth:3e3,description:"Mid-ocean ridge"},{name:"Gulf of Mexico",lat:25,lon:-90,depth:1500,description:"Gulf waters"},{name:"Pacific Deep",lat:30,lon:-140,depth:4e3,description:"Deep Pacific Ocean"},{name:"Surface Test",lat:0,lon:0,depth:0,description:"Surface position"}].map((e,t)=>(0,jr.jsxs)("button",{onClick:()=>x(e),className:"text-left p-2 bg-slate-700 border border-slate-600 rounded hover:bg-blue-900/20 hover:border-blue-500/30 transition-colors",children:[(0,jr.jsx)("div",{className:"font-medium text-sm text-gray-100",children:e.name}),(0,jr.jsx)("div",{className:"text-xs text-gray-300",children:e.description}),(0,jr.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:[e.lat,"\xb0, ",e.lon,"\xb0, ",e.depth,"m"]})]},t))})]}),(0,jr.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,jr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsx)("label",{htmlFor:"latitude",className:"block text-sm font-medium text-gray-200 mb-1",children:"Latitude"}),(0,jr.jsx)("input",{id:"latitude",type:"number",step:"any",min:"-90",max:"90",value:a.lat,onChange:e=>_("lat",e.target.value),placeholder:"e.g., 11.35",className:`\n                w-full px-3 py-2 border rounded-md text-sm transition-colors bg-slate-700 text-gray-100\n                ${h.lat?"border-red-500 focus:border-red-400 focus:ring-red-400/20":"border-slate-600 focus:border-blue-400 focus:ring-blue-400/20"}\n              `,disabled:n}),h.lat&&(0,jr.jsx)("p",{className:"mt-1 text-xs text-red-400",children:h.lat}),(0,jr.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:"-90 to 90 degrees"})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("label",{htmlFor:"longitude",className:"block text-sm font-medium text-gray-200 mb-1",children:"Longitude"}),(0,jr.jsx)("input",{id:"longitude",type:"number",step:"any",min:"-180",max:"180",value:a.lon,onChange:e=>_("lon",e.target.value),placeholder:"e.g., 142.20",className:`\n                w-full px-3 py-2 border rounded-md text-sm transition-colors bg-slate-700 text-gray-100\n                ${h.lon?"border-red-500 focus:border-red-400 focus:ring-red-400/20":"border-slate-600 focus:border-blue-400 focus:ring-blue-400/20"}\n              `,disabled:n}),h.lon&&(0,jr.jsx)("p",{className:"mt-1 text-xs text-red-400",children:h.lon}),(0,jr.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:"-180 to 180 degrees"})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("label",{htmlFor:"depth",className:"block text-sm font-medium text-gray-200 mb-1",children:"Depth"}),(0,jr.jsx)("input",{id:"depth",type:"number",step:"any",min:"-11000",max:"11000",value:a.depth,onChange:e=>_("depth",e.target.value),placeholder:"e.g., 10900",className:`\n                w-full px-3 py-2 border rounded-md text-sm transition-colors bg-slate-700 text-gray-100\n                ${h.depth?"border-red-500 focus:border-red-400 focus:ring-red-400/20":"border-slate-600 focus:border-blue-400 focus:ring-blue-400/20"}\n              `,disabled:n}),h.depth&&(0,jr.jsx)("p",{className:"mt-1 text-xs text-red-400",children:h.depth}),(0,jr.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:"-11000 to 11000 meters (+ = deeper)"})]})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,jr.jsx)("label",{htmlFor:"time",className:"block text-sm font-medium text-gray-200",children:"Time (Optional)"}),(0,jr.jsxs)("div",{className:"flex gap-2",children:[(0,jr.jsxs)("button",{type:"button",onClick:()=>p(!f),className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",children:[f?"Hide":"Show"," Time Input"]}),f&&(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsx)("button",{type:"button",onClick:b,className:"text-xs text-green-400 hover:text-green-300 transition-colors",children:"Use Current Time"}),(0,jr.jsx)("button",{type:"button",onClick:w,className:"text-xs text-gray-400 hover:text-gray-300 transition-colors",children:"Clear"})]})]})]}),f&&(0,jr.jsxs)("div",{children:[(0,jr.jsx)("input",{id:"time",type:"text",value:a.time,onChange:e=>_("time",e.target.value),placeholder:"2025-08-14T12:00:00Z",className:`\n                  w-full px-3 py-2 border rounded-md text-sm transition-colors bg-slate-700 text-gray-100\n                  ${h.time?"border-red-500 focus:border-red-400 focus:ring-red-400/20":"border-slate-600 focus:border-blue-400 focus:ring-blue-400/20"}\n                `,disabled:n}),h.time&&(0,jr.jsx)("p",{className:"mt-1 text-xs text-red-400",children:h.time}),(0,jr.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:"ISO-8601 format (YYYY-MM-DDTHH:mm:ssZ). Leave blank to use current time."})]})]}),(()=>{const e=S();return e?(0,jr.jsxs)("div",{className:"p-3 bg-blue-900/20 border border-blue-700/30 rounded",children:[(0,jr.jsx)("h4",{className:"text-sm font-medium text-blue-400 mb-1",children:"Target Preview"}),(0,jr.jsx)("p",{className:"text-sm text-blue-300",children:e})]}):null})(),c.length>0&&(0,jr.jsxs)("div",{className:"p-3 bg-red-900/20 border border-red-700/30 rounded",children:[(0,jr.jsx)("h4",{className:"text-sm font-medium text-red-400 mb-2",children:"Validation Errors"}),(0,jr.jsx)("ul",{className:"text-sm text-red-300 space-y-1",children:c.map((e,t)=>(0,jr.jsxs)("li",{className:"flex items-start gap-2",children:[(0,jr.jsx)("span",{className:"text-red-400 mt-0.5",children:"\u2022"}),(0,jr.jsx)("span",{children:e})]},t))})]}),(0,jr.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,jr.jsx)("button",{type:"submit",disabled:n||!a.lat||!a.lon||!a.depth,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?(0,jr.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,jr.jsx)("svg",{className:"animate-spin w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Setting Target..."]}):"Set Target Position"}),(0,jr.jsx)("button",{type:"button",onClick:()=>{l({lat:"",lon:"",depth:"",time:""}),u([]),d({})},disabled:n,className:"px-4 py-2 bg-slate-600 text-white rounded-md hover:bg-slate-700 transition-colors disabled:opacity-50",children:"Clear"})]}),(0,jr.jsxs)("div",{className:"text-xs text-gray-400 space-y-1",children:[(0,jr.jsx)("p",{children:"\u2022 Coordinates use decimal degrees (positive = North/East, negative = South/West)"}),(0,jr.jsx)("p",{children:"\u2022 Depth uses meters with positive values going deeper underwater"}),(0,jr.jsx)("p",{children:"\u2022 Time is optional and defaults to current time if not specified"}),(0,jr.jsx)("p",{children:"\u2022 The agent will navigate to this position when the target is set"})]})]})]})},hi=e=>{let{className:t="",autoConnect:n=!1}=e;const{isConnected:r,isConnecting:o,reconnectAttempts:s,connectionError:a,connectionStatus:l,isSubscribed:c,status:u,target:h,current:d,holoOceanState:f,lastUpdated:p,isHoloOceanRunning:m,tickCount:g,holoOceanError:_,hasTarget:y,hasCurrent:v,distanceToTarget:x,depthDifference:b,isAtTarget:w,error:S,serverError:E,isSettingTarget:T,isGettingStatus:A,connect:C,disconnect:P,reconnect:I,setTarget:k,getStatus:M,subscribe:R,unsubscribe:O,clearError:L,validateCoordinates:D,formatCoordinates:N}=Pr(n),[z,F]=(0,i.useState)(!1),[B,j]=(0,i.useState)(!1),U=async()=>{try{await C()}catch(S){console.error("Connection failed:",S)}},V=e=>{if(!e)return"Unknown";try{return new Date(e).toLocaleString()}catch{return e}},G=e=>null===e||void 0===e?"Unknown":e<1e3?`${e.toFixed(1)}m`:`${(e/1e3).toFixed(2)}km`,H=e=>null===e||void 0===e?"Unknown":`${e.toFixed(1)}m`;return(0,jr.jsxs)("div",{className:`bg-slate-800 rounded-lg shadow-lg p-6 ${t}`,children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,jr.jsx)("h2",{className:"text-xl font-bold text-white",children:"HoloOcean Agent Control"}),(0,jr.jsx)(ci,{isConnected:r,isConnecting:o,reconnectAttempts:s,error:a})]}),(S||E||a)&&(0,jr.jsx)("div",{className:"mb-4 p-3 bg-red-900/20 border border-red-700 rounded-md",children:(0,jr.jsxs)("div",{className:"flex justify-between items-start",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsx)("h4",{className:"text-sm font-medium text-red-400",children:"Error"}),(0,jr.jsx)("p",{className:"text-sm text-red-300 mt-1",children:E||S||a})]}),(0,jr.jsx)("button",{onClick:L,className:"text-red-400 hover:text-red-200",title:"Clear error",children:"\xd7"})]})}),(0,jr.jsxs)("div",{className:"mb-6 p-4 border border-slate-600 rounded-lg",children:[(0,jr.jsx)("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Connection"}),(0,jr.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[!r&&!o&&(0,jr.jsx)("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Connect"}),r&&(0,jr.jsx)("button",{onClick:()=>{P()},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Disconnect"}),(a||s>0)&&(0,jr.jsx)("button",{onClick:async()=>{try{await I()}catch(S){console.error("Reconnection failed:",S)}},disabled:o,className:"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 transition-colors disabled:opacity-50",children:o?"Connecting...":"Reconnect"})]}),(0,jr.jsxs)("div",{className:"text-sm text-gray-300",children:[(0,jr.jsxs)("p",{children:["Endpoint: ",l.endpoint]}),(0,jr.jsxs)("p",{children:["Status: ",l.readyState]}),s>0&&(0,jr.jsxs)("p",{children:["Reconnect attempts: ",s,"/",l.maxAttempts]})]})]}),r&&(0,jr.jsx)("div",{className:"mb-6",children:(0,jr.jsx)(ui,{onSetTarget:k,isLoading:T,validateCoordinates:D,formatCoordinates:N})}),r&&(0,jr.jsxs)("div",{className:"mb-6 p-4 border border-slate-600 rounded-lg",children:[(0,jr.jsx)("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Status Updates"}),(0,jr.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[(0,jr.jsx)("button",{onClick:async()=>{try{await M()}catch(S){console.error("Status refresh failed:",S)}},disabled:A,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors disabled:opacity-50",children:A?"Getting Status...":"Refresh Status"}),c?(0,jr.jsx)("button",{onClick:()=>{O()},className:"px-4 py-2 bg-slate-600 text-white rounded hover:bg-slate-700 transition-colors",children:"Unsubscribe"}):(0,jr.jsx)("button",{onClick:async()=>{try{await R()}catch(S){console.error("Subscribe failed:",S)}},className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors",children:"Subscribe to Updates"})]}),(0,jr.jsxs)("div",{className:"text-sm text-gray-300",children:[c&&(0,jr.jsx)("p",{className:"text-green-400",children:"\u2713 Receiving live updates (~1 second interval)"}),p&&(0,jr.jsxs)("p",{children:["Last updated: ",V(p)]})]})]}),u&&(0,jr.jsxs)("div",{className:"mb-6 p-4 border border-slate-600 rounded-lg",children:[(0,jr.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,jr.jsx)("h3",{className:"text-lg font-semibold text-gray-100",children:"Agent Status"}),(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jr.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium "+(m?"bg-green-900/30 text-green-400":"bg-red-900/30 text-red-400"),children:m?"Running":"Stopped"}),g>0&&(0,jr.jsxs)("span",{className:"text-xs text-gray-400",children:["Tick: ",g.toLocaleString()]})]})]}),y&&(0,jr.jsxs)("div",{className:"mb-4 p-3 bg-blue-900/20 border border-blue-700/30 rounded",children:[(0,jr.jsx)("h4",{className:"font-medium text-blue-400 mb-2",children:"Target Position"}),(0,jr.jsxs)("div",{className:"text-sm text-blue-300",children:[(0,jr.jsxs)("p",{children:["Latitude: ",h.lat.toFixed(6),"\xb0"]}),(0,jr.jsxs)("p",{children:["Longitude: ",h.lon.toFixed(6),"\xb0"]}),(0,jr.jsxs)("p",{children:["Depth: ",H(h.depth)]}),h.time&&(0,jr.jsxs)("p",{children:["Time: ",V(h.time)]})]})]}),v&&(0,jr.jsxs)("div",{className:"mb-4 p-3 bg-green-900/20 border border-green-700/30 rounded",children:[(0,jr.jsx)("h4",{className:"font-medium text-green-400 mb-2",children:"Current Position"}),(0,jr.jsxs)("div",{className:"text-sm text-green-300",children:[(0,jr.jsxs)("p",{children:["Latitude: ",d.lat.toFixed(6),"\xb0"]}),(0,jr.jsxs)("p",{children:["Longitude: ",d.lon.toFixed(6),"\xb0"]}),(0,jr.jsxs)("p",{children:["Depth: ",H(d.depth)]}),d.time&&(0,jr.jsxs)("p",{children:["Time: ",V(d.time)]})]})]}),y&&v&&(0,jr.jsxs)("div",{className:"mb-4 p-3 bg-yellow-900/20 border border-yellow-700/30 rounded",children:[(0,jr.jsx)("h4",{className:"font-medium text-yellow-400 mb-2",children:"Navigation"}),(0,jr.jsxs)("div",{className:"text-sm text-yellow-300",children:[(0,jr.jsxs)("p",{children:["Distance to target: ",G(x)]}),null!==b&&(0,jr.jsxs)("p",{children:["Depth difference: ",G(b)]}),(0,jr.jsx)("p",{className:"font-medium "+(w?"text-green-400":"text-yellow-400"),children:w?"\u2713 At target position":"\u2192 Moving to target"})]})]}),_&&(0,jr.jsxs)("div",{className:"mb-4 p-3 bg-red-900/20 border border-red-700/30 rounded",children:[(0,jr.jsx)("h4",{className:"font-medium text-red-400 mb-2",children:"Simulation Error"}),(0,jr.jsx)("p",{className:"text-sm text-red-300",children:_})]}),(0,jr.jsxs)("div",{className:"border-t border-slate-600 pt-4",children:[(0,jr.jsxs)("button",{onClick:()=>F(!z),className:"text-sm text-gray-300 hover:text-gray-100 mb-3",children:[z?"\u25bc":"\u25b6"," Advanced Controls"]}),z&&(0,jr.jsxs)("div",{className:"space-y-3",children:[(0,jr.jsx)("div",{className:"flex flex-wrap gap-2",children:(0,jr.jsxs)("button",{onClick:()=>j(!B),className:"px-3 py-1 text-sm bg-slate-700 text-gray-200 rounded hover:bg-slate-600 transition-colors",children:[B?"Hide":"Show"," Raw Data"]})}),B&&u&&(0,jr.jsxs)("div",{className:"p-3 bg-slate-900 rounded border border-slate-600 overflow-auto",children:[(0,jr.jsx)("h5",{className:"font-medium text-gray-200 mb-2",children:"Raw Status Data"}),(0,jr.jsx)("pre",{className:"text-xs text-gray-300 whitespace-pre-wrap",children:JSON.stringify(u,null,2)})]}),(0,jr.jsxs)("div",{className:"p-3 bg-slate-900 rounded border border-slate-600",children:[(0,jr.jsx)("h5",{className:"font-medium text-gray-200 mb-2",children:"Connection Info"}),(0,jr.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-300",children:[(0,jr.jsxs)("div",{children:["Subscribed: ",c?"Yes":"No"]}),(0,jr.jsxs)("div",{children:["Ready State: ",l.readyState]}),(0,jr.jsxs)("div",{children:["Reconnects: ",s]}),(0,jr.jsxs)("div",{children:["Endpoint: ",l.endpoint]})]})]})]})]})]}),!r&&!o&&(0,jr.jsxs)("div",{className:"text-center py-8",children:[(0,jr.jsxs)("div",{className:"text-gray-400 mb-4",children:[(0,jr.jsx)("div",{className:"w-16 h-16 mx-auto mb-3 bg-slate-700 rounded-full flex items-center justify-center",children:(0,jr.jsx)("svg",{className:"w-8 h-8 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})})}),(0,jr.jsx)("p",{className:"text-lg text-gray-200",children:"Not connected to HoloOcean"}),(0,jr.jsx)("p",{className:"text-sm text-gray-400",children:"Connect to start controlling the underwater agent"})]}),a&&(0,jr.jsxs)("div",{className:"mb-4 p-3 bg-red-900/20 border border-red-700 rounded text-sm text-red-300",children:["Connection failed: ",a]}),(0,jr.jsx)("button",{onClick:U,disabled:o,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:o?"Connecting...":"Connect to HoloOcean"})]}),o&&(0,jr.jsxs)("div",{className:"text-center py-8",children:[(0,jr.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-3"}),(0,jr.jsx)("p",{className:"text-gray-300",children:"Connecting to HoloOcean..."}),s>0&&(0,jr.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Attempt ",s,"/",l.maxAttempts]})]})]})},di=()=>{const{loginWithRedirect:e,isLoading:t}=Xn();return(0,jr.jsx)("button",{onClick:async()=>{try{await e({authorizationParams:{redirect_uri:window.location.origin+"/auth/callback",scope:"openid profile email",response_type:"code"}})}catch(t){console.error("Login error:",t)}},disabled:t,className:"w-full py-2 px-4 bg-pink-600 hover:bg-pink-700 disabled:bg-pink-400 rounded-md font-semibold text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-pink-500 disabled:cursor-not-allowed",children:t?(0,jr.jsxs)("span",{className:"flex items-center justify-center",children:[(0,jr.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Logging in..."]}):"Log In"})},fi=()=>{const{logout:e}=Xn();return(0,jr.jsx)("button",{onClick:()=>e({logoutParams:{returnTo:window.location.origin}}),className:"w-full py-2 px-4 bg-gray-600 hover:bg-gray-700 rounded-md font-semibold text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-gray-500",children:"Log Out"})},pi=()=>{const{user:e,isAuthenticated:t,isLoading:n}=Xn();return n?(0,jr.jsx)("div",{children:"Loading ..."}):t&&(0,jr.jsxs)("div",{className:"flex items-center",children:[(0,jr.jsx)("img",{src:e.picture,alt:e.name,className:"w-8 h-8 rounded-full mr-2"}),(0,jr.jsx)("span",{className:"text-white",children:e.name})]})},mi=e=>{let{dataSource:t="simulated",timeZone:n="UTC",onTimeZoneChange:r,onSettingsClick:o,connectionStatus:s="connected",dataQuality:a=null,showDataStatus:l=!0,showTutorial:c=!1,onTutorialToggle:u,tutorialStep:h=0,isFirstTimeUser:d=!1}=e;const{isAuthenticated:f}=Xn(),[p,m]=(0,i.useState)(new Date),[g,_]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1);(0,i.useEffect)(()=>{const e=setInterval(()=>{m(new Date)},1e3);return()=>clearInterval(e)},[]),(0,i.useEffect)(()=>{if(d&&!c){if(!yr.getItem("ocean-monitor-tutorial-completed")){const e=setTimeout(()=>{u&&u(!0)},2e3);return()=>clearTimeout(e)}}},[d,c,u]);const x=()=>{const e={hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"};switch(n){case"UTC":return p.toLocaleString("en-US",{...e,timeZone:"UTC"});case"Local":default:return p.toLocaleString("en-US",e);case"CST":return p.toLocaleString("en-US",{...e,timeZone:"America/Chicago"})}},b=(()=>{switch(t){case"api":return{text:"API Stream",color:"text-blue-400",icon:Gr};case"simulated":return{text:"Simulated",color:"text-yellow-400",icon:zr};case"none":return{text:"No Data",color:"text-red-400",icon:ri};default:return{text:"Unknown",color:"text-gray-400",icon:zr}}})(),w=b.icon;return(0,jr.jsxs)("header",{className:"bg-slate-800 border-b border-slate-700 px-3 md:px-6 py-2 md:py-4 relative",children:[(0,jr.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-2 md:gap-3",children:[(0,jr.jsx)("div",{className:"w-8 h-8 md:w-10 md:h-10 flex items-center justify-center",children:(0,jr.jsx)("img",{src:ai,alt:"Roger F. Wicker Center for Ocean Enterprise",className:"w-full h-full object-contain"})}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"CubeAI"}),(0,jr.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-slate-400",children:[(0,jr.jsx)("span",{children:"USM Maritime Technology Solutions"}),(0,jr.jsx)("div",{className:"w-1 h-1 bg-slate-500 rounded-full"}),(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)(w,{className:"w-3 h-3"}),(0,jr.jsxs)("span",{className:b.color,children:["Data: ",b.text]}),(()=>{switch(s){case"connected":return(0,jr.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"});case"connecting":return(0,jr.jsx)("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-ping"});case"disconnected":return(0,jr.jsx)("div",{className:"w-2 h-2 bg-red-400 rounded-full"});default:return(0,jr.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})}})()]})]})]})]}),(0,jr.jsxs)("div",{className:"flex flex-col items-start sm:items-center gap-2 w-full sm:w-auto",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-2 md:gap-4 w-full sm:w-auto",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm",children:[(0,jr.jsx)(ii,{className:"w-3 h-3 md:w-4 md:h-4 text-slate-400"}),(0,jr.jsxs)("select",{value:n,onChange:e=>r&&r(e.target.value),className:"bg-slate-700 border border-slate-600 rounded px-1 md:px-2 py-1 text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-blue-400",children:[(0,jr.jsx)("option",{value:"UTC",children:"UTC"}),(0,jr.jsx)("option",{value:"Local",children:"Local Time"}),(0,jr.jsx)("option",{value:"CST",children:"CST"})]})]}),(0,jr.jsx)("div",{className:"text-xs md:text-sm text-slate-300 hidden sm:block font-mono",children:x()}),l&&a&&(0,jr.jsxs)("div",{className:"flex items-center gap-1 text-xs text-slate-400 bg-slate-700/50 px-2 py-1 rounded",children:[(0,jr.jsx)(zr,{className:"w-3 h-3"}),(0,jr.jsxs)("span",{children:[a.stations,"S/",a.measurements,"M"]})]}),(0,jr.jsxs)("div",{className:"relative",children:[(0,jr.jsx)("button",{onClick:()=>v(!y),className:"p-1 md:p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-green-400 "+(y?"bg-green-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"),"aria-label":"HoloOcean Agent Control",title:"HoloOcean Agent Control Panel",children:(0,jr.jsx)(oi,{className:"w-4 h-4 md:w-5 md:h-5"})}),y&&(0,jr.jsx)("div",{className:"absolute top-full right-0 mt-2 w-96 max-w-[calc(100vw-1rem)] bg-slate-800 border border-slate-600 rounded-lg shadow-xl z-50 max-h-[80vh] overflow-y-auto",children:(0,jr.jsx)(hi,{className:"border-0 bg-transparent shadow-none"})})]}),(0,jr.jsxs)("button",{onClick:()=>u&&u(!c),className:"p-1 md:p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 relative "+(c?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"),"aria-label":"Tutorial",title:"Interactive Tutorial",children:[(0,jr.jsx)(Zr,{className:"w-4 h-4 md:w-5 md:h-5"}),c&&h>0&&(0,jr.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center",children:h}),d&&!yr.getItem("ocean-monitor-tutorial-completed")&&(0,jr.jsx)("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-yellow-400 rounded-full animate-pulse"})]}),(0,jr.jsx)("div",{className:"flex items-center gap-2",children:f?(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsx)(pi,{}),(0,jr.jsx)(fi,{})]}):(0,jr.jsx)(di,{})}),(0,jr.jsxs)("div",{className:"relative",children:[(0,jr.jsx)("button",{onClick:()=>{_(!g),o&&o()},className:"p-1 md:p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Settings",children:(0,jr.jsx)(Wr,{className:"w-4 h-4 md:w-5 md:h-5"})}),g&&(0,jr.jsx)("div",{className:"absolute top-full right-0 mt-2 w-64 bg-slate-800 border border-slate-600 rounded-lg shadow-xl z-50",children:(0,jr.jsxs)("div",{className:"p-3",children:[(0,jr.jsx)("div",{className:"text-sm font-semibold text-slate-200 mb-3",children:"System Settings"}),(0,jr.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,jr.jsxs)("div",{className:"flex justify-between",children:[(0,jr.jsx)("span",{className:"text-slate-400",children:"Data Source:"}),(0,jr.jsx)("span",{className:b.color,children:b.text})]}),(0,jr.jsxs)("div",{className:"flex justify-between",children:[(0,jr.jsx)("span",{className:"text-slate-400",children:"Connection:"}),(0,jr.jsx)("span",{className:"connected"===s?"text-green-400":"connecting"===s?"text-yellow-400":"text-red-400",children:s.charAt(0).toUpperCase()+s.slice(1)})]}),a&&(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsxs)("div",{className:"flex justify-between",children:[(0,jr.jsx)("span",{className:"text-slate-400",children:"Stations:"}),(0,jr.jsxs)("span",{className:"text-slate-300",children:[a.stations," Stations"]})]}),(0,jr.jsxs)("div",{className:"flex justify-between",children:[(0,jr.jsx)("span",{className:"text-slate-400",children:"Measurements:"}),(0,jr.jsxs)("span",{className:"text-slate-300",children:[a.measurements," Measurements"]})]}),a.lastUpdate&&(0,jr.jsxs)("div",{className:"flex justify-between",children:[(0,jr.jsx)("span",{className:"text-slate-400",children:"Last Update:"}),(0,jr.jsx)("span",{className:"text-slate-300",children:new Date(a.lastUpdate).toLocaleTimeString()})]})]})]}),(0,jr.jsx)("div",{className:"mt-4 pt-3 border-t border-slate-700",children:(0,jr.jsxs)("div",{className:"space-y-2",children:[(0,jr.jsxs)("button",{onClick:()=>{v(!y),_(!1)},className:"w-full text-left text-xs text-slate-300 hover:text-white p-2 hover:bg-slate-700 rounded transition-colors flex items-center gap-2",children:[(0,jr.jsx)(oi,{className:"w-3 h-3"}),y?"Hide":"Show"," HoloOcean Control"]}),(0,jr.jsxs)("button",{onClick:()=>{u&&u(!0),_(!1)},className:"w-full text-left text-xs text-slate-300 hover:text-white p-2 hover:bg-slate-700 rounded transition-colors flex items-center gap-2",children:[(0,jr.jsx)(si,{className:"w-3 h-3"}),"Start Tutorial"]}),(0,jr.jsx)("button",{onClick:()=>window.location.reload(),className:"w-full text-left text-xs text-slate-300 hover:text-white p-2 hover:bg-slate-700 rounded transition-colors",children:"Refresh Data"})]})})]})})]})]}),(0,jr.jsx)("div",{className:"flex items-center justify-end sm:justify-center",children:(0,jr.jsx)("img",{src:li,alt:"Powered by CubeAI",className:"h-6 md:h-8"})})]})]}),(0,jr.jsxs)("div",{className:"sm:hidden mt-2 text-xs text-slate-300 font-mono text-center",children:[x()," ",n]}),(g||y)&&(0,jr.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>{_(!1),v(!1)}})]})};var gi=n(7950);function _i(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=_i(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function yi(){for(var e,t,n=0,r="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=_i(e))&&(r&&(r+=" "),r+=t);return r}const vi=yi,xi=["onCopy","onCut","onPaste","onCompositionEnd","onCompositionStart","onCompositionUpdate","onFocus","onBlur","onInput","onInvalid","onReset","onSubmit","onLoad","onError","onKeyDown","onKeyPress","onKeyUp","onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting","onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onSelect","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onScroll","onWheel","onAnimationStart","onAnimationEnd","onAnimationIteration","onTransitionEnd","onChange","onToggle"];const bi=(e,t,n,r)=>{if("length"===n||"prototype"===n)return;if("arguments"===n||"caller"===n)return;const i=Object.getOwnPropertyDescriptor(e,n),o=Object.getOwnPropertyDescriptor(t,n);!wi(i,o)&&r||Object.defineProperty(e,n,o)},wi=function(e,t){return void 0===e||e.configurable||e.writable===t.writable&&e.enumerable===t.enumerable&&e.configurable===t.configurable&&(e.writable||e.value===t.value)},Si=(e,t)=>`/* Wrapped ${e}*/\n${t}`,Ei=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),Ti=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name");function Ai(e,t){let{ignoreNonConfigurable:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{name:r}=e;for(const i of Reflect.ownKeys(t))bi(e,t,i,n);return((e,t)=>{const n=Object.getPrototypeOf(t);n!==Object.getPrototypeOf(e)&&Object.setPrototypeOf(e,n)})(e,t),((e,t,n)=>{const r=""===n?"":`with ${n.trim()}() `,i=Si.bind(null,r,t.toString());Object.defineProperty(i,"name",Ti);const{writable:o,enumerable:s,configurable:a}=Ei;Object.defineProperty(e,"toString",{value:i,writable:o,enumerable:s,configurable:a})})(e,t,r),e}const Ci=new WeakMap,Pi=new WeakMap;function Ii(e){let{cacheKey:t,cache:n=new Map,maxAge:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===r)return e;if("number"===typeof r){const e=2147483647;if(r>e)throw new TypeError(`The \`maxAge\` option cannot exceed ${e}.`);if(r<0)throw new TypeError("The `maxAge` option should not be a negative number.")}const i=function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];const a=t?t(o):o[0],l=n.get(a);if(l)return l.data;const c=e.apply(this,o),u="function"===typeof r?r(...o):r;if(n.set(a,{data:c,maxAge:u?Date.now()+u:Number.POSITIVE_INFINITY}),u&&u>0&&u!==Number.POSITIVE_INFINITY){const t=setTimeout(()=>{n.delete(a)},u);t.unref?.();const r=Pi.get(e)??new Set;r.add(t),Pi.set(e,r)}return c};return Ai(i,e,{ignoreNonConfigurable:!0}),Ci.set(i,n),i}function ki(e){return"string"===typeof e}function Mi(e,t,n){return n.indexOf(e)===t}function Ri(e){return-1===e.indexOf(",")?e:e.split(",")}function Oi(e){if(!e)return e;if("C"===e||"posix"===e||"POSIX"===e)return"en-US";if(-1!==e.indexOf(".")){var t=e.split(".")[0];return Oi(void 0===t?"":t)}if(-1!==e.indexOf("@")){var n=e.split("@")[0];return Oi(void 0===n?"":n)}if(-1===e.indexOf("-")||(r=e).toLowerCase()!==r)return e;var r,i=e.split("-"),o=i[0],s=i[1],a=void 0===s?"":s;return"".concat(o,"-").concat(a.toUpperCase())}var Li=Ii(function(e){var t=void 0===e?{}:e,n=t.useFallbackLocale,r=void 0===n||n,i=t.fallbackLocale,o=void 0===i?"en-US":i,s=[];if("undefined"!==typeof navigator){for(var a=[],l=0,c=navigator.languages||[];l<c.length;l++){var u=c[l];a=a.concat(Ri(u))}var h=navigator.language,d=h?Ri(h):h;s=s.concat(a,d)}return r&&s.push(o),s.filter(ki).map(Oi).filter(Mi)},{cacheKey:JSON.stringify});var Di=Ii(function(e){return Li(e)[0]||null},{cacheKey:JSON.stringify});const Ni=Di;function zi(e,t,n){return function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;const o=e(r)+i;return t(o)}}function Fi(e){return function(t){return new Date(e(t).getTime()-1)}}function Bi(e,t){return function(n){return[e(n),t(n)]}}function ji(e){if(e instanceof Date)return e.getFullYear();if("number"===typeof e)return e;const t=Number.parseInt(e,10);if("string"===typeof e&&!Number.isNaN(t))return t;throw new Error(`Failed to get year from date: ${e}.`)}function Ui(e){if(e instanceof Date)return e.getMonth();throw new Error(`Failed to get month from date: ${e}.`)}function Vi(e){if(e instanceof Date)return e.getMonth()+1;throw new Error(`Failed to get human-readable month from date: ${e}.`)}function Gi(e){if(e instanceof Date)return e.getDate();throw new Error(`Failed to get year from date: ${e}.`)}function Hi(e){if(e instanceof Date)return e.getHours();if("string"===typeof e){const t=e.split(":");if(t.length>=2){const e=t[0];if(e){const t=Number.parseInt(e,10);if(!Number.isNaN(t))return t}}}throw new Error(`Failed to get hours from date: ${e}.`)}function $i(e){if(e instanceof Date)return e.getMinutes();if("string"===typeof e){const t=e.split(":");if(t.length>=2){const e=t[1]||"0",n=Number.parseInt(e,10);if(!Number.isNaN(n))return n}}throw new Error(`Failed to get minutes from date: ${e}.`)}function Wi(e){if(e instanceof Date)return e.getSeconds();if("string"===typeof e){const t=e.split(":");if(t.length>=2){const e=t[2]||"0",n=Number.parseInt(e,10);if(!Number.isNaN(n))return n}}throw new Error(`Failed to get seconds from date: ${e}.`)}function qi(e){if(e instanceof Date)return e.getMilliseconds();if("string"===typeof e){const t=e.split(":");if(t.length>=2){const e=(t[2]||"0").split(".")[1]||"0",n=Number.parseInt(e,10);if(!Number.isNaN(n))return n}}throw new Error(`Failed to get seconds from date: ${e}.`)}function Xi(e){const t=ji(e),n=t+(1-t)%100,r=new Date;return r.setFullYear(n,0,1),r.setHours(0,0,0,0),r}const Zi=zi(ji,Xi,-100),Ki=zi(ji,Xi,100),Yi=Fi(Ki),Ji=zi(ji,Yi,-100),Qi=(zi(ji,Yi,100),Bi(Xi,Yi));function eo(e){const t=ji(e),n=t+(1-t)%10,r=new Date;return r.setFullYear(n,0,1),r.setHours(0,0,0,0),r}const to=zi(ji,eo,-10),no=zi(ji,eo,10),ro=Fi(no),io=zi(ji,ro,-10),oo=(zi(ji,ro,10),Bi(eo,ro));function so(e){const t=ji(e),n=new Date;return n.setFullYear(t,0,1),n.setHours(0,0,0,0),n}const ao=zi(ji,so,-1),lo=zi(ji,so,1),co=Fi(lo),uo=zi(ji,co,-1),ho=(zi(ji,co,1),Bi(so,co));function fo(e,t){return function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;const i=ji(n),o=Ui(n)+r,s=new Date;return s.setFullYear(i,o,1),s.setHours(0,0,0,0),e(s)}}function po(e){const t=ji(e),n=Ui(e),r=new Date;return r.setFullYear(t,n,1),r.setHours(0,0,0,0),r}const mo=fo(po,-1),go=fo(po,1),_o=Fi(go),yo=fo(_o,-1),vo=(fo(_o,1),Bi(po,_o));function xo(e,t){return function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;const i=ji(n),o=Ui(n),s=Gi(n)+r,a=new Date;return a.setFullYear(i,o,s),a.setHours(0,0,0,0),e(a)}}function bo(e){const t=ji(e),n=Ui(e),r=Gi(e),i=new Date;return i.setFullYear(t,n,r),i.setHours(0,0,0,0),i}xo(bo,-1);const wo=Fi(xo(bo,1)),So=(xo(wo,-1),xo(wo,1),Bi(bo,wo));function Eo(e){return Gi(_o(e))}function To(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=`${e}`;return n.length>=t?e:`0000${n}`.slice(-t)}function Ao(e){return`${To(Hi(e))}:${To($i(e))}:${To(Wi(e))}`}function Co(e){return`${To(ji(e),4)}-${To(Vi(e))}-${To(Gi(e))}`}function Po(e){return`${Co(e)}T${Ao(e)}`}var Io="gregory",ko="hebrew",Mo="islamic",Ro="iso8601",Oo={gregory:["en-CA","en-US","es-AR","es-BO","es-CL","es-CO","es-CR","es-DO","es-EC","es-GT","es-HN","es-MX","es-NI","es-PA","es-PE","es-PR","es-SV","es-VE","pt-BR"],hebrew:["he","he-IL"],islamic:["ar","ar-AE","ar-BH","ar-DZ","ar-EG","ar-IQ","ar-JO","ar-KW","ar-LY","ar-OM","ar-QA","ar-SA","ar-SD","ar-SY","ar-YE","dv","dv-MV","ps","ps-AR"]},Lo=[0,1,2,3,4,5,6],Do=new Map;function No(e){return function(t,n){return function(e){return function(t,n){var r=t||Ni();Do.has(r)||Do.set(r,new Map);var i=Do.get(r);return i.has(e)||i.set(e,new Intl.DateTimeFormat(r||void 0,e).format),i.get(e)(n)}}(e)(t,function(e){var t=new Date(e);return new Date(t.setHours(12))}(n))}}No({day:"numeric",month:"numeric",year:"numeric"});var zo=No({day:"numeric"}),Fo=No({day:"numeric",month:"long",year:"numeric"}),Bo=No({month:"long"}),jo=No({month:"long",year:"numeric"}),Uo=No({weekday:"short"}),Vo=No({weekday:"long"}),Go=No({year:"numeric"}),Ho=Lo[0],$o=Lo[5],Wo=Lo[6];function qo(e,t){void 0===t&&(t=Ro);var n=e.getDay();switch(t){case Ro:return(n+6)%7;case Mo:return(n+1)%7;case ko:case Io:return n;default:throw new Error("Unsupported calendar type.")}}function Xo(e,t){void 0===t&&(t=Ro);var n=ji(e),r=Ui(e),i=e.getDate()-qo(e,t);return new Date(n,r,i)}function Zo(e,t){switch(e){case"century":return Xi(t);case"decade":return eo(t);case"year":return so(t);case"month":return po(t);case"day":return bo(t);default:throw new Error("Invalid rangeType: ".concat(e))}}function Ko(e,t){switch(e){case"century":return Ki(t);case"decade":return no(t);case"year":return lo(t);case"month":return go(t);default:throw new Error("Invalid rangeType: ".concat(e))}}function Yo(e,t){switch(e){case"century":return Yi(t);case"decade":return ro(t);case"year":return co(t);case"month":return _o(t);case"day":return wo(t);default:throw new Error("Invalid rangeType: ".concat(e))}}function Jo(e,t){switch(e){case"century":return Qi(t);case"decade":return oo(t);case"year":return ho(t);case"month":return vo(t);case"day":return So(t);default:throw new Error("Invalid rangeType: ".concat(e))}}function Qo(e,t,n){return n.map(function(n){return(t||Go)(e,n)}).join(" \u2013 ")}function es(e,t,n){return Qo(e,t,oo(n))}function ts(e){return e.getDay()===(new Date).getDay()}function ns(e,t){void 0===t&&(t=Ro);var n=e.getDay();switch(t){case Mo:case ko:return n===$o||n===Wo;case Ro:case Io:return n===Wo||n===Ho;default:throw new Error("Unsupported calendar type.")}}var rs="react-calendar__navigation";function is(e){var t=e.activeStartDate,n=e.drillUp,r=e.formatMonthYear,i=void 0===r?jo:r,o=e.formatYear,s=void 0===o?Go:o,a=e.locale,l=e.maxDate,c=e.minDate,u=e.navigationAriaLabel,h=void 0===u?"":u,d=e.navigationAriaLive,f=e.navigationLabel,p=e.next2AriaLabel,m=void 0===p?"":p,g=e.next2Label,_=void 0===g?"\xbb":g,y=e.nextAriaLabel,v=void 0===y?"":y,x=e.nextLabel,b=void 0===x?"\u203a":x,w=e.prev2AriaLabel,S=void 0===w?"":w,E=e.prev2Label,T=void 0===E?"\xab":E,A=e.prevAriaLabel,C=void 0===A?"":A,P=e.prevLabel,I=void 0===P?"\u2039":P,k=e.setActiveStartDate,M=e.showDoubleView,R=e.view,O=e.views.indexOf(R)>0,L="century"!==R,D=function(e,t){switch(e){case"century":return Zi(t);case"decade":return to(t);case"year":return ao(t);case"month":return mo(t);default:throw new Error("Invalid rangeType: ".concat(e))}}(R,t),N=L?function(e,t){switch(e){case"decade":return to(t,-100);case"year":return ao(t,-10);case"month":return mo(t,-12);default:throw new Error("Invalid rangeType: ".concat(e))}}(R,t):void 0,z=Ko(R,t),F=L?function(e,t){switch(e){case"decade":return no(t,100);case"year":return lo(t,10);case"month":return go(t,12);default:throw new Error("Invalid rangeType: ".concat(e))}}(R,t):void 0,B=function(){if(D.getFullYear()<0)return!0;var e=function(e,t){switch(e){case"century":return Ji(t);case"decade":return io(t);case"year":return uo(t);case"month":return yo(t);default:throw new Error("Invalid rangeType: ".concat(e))}}(R,t);return c&&c>=e}(),j=L&&function(){if(N.getFullYear()<0)return!0;var e=function(e,t){switch(e){case"decade":return io(t,-100);case"year":return uo(t,-10);case"month":return yo(t,-12);default:throw new Error("Invalid rangeType: ".concat(e))}}(R,t);return c&&c>=e}(),U=l&&l<z,V=L&&l&&l<F;function G(e){var t=function(){switch(R){case"century":return function(e,t,n){return Qo(e,t,Qi(n))}(a,s,e);case"decade":return es(a,s,e);case"year":return s(a,e);case"month":return i(a,e);default:throw new Error("Invalid view: ".concat(R,"."))}}();return f?f({date:e,label:t,locale:a||Di()||void 0,view:R}):t}return(0,jr.jsxs)("div",{className:rs,children:[null!==T&&L?(0,jr.jsx)("button",{"aria-label":S,className:"".concat(rs,"__arrow ").concat(rs,"__prev2-button"),disabled:j,onClick:function(){k(N,"prev2")},type:"button",children:T}):null,null!==I&&(0,jr.jsx)("button",{"aria-label":C,className:"".concat(rs,"__arrow ").concat(rs,"__prev-button"),disabled:B,onClick:function(){k(D,"prev")},type:"button",children:I}),function(){var e="".concat(rs,"__label");return(0,jr.jsxs)("button",{"aria-label":h,"aria-live":d,className:e,disabled:!O,onClick:n,style:{flexGrow:1},type:"button",children:[(0,jr.jsx)("span",{className:"".concat(e,"__labelText ").concat(e,"__labelText--from"),children:G(t)}),M?(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsx)("span",{className:"".concat(e,"__divider"),children:" \u2013 "}),(0,jr.jsx)("span",{className:"".concat(e,"__labelText ").concat(e,"__labelText--to"),children:G(z)})]}):null]})}(),null!==b&&(0,jr.jsx)("button",{"aria-label":v,className:"".concat(rs,"__arrow ").concat(rs,"__next-button"),disabled:U,onClick:function(){k(z,"next")},type:"button",children:b}),null!==_&&L?(0,jr.jsx)("button",{"aria-label":m,className:"".concat(rs,"__arrow ").concat(rs,"__next2-button"),disabled:V,onClick:function(){k(F,"next2")},type:"button",children:_}):null]})}var os=function(){return os=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},os.apply(this,arguments)},ss=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function as(e){return"".concat(e,"%")}function ls(e){var t=e.children,n=e.className,r=e.count,o=e.direction,s=e.offset,a=e.style,l=e.wrap,c=ss(e,["children","className","count","direction","offset","style","wrap"]);return(0,jr.jsx)("div",os({className:n,style:os({display:"flex",flexDirection:o,flexWrap:l?"wrap":"nowrap"},a)},c,{children:i.Children.map(t,function(e,t){var n=s&&0===t?as(100*s/r):null;return(0,i.cloneElement)(e,os(os({},e.props),{style:{flexBasis:as(100/r),flexShrink:0,flexGrow:0,overflow:"hidden",marginLeft:n,marginInlineStart:n,marginInlineEnd:0}}))})}))}function cs(e,t){return t[0]<=e&&t[1]>=e}function us(e,t){return cs(e[0],t)||cs(e[1],t)}function hs(e,t,n){var r=[];if(us(t,e)){r.push(n);var i=cs(e[0],t),o=cs(e[1],t);i&&r.push("".concat(n,"Start")),o&&r.push("".concat(n,"End")),i&&o&&r.push("".concat(n,"BothEnds"))}return r}function ds(e){if(!e)throw new Error("args is required");var t=e.value,n=e.date,r=e.hover,i="react-calendar__tile",o=[i];if(!n)return o;var s=new Date,a=function(){if(Array.isArray(n))return n;var t=e.dateType;if(!t)throw new Error("dateType is required when date is not an array of two dates");return Jo(t,n)}();if(cs(s,a)&&o.push("".concat(i,"--now")),!t||!function(e){return Array.isArray(e)?null!==e[0]&&null!==e[1]:null!==e}(t))return o;var l,c,u=function(){if(Array.isArray(t))return t;var n=e.valueType;if(!n)throw new Error("valueType is required when value is not an array of two dates");return Jo(n,t)}();c=a,(l=u)[0]<=c[0]&&l[1]>=c[1]?o.push("".concat(i,"--active")):us(u,a)&&o.push("".concat(i,"--hasActive"));var h=hs(u,a,"".concat(i,"--range"));o.push.apply(o,h);var d=Array.isArray(t)?t:[t];if(r&&1===d.length){var f=hs(r>u[0]?[u[0],r]:[r,u[0]],a,"".concat(i,"--hover"));o.push.apply(o,f)}return o}function fs(e){for(var t=e.className,n=e.count,r=void 0===n?3:n,i=e.dateTransform,o=e.dateType,s=e.end,a=e.hover,l=e.offset,c=e.renderTile,u=e.start,h=e.step,d=void 0===h?1:h,f=e.value,p=e.valueType,m=[],g=u;g<=s;g+=d){var _=i(g);m.push(c({classes:ds({date:_,dateType:o,hover:a,value:f,valueType:p}),date:_}))}return(0,jr.jsx)(ls,{className:t,count:r,offset:l,wrap:!0,children:m})}function ps(e){var t=e.activeStartDate,n=e.children,r=e.classes,o=e.date,s=e.formatAbbr,a=e.locale,l=e.maxDate,c=e.maxDateTransform,u=e.minDate,h=e.minDateTransform,d=e.onClick,f=e.onMouseOver,p=e.style,m=e.tileClassName,g=e.tileContent,_=e.tileDisabled,y=e.view,v=(0,i.useMemo)(function(){return"function"===typeof m?m({activeStartDate:t,date:o,view:y}):m},[t,o,m,y]),x=(0,i.useMemo)(function(){return"function"===typeof g?g({activeStartDate:t,date:o,view:y}):g},[t,o,g,y]);return(0,jr.jsxs)("button",{className:vi(r,v),disabled:u&&h(u)>o||l&&c(l)<o||(null===_||void 0===_?void 0:_({activeStartDate:t,date:o,view:y})),onClick:d?function(e){return d(o,e)}:void 0,onFocus:f?function(){return f(o)}:void 0,onMouseOver:f?function(){return f(o)}:void 0,style:p,type:"button",children:[s?(0,jr.jsx)("abbr",{"aria-label":s(a,o),children:n}):n,x]})}var ms=function(){return ms=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ms.apply(this,arguments)},gs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},_s="react-calendar__century-view__decades__decade";function ys(e){var t=e.classes,n=void 0===t?[]:t,r=e.currentCentury,i=e.formatYear,o=void 0===i?Go:i,s=gs(e,["classes","currentCentury","formatYear"]),a=s.date,l=s.locale,c=[];return n&&c.push.apply(c,n),_s&&c.push(_s),Xi(a).getFullYear()!==r&&c.push("".concat(_s,"--neighboringCentury")),(0,jr.jsx)(ps,ms({},s,{classes:c,maxDateTransform:ro,minDateTransform:eo,view:"century",children:es(l,o,a)}))}var vs=function(){return vs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},vs.apply(this,arguments)},xs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function bs(e){var t=e.activeStartDate,n=e.hover,r=e.showNeighboringCentury,i=e.value,o=e.valueType,s=xs(e,["activeStartDate","hover","showNeighboringCentury","value","valueType"]),a=function(e){return ji(Xi(e))}(t),l=a+(r?119:99);return(0,jr.jsx)(fs,{className:"react-calendar__century-view__decades",dateTransform:eo,dateType:"decade",end:l,hover:n,renderTile:function(e){var n=e.date,r=xs(e,["date"]);return(0,jr.jsx)(ys,vs({},s,r,{activeStartDate:t,currentCentury:a,date:n}),n.getTime())},start:a,step:10,value:i,valueType:o})}var ws=function(){return ws=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ws.apply(this,arguments)};function Ss(e){return(0,jr.jsx)("div",{className:"react-calendar__century-view",children:(0,jr.jsx)(bs,ws({},e))})}var Es=function(){return Es=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Es.apply(this,arguments)},Ts=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},As="react-calendar__decade-view__years__year";function Cs(e){var t=e.classes,n=void 0===t?[]:t,r=e.currentDecade,i=e.formatYear,o=void 0===i?Go:i,s=Ts(e,["classes","currentDecade","formatYear"]),a=s.date,l=s.locale,c=[];return n&&c.push.apply(c,n),As&&c.push(As),eo(a).getFullYear()!==r&&c.push("".concat(As,"--neighboringDecade")),(0,jr.jsx)(ps,Es({},s,{classes:c,maxDateTransform:co,minDateTransform:so,view:"decade",children:o(l,a)}))}var Ps=function(){return Ps=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ps.apply(this,arguments)},Is=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function ks(e){var t=e.activeStartDate,n=e.hover,r=e.showNeighboringDecade,i=e.value,o=e.valueType,s=Is(e,["activeStartDate","hover","showNeighboringDecade","value","valueType"]),a=function(e){return ji(eo(e))}(t),l=a+(r?11:9);return(0,jr.jsx)(fs,{className:"react-calendar__decade-view__years",dateTransform:so,dateType:"year",end:l,hover:n,renderTile:function(e){var n=e.date,r=Is(e,["date"]);return(0,jr.jsx)(Cs,Ps({},s,r,{activeStartDate:t,currentDecade:a,date:n}),n.getTime())},start:a,value:i,valueType:o})}var Ms=function(){return Ms=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ms.apply(this,arguments)};function Rs(e){return(0,jr.jsx)("div",{className:"react-calendar__decade-view",children:(0,jr.jsx)(ks,Ms({},e))})}var Os=function(){return Os=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Os.apply(this,arguments)},Ls=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ds=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function Ns(e){var t=e.classes,n=void 0===t?[]:t,r=e.formatMonth,i=void 0===r?Bo:r,o=e.formatMonthYear,s=void 0===o?jo:o,a=Ls(e,["classes","formatMonth","formatMonthYear"]),l=a.date,c=a.locale;return(0,jr.jsx)(ps,Os({},a,{classes:Ds(Ds([],n,!0),["react-calendar__year-view__months__month"],!1),formatAbbr:s,maxDateTransform:_o,minDateTransform:po,view:"year",children:i(c,l)}))}var zs=function(){return zs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},zs.apply(this,arguments)},Fs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Bs(e){var t=e.activeStartDate,n=e.hover,r=e.value,i=e.valueType,o=Fs(e,["activeStartDate","hover","value","valueType"]),s=ji(t);return(0,jr.jsx)(fs,{className:"react-calendar__year-view__months",dateTransform:function(e){var t=new Date;return t.setFullYear(s,e,1),po(t)},dateType:"month",end:11,hover:n,renderTile:function(e){var n=e.date,r=Fs(e,["date"]);return(0,jr.jsx)(Ns,zs({},o,r,{activeStartDate:t,date:n}),n.getTime())},start:0,value:r,valueType:i})}var js=function(){return js=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},js.apply(this,arguments)};function Us(e){return(0,jr.jsx)("div",{className:"react-calendar__year-view",children:(0,jr.jsx)(Bs,js({},e))})}var Vs=function(){return Vs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Vs.apply(this,arguments)},Gs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Hs="react-calendar__month-view__days__day";function $s(e){var t=e.calendarType,n=e.classes,r=void 0===n?[]:n,i=e.currentMonthIndex,o=e.formatDay,s=void 0===o?zo:o,a=e.formatLongDate,l=void 0===a?Fo:a,c=Gs(e,["calendarType","classes","currentMonthIndex","formatDay","formatLongDate"]),u=c.date,h=c.locale,d=[];return r&&d.push.apply(d,r),Hs&&d.push(Hs),ns(u,t)&&d.push("".concat(Hs,"--weekend")),u.getMonth()!==i&&d.push("".concat(Hs,"--neighboringMonth")),(0,jr.jsx)(ps,Vs({},c,{classes:d,formatAbbr:l,maxDateTransform:wo,minDateTransform:bo,view:"month",children:s(h,u)}))}var Ws=function(){return Ws=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ws.apply(this,arguments)},qs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Xs(e){var t=e.activeStartDate,n=e.calendarType,r=e.hover,i=e.showFixedNumberOfWeeks,o=e.showNeighboringMonth,s=e.value,a=e.valueType,l=qs(e,["activeStartDate","calendarType","hover","showFixedNumberOfWeeks","showNeighboringMonth","value","valueType"]),c=ji(t),u=Ui(t),h=i||o,d=qo(t,n),f=h?0:d,p=1+(h?-d:0),m=function(){if(i)return p+42-1;var e=Eo(t);if(o){var r=new Date;return r.setFullYear(c,u,e),r.setHours(0,0,0,0),e+(7-qo(r,n)-1)}return e}();return(0,jr.jsx)(fs,{className:"react-calendar__month-view__days",count:7,dateTransform:function(e){var t=new Date;return t.setFullYear(c,u,e),bo(t)},dateType:"day",hover:r,end:m,renderTile:function(e){var r=e.date,i=qs(e,["date"]);return(0,jr.jsx)($s,Ws({},l,i,{activeStartDate:t,calendarType:n,currentMonthIndex:u,date:r}),r.getTime())},offset:f,start:p,value:s,valueType:a})}var Zs="react-calendar__month-view__weekdays",Ks="".concat(Zs,"__weekday");function Ys(e){for(var t=e.calendarType,n=e.formatShortWeekday,r=void 0===n?Uo:n,i=e.formatWeekday,o=void 0===i?Vo:i,s=e.locale,a=e.onMouseLeave,l=po(new Date),c=ji(l),u=Ui(l),h=[],d=1;d<=7;d+=1){var f=new Date(c,u,d-qo(l,t)),p=o(s,f);h.push((0,jr.jsx)("div",{className:vi(Ks,ts(f)&&"".concat(Ks,"--current"),ns(f,t)&&"".concat(Ks,"--weekend")),children:(0,jr.jsx)("abbr",{"aria-label":p,title:p,children:r(s,f).replace(".","")})},d))}return(0,jr.jsx)(ls,{className:Zs,count:7,onFocus:a,onMouseOver:a,children:h})}var Js=function(){return Js=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Js.apply(this,arguments)},Qs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ea="react-calendar__tile";function ta(e){var t=e.onClickWeekNumber,n=e.weekNumber,r=(0,jr.jsx)("span",{children:n});if(t){var i=e.date,o=e.onClickWeekNumber,s=e.weekNumber,a=Qs(e,["date","onClickWeekNumber","weekNumber"]);return(0,jr.jsx)("button",Js({},a,{className:ea,onClick:function(e){return o(s,i,e)},type:"button",children:r}))}e.date,e.onClickWeekNumber,e.weekNumber,a=Qs(e,["date","onClickWeekNumber","weekNumber"]);return(0,jr.jsx)("div",Js({},a,{className:ea,children:r}))}function na(e){var t=e.activeStartDate,n=e.calendarType,r=e.onClickWeekNumber,i=e.onMouseLeave,o=e.showFixedNumberOfWeeks,s=function(){if(o)return 6;var e=Eo(t)-(7-qo(t,n));return 1+Math.ceil(e/7)}(),a=function(){for(var e=ji(t),r=Ui(t),i=Gi(t),o=[],a=0;a<s;a+=1)o.push(Xo(new Date(e,r,i+7*a),n));return o}(),l=a.map(function(e){return function(e,t){void 0===t&&(t=Ro);var n,r=t===Io?Io:Ro,i=Xo(e,t),o=ji(e)+1;do{n=Xo(new Date(o,0,r===Ro?4:1),t),o-=1}while(e<n);return Math.round((i.getTime()-n.getTime())/6048e5)+1}(e,n)});return(0,jr.jsx)(ls,{className:"react-calendar__month-view__weekNumbers",count:s,direction:"column",onFocus:i,onMouseOver:i,style:{flexBasis:"calc(100% * (1 / 8)",flexShrink:0},children:l.map(function(e,t){var n=a[t];if(!n)throw new Error("date is not defined");return(0,jr.jsx)(ta,{date:n,onClickWeekNumber:r,weekNumber:e},e)})})}var ra=function(){return ra=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ra.apply(this,arguments)},ia=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function oa(e){var t=e.activeStartDate,n=e.locale,r=e.onMouseLeave,i=e.showFixedNumberOfWeeks,o=e.calendarType,s=void 0===o?function(e){if(e)for(var t=0,n=Object.entries(Oo);t<n.length;t++){var r=n[t],i=r[0];if(r[1].includes(e))return i}return Ro}(n):o,a=e.formatShortWeekday,l=e.formatWeekday,c=e.onClickWeekNumber,u=e.showWeekNumbers,h=ia(e,["calendarType","formatShortWeekday","formatWeekday","onClickWeekNumber","showWeekNumbers"]);var d="react-calendar__month-view";return(0,jr.jsx)("div",{className:vi(d,u?"".concat(d,"--weekNumbers"):""),children:(0,jr.jsxs)("div",{style:{display:"flex",alignItems:"flex-end"},children:[u?(0,jr.jsx)(na,{activeStartDate:t,calendarType:s,onClickWeekNumber:c,onMouseLeave:r,showFixedNumberOfWeeks:i}):null,(0,jr.jsxs)("div",{style:{flexGrow:1,width:"100%"},children:[(0,jr.jsx)(Ys,{calendarType:s,formatShortWeekday:a,formatWeekday:l,locale:n,onMouseLeave:r}),(0,jr.jsx)(Xs,ra({calendarType:s},h))]})]})})}var sa=function(){return sa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},sa.apply(this,arguments)},aa="react-calendar",la=["century","decade","year","month"],ca=["decade","year","month","day"],ua=new Date;ua.setFullYear(1,0,1),ua.setHours(0,0,0,0);var ha=new Date(864e13);function da(e){return e instanceof Date?e:new Date(e)}function fa(e,t){return la.slice(la.indexOf(e),la.indexOf(t)+1)}function pa(e,t,n){return e&&function(e,t,n){return-1!==fa(t,n).indexOf(e)}(e,t,n)?e:n}function ma(e){var t=la.indexOf(e);return ca[t]}function ga(e,t){var n=e.value,r=e.minDate,i=e.maxDate,o=e.maxDetail,s=function(e,t){var n=Array.isArray(e)?e[t]:e;if(!n)return null;var r=da(n);if(Number.isNaN(r.getTime()))throw new Error("Invalid date: ".concat(e));return r}(n,t);if(!s)return null;var a=ma(o);return function(e,t,n){return t&&t>e?t:n&&n<e?n:e}(function(){switch(t){case 0:return Zo(a,s);case 1:return Yo(a,s);default:throw new Error("Invalid index value: ".concat(t))}}(),r,i)}var _a=function(e){return ga(e,0)},ya=function(e){return ga(e,1)},va=function(e){return[_a,ya].map(function(t){return t(e)})};function xa(e){var t=e.maxDate,n=e.maxDetail,r=e.minDate,i=e.minDetail,o=e.value;return Zo(pa(e.view,i,n),_a({value:o,minDate:r,maxDate:t,maxDetail:n})||new Date)}function ba(e){return e&&(!Array.isArray(e)||1===e.length)}function wa(e,t){return e instanceof Date&&t instanceof Date&&e.getTime()===t.getTime()}var Sa=(0,i.forwardRef)(function(e,t){var n=e.activeStartDate,r=e.allowPartialRange,o=e.calendarType,s=e.className,a=e.defaultActiveStartDate,l=e.defaultValue,c=e.defaultView,u=e.formatDay,h=e.formatLongDate,d=e.formatMonth,f=e.formatMonthYear,p=e.formatShortWeekday,m=e.formatWeekday,g=e.formatYear,_=e.goToRangeStartOnSelect,y=void 0===_||_,v=e.inputRef,x=e.locale,b=e.maxDate,w=void 0===b?ha:b,S=e.maxDetail,E=void 0===S?"month":S,T=e.minDate,A=void 0===T?ua:T,C=e.minDetail,P=void 0===C?"century":C,I=e.navigationAriaLabel,k=e.navigationAriaLive,M=e.navigationLabel,R=e.next2AriaLabel,O=e.next2Label,L=e.nextAriaLabel,D=e.nextLabel,N=e.onActiveStartDateChange,z=e.onChange,F=e.onClickDay,B=e.onClickDecade,j=e.onClickMonth,U=e.onClickWeekNumber,V=e.onClickYear,G=e.onDrillDown,H=e.onDrillUp,$=e.onViewChange,W=e.prev2AriaLabel,q=e.prev2Label,X=e.prevAriaLabel,Z=e.prevLabel,K=e.returnValue,Y=void 0===K?"start":K,J=e.selectRange,Q=e.showDoubleView,ee=e.showFixedNumberOfWeeks,te=e.showNavigation,ne=void 0===te||te,re=e.showNeighboringCentury,ie=e.showNeighboringDecade,oe=e.showNeighboringMonth,se=void 0===oe||oe,ae=e.showWeekNumbers,le=e.tileClassName,ce=e.tileContent,ue=e.tileDisabled,he=e.value,de=e.view,fe=(0,i.useState)(a),pe=fe[0],me=fe[1],ge=(0,i.useState)(null),_e=ge[0],ye=ge[1],ve=(0,i.useState)(Array.isArray(l)?l.map(function(e){return null!==e?da(e):null}):null!==l&&void 0!==l?da(l):null),xe=ve[0],be=ve[1],we=(0,i.useState)(c),Se=we[0],Ee=we[1],Te=n||pe||function(e){var t=e.activeStartDate,n=e.defaultActiveStartDate,r=e.defaultValue,i=e.defaultView,o=e.maxDate,s=e.maxDetail,a=e.minDate,l=e.minDetail,c=e.value,u=e.view,h=pa(u,l,s),d=t||n;return d?Zo(h,d):xa({maxDate:o,maxDetail:s,minDate:a,minDetail:l,value:c||r,view:u||i})}({activeStartDate:n,defaultActiveStartDate:a,defaultValue:l,defaultView:c,maxDate:w,maxDetail:E,minDate:A,minDetail:P,value:he,view:de}),Ae=function(){var e=J&&ba(xe)?xe:void 0!==he?he:xe;return e?Array.isArray(e)?e.map(function(e){return null!==e?da(e):null}):null!==e?da(e):null:null}(),Ce=ma(E),Pe=pa(de||Se,P,E),Ie=fa(P,E),ke=J?_e:null,Me=Ie.indexOf(Pe)<Ie.length-1,Re=Ie.indexOf(Pe)>0,Oe=(0,i.useCallback)(function(e){return function(){switch(Y){case"start":return _a;case"end":return ya;case"range":return va;default:throw new Error("Invalid returnValue.")}}()({maxDate:w,maxDetail:E,minDate:A,value:e})},[w,E,A,Y]),Le=(0,i.useCallback)(function(e,t){me(e);var n={action:t,activeStartDate:e,value:Ae,view:Pe};N&&!wa(Te,e)&&N(n)},[Te,N,Ae,Pe]),De=(0,i.useCallback)(function(e,t){var n=function(){switch(Pe){case"century":return B;case"decade":return V;case"year":return j;case"month":return F;default:throw new Error("Invalid view: ".concat(Pe,"."))}}();n&&n(e,t)},[F,B,j,V,Pe]),Ne=(0,i.useCallback)(function(e,t){if(Me){De(e,t);var n=Ie[Ie.indexOf(Pe)+1];if(!n)throw new Error("Attempted to drill down from the lowest view.");me(e),Ee(n);var r={action:"drillDown",activeStartDate:e,value:Ae,view:n};N&&!wa(Te,e)&&N(r),$&&Pe!==n&&$(r),G&&G(r)}},[Te,Me,N,De,G,$,Ae,Pe,Ie]),ze=(0,i.useCallback)(function(){if(Re){var e=Ie[Ie.indexOf(Pe)-1];if(!e)throw new Error("Attempted to drill up from the highest view.");var t=Zo(e,Te);me(t),Ee(e);var n={action:"drillUp",activeStartDate:t,value:Ae,view:e};N&&!wa(Te,t)&&N(n),$&&Pe!==e&&$(n),H&&H(n)}},[Te,Re,N,H,$,Ae,Pe,Ie]),Fe=(0,i.useCallback)(function(e,t){var n=Ae;De(e,t);var i,o=J&&!ba(n);if(J)if(o)i=Zo(Ce,e);else{if(!n)throw new Error("previousValue is required");if(Array.isArray(n))throw new Error("previousValue must not be an array");i=function(e,t,n){var r=[t,n].sort(function(e,t){return e.getTime()-t.getTime()});return[Zo(e,r[0]),Yo(e,r[1])]}(Ce,n,e)}else i=Oe(e);var s=!J||o||y?xa({maxDate:w,maxDetail:E,minDate:A,minDetail:P,value:i,view:Pe}):null;t.persist(),me(s),be(i);var a={action:"onChange",activeStartDate:s,value:i,view:Pe};if(N&&!wa(Te,s)&&N(a),z)if(J)if(ba(i)){if(r){if(Array.isArray(i))throw new Error("value must not be an array");z([i||null,null],t)}}else z(i||null,t);else z(i||null,t)},[Te,r,Oe,y,w,E,A,P,N,z,De,J,Ae,Ce,Pe]);function Be(e){ye(e)}function je(){ye(null)}function Ue(e){var t={activeStartDate:e?Ko(Pe,Te):Zo(Pe,Te),hover:ke,locale:x,maxDate:w,minDate:A,onClick:Me?Ne:Fe,onMouseOver:J?Be:void 0,tileClassName:le,tileContent:ce,tileDisabled:ue,value:Ae,valueType:Ce};switch(Pe){case"century":return(0,jr.jsx)(Ss,sa({formatYear:g,showNeighboringCentury:re},t));case"decade":return(0,jr.jsx)(Rs,sa({formatYear:g,showNeighboringDecade:ie},t));case"year":return(0,jr.jsx)(Us,sa({formatMonth:d,formatMonthYear:f},t));case"month":return(0,jr.jsx)(oa,sa({calendarType:o,formatDay:u,formatLongDate:h,formatShortWeekday:p,formatWeekday:m,onClickWeekNumber:U,onMouseLeave:J?je:void 0,showFixedNumberOfWeeks:"undefined"!==typeof ee?ee:Q,showNeighboringMonth:se,showWeekNumbers:ae},t));default:throw new Error("Invalid view: ".concat(Pe,"."))}}(0,i.useImperativeHandle)(t,function(){return{activeStartDate:Te,drillDown:Ne,drillUp:ze,onChange:Fe,setActiveStartDate:Le,value:Ae,view:Pe}},[Te,Ne,ze,Fe,Le,Ae,Pe]);var Ve=Array.isArray(Ae)?Ae:[Ae];return(0,jr.jsxs)("div",{className:vi(aa,J&&1===Ve.length&&"".concat(aa,"--selectRange"),Q&&"".concat(aa,"--doubleView"),s),ref:v,children:[ne?(0,jr.jsx)(is,{activeStartDate:Te,drillUp:ze,formatMonthYear:f,formatYear:g,locale:x,maxDate:w,minDate:A,navigationAriaLabel:I,navigationAriaLive:k,navigationLabel:M,next2AriaLabel:R,next2Label:O,nextAriaLabel:L,nextLabel:D,prev2AriaLabel:W,prev2Label:q,prevAriaLabel:X,prevLabel:Z,setActiveStartDate:Le,showDoubleView:Q,view:Pe,views:Ie}):null,(0,jr.jsxs)("div",{className:"".concat(aa,"__viewContainer"),onBlur:J?je:void 0,onMouseLeave:J?je:void 0,children:[Ue(),Q?Ue(!0):null]})]})});const Ea=Sa;function Ta(e){var t=e.angle,n=void 0===t?0:t,r=e.name,i=e.length,o=void 0===i?100:i,s=e.oppositeLength,a=void 0===s?10:s,l=e.width,c=void 0===l?1:l;return(0,jr.jsx)("div",{className:"react-clock__hand react-clock__".concat(r,"-hand"),style:{transform:"rotate(".concat(n,"deg)")},children:(0,jr.jsx)("div",{className:"react-clock__hand__body react-clock__".concat(r,"-hand__body"),style:{width:"".concat(c,"px"),top:"".concat(50-o/2,"%"),bottom:"".concat(50-a/2,"%")}})})}var Aa=(0,i.memo)(function(e){var t=e.angle,n=void 0===t?0:t,r=e.length,i=void 0===r?10:r,o=e.name,s=e.width,a=void 0===s?1:s;return(0,jr.jsx)("div",{className:"react-clock__mark react-clock__".concat(o,"-mark"),style:{transform:"rotate(".concat(n,"deg)")},children:(0,jr.jsx)("div",{className:"react-clock__mark__body react-clock__".concat(o,"-mark__body"),style:{width:"".concat(a,"px"),top:0,bottom:"".concat(100-i/2,"%")}})})});const Ca=Aa;var Pa=(0,i.memo)(function(e){var t=e.angle,n=void 0===t?0:t,r=e.length,i=void 0===r?10:r,o=e.name,s=e.number;return(0,jr.jsx)("div",{className:"react-clock__mark react-clock__".concat(o,"-mark"),style:{transform:"rotate(".concat(n,"deg)")},children:(0,jr.jsx)("div",{className:"react-clock__mark__number",style:{transform:"rotate(-".concat(n,"deg)"),top:"".concat(i/2,"%")},children:s})})});const Ia=Pa;function ka(e,t){return t.toLocaleString(e||Ni()||void 0)}function Ma(e){return null!==e&&!1!==e&&!Number.isNaN(Number(e))}function Ra(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Math.max.apply(Math,e.filter(Ma))}const Oa=function(e){var t=e.className,n=e.formatHour,r=void 0===n?ka:n,i=e.hourHandLength,o=void 0===i?50:i,s=e.hourHandOppositeLength,a=e.hourHandWidth,l=void 0===a?4:a,c=e.hourMarksLength,u=void 0===c?10:c,h=e.hourMarksWidth,d=void 0===h?3:h,f=e.locale,p=e.minuteHandLength,m=void 0===p?70:p,g=e.minuteHandOppositeLength,_=e.minuteHandWidth,y=void 0===_?2:_,v=e.minuteMarksLength,x=void 0===v?6:v,b=e.minuteMarksWidth,w=void 0===b?1:b,S=e.renderHourMarks,E=void 0===S||S,T=e.renderMinuteHand,A=void 0===T||T,C=e.renderMinuteMarks,P=void 0===C||C,I=e.renderNumbers,k=e.renderSecondHand,M=void 0===k||k,R=e.secondHandLength,O=void 0===R?90:R,L=e.secondHandOppositeLength,D=e.secondHandWidth,N=void 0===D?1:D,z=e.size,F=void 0===z?150:z,B=e.useMillisecondPrecision,j=e.value;function U(){if(!P)return null;for(var e=[],t=1;t<=60;t+=1){E&&!(t%5)||e.push((0,jr.jsx)(Ca,{angle:6*t,length:x,name:"minute",width:w},"minute_".concat(t)))}return e}function V(){if(!E)return null;for(var e=[],t=1;t<=12;t+=1)e.push((0,jr.jsx)(Ca,{angle:30*t,length:u,name:"hour",width:d},"hour_".concat(t)));return e}function G(){if(!I)return null;for(var e=[],t=1;t<=12;t+=1)e.push((0,jr.jsx)(Ia,{angle:30*t,length:Ra(E&&u,P&&x,0),name:"number",number:r(f,t)},"number_".concat(t)));return e}return(0,jr.jsxs)("time",{className:vi("react-clock",t),dateTime:j instanceof Date?j.toLocaleTimeString("en",{hourCycle:"h23",hour:"2-digit",minute:A?"2-digit":void 0,second:M?"2-digit":void 0}):j||void 0,style:{width:F,height:F},children:[(0,jr.jsxs)("div",{className:"react-clock__face",children:[U(),V(),G()]}),function(){var e=j?30*Hi(j)+$i(j)/2+Wi(j)/120+(B?qi(j)/12e4:0):0;return(0,jr.jsx)(Ta,{angle:e,length:o,name:"hour",oppositeLength:s,width:l})}(),function(){if(!A)return null;var e=j?360*Hi(j)+6*$i(j)+Wi(j)/10+(B?qi(j)/1e4:0):0;return(0,jr.jsx)(Ta,{angle:e,length:m,name:"minute",oppositeLength:g,width:y})}(),function(){if(!M)return null;var e=j?360*$i(j)+6*Wi(j)+(B?.006*qi(j):0):0;return(0,jr.jsx)(Ta,{angle:e,length:O,name:"second",oppositeLength:L,width:N})}()]})};var La,Da=["normal","small-caps"];function Na(e){if(!e)return"";var t=window.getComputedStyle(e);if(t.font)return t.font;if(!(""!==t.fontFamily))return"";var n=Da.includes(t.fontVariant)?t.fontVariant:"normal";return"".concat(t.fontStyle," ").concat(n," ").concat(t.fontWeight," ").concat(t.fontSize," / ").concat(t.lineHeight," ").concat(t.fontFamily)}const za=function(e){if("undefined"===typeof document||!e)return null;var t=Na(e),n=function(e,t){var n=(La||(La=document.createElement("canvas"))).getContext("2d");if(!n)return null;n.font=t;var r=n.measureText(e).width;return Math.ceil(r)}(e.value||e.placeholder,t);return null===n?null:(e.style.width="".concat(n,"px"),n)},Fa="undefined"!==typeof window,Ba=Fa?i.useLayoutEffect:i.useEffect,ja=Fa&&/(MSIE|Trident\/|Edge\/)/.test(navigator.userAgent),Ua=Fa&&/Firefox/.test(navigator.userAgent);function Va(e){const{target:t}=e;ja?requestAnimationFrame(()=>t.select()):t.select()}function Ga(e){if(null!==e)return function(t){if(Ua)return;const{key:n,target:r}=t,{value:i}=r,o=1===n.length&&/\d/.test(n),s=function(e){if(e&&"selectionStart"in e&&null!==e.selectionStart&&"selectionEnd"in e&&null!==e.selectionEnd)return e.value.slice(e.selectionStart,e.selectionEnd);if("getSelection"in window){const e=window.getSelection();return null===e||void 0===e?void 0:e.toString()}return null}(r);o&&(s||i.length<e)||t.preventDefault()}}function Ha(e){let{ariaLabel:t,autoFocus:n,className:r,disabled:i,inputRef:o,max:s,min:a,name:l,nameForClass:c,onChange:u,onKeyDown:h,onKeyUp:d,placeholder:f="--",required:p,showLeadingZeros:m,step:g,value:_}=e;Ba(()=>{var e;o&&o.current&&(za(o.current),e=o.current,"complete"!==document.readyState&&window.addEventListener("load",function(){za(e)}),function(e){if(!document.fonts)return;const t=Na(e);if(!t)return;document.fonts.check(t)||document.fonts.addEventListener("loadingdone",function(){za(e)})}(o.current))},[o,_]);const y=m&&_&&Number(_)<10&&("0"===_||!_.toString().startsWith("0")),v=s?s.toString().length:null;return(0,jr.jsxs)(jr.Fragment,{children:[y?(0,jr.jsx)("span",{className:`${r}__leadingZero`,children:"0"}):null,(0,jr.jsx)("input",{"aria-label":t,autoComplete:"off",autoFocus:n,className:vi(`${r}__input`,`${r}__${c||l}`,y&&`${r}__input--hasLeadingZero`),"data-input":"true",disabled:i,inputMode:"numeric",max:s,min:a,name:l,onChange:u,onFocus:Va,onKeyDown:h,onKeyPress:Ga(v),onKeyUp:e=>{za(e.target),d&&d(e)},placeholder:f,ref:o,required:p,step:g,type:"number",value:null!==_?_:""})]})}function $a(e){return null!==e&&!1!==e&&!Number.isNaN(Number(e))}function Wa(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Math.min(...t.filter($a))}function qa(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Math.max(...t.filter($a))}function Xa(e){let{maxDate:t,minDate:n,month:r,year:i,...o}=e;function s(e){return i===ji(e).toString()&&r===Vi(e).toString()}const a=Wa(r?Eo(new Date(Number(i),Number(r)-1,1)):31,t&&s(t)&&Gi(t)),l=qa(1,n&&s(n)&&Gi(n));return(0,jr.jsx)(Ha,{max:a,min:l,name:"day",...o})}function Za(e){let{maxDate:t,minDate:n,year:r,...i}=e;function o(e){return e&&r===ji(e).toString()}const s=Wa(12,t&&o(t)&&Vi(t)),a=qa(1,n&&o(n)&&Vi(n));return(0,jr.jsx)(Ha,{max:s,min:a,name:"month",...i})}const Ka=new Map;function Ya(e){return(t,n)=>function(e){return function(t,n){const r=t||Ni();Ka.has(r)||Ka.set(r,new Map);const i=Ka.get(r);return i.has(e)||i.set(e,new Intl.DateTimeFormat(r||void 0,e).format),i.get(e)(n)}}(e)(t,function(e){const t=new Date(e);return new Date(t.setHours(12))}(n))}const Ja=Ya({month:"long"}),Qa=Ya({month:"short"});function el(e){let{ariaLabel:t,autoFocus:n,className:r,disabled:i,inputRef:o,locale:s,maxDate:a,minDate:l,onChange:c,onKeyDown:u,placeholder:h="--",required:d,short:f,value:p,year:m}=e;function g(e){return e&&m===ji(e).toString()}const _=Wa(12,a&&g(a)&&Vi(a)),y=qa(1,l&&g(l)&&Vi(l)),v=[...Array(12)].map((e,t)=>new Date(2019,t,1)),x="month",b=f?Qa:Ja;return(0,jr.jsxs)("select",{"aria-label":t,autoFocus:n,className:vi(`${r}__input`,`${r}__${x}`),"data-input":"true","data-select":"true",disabled:i,name:x,onChange:c,onKeyDown:u,ref:o,required:d,value:null!==p?p:"",children:[!p&&(0,jr.jsx)("option",{value:"",children:h}),v.map(e=>{const t=Vi(e),n=t<y||t>_;return(0,jr.jsx)("option",{disabled:n,value:t,children:b(s,e)},t)})]})}function tl(e){let{maxDate:t,minDate:n,placeholder:r="----",valueType:i,...o}=e;const s=Wa(275760,t&&ji(t)),a=qa(1,n&&ji(n)),l="century"===i?10:1;return(0,jr.jsx)(Ha,{max:s,min:a,name:"year",placeholder:r,step:l,...o})}function nl(e){return[Number(e)%12||12,Number(e)<12?"am":"pm"]}const rl=new Map;new Map;const il=new RegExp(`[${["9","\u0669"].join("")}]`),ol=(sl={hour:"numeric"},function(e,t){const n=e||Ni();rl.has(n)||rl.set(n,new Map);const r=rl.get(n);return r.has(sl)||r.set(sl,new Intl.DateTimeFormat(n||void 0,sl).format),r.get(sl)(t)});var sl;function al(e){return null!==e&&!1!==e&&!Number.isNaN(Number(e))}function ll(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Math.min(...t.filter(al))}function cl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Math.max(...t.filter(al))}function ul(e){let{ariaLabel:t,autoFocus:n,className:r,disabled:i,inputRef:o,locale:s,maxTime:a,minTime:l,onChange:c,onKeyDown:u,required:h,value:d}=e;const f=!!l&&"pm"===nl(Hi(l))[1],p=!!a&&"am"===nl(Hi(a))[1],m="amPm",[g,_]=function(e){const t=ol(e,new Date(2017,0,1,9)),n=ol(e,new Date(2017,0,1,21)),[r,i]=t.split(il),[o,s]=n.split(il);if(void 0!==s){if(r!==o)return[r,o].map(e=>e.trim());if(i!==s)return[i,s].map(e=>e.trim())}return["AM","PM"]}(s);return(0,jr.jsxs)("select",{"aria-label":t,autoFocus:n,className:vi(`${r}__input`,`${r}__${m}`),"data-input":"true","data-select":"true",disabled:i,name:m,onChange:c,onKeyDown:u,ref:o,required:h,value:null!==d?d:"",children:[!d&&(0,jr.jsx)("option",{value:"",children:"--"}),(0,jr.jsx)("option",{disabled:f,value:"am",children:g}),(0,jr.jsx)("option",{disabled:p,value:"pm",children:_})]})}const hl="undefined"!==typeof window,dl=hl?i.useLayoutEffect:i.useEffect,fl=hl&&/(MSIE|Trident\/|Edge\/)/.test(navigator.userAgent),pl=hl&&/Firefox/.test(navigator.userAgent);function ml(e){const{target:t}=e;fl?requestAnimationFrame(()=>t.select()):t.select()}function gl(e){if(null!==e)return function(t){if(pl)return;const{key:n,target:r}=t,{value:i}=r,o=1===n.length&&/\d/.test(n),s=function(e){if(e&&"selectionStart"in e&&null!==e.selectionStart&&"selectionEnd"in e&&null!==e.selectionEnd)return e.value.slice(e.selectionStart,e.selectionEnd);if("getSelection"in window){const e=window.getSelection();return null===e||void 0===e?void 0:e.toString()}return null}(r);o&&(s||i.length<e)||t.preventDefault()}}function _l(e){let{ariaLabel:t,autoFocus:n,className:r,disabled:i,inputRef:o,max:s,min:a,name:l,nameForClass:c,onChange:u,onKeyDown:h,onKeyUp:d,placeholder:f="--",required:p,showLeadingZeros:m,step:g,value:_}=e;dl(()=>{var e;o&&o.current&&(za(o.current),e=o.current,"complete"!==document.readyState&&window.addEventListener("load",function(){za(e)}),function(e){if(!document.fonts)return;const t=Na(e);if(!t)return;document.fonts.check(t)||document.fonts.addEventListener("loadingdone",function(){za(e)})}(o.current))},[o,_]);const y=m&&_&&Number(_)<10&&("0"===_||!_.toString().startsWith("0")),v=s?s.toString().length:null;return(0,jr.jsxs)(jr.Fragment,{children:[y?(0,jr.jsx)("span",{className:`${r}__leadingZero`,children:"0"}):null,(0,jr.jsx)("input",{"aria-label":t,autoComplete:"off",autoFocus:n,className:vi(`${r}__input`,`${r}__${c||l}`,y&&`${r}__input--hasLeadingZero`),"data-input":"true",disabled:i,inputMode:"numeric",max:s,min:a,name:l,onChange:u,onFocus:ml,onKeyDown:h,onKeyPress:gl(v),onKeyUp:e=>{za(e.target),d&&d(e)},placeholder:f,ref:o,required:p,step:g,type:"number",value:null!==_?_:""})]})}function yl(e){let{amPm:t,maxTime:n,minTime:r,value:i,...o}=e;const s=ll(12,n&&(()=>{const[e,r]=nl(Hi(n));return r!==t?null:e})()),a=cl(1,r&&(()=>{const[e,n]=nl(Hi(r));return n!==t||12===e?null:e})()),l=i?nl(i)[0].toString():"";return(0,jr.jsx)(_l,{max:s,min:a,name:"hour12",nameForClass:"hour",value:l,...o})}function vl(e){let{maxTime:t,minTime:n,...r}=e;const i=ll(23,t&&Hi(t)),o=cl(0,n&&Hi(n));return(0,jr.jsx)(_l,{max:i,min:o,name:"hour24",nameForClass:"hour",...r})}function xl(e){let{hour:t,maxTime:n,minTime:r,showLeadingZeros:i=!0,...o}=e;function s(e){return t===Hi(e).toString()}const a=ll(59,n&&s(n)&&$i(n)),l=cl(0,r&&s(r)&&$i(r));return(0,jr.jsx)(_l,{max:a,min:l,name:"minute",showLeadingZeros:i,...o})}function bl(e){let{hour:t,maxTime:n,minTime:r,minute:i,showLeadingZeros:o=!0,...s}=e;function a(e){return t===Hi(e).toString()&&i===$i(e).toString()}const l=ll(59,n&&a(n)&&Wi(n)),c=cl(0,r&&a(r)&&Wi(r));return(0,jr.jsx)(_l,{max:l,min:c,name:"second",showLeadingZeros:o,...s})}function wl(e){let{ariaLabel:t,disabled:n,maxDate:r,minDate:i,name:o,onChange:s,required:a,value:l,valueType:c}=e;const u=(()=>{switch(c){case"hour":return e=>`${Co(e)}T${Hi(e)}:00`;case"minute":return e=>`${Co(e)}T${function(e){return`${To(Hi(e))}:${To($i(e))}`}(e)}`;case"second":return Po;default:throw new Error("Invalid valueType")}})(),h=(()=>{switch(c){case"hour":return 3600;case"minute":return 60;case"second":return 1;default:throw new Error("Invalid valueType")}})();return(0,jr.jsx)("input",{"aria-label":t,disabled:n,hidden:!0,max:r?u(r):void 0,min:i?u(i):void 0,name:o,onChange:s,onFocus:function(e){e.stopPropagation()},required:a,step:h,style:{visibility:"hidden",position:"absolute",zIndex:"-999"},type:"datetime-local",value:l?u(l):""})}function Sl(e){let{children:t}=e;return(0,jr.jsx)("span",{className:"react-datetime-picker__inputGroup__divider",children:t})}const El=new Map;function Tl(e){return function(t,n){const r=t||Ni();El.has(r)||El.set(r,new Map);const i=El.get(r);return i.has(e)||i.set(e,new Intl.DateTimeFormat(r||void 0,e).format),i.get(e)(n)}}const Al=new Map;const Cl=Tl({day:"numeric",month:"numeric",year:"numeric"});function Pl(e,t){let n=Number(e);return"am"===t&&12===n?n=0:"pm"===t&&n<12&&(n+=12),n}const Il=new RegExp(`[${["9","\u0669"].join("")}]`),kl=Tl({hour:"numeric"});const Ml={},Rl=new Date;Rl.setFullYear(1,0,1),Rl.setHours(0,0,0,0);const Ol=new Date(864e13),Ll=["hour","minute","second"];function Dl(e){return e instanceof Date?e:new Date(e)}function Nl(e,t,n,r){return t===ji(e).toString()&&n===Vi(e).toString()&&r===Gi(e).toString()}function zl(e,t){let{value:n,minDate:r,maxDate:i}=e;const o=function(e,t){const n=Array.isArray(e)?e[t]:e;if(!n)return null;const r=Dl(n);if(Number.isNaN(r.getTime()))throw new Error(`Invalid date: ${e}`);return r}(n,t);return o?function(e,t,n){return t&&t>e?t:n&&n<e?n:e}(o,r,i):null}function Fl(e){return"true"===e.dataset.input}function Bl(e,t){let n=e;do{n=n[t]}while(n&&!Fl(n));return n}function jl(e){e&&e.focus()}const Ul=function(e){return(t,n)=>{const r=t||Ni();Al.has(r)||Al.set(r,new Map);const i=Al.get(r);return i.has(e)||i.set(e,new Intl.NumberFormat(r||void 0,e).format),i.get(e)(n)}}({useGrouping:!1});function Vl(e){let{amPmAriaLabel:t,autoFocus:n,className:r,dayAriaLabel:o,dayPlaceholder:s,disabled:a,format:l,hourAriaLabel:c,hourPlaceholder:u,isWidgetOpen:h,locale:d,maxDate:f,maxDetail:p="minute",minDate:m,minuteAriaLabel:g,minutePlaceholder:_,monthAriaLabel:y,monthPlaceholder:v,name:x="datetime",nativeInputAriaLabel:b,onChange:w,onInvalidChange:S,required:E,secondAriaLabel:T,secondPlaceholder:A,showLeadingZeros:C,value:P,yearAriaLabel:I,yearPlaceholder:k}=e;const[M,R]=(0,i.useState)(null),[O,L]=(0,i.useState)(null),[D,N]=(0,i.useState)(null),[z,F]=(0,i.useState)(null),[B,j]=(0,i.useState)(null),[U,V]=(0,i.useState)(null),[G,H]=(0,i.useState)(null),[$,W]=(0,i.useState)(null),q=(0,i.useRef)(null),X=(0,i.useRef)(null),Z=(0,i.useRef)(null),K=(0,i.useRef)(null),Y=(0,i.useRef)(null),J=(0,i.useRef)(null),Q=(0,i.useRef)(null),ee=(0,i.useRef)(null),te=(0,i.useRef)(null),[ne,re]=(0,i.useState)(h),ie=(0,i.useRef)(void 0);(0,i.useEffect)(()=>{re(h)},[h]),(0,i.useEffect)(()=>{const e=zl({value:P,minDate:m,maxDate:f},0);var t;e?(R((t=Hi(e),[Number(t)%12||12,Number(t)<12?"am":"pm"])[1]),L(ji(e).toString()),N(Vi(e).toString()),F(Gi(e).toString()),j(Hi(e).toString()),V($i(e).toString()),H(Wi(e).toString()),W(Dl(e))):(R(null),L(null),N(null),F(null),j(null),V(null),H(null),W(null))},[P,m,f,ne]);const oe=p,se=(()=>{const e=Ll.indexOf(p),t=Ml[e]||(()=>{const t={hour:"numeric"};return e>=1&&(t.minute="numeric"),e>=2&&(t.second="numeric"),Ml[e]=t,t})();return Tl(t)})(),ae=(()=>{const e=new Date(2017,11,11),t=Cl(d,e),n=["y","M","d"];let r=t;return["year","month","day"].forEach((t,i)=>{const o=function(e,t){const n=Ml[e]||(()=>{const t={[e]:"numeric"};return Ml[e]=t,t})();return Tl(n)(d,t).match(/\d{1,}/)}(t,e);if(o){const e=o[0],t=n[i];r=r.replace(e,t)}}),r=r.replace("17","y"),r})(),le=(()=>{const e=new Date(2017,0,1,21,13,14);return se(d,e).replace(Ul(d,9),"h").replace(Ul(d,21),"H").replace(Ul(d,13),"mm").replace(Ul(d,14),"ss").replace(new RegExp(function(e){const t=kl(e,new Date(2017,0,1,9)),n=kl(e,new Date(2017,0,1,21)),[r,i]=t.split(Il),[o,s]=n.split(Il);if(void 0!==s){if(r!==o)return[r,o].map(e=>e.trim());if(i!==s)return[i,s].map(e=>e.trim())}return["AM","PM"]}(d).join("|")),"a")})(),ce=l||`${ae}\xa0${le}`,ue=(()=>{const e=ae.match(/[^0-9a-z]/i);return e?e[0]:null})(),he=(()=>{const e=le.match(/[^0-9a-z]/i);return e?e[0]:null})(),de=(()=>{if(f&&Nl(f,O,D,z))return Ao(f||Ol)})(),fe=(()=>{if(m&&Nl(m,O,D,z))return Ao(m||Rl)})();function pe(e){const{name:t,value:n}=e.target;switch(t){case"amPm":R(n);break;case"year":L(n);break;case"month":N(n);break;case"day":F(n);break;case"hour12":j(n?Pl(n,M||"am").toString():"");break;case"hour24":j(n);break;case"minute":V(n);break;case"second":H(n)}!function(){if(!w)return;const e=[q.current,Y.current,Z.current,K.current,X.current,J.current,Q.current,ee.current,te.current].filter(function(e){return Boolean(e)}),t=e.slice(1),n={};for(const o of e)n[o.name]="number"===o.type?o.valueAsNumber:o.value;if(t.every(e=>!e.value))return void w(null,!1);const r=e.every(e=>e.value),i=e.every(e=>e.validity.valid);if(r&&i){const e=Number(n.year||(new Date).getFullYear()),t=Number(n.month||1)-1,r=Number(n.day||1),i=Number(n.hour24||n.hour12&&n.amPm&&Pl(n.hour12,n.amPm)||0),o=Number(n.minute||0),s=Number(n.second||0),a=new Date;return a.setFullYear(e,t,r),a.setHours(i,o,s,0),void w(a,!1)}S&&S()}()}function me(e){const{value:t}=e.target;if(!w)return;const n=(()=>{if(!t)return null;const[e,n]=t.split("T"),[r,i,o]=e.split("-"),s=Number(r),a=Number(i)-1||0,l=Number(o)||1,[c,u,h]=n.split(":"),d=Number(c)||0,f=Number(u)||0,p=Number(h)||0,m=new Date;return m.setFullYear(s,a,l),m.setHours(d,f,p,0),m})();w(n,!1)}const ge={className:r,disabled:a,maxDate:f||Ol,minDate:m||Rl,onChange:pe,onKeyDown:function(e){switch(ie.current=e.key,e.key){case"ArrowLeft":case"ArrowRight":case ue:case he:{e.preventDefault();const{target:t}=e;jl(Bl(t,"ArrowLeft"===e.key?"previousElementSibling":"nextElementSibling"));break}}},onKeyUp:function(e){const{key:t,target:n}=e;if(!(ie.current===t))return;if(!!Number.isNaN(Number(t)))return;const r=n.getAttribute("max");if(!r)return;const{value:i}=n;if(10*Number(i)>Number(r)||i.length>=r.length){jl(Bl(n,"nextElementSibling"))}},required:Boolean(E||ne)},_e={maxTime:de,minTime:fe};function ye(e,t){if(e&&e.length>2)throw new Error(`Unsupported token: ${e}`);const r=e&&2===e.length;return(0,jr.jsx)(Xa,{...ge,ariaLabel:o,autoFocus:0===t&&n,inputRef:Y,month:D,placeholder:s,showLeadingZeros:r||C,value:z,year:O},"day")}function ve(e,t){if(e&&e.length>4)throw new Error(`Unsupported token: ${e}`);if(e.length>2)return(0,jr.jsx)(el,{...ge,ariaLabel:y,autoFocus:0===t&&n,inputRef:K,locale:d,placeholder:v,short:3===e.length,value:D,year:O},"month");const r=e&&2===e.length;return(0,jr.jsx)(Za,{...ge,ariaLabel:y,autoFocus:0===t&&n,inputRef:Z,placeholder:v,showLeadingZeros:r||C,value:D,year:O},"month")}function xe(e,t){return(0,jr.jsx)(tl,{...ge,ariaLabel:I,autoFocus:0===t&&n,inputRef:X,placeholder:k,value:O,valueType:"day"},"year")}function be(e,t){return/h/.test(e)?function(e,t){if(e&&e.length>2)throw new Error(`Unsupported token: ${e}`);const r=!!e&&2===e.length;return(0,jr.jsx)(yl,{...ge,..._e,amPm:M,ariaLabel:c,autoFocus:0===t&&n,inputRef:J,placeholder:u,showLeadingZeros:r,value:B},"hour12")}(e,t):function(e,t){if(e&&e.length>2)throw new Error(`Unsupported token: ${e}`);const r=!!e&&2===e.length;return(0,jr.jsx)(vl,{...ge,..._e,ariaLabel:c,autoFocus:0===t&&n,inputRef:Q,placeholder:u,showLeadingZeros:r,value:B},"hour24")}(e,t)}function we(e,t){if(e&&e.length>2)throw new Error(`Unsupported token: ${e}`);const r=!!e&&2===e.length;return(0,jr.jsx)(xl,{...ge,..._e,ariaLabel:g,autoFocus:0===t&&n,hour:B,inputRef:ee,placeholder:_,showLeadingZeros:r,value:U},"minute")}function Se(e,t){if(e&&e.length>2)throw new Error(`Unsupported token: ${e}`);const r=!e||2===e.length;return(0,jr.jsx)(bl,{...ge,..._e,ariaLabel:T,autoFocus:0===t&&n,hour:B,inputRef:te,minute:U,placeholder:A,showLeadingZeros:r,value:G},"second")}function Ee(e,r){return(0,jr.jsx)(ul,{...ge,..._e,ariaLabel:t,autoFocus:0===r&&n,inputRef:q,locale:d,onChange:pe,value:M},"ampm")}return(0,jr.jsxs)("div",{className:r,onClick:function(e){if(e.target===e.currentTarget){jl(e.target.children[1])}},children:[(0,jr.jsx)(wl,{ariaLabel:b,disabled:a,maxDate:f||Ol,minDate:m||Rl,name:x,onChange:me,required:E,value:$,valueType:oe},"datetime"),function(e,t,n){const r=[],i=new RegExp(Object.keys(t).map(e=>`${e}+`).join("|"),"g"),o=e.match(i);return e.split(i).reduce((e,i,s)=>{const a=i&&(0,jr.jsx)(Sl,{children:i},`separator_${s}`);e.push(a);const l=null===o||void 0===o?void 0:o[s];if(l){const i=t[l]||t[Object.keys(t).find(e=>l.match(e))];if(!i)return e;!n&&r.includes(i)?e.push(l):(e.push(i(l,s)),r.push(i))}return e},[])}(ce,{d:ye,M:ve,y:xe,h:be,H:be,m:we,s:Se,a:Ee},"undefined"!==typeof l)]})}function Gl(e){return e.getBoundingClientRect()}function Hl(e,t){return{get collidedTop(){return Gl(e).top<Gl(t).top},get collidedBottom(){return Gl(e).bottom>Gl(t).bottom},get collidedLeft(){return Gl(e).left<Gl(t).left},get collidedRight(){return Gl(e).right>Gl(t).right},get overflowTop(){return Gl(t).top-Gl(e).top},get overflowBottom(){return Gl(e).bottom-Gl(t).bottom},get overflowLeft(){return Gl(t).left-Gl(e).left},get overflowRight(){return Gl(e).right-Gl(t).right}}}var $l=n(6440),Wl=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const ql="undefined"!==typeof window&&"MutationObserver"in window;function Xl(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Zl(e){let{axis:t,container:n,element:r,invertAxis:i,scrollContainer:o,secondary:s,spacing:a}=e;const l=window.getComputedStyle(r),c=n.parentElement;if(!c)return;const u=Hl(c,o),h=Hl(c,document.documentElement),d="x"===t,f=d?"left":"top",p=d?"right":"bottom",m=d?"width":"height",g=`overflow${Xl(f)}`,_=`overflow${Xl(p)}`,y=`scroll${Xl(f)}`,v=Xl(m),x=`offset${v}`,b=`client${v}`,w=`min-${m}`,S=o[x]-o[b],E="object"===typeof a?a[f]:a;let T=-Math.max(u[g],h[g]+document.documentElement[y])-E;const A="object"===typeof a?a[p]:a;let C=-Math.max(u[_],h[_]-document.documentElement[y])-A-S;s&&(T+=c[b],C+=c[b]);const P=r[x];function I(){r.style[f]="auto",r.style[p]=s?"0":"100%"}function k(){r.style[f]=s?"0":"100%",r.style[p]="auto"}function M(e,t){const n=P<=e;return n&&t(),n}function R(){return M(T,I)}function O(){return M(C,k)}let L;L=i?R()||O():O()||R(),L||function(){const e=T>C,t=l.getPropertyValue(w),n=t?Number.parseInt(t,10):null;function i(e){$l(!n||e>=n,`<Fit />'s child will not fit anywhere with its current ${w} of ${n}px.`);const t=Math.max(e,n||0);$l(!1,`<Fit />'s child needed to have its ${m} decreased to ${t}px.`),r.style[m]=`${t}px`}e?(i(T),I()):(i(C),k())}()}function Kl(e){const{invertAxis:t,invertSecondaryAxis:n}=e,r=Wl(e,["invertAxis","invertSecondaryAxis"]);!function(e){Zl(e)}(Object.assign(Object.assign({},r),{invertAxis:t})),function(e){Zl(Object.assign(Object.assign({},e),{axis:"x"===e.axis?"y":"x",secondary:!0}))}(Object.assign(Object.assign({},r),{invertAxis:n}))}const Yl=function(e){let{children:t,invertAxis:n,invertSecondaryAxis:r,mainAxis:o="y",spacing:s=8}=e;const a=(0,i.useRef)(void 0),l=(0,i.useRef)(void 0),c=(0,i.useRef)(void 0),u=(0,i.useRef)(void 0),h=(0,i.useRef)(void 0),d=(0,i.useCallback)(()=>{if(!h.current||!a.current||!l.current)return;const e=l.current.clientWidth,t=l.current.clientHeight;if(c.current===e&&u.current===t)return;c.current=e,u.current=t;const i=a.current.parentElement;if(!i)return;const d=window.getComputedStyle(l.current),{position:f}=d;"absolute"!==f&&(l.current.style.position="absolute");const p=window.getComputedStyle(i),{position:m}=p;"relative"!==m&&"absolute"!==m&&(i.style.position="relative"),Kl({axis:o,container:a.current,element:l.current,invertAxis:n,invertSecondaryAxis:r,scrollContainer:h.current,spacing:s})},[n,r,o,s]),f=i.Children.only(t);function p(e){e&&e instanceof HTMLElement&&(l.current=e,h.current=function(e){let t=e.parentElement;for(;t;){const{overflow:e}=window.getComputedStyle(t);if(e.split(" ").every(e=>"auto"===e||"scroll"===e))return t;t=t.parentElement}return document.documentElement}(e))}return(0,i.useEffect)(()=>{if(d(),ql&&l.current){new MutationObserver(function(){d()}).observe(l.current,{attributes:!0,attributeFilter:["class","style"]})}},[d]),(0,jr.jsx)("span",{ref:e=>{if(!e)return;a.current=e;p(null===e||void 0===e?void 0:e.firstElementChild)},style:{display:"contents"},children:f})},Jl="react-datetimerange-picker",Ql=["mousedown","focusin","touchstart"],ec=["hour","minute","second"],tc={xmlns:"http://www.w3.org/2000/svg",width:19,height:19,viewBox:"0 0 19 19",stroke:"black",strokeWidth:2},nc=(0,jr.jsxs)("svg",{...tc,"aria-hidden":"true",className:`${Jl}__calendar-button__icon ${Jl}__button__icon`,children:[(0,jr.jsx)("rect",{fill:"none",height:"15",width:"15",x:"2",y:"2"}),(0,jr.jsx)("line",{x1:"6",x2:"6",y1:"0",y2:"4"}),(0,jr.jsx)("line",{x1:"13",x2:"13",y1:"0",y2:"4"})]}),rc=(0,jr.jsxs)("svg",{...tc,"aria-hidden":"true",className:`${Jl}__clear-button__icon ${Jl}__button__icon`,children:[(0,jr.jsx)("line",{x1:"4",x2:"15",y1:"4",y2:"15"}),(0,jr.jsx)("line",{x1:"15",x2:"4",y1:"4",y2:"15"})]});const ic=function(e){const{amPmAriaLabel:t,autoFocus:n,calendarAriaLabel:r,calendarIcon:o=nc,className:s,clearAriaLabel:a,clearIcon:l=rc,closeWidgets:c=!0,"data-testid":u,dayAriaLabel:h,dayPlaceholder:d,disableCalendar:f,disableClock:p,disabled:m,format:g,hourAriaLabel:_,hourPlaceholder:y,id:v,isCalendarOpen:x=null,isClockOpen:b=null,locale:w,maxDate:S,maxDetail:E="minute",minDate:T,minuteAriaLabel:A,minutePlaceholder:C,monthAriaLabel:P,monthPlaceholder:I,name:k="datetimerange",nativeInputAriaLabel:M,onCalendarClose:R,onCalendarOpen:O,onChange:L,onClockClose:D,onClockOpen:N,onFocus:z,onInvalidChange:F,openWidgetsOnFocus:B=!0,rangeDivider:j="\u2013",required:U,secondAriaLabel:V,secondPlaceholder:G,shouldCloseWidgets:H,shouldOpenWidgets:$,showLeadingZeros:W,value:q,yearAriaLabel:X,yearPlaceholder:Z,...K}=e,[Y,J]=(0,i.useState)(x),[Q,ee]=(0,i.useState)(b),te=(0,i.useRef)(null),ne=(0,i.useRef)(null),re=(0,i.useRef)(null);function ie(e){let{reason:t}=e;$&&!$({reason:t,widget:"calendar"})||(ee(!Q&&Y),J(!0),O&&O())}(0,i.useEffect)(()=>{J(x)},[x]),(0,i.useEffect)(()=>{ee(b)},[b]);const oe=(0,i.useCallback)(e=>{let{reason:t}=e;H&&!H({reason:t,widget:"calendar"})||(J(!1),R&&R())},[R,H]);function se(){Y?oe({reason:"buttonClick"}):ie({reason:"buttonClick"})}const ae=(0,i.useCallback)(e=>{let{reason:t}=e;H&&!H({reason:t,widget:"clock"})||(ee(!1),D&&D())},[D,H]),le=(0,i.useCallback)(e=>{let{reason:t}=e;oe({reason:t}),ae({reason:t})},[oe,ae]);function ce(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:c)&&le({reason:"select"}),L&&L(e)}function ue(e,t){const[,n]=Array.isArray(q)?q:[q];ce([e,n?new Date(n):null],t)}function he(e,t){const[n]=Array.isArray(q)?q:[q];ce([n?new Date(n):null,e],t)}function de(e,t){const[n,r]=Array.isArray(e)?e:[e],[i,o]=Array.isArray(q)?q:[q];ce([(()=>{if(!i||!n)return n;const e=new Date(i),t=new Date(n);return t.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),t})()||null,(()=>{if(!o||!r)return r;const e=new Date(o),t=new Date(r);return t.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),t})()||null],t)}const fe=(0,i.useCallback)(e=>{"Escape"===e.key&&le({reason:"escape"})},[le]);function pe(){ce(null)}function me(e){e.stopPropagation()}const ge=(0,i.useCallback)(e=>{const{current:t}=te,{current:n}=ne,{current:r}=re,i="composedPath"in e?e.composedPath()[0]:e.target;!i||!t||t.contains(i)||n&&n.contains(i)||r&&r.contains(i)||le({reason:"outsideAction"})},[le]),_e=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y||Q;for(const t of Ql)e?document.addEventListener(t,ge):document.removeEventListener(t,ge);e?document.addEventListener("keydown",fe):document.removeEventListener("keydown",fe)},[Y,Q,ge,fe]);(0,i.useEffect)(()=>(_e(),()=>{_e(!1)}),[_e]);const ye=(0,i.useMemo)(()=>function(e,t){const n={};for(const r of xi){const i=e[r];i&&(n[r]=t?e=>i(e,t(r)):i)}return n}(K),[K]);return(0,jr.jsxs)("div",{className:vi(Jl,`${Jl}--${Y||Q?"open":"closed"}`,`${Jl}--${m?"disabled":"enabled"}`,s),"data-testid":u,id:v,...ye,onFocus:function(e){if(z&&z(e),!m&&B&&"true"!==e.target.dataset.select)switch(e.target.name){case"day":case"month":case"year":if(Y)return;ie({reason:"focus"});break;case"hour12":case"hour24":case"minute":case"second":if(Q)return;!function(e){let{reason:t}=e;$&&!$({reason:t,widget:"clock"})||(J(!Y&&Y),ee(!0),N&&N())}({reason:"focus"})}},ref:te,children:[function(){const[e,s]=Array.isArray(q)?q:[q],c={...{amPmAriaLabel:t,dayAriaLabel:h,hourAriaLabel:_,minuteAriaLabel:A,monthAriaLabel:P,nativeInputAriaLabel:M,secondAriaLabel:V,yearAriaLabel:X},...{dayPlaceholder:d,hourPlaceholder:y,minutePlaceholder:C,monthPlaceholder:I,secondPlaceholder:G,yearPlaceholder:Z},className:`${Jl}__inputGroup`,disabled:m,format:g,isWidgetOpen:Y||Q,locale:w,maxDate:S,maxDetail:E,minDate:T,onInvalidChange:F,required:U,showLeadingZeros:W};return(0,jr.jsxs)("div",{className:`${Jl}__wrapper`,children:[(0,jr.jsx)(Vl,{...c,autoFocus:n,name:`${k}_from`,onChange:ue,value:e}),(0,jr.jsx)("span",{className:`${Jl}__range-divider`,children:j}),(0,jr.jsx)(Vl,{...c,name:`${k}_to`,onChange:he,value:s}),null!==l&&(0,jr.jsx)("button",{"aria-label":a,className:`${Jl}__clear-button ${Jl}__button`,disabled:m,onClick:pe,onFocus:me,type:"button",children:"function"===typeof l?(0,i.createElement)(l):l}),null!==o&&!f&&(0,jr.jsx)("button",{"aria-expanded":Y||!1,"aria-label":r,className:`${Jl}__calendar-button ${Jl}__button`,disabled:m,onClick:se,onFocus:me,type:"button",children:"function"===typeof o?(0,i.createElement)(o):o})]})}(),function(){if(null===Y||f)return null;const{calendarProps:t,portalContainer:n,value:r}=e,i=`${Jl}__calendar`,o=vi(i,`${i}--${Y?"open":"closed"}`),s=(0,jr.jsx)(Ea,{locale:w,maxDate:S,minDate:T,onChange:e=>de(e),selectRange:!0,value:r,...t});return n?(0,gi.createPortal)((0,jr.jsx)("div",{ref:ne,className:o,children:s}),n):(0,jr.jsx)(Yl,{children:(0,jr.jsx)("div",{ref:e=>{e&&!Y&&e.removeAttribute("style")},className:o,children:s})})}(),function(){if(null===Q||p)return null;const{clockProps:t,maxDetail:n="minute",portalContainer:r,value:i}=e,o=`${Jl}__clock`,s=vi(o,`${o}--${Q?"open":"closed"}`),[a]=Array.isArray(i)?i:[i],l=ec.indexOf(n),c=(0,jr.jsx)(Oa,{locale:w,renderMinuteHand:l>0,renderSecondHand:l>1,value:a,...t});return r?(0,gi.createPortal)((0,jr.jsx)("div",{ref:re,className:s,children:c}),r):(0,jr.jsx)(Yl,{children:(0,jr.jsx)("div",{ref:e=>{e&&!Q&&e.removeAttribute("style")},className:s,children:c})})}()]})},oc=Dr("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),sc=Dr("thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),ac=Dr("chart-no-axes-column",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),lc=Dr("droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),cc=Dr("gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),uc=Dr("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),hc=Dr("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),dc=Dr("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),fc=Dr("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),pc=Dr("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),mc=Dr("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),gc=Dr("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),_c=Dr("skip-back",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]),yc=Dr("pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),vc=Dr("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),xc=Dr("skip-forward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),bc=Dr("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),wc=[{key:"oceanCurrents",label:"Ocean Currents",icon:oc,color:"blue"},{key:"temperature",label:"Temperature",icon:sc,color:"red"},{key:"ssh",label:"Sea Surface Elevation",icon:ac,color:"indigo"},{key:"salinity",label:"Salinity",icon:lc,color:"emerald"},{key:"pressure",label:"Pressure",icon:cc,color:"orange"},{key:"windVelocity",label:"Wind Velocity",icon:uc,color:"red"}],Sc={blue:"text-blue-400",red:"text-red-400",indigo:"text-indigo-400",emerald:"text-emerald-400",orange:"text-orange-400"},Ec={blue:"bg-blue-600 text-white",red:"bg-red-600 text-white",indigo:"bg-indigo-600 text-white",emerald:"bg-emerald-600 text-white",orange:"bg-orange-600 text-white"},Tc=e=>{let{isLoading:t=!1,selectedArea:n="",selectedModel:r="NGOFS2",selectedDepth:o=0,startDate:s,endDate:a,timeZone:l="UTC",currentFrame:c=0,playbackSpeed:u=10,loopMode:h="Repeat",holoOceanPOV:d={x:0,y:0,depth:0},mapLayerVisibility:f={oceanCurrents:!1,temperature:!1,stations:!1},isSstHeatmapVisible:p=!1,currentsVectorScale:m=.009,currentsColorBy:g="speed",availableModels:_=[],availableDepths:y=[],totalFrames:v=24,data:x=[],dataLoaded:b=!1,onAreaChange:w,onModelChange:S,onDepthChange:E,onDateRangeChange:T,onTimeZoneChange:A,onSpeedChange:C,onLoopModeChange:P,onFrameChange:I,onReset:k,onLayerToggle:M,onSstHeatmapToggle:R,onCurrentsScaleChange:O,onCurrentsColorChange:L,heatmapScale:D=1,onHeatmapScaleChange:N,className:z="",showAdvanced:F=!1}=e;const{isPlaying:B,togglePlay:j}=ti(),[U,V]=(0,i.useState)(!1),[G,H]=(0,i.useState)({}),[$,W]=(0,i.useState)(!0),[q,X]=(0,i.useState)(!1),[Z,K]=(0,i.useState)([s,a]);(0,i.useEffect)(()=>{K([s,a])},[s,a]);const Y=(0,i.useMemo)(()=>{if(!b)return[{value:"",label:"Loading model...",disabled:!0}];if(0===_.length)return[{value:"",label:"No model found",disabled:!0}];const e={NGOFS2:"NGOFS2"};return _.map(t=>({value:t,label:e[t]||`${t} (Ocean Model)`,disabled:!1}))},[_,b]),J=(0,i.useMemo)(()=>y&&0!==y.length?y.map(e=>({value:e,label:0===e?"0 m (Surface)":`${e} m`,disabled:!1})):[{value:"",label:"Loading...",disabled:!0}],[y]);(0,i.useEffect)(()=>{const e={};o<0&&(e.depth="Depth cannot be negative"),b&&_.length>0&&r&&!_.includes(r)&&(e.model=`Model "${r}" not found`),H(e)},[o,r,_,b]);const Q=()=>wc.filter(e=>f[e.key]),ee=((0,i.useMemo)(()=>f.oceanCurrents||f.windVelocity,[f]),(0,i.useMemo)(()=>["temperature","salinity","pressure"].some(e=>f[e]),[f]));return(0,jr.jsxs)("div",{className:`bg-slate-800 border-b border-pink-500/20 p-2 md:p-4 bg-gradient-to-b from-pink-900/10 to-purple-900/10 ${z}`,children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-2 md:mb-4",children:[(0,jr.jsxs)("h2",{className:"font-semibold text-pink-300 flex items-center gap-2 text-sm md:text-base",children:[(0,jr.jsx)(zr,{className:"w-4 h-4 md:w-5 md:h-5"}),r||"Ocean Model"," Control Panel"]}),(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[t&&(0,jr.jsxs)("div",{className:"flex items-center gap-1 text-xs text-cyan-400",children:[(0,jr.jsx)(hc,{className:"w-3 h-3 animate-spin"}),"Loading..."]}),!b&&!t&&(0,jr.jsxs)("div",{className:"flex items-center gap-1 text-xs text-yellow-400",children:[(0,jr.jsx)("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),"Initializing"]})]})]}),(0,jr.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 md:gap-4 mb-4",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("label",{className:"block text-xs text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)($r,{className:"w-3 h-3"})," Study Area"]}),(0,jr.jsx)("select",{value:n,onChange:e=>{const t=e.target.value;null===w||void 0===w||w(t)},className:"w-full bg-slate-700 border border-slate-600 rounded px-1 md:px-2 py-1 text-xs md:text-sm",children:[{value:"",label:"Select Area"},{value:"USM",label:"USM"},{value:"MBL",label:"MBL"},{value:"MSR",label:"MSR"}].map(e=>(0,jr.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("label",{className:"block text-xs text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(dc,{className:"w-3 h-3"})," Ocean Model"]}),(0,jr.jsx)("select",{value:r,onChange:e=>{return t=e.target.value,void(S&&t&&_.includes(t)&&S(t));var t},className:"w-full bg-slate-700 border rounded px-1 md:px-2 py-1 text-xs md:text-sm "+(G.model?"border-red-500":"border-slate-600"),disabled:!b||0===_.length,children:Y.map(e=>(0,jr.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},e.value))})]}),(0,jr.jsxs)("div",{className:"col-span-2 lg:col-span-1 relative",children:[(0,jr.jsxs)("label",{className:"block text-xs text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(fc,{className:"w-3 h-3"})," Date/Time Range"]}),(0,jr.jsx)("button",{onClick:()=>V(!U),className:"w-full bg-slate-700 border border-slate-600 rounded px-2 py-1 text-xs md:text-sm text-left truncate",disabled:!b,children:s&&a?`${s.toLocaleDateString()} - ${a.toLocaleDateString()}`:"Select Range"}),U&&(0,jr.jsxs)("div",{className:"absolute top-full mt-2 z-50 bg-white p-2 rounded-md shadow-lg",children:[(0,jr.jsx)(ic,{onChange:e=>{K(e)},value:Z,disabled:!b,className:"text-slate-900"}),(0,jr.jsx)("div",{className:"mt-2 text-right",children:(0,jr.jsx)("button",{onClick:()=>{const[e,t]=Z||[null,null];null===T||void 0===T||T({startDate:e,endDate:t}),V(!1)},className:"bg-pink-600 text-white px-3 py-1 rounded text-xs font-semibold hover:bg-pink-700 disabled:opacity-50",disabled:!Z||!Z[0]||!Z[1],children:"Confirm"})})]})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("label",{className:"block text-xs text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(cc,{className:"w-3 h-3"}),"Depth (m)"]}),(0,jr.jsx)("select",{value:null!==o&&void 0!==o?o:"",onChange:e=>{const t=Number(e.target.value);null===E||void 0===E||E(t)},className:"w-full bg-slate-700 border rounded px-1 md:px-2 py-1 text-xs md:text-sm "+(G.depth?"border-red-500":"border-slate-600"),disabled:!b||!y.length,children:J.map(e=>(0,jr.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},e.value))})]})]}),(0,jr.jsxs)("div",{className:"mb-4 border-t border-slate-600 pt-3",children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,jr.jsxs)("h3",{className:"text-xs font-medium text-slate-300 flex items-center gap-1",children:[(0,jr.jsx)(Wr,{className:"w-3 h-3"}),"Map Controls"]}),(0,jr.jsx)("button",{onClick:()=>W(!$),className:"text-xs text-slate-400 hover:text-slate-300",children:$?"Hide":"Show"})]}),$&&(0,jr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,jr.jsxs)("h4",{className:"text-xs font-medium text-slate-300 flex items-center gap-1",children:[(0,jr.jsx)(pc,{className:"w-3 h-3"}),"Map Layers"]}),(0,jr.jsx)("button",{onClick:()=>X(!q),className:"text-xs text-slate-400 hover:text-slate-300",children:q?"Hide":"Show"})]}),q&&(0,jr.jsx)("div",{className:"space-y-2",children:wc.map(e=>(0,jr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jr.jsxs)("label",{className:"flex items-center gap-2 text-xs text-slate-300",children:[(0,jr.jsx)(e.icon,{className:"w-3 h-3"}),e.label]}),(0,jr.jsxs)("button",{onClick:()=>{return t=e.key,void(M?M(t):console.warn("ControlPanel - onLayerToggle function not provided!"));var t},className:`flex items-center gap-1 px-2 py-1 rounded text-xs transition-colors ${f[e.key]?Ec[e.color]:"bg-slate-600 text-slate-300 hover:bg-slate-500"}`,disabled:!b,children:[f[e.key]?(0,jr.jsx)(mc,{className:"w-3 h-3"}):(0,jr.jsx)(gc,{className:"w-3 h-3"}),f[e.key]?"On":"Off"]})]},e.key))})]}),(0,jr.jsx)("div",{className:"space-y-4",children:(0,jr.jsxs)("div",{children:[(0,jr.jsx)("label",{className:"block text-xs text-slate-400",children:"Heatmap Scale"}),(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jr.jsx)("input",{type:"range",min:"0.1",max:"2",step:"0.05",value:D,onChange:e=>{const t=Number(e.target.value);null===N||void 0===N||N(t)},className:"flex-1 accent-red-500 disabled:opacity-50",disabled:!b||!ee}),(0,jr.jsxs)("span",{className:"text-xs text-slate-400 w-16",children:[D.toFixed(2),"x"]})]})]})}),(0,jr.jsxs)("div",{className:"text-xs text-slate-400 space-y-1",children:[(0,jr.jsx)("div",{children:"Active Layers:"}),(0,jr.jsxs)("div",{className:"pl-2 space-y-0.5",children:[Q().map(e=>(0,jr.jsxs)("div",{className:Sc[e.color],children:["oceanCurrents"===e.key?"\ud83c\udf0a":"temperature"===e.key?"\ud83c\udf21\ufe0f":"ssh"===e.key?"\ud83c\udf0a":"salinity"===e.key?"\ud83e\uddc2":"pressure"===e.key?"\u2696\ufe0f":"windVelocity"===e.key?"\u26a1":""," ",e.label]},e.key)),0===Q().length&&(0,jr.jsx)("div",{className:"text-slate-500",children:"No layers active"})]})]})]})]}),(0,jr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-4 mb-4",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsx)("label",{className:"block text-xs text-slate-400 mb-1",children:"Animation"}),(0,jr.jsxs)("div",{className:"flex gap-1",children:[(0,jr.jsx)("button",{onClick:()=>{null===I||void 0===I||I(c>0?c-1:v-1)},className:"p-1 bg-slate-600 hover:bg-slate-700 rounded disabled:opacity-50",disabled:!b||v<=1,children:(0,jr.jsx)(_c,{className:"w-3 h-3"})}),(0,jr.jsxs)("button",{onClick:j,className:"flex-1 flex items-center justify-center gap-1 bg-pink-600 hover:bg-pink-700 px-2 rounded text-xs transition-colors disabled:opacity-50",disabled:!b||v<=1,children:[B?(0,jr.jsx)(yc,{className:"w-3 h-3"}):(0,jr.jsx)(vc,{className:"w-3 h-3"}),B?"Pause":"Play"]}),(0,jr.jsx)("button",{onClick:()=>{null===I||void 0===I||I((c+1)%v)},className:"p-1 bg-slate-600 hover:bg-slate-700 rounded disabled:opacity-50",disabled:!b||v<=1,children:(0,jr.jsx)(xc,{className:"w-3 h-3"})}),(0,jr.jsx)("button",{onClick:k,className:"p-1 bg-slate-600 hover:bg-slate-700 rounded disabled:opacity-50",disabled:!b,children:(0,jr.jsx)(bc,{className:"w-3 h-3"})})]})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("label",{className:"block text-xs text-slate-400 mb-1",children:["Speed: ",u,"x"]}),(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jr.jsx)("input",{type:"range",min:"0.1",max:"20",step:"0.1",value:u,onChange:e=>null===C||void 0===C?void 0:C(Number(e.target.value)),className:"flex-1 accent-pink-500 disabled:opacity-50",disabled:!b}),(0,jr.jsxs)("div",{className:"flex gap-1",children:[(0,jr.jsx)("button",{onClick:()=>null===C||void 0===C?void 0:C(1),className:"px-1 py-0.5 bg-slate-600 hover:bg-slate-500 rounded text-xs",disabled:!b,children:"1x"}),(0,jr.jsx)("button",{onClick:()=>null===C||void 0===C?void 0:C(5),className:"px-1 py-0.5 bg-slate-600 hover:bg-slate-500 rounded text-xs",disabled:!b,children:"5x"}),(0,jr.jsx)("button",{onClick:()=>null===C||void 0===C?void 0:C(10),className:"px-1 py-0.5 bg-slate-600 hover:bg-slate-500 rounded text-xs",children:"10x"}),(0,jr.jsx)("button",{onClick:()=>null===C||void 0===C?void 0:C(20),className:"px-1 py-0.5 bg-slate-600 hover:bg-slate-500 rounded text-xs",disabled:!b,children:"20x"})]})]})]})]}),(0,jr.jsxs)("div",{className:"flex flex-wrap items-center justify-between text-xs text-slate-400 gap-2",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-4",children:[(0,jr.jsxs)("span",{children:["Frame: ",c+1,"/",v]}),(0,jr.jsxs)("span",{children:["Loop: ",h]})]}),(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jr.jsx)(ii,{className:"w-3 h-3"}),(0,jr.jsx)("span",{children:(()=>{var e;return x.length>0&&null!==(e=x[c])&&void 0!==e&&e.time?new Date(x[c].time).toLocaleString():`Frame ${c+1} of ${v}`})()})]})]})]})};var Ac=n(879),Cc=n.n(Ac);let Pc=1,Ic=1;class kc{time=0;channels=(()=>new Map)();animations=(()=>new Map)();playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:i=1}=e,o=Pc++,s={time:0,delay:t,duration:n,rate:r,repeat:i};return this._setChannelTime(s,this.time),this.channels.set(o,s),o}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const r of t)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:e,channel:t}=r;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=Ic++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}const Mc={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"===typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Rc(e){let t=Oc(e);if("object"!==t)return{value:e,...Mc[t],type:t};if("object"===typeof e)return e?void 0!==e.type?{...e,...Mc[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=Oc(e.value),{...e,...Mc[t],type:t}):{type:"object",value:null};throw new Error("props")}function Oc(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const Lc={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Dc=/void\s+main\s*\([^)]*\)\s*\{\n?/,Nc=/}\n?[^{}]*$/,zc=[],Fc="__LUMA_INJECT_DECLARATIONS__";function Bc(e){const t={vertex:{},fragment:{}};for(const n in e){let r=e[n];"string"===typeof r&&(r={order:0,injection:r}),t[jc(n)][n]=r}return t}function jc(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Uc(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i="vertex"===t;for(const o in n){const t=n[o];t.sort((e,t)=>e.order-t.order),zc.length=t.length;for(let e=0,n=t.length;e<n;++e)zc[e]=t[e].injection;const r=`${zc.join("\n")}\n`;switch(o){case"vs:#decl":i&&(e=e.replace(Fc,r));break;case"vs:#main-start":i&&(e=e.replace(Dc,e=>e+r));break;case"vs:#main-end":i&&(e=e.replace(Nc,e=>r+e));break;case"fs:#decl":i||(e=e.replace(Fc,r));break;case"fs:#main-start":i||(e=e.replace(Dc,e=>e+r));break;case"fs:#main-end":i||(e=e.replace(Nc,e=>r+e));break;default:e=e.replace(o,e=>e+r)}}return e=e.replace(Fc,""),r&&(e=e.replace(/\}\s*$/,e=>e+Lc[t])),e}function Vc(e){e.map(e=>Gc(e))}function Gc(e){if(e.instance)return;Vc(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:r={}}=e,i={normalizedInjections:Bc(r),parsedDeprecations:$c(n)};t&&(i.propValidators=function(e){const t={};for(const[n,r]of Object.entries(e))t[n]=Rc(r);return t}(t)),e.instance=i;let o={};t&&(o=Object.entries(t).reduce((e,t)=>{let[n,r]=t;const i=r?.value;return i&&(e[n]=i),e},{})),e.defaultUniforms={...e.defaultUniforms,...o}}function Hc(e,t,n){e.deprecations?.forEach(e=>{e.regex?.test(t)&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())})}function $c(e){return e.forEach(e=>{if("function"===e.type)e.regex=new RegExp(`\\b${e.old}\\(`);else e.regex=new RegExp(`${e.type} ${e.old};`)}),e}function Wc(e){Vc(e);const t={},n={};qc({modules:e,level:0,moduleMap:t,moduleDepth:n});const r=Object.keys(n).sort((e,t)=>n[t]-n[e]).map(e=>t[e]);return Vc(r),r}function qc(e){const{modules:t,level:n,moduleMap:r,moduleDepth:i}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const o of t)r[o.name]=o,(void 0===i[o.name]||i[o.name]<n)&&(i[o.name]=n);for(const o of t)o.dependencies&&qc({modules:o.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}const Xc=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Zc=[...Xc,[Jc("attribute"),"in $1"],[Jc("varying"),"out $1"]],Kc=[...Xc,[Jc("varying"),"in $1"]];function Yc(e,t){for(const[n,r]of t)e=e.replace(n,r);return e}function Jc(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Qc(e,t){let n="";for(const r in e){const i=e[r];if(n+=`void ${i.signature} {\n`,i.header&&(n+=`  ${i.header}`),t[r]){const e=t[r];e.sort((e,t)=>e.order-t.order);for(const t of e)n+=`  ${t.injection}\n`}i.footer&&(n+=`  ${i.footer}`),n+="}\n"}return n}function eu(e){const t={vertex:{},fragment:{}};for(const n of e){let e,r;"string"!==typeof n?(e=n,r=e.hook):(e={},r=n),r=r.trim();const[i,o]=r.split(":"),s=r.replace(/\(.+/,""),a=Object.assign(e,{signature:o});switch(i){case"vs":t.vertex[s]=a;break;case"fs":t.fragment[s]=a;break;default:throw new Error(i)}}return t}function tu(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}function nu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function ru(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const iu=`\n\n${Fc}\n`;function ou(e,t){const{source:n,stage:r,modules:i,hookFunctions:o=[],inject:s={},log:a}=t;tu("string"===typeof n,"shader source must be a string");const l=n;let c="";const u=eu(o),h={},d={},f={};for(const m in s){const e="string"===typeof s[m]?{injection:s[m],order:0}:s[m],t=/^(v|f)s:(#)?([\w-]+)$/.exec(m);if(t){const n=t[2],r=t[3];n?"decl"===r?d[m]=[e]:f[m]=[e]:h[m]=[e]}else f[m]=[e]}const p=i;for(const m of p){a&&Hc(m,l,a);c+=lu(m,"wgsl");const e=m.injections?.[r]||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const r="decl"===n[2]?d:f;r[t]=r[t]||[],r[t].push(e[t])}else h[t]=h[t]||[],h[t].push(e[t])}}return c+=iu,c=Uc(c,r,d),c+=Qc(u[r],h),c+=l,c=Uc(c,r,f),c}function su(e,t){const{id:n,source:r,stage:i,language:o="glsl",modules:s,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;tu("string"===typeof r,"shader source must be a string");const d="glsl"===o?function(e,t){return{name:nu(e,t),language:"glsl",version:ru(e)}}(r).version:-1,f=e.shaderLanguageVersion,p=100===d?"#version 100":"#version 300 es",m=r.split("\n").slice(1).join("\n"),g={};s.forEach(e=>{Object.assign(g,e.defines)}),Object.assign(g,a);let _="";switch(o){case"wgsl":break;case"glsl":_=u?`${p}\n\n// ----- PROLOGUE -------------------------\n${function(e){const{id:t,source:n,stage:r}=e,i=t&&-1===n.indexOf("SHADER_NAME");return i?`\n#define SHADER_NAME ${t}_${r}`:""}({id:n,source:r,stage:i})}\n#define SHADER_TYPE_${i.toUpperCase()}\n\n${function(e){switch(e?.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===i?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="";for(const n in e){const r=e[n];(r||Number.isFinite(r))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(g)}\n\n`:`${p}\n`}const y=eu(l),v={},x={},b={};for(const w in c){const e="string"===typeof c[w]?{injection:c[w],order:0}:c[w],t=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(t){const n=t[2],r=t[3];n?"decl"===r?x[w]=[e]:b[w]=[e]:v[w]=[e]}else b[w]=[e]}for(const w of s){h&&Hc(w,m,h);_+=lu(w,i);const e=w.instance?.normalizedInjections[i]||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const r="decl"===n[2]?x:b;r[t]=r[t]||[],r[t].push(e[t])}else v[t]=v[t]||[],v[t].push(e[t])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=iu,_=Uc(_,i,x),_+=Qc(y[i],v),_+=m,_=Uc(_,i,b),"glsl"===o&&d!==f&&(_=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return Yc(e,Zc);case"fragment":return Yc(e,Kc);default:throw new Error(t)}}(_,i)),_.trim()}function au(e){return function(t){const n={};for(const r of e){const e=r.getUniforms?.(t,n);Object.assign(n,e)}return n}}function lu(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:tu(!1)}if(!e.name)throw new Error("Shader module must have a name");const r=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${e.name} ---------------\n\n`;return"wgsl"!==t&&(i+=`#define MODULE_${r}\n`),i+=`${n}\n`,i}const cu=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,uu=/^\s*\#\s*endif\s*$/;class hu{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return hu.defaultShaderAssembler=hu.defaultShaderAssembler||new hu,hu.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"===typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"===typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:r,getUniforms:i}=function(e){const t=Wc(e.modules||[]);return{source:ou(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:au(t)}}({...e,source:e.source,modules:t,hookFunctions:n}),o="wgsl"===e.platformInfo.shaderLanguage?function(e,t){const n=e.split("\n"),r=[];let i=!0,o=null;for(const s of n){const e=s.match(cu),n=s.match(uu);e?(o=e[1],i=Boolean(t?.defines?.[o])):n?i=!0:i&&r.push(s)}return r.join("\n")}(r):r;return{source:o,getUniforms:i,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,r=function(e){const{vs:t,fs:n}=e,r=Wc(e.modules||[]);return{vs:su(e.platformInfo,{...e,source:t,stage:"vertex",modules:r}),fs:su(e.platformInfo,{...e,source:n,stage:"fragment",modules:r}),getUniforms:au(r)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n});return{...r,modules:t}}_getModuleList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),n={};let r=0;for(let i=0,o=this._defaultModules.length;i<o;++i){const e=this._defaultModules[i],o=e.name;t[r++]=e,n[o]=!0}for(let i=0,o=e.length;i<o;++i){const o=e[i],s=o.name;n[s]||(t[r++]=o,n[s]=!0)}return t.length=r,Vc(t),t}}const du="#define SMOOTH_EDGE_RADIUS 0.5",fu={name:"geometry",source:"const SMOOTH_EDGE_RADIUS: f32 = 0.5;\n\nstruct VertexGeometry {\n  position: vec4<f32>,\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\nvar<private> geometry_: VertexGeometry = VertexGeometry(\n  vec4<f32>(0.0, 0.0, 1.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec2<f32>(0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0)\n);\n\nstruct FragmentGeometry {\n  uv: vec2<f32>,\n};\n\nvar<private> fragmentGeometry: FragmentGeometry;\n\nfn smoothedge(edge: f32, x: f32) -> f32 {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n",vs:`${du}\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n`,fs:`${du}\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`},pu=[fu],mu=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],gu=[];function _u(e){const t=hu.getDefaultShaderAssembler();for(const r of pu)t.addDefaultModule(r);const n="glsl"===e?mu:gu;for(const r of n)t.addShaderHook(r);return t}const yu="uniform layerUniforms {\n  uniform float opacity;\n} layer;\n",vu={name:"layer",vs:yu,fs:yu,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},xu="Awaiting state",bu="Matched. State transferred from previous layer",wu="Initialized",Su="Discarded. Awaiting garbage collection",Eu="No longer matched. Awaiting garbage collection",Tu="Finalized! Awaiting garbage collection",Au=Symbol.for("component"),Cu=Symbol.for("propTypes"),Pu=Symbol.for("deprecatedProps"),Iu=Symbol.for("asyncPropDefaults"),ku=Symbol.for("asyncPropOriginal"),Mu=Symbol.for("asyncPropResolved");function Ru(e){if("undefined"!==typeof window&&"renderer"===window.process?.type)return!0;if("undefined"!==typeof process&&Boolean(process.versions?.electron))return!0;const t="undefined"!==typeof navigator&&navigator.userAgent,n=e||t;return Boolean(n&&n.indexOf("Electron")>=0)}function Ou(){return!("object"===typeof process&&"[object process]"===String(process)&&!process?.browser)||Ru()}const Lu="4.1.0";class Du{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(_t){return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var Nu;!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Nu||(Nu={}));function zu(e){return"string"!==typeof e?e:(e=e.toUpperCase(),Nu[e]||Nu.WHITE)}function Fu(e,t){if(!e)throw new Error(t||"Assertion failed")}const Bu=globalThis,ju=(globalThis.document,globalThis.process||{}),Uu=(globalThis.console,globalThis.navigator||{});function Vu(){let e;if(Ou()&&Bu.performance)e=Bu?.performance?.now?.();else if("hrtime"in ju){const t=ju?.hrtime?.();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const Gu={debug:Ou()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Hu={enabled:!0,level:0};function $u(){}const Wu={},qu={once:!0};class Xu{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};this.VERSION=Lu,this._startTs=Vu(),this._deltaTs=Vu(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Du(`__probe-${this.id}__`,Hu),this.timeStamp(`${this.id} started`),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(n),i=e;for(const o of r){const n=i[o];"function"===typeof n&&(t.find(e=>o===e)||(i[o]=n.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Vu()-this._startTs).toPrecision(10))}getDelta(){return Number((Vu()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Gu.warn,arguments,qu)}error(e){return this._getLogFunction(0,e,Gu.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Gu.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Gu.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Gu.debug||Gu.info,arguments,qu)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||$u,n&&[n],{tag:Yu(t)}):$u}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||$u)}group(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const r=Ku({logLevel:e,message:t,opts:n}),{collapsed:i}=n;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||$u)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Zu(e)}_getLogFunction(e,t,n,r,i){if(this._shouldLog(e)){i=Ku({logLevel:e,message:t,args:r,opts:i}),Fu(n=n||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Vu();const o=i.tag||i.message;if(i.once&&o){if(Wu[o])return $u;Wu[o]=Vu()}return t=function(e,t,n){if("string"===typeof t){const r=n.time?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(n.total)):"";t=function(e,t,n){Ou||"string"!==typeof e||(t&&(e=`\x1b[${zu(t)}m${e}\x1b[39m`),n&&(e=`\x1b[${zu(n)+10}m${e}\x1b[49m`));return e}(t=n.time?`${e}: ${r}  ${t}`:`${e}: ${t}`,n.color,n.background)}return t}(this.id,i.message,i),n.bind(console,t,...i.args)}return $u}}function Zu(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Fu(Number.isFinite(t)&&t>=0),t}function Ku(e){const{logLevel:t,message:n}=e;e.logLevel=Zu(t);const r=e.args?Array.from(e.args):[];for(;r.length&&r.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&r.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"===typeof e.message&&(e.message=e.message());const i=typeof e.message;return Fu("string"===i||"object"===i),Object.assign(e,{args:r},e.opts)}function Yu(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}Xu.VERSION=Lu;const Ju=new Xu({id:"deck"});let Qu={};function eh(e){Qu=e}function th(e,t,n,r){Ju.level>0&&Qu[e]&&Qu[e].call(null,t,n,r)}function nh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;return Array.isArray(e)?rh(e,t,[]):t(e)?[e]:[]}function rh(e,t,n){let r=-1;for(;++r<e.length;){const i=e[r];Array.isArray(i)?rh(i,t,n):t(i)&&n.push(i)}return n}function ih(e){let{target:t,source:n,start:r=0,count:i=1}=e;const o=n.length,s=i*o;let a=0;for(let l=r;a<o;a++)t[l++]=n[a];for(;a<s;)a<s-a?(t.copyWithin(r+a,r,r+a),a*=2):(t.copyWithin(r+a,r,r+s-a),a=s);return t}function oh(){let e;if("undefined"!==typeof window&&window.performance)e=window.performance.now();else if("undefined"!==typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class sh{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=oh(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(oh()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ah{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(e){const{name:t,type:n}=e;let r=this.stats[t];return r||(r=e instanceof sh?e:new sh(t,n),this.stats[t]=r),r}}const lh=e=>"boolean"===typeof e,ch=e=>"function"===typeof e,uh=e=>null!==e&&"object"===typeof e,hh=e=>uh(e)&&e.constructor==={}.constructor,dh=e=>"undefined"!==typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,fh=e=>"undefined"!==typeof Blob&&e instanceof Blob,ph=e=>(e=>"undefined"!==typeof ReadableStream&&e instanceof ReadableStream||uh(e)&&ch(e.tee)&&ch(e.cancel)&&ch(e.getReader))(e)||(e=>uh(e)&&ch(e.read)&&ch(e.pipe)&&lh(e.readable))(e);function mh(e,t){if(!e)throw new Error(t||"loader assertion failed.")}function gh(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(e?.extensions)}function _h(e){let t;return mh(e,"null loader"),mh(gh(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}let yh="";const vh={};class xh extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const bh=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,wh=/^([-\w.]+\/[-\w.+]+)/;function Sh(e,t){return e.toLowerCase()===t.toLowerCase()}function Eh(e){const t=bh.exec(e);return t?t[1]:""}const Th=/\?.*/;function Ah(e){return e.replace(Th,"")}function Ch(e){if(dh(e)){return e.url}if(fh(e)){return e.name||""}return"string"===typeof e?e:""}function Ph(e){if(dh(e)){const t=e,n=t.headers.get("content-type")||"",r=Ah(t.url);return function(e){const t=wh.exec(e);return t?t[1]:e}(n)||Eh(r)}if(fh(e)){return e.type||""}return"string"===typeof e?Eh(e):""}async function Ih(e){if(dh(e))return e;const t={},n=function(e){if(dh(e))return e.headers["content-length"]||-1;if(fh(e))return e.size;return"string"===typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const r=Ch(e),i=Ph(e);i&&(t["content-type"]=i);const o=await async function(e){const t=5;if("string"===typeof e)return`data:,${e.slice(0,t)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const n=new FileReader;n.onload=t=>e(t?.target?.result),n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const n=function(e){let t="";const n=new Uint8Array(e);for(let r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return btoa(t)}(e.slice(0,t));return`data:base64,${n}`}return null}(e);o&&(t["x-first-bytes"]=o),"string"===typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:r}),s}async function kh(e){if(!e.ok){const t=await async function(e){const n=function(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}(e.url);let r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${n}`;r=r.length>100?`${r.slice(0,100)}...`:r;const i={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");i.reason=!e.bodyUsed&&t?.includes("application/json")?await e.json():await e.text()}catch(t){}return new xh(r,i)}(e);throw t}}async function Mh(e,t){if("string"===typeof e){const n=function(e){for(const t in vh)if(e.startsWith(t)){const n=vh[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${yh}${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,t):await fetch(n,t)}return await Ih(e)}const Rh=new Xu({id:"loaders.gl"});class Oh{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}"undefined"!==typeof self&&self,"undefined"!==typeof window&&window,"undefined"!==typeof global&&global,"undefined"!==typeof document&&document;const Lh=Boolean("object"!==typeof process||"[object process]"!==String(process)||process.browser),Dh="undefined"!==typeof process&&process.version&&/v([0-9]*)/.exec(process.version),Nh=(Dh&&parseFloat(Dh[1]),{fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.error.bind(this.console,...t)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Lh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]}),zh={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Fh(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Bh(){const e=Fh();return e.globalOptions=e.globalOptions||{...Nh},e.globalOptions}function jh(e,t,n,r){return n=n||[],function(e,t){Uh(e,null,Nh,zh,t);for(const n of t){const r=e&&e[n.id]||{},i=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Uh(r,n.id,i,o,t)}}(e,n=Array.isArray(n)?n:[n]),Gh(t,e,r)}function Uh(e,t,n,r,i){const o=t||"Top level",s=t?`${t}.`:"";for(const a in e){const l=!t&&uh(e[a]);if(!(a in n)&&!("baseUri"===a&&!t)&&!("workerUrl"===a&&t))if(a in r)Rh.warn(`${o} loader option '${s}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const e=Vh(a,i);Rh.warn(`${o} loader option '${s}${a}' not recognized. ${e}`)()}}}function Vh(e,t){const n=e.toLowerCase();let r="";for(const i of t)for(const t in i.options){if(e===t)return`Did you mean '${i.id}.${t}'?`;const o=t.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${t}'?`)}return r}function Gh(e,t,n){const r={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(r,n),null===r.log&&(r.log=new Oh),Hh(r,Bh()),Hh(r,t),r}function Hh(e,t){for(const n in t)if(n in t){const r=t[n];hh(r)&&hh(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function $h(e,t){const n=Bh(),r=e||n;return"function"===typeof r.fetch?r.fetch:uh(r.fetch)?e=>Mh(e,r.fetch):t?.fetch?t?.fetch:Mh}function Wh(e,t){return qh(e||{},t)}function qh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n>3)return t;const r={...e};for(const[i,o]of Object.entries(t))o&&"object"===typeof o&&!Array.isArray(o)?r[i]=qh(r[i]||{},t[i],n+1):r[i]=t[i];return r}"undefined"!==typeof self&&self,"undefined"!==typeof window&&window,"undefined"!==typeof global&&global,"undefined"!==typeof document&&document;const Xh="object"!==typeof process||"[object process]"!==String(process)||process.browser,Zh="undefined"!==typeof window&&"undefined"!==typeof window.orientation,Kh="undefined"!==typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Kh&&parseFloat(Kh[1]);class Yh{terminate(){}}function Jh(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Qh=new Map;function ed(e){Jh(e.source&&!e.url||!e.source&&e.url);let t=Qh.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return td((t=e,`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`));var t}(e.url),Qh.set(e.url,t)),e.source&&(t=td(e.source),Qh.set(e.source,t))),Jh(t),t}function td(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function nd(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(e){if(rd(e))r.add(e);else if(rd(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"===typeof e)for(const i in e)nd(e[i],t,r)}else;return void 0===n?Array.from(r):[]}function rd(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!==typeof MessagePort&&e instanceof MessagePort||("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const id=()=>{};class od{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!==typeof Worker&&Xh||"undefined"!==typeof Yh&&!Xh}constructor(e){const{name:t,source:n,url:r}=e;Jh(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=id,this.onError=e=>console.log(e),this.worker=Xh?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=id,this.onError=id,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||nd(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=ed({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Yh(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Yh(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class sd{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Jh(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Jh(this.isRunning),this.isRunning=!1,this._reject(e)}}class ad{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return od.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t,n)=>e.done(n),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e.error(t);const r=new Promise(r=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new sd(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Xh||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new od({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Zh?this.maxMobileConcurrency:this.maxConcurrency}}const ld={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class cd{props;workerPools=(()=>new Map)();static _workerFarm;static isSupported(){return od.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return cd._workerFarm=cd._workerFarm||new cd({}),cd._workerFarm.setProps(e),cd._workerFarm}constructor(e){this.props={...ld},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:r}=e;let i=this.workerPools.get(t);return i||(i=new ad({name:t,source:n,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}const ud=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version);async function hd(e,t,n,r,i){const o=e.id,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t[e.id]||{},r=Xh?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let i=n.workerUrl;if(i||"compression"!==e.id||(i=t.workerUrl),"test"===t._workerType&&(i=Xh?`modules/${e.module}/dist/${r}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!i){let t=e.version;"latest"===t&&(t="latest");const n=t?`@${t}`:"";i=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${r}`}return Jh(i),i}(e,n),a=cd.getWorkerFarm(n).getWorkerPool({name:o,url:s});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const l=await a.startJob("process-on-worker",dd.bind(null,i));l.postMessage("process",{input:t,options:n,context:r});const c=await l.result;return await c.result}async function dd(e,t,n,r){switch(n){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:o,input:s,options:a}=r;try{const n=await e(s,a);t.postMessage("done",{id:o,result:n})}catch(i){const e=i instanceof Error?i.message:"unknown error";t.postMessage("error",{id:o,error:e})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function fd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),n=t.reduce((e,t)=>e+t.byteLength,0),r=new Uint8Array(n);let i=0;for(const o of t)r.set(o,i),i+=o.byteLength;return r.buffer}(t)}const pd=262144;function md(e){if(function(e){return e&&"object"===typeof e&&e.isBuffer}(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"===typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"===typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function gd(e,t){return Lh?async function*(e,t){const n=e.getReader();let r;try{for(;;){const e=r||n.read();t?._streamReadAhead&&(r=n.read());const{done:i,value:o}=await e;if(i)return;yield md(o)}}catch(i){n.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield md(t)}(e)}function _d(e,t){if("string"===typeof e)return function*(e,t){const n=t?.chunkSize||262144;let r=0;const i=new TextEncoder;for(;r<e.length;){const t=Math.min(e.length-r,n),o=e.slice(r,r+t);r+=t,yield i.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const{chunkSize:n=pd}=t;let r=0;for(;r<e.byteLength;){const t=Math.min(e.byteLength-r,n),i=new ArrayBuffer(t),o=new Uint8Array(e,r,t);new Uint8Array(i).set(o),r+=t,yield i}}()}(e,t);if(fh(e))return async function*(e,t){const n=t?.chunkSize||1048576;let r=0;for(;r<e.size;){const t=r+n,i=await e.slice(r,t).arrayBuffer();r=t,yield i}}(e,t);if(ph(e))return gd(e,t);if(dh(e)){return gd(e.body,t)}throw new Error("makeIterator")}const yd="Cannot convert supplied data type";async function vd(e,t,n){const r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"===typeof e||r)return function(e,t){if(t.text&&"string"===typeof e)return e;if((e=>e&&"object"===typeof e&&e.isBuffer)(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return 0===e.byteOffset&&r===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(yd)}(e,t);if(fh(e)&&(e=await Ih(e)),dh(e)){const n=e;return await kh(n),t.binary?await n.arrayBuffer():await n.text()}if(ph(e)&&(e=_d(e,n)),(e=>Boolean(e)&&"function"===typeof e[Symbol.iterator])(e)||(e=>e&&"function"===typeof e[Symbol.asyncIterator])(e))return async function(e){const t=[];for await(const n of e)t.push(n);return fd(...t)}(e);throw new Error(yd)}function xd(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function bd(e,t,n){if(n)return n;const r={fetch:$h(t,e),...e};if(r.url){const e=Ah(r.url);r.baseUrl=e,r.queryString=function(e){const t=e.match(Th);return t&&t[0]}(r.url),r.filename=xd(e),r.baseUrl=function(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}(e)}return Array.isArray(r.loaders)||(r.loaders=null),r}const wd="4.3.3",Sd=wd[0]>="0"&&wd[0]<="9"?`v${wd}`:"";const Ed=function(){const e=new Xu({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=Sd,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}(),Td=()=>{const e=Fh();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};const Ad=/\.([^.]+)$/;function Cd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Pd(e))return null;if(t&&!Array.isArray(t))return _h(t);let i=[];t&&(i=i.concat(t)),n?.ignoreRegisteredLoaders||i.push(...Td()),function(e){for(const t of e)_h(t)}(i);const o=function(e,t,n,r){const i=Ch(e),o=Ph(e),s=Ah(i)||r?.url;let a=null,l="";n?.mimeType&&(a=kd(t,n?.mimeType),l=`match forced by supplied MIME type ${n?.mimeType}`);a=a||function(e,t){const n=t&&Ad.exec(t),r=n&&n[1];return r?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,r):null}(t,s),l=l||(a?`matched url ${s}`:""),a=a||kd(t,o),l=l||(a?`matched MIME type ${o}`:""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"===typeof t){if(Md(t,n))return n}else if(ArrayBuffer.isView(t)){if(Rd(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(Rd(t,0,n))return n}return null}(t,e),l=l||(a?`matched initial data ${Od(e)}`:""),n?.fallbackMimeType&&(a=a||kd(t,n?.fallbackMimeType),l=l||(a?`matched fallback MIME type ${o}`:""));l&&Ed.log(1,`selectLoader selected ${a?.name}: ${l}.`);return a}(e,i,n,r);if(!o&&!n?.nothrow)throw new Error(Id(e));return o}function Pd(e){return!(e instanceof Response&&204===e.status)}function Id(e){const t=Ch(e),n=Ph(e);let r="No valid loader found (";r+=t?`${xd(t)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=e?Od(e):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function kd(e,t){for(const n of e){if(n.mimeTypes?.some(e=>Sh(t,e)))return n;if(Sh(t,`application/x.${n.id}`))return n}return null}function Md(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function Rd(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(n=>function(e,t,n,r){if(r instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const r=new Uint8Array(e),i=new Uint8Array(t);for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(r,e,r.byteLength);switch(typeof r){case"function":return r(e);case"string":return r===Ld(e,t,r.length);default:return!1}}(e,t,0,n))}function Od(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"===typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Ld(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return Ld(e,0,t)}return""}function Ld(e,t,n){if(e.byteLength<t+n)return"";const r=new DataView(e);let i="";for(let o=0;o<n;o++)i+=String.fromCharCode(r.getUint8(t+o));return i}async function Dd(e,t,n,r){!t||Array.isArray(t)||gh(t)||(r=void 0,n=t,t=void 0),n=n||{};const i=Ch(e=await e),o=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,r),s=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Pd(e))return null;let i=Cd(e,t,{...n,nothrow:!0},r);if(i)return i;if(fh(e)&&(i=Cd(e=await e.slice(0,10).arrayBuffer(),t,n,r)),!i&&!n?.nothrow)throw new Error(Id(e));return i}(e,o,n);return s?(r=bd({url:i,_parse:Dd,loaders:o},n=jh(n,s,o,i),r||null),await async function(e,t,n,r){if(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ud;Jh(e,"no worker provided");const n=e.version}(e),n=Wh(e.options,n),dh(t)){const e=t,{ok:n,redirected:i,status:o,statusText:s,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());r.response={headers:c,ok:n,redirected:i,status:o,statusText:s,type:a,url:l}}t=await vd(t,e,n);const i=e;if(i.parseTextSync&&"string"===typeof t)return i.parseTextSync(t,n,r);if(function(e,t){return!!cd.isSupported()&&!(!Xh&&!t?._nodeWorkers)&&e.worker&&t?.worker}(e,n))return await hd(e,t,n,r,Dd);if(i.parseText&&"string"===typeof t)return await i.parseText(t,n,r);if(i.parse)return await i.parse(t,n,r);throw Jh(!i.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(s,e,n,r)):null}async function Nd(e,t,n,r){let i,o;Array.isArray(t)||gh(t)?(i=t,o=n):(i=[],o=t);const s=$h(o);let a=e;return"string"===typeof e&&(a=await s(e)),fh(e)&&(a=await s(e)),Array.isArray(i),await Dd(a,i,o)}class zd{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let r=e;"string"===typeof e&&(r=Nd(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const i of this._subscribers)i.onChange(this.getData())}}class Fd{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add(e){let{resourceId:t,data:n,forceUpdate:r=!1,persistent:i=!0}=e,o=this._resources[t];o?o.setData(n,r):(o=new zd(t,n,this._context),this._resources[t]=o),o.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const n=this._consumers[t];if(n){for(const e in n){const t=n[e],r=this._resources[t.resourceId];r&&r.unsubscribe(t)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:n,consumerId:r,requestId:i="default"}=e;const{_resources:o,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),o[t]||this.add({resourceId:t,data:null,persistent:!1}));const a=o[t];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,r){const i=this._consumers,o=i[e]=i[e]||{};let s=o[t];const a=s&&s.resourceId&&this._resources[s.resourceId];a&&(a.unsubscribe(s),this.prune()),n&&(s?(s.onChange=r,s.resourceId=n.id):s={onChange:r,resourceId:n.id},o[t]=s,n.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}const Bd=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,n){let{size:r=1,type:i,padding:o=0,copy:s=!1,initialize:a=!1,maxCount:l}=n;const c=i||e&&e.constructor||Float32Array,u=t*r+o;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let h=1/0;l&&(h=l*r+o);const d=this._allocate(c,u,a,h);return e&&s?d.set(e):a||d.fill(0,0,4),this._release(e),d}release(e){this._release(e)}_allocate(e,t,n,r){let i=Math.max(Math.ceil(t*this.opts.overAlloc),1);i>r&&(i=r);const o=this._pool,s=e.BYTES_PER_ELEMENT*i,a=o.findIndex(e=>e.byteLength>=s);if(a>=0){const t=new e(o.splice(a,1)[0],0,i);return n&&t.fill(0),t}return new e(i)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:r}=n,i=t.findIndex(e=>e.byteLength>=r);i<0?t.push(n):(i>0||t.length<this.opts.poolSize)&&t.splice(i,0,n),t.length>this.opts.poolSize&&t.shift()}};Math.PI,Math.PI;globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const jd=globalThis.mathgl.config;function Ud(e){let{precision:t=jd.precision}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=function(e){return Math.round(e/jd.EPSILON)*jd.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function Vd(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Gd(e,t,n){return Wd(e,e=>Math.max(t,Math.min(n,e)))}function Hd(e,t,n){return Vd(e)?e.map((e,r)=>Hd(e,t[r],n)):n*t+(1-n)*e}function $d(e,t,n){const r=jd.EPSILON;n&&(jd.EPSILON=n);try{if(e===t)return!0;if(Vd(e)&&Vd(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!$d(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"===typeof e&&"number"===typeof t&&Math.abs(e-t)<=jd.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{jd.EPSILON=r}}function Wd(e,t,n){if(Vd(e)){const r=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(r);for(let i=0;i<n.length&&i<r.length;++i){const r="number"===typeof e?e:e[i];n[i]=t(r,i,n)}return n}return t(e)}class qd extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Vd(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(jd)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+Ud(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!$d(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let r=0;r<this.ELEMENTS;++r){const i=e[r],o="number"===typeof t?t:t[r];this[r]=i+n*(o-i)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const r of t)for(let e=0;e<this.ELEMENTS;++e)this[e]+=r[e];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const r of t)for(let e=0;e<this.ELEMENTS;++e)this[e]-=r[e];return this.check()}scale(e){if("number"===typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(jd.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function Xd(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Zd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(jd.debug&&!function(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}function Kd(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class Yd extends qd{get x(){return this[0]}set x(e){this[0]=Xd(e)}get y(){return this[1]}set y(e){this[1]=Xd(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-e[n];t+=r*r}return Xd(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Xd(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const r of t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=r[e];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const r of t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=r[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Kd(e>=0&&e<this.ELEMENTS,"index is out of range"),Xd(this[e])}setComponent(e,t){return Kd(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Jd=1e-6;let Qd="undefined"!==typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function ef(){const e=new Qd(3);return Qd!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function tf(e,t,n){const r=new Qd(3);return r[0]=e,r[1]=t,r[2]=n,r}function nf(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function rf(e,t,n){const r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=i*l-o*a,e[1]=o*s-r*l,e[2]=r*a-i*s,e}function of(e,t,n){const r=t[0],i=t[1],o=t[2];let s=n[3]*r+n[7]*i+n[11]*o+n[15];return s=s||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/s,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,e}function sf(e,t,n){const r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function af(e,t,n){const r=n[0],i=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2];let u=i*c-o*l,h=o*a-r*c,d=r*l-i*a,f=i*d-o*h,p=o*u-r*d,m=r*h-i*u;const g=2*s;return u*=g,h*=g,d*=g,f*=2,p*=2,m*=2,e[0]=a+u+f,e[1]=l+h+p,e[2]=c+d+m,e}const lf=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},cf=function(e){const t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},uf=function(e){const t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r};!function(){const e=ef()}();function hf(e,t,n){const r=t[0],i=t[1],o=t[2],s=n[3]*r+n[7]*i+n[11]*o||1;return e[0]=(n[0]*r+n[4]*i+n[8]*o)/s,e[1]=(n[1]*r+n[5]*i+n[9]*o)/s,e[2]=(n[2]*r+n[6]*i+n[10]*o)/s,e}function df(e,t,n){const r=t[0],i=t[1],o=t[2];return e[0]=n[0]*r+n[3]*i+n[6]*o,e[1]=n[1]*r+n[4]*i+n[7]*o,e[2]=n[2]*r+n[5]*i+n[8]*o,e[3]=t[3],e}const ff=[0,0,0];let pf;class mf extends Yd{static get ZERO(){return pf||(pf=new mf(0,0,0),Object.freeze(pf)),pf}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(-0,-0,-0),1===arguments.length&&Vd(e)?this.copy(e):(jd.debug&&(Xd(e),Xd(t),Xd(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return jd.debug&&(Xd(e.x),Xd(e.y),Xd(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Xd(e)}angle(e){return function(e,t){const n=e[0],r=e[1],i=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt((n*n+r*r+i*i)*(o*o+s*s+a*a)),c=l&&nf(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}cross(e){return rf(this,this,e),this.check()}rotateX(e){let{radians:t,origin:n=ff}=e;return function(e,t,n,r){const i=[],o=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,n,t),this.check()}rotateY(e){let{radians:t,origin:n=ff}=e;return function(e,t,n,r){const i=[],o=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,n,t),this.check()}rotateZ(e){let{radians:t,origin:n=ff}=e;return function(e,t,n,r){const i=[],o=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,n,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return of(this,this,e),this.check()}transformAsVector(e){return hf(this,this,e),this.check()}transformByMatrix3(e){return sf(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const r=t[0],i=t[1];e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return af(this,this,e),this.check()}}const gf=new mf;function _f(e,t,n,r){gf.set(e,t,n);const i=gf.len();return{distance:r/i,normal:new mf(-e/i,-t/i,-n/i)}}function yf(e){return e-Math.fround(e)}let vf;function xf(e,t){const{size:n=1,startIndex:r=0}=t,i=void 0!==t.endIndex?t.endIndex:e.length,o=(i-r)/n;vf=Bd.allocate(vf,o,{type:Float32Array,size:2*n});let s=r,a=0;for(;s<i;){for(let t=0;t<n;t++){const r=e[s++];vf[a+t]=r,vf[a+t+n]=yf(r)}a+=2*n}return vf.subarray(0,o*n*2)}function bf(e){let t=null,n=!1;for(const r of e)r&&(t?(n||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],n=!0),t[0][0]=Math.min(t[0][0],r[0][0]),t[0][1]=Math.min(t[0][1],r[0][1]),t[1][0]=Math.max(t[1][0],r[1][0]),t[1][1]=Math.max(t[1][1],r[1][1])):t=r);return t}class wf extends qd{toString(){let e="[";if(jd.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Xd(n),this}getColumn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let r=0;r<this.RANK;++r)t[r]=this[n+r];return t}setColumn(e,t){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)this[n+r]=t[r];return this}}function Sf(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=n*a-r*s,v=n*l-i*s,x=n*c-o*s,b=r*l-i*a,w=r*c-o*a,S=i*c-o*l,E=u*m-h*p,T=u*g-d*p,A=u*_-f*p,C=h*g-d*m,P=h*_-f*m,I=d*_-f*g;let k=y*I-v*P+x*C+b*A-w*T+S*E;return k?(k=1/k,e[0]=(a*I-l*P+c*C)*k,e[1]=(i*P-r*I-o*C)*k,e[2]=(m*S-g*w+_*b)*k,e[3]=(d*w-h*S-f*b)*k,e[4]=(l*A-s*I-c*T)*k,e[5]=(n*I-i*A+o*T)*k,e[6]=(g*x-p*S-_*v)*k,e[7]=(u*S-d*x+f*v)*k,e[8]=(s*P-a*A+c*E)*k,e[9]=(r*A-n*P-o*E)*k,e[10]=(p*w-m*x+_*y)*k,e[11]=(h*x-u*w-f*y)*k,e[12]=(a*T-s*C-l*E)*k,e[13]=(n*C-r*T+i*E)*k,e[14]=(m*v-p*b-g*y)*k,e[15]=(u*b-h*v+d*y)*k,e):null}function Ef(e,t,n){const r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15];let v=n[0],x=n[1],b=n[2],w=n[3];return e[0]=v*r+x*a+b*h+w*m,e[1]=v*i+x*l+b*d+w*g,e[2]=v*o+x*c+b*f+w*_,e[3]=v*s+x*u+b*p+w*y,v=n[4],x=n[5],b=n[6],w=n[7],e[4]=v*r+x*a+b*h+w*m,e[5]=v*i+x*l+b*d+w*g,e[6]=v*o+x*c+b*f+w*_,e[7]=v*s+x*u+b*p+w*y,v=n[8],x=n[9],b=n[10],w=n[11],e[8]=v*r+x*a+b*h+w*m,e[9]=v*i+x*l+b*d+w*g,e[10]=v*o+x*c+b*f+w*_,e[11]=v*s+x*u+b*p+w*y,v=n[12],x=n[13],b=n[14],w=n[15],e[12]=v*r+x*a+b*h+w*m,e[13]=v*i+x*l+b*d+w*g,e[14]=v*o+x*c+b*f+w*_,e[15]=v*s+x*u+b*p+w*y,e}function Tf(e,t,n){const r=n[0],i=n[1],o=n[2];let s,a,l,c,u,h,d,f,p,m,g,_;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*o+t[12],e[13]=t[1]*r+t[5]*i+t[9]*o+t[13],e[14]=t[2]*r+t[6]*i+t[10]*o+t[14],e[15]=t[3]*r+t[7]*i+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],f=t[7],p=t[8],m=t[9],g=t[10],_=t[11],e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=f,e[8]=p,e[9]=m,e[10]=g,e[11]=_,e[12]=s*r+u*i+p*o+t[12],e[13]=a*r+h*i+m*o+t[13],e[14]=l*r+d*i+g*o+t[14],e[15]=c*r+f*i+_*o+t[15]),e}function Af(e,t,n){const r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Cf(e,t,n){const r=Math.sin(n),i=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=s*i+u*r,e[6]=a*i+h*r,e[7]=l*i+d*r,e[8]=c*i-o*r,e[9]=u*i-s*r,e[10]=h*i-a*r,e[11]=d*i-l*r,e}function Pf(e,t,n){const r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=s*i+u*r,e[2]=a*i+h*r,e[3]=l*i+d*r,e[4]=c*i-o*r,e[5]=u*i-s*r,e[6]=h*i-a*r,e[7]=d*i-l*r,e}function If(e,t){const n=t[0],r=t[1],i=t[2],o=t[4],s=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(o*o+s*s+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}const kf=function(e,t,n,r,i){const o=1/Math.tan(t/2);if(e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0){const t=1/(r-i);e[10]=(i+r)*t,e[14]=2*i*r*t}else e[10]=-1,e[14]=-2*r;return e};const Mf=function(e,t,n,r,i,o,s){const a=1/(t-n),l=1/(r-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*l,e[14]=(s+o)*c,e[15]=1,e};function Rf(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Of(e,t,n,r){const i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}!function(){const e=function(){const e=new Qd(2);return Qd!=Float32Array&&(e[0]=0,e[1]=0),e}()}();function Lf(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Df(e){const t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function Nf(e){const t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function zf(e,t,n){const r=t[0],i=t[1],o=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,e}!function(){const e=function(){const e=new Qd(4);return Qd!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();var Ff;!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(Ff||(Ff={}));const Bf=45*Math.PI/180,jf=1,Uf=.1,Vf=500,Gf=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Hf extends wf{static get IDENTITY(){return function(){Wf||(Wf=new Hf,Object.freeze(Wf));return Wf}()}static get ZERO(){return function(){$f||($f=new Hf([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze($f));return $f}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ff}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=m,this.check()}setRowMajor(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,m){return this[0]=e,this[1]=i,this[2]=l,this[3]=d,this[4]=t,this[5]=o,this[6]=c,this[7]=f,this[8]=n,this[9]=s,this[10]=u,this[11]=p,this[12]=r,this[13]=a,this[14]=h,this[15]=m,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Gf)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,l=i+i,c=n*s,u=r*s,h=r*a,d=i*s,f=i*a,p=i*l,m=o*s,g=o*a,_=o*l;e[0]=1-h-p,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=f+m,e[7]=0,e[8]=d+g,e[9]=f-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:r,top:i,near:o=Uf,far:s=Vf}=e;return s===1/0?function(e,t,n,r,i,o){const s=2*o/(n-t),a=2*o/(i-r),l=(n+t)/(n-t),c=(i+r)/(i-r),u=-1,h=-1,d=-2*o;e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=u,e[11]=h,e[12]=0,e[13]=0,e[14]=d,e[15]=0}(this,t,n,r,i,o):function(e,t,n,r,i,o,s){const a=1/(n-t),l=1/(i-r),c=1/(o-s);e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(i+r)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0}(this,t,n,r,i,o,s),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:r=[0,1,0]}=e;return function(e,t,n,r){let i,o,s,a,l,c,u,h,d,f;const p=t[0],m=t[1],g=t[2],_=r[0],y=r[1],v=r[2],x=n[0],b=n[1],w=n[2];Math.abs(p-x)<Jd&&Math.abs(m-b)<Jd&&Math.abs(g-w)<Jd?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(h=p-x,d=m-b,f=g-w,i=1/Math.sqrt(h*h+d*d+f*f),h*=i,d*=i,f*=i,o=y*f-v*d,s=v*h-_*f,a=_*d-y*h,i=Math.sqrt(o*o+s*s+a*a),i?(i=1/i,o*=i,s*=i,a*=i):(o=0,s=0,a=0),l=d*a-f*s,c=f*o-h*a,u=h*s-d*o,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=u,e[10]=f,e[11]=0,e[12]=-(o*p+s*m+a*g),e[13]=-(l*p+c*m+u*g),e[14]=-(h*p+d*m+f*g),e[15]=1)}(this,t,n,r),this.check()}ortho(e){const{left:t,right:n,bottom:r,top:i,near:o=Uf,far:s=Vf}=e;return Mf(this,t,n,r,i,o,s),this.check()}orthographic(e){const{fovy:t=Bf,aspect:n=jf,focalDistance:r=1,near:i=Uf,far:o=Vf}=e;qf(t);const s=t/2,a=r*Math.tan(s),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:i,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:r=.1,far:i=500}=e;return qf(t),kf(this,t,n,r,i),this.check()}determinant(){return function(e){const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=t*s-n*o,_=t*a-r*o,y=n*a-r*s,v=c*p-u*f,x=c*m-h*f,b=u*m-h*p;return l*(t*b-n*x+r*v)-i*(o*b-s*x+a*v)+e[15]*(c*y-u*_+h*g)-d*(f*y-p*_+m*g)}(this)}getScale(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),r=1/n[0],i=1/n[1],o=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*i,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*i,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),r=1/n[0],i=1/n[1],o=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*i,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*i,e[8]=this[10]*o,e}transpose(){return function(e,t){if(e===t){const n=t[1],r=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return Sf(this,this),this.check()}multiplyLeft(e){return Ef(this,e,this),this.check()}multiplyRight(e){return Ef(this,this,e),this.check()}rotateX(e){return Cf(this,this,e),this.check()}rotateY(e){return function(e,t,n){const r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=s*i-u*r,e[2]=a*i-h*r,e[3]=l*i-d*r,e[8]=o*r+c*i,e[9]=s*r+u*i,e[10]=a*r+h*i,e[11]=l*r+d*i}(this,this,e),this.check()}rotateZ(e){return Pf(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,r){let i,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,S,E,T,A,C,P=r[0],I=r[1],k=r[2],M=Math.sqrt(P*P+I*I+k*k);M<Jd||(M=1/M,P*=M,I*=M,k*=M,o=Math.sin(n),i=Math.cos(n),s=1-i,a=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],m=t[8],g=t[9],_=t[10],y=t[11],v=P*P*s+i,x=I*P*s+k*o,b=k*P*s-I*o,w=P*I*s-k*o,S=I*I*s+i,E=k*I*s+P*o,T=P*k*s+I*o,A=I*k*s-P*o,C=k*k*s+i,e[0]=a*v+h*x+m*b,e[1]=l*v+d*x+g*b,e[2]=c*v+f*x+_*b,e[3]=u*v+p*x+y*b,e[4]=a*w+h*S+m*E,e[5]=l*w+d*S+g*E,e[6]=c*w+f*S+_*E,e[7]=u*w+p*S+y*E,e[8]=a*T+h*A+m*C,e[9]=l*T+d*A+g*C,e[10]=c*T+f*A+_*C,e[11]=u*T+p*A+y*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return Af(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Tf(this,this,e),this.check()}transform(e,t){return 4===e.length?(Zd(t=zf(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let r;switch(n){case 2:r=function(e,t,n){const r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}(t||[-0,-0],e,this);break;case 3:r=of(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Zd(r,e.length),r}transformAsVector(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const r=t[0],i=t[1],o=n[3]*r+n[7]*i||1;return e[0]=(n[0]*r+n[4]*i)/o,e[1]=(n[1]*r+n[5]*i)/o,e}(t||[-0,-0],e,this);break;case 3:n=hf(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Zd(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let $f,Wf;function qf(e){if(e>2*Math.PI)throw Error("expected radians")}function Xf(e,t){const n=zf([],t,e);return Lf(n,n,1/n[3]),n}function Zf(e,t){const n=e%t;return n<0?t+n:n}function Kf(e,t,n){return e<t?t:e>n?n:e}const Yf=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function Jf(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Qf=Math.PI,ep=Qf/4,tp=Qf/180,np=180/Qf,rp=512,ip=4003e4,op=85.051129,sp=1.5;function ap(e){const[t,n]=e;Jf(Number.isFinite(t)),Jf(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=n*tp;return[rp*(t*tp+Qf)/(2*Qf),rp*(Qf+Math.log(Math.tan(ep+.5*r)))/(2*Qf)]}function lp(e){const[t,n]=e,r=t/rp*(2*Qf)-Qf,i=2*(Math.atan(Math.exp(n/rp*(2*Qf)-Qf))-ep);return[r*np,i*np]}function cp(e){const{latitude:t}=e;Jf(Number.isFinite(t));const n=Math.cos(t*tp);return function(e){return Yf(e)}(ip*n)-9}function up(e){return 12790407194604047e-21/Math.cos(e*tp)}function hp(e){const{latitude:t,longitude:n,highPrecision:r=!1}=e;Jf(Number.isFinite(t)&&Number.isFinite(n));const i=rp,o=Math.cos(t*tp),s=i/360,a=s/o,l=12790407194604047e-21/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,a,l],degreesPerUnit:[.703125,1/a,1/l]};if(r){const e=tp*Math.tan(t*tp)/o,n=s*e/2,r=12790407194604047e-21*e,i=r/a*l;c.unitsPerDegree2=[0,n,r],c.unitsPerMeter2=[i,0,i]}return c}function dp(e,t){const[n,r,i]=e,[o,s,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=hp({longitude:n,latitude:r,highPrecision:!0}),u=ap(e);u[0]+=o*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);const h=lp(u),d=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[h[0],h[1],d]:h}function fp(e){const{width:t,height:n,altitude:r,pitch:i=0,offset:o,center:s,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e;let{fovy:u=pp(sp)}=e;void 0!==r&&(u=pp(r));const h=u*tp,d=i*tp,f=mp(u);let p=f;s&&(p+=s[2]*a/Math.cos(d)/n);const m=h*(.5+(o?o[1]:0)/n),g=Math.sin(m)*p/Math.sin(Kf(Math.PI/2-d-m,.01,Math.PI-.01)),_=Math.sin(d)*g+p,y=10*p;return{fov:h,aspect:t/n,focalDistance:f,near:l,far:Math.min(_*c,y)}}function pp(e){return 2*Math.atan(.5/e)*np}function mp(e){return.5/Math.tan(.5*e*tp)}function gp(e,t){const[n,r,i=0]=e;return Jf(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),Xf(t,[n,r,i,1])}function _p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const[r,i,o]=e;if(Jf(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o)){return Xf(t,[r,i,o,1])}const s=Xf(t,[r,i,0,1]),a=Xf(t,[r,i,1,1]),l=s[2],c=a[2];return Of([],s,a,l===c?0:((n||0)-l)/(c-l))}function yp(e){const{width:t,height:n,bounds:r,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=e,[[a,l],[c,u]]=r,h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"===typeof e)return{top:e,bottom:e,left:e,right:e};return Jf(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e}(e.padding),d=ap([a,Kf(u,-85.051129,op)]),f=ap([c,Kf(l,-85.051129,op)]),p=[Math.max(Math.abs(f[0]-d[0]),i),Math.max(Math.abs(f[1]-d[1]),i)],m=[t-h.left-h.right-2*Math.abs(s[0]),n-h.top-h.bottom-2*Math.abs(s[1])];Jf(m[0]>0&&m[1]>0);const g=m[0]/p[0],_=m[1]/p[1],y=(h.right-h.left)/2/g,v=(h.top-h.bottom)/2/_,x=lp([(f[0]+d[0])/2+y,(f[1]+d[1])/2+v]),b=Math.min(o,Yf(Math.abs(Math.min(g,_))));return Jf(Number.isFinite(b)),{longitude:x[0],latitude:x[1],zoom:b}}const vp=Math.PI/180;function xp(e,t,n){const{pixelUnprojectionMatrix:r}=e,i=Xf(r,[t,0,1,1]),o=Xf(r,[t,e.height,1,1]),s=lp(Of([],i,o,(n*e.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2])));return s.push(n),s}var bp,wp,Sp;!function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"}(bp||(bp={})),function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"}(wp||(wp={})),function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"}(Sp||(Sp={}));const Ep="auto",Tp="manipulation",Ap="none",Cp="pan-x",Pp="pan-y";class Ip{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(Ap))return Ap;const t=e.includes(Cp),n=e.includes(Pp);return t&&n?Ap:t||n?t?Cp:Pp:e.includes(Tp)?Tp:Ep}(e.join(" "))}}function kp(e){return e.trim().split(/\s+/g)}function Mp(e,t,n){if(e)for(const r of kp(t))e.addEventListener(r,n,!1)}function Rp(e,t,n){if(e)for(const r of kp(t))e.removeEventListener(r,n,!1)}function Op(e){return(e.ownerDocument||e).defaultView}function Lp(e){const t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let n=0,r=0,i=0;for(;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:Math.round(n/t),y:Math.round(r/t)}}function Dp(e){const t=[];let n=0;for(;n<e.pointers.length;)t[n]={clientX:Math.round(e.pointers[n].clientX),clientY:Math.round(e.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:t,center:Lp(t),deltaX:e.deltaX,deltaY:e.deltaY}}function Np(e,t){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function zp(e,t){const n=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(n*n+r*r)}function Fp(e,t){const n=t.clientX-e.clientX,r=t.clientY-e.clientY;return 180*Math.atan2(r,n)/Math.PI}function Bp(e,t){return e===t?wp.None:Math.abs(e)>=Math.abs(t)?e<0?wp.Left:wp.Right:t<0?wp.Up:wp.Down}function jp(e,t,n){return{x:t/e||0,y:n/e||0}}function Up(e,t){const{session:n}=e,{pointers:r}=t,{length:i}=r;n.firstInput||(n.firstInput=Dp(t)),i>1&&!n.firstMultiple?n.firstMultiple=Dp(t):1===i&&(n.firstMultiple=!1);const{firstInput:o,firstMultiple:s}=n,a=s?s.center:o.center,l=t.center=Lp(r);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=function(e,t){const n=t.x-e.x,r=t.y-e.y;return 180*Math.atan2(r,n)/Math.PI}(a,l),t.distance=Np(a,l);const{deltaX:c,deltaY:u}=function(e,t){const n=t.center;let r=e.offsetDelta,i=e.prevDelta;const o=e.prevInput;return t.eventType!==bp.Start&&o?.eventType!==bp.End||(i=e.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-r.x),deltaY:i.y+(n.y-r.y)}}(n,t);t.deltaX=c,t.deltaY=u,t.offsetDirection=Bp(t.deltaX,t.deltaY);const h=jp(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,t.scale=s?function(e,t){return zp(t[0],t[1])/zp(e[0],e[1])}(s.pointers,r):1,t.rotation=s?function(e,t){return Fp(t[1],t[0])-Fp(e[1],e[0])}(s.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let d=e.element;return function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parentNode}return!1}(t.srcEvent.target,d)&&(d=t.srcEvent.target),t.target=d,function(e,t){const n=e.lastInterval||t,r=t.timeStamp-n.timeStamp;let i,o,s,a;if(t.eventType!==bp.Cancel&&(r>25||void 0===n.velocity)){const l=t.deltaX-n.deltaX,c=t.deltaY-n.deltaY,u=jp(r,l,c);o=u.x,s=u.y,i=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=Bp(l,c),e.lastInterval=t}else i=n.velocity,o=n.velocityX,s=n.velocityY,a=n.direction;t.velocity=i,t.velocityX=o,t.velocityY=s,t.direction=a}(n,t),t}class Vp{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,n){const r=n.pointers.length,i=n.changedPointers.length,o=t&bp.Start&&r-i===0,s=t&(bp.End|bp.Cancel)&&r-i===0;n.isFirst=Boolean(o),n.isFinal=Boolean(s),o&&(e.session={}),n.eventType=t;const a=Up(e,n);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}(this.manager,e,t)}init(){Mp(this.element,this.evEl,this.domHandler),Mp(this.target,this.evTarget,this.domHandler),Mp(Op(this.element),this.evWin,this.domHandler)}destroy(){Rp(this.element,this.evEl,this.domHandler),Rp(this.target,this.evTarget,this.domHandler),Rp(Op(this.element),this.evWin,this.domHandler)}}const Gp={pointerdown:bp.Start,pointermove:bp.Move,pointerup:bp.End,pointercancel:bp.Cancel,pointerout:bp.Cancel};class Hp extends Vp{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const r=Gp[e.type],i=e.pointerType,o="touch"===i;let s=t.findIndex(t=>t.pointerId===e.pointerId);r&bp.Start&&(e.buttons||o)?s<0&&(t.push(e),s=t.length-1):r&(bp.End|bp.Cancel)&&(n=!0),s<0||(t[s]=e,this.callback(r,{pointers:t,changedPointers:[e],eventType:r,pointerType:i,srcEvent:e}),n&&t.splice(s,1))}}const $p=["","webkit","Moz","MS","ms","o"];function Wp(e,t){const n=t[0].toUpperCase()+t.slice(1);for(const r of $p){const i=r?r+n:t;if(i in e)return i}}const qp={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Xp{constructor(e,t){this.options={...qp,...t,cssProps:{...qp.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new Hp(this),this.touchAction=new Ip(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){const{session:t}=this;if(t.stopped)return;let n;this.session.prevented&&e.srcEvent.preventDefault();const{recognizers:r}=this;let{curRecognizer:i}=t;(!i||i&&i.state&Sp.Recognized)&&(i=t.curRecognizer=null);let o=0;for(;o<r.length;)n=r[o],2===t.stopped||i&&n!==i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&n.state&(Sp.Began|Sp.Changed|Sp.Ended)&&(i=t.curRecognizer=n),o++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const t of e)this.add(t);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const t of e)this.remove(t);return this}const t="string"===typeof e?this.get(e):e;if(t){const{recognizers:e}=this,n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const r of kp(e))n[r]=n[r]||[],n[r].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const r of kp(e))t?n[r]&&n[r].splice(n[r].indexOf(t),1):delete n[r]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const r=t;r.type=e,r.preventDefault=function(){t.srcEvent.preventDefault()};let i=0;for(;i<n.length;)n[i](r),i++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,r]of Object.entries(this.options.cssProps)){const i=Wp(t.style,n);e?(this.oldCssProps[i]=t.style[i],t.style[i]=r):t.style[i]=this.oldCssProps[i]||""}e||(this.oldCssProps={})}}}let Zp=1;function Kp(e){return e&Sp.Cancelled?"cancel":e&Sp.Ended?"end":e&Sp.Changed?"move":e&Sp.Began?"start":""}class Yp{constructor(e){this.options=e,this.id=Zp++,this.state=Sp.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const t of e)this.recognizeWith(t);return this}let t;if("string"===typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const t of e)this.dropRecognizeWith(t);return this}let t;return t="string"===typeof e?this.manager.get(e):e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const t of e)this.requireFailure(t);return this}let t;if("string"===typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return-1===n.indexOf(t)&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const t of e)this.dropRequireFailure(t);return this}let t;if(t="string"===typeof e?this.manager.get(e):e,t){const e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find(e=>e.options.enable))}canRecognizeWith(e){return Boolean(this.simultaneous[e.id])}emit(e){if(!e)return;const{state:t}=this;t<Sp.Ended&&this.manager.emit(this.options.event+Kp(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Sp.Ended&&this.manager.emit(this.options.event+Kp(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Sp.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Sp.Failed|Sp.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable)return this.reset(),void(this.state=Sp.Failed);this.state&(Sp.Recognized|Sp.Cancelled|Sp.Failed)&&(this.state=Sp.Possible),this.state=this.process(t),this.state&(Sp.Began|Sp.Changed|Sp.Ended|Sp.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class Jp extends Yp{attrTest(e){const t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,r=t&(Sp.Began|Sp.Changed),i=this.attrTest(e);return r&&(n&bp.Cancel||!i)?t|Sp.Cancelled:r||i?n&bp.End?t|Sp.Ended:t&Sp.Began?t|Sp.Changed:Sp.Began:Sp.Failed}}class Qp extends Yp{constructor(){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Tp]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&bp.Start&&0===this.count)return this.failTimeout();if(r&&i&&n){if(e.eventType!==bp.End)return this.failTimeout();const n=!this.pTime||e.timeStamp-this.pTime<t.interval,r=!this.pCenter||Np(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,r&&n?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Sp.Recognized,this.tryEmit(this._input)},t.interval),Sp.Began):Sp.Recognized}return Sp.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Sp.Failed},this.options.interval),Sp.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Sp.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const em=["","start","move","end","cancel","up","down","left","right"];class tm extends Jp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({enable:!0,pointers:1,event:"pan",threshold:10,direction:wp.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&wp.Horizontal&&t.push(Pp),e&wp.Vertical&&t.push(Cp),t}getEventNames(){return em.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:r}=e,{direction:i}=e;const o=e.deltaX,s=e.deltaY;return i&t.direction||(t.direction&wp.Horizontal?(i=0===o?wp.None:o<0?wp.Left:wp.Right,n=o!==this.pX,r=Math.abs(e.deltaX)):(i=0===s?wp.None:s<0?wp.Up:wp.Down,n=s!==this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&Boolean(i&t.direction)}attrTest(e){return super.attrTest(e)&&(Boolean(this.state&Sp.Began)||!(this.state&Sp.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=wp[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const nm=["","start","move","end","cancel","in","out"];class rm{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const im="undefined"!==typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",om=("undefined"!==typeof window?window:global,"undefined"!==typeof global?global:window,"undefined"!==typeof document&&document,-1!==im.indexOf("firefox")),sm=4.000244140625;class am extends rm{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(om&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%sm===0&&(t=Math.floor(t/sm)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const lm=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class cm extends rm{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,lm.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){lm.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const um=["keydown","keyup"];class hm extends rm{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",um.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){um.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class dm extends rm{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}const fm={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function pm(e){const t=fm[e.srcEvent.type];if(!t)return null;const{buttons:n,button:r}=e.srcEvent;let i=!1,o=!1,s=!1;return 2===t?(i=Boolean(1&n),o=Boolean(4&n),s=Boolean(2&n)):(i=0===r,o=1===r,s=2===r),{leftButton:i,middleButton:o,rightButton:s}}function mm(e,t){const n=e.center;if(!n)return null;const r=t.getBoundingClientRect(),i=r.width/t.offsetWidth||1,o=r.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-r.left-t.clientLeft)/i,y:(n.y-r.top-t.clientTop)/o}}}const gm={srcElement:"root",priority:0};class _m{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{handlers:o,handlersByElement:s}=this,a={...gm,...n};let l=s.get(a.srcElement);l||(l=[],s.set(a.srcElement,l));const c={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};r&&(c.once=!0),i&&(c.passive=!0),o.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){const{handlers:n,handlersByElement:r}=this;for(let i=n.length-1;i>=0;i--){const o=n[i];if(o.type===e&&o.handler===t){n.splice(i,1);const e=r.get(o.srcElement);e.splice(e.indexOf(o),1),0===e.length&&r.delete(o.srcElement)}}this._active=n.some(e=>!e.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const r=()=>{e.handled=!0},i=()=>{e.handled=!0,t=!0},o=[];for(let s=0;s<n.length;s++){const{type:a,handler:l,once:c}=n[s];if(l({...e,type:a,stopPropagation:r,stopImmediatePropagation:i}),c&&o.push(n[s]),t)break}for(let e=0;e<o.length;e++){const{type:t,handler:n}=o[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...pm(e),...mm(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function ym(e){if("recognizer"in e)return e;let t;const n=Array.isArray(e)?[...e]:[e];if("function"===typeof n[0]){t=new(n.shift())(n.shift()||{})}else t=n.shift();return{recognizer:t,recognizeWith:"string"===typeof n[0]?[n[0]]:n[0],requireFailure:"string"===typeof n[1]?[n[1]]:n[1]}}class vm{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,e){this.manager=new Xp(e,this.options);for(const e of this.options.recognizers){const{recognizer:t,recognizeWith:n,requireFailure:r}=ym(e);this.manager.add(t),n&&t.recognizeWith(n),r&&t.requireFailure(r)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new am(e,this._onOtherEvent,{enable:!1}),this.moveInput=new cm(e,this._onOtherEvent,{enable:!1}),this.keyInput=new hm(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new dm(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const r=n.get(e);r&&(r.set({enable:t}),n.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,n,r,i){if("string"!==typeof e){n=t;for(const[t,o]of Object.entries(e))this._addEventHandler(t,o,n,r,i);return}const{manager:o,events:s}=this;if(!o)return;let a=s.get(e);if(!a){const t=this._getRecognizerName(e)||e;a=new _m(this,t),s.set(e,a),o&&o.on(e,a.handleEvent)}a.add(e,t,n,r,i),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!==typeof e){for(const[t,n]of Object.entries(e))this._removeEventHandler(t,n);return}const{events:n}=this,r=n.get(e);if(r&&(r.remove(e,t),r.isEmpty())){const{recognizerName:e}=r;let t=!1;for(const r of n.values())if(r.recognizerName===e&&!r.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const xm={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(xm,"IDENTITY",{get:()=>(Ju.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const bm={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},wm={common:0,meters:1,pixels:2},Sm={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Em={multipan:[tm,{threshold:10,direction:wp.Vertical,pointers:2}],pinch:[class extends Jp{constructor(){super({enable:!0,event:"pinch",threshold:0,pointers:2,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}})}getTouchAction(){return[Ap]}getEventNames(){return nm.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||Boolean(this.state&Sp.Began))}emit(e){if(1!==e.scale){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[tm,{threshold:1},["pinch"],["multipan"]],dblclick:[Qp,{event:"dblclick",taps:2}],click:[Qp,{event:"click"},null,["dblclick"]]},Tm=Math.PI/180,Am=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Cm=[0,0,0],Pm={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class Im{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Pm,this.focalDistance=e.focalDistance||1,this.position=e.position||Cm,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?bm.WEB_MERCATOR:bm.WEB_MERCATOR_AUTO_OFFSET:bm.IDENTITY}equals(e){return e instanceof Im&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&$d(e.projectionMatrix,this.projectionMatrix)&&$d(e.viewMatrix,this.viewMatrix))}project(e){let{topLeft:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=gp(this.projectPosition(e),this.pixelProjectionMatrix),[r,i]=n,o=t?i:this.height-i;return 2===e.length?[r,o]:[r,o,n[2]]}unproject(e){let{topLeft:t=!0,targetZ:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[r,i,o]=e,s=t?i:this.height-i,a=n&&n*this.distanceScales.unitsPerMeter[2],l=_p([r,s,o],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=ap(e);return t[1]=Gd(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?lp(e):e}getBounds(){const e={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},t=this.unproject([0,0],e),n=this.unproject([this.width,0],e),r=this.unproject([0,this.height],e),i=this.unproject([this.width,this.height],e);return[Math.min(t[0],n[0],r[0],i[0]),Math.min(t[1],n[1],r[1],i[1]),Math.max(t[0],n[0],r[0],i[0]),Math.max(t[1],n[1],r[1],i[1])]}getDistanceScales(e){return e&&this.isGeospatial?hp({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:n,width:r=1,height:i=1}=e;return t<this.x+this.width&&this.x<t+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:_f((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:_f(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:_f(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:_f(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:_f(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:_f(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=cp({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||hp({latitude:n,longitude:t}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:i,modelMatrix:o}=e;let s=Cm;if(i&&(s=o?new Hf(o).transformAsVector(i,[]):i),this.isGeospatial){const e=this.projectPosition([t,n,0]);this.center=new mf(s).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=Am,projectionMatrix:n=null,orthographic:r=!1,fovyRadians:i,fovy:o=75,near:s=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new Hf).multiplyRight(t).translate(new mf(this.center).negate()),this.projectionMatrix=n||function(e){let{width:t,height:n,orthographic:r,fovyRadians:i,focalDistance:o,padding:s,near:a,far:l}=e;const c=t/n,u=r?(new Hf).orthographic({fovy:i,aspect:c,focalDistance:o,near:a,far:l}):(new Hf).perspective({fovy:i,aspect:c,near:a,far:l});if(s){const{left:e=0,right:r=0,top:i=0,bottom:o=0}=s,a=Gd((e+t-r)/2,0,t)-t/2,l=Gd((i+n-o)/2,0,n)-n/2;u[8]-=2*a/t,u[9]+=2*l/n}return u}({width:this.width,height:this.height,orthographic:r,fovyRadians:i||o*Tm,focalDistance:c,padding:l,near:s,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;Ef(u,u,this.projectionMatrix),Ef(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=Sf([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Af(d,d,[this.width/2,-this.height/2,1]),Tf(d,d,[1,-1,0]),Ef(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=Sf([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ju.warn("Pixel project matrix not invertible")()}}Im.displayName="Viewport";const km=Im;class Mm{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{th("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:n,stats:r,viewport:i,timeline:o}=t||{};this.layers=[],this.resourceManager=new Fd({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:_u(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[vu],renderPass:void 0,stats:r||new ah({id:"deck.gl"}),viewport:i||new km({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new kc,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const r=n.getNeedsRedraw(e);t=t||r}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){th("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const n=nh(e,Boolean);for(const r of n)r.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(t=>t.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const o of e)n[o.id]?Ju.warn(`Multiple old layers with same id ${o.id}`)():n[o.id]=o;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(t,n,r),this._finalizeOldLayers(n);let i=!1;for(const o of r)if(o.hasUniformTransition()){i=`Uniform transition in ${o}`;break}this._needsUpdate=i,this.layers=r}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const e=t[i.id];null===e&&Ju.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let o=null;try{this._debug&&e!==i&&i.validateProps(),e?(this._transferLayerState(e,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),o=i.isComposite?i.getSubLayers():null}catch(r){this._handleError("matching",r,i)}o&&this._updateSublayersRecursively(o,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=wu}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=bu,t!==e&&(e.lifecycle=Su)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Eu;try{e._finalize(),e.lifecycle=Tu}catch(t){this._handleError("finalization",t,e)}}}function Rm(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Rm(e[r],t[r],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"===typeof e&&"object"===typeof t){const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const o of r){if(!t.hasOwnProperty(o))return!1;if(!Rm(e[o],t[o],n-1))return!1}return!0}return!1}class Om{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t="string"===typeof e?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),r={x:e[0],y:e[1]};for(let i=n.length-1;i>=0;--i){const o=n[i];if(o.containsPixel(r)){const n=e.slice();return n[0]-=o.x,n[1]-=o.y,o.unproject(n,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=nh(e,Boolean);this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){if(e){!Rm(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else Ju.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>this.getView(e.id)?.makeViewport({viewState:t,width:this.width,height:this.height})})}_updateController(e,t,n,r){const i=e.controller;if(i&&n){const o={...t,...i,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return r&&r.constructor===i.type||(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let r=e.length;r--;){const i=e[r],o=this.getViewState(i),s=i.makeViewport({viewState:o,width:this.width,height:this.height});let a=t[i.id];const l=Boolean(i.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[i.id]=this._updateController(i,o,s,a),s&&this._viewports.unshift(s)}for(const r in t){const e=t[r];e&&!this.controllers[r]&&e.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((n,r)=>!e[r].equals(t[r]))}}const Lm=/([0-9]+\.?[0-9]*)(%|px)/;function Dm(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=Lm.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function Nm(e,t){return e.relative?Math.round(e.position*t):e.position}class zm{constructor(e){const{id:t,x:n=0,y:r=0,width:i="100%",height:o="100%",padding:s=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Dm(n),this._y=Dm(r),this._width=Dm(i),this._height=Dm(o),this._padding=s&&{left:Dm(s.left||0),right:Dm(s.right||0),top:Dm(s.top||0),bottom:Dm(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&Rm(this.props,e.props,2)}makeViewport(e){let{width:t,height:n,viewState:r}=e;r=this.filterViewState(r);const i=this.getDimensions({width:t,height:n});if(!i.height||!i.width)return null;return new(this.getViewportType(r))({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return"string"===typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"===typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions(e){let{width:t,height:n}=e;const r={x:Nm(this._x,t),y:Nm(this._y,n),width:Nm(this._width,t),height:Nm(this._height,n)};return this._padding&&(r.padding={left:Nm(this._padding.left,t),top:Nm(this._padding.top,n),right:Nm(this._padding.right,t),bottom:Nm(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"===typeof e?{type:e}:{type:this.ControllerType,...e}:null}}class Fm extends km{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{latitude:t=0,longitude:n=0,zoom:r=0,pitch:i=0,bearing:o=0,nearZMultiplier:s=.1,farZMultiplier:a=1.01,nearZ:l,farZ:c,orthographic:u=!1,projectionMatrix:h,repeat:d=!1,worldOffset:f=0,position:p,padding:m,legacyMeterSizes:g=!1}=e;let{width:_,height:y,altitude:v=1.5}=e;const x=Math.pow(2,r);let b;_=_||1,y=y||1;let w=null;if(h)v=h[5]/2,b=pp(v);else{let n;if(e.fovy?(b=e.fovy,v=mp(b)):b=pp(v),m){const{top:e=0,bottom:t=0}=m;n=[0,Gd((e+y-t)/2,0,y)-y/2]}w=fp({width:_,height:y,scale:x,center:p&&[0,0,p[2]*up(t)],offset:n,pitch:i,fovy:b,nearZMultiplier:s,farZMultiplier:a}),Number.isFinite(l)&&(w.near=l),Number.isFinite(c)&&(w.far=c)}let S=function(e){const{height:t,pitch:n,bearing:r,altitude:i,scale:o,center:s}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Tf(a,a,[0,0,-i]),Cf(a,a,-n*tp),Pf(a,a,r*tp);const l=o/t;return Af(a,a,[l,l,l]),s&&Tf(a,a,function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}([],s)),a}({height:y,pitch:i,bearing:o,scale:x,altitude:v});if(f){S=(new Hf).translate([512*f,0,0]).multiplyLeft(S)}super({...e,width:_,height:y,viewMatrix:S,longitude:n,latitude:t,zoom:r,...w,fovy:b,focalDistance:v}),this.latitude=t,this.longitude=n,this.zoom=r,this.pitch=i,this.bearing=o,this.altitude=v,this.fovy=b,this.orthographic=u,this._subViewports=d?[]:null,this._pseudoMeters=g,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let r=t;r<=n;r++){const e=r?new Fm({...this,worldOffset:r}):this;this._subViewports.push(e)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*up(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/up(n)]}addMetersToLngLat(e,t){return dp(e,t)}panByPosition(e,t){const n=_p(t,this.pixelUnprojectionMatrix),r=Rf([],this.projectFlat(e),function(e,t){return e[0]=-t[0],e[1]=-t[1],e}([],n)),i=Rf([],this.center,r),[o,s]=this.unprojectFlat(i);return{longitude:o,latitude:s}}getBounds(){const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:n,height:r,unproject:i}=e,o={targetZ:t},s=i([0,r],o),a=i([n,r],o);let l,c;return(e.fovy?.5*e.fovy*vp:Math.atan(.5/e.altitude))>(90-e.pitch)*vp-.01?(l=xp(e,0,t),c=xp(e,n,t)):(l=i([0,0],o),c=i([n,0],o)),[s,a,c,l]}(this,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{width:n,height:r}=this,{longitude:i,latitude:o,zoom:s}=yp({width:n,height:r,bounds:e,...t});return new Fm({width:n,height:r,longitude:i,latitude:o,zoom:s})}}Fm.displayName="WebMercatorViewport";const Bm=Fm;class jm{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Um=()=>{},Vm=2,Gm=3,Hm=e=>e,$m=1;class Wm{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:n,startProps:r,endProps:i,duration:o,easing:s}}=e,a=s(t/o),l=n.interpolateProps(r,i,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new jm(e.timeline),this.onViewStateChange=e.onViewStateChange||Um,this.onStateChange=e.onStateChange||Um}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let r=n;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;r={...n,...e===Vm?t:this.propsInTransition||n}}this._triggerTransition(r,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){if(this.transition.inProgress){return this.transition.settings.interruption===Gm||this._isUpdateDueToCurrentTransition(t)}return!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=this.getControllerState(e),r=this.getControllerState(t).shortestPathFrom(n),i=t.transitionInterpolator,o=i.getDuration?i.getDuration(e,t):t.transitionDuration;if(0===o)return;const s=i.initializeProps(e,r);this.propsInTransition={};const a={duration:o,easing:t.transitionEasing||Hm,interpolator:i,interruption:t.transitionInterruption||$m,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function qm(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class Xm{constructor(e){const{compare:t,extract:n,required:r}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=r}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!$d(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},r={};for(const i of this._propsToExtract)(i in e||i in t)&&(n[i]=e[i],r[i]=t[i]);return this._checkRequiredProps(n),this._checkRequiredProps(r),{start:n,end:r}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];qm(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const Zm=["longitude","latitude","zoom","bearing","pitch"],Km=["longitude","latitude","zoom"];class Ym extends Xm{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Zm,required:Km},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:r,around:i}=this.opts;if(r&&i){const o=r(e),s=r(t),a=o.unproject(i);n.start.around=i,Object.assign(n.end,{around:s.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const r={};for(const i of this._propsToExtract)r[i]=Hd(e[i]||0,t[i]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const i=this.opts.makeViewport({...t,...r});Object.assign(r,i.panByPosition(t.aroundPosition,Hd(e.around,t.around,n)))}return r}}const Jm={transitionDuration:0},Qm=e=>1-(1-e)*(1-e),eg=["wheel"],tg=["panstart","panmove","panend"],ng=["pinchstart","pinchmove","pinchend"],rg=["multipanstart","multipanmove","multipanend"],ig=["dblclick"],og=["keydown"],sg={};class ag{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Wm({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:r}=e;return[r.x-t,r.y-n]}isPointInBounds(e,t){const{width:n,height:r}=this.props;if(t&&t.handled)return!1;const i=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=r;return i&&t&&t.stopPropagation(),i}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:n=!0,dragPan:r=!0,dragRotate:i=!0,doubleClickZoom:o=!0,touchZoom:s=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(eg,c&&n),this.toggleEvents(tg,c),this.toggleEvents(ng,c&&(s||a)),this.toggleEvents(rg,c&&a),this.toggleEvents(ig,c&&o),this.toggleEvents(og,c&&l),this.scrollZoom=n,this.dragPan=r,this.dragRotate=i,this.doubleClickZoom=o,this.touchZoom=s,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={...e.getViewportProps(),...t},i=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),i){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const r=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(r,Jm,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Jm,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),r=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],i=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Qm},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Jm,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),r=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],i=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Qm},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:r=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:i}=e;let o=2/(1+Math.exp(-Math.abs(i*n)));i<0&&0!==o&&(o=1/o);const s=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Jm,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Jm,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),r=[n[0],n[1]+=e.velocityY*t/2],i=this.controllerState.rotate({pos:r});this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Qm},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return sg._startPinchRotation=e.rotation,sg._lastPinchEvent=e,this.updateViewport(n,Jm,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,r=this.getCenter(e);t=t.zoom({pos:r,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:sg._startPinchRotation-n})}return this.updateViewport(t,Jm,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),sg._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=sg;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const r=this.getCenter(e);let i=this.controllerState.rotateEnd();const o=Math.log2(e.scale),s=(o-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,o+s*t/2);i=i.zoom({pos:r,scale:a}).zoomEnd(),this.updateViewport(i,{...this._getTransitionProps({around:r}),transitionDuration:t,transitionEasing:Qm},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return sg._startPinchRotation=null,sg._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:r,rotateSpeedX:i,rotateSpeedY:o}=!0===this.keyboard?{}:this.keyboard,{controllerState:s}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?s.zoomOut(n).zoomOut(n):s.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?s.zoomIn(n).zoomIn(n):s.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=s.rotateLeft(i),l.isRotating=!0):(a=s.moveLeft(r),l.isPanning=!0);break;case"ArrowRight":t?(a=s.rotateRight(i),l.isRotating=!0):(a=s.moveRight(r),l.isPanning=!0);break;case"ArrowUp":t?(a=s.rotateUp(o),l.isRotating=!0):(a=s.moveUp(r),l.isPanning=!0);break;case"ArrowDown":t?(a=s.rotateDown(o),l.isRotating=!0):(a=s.moveDown(r),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new Ym({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:Jm}}class lg{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class cg extends lg{constructor(e){const{width:t,height:n,latitude:r,longitude:i,zoom:o,bearing:s=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:m,startRotatePos:g,startBearing:_,startPitch:y,startZoom:v,normalize:x=!0}=e;qm(Number.isFinite(i)),qm(Number.isFinite(r)),qm(Number.isFinite(o)),super({width:t,height:n,latitude:r,longitude:i,zoom:o,bearing:s,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:f,normalize:x,position:c},{startPanLngLat:p,startZoomLngLat:m,startRotatePos:g,startBearing:_,startPitch:y,startZoom:v}),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:n}=e;const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(r,t);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:n=0,deltaAngleY:r=0}=e;const{startRotatePos:i,startBearing:o,startPitch:s}=this.getState();if(!i||void 0===o||void 0===s)return this;let a;return a=t?this._getNewRotation(t,i,s,o):{bearing:o+n,pitch:s+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:n,scale:r}=e,{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(n)||this._unproject(t)),!o)return this;const{maxZoom:s,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=Gd(l,a,s);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(o,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:r,longitude:i}=n;return Math.abs(r-t.bearing)>180&&(n.bearing=r<0?r+360:r-360),Math.abs(i-t.longitude)>180&&(n.longitude=i<0?i+360:i-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:r}=e;e.zoom=Gd(r,n,t);const{maxPitch:i,minPitch:o,pitch:s}=e;e.pitch=Gd(s,o,i);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:r=0}=e;let{longitude:i,latitude:o,zoom:s,bearing:a=0}=e;(i<-180||i>180)&&(i=Zf(i+180,360)-180),(a<-180||a>180)&&(a=Zf(a+180,360)-180);const l=Yf(n/512);if(s<=l)s=l,o=0;else{const e=n/2/Math.pow(2,s),t=lp([0,e])[1];if(o<t)o=t;else{const t=lp([0,512-e])[1];o>t&&(o=t)}}return{width:t,height:n,longitude:i,latitude:o,zoom:s,pitch:r,bearing:a}}(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,r){const i=e[0]-t[0],o=e[1]-t[1],s=e[1],a=t[1],{width:l,height:c}=this.getViewportProps(),u=i/l;let h=0;o>0?Math.abs(c-a)>5&&(h=o/(a-c)*1.2):o<0&&a>5&&(h=1-s/a),h=Gd(h,-1,1);const{minPitch:d,maxPitch:f}=this.getViewportProps();let p=n;return h>0?p=n+h*(f-n):h<0&&(p=n-h*(d-n)),{pitch:p,bearing:r+180*u}}}class ug extends ag{constructor(){super(...arguments),this.ControllerState=cg,this.transition={transitionDuration:300,transitionInterpolator:new Ym({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e);(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class hg extends zm{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}getViewportType(){return Bm}get ControllerType(){return ug}}hg.displayName="MapView";const dg=hg,fg=[255,255,255],pg=1;let mg=0;class gg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.type="ambient";const{color:t=fg}=e,{intensity:n=pg}=e;this.id=e.id||"ambient-"+mg++,this.color=t,this.intensity=n}}const _g=[255,255,255],yg=1,vg=[0,0,-1];let xg=0;class bg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.type="directional";const{color:t=_g}=e,{intensity:n=yg}=e,{direction:r=vg}=e,{_shadow:i=!1}=e;this.id=e.id||"directional-"+xg++,this.color=t,this.intensity=n,this.type="directional",this.direction=new mf(r).normalize().toArray(),this.shadow=i}getProjectedLight(e){return this}}class wg{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{id:"pass"};const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Sg extends wg{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,i=e.clearColor??(!!r&&[0,0,0,0]),o=!!r&&1,s=!!r&&0,a=e.colorMask??15,l={viewport:[0,0,t,n]};e.colorMask&&(l.colorMask=a),e.scissorRect&&(l.scissorRect=e.scissorRect);const c=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:i,clearDepth:o,clearStencil:s});try{return this._drawLayers(c,e)}finally{c.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:r,viewports:i,views:o,onViewportActive:s,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const l=[];for(const c of i){const i=o&&o[c.id];s?.(c);const a=this._getDrawLayerParams(c,t),u=c.subViewports||[c];for(const o of u){const s=this._drawLayersInViewport(e,{target:n,shaderModuleProps:r,viewport:o,view:i,pass:t.pass,layers:t.layers},a);l.push(s)}}return l}_getDrawLayerParams(e,t){let{layers:n,pass:r,isPicking:i=!1,layerFilter:o,cullRect:s,effects:a,shaderModuleProps:l}=t,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u=[],h=Eg(this._lastRenderIndex+1),d={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:s},f={};for(let p=0;p<n.length;p++){const t=n[p],i=this._shouldDrawLayer(t,d,o,f),s={shouldDrawLayer:i};i&&!c&&(s.shouldDrawLayer=!0,s.layerRenderIndex=h(t,i),s.shaderModuleProps=this._getShaderModuleProps(t,a,r,l),s.layerParameters={...t.context.deck?.props.parameters,...this.getLayerParameters(t,p,e)}),u[p]=s}return u}_drawLayersInViewport(e,t,n){let{layers:r,shaderModuleProps:i,pass:o,target:s,viewport:a,view:l}=t;const c=function(e,t){let{shaderModuleProps:n,target:r,viewport:i}=t;const o=n?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,s]=e.canvasContext.getDrawingBufferSize(),a=r?r.height:s,l=i;return[l.x*o,a-(l.y+l.height)*o,l.width*o,l.height*o]}(this.device,{shaderModuleProps:i,target:s,viewport:a});if(l&&l.props.clear){const e=!0===l.props.clear?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:c,scissorRect:c},clearColor:!!e.color&&[0,0,0,0],clearDepth:!!e.depth&&1}).end()}const u={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let d=0;d<r.length;d++){const t=r[d],i=n[d],{shouldDrawLayer:s}=i;if(s&&t.props.pickable&&u.pickableCount++,t.isComposite&&u.compositeCount++,t.isDrawable&&i.shouldDrawLayer){const{layerRenderIndex:n,shaderModuleProps:r,layerParameters:s}=i;u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,n),r.project&&(r.project.viewport=a),t.context.renderPass=e;try{t._drawLayer({renderPass:e,shaderModuleProps:r,uniforms:{layerIndex:n},parameters:s})}catch(h){t.raiseError(h,`drawing ${t} to ${o}`)}}}return u}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let i=e.parent;for(;i;){if(!i.props.visible||!i.filterSubLayer(t))return!1;t.layer=i,i=i.parent}if(n){const e=t.layer.id;if(e in r||(r[e]=n(t)),!r[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,r){const i=this.device.canvasContext.cssToDeviceRatio(),o=e.internalState?.propsInTransition||e.props,s={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:i,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const a of t)Tg(s,a.getShaderModuleProps?.(e,s));return Tg(s,this.getShaderModuleProps(e,t,s),r)}}function Eg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={},r=(i,o)=>{const s=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in t)&&r(i.parent,!1),l in n){const e=n[l]=n[l]||Eg(t[l],t);c=e(i,o),n[a]=e}else Number.isFinite(s)?(c=s+(t[l]||0),n[a]=null):c=e;return o&&c>=e&&(e=c+1),t[a]=c,c};return r}function Tg(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const i of n)if(i)for(const t in i)e[t]?Object.assign(e[t],i[t]):e[t]=i[t];return e}class Ag extends Sg{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),r=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],i=r.width*n,o=r.height*n;i===t.width&&o===t.height||t.resize({width:i,height:o}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const Cg={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n"};function Pg(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}return!1}function Ig(e){let t,n={};return r=>{for(const i in r)if(!Pg(r[i],n[i])){t=e(r),n=r;break}return t}}const kg=[0,0,0,0],Mg=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Rg=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Og=[0,0,0],Lg=[0,0,0],Dg=Ig(function(e){let{viewport:t,devicePixelRatio:n,coordinateSystem:r,coordinateOrigin:i}=e;const{projectionCenter:o,viewProjectionMatrix:s,originCommon:a,cameraPosCommon:l,shaderCoordinateOrigin:c,geospatialOrigin:u}=function(e,t,n){const{viewMatrixUncentered:r,projectionMatrix:i}=e;let{viewMatrix:o,viewProjectionMatrix:s}=e,a=kg,l=kg,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=Ng(e,t,n);d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=zf([],l,s),o=r||o,s=Ef([],i,o),s=Ef([],s,Mg));return{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(t,r,i),h=t.getDistanceScales(),d=[t.width*n,t.height*n],f=zf([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,p={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:c,commonOrigin:a.slice(0,3),center:o,pseudoMeters:Boolean(t._pseudoMeters),viewportSize:d,devicePixelRatio:n,focalDistance:f,commonUnitsPerMeter:h.unitsPerMeter,commonUnitsPerWorldUnit:h.unitsPerMeter,commonUnitsPerWorldUnit2:Og,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:Rg,cameraPosition:l};if(u){const e=t.getDistanceScales(u);switch(r){case xm.METER_OFFSETS:p.commonUnitsPerWorldUnit=e.unitsPerMeter,p.commonUnitsPerWorldUnit2=e.unitsPerMeter2;break;case xm.LNGLAT:case xm.LNGLAT_OFFSETS:t._pseudoMeters||(p.commonUnitsPerMeter=e.unitsPerMeter),p.commonUnitsPerWorldUnit=e.unitsPerDegree,p.commonUnitsPerWorldUnit2=e.unitsPerDegree2;break;case xm.CARTESIAN:p.commonUnitsPerWorldUnit=[1,1,e.unitsPerMeter[2]],p.commonUnitsPerWorldUnit2=[0,0,e.unitsPerMeter2[2]]}}return p});function Ng(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Lg;n.length<3&&(n=[n[0],n[1],0]);let r,i=n,o=!0;switch(r=t===xm.LNGLAT_OFFSETS||t===xm.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case bm.WEB_MERCATOR:t!==xm.LNGLAT&&t!==xm.CARTESIAN||(r=[0,0,0],o=!1);break;case bm.WEB_MERCATOR_AUTO_OFFSET:t===xm.LNGLAT?i=r:t===xm.CARTESIAN&&(i=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],r=e.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case bm.IDENTITY:i=e.position.map(Math.fround),i[2]=i[2]||0;break;case bm.GLOBE:o=!1,r=null;break;default:o=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:o}}const zg=`${`${Object.keys(xm).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${xm[e]};`).join("")}\n${Object.keys(bm).map(e=>`const PROJECTION_MODE_${e}: i32 = ${bm[e]};`).join("")}\n${Object.keys(wm).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${wm[e]};`).join("")}\n\nconst TILE_SIZE: f32 = 512.0;\nconst PI: f32 = 3.1415926536;\nconst WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);\nconst ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);\nconst EARTH_RADIUS: f32 = 6370972.0; // meters\nconst GLOBE_RADIUS: f32 = 256.0;\n\n// -----------------------------------------------------------------------------\n// Uniform block (converted from GLSL uniform block)\n// -----------------------------------------------------------------------------\nstruct ProjectUniforms {\n  wrapLongitude: i32,\n  coordinateSystem: i32,\n  commonUnitsPerMeter: vec3<f32>,\n  projectionMode: i32,\n  scale: f32,\n  commonUnitsPerWorldUnit: vec3<f32>,\n  commonUnitsPerWorldUnit2: vec3<f32>,\n  center: vec4<f32>,\n  modelMatrix: mat4x4<f32>,\n  viewProjectionMatrix: mat4x4<f32>,\n  viewportSize: vec2<f32>,\n  devicePixelRatio: f32,\n  focalDistance: f32,\n  cameraPosition: vec3<f32>,\n  coordinateOrigin: vec3<f32>,\n  commonOrigin: vec3<f32>,\n  pseudoMeters: i32,\n};\n\n@group(0) @binding(0)\nvar<uniform> project: ProjectUniforms;\n\n// -----------------------------------------------------------------------------\n// Geometry data\n// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,\n// you might supply this via vertex attributes or a uniform. Here we define a\n// uniform struct for demonstration.)\n// -----------------------------------------------------------------------------\n\n// Structure to carry additional geometry data used by deck.gl filters.\nstruct Geometry {\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  position: vec4<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\n// @group(0) @binding(1)\nvar<private> geometry: Geometry;\n`}\n\n// -----------------------------------------------------------------------------\n// Functions\n// -----------------------------------------------------------------------------\n\n// Returns an adjustment factor for commonUnitsPerMeter\nfn _project_size_at_latitude(lat: f32) -> f32 {\n  let y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\n// Overloaded version: scales a value in meters at a given latitude.\nfn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);\n}\n\n// Computes a non-linear scale factor based on geometry.\n// (Note: This function relies on "geometry" being provided.)\nfn project_size() -> f32 {\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n      project.pseudoMeters == 0) {\n    if (geometry.position.w == 0.0) {\n      return _project_size_at_latitude(geometry.worldPosition.y);\n    }\n    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    let y2 = y * y;\n    let y4 = y2 * y2;\n    let y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\n// Overloads to scale offsets (meters to world units)\nfn project_size_float(meters: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * project_size();\n}\n\nfn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {\n  return meters * project.commonUnitsPerMeter.xy * project_size();\n}\n\nfn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {\n  return meters * project.commonUnitsPerMeter * project_size();\n}\n\nfn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {\n  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\n\n// Returns a rotation matrix aligning the z\u2011axis with the given up vector.\nfn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {\n  let uz = normalize(up);\n  let ux = select(\n    vec3<f32>(1.0, 0.0, 0.0),\n    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),\n    abs(uz.z) == 1.0\n  );\n  let uy = cross(uz, ux);\n  return mat3x3<f32>(ux, uy, uz);\n}\n\n// Since WGSL does not support "out" parameters, we return a struct.\nstruct RotationResult {\n  needsRotation: bool,\n  transform: mat3x3<f32>,\n};\n\nfn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    return RotationResult(true, project_get_orientation_matrix(commonPosition));\n  } else {\n    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed\n  };\n}\n\n// Projects a normal vector from the current coordinate system to world space.\nfn project_normal(vector: vec3<f32>) -> vec3<f32> {\n  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);\n  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\n  let rotResult = project_needs_rotation(geometry.position.xyz);\n  if (rotResult.needsRotation) {\n    n = rotResult.transform * n;\n  }\n  return n;\n}\n\n// Applies a scale offset based on y-offset (dy)\nfn project_offset_(offset: vec4<f32>) -> vec4<f32> {\n  let dy: f32 = offset.y;\n  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\n  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n// Projects lng/lat coordinates to a unit tile [0,1]\nfn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {\n  var x = lnglat.x;\n  if (project.wrapLongitude != 0) {\n    x = ((x + 180.0) % 360.0) - 180.0;\n  }\n  let y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2<f32>(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// Projects lng/lat/z coordinates for a globe projection.\nfn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {\n  let lambda = radians(lnglatz.x);\n  let phi = radians(lnglatz.y);\n  let cosPhi = cos(phi);\n  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n  return vec3<f32>(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n// Projects positions (with an optional 64-bit low part) from the input\n// coordinate system to the common space.\nfn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {\n  var position_world = project.modelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug:\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_mercator_(position_world.xy),\n        _project_size_at_latitude_m(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\n        return vec4<f32>(\n          project_mercator_(position_world.xy) - project.commonOrigin.xy,\n          project_size_float(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);\n  }\n\n  return project_offset_(position_world) +\n         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));\n}\n\n// Overloaded versions for different input types.\nfn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {\n  return project_position_vec4_f64(position, ZERO_64_LOW);\n}\n\nfn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nfn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nfn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\n// Transforms a common space position to clip space.\nfn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {\n  return viewProjectionMatrix * position + center;\n}\n\n// Uses the project viewProjectionMatrix and center.\nfn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {\n  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);\n}\n\n// Returns a clip space offset corresponding to a given number of screen pixels.\nfn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {\n  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\n  return offset * project.focalDistance;\n}\n\nfn project_meter_size_to_pixel(meters: f32) -> f32 {\n  return project_size_float(meters) * project.scale;\n}\n\nfn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {\n  if (unit == UNIT_METERS) {\n    return project_meter_size_to_pixel(size);\n  } else if (unit == UNIT_COMMON) {\n    return size * project.scale;\n  }\n  // UNIT_PIXELS: no scaling applied.\n  return size;\n}\n\nfn project_pixel_size_float(pixels: f32) -> f32 {\n  return pixels / project.scale;\n}\n\nfn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {\n  return pixels / project.scale;\n}\n`,Fg=Object.keys(xm).map(e=>`const int COORDINATE_SYSTEM_${e} = ${xm[e]};`).join(""),Bg=Object.keys(bm).map(e=>`const int PROJECTION_MODE_${e} = ${bm[e]};`).join(""),jg=Object.keys(wm).map(e=>`const int UNIT_${e.toUpperCase()} = ${wm[e]};`).join(""),Ug={};const Vg={name:"project",dependencies:[Cg,fu],source:zg,vs:`${Fg}\n${Bg}\n${jg}\nuniform projectUniforms {\nbool wrapLongitude;\nint coordinateSystem;\nvec3 commonUnitsPerMeter;\nint projectionMode;\nfloat scale;\nvec3 commonUnitsPerWorldUnit;\nvec3 commonUnitsPerWorldUnit2;\nvec4 center;\nmat4 modelMatrix;\nmat4 viewProjectionMatrix;\nvec2 viewportSize;\nfloat devicePixelRatio;\nfloat focalDistance;\nvec3 cameraPosition;\nvec3 coordinateOrigin;\nvec3 commonOrigin;\nbool pseudoMeters;\n} project;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject.pseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project.commonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project.commonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project.commonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project.wrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project.modelMatrix * position;\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project.coordinateOrigin;\n}\n}\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project.commonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project.coordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\nreturn offset * project.focalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project.scale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project.scale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project.scale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project.scale;\n}\n`,getUniforms:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ug;return"viewport"in e?function(e){let{viewport:t,devicePixelRatio:n=1,modelMatrix:r=null,coordinateSystem:i=xm.DEFAULT,coordinateOrigin:o=Lg,autoWrapLongitude:s=!1}=e;i===xm.DEFAULT&&(i=t.isGeospatial?xm.LNGLAT:xm.CARTESIAN);const a=Dg({viewport:t,devicePixelRatio:n,coordinateSystem:i,coordinateOrigin:o});return a.wrapLongitude=s,a.modelMatrix=r||Rg,a}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},Gg="\nuniform shadowUniforms {\n  bool drawShadowMap;\n  bool useShadowMap;\n  vec4 color;\n  highp int lightId;\n  float lightCount;\n  mat4 viewProjectionMatrix0;\n  mat4 viewProjectionMatrix1;\n  vec4 projectCenter0;\n  vec4 projectCenter1;\n} shadow;\n",Hg=`\n${Gg}\n\nconst int max_lights = 2;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  mat4 viewProjectionMatrices[max_lights];\n  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;\n  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;\n  vec4 projectCenters[max_lights];\n  projectCenters[0] = shadow.projectCenter0;\n  projectCenters[1] = shadow.projectCenter1;\n\n  if (shadow.drawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);\n  }\n  if (shadow.useShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow.lightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n\n`,$g=`\n${Gg}\n\nconst int max_lights = 2;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow.drawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow.useShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow.lightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow.color.a / shadow.lightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n\n`,Wg=Ig(function(e){let{viewport:t,center:n}=e;return new Hf(t.viewProjectionMatrix).invert().transform(n)}),qg=Ig(function(e){let{viewport:t,shadowMatrices:n}=e;const r=[],i=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,s=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(e=>function(e,t){const[n,r,i]=e,o=_p([n,r,i],t);if(Number.isFinite(i))return o;return[o[0],o[1],0]}(e,i));for(const a of n){const e=a.clone().translate(new mf(t.center).negate()),n=s.map(t=>e.transform(t)),i=(new Hf).ortho({left:Math.min(...n.map(e=>e[0])),right:Math.max(...n.map(e=>e[0])),bottom:Math.min(...n.map(e=>e[1])),top:Math.max(...n.map(e=>e[1])),near:Math.min(...n.map(e=>-e[2])),far:Math.max(...n.map(e=>-e[2]))});r.push(i.multiplyRight(a))}return r}),Xg=[0,0,0,1],Zg=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];const Kg={name:"shadow",dependencies:[Vg],vs:Hg,fs:$g,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(e){const{shadowEnabled:t=!0,project:n}=e;if(!t||!n||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const r=Vg.getUniforms(n),i=Wg({viewport:n.viewport,center:r.center}),o=[],s=qg({shadowMatrices:e.shadowMatrices,viewport:n.viewport}).slice();for(let l=0;l<e.shadowMatrices.length;l++){const e=s[l],t=e.clone().translate(new mf(n.viewport.center).negate());r.coordinateSystem===xm.LNGLAT&&r.projectionMode===bm.WEB_MERCATOR?(s[l]=t,o[l]=i):(s[l]=e.clone().multiplyRight(Zg),o[l]=t.transform(i))}const a={drawShadowMap:Boolean(e.drawToShadowMap),useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||Xg,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let l=0;l<s.length;l++)a[`viewProjectionMatrix${l}`]=s[l],a[`projectCenter${l}`]=o[l];for(let l=0;l<2;l++)a[`shadow_uShadowMap${l}`]=e.shadowMaps&&e.shadowMaps[l]||e.dummyShadowMap;return a},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Yg={color:[255,255,255],intensity:1},Jg=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Qg=[0,0,0,200/255];class e_{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.id="lighting-effect",this.shadowColor=Qg,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(Kg),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender(e){let{layers:t,layerFilter:n,viewports:r,onViewportActive:i,views:o}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let e=0;e<this.shadowPasses.length;e++){this.shadowPasses[e].render({layers:t,layerFilter:n,viewports:r,onViewportActive:i,views:o,shaderModuleProps:{shadow:{shadowLightId:e,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},i=e.props.material;return{shadow:n,lighting:r,phongMaterial:i,gouraudMaterial:i}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Kg))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=(new Hf).lookAt({eye:new mf(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new Ag(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new gg(Yg),this.directionalLights.push(new bg(Jg[0]),new bg(Jg[1])))}}const t_=new e_;class n_{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){const n=t.findIndex(t=>function(e,t){return(e.order??1/0)-(t.order??1/0)}(t,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Rm(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const r of this.effects)t[r.id]=r;const n=[];for(const r of e){const e=t[r.id];let i=r;e&&e!==r?e.setProps?(e.setProps(r.props),i=e):e.cleanup(this._context):e||r.setup(this._context),n.push(i),delete t[r.id]}for(const r in t)t[r].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(e=>e instanceof e_)||this._resolvedEffects.push(t_),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class r_ extends Sg{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const i_={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class o_ extends Sg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:n,views:r,viewports:i,onViewportActive:o,pickingFBO:s,deviceRect:{x:a,y:l,width:c,height:u},cullRect:h,effects:d,pass:f="picking",pickZ:p,shaderModuleProps:m}=e;this.pickZ=p;const g=this._resetColorEncoder(p),_=[a,l,c,u],y=super.render({target:s,layers:t,layerFilter:n,views:r,viewports:i,onViewportActive:o,cullRect:h,effects:d?.filter(e=>e.useInPicking),pass:f,isPicking:!0,shaderModuleProps:m,clearColor:[0,0,0,0],colorMask:15,scissorRect:_});this._colorEncoderState=null;return{decodePickingColor:g&&s_.bind(null,g),stats:y}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const r={...e.props.parameters},{pickable:i,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?r.blend=!1:i&&o.includes("draw")&&(Object.assign(r,i_),r.blend=!0,r.blendColor=function(e,t,n){const{byLayer:r,byAlpha:i}=e;let o,s=r.get(t);s?(s.viewports.push(n),o=s.a):(o=r.size+1,o<=255?(s={a:o,layer:t,viewports:[n]},r.set(t,s),i[o]=s):(Ju.warn("Too many pickable layers, only picking the first 255")(),o=0));return[0,0,0,o/255]}(this._colorEncoderState,e,n)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function s_(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}class a_{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new r_(e),this.pickLayersPass=new o_(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const r=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const i=t.render({...n,target:r});n.effects&&this._postRender(n.effects,n),this.renderCount++,th("deckRenderer.renderLayers",this,i,e)}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();0===e.length&&[0,1].map(t=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[n]}))});for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,r={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const i of e)if(i.postRender){r.target=i.id===this.lastPostProcessEffect?t.target:void 0;const e=i.postRender(r);r.inputBuffer=e,r.swapBuffer=e===n[0]?n[1]:n[0]}}}const l_={pickedColor:null,pickedObjectIndex:-1};function c_(e){let{pickedColors:t,decodePickingColor:n,deviceX:r,deviceY:i,deviceRadius:o,deviceRect:s}=e;const{x:a,y:l,width:c,height:u}=s;let h=o*o,d=-1,f=0;for(let p=0;p<u;p++){const e=p+l-i,n=e*e;if(n>h)f+=4*c;else for(let i=0;i<c;i++){if(t[f+3]-1>=0){const e=i+a-r,t=e*e+n;t<=h&&(h=t,d=f)}f+=4}}if(d>=0){const e=t.slice(d,d+4),r=n(e);if(r){const t=Math.floor(d/4/c),n=d/4-t*c;return{...r,pickedColor:e,pickedX:a+n,pickedY:l+t}}Ju.error("Picked non-existent layer. Is picking buffer corrupt?")()}return l_}function u_(e){let t,{pickInfo:n,viewports:r,pixelRatio:i,x:o,y:s,z:a}=e,l=r[0];if(r.length>1&&(l=function(e,t){for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.containsPixel(t))return r}return e[0]}(n?.pickedViewports||r,{x:o,y:s})),l){const e=[o-l.x,s-l.y];void 0!==a&&(e[2]=a),t=l.unproject(e)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:o,y:s,pixel:[o,s],coordinate:t,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:i}}function h_(e){const{pickInfo:t,lastPickedInfo:n,mode:r,layers:i}=e,{pickedColor:o,pickedLayer:s,pickedObjectIndex:a}=t,l=s?[s]:[];if("hover"===r){const e=n.index,t=n.layerId,r=s?s.props.id:null;if(r!==t||a!==e){if(r!==t){const e=i.find(e=>e.props.id===t);e&&l.unshift(e)}n.layerId=r,n.index=a,n.info=null}}const c=u_(e),u=new Map;return u.set(null,c),l.forEach(e=>{let t={...c};e===s&&(t.color=o,t.index=a,t.picked=!0),t=d_({layer:e,info:t,mode:r});const i=t.layer;e===s&&"hover"===r&&(n.info=t),u.set(i.id,t),"hover"===r&&i.updateAutoHighlight(t)}),u}function d_(e){let{layer:t,info:n,mode:r}=e;for(;t&&n;){const e=n.layer||null;n.sourceLayer=e,n.layer=t,n=t.getPickingInfo({info:n,mode:r,sourceLayer:e}),t=t.parent}return n}class f_{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new o_(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:n,layers:r,viewports:i}=e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info;const s=o&&o.layer&&o.layer.id,a=o&&o.viewport&&o.viewport.id,l=s?r.find(e=>e.id===s):null,c=a&&i.find(e=>e.id===a)||i[0],u=c&&c.unproject([t-c.x,n-c.y]),h={x:t,y:n,viewport:c,coordinate:u,layer:l};return{...o,...h}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:n,viewports:r,x:i,y:o,radius:s=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:h}=e;const d=this.device.canvasContext.cssToDeviceRatio(),f=this._getPickable(t);if(!f||0===r.length)return{result:[],emptyInfo:u_({viewports:r,x:i,y:o,pixelRatio:d})};this._resizeBuffer();const p=this.device.canvasContext.cssToDevicePixels([i,o],!0),m=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],g=Math.round(s*d),{width:_,height:y}=this.pickingFBO,v=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceWidth:_,deviceHeight:y}),x={x:i-s,y:o-s,width:2*s+1,height:2*s+1};let b;const w=[],S=new Set;for(let E=0;E<a;E++){let e,t;if(v){e=c_({...this._drawAndSample({layers:f,views:n,viewports:r,onViewportActive:u,deviceRect:v,cullRect:x,effects:h,pass:`picking:${l}`}),deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceRect:v})}else e={pickedColor:null,pickedObjectIndex:-1};if(e.pickedLayer&&c&&this.depthFBO){const{pickedColors:i}=this._drawAndSample({layers:[e.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:x,effects:h,pass:`picking:${l}:z`},!0);i[3]&&(t=i[0])}e.pickedLayer&&E+1<a&&(S.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),b=h_({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:l,layers:f,viewports:r,x:i,y:o,z:t,pixelRatio:d});for(const n of b.values())n.layer&&w.push(n);if(!e.pickedColor)break}for(const E of S)E.restorePickingColors();return{result:w,emptyInfo:b.get(null)}}_pickVisibleObjects(e){let{layers:t,views:n,viewports:r,x:i,y:o,width:s=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:h}=e;const d=this._getPickable(t);if(!d||0===r.length)return[];this._resizeBuffer();const f=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([i,o],!0),m=p.x,g=p.y+p.height,_=this.device.canvasContext.cssToDevicePixels([i+s,o+a],!0),y=_.x+_.width,v=_.y,x={x:m,y:v,width:y-m,height:g-v},b=function(e){let{pickedColors:t,decodePickingColor:n}=e;const r=new Map;if(t)for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const e=t.slice(i,i+4),o=e.join(",");if(!r.has(o)){const t=n(e);t?r.set(o,{...t,color:e}):Ju.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(r.values())}(this._drawAndSample({layers:d,views:n,viewports:r,onViewportActive:u,deviceRect:x,cullRect:{x:i,y:o,width:s,height:a},effects:h,pass:`picking:${l}`})),w=new Map,S=[],E=Number.isFinite(c);for(let T=0;T<b.length&&!(E&&S.length>=c);T++){const e=b[T];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:f};t=d_({layer:e.pickedLayer,info:t,mode:l});const n=t.layer.id;w.has(n)||w.set(n,new Set);const r=w.get(n),s=t.object??t.index;r.has(s)||(r.add(s),S.push(t))}return S}_drawAndSample(e){let{layers:t,views:n,viewports:r,onViewportActive:i,deviceRect:o,cullRect:s,effects:a,pass:l}=e,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=c?this.depthFBO:this.pickingFBO,h={layers:t,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:o,cullRect:s,effects:a,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(const y of a)y.useInPicking&&(h.preRenderStats[y.id]=y.preRender(h));const{decodePickingColor:d}=this.pickLayersPass.render(h),{x:f,y:p,width:m,height:g}=o,_=new(c?Float32Array:Uint8Array)(m*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:f,sourceY:p,sourceWidth:m,sourceHeight:g,target:_}),{pickedColors:_,decodePickingColor:d}}_getPickingRect(e){let{deviceX:t,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:o}=e;const s=Math.max(0,t-r),a=Math.max(0,n-r),l=Math.min(i,t+r+1)-s,c=Math.min(o,n+r+1)-a;return l<=0||c<=0?null:{x:s,y:a,width:l,height:c}}}const p_={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},m_="top-left",g_="__root";class __{constructor(e){let{deck:t,parentElement:n}=e;this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Rm(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const e=t[n.id];e?e.viewId!==n.viewId||e.placement!==n.placement?(this._remove(e),this._add(n)):n!==e&&(e.setProps(n.props),n=e):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const e=t[n];e&&this._remove(e)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=m_}=e,r=e.onAdd({deck:this.deck,viewId:t});r&&this._getContainer(t,n).append(r),e._element=r}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const n=e||g_;let r=this.containers[n];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",this.parentElement?.append(r),this.containers[n]=r);let i=r.querySelector(`.${t}`);return i||(i=document.createElement("div"),i.className=t,i.style.position="absolute",i.style.zIndex="2",Object.assign(i.style,p_[t]),r.append(i)),i}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const r=this.lastViewports[n]||null,i=n===g_||r,o=this.containers[n];i?(o.style.display="block",o.style.left=`${r?r.x:0}px`,o.style.top=`${r?r.y:0}px`,o.style.width=`${r?r.width:e}px`,o.style.height=`${r?r.height:t}px`):o.style.display="none"}}onRedraw(e){let{viewports:t,layers:n}=e;const r=t.reduce((e,t)=>(e[t.id]=t,e),{});for(const i of this.getWidgets()){const{viewId:e}=i;if(e){const t=r[e];t&&(i.onViewportChange&&i.onViewportChange(t),i.onRedraw?.({viewports:[t],layers:n}))}else{if(i.onViewportChange)for(const e of t)i.onViewportChange(e);i.onRedraw?.({viewports:t,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){for(const n of this.getWidgets()){const{viewId:r}=n;r&&r!==e.viewport?.id||n.onHover?.(e,t)}}onEvent(e,t){const n=Sm[t.type];if(n)for(const r of this.getWidgets()){const{viewId:i}=r;i&&i!==e.viewport?.id||r[n]?.(e,t)}}}const y_={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class v_{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd(e){let{deck:t}=e;const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,y_),this.deck=t,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const r=n(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,t,n){const r=this.element;if(r){if("string"===typeof e)r.innerText=e;else{if(!e)return this.isVisible=!1,void(r.style.display="none");e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className)}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${t}px, ${n}px)`,e&&"object"===typeof e&&"style"in e&&Object.assign(r.style,e.style)}}}const x_=globalThis.loaders?.parseImageNode,b_="undefined"!==typeof Image,w_="undefined"!==typeof ImageBitmap,S_=Boolean(x_),E_=!!Lh||S_;function T_(e){const t=C_(e);if(!t)throw new Error("Not an image");return t}function A_(e){switch(T_(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function C_(e){return"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!==typeof Image&&e instanceof Image?"image":e&&"object"===typeof e&&e.data&&e.width&&e.height?"data":null}const P_=/^data:image\/svg\+xml/,I_=/\.svg((\?|#).*)?$/;function k_(e){return e&&(P_.test(e)||I_.test(e))}function M_(e,t){if(k_(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function R_(e,t,n){const r=function(e,t){if(k_(t)){let t=(new TextDecoder).decode(e);try{"function"===typeof unescape&&"function"===typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return M_(e,t)}(e,n),i=self.URL||self.webkitURL,o="string"!==typeof r&&i.createObjectURL(r);try{return await async function(e,t){const n=new Image;if(n.src=e,t.image&&t.image.decode&&n.decode)return await n.decode(),n;return await new Promise((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(r){t(r)}})}(o||r,t)}finally{o&&i.revokeObjectURL(o)}}const O_={};let L_=!0;async function D_(e,t,n){let r;if(k_(n)){r=await R_(e,t,n)}else r=M_(e,n);const i=t&&t.imagebitmap;return await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e){for(const t in e||O_)return!1;return!0}(t)&&L_||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),L_=!1}return await createImageBitmap(e)}(r,i)}function N_(e){return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=function(e){return[...e].map(e=>e.charCodeAt(0))}(t);for(let i=0;i<r.length;++i)if(r[i]!==e[i+n])return!1;return!0}(e,"ftyp",4)?0===(96&e[8])?null:function(e){switch(function(e,t,n){return String.fromCharCode(...e.slice(t,n))}(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}(e):null}const z_=!1,F_=!0;function B_(e){const t=j_(e);return function(e){const t=j_(e),n=t.byteLength>=24&&2303741511===t.getUint32(0,z_);if(!n)return null;return{mimeType:"image/png",width:t.getUint32(16,z_),height:t.getUint32(20,z_)}}(t)||function(e){const t=j_(e),n=t.byteLength>=3&&65496===t.getUint16(0,z_)&&255===t.getUint8(2);if(!n)return null;const{tableMarkers:r,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let o=2;for(;o+9<t.byteLength;){const e=t.getUint16(o,z_);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(o+5,z_),width:t.getUint16(o+7,z_)};if(!r.has(e))return null;o+=2,o+=t.getUint16(o,z_)}return null}(t)||function(e){const t=j_(e),n=t.byteLength>=10&&1195984440===t.getUint32(0,z_);if(!n)return null;return{mimeType:"image/gif",width:t.getUint16(6,F_),height:t.getUint16(8,F_)}}(t)||function(e){const t=j_(e),n=t.byteLength>=14&&16973===t.getUint16(0,z_)&&t.getUint32(2,F_)===t.byteLength;if(!n)return null;return{mimeType:"image/bmp",width:t.getUint32(18,F_),height:t.getUint32(22,F_)}}(t)||function(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=N_(t);if(!n)return null;return{mimeType:n.mimeType,width:0,height:0}}(t)}function j_(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const U_={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const r=((t=t||{}).image||{}).type||"auto",{url:i}=n||{};let o;switch(function(e){switch(e){case"auto":case"data":return function(){if(w_)return"imagebitmap";if(b_)return"image";if(E_)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return w_||b_||E_;case"imagebitmap":return w_;case"image":return b_;case"data":return E_;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(r)){case"imagebitmap":o=await D_(e,t,i);break;case"image":o=await R_(e,t,i);break;case"data":o=await async function(e){const{mimeType:t}=B_(e)||{},n=globalThis.loaders?.parseImageNode;return mh(n),await n(e,t)}(e);break;default:mh(!1)}return"data"===r&&(o=A_(o)),o},tests:[e=>Boolean(B_(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};const V_={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse};const G_=function(){const e="9.1.14",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Ju.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Ju,_registerLoggers:eh},function(e){const t=Td();e=Array.isArray(e)?e:[e];for(const n of e){const e=_h(n);t.find(t=>e===t)||t.unshift(e)}}([V_,[U_,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}();const H_=new class{stats=(()=>new Map)();getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ah({id:e})),this.stats.get(e)}},$_=new Xu({id:"luma.gl"}),W_={};function q_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";W_[e]=W_[e]||1;return`${e}-${W_[e]++}`}class X_{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=(()=>new Set)();constructor(e,t,n){if(!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const r in e)void 0!==e[r]&&(n[r]=e[r]);return n}(t,n);const r="undefined"!==this.props.id?this.props.id:q_(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag];const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag];const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}}class Z_ extends X_{static defaultProps={...X_.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const n={...t};(t.usage||0)&Z_.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,Z_.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=(()=>new ArrayBuffer(0))();_setDebugData(e,t,n){const r=ArrayBuffer.isView(e)?e.buffer:e,i=Math.min(e?e.byteLength:n,Z_.DEBUG_DATA_MAX_LENGTH);null===r?this.debugData=new ArrayBuffer(i):0===t&&n===r.byteLength?this.debugData=r.slice(0,i):this.debugData=r.slice(t,t+i)}}function K_(e){const t=function(e){const t=J_[e];return t}(Y_[e]),n=e.includes("norm"),r=!n&&!e.startsWith("float"),i=e.startsWith("s");return{dataType:Y_[e],byteLength:t,integer:r,signed:i,normalized:n}}const Y_={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},J_={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Q_="texture-compression-bc",ey="texture-compression-astc",ty="texture-compression-etc2",ny="texture-compression-pvrtc-webgl",ry="texture-compression-atc-webgl",iy="float32-renderable-webgl",oy="float16-renderable-webgl",sy="snorm8-renderable-webgl",ay="norm16-renderable-webgl",ly="snorm16-renderable-webgl",cy="float32-filterable",uy="float16-filterable-webgl";function hy(e){const t=dy[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const dy={r8unorm:{},r8snorm:{render:sy},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:sy},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:oy,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:ay},"r16snorm-webgl":{f:ly},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:sy},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:oy,filter:uy},"rg16unorm-webgl":{render:ay},"rg16snorm-webgl":{render:ly},r32uint:{},r32sint:{},r32float:{render:iy,filter:cy},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:iy},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:ay},"rgb16snorm-webgl":{f:ay},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:cy},rgba16uint:{},rgba16sint:{},rgba16float:{render:oy,filter:uy},"rgba16unorm-webgl":{render:ay},"rgba16snorm-webgl":{render:ly},"rgb32float-webgl":{render:iy,filter:cy},rgba32uint:{},rgba32sint:{},rgba32float:{render:iy,filter:cy},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Q_},"bc1-rgb-unorm-srgb-webgl":{f:Q_},"bc1-rgba-unorm":{f:Q_},"bc1-rgba-unorm-srgb":{f:Q_},"bc2-rgba-unorm":{f:Q_},"bc2-rgba-unorm-srgb":{f:Q_},"bc3-rgba-unorm":{f:Q_},"bc3-rgba-unorm-srgb":{f:Q_},"bc4-r-unorm":{f:Q_},"bc4-r-snorm":{f:Q_},"bc5-rg-unorm":{f:Q_},"bc5-rg-snorm":{f:Q_},"bc6h-rgb-ufloat":{f:Q_},"bc6h-rgb-float":{f:Q_},"bc7-rgba-unorm":{f:Q_},"bc7-rgba-unorm-srgb":{f:Q_},"etc2-rgb8unorm":{f:ty},"etc2-rgb8unorm-srgb":{f:ty},"etc2-rgb8a1unorm":{f:ty},"etc2-rgb8a1unorm-srgb":{f:ty},"etc2-rgba8unorm":{f:ty},"etc2-rgba8unorm-srgb":{f:ty},"eac-r11unorm":{f:ty},"eac-r11snorm":{f:ty},"eac-rg11unorm":{f:ty},"eac-rg11snorm":{f:ty},"astc-4x4-unorm":{f:ey},"astc-4x4-unorm-srgb":{f:ey},"astc-5x4-unorm":{f:ey},"astc-5x4-unorm-srgb":{f:ey},"astc-5x5-unorm":{f:ey},"astc-5x5-unorm-srgb":{f:ey},"astc-6x5-unorm":{f:ey},"astc-6x5-unorm-srgb":{f:ey},"astc-6x6-unorm":{f:ey},"astc-6x6-unorm-srgb":{f:ey},"astc-8x5-unorm":{f:ey},"astc-8x5-unorm-srgb":{f:ey},"astc-8x6-unorm":{f:ey},"astc-8x6-unorm-srgb":{f:ey},"astc-8x8-unorm":{f:ey},"astc-8x8-unorm-srgb":{f:ey},"astc-10x5-unorm":{f:ey},"astc-10x5-unorm-srgb":{f:ey},"astc-10x6-unorm":{f:ey},"astc-10x6-unorm-srgb":{f:ey},"astc-10x8-unorm":{f:ey},"astc-10x8-unorm-srgb":{f:ey},"astc-10x10-unorm":{f:ey},"astc-10x10-unorm-srgb":{f:ey},"astc-12x10-unorm":{f:ey},"astc-12x10-unorm-srgb":{f:ey},"astc-12x12-unorm":{f:ey},"astc-12x12-unorm-srgb":{f:ey},"pvrtc-rgb4unorm-webgl":{f:ny},"pvrtc-rgba4unorm-webgl":{f:ny},"pvrtc-rbg2unorm-webgl":{f:ny},"pvrtc-rgba2unorm-webgl":{f:ny},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:ry},"atc-rgba-unorm-webgl":{f:ry},"atc-rgbai-unorm-webgl":{f:ry}},fy=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],py=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function my(e){return fy.some(t=>e.startsWith(t))}function gy(e){let t=function(e){const t=hy(e),n=t.bytesPerPixel||1,r=t.bitsPerChannel||[8,8,8,8];delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store;const i={...t,format:e,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:n,bitsPerChannel:r,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1};return i}(e);if(my(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=function(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const n=py.exec(e);if(n){const[,r,i,o,s,a]=n,l=K_(`${o}${i}`),c=8*l.byteLength,u=r.length,h=[c,u>=2?c:0,u>=3?c:0,u>=4?c:0];t={format:e,attachment:t.attachment,dataType:l.dataType,components:u,channels:r,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:h,bytesPerPixel:l.byteLength*r.length,packed:t.packed,srgb:t.srgb},"-webgl"===a&&(t.webgl=!0),"-srgb"===s&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}class _y{}class yy{features;disabledFeatures;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class vy{static defaultProps=(()=>({id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>$_.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:$_.get("debug")||void 0,debugShaders:$_.get("debug-shaders")||void 0,debugFramebuffers:Boolean($_.get("debug-framebuffers")),debugWebGL:Boolean($_.get("debug-webgl")),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0}))();get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...vy.defaultProps,...e},this.id=this.props.id||q_(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=(()=>H_)();timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const t=function(e){const t=hy(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},r=gy(e),i=e.startsWith("depth")||e.startsWith("stencil"),o=r?.signed,s=r?.integer,a=r?.webgl;return n.render&&=!o,n.filter&&=!i&&!o&&!s&&!a,n}(e),n=e=>("string"===typeof e?this.features.has(e):e)??!0,r=n(t.create),i={format:e,create:r,render:r&&n(t.render),filter:r&&n(t.filter),blend:r&&n(t.blend),store:r&&n(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(i)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return my(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Z_.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":$_.warn("indices buffer content must be of integer type")()),t}}const xy=Ou()&&"undefined"!==typeof document,by="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class wy{static defaultProps=(()=>({...vy.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}))();static pageLoaded=(()=>function(){if(xy&&"complete"===document.readyState||"undefined"===typeof window)return Promise.resolve();return new Promise(e=>{window.addEventListener("load",()=>e())})}().then(()=>{$_.probe(2,"DOM is loaded")()}))();stats=(()=>H_)();log=(()=>$_)();VERSION="9.1.9";spector;preregisteredAdapters=(()=>new Map)();constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw $_.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),$_.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");$_.error("This version of luma.gl has already been initialized")()}$_.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.getAdapterMap(e);return Array.from(t).map(e=>{let[,t]=e;return t}).filter(e=>e.isSupported?.()).map(e=>e.type)}getBestAvailableAdapter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(wy.defaultProps,e)}async createDevice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e={...wy.defaultProps,...e},e.waitForPageLoad&&await wy.pageLoaded;const t=this.getAdapterMap(e.adapters);let n=e.type||"";"best-available"===n&&(n=this.getBestAvailableAdapter(e.adapters)||n);const r=(this.getAdapterMap(e.adapters)||t).get(n),i=await(r?.create?.(e));if(i)return i;throw new Error(by)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await wy.pageLoaded,null===e.handle&&(n="unknown");const r=t.get(n),i=await(r?.attach?.(null));if(i)return i;throw new Error(by)}enforceWebGL2(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=this.getAdapterMap(t).get("webgl");n||$_.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}getAdapterMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}registerDevices(e){$_.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const e=t.adapter;e&&this.preregisteredAdapters.set(e.type,e)}}}const Sy=new wy;class Ey{}const Ty={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ay=(e,t,n)=>t?e.enable(n):e.disable(n),Cy=(e,t,n)=>e.hint(n,t),Py=(e,t,n)=>e.pixelStorei(n,t),Iy=(e,t,n)=>{const r=36006===n?36009:36008;return e.bindFramebuffer(r,t)},ky=(e,t,n)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];e.bindBuffer(r,t)};function My(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const Ry={3042:Ay,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:Ay,2885:(e,t)=>e.cullFace(t),2929:Ay,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:Ay,35723:Cy,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:Iy,36010:Iy,34964:ky,36662:ky,36663:ky,35053:ky,35055:ky,2886:(e,t)=>e.frontFace(t),33170:Cy,2849:(e,t)=>e.lineWidth(t),32823:Ay,32824:"polygonOffset",10752:"polygonOffset",35977:Ay,32926:Ay,32928:Ay,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ay,3088:(e,t)=>e.scissor(...t),2960:Ay,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:Ay,10754:Ay,12288:Ay,12289:Ay,12290:Ay,12291:Ay,12292:Ay,12293:Ay,12294:Ay,12295:Ay,3333:Py,3317:Py,37440:Py,37441:Py,37443:Py,3330:Py,3332:Py,3331:Py,3314:Py,32878:Py,3316:Py,3315:Py,32877:Py,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"===typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===t?.length?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=My(t)?t:[t,t];const[n,r]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,r)},stencilFunc:(e,t)=>{t=My(t)&&3===t.length?[...t,...t]:t;const[n,r,i,o,s,a]=t;e.stencilFuncSeparate(1028,n,r,i),e.stencilFuncSeparate(1029,o,s,a)},stencilOp:(e,t)=>{t=My(t)&&3===t.length?[...t,...t]:t;const[n,r,i,o,s,a]=t;e.stencilOpSeparate(1028,n,r,i),e.stencilOpSeparate(1029,o,s,a)},viewport:(e,t)=>e.viewport(...t)};function Oy(e,t,n){return void 0!==t[e]?t[e]:n[e]}const Ly={blendEquation:(e,t,n)=>e.blendEquationSeparate(Oy(32777,t,n),Oy(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(Oy(32969,t,n),Oy(32968,t,n),Oy(32971,t,n),Oy(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(Oy(32824,t,n),Oy(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(Oy(32938,t,n),Oy(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,Oy(2962,t,n),Oy(2967,t,n),Oy(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,Oy(34816,t,n),Oy(36003,t,n),Oy(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,Oy(2964,t,n),Oy(2965,t,n),Oy(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,Oy(34817,t,n),Oy(34818,t,n),Oy(34819,t,n))},Dy={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,n)=>e({36007:n}),bindTransformFeedback:(e,t,n)=>e({36389:n}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},bindBuffer:(e,t,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return r?e({[r]:n}):{valueChanged:!0}},blendColor:(e,t,n,r,i)=>e({32773:new Float32Array([t,n,r,i])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,r,i)=>e({32969:t,32968:n,32971:r,32970:i}),clearColor:(e,t,n,r,i)=>e({3106:new Float32Array([t,n,r,i])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,r,i)=>e({3107:[t,n,r,i]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,r,i)=>e({3088:new Int32Array([t,n,r,i])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,r)=>e({2962:t,2967:n,2963:r,34816:t,36003:n,36004:r}),stencilFuncSeparate:(e,t,n,r,i)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:r,[1028===t?2963:36004]:i}),stencilOp:(e,t,n,r)=>e({2964:t,2965:n,2966:r,34817:t,34818:n,34819:r}),stencilOpSeparate:(e,t,n,r,i)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:r,[1028===t?2966:34819]:i}),viewport:(e,t,n,r,i)=>e({2978:[t,n,r,i]})},Ny=(e,t)=>e.isEnabled(t),zy={3042:Ny,2884:Ny,2929:Ny,3024:Ny,32823:Ny,32926:Ny,32928:Ny,3089:Ny,2960:Ny,35977:Ny},Fy=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function By(e,t){if(function(e){for(const t in e)return!1;return!0}(t))return;const n={};for(const i in t){const r=Number(i),o=Ry[i];o&&("string"===typeof o?n[o]=!0:o(e,t[i],r))}const r=e.state&&e.state.cache;if(r)for(const i in n){(0,Ly[i])(e,t,r)}}function jy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ty;if("number"===typeof t){const n=t,r=zy[n];return r?r(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),r={};for(const i of n){const t=zy[i];r[i]=t?t(e,Number(i)):e.getParameter(Number(i))}return r}function Uy(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),r=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&r&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}class Vy{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];By(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?jy(e):Object.assign({},Ty),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const r=Vy.get(e);r.program!==n&&(t(n),r.program=n)}}(e);for(const n in Dy){Hy(e,n,Dy[n])}Gy(e,"getParameter"),Gy(e,"isEnabled")}_updateCache(e){let t,n=!1;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const i in e){const o=e[i],s=this.cache[i];Uy(o,s)||(n=!0,t=s,r&&!(i in r)&&(r[i]=s),this.cache[i]=o)}return{valueChanged:n,oldValue:t}}}function Gy(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||Fy.has(t))return n(t);const r=Vy.get(e);return t in r.cache||(r.cache[t]=n(t)),r.enable?r.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function Hy(e,t,n){if(!e[t])return;const r=e[t].bind(e);e[t]=function(){const t=Vy.get(e);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];const{valueChanged:a,oldValue:l}=n(t._updateCache,...o);return a&&r(...o),l},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function $y(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function Wy(e,t){const n=e.getParameter(7936),r=e.getParameter(7937);$y(e,"WEBGL_debug_renderer_info",t);const i=t.WEBGL_debug_renderer_info,o=e.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936)||n,s=e.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937)||r,a=e.getParameter(7938),l=qy(o,s),c=function(e,t){if(/Metal/i.exec(e)||/Metal/i.exec(t))return"metal";if(/ANGLE/i.exec(e)||/ANGLE/i.exec(t))return"opengl";return"unknown"}(o,s),u=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(qy(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(o,s);return{type:"webgl",gpu:l,gpuType:u,gpuBackend:c,vendor:o,renderer:s,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}function qy(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function Xy(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const Zy="WEBGL_compressed_texture_s3tc",Ky="WEBGL_compressed_texture_s3tc_srgb",Yy="EXT_texture_compression_rgtc",Jy="EXT_texture_compression_bptc",Qy="EXT_texture_norm16",ev="EXT_render_snorm",tv={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[ev],"norm16-renderable-webgl":[Qy],"snorm16-renderable-webgl":[Qy,ev],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Zy,Ky,Yy,Jy],"texture-compression-bc5-webgl":[Yy],"texture-compression-bc7-webgl":[Jy],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]};const nv={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Zy},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Ky},"bc1-rgba-unorm":{gl:33777,x:Zy},"bc1-rgba-unorm-srgb":{gl:35916,x:Ky},"bc2-rgba-unorm":{gl:33778,x:Zy},"bc2-rgba-unorm-srgb":{gl:35918,x:Ky},"bc3-rgba-unorm":{gl:33779,x:Zy},"bc3-rgba-unorm-srgb":{gl:35919,x:Ky},"bc4-r-unorm":{gl:36283,x:Yy},"bc4-r-snorm":{gl:36284,x:Yy},"bc5-rg-unorm":{gl:36285,x:Yy},"bc5-rg-snorm":{gl:36286,x:Yy},"bc6h-rgb-ufloat":{gl:36495,x:Jy},"bc6h-rgb-float":{gl:36494,x:Jy},"bc7-rgba-unorm":{gl:36492,x:Jy},"bc7-rgba-unorm-srgb":{gl:36493,x:Jy},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function rv(e){const t=nv[e],n=function(e){const t=nv[e],n=t?.gl;if(void 0===n)throw new Error(`Unsupported texture format ${e}`);return n}(e),r=gy(e);return{internalFormat:n,format:t?.dataFormat||iv(r.channels,r.integer,r.normalized,n),type:r.dataType?Xy(r.dataType):t?.types?.[0]||5121,compressed:r.compressed||!1}}function iv(e,t,n,r){if(6408===r||6407===r)return r;switch(e){case"r":return t&&!n?36244:6403;case"rg":return t&&!n?33320:33319;case"rgb":return t&&!n?36248:6407;case"rgba":return t&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}const ov={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class sv extends yy{gl;extensions;testedFeatures=(()=>new Set)();constructor(e,t,n){super([],n),this.gl=e,this.extensions=t,$y(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return!this.disabledFeatures?.[e]&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in tv}(e)&&function(e,t,n){return(tv[t]||[]).every(t=>$y(e,t,n))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(e=>"polygon-mode-webgl"!==e);for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(ov),...Object.keys(tv)]}getWebGLFeature(e){const t=ov[e];return"string"===typeof t?Boolean($y(this.gl,t,this.extensions)):Boolean(t)}}class av extends _y{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class lv{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...lv.defaultProps,...e},e=this.props,!Ou())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"===typeof e.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{const t=function(e){const{width:t,height:n}=e,r=document.createElement("canvas");return r.id=q_("lumagl-auto-created-canvas"),r.width=t||1,r.height=n||1,r.style.width=Number.isFinite(t)?`${t}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}(e),n=function(e){if("string"===typeof e){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}if(e)return e;return document.body}(e?.container||null);n.insertBefore(t,n.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(e=>{for(const t of e)t.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){if("undefined"!==typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas)return 1;if(!(e=void 0===e?this.props.useDevicePixels:e)||e<=0)return 1;if(!0===e){return"undefined"!==typeof window&&window.devicePixelRatio||1}return e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.cssToDeviceRatio(),[r,i]=this.getDrawingBufferSize();return function(e,t,n,r,i){const o=e,s=cv(o[0],t,n);let a=uv(o[1],t,r,i),l=cv(o[0]+1,t,n);const c=l===n-1?l:l-1;let u;l=uv(o[1]+1,t,r,i),i?(l=0===l?l:l+1,u=a,a=l):u=l===r-1?l:l-1;return{x:s,y:a,width:Math.max(c-s+1,1),height:Math.max(u-a+1,1)}}(e,n,r,i,t)}setDevicePixelRatio(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,r="height"in t?t.height:this.htmlCanvas.clientHeight;n&&r||($_.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const i=this._canvasSizeInfo;if(i.clientWidth!==n||i.clientHeight!==r||i.devicePixelRatio!==e){let t=e;const i=Math.floor(n*t),o=Math.floor(r*t);this.htmlCanvas.width=i,this.htmlCanvas.height=o;if(this.device.gl){const[s,a]=this.getDrawingBufferSize();s===i&&a===o||(t=Math.min(s/n,a/r),this.htmlCanvas.width=Math.floor(n*t),this.htmlCanvas.height=Math.floor(r*t),$_.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){"lumagl-auto-created-canvas"===this.htmlCanvas?.id&&(this.htmlCanvas.id=e)}}function cv(e,t,n){return Math.min(Math.round(e*t),n-1)}function uv(e,t,n,r){return r?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}class hv extends X_{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps=(()=>({...X_.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}))();get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(super(e,t=hv.normalizeProps(e,t),hv.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,void 0===this.props.width||void 0===this.props.height){const e=hv.getTextureDataSize(this.props.data);this.width=e?.width||1,this.height=e?.height||1}this.props.mipmaps&&void 0===this.props.mipLevels&&(this.props.mipLevels="pyramid"),this.mipLevels="pyramid"===this.props.mipLevels?hv.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return"undefined"!==typeof ImageData&&e instanceof ImageData||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if("undefined"!==typeof ImageData&&e instanceof ImageData||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if("undefined"!==typeof VideoFrame&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e)return null;if(ArrayBuffer.isView(e))return null;if(Array.isArray(e))return hv.getTextureDataSize(e[0]);if(hv.isExternalImage(e))return hv.getExternalImageSize(e);if(e&&"object"===typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){const n={...t},r=e?.props?._resourceDefaults?.texture||{};Object.assign(n,r);const{width:i,height:o}=n;return"number"===typeof i&&(n.width=Math.max(1,Math.ceil(i))),"number"===typeof o&&(n.height=Math.max(1,Math.ceil(o))),n}}class dv extends X_{static defaultProps={...X_.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},dv.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(t=>t.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:n})}resize(e){let t=!e;if(e){const[n,r]=Array.isArray(e)?e:[e.width,e.height];t=t||r!==this.height||n!==this.width,this.width=n,this.height=r}t&&($_.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,t)=>{if("string"===typeof e){const n=this.createColorTexture(e,t);return this.attachResource(n),n.view}return e instanceof hv?e.view:e});const e=this.props.depthStencilAttachment;if(e)if("string"===typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof hv?e.view:e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:hv.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:hv.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const r=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}}class fv extends dv{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const n=null===t.handle;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const e=this.colorAttachments[t];if(e){const n=36064+t;this._attachTextureView(n,e)}}if(this.depthStencilAttachment){const e=function(e){switch(gy(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:r}=t,i=t.props.baseMipLevel,o=t.props.baseArrayLayer;switch(n.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,r.handle,i,o);break;case 34067:const t=function(e){return e<34069?e+34069:e}(o);n.framebufferTexture2D(36160,e,t,r.handle,i);break;case 3553:n.framebufferTexture2D(36160,e,3553,r.handle,i);break;default:throw new Error("Illegal texture type")}n.bindTexture(r.glTarget,null)}}class pv extends lv{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new fv(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);return void this.setDevicePixelRatio(t,e)}}commit(){}}async function mv(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",e),t&&(r.id=t),new Promise((t,i)=>{r.onload=t,r.onerror=t=>i(new Error(`Unable to load script '${e}': ${t}`)),n.appendChild(r)})}let gv=null,_v=!1;const yv={debugSpectorJS:$_.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};var vv;!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"}(vv||(vv={}));function xv(e){return e.luma=e.luma||{},e.luma}function bv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return $_.warn("webgl-debug not loaded")(),e;const n=xv(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...vv,...e});const r=globalThis.WebGLDebugUtils.makeDebugContext(e,Sv.bind(null,t),Ev.bind(null,t));for(const s in vv)s in r||"number"!==typeof vv[s]||(r[s]=vv[s]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.setPrototypeOf(i,r);const o=Object.create(i);return n.realContext=e,n.debugContext=o,o.debug=!0,o}(e,t):function(e){const t=xv(e);return t.realContext?t.realContext:e}(e)}function wv(e,t){t=Array.from(t).map(e=>void 0===e?"undefined":e);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${e}(${n})`}function Sv(e,t,n,r){r=Array.from(r).map(e=>void 0===e?"undefined":e);const i=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${n}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r)})`;$_.error(i)()}function Ev(e,t,n){let r="";$_.level>=1&&(r=wv(t,n),e.traceWebGL&&$_.log(1,r)());for(const i of n)void 0===i&&(r=r||wv(t,n))}const Tv={};function Av(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";Tv[e]=Tv[e]||1;return`${e}-${Tv[e]++}`}class Cv extends Z_{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.device=e,this.gl=this.device.gl;const n="object"===typeof t?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=function(e){if(e&Z_.INDEX)return 34963;if(e&Z_.VERTEX)return 34962;if(e&Z_.UNIFORM)return 35345;return 34962}(this.props.usage),this.glUsage=function(e){if(e&Z_.INDEX)return 35044;if(e&Z_.VERTEX)return 35044;if(e&Z_.UNIFORM)return 35048;return 35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength+t;const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.glUsage),this.gl.bufferSubData(r,t,e),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=36663;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)}async readAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return this.readSyncWebGL(e,t)}readSyncWebGL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;t=t??this.byteLength-e;const n=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function Pv(e,t,n,r){if(r?.inlineSource){const r=function(e,t,n){let r="";for(let i=t-2;i<=t;i++){const o=e[i-1];void 0!==o&&(r+=Iv(o,t,n))}return r}(t,n);return`\n${r}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}const i="error"===e.type?"red":"#8B4000";return r?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function Iv(e,t,n){const r=n?.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return`${function(e,t){let n="";for(let r=e.length;r<t;++r)n+=" ";return n+e}(String(t),4)}: ${r}${n?.html?"<br/>":"\n"}`}class kv extends X_{static defaultProps=(()=>({...X_.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}))();get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){super(e,{id:Mv(t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"}),...t},kv.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===e&&0===t?.length||this._displayShaderLog(t)}_displayShaderLog(e){if("undefined"===typeof document||!document?.createElement)return;const t=Rv(this.source),n=`${this.stage} ${t}`;let r=function(e,t,n){let r="";const i=t.split(/\r?\n/),o=e.slice().sort((e,t)=>e.lineNum-t.lineNum);switch(n?.showSourceCode||"no"){case"all":let t=0;for(let e=1;e<=i.length;e++)for(r+=Iv(i[e-1],e,n);o.length>t&&o[t].lineNum===e;){const e=o[t++];r+=Pv(e,i,e.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const o of e)r+=Pv(o,i,o.lineNum,{inlineSource:"no"!==n?.showSourceCode});return r}}(e,this.source,{showSourceCode:"all",html:!0});const i=this.getTranslatedSource();i&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${i}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`\n<h1>Shader Compilation Error in ${n}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${r}\n</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o);const s=document.getElementsByClassName("luma-compiler-log-error");s[0]?.scrollIntoView(),o.onclick=()=>{const e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}}function Mv(e){return Rv(e.source)||e.id||q_(`unnamed ${e.stage}-shader`)}function Rv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function Ov(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class Lv extends kv{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){const t=e.split(/\r?\n/),n=[];for(const r of t){if(r.length<=1)continue;const e=r.split(":");if(2===e.length){const[t,r]=e;n.push({message:r.trim(),type:Ov(t),lineNum:0,linePos:0});continue}const[t,i,o,...s]=e;let a=parseInt(o,10);isNaN(a)&&(a=0);let l=parseInt(i,10);isNaN(l)&&(l=0),n.push({message:s.join(":").trim(),type:Ov(t),lineNum:a,linePos:l})}return n}(e):[]}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return e?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es\n${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),this.device.props.debug){if(this.device.features.has("compilation-status-async-webgl"))$_.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),$_.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`)}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}class Dv extends X_{static defaultProps={...X_.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t=Dv.normalizeProps(e,t),Dv.defaultProps)}static normalizeProps(e,t){return{...t,...e?.props?._resourceDefaults?.sampler||{}}}}function Nv(e,t){const n=e,{gl:r}=n;if(t.cullMode)switch(t.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029)}if(t.frontFace&&r.frontFace(Uv("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&r.enable(34383),void 0!==t.depthBias&&(r.enable(32823),r.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,r=Uv("provokingVertex",t.provokingVertex,{first:36429,last:36430});e?.provokingVertexWEBGL(r)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,r=Uv("polygonMode",t.polygonMode,{fill:6914,line:6913});e?.polygonModeWEBGL(1028,r),e?.polygonModeWEBGL(1029,r)}t.polygonOffsetLine&&r.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&r.enable(12288),t.clipDistance1&&r.enable(12289),t.clipDistance2&&r.enable(12290),t.clipDistance3&&r.enable(12291),t.clipDistance4&&r.enable(12292),t.clipDistance5&&r.enable(12293),t.clipDistance6&&r.enable(12294),t.clipDistance7&&r.enable(12295)),void 0!==t.depthWriteEnabled&&r.depthMask(function(e,t){return t}(0,t.depthWriteEnabled)),t.depthCompare&&("always"!==t.depthCompare?r.enable(2929):r.disable(2929),r.depthFunc(zv("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;r.stencilMaskSeparate(1028,e),r.stencilMaskSeparate(1029,e)}if(t.stencilReadMask&&$_.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=zv("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,n,0,e),r.stencilFuncSeparate(1029,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=Fv("stencilPassOperation",t.stencilPassOperation),n=Fv("stencilFailOperation",t.stencilFailOperation),i=Fv("stencilDepthFailOperation",t.stencilDepthFailOperation);r.stencilOpSeparate(1028,n,i,e),r.stencilOpSeparate(1029,n,i,e)}switch(t.blend){case!0:r.enable(3042);break;case!1:r.disable(3042)}if(t.blendColorOperation||t.blendAlphaOperation){const e=Bv("blendColorOperation",t.blendColorOperation||"add"),n=Bv("blendAlphaOperation",t.blendAlphaOperation||"add");r.blendEquationSeparate(e,n);const i=jv("blendColorSrcFactor",t.blendColorSrcFactor||"one"),o=jv("blendColorDstFactor",t.blendColorDstFactor||"zero"),s=jv("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=jv("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");r.blendFuncSeparate(i,o,s,a)}}function zv(e,t){return Uv(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Fv(e,t){return Uv(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Bv(e,t){return Uv(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function jv(e,t){return Uv(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Uv(e,t,n){if(!(t in n))throw new Error(function(e,t){return`Illegal parameter ${t} for ${e}`}(e,t));return n[t]}function Vv(e){let t=!0;for(const n in e){t=!1;break}return t}function Gv(e){const t={};return e.addressModeU&&(t[10242]=Hv(e.addressModeU)),e.addressModeV&&(t[10243]=Hv(e.addressModeV)),e.addressModeW&&(t[32882]=Hv(e.addressModeW)),e.magFilter&&(t[10240]=$v(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";if(!t)return $v(e);switch(t){case"none":return $v(e);case"nearest":return"nearest"===e?9984:9986;case"linear":return"nearest"===e?9985:9987}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=zv("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Hv(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function $v(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}class Wv extends Dv{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=Gv(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}class qv extends X_{static defaultProps=(()=>({...X_.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}))();get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,qv.defaultProps)}}class Xv extends qv{device;gl;handle;texture;constructor(e,t){super(e,{...hv.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}function Zv(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function Kv(e,t,n){if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:r=!0}=t,i=Vy.get(e);let o;if(i.push(),By(e,t),r)o=n(e),i.pop();else try{o=n(e)}finally{i.pop()}return o}function Yv(e,t,n,r){const{width:i,height:o}=r,{dimension:s,depth:a=0,mipLevel:l=0}=r,{x:c=0,y:u=0,z:h=0}=r,{glFormat:d,glType:f}=r,p=Qv(r.glTarget,s,a),m=r.flipY?{37440:!0}:{};Kv(e,m,()=>{switch(s){case"2d-array":case"3d":e.bindTexture(p,t),e.texSubImage3D(p,l,c,u,h,i,o,a,d,f,n),e.bindTexture(p,null);break;case"2d":case"cube":e.bindTexture(p,t),e.texSubImage2D(p,l,c,u,i,o,d,f,n),e.bindTexture(p,null);break;default:throw new Error(s)}})}function Jv(e,t,n){const{dimension:r,width:i,height:o,depth:s=0,mipLevel:a=0,byteOffset:l=0}=n,{x:c=0,y:u=0,z:h=0}=n,{glFormat:d,glType:f,compressed:p}=n,m=Qv(n.glTarget,r,s);switch(r){case"2d-array":case"3d":p?e.compressedTexSubImage3D(m,a,c,u,h,i,o,s,d,t,l):e.texSubImage3D(m,a,c,u,h,i,o,s,d,f,t,l);break;case"2d":case"cube":p?e.compressedTexSubImage2D(m,a,c,u,i,o,d,t,l):e.texSubImage2D(m,a,c,u,i,o,d,f,t,l);break;default:throw new Error(r)}}function Qv(e,t,n){return"cube"===t?34069+n:e}function ex(e,t){const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=t||{};let{target:o=null,sourceWidth:s,sourceHeight:a,sourceDepth:l,sourceFormat:c,sourceType:u}=t||{};const{framebuffer:h,deleteFramebuffer:d}=tx(e),{gl:f,handle:p}=h;s||=h.width,a||=h.height;const m=h.colorAttachments[i]?.texture;if(!m)throw new Error(`Invalid framebuffer attachment ${i}`);l=m?.depth||1,c||=m?.glFormat||6408,u||=m?.glType||5121,o=function(e,t,n,r,i){if(e)return e;t||=5121;const o=function(e,t){const{clamped:n=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}(t,{clamped:!1}),s=Zv(n);return new o(r*i*s)}(o,u,c,s,a),u=u||function(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}(o);const g=f.bindFramebuffer(36160,p);return f.readBuffer(36064+i),f.readPixels(n,r,s,a,c,u,o),f.readBuffer(36064),f.bindFramebuffer(36160,g||null),d&&h.destroy(),o}function tx(e){return e instanceof dv?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:nx(e),deleteFramebuffer:!0}}function nx(e,t){const{device:n,width:r,height:i,id:o}=e;return n.createFramebuffer({...t,id:`framebuffer-for-${o}`,width:r,height:i,colorAttachments:[e]})}class rx extends hv{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);const n={...this.props};n.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=function(e){switch(e){case"1d":case"cube-array":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}(this.props.dimension);const r=rv(this.props.format);this.glInternalFormat=r.internalFormat,this.glFormat=r.format,this.glType=r.type,this.compressed=r.compressed,this.mipmaps=Boolean(this.props.mipmaps),this._initialize(n),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:n}=e;if(!t||!n){const r=hv.getTextureDataSize(e.data);t=r?.width||1,n=r?.height||1}if(this.width=t,this.height=n,this.depth=e.depth,this.setSampler(e.sampler),this.view=new Xv(this.device,{...this.props,texture:this}),this.bind(),function(e,t,n){const{dimension:r,width:i,height:o,depth:s=0}=n,{glInternalFormat:a}=n,l=n.glTarget;switch(r){case"2d-array":case"3d":e.texStorage3D(l,t,a,i,o,s);break;default:e.texStorage2D(l,t,a,i,o)}}(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Xv(this.device,{...e,texture:this})}setSampler(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t instanceof Wv?(this.sampler=t,e=t.props):(this.sampler=new Wv(this.device,t),e=t);const n=Gv(e);this._setSamplerParameters(n)}generateMipmap(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||($_.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),e?.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(t){$_.warn(`Error generating mipmap for ${this}: ${t.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=hv.getExternalImageSize(e.image),n={...hv.defaultCopyExternalImageOptions,...t,...e},{image:r,depth:i,mipLevel:o,x:s,y:a,z:l,flipY:c}=n;let{width:u,height:h}=n;const{dimension:d,glTarget:f,glFormat:p,glInternalFormat:m,glType:g}=this;if(u=Math.min(u,this.width-s),h=Math.min(h,this.height-a),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return Yv(this.device.gl,this.handle,r,{dimension:d,mipLevel:o,x:s,y:a,z:l,width:u,height:h,depth:i,glFormat:p,glInternalFormat:m,glType:g,glTarget:f,flipY:c}),{width:n.width,height:n.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.bind();const n=hv.normalizeTextureData(e,this);n.length>1&&!1!==this.props.mipmaps&&$_.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<n.length;r++){const e=n[r];this._setMipLevel(t,r,e)}this.unbind()}setTexture3DData(e){if("3d"!==this.props.dimension)throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),Jv(this.device.gl,e,this),this.unbind())}setTextureCubeData(e){if("cube"!==this.props.dimension)throw new Error(this.id);for(const t of hv.CubeFaces)this.setTextureCubeFaceData(e[t],t)}setTextureArrayData(e){if("2d-array"!==this.props.dimension)throw new Error(this.id);throw new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t){Array.isArray(e)&&e.length>1&&!1!==this.props.mipmaps&&$_.warn(`${this.id} has mipmap and multiple LODs.`)();const n=hv.CubeFaces.indexOf(t);this.setTexture2DData(e,n)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:n,height:r,pixels:i,data:o,format:s=6408,type:a=5121}=e,{gl:l}=this,c=i||o;this.bind(),c instanceof Promise?c.then(n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n}))):this.width||this.height?l.texImage2D(t,0,s,n,r,0,s,a,c):l.texImage2D(t,0,s,s,a,c)}_getImageDataMap(e){for(let t=0;t<hv.CubeFaces.length;++t){const n=hv.CubeFaces[t];e[n]&&(e[34069+t]=e[n],delete e[n])}return e}_setSamplerParameters(e){$_.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),r=n;switch(e){case 33082:case 33083:this.gl.texParameterf(this.glTarget,e,r);break;case 10241:case 10242:case 10243:default:this.gl.texParameteri(this.glTarget,e,r);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,e,r)}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.glTarget;if(hv.isExternalImage(n))Yv(this.device.gl,this.handle,n,{...this,depth:e,mipLevel:t,glTarget:r,flipY:this.props.flipY});else{if(!hv.isTextureLevelData(n))throw new Error("Texture: invalid image data");Jv(this.device.gl,n.data,{...this,depth:e,mipLevel:t,glTarget:r})}}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}class ix extends X_{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps=(()=>({...X_.defaultProps,framebuffer:null,parameters:void 0,clearColor:ix.defaultClearColor,clearColors:void 0,clearDepth:ix.defaultClearDepth,clearStencil:ix.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}))();get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t=ix.normalizeProps(e,t),ix.defaultProps)}static normalizeProps(e,t){const n=e.props._resourceDefaults?.renderPass;return{...n,...t}}}const ox=[1,2,4,8];class sx extends ix{device;glParameters;constructor(e,t){let n;if(super(e,t),this.device=e,!t?.parameters?.viewport)if(t?.framebuffer){const{width:e,height:r}=t.framebuffer;n=[0,0,e,r]}else{const[t,r]=e.getCanvasContext().getDrawingBufferSize();n=[0,0,t,r]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const r=this.props.framebuffer;if(r?.handle)if(this.props.framebuffer){const e=this.props.framebuffer.colorAttachments.map((e,t)=>36064+t);this.device.gl.drawBuffers(e)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=ox.map(t=>Boolean(t&e.colorMask))),this.glParameters=t,By(this.device.gl,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;t?.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;e?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((e,t)=>{e&&this.clearColorBuffer(t,e)}),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&Kv(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0];Kv(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class ax extends X_{static defaultProps={...X_.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,ax.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}function lx(e){return cx.includes(e)}const cx=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],ux={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function hx(e){const t=ux[e];if(!t)throw new Error("uniform");const[n,r,,i]=t;return{format:i,components:r,glType:n}}function dx(e){const t=ux[e];if(!t)throw new Error("attribute");const[,n,,r,i]=t;return{attributeType:r,vertexFormat:i,components:n}}function fx(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],r=e.getProgramParameter(t,35721);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i);if(!r)throw new Error("activeInfo");const{name:o,type:s}=r,a=e.getAttribLocation(t,o);if(a>=0){const{attributeType:e}=dx(s),t=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:a,stepMode:t,type:e})}}return n.sort((e,t)=>e.location-t.location),n}(e,t);const r=function(e,t){const n=(n,r)=>e.getActiveUniformBlockParameter(t,n,r),r=[],i=e.getProgramParameter(t,35382);for(let o=0;o<i;o++){const i={name:e.getActiveUniformBlockName(t,o)||"",location:n(o,35391),byteLength:n(o,35392),vertex:n(o,35396),fragment:n(o,35398),uniformCount:n(o,35394),uniforms:[]},s=n(o,35395)||[],a=e.getActiveUniforms(t,s,35383),l=e.getActiveUniforms(t,s,35384),c=e.getActiveUniforms(t,s,35387),u=e.getActiveUniforms(t,s,35388);for(let n=0;n<i.uniformCount;++n){const r=e.getActiveUniform(t,s[n]);if(!r)throw new Error("activeInfo");i.uniforms.push({name:r.name,format:hx(a[n]).format,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}r.push(i)}return r.sort((e,t)=>e.location-t.location),r}(e,t);for(const a of r){const e=a.uniforms.map(e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:e})}const i=function(e,t){const n=[],r=e.getProgramParameter(t,35718);for(let i=0;i<r;i++){const r=e.getActiveUniform(t,i);if(!r)throw new Error("activeInfo");const{name:o,size:s,type:a}=r,{name:l,isArray:c}=gx(o);let u=e.getUniformLocation(t,l);const h={location:u,name:l,size:s,type:a,isArray:c};if(n.push(h),h.size>1)for(let i=0;i<h.size;i++){const r=`${l}[${i}]`;u=e.getUniformLocation(t,r);const o={...h,name:r,location:u};n.push(o)}}return n}(e,t);let o=0;for(const a of i)if(lx(a.type)){const{viewDimension:e,sampleType:t}=mx(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:o,viewDimension:e,sampleType:t}),a.textureUnit=o,o+=1}i.length&&(n.uniforms=i);const s=function(e,t){const n=[],r=e.getProgramParameter(t,35971);for(let i=0;i<r;i++){const r=e.getTransformFeedbackVarying(t,i);if(!r)throw new Error("activeInfo");const{name:o,type:s,size:a}=r,{glType:l,components:c}=hx(s),u={location:i,name:o,type:l,size:a*c};n.push(u)}return n.sort((e,t)=>e.location-t.location),n}(e,t);return s?.length&&(n.varyings=s),n}const px={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function mx(e){const t=px[e];if(!t)throw new Error("sampler");const[n,r]=t;return{viewDimension:n,sampleType:r}}function gx(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function _x(e,t,n,r){const i=e;let o=r;!0===o&&(o=1),!1===o&&(o=0);const s="number"===typeof o?[o]:o;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!==typeof r)throw new Error("samplers must be set to integers");return e.uniform1i(t,r);case 5126:return e.uniform1fv(t,s);case 35664:return e.uniform2fv(t,s);case 35665:return e.uniform3fv(t,s);case 35666:return e.uniform4fv(t,s);case 5124:case 35670:return e.uniform1iv(t,s);case 35667:case 35671:return e.uniform2iv(t,s);case 35668:case 35672:return e.uniform3iv(t,s);case 35669:case 35673:return e.uniform4iv(t,s);case 5125:return i.uniform1uiv(t,s,1);case 36294:return i.uniform2uiv(t,s,2);case 36295:return i.uniform3uiv(t,s,3);case 36296:return i.uniform4uiv(t,s,4);case 35674:return e.uniformMatrix2fv(t,!1,s);case 35675:return e.uniformMatrix3fv(t,!1,s);case 35676:return e.uniformMatrix4fv(t,!1,s);case 35685:return i.uniformMatrix2x3fv(t,!1,s);case 35686:return i.uniformMatrix2x4fv(t,!1,s);case 35687:return i.uniformMatrix3x2fv(t,!1,s);case 35688:return i.uniformMatrix3x4fv(t,!1,s);case 35689:return i.uniformMatrix4x2fv(t,!1,s);case 35690:return i.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}function yx(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"===typeof e[0])}(e)}function vx(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const r=e[n];!function(e){return null!==yx(e)||"number"===typeof e||"boolean"===typeof e}(r)?t.bindings[n]=r:t.uniforms[n]=r}),t}class xx extends ax{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:r=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,r)),this._linkShaders(),$_.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=fx(this.device.gl,this.handle),$_.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=function(e,t){const n={...e,attributes:e.attributes.map(e=>({...e}))};for(const r of t?.attributes||[]){const e=n.attributes.find(e=>e.name===r.name);e?(e.type=r.type||e.type,e.stepMode=r.stepMode||e.stepMode):$_.warn(`shader layout attribute ${r.name} not present in shader`)}return n}(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[n,r]of Object.entries(e)){const e=this.shaderLayout.bindings.find(e=>e.name===n)||this.shaderLayout.bindings.find(e=>e.name===`${n}Uniforms`);if(!e){const e=this.shaderLayout.bindings.map(e=>`"${e.name}"`).join(", ");t?.disableWarnings||$_.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${e}`,r)();continue}switch(r||$_.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(r instanceof Cv)&&!(r.buffer instanceof Cv))throw new Error("buffer value");break;case"texture":if(!(r instanceof Xv||r instanceof rx||r instanceof fv))throw new Error("texture value");break;case"sampler":$_.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(e.type)}this.bindings[n]=r}}draw(e){const{renderPass:t,parameters:n=this.props.parameters,topology:r=this.props.topology,vertexArray:i,vertexCount:o,instanceCount:s,isInstanced:a=!1,firstVertex:l=0,transformFeedback:c}=e,u=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}(r),h=Boolean(i.indexBuffer),d=i.indexBuffer?.glIndexType;if("success"!==this.linkStatus)return $_.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return $_.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),i.bindBeforeRender(t),c&&c.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const f=t;return function(e,t,n,r){if(Vv(t))return r(e);const i=e;i.pushState();try{return Nv(e,t),By(i.gl,n),r(e)}finally{i.popState()}}(this.device,n,f.glParameters,()=>{h&&a?this.device.gl.drawElementsInstanced(u,o||0,d,l,s||0):h?this.device.gl.drawElements(u,o||0,d,l):a?this.device.gl.drawArraysInstanced(u,l,o||0,s||0):this.device.gl.drawArrays(u,l,o||0),c&&c.end()}),i.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=vx(e);Object.keys(t).forEach(e=>{$_.warn(`Unsupported value "${JSON.stringify(t[e])}" used in setUniforms() for key ${e}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),$_.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),$_.timeEnd(4,`linkProgram for ${this.id}`)(),$_.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}$_.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),$_.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){if("success"!==e){switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader())}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader())}const t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){const{gl:e}=this.device;if(!e.getProgramParameter(this.handle,35714))return this.linkStatus="error","linking";e.validateProgram(this.handle);return e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")}async _waitForLinkComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)this.bindings[t.name]||this.bindings[t.name.replace(/Uniforms$/,"")]||($_.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const r of this.shaderLayout.bindings){const i=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!i)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:o}=r,s=e.getUniformBlockIndex(this.handle,o);if(4294967295===s)throw new Error(`Invalid uniform block name ${o}`);e.uniformBlockBinding(this.handle,n,s),i instanceof Cv?e.bindBufferBase(35345,n,i.handle):e.bindBufferRange(35345,n,i.buffer.handle,i.offset||0,i.size||i.buffer.byteLength-i.offset),n+=1;break;case"texture":if(!(i instanceof Xv||i instanceof rx||i instanceof fv))throw new Error("texture");let a;if(i instanceof Xv)a=i.texture;else if(i instanceof rx)a=i;else{if(!(i instanceof fv&&i.colorAttachments[0]instanceof Xv))throw new Error("No texture");$_.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=i.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.glTarget,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:r,textureUnit:i}=e,o=this.uniforms[t]??i;void 0!==o&&_x(this.device.gl,n,r,o)}}}class bx extends X_{static defaultProps=(()=>({...X_.defaultProps,measureExecutionTime:void 0}))();get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,bx.defaultProps)}}class wx extends X_{static defaultProps={...X_.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,wx.defaultProps)}}class Sx extends wx{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.commands;for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Ex(this.device,t.options);break;case"copy-buffer-to-texture":Tx(this.device,t.options);break;case"copy-texture-to-buffer":Ax(this.device,t.options);break;case"copy-texture-to-texture":Cx(this.device,t.options);break;default:throw new Error(t.name)}}}function Ex(e,t){const n=t.sourceBuffer,r=t.destinationBuffer;e.gl.bindBuffer(36662,n.handle),e.gl.bindBuffer(36663,r.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function Tx(e,t){throw new Error("Not implemented")}function Ax(e,t){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:o=t.sourceTexture.width,height:s=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:d}=t;if("all"!==i)throw new Error("aspect not supported in WebGL");if(0!==r||0!==a||h||d)throw new Error("not implemented");const{framebuffer:f,destroyFramebuffer:p}=Px(n);let m;try{const t=c,n=o||f.width,r=s||f.height,i=rv(f.colorAttachments[0].texture.props.format),a=i.format,h=i.type;e.gl.bindBuffer(35051,t.handle),m=e.gl.bindFramebuffer(36160,f.handle),e.gl.readPixels(l[0],l[1],n,r,a,h,u)}finally{e.gl.bindBuffer(35051,null),void 0!==m&&e.gl.bindFramebuffer(36160,m),p&&f.destroy()}}function Cx(e,t){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=t;let{width:a=t.destinationTexture.width,height:l=t.destinationTexture.height}=t;const{framebuffer:c,destroyFramebuffer:u}=Px(n),[h,d]=i,[f,p,m]=o,g=e.gl.bindFramebuffer(36160,c.handle);let _,y=null;if(!(s instanceof rx))throw new Error("invalid destination");switch(y=s,a=Number.isFinite(a)?a:y.width,l=Number.isFinite(l)?l:y.height,y.bind(0),_=y.glTarget,_){case 3553:case 34067:e.gl.copyTexSubImage2D(_,r,f,p,h,d,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(_,r,f,p,m,h,d,a,l)}y&&y.unbind(),e.gl.bindFramebuffer(36160,g),u&&c.destroy()}function Px(e){if(e instanceof hv){const{width:t,height:n,id:r}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${r}`,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class Ix extends bx{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new Sx(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}const kx={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Mx={f32:4,f16:2,i32:4,u32:4};function Rx(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,r]=e.split("x"),i=n,o=r?parseInt(r):1,s=K_(i),a={type:i,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function Ox(e,t){const n={};for(const r of e.attributes){const i=Lx(e,t,r.name);i&&(n[r.name]=i)}return n}function Lx(e,t,n){const r=function(e,t){const n=e.attributes.find(e=>e.name===t);n||$_.warn(`shader layout attribute "${t}" not present in shader`);return n||null}(e,n),i=function(e,t){Dx(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);if(n)return n;if(n=function(e,t){for(const n of e){let e=n.byteStride;if("number"!==typeof n.byteStride)for(const t of n.attributes||[]){e+=Rx(t.format).byteLength}const r=n.attributes?.find(e=>e.attribute===t);if(r)return{attributeName:r.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:e}}return null}(e,t),n)return n;return $_.warn(`layout for attribute "${t}" not present in buffer layout`),null}(t,n);if(!r)return null;const o=function(e){const[t,n]=kx[e],r="i32"===t||"u32"===t,i="u32"!==t,o=Mx[t]*n,s=function(e,t){let n;switch(e){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?n:`${n}x${t}`}(t,n);return{dataType:t,components:n,defaultVertexFormat:s,byteLength:o,integer:r,signed:i}}(r.type),s=i?.vertexFormat||o.defaultVertexFormat,a=Rx(s);return{attributeName:i?.attributeName||r.name,bufferName:i?.bufferName||r.name,location:r.location,shaderType:r.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:o.integer,stepMode:i?.stepMode||r.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function Dx(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&$_.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}class Nx extends X_{static defaultProps={...X_.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,Nx.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:n,bufferLayout:r}=t.renderPipeline||{};if(!n||!r)throw new Error("VertexArray");this.attributeInfos=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;const r=Ox(e,t),i=new Array(n).fill(null);for(const o of Object.values(r))i[o.location]=o;return i}(n,r,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}let zx;function Fx(e){return(!zx||zx.byteLength<e)&&(zx=new ArrayBuffer(e)),zx}class Bx extends Nx{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return"Chrome"===(t||Ou()?Ru(t)?"Electron":(t||Uu.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node");var t}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(34963===n.glTarget)throw new Error("Use .setIndexBuffer()");const{size:r,type:i,stride:o,offset:s,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),l?this.device.gl.vertexAttribIPointer(e,r,i,o,s):this.device.gl.vertexAttribPointer(e,r,i,a,o,s),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=Xy(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=Bx.isConstantAttributeZeroSupported(this.device);(t||(n||0!==e))&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=function(e){if(Array.isArray(e))return new Float32Array(e);return e}(t),r=n.byteLength*e,i=n.length*e;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),o=o||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue),o){const e=function(e,t){return new e(Fx(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,i);!function(e){const{target:t,source:n,start:r=0,count:i=1}=e,o=n.length,s=i*o;let a=0;for(let l=r;a<o;a++)t[l++]=n[a];for(;a<s;)a<s-a?(t.copyWithin(r+a,r,r+a),a*=2):(t.copyWithin(r+a,r,r+s-a),a=s);e.target}({target:e,source:n,start:0,count:i}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class jx extends X_{static defaultProps=(()=>({...X_.defaultProps,layout:void 0,buffers:{}}))();get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,jx.defaultProps)}}class Ux extends jx{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"point-list";this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":return 1;case"triangle-list":case"triangle-strip":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:r,byteLength:i,byteOffset:o}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=r,void $_.warn(`${this.id} unusedBuffers varying buffer ${e}`)();this.buffers[n]={buffer:r,byteLength:i,byteOffset:o},this.bindOnUse||this._bindBuffer(n,r,o,i)}getBuffer(e){if(Vx(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!==typeof t?(this.gl.bindTransformFeedback(36386,t),this):(this._bound?e=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,e=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),e)}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Cv)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:r=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:r}}_getVaryingIndex(e){if(Vx(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:r}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,r,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const i=t&&t.handle;i&&void 0!==r?this.gl.bindBufferRange(35982,e,i,n,r):this.gl.bindBufferBase(35982,e,i)}}function Vx(e){return"number"===typeof e?Number.isInteger(e):/^\d+$/.test(e)}class Gx extends X_{static defaultProps=(()=>({...X_.defaultProps,type:void 0,count:void 0}))();get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Gx.defaultProps)}}class Hx extends Gx{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,r)=>{const i=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(i)};requestAnimationFrame(i)}),this._pollingPromise}}class $x extends vy{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||Av("webgl-device")});const t=vy._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=t.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new pv(this,t),this.lost=new Promise(e=>{this._resolveContextLost=e});const r={...e.webgl};"premultiplied"===t.alphaMode&&(r.premultipliedAlpha=!0),void 0!==e.powerPreference&&(r.powerPreference=e.powerPreference);const i=this.props._handle||function(e,t,n){let r="";const i={preserveDrawingBuffer:!0,...n};let o=null;if(o||=e.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(r||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),o||n.failIfMajorPerformanceCaveat||(i.failIfMajorPerformanceCaveat=!1,o=e.getContext("webgl2",i),o.luma||={},o.luma.softwareRenderer=!0),o||(o=e.getContext("webgl",{}),o&&(o=null,r||="Your browser only supports WebGL1")),!o)throw r||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:s,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",e=>s(e),!1),e.addEventListener("webglcontextrestored",e=>a(e),!1),o.luma||={},o}(this.canvasContext.canvas,{onContextLost:e=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:e=>console.log("WebGL context restored")},r);if(!i)throw new Error("WebGL context creation failed");if(n=i.device,n){if(e._reuseDevices)return $_.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=i,this.gl=i,this.spectorJS=function(e){if(!(e={...yv,...e}).debugSpectorJS)return null;if(!gv&&globalThis.SPECTOR&&!globalThis.luma?.spector){$_.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;gv=new e,globalThis.luma&&(globalThis.luma.spector=gv)}if(!gv)return null;if(_v||(_v=!0,gv.spyCanvases(),gv?.onCaptureStarted.add(e=>$_.info("Spector capture started:",e)()),gv?.onCapture.add(e=>{$_.info("Spector capture complete:",e)(),gv?.getResultUI(),gv?.resultView.display(),gv?.resultView.addCapture(e)})),e.gl){const t=e.gl,n=t.device;gv?.startCapture(e.gl,500),t.device=n,new Promise(e=>setTimeout(e,2e3)).then(e=>{$_.info("Spector capture stopped after 2 seconds")(),gv?.stopCapture()})}return gv}({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Wy(this.gl,this._extensions),this.limits=new av(this.gl),this.features=new sv(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),!1!==t.autoResize&&this.canvasContext.resize();const o=new Vy(this.gl,{log:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return $_.log(1,...t)()}});o.trackState(this.gl,{copyState:!1});const s=e.debugWebGL||e.debug,a=e.debugWebGL;s&&(this.gl=bv(this.gl,{debugWebGL:s,traceWebGL:a}),$_.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&($_.level=Math.max($_.level,1)))}destroy(){this.props._reuseDevices||this._reused||delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Cv(this,t)}createTexture(e){return new rx(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Wv(this,e)}createShader(e){return new Lv(this,e)}createFramebuffer(e){return new fv(this,e)}createVertexArray(e){return new Bx(this,e)}createTransformFeedback(e){return new Ux(this,e)}createQuerySet(e){return new Hx(this,e)}createRenderPipeline(e){return new xx(this,e)}beginRenderPass(e){return new sx(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(){return new Ix(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return ex(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:s=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=tx(e);a=a||u.width,l=l||u.height;const d=u;c=c||5121;let f=n;if(!f){const e=s+a*l*Zv(o)*function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}(c);f=d.device.createBuffer({byteLength:e})}const p=e.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[r,i],destinationBuffer:f,byteOffset:s}),p.destroy(),h&&u.destroy(),f}(e,t)}setParametersWebGL(e){By(this.gl,e)}getParametersWebGL(e){return jy(this.gl,e)}withParametersWebGL(e,t){return Kv(this.gl,e,t)}resetWebGL(){$_.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),By(this.gl,Ty)}_getDeviceSpecificTextureFormatCapabilities(e){return function(e,t,n){let r=t.create;const i=nv[t.format];return void 0===i?.gl&&(r=!1),i?.x&&(r=r&&Boolean($y(e,i.x,n))),{format:t.format,create:r&&t.create,render:r&&t.render,filter:r&&t.filter,blend:r&&t.blend,store:r&&t.store}}(this.gl,e,this._extensions)}loseDevice(){let e=!1;const t=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return t&&(e=!0,t.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Vy.get(this.gl).push()}popState(){Vy.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const n=Number(e);for(const r in this.gl)if(this.gl[r]===n)return`GL.${r}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((e,n)=>{let[r,i]=n;return e[`${r}:${this.getGLKey(r,t)}`]=`${i}:${this.getGLKey(i,t)}`,e},{})}_constants;setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const r=this._constants[e];switch(r&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(r,t)&&$_.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return $y(this.gl,e,this._extensions),this._extensions}}const Wx={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},qx=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Xx=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),Zx=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(){return e.drawArraysInstanced(...arguments)},drawElementsInstancedANGLE(){return e.drawElementsInstanced(...arguments)},vertexAttribDivisorANGLE(){return e.vertexAttribDivisor(...arguments)}});function Kx(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){const e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");const t={...Wx,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:qx(e),OES_vertex_array_object:Xx(e),ANGLE_instanced_arrays:Zx(e)},n=e.getExtension;e.getExtension=function(r){const i=n.call(e,r);return i||(r in t?t[r]:null)};const r=e.getSupportedExtensions;e.getSupportedExtensions=function(){const n=r.apply(e)||[];return n?.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}const Yx=new class extends Ey{type="webgl";constructor(){super(),vy.defaultProps={...vy.defaultProps,...yv},$x.adapter=this}isSupported(){return"undefined"!==typeof WebGL2RenderingContext}enforceWebGL2(e){Kx(e)}async attach(e){if(e instanceof $x)return e;if(e?.device instanceof vy)return e.device;if(!function(e){if("undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return!0;return Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");return new $x({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$_.groupCollapsed(1,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push(async function(){Ou()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await mv("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.debugSpectorJS&&t.push(async function(e){if(!globalThis.SPECTOR)try{await mv(e.debugSpectorJSUrl||yv.debugSpectorJSUrl)}catch(t){$_.warn(String(t))}}(e));const n=await Promise.allSettled(t);for(const o of n)"rejected"===o.status&&$_.error(`Failed to initialize debug libraries ${o.reason}`)();const r=new $x(e),i=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return $_.probe(1,i)(),$_.table(1,r.info)(),$_.groupEnd(1)(),r}};let Jx=0;const Qx={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:Sy.stats.get("animation-loop-"+Jx++),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class eb{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...Qx,...e},!(e=this.props).device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new ah({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){this.props.onError(e),this._error=Error();const t=this.device?.canvasContext?.canvas;if(t instanceof HTMLCanvasElement){const t=document.createElement("h1");t.innerHTML=e.message,t.style.position="absolute",t.style.top="20%",t.style.left="10px",t.style.color="black",t.style.backgroundColor="red",document.body.appendChild(t)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!==typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device?.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let n=1;const r=this.device?.canvasContext?.canvas;return r&&r.clientHeight?n=r.clientWidth/r.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}function tb(){}const nb={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:tb,onWebGLInitialized:tb,onResize:tb,onViewStateChange:tb,onInteractionStateChange:tb,onBeforeRender:tb,onAfterRender:tb,onLoad:tb,onError:e=>Ju.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:e=>{let{isDragging:t}=e;return t?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class rb{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ah({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=Sm[e.type],n=e.offsetCenter;if(!t||!n||!this.layerManager)return;const r=this.layerManager.getLayers(),i=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:r,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:o}=i,s=o&&(o[t]||o.props[t]),a=this.props[t];let l=!1;s&&(l=s.call(o,i,e)),l||(a?.(i,e),this.widgetManager.onEvent(i,e))},this._onPointerDown=e=>{if("webgpu"===this.device?.type)return;const t=e.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo},this.props={...nb,...e},(e=this.props).viewState&&e.initialViewState&&Ju.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Ju.error("WebGL1 context not supported.")(),t=Yx.attach(e.gl)),t||(t=Sy.createDevice({type:"best-available",_reuseDevices:!0,adapters:[Yx],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Bd.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ju.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ju.removed("onLayerClick","onClick")(),e.initialViewState&&!Rm(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),i=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||n||r||i||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return qm(this.viewManager),this.viewManager.views}getViewports(e){return qm(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,n){qm(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(t).timeStart();const i=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return r.get(t).timeEnd(),i}_createCanvas(e){let t=e.canvas;if("string"===typeof t&&(t=document.getElementById(t),qm(t)),!t){t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay";(e.parent||document.body).appendChild(t)}return Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:n}=e;if(t||0===t){const e=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=e}if(n||0===n){const t=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;t===this.width&&n===this.height||(this.width=t,this.height=n,this.viewManager?.setProps({width:t,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:r,useDevicePixels:i}=t;return new eb({device:e,useDevicePixels:i,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new dg({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if("webgpu"===this.device?.type)return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let r=n,i=!1;for(const o of t)r=o,i=o.layer?.onHover(o,e.event)||i;i||(this.props.onHover?.(r,e.event),this.widgetManager.onHover(r,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);const t=new kc;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new vm(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Em).map(e=>{const[t,n,r,i]=Em[e],o=this.props.eventRecognizerOptions?.[e];return{recognizer:new t({...n,...o,event:e}),recognizeWith:r,requestFailure:i}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in Sm)this.eventManager.on(r,this._onEvent);this.viewManager=new Om({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new Mm(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new n_({deck:this,device:this.device}),this.deckRenderer=new a_(this.device),this.deckPicker=new f_(this.device),this.widgetManager=new __({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new v_),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:n,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:r});const i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(i),"screen"===i.pass&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:n,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ju.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),"webgpu"!==this.device?.type&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Sy.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}rb.defaultProps=nb,rb.VERSION=G_;const ib=rb,ob="undefined"!==typeof window?i.useLayoutEffect:i.useEffect;function sb(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}function ab(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function lb(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function cb(e,t,n){if(!t||t>4)throw new Error(`size ${t}`);const r=t;let i=ab(e);if("uint8"===i&&n&&1===r)return"unorm8-webgl";if("uint8"===i&&n&&3===r)return"unorm8x3-webgl";if("uint8"===i||"sint8"===i){if(1===r||3===r)throw new Error(`size: ${t}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if("uint16"===i||"sint16"===i){if(1===r||3===r)throw new Error(`size: ${t}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return 1===r?i:`${i}x${r}`}const ub=ab;function hb(e,t,n){const r="webgpu"===n&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${r}x${t.size}`:t.type,byteOffset:t.offset||0}}function db(e){return e.stride||e.size*e.bytesPerElement}function fb(e,t){t.offset&&Ju.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=db(e),r=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:r,stride:n}}class pb{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const r=t.logicalType||t.type,i="float64"===r;let o,{defaultValue:s}=t;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0),o=i?"float32":!r&&t.isIndexed?"uint32":r||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return lb(e)}}(r||o);this.doublePrecision=i,i&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:s,logicalType:r,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*db(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Bd.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n={};if(this.state.constant){const r=this.value;if(t){const i=fb(this.getAccessor(),t),o=i.offset/r.BYTES_PER_ELEMENT,s=i.size||this.size;n[e]=r.subarray(o,o+s)}else n[e]=r}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getAccessor(),r=[],i={name:this.id,byteStride:db(n),attributes:r};if(this.doublePrecision){const i=function(e,t){const n=fb(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(n,t||{});r.push(hb(e,{...n,...i.high},this.device.type),hb(`${e}64Low`,{...n,...i.low},this.device.type))}else if(t){const i=fb(n,t);r.push(hb(e,{...n,...i},this.device.type))}else r.push(hb(e,n,this.device.type));return i}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:r}=this,i=n*r;if(t&&i&&t.length>=i){const n=new Array(r).fill(1/0),o=new Array(r).fill(-1/0);for(let e=0;e<i;)for(let i=0;i<r;i++){const r=t[e++];r<n[i]&&(n[i]=r),r>o[i]&&(o[i]=r)}e=[n,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;n=ArrayBuffer.isView(e)?{value:e}:e instanceof Z_?{buffer:e}:e;const r={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type){if(this.doublePrecision&&n.value instanceof Float64Array)r.type="float32";else{const e=ub(n.value);r.type=r.normalized?e.replace("int","norm"):e}}r.bytesPerElement=n.value.BYTES_PER_ELEMENT,r.stride=db(r)}if(t.bounds=null,n.constant){let e=n.value;e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e));if(!(!t.constant||!this._areValuesEqual(e,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(n.buffer){const e=n.buffer;t.externalBuffer=e,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let e=n.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:i}=this;const o=db(r),s=(r.vertexOffset||0)*o;if(this.doublePrecision&&e instanceof Float64Array&&(e=xf(e,r)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const a=e.byteLength+s+2*o;(!i||i.byteLength<a)&&(i=this._createBuffer(a)),i.write(e,s)}return this.setAccessor(r),!0}updateSubBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?xf(t,{size:this.size,startIndex:n,endIndex:r}):t.subarray(n,r),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{state:n}=this,r=n.allocatedValue,i=Bd.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=i;const{byteOffset:o}=this;let{buffer:s}=this;return(!s||s.byteLength<i.byteLength+o)&&(s=this._createBuffer(i.byteLength+o),t&&r&&s.write(r instanceof Float64Array?xf(r,this):r,o)),n.allocatedValue=i,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=t.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof n||!this.settings.normalized||"normalized"in e||Ju.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:r,size:i}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let e=i;for(;--e>=0;)t[n+e]=r[e];return t}switch(i){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=i;for(;--o>=0;)t[n+o]=Number.isFinite(e[o])?e[o]:r[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?Z_.INDEX:Z_.VERTEX)|Z_.COPY_DST,indexType:t?n:void 0,byteLength:e}),this._buffer}}const mb=[],gb=[];function _b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,r=mb;const i={index:-1,data:e,target:[]};return e?"function"===typeof e[Symbol.iterator]?r=e:e.length>0&&(gb.length=e.length,r=gb):r=mb,(t>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,n),i.index=t-1),{iterable:r,objectInfo:i}}function yb(e){return e&&e[Symbol.asyncIterator]}function vb(e,t){const{size:n,stride:r,offset:i,startIndices:o,nested:s}=t,a=e.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((e.length-c)/l);return(t,r)=>{let{index:i,target:a}=r;if(!o){const t=i*l+c;for(let r=0;r<n;r++)a[r]=e[t+r];return a}const h=o[i],d=o[i+1]||u;let f;if(s){f=new Array(d-h);for(let t=h;t<d;t++){const r=t*l+c;a=new Array(n);for(let t=0;t<n;t++)a[t]=e[r+t];f[t-h]=a}}else if(l===n)f=e.subarray(h*n+c,d*n+c);else{f=new e.constructor((d-h)*n);let t=0;for(let r=h;r<d;r++){const i=r*l+c;for(let r=0;r<n;r++)f[t++]=e[i+r]}}return f}}const xb=[],bb=[[0,1/0]];const wb={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Sb(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return{...wb[n],...t,...e,type:n}}class Eb extends pb{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:bb}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,n,r;(t=this.state).layoutChanged||(t.layoutChanged=(n=e,r=this.getAccessor(),!(n.type===r.type&&n.size===r.size&&db(n)===db(r)&&(n.offset||0)===(r.offset||0)))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!==typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,r=Array.isArray(t)?e[t.find(t=>e[t])]:e[t];return Sb(r,n)}setNeedsUpdate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===bb)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],r=e.length;let i=0;for(let o=0;o<r;o++){const r=e[o];r[1]<t[0]?(n.push(r),i=o+1):r[0]>t[1]?n.push(r):t=[Math.min(r[0],t[0]),Math.max(r[1],t[1])]}return n.splice(i,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=bb}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=xb}setNeedsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate(e,t.updateRanges!==bb),!0))}updateBuffer(e){let{numInstances:t,data:n,props:r,context:i}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:a}}=this;let l=!0;if(s){for(const[e,a]of o)s.call(i,this,{data:n,startRow:e,endRow:a,props:r,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[e,n]of o){const r=Number.isFinite(e)?this.getVertexOffset(e):0,i=Number.isFinite(n)?this.getVertexOffset(n):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:r,endOffset:i})}else;this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){if("webgpu"===this.device.type||void 0===e||"function"===typeof e)return!1;return this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{state:n,settings:r}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;n.binaryValue=e,this.setNeedsRedraw();if(r.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const i=e;qm(ArrayBuffer.isView(i.value),`invalid ${r.accessor}`);const o=Boolean(i.size)&&i.size!==this.size;return n.binaryAccessor=vb(i.value,{size:i.size||this.size,stride:i.stride,offset:i.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:r}=this.settings;if(n.stepMode="dynamic"===r?e?e.isInstanced?"instance":"vertex":"instance":r??"vertex",!t)return n;for(const i in t){const e=super._getBufferLayout(i,t[i]);n.attributes.push(...e.attributes)}return n}_autoUpdater(e,t){let{data:n,startRow:r,endRow:i,props:o,numInstances:s}=t;if(e.constant&&"webgpu"!==this.context.device.type)return;const{settings:a,state:l,value:c,size:u,startIndices:h}=e,{accessor:d,transform:f}=a;let p=l.binaryAccessor||("function"===typeof d?d:o[d]);"function"!==typeof p&&(p=()=>p),qm("function"===typeof p,`accessor "${d}" is not a function`);let m=e.getVertexOffset(r);const{iterable:g,objectInfo:_}=_b(n,r,i);for(const y of g){_.index++;let t=p(y,_);if(f&&(t=f.call(this,t)),h){const n=(_.index<h.length-1?h[_.index+1]:s)-h[_.index];if(t&&Array.isArray(t[0])){let n=m;for(const r of t)e._normalizeValue(r,c,n),n+=u}else t&&t.length>u?c.set(t,m):(e._normalizeValue(t,_.target,0),ih({target:c,source:_.target,start:m,count:n}));m+=n*u}else e._normalizeValue(t,c,m),m+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||"function"===typeof e.update))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Tb(e){const{input:t,inputChannels:n,output:r}=e||{};if(!t)return"#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";if(!n)throw new Error("inputChannels");return`#version 300 es\nin ${function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(n)} ${t};\nout vec4 ${r};\nvoid main() {\n  ${r} = ${function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,n)};\n}`}class Ab{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const r of t){const e=n.findIndex(e=>e.name===r.name);e<0?n.push(r):n[e]=r}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(t=>t.name===e);return-1===t&&$_.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function Cb(e){return Array.isArray(e)?0===e.length||"number"===typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class Pb{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(t=>"uniform"===t.type&&t.name===e?.name);if(!t)throw new Error(e?.name);const n=t;for(const e of n.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t){if(e!==t)return!1;const n=e,r=t;if(!Cb(n))return!1;if(Cb(r)&&n.length===r.length)for(let i=0;i<n.length;++i)if(r[i]!==n[i])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){return Cb(e)?e.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}const Ib={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function kb(e){return Ib[e]}function Mb(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}class Rb{layout={};byteLength;constructor(e){let t=0;for(const[r,i]of Object.entries(e)){const e=kb(i),{type:n,components:o}=e;t=Mb(t,o);const s=t;t+=o,this.layout[r]={type:n,size:o,offset:s}}t+=(4-t%4)%4;const n=4*t;this.byteLength=Math.max(n,1024)}getData(e){const t=Fx(Math.max(this.byteLength,1024)),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[r,i]of Object.entries(e)){const e=this.layout[r];if(!e){$_.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:t,size:o,offset:s}=e,a=n[t];if(1===o){if("number"!==typeof i&&"boolean"!==typeof i){$_.warn(`Supplied value for single component uniform ${r} is not a number: ${i}`)();continue}a[s]=Number(i)}else{if(!Cb(i)){$_.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${i}`)();continue}a.set(i,s)}}return new Uint8Array(t)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class Ob{uniformBlocks=(()=>new Map)();uniformBufferLayouts=(()=>new Map)();uniformBuffers=(()=>new Map)();constructor(e){for(const[t,n]of Object.entries(e)){const e=t,r=new Rb(n.uniformTypes||{});this.uniformBufferLayouts.set(e,r);const i=new Pb({name:t});i.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,i)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Z_.UNIFORM|Z_.COPY_DST,byteLength:r}),o=this.getUniformBufferData(t);return i.write(o),i}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:Z_.UNIFORM|Z_.COPY_DST,byteLength:n});this.uniformBuffers.set(t,r)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||=n}return e&&$_.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),r=!1;if(n&&t?.needsRedraw){r||=t.needsRedraw;const i=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(i);const o=this.uniformBlocks.get(e)?.getAllUniforms();$_.log(4,`Writing to uniform buffer ${String(e)}`,i,o)()}return r}}class Lb{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Db{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Nb extends Lb{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class zb extends Lb{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Fb extends Lb{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Bb extends Lb{constructor(e,t,n,r){super(e,n),this.format=t,this.access=r}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}var jb;(e=>{e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(jb||(jb={}));class Ub{constructor(e,t,n,r,i,o,s){this.name=e,this.type=t,this.group=n,this.binding=r,this.attributes=i,this.resourceType=o,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Vb{constructor(e,t){this.name=e,this.type=t}}class Gb{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r,this.interpolation=null}}class Hb{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r}}class $b{constructor(e,t,n,r){this.name=e,this.type=t,this.attributes=n,this.id=r}}class Wb{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class qb{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class Xb{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function Zb(e){var t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0==n?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==n?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))}const Kb=new Float32Array(1),Yb=new Int32Array(Kb.buffer),Jb=new Uint16Array(1);function Qb(e){Kb[0]=e;const t=Yb[0],n=t>>31&1;let r=t>>23&255,i=8388607&t;if(255===r)return Jb[0]=n<<15|31744|(0!==i?512:0),Jb[0];if(0===r){if(0===i)return Jb[0]=n<<15,Jb[0];i|=8388608;let e=113;for(;!(8388608&i);)i<<=1,e--;return r=127-e,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),Jb[0]=n<<15|r<<10|i>>13,Jb[0]):(Jb[0]=n<<15,Jb[0])}return r=r-127+15,r>=31?(Jb[0]=n<<15|31744,Jb[0]):r<=0?r<-10?(Jb[0]=n<<15,Jb[0]):(i=(8388608|i)>>1-r,Jb[0]=n<<15|i>>13,Jb[0]):(i>>=13,Jb[0]=n<<15|r<<10|i,Jb[0])}const ew=new Uint32Array(1),tw=new Float32Array(ew.buffer,0,1);function nw(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return ew[0]=t,tw[0]}function rw(e,t,n,r){const i=[0,0,0,0];for(let o=0;o<r;++o)switch(n){case"8unorm":i[o]=e[t]/255,t++;break;case"8snorm":i[o]=e[t]/255*2-1,t++;break;case"8uint":i[o]=e[t],t++;break;case"8sint":i[o]=e[t]-127,t++;break;case"16uint":i[o]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":i[o]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":i[o]=Zb(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":i[o]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":i[o]=new Float32Array(e.buffer,t,1)[0],t+=4}return i}function iw(e,t,n,r,i){for(let o=0;o<r;++o)switch(n){case"8unorm":e[t]=255*i[o],t++;break;case"8snorm":e[t]=.5*(i[o]+1)*255,t++;break;case"8uint":e[t]=i[o],t++;break;case"8sint":e[t]=i[o]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=i[o],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=i[o],t+=2;break;case"16float":{const n=Qb(i[o]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=i[o],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=i[o],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=i[o],t+=4}return i}const ow={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class sw{constructor(){this.id=sw._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(aw.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(lw.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}sw._id=0;class aw extends sw{}aw.instance=new aw;class lw extends sw{}lw.instance=new lw;const cw=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class uw extends sw{constructor(){super()}}class hw extends uw{constructor(e,t,n,r,i,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=r,this.startLine=i,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class dw extends uw{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class fw extends uw{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class pw extends uw{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class mw extends uw{constructor(e,t,n,r){super(),this.init=e,this.condition=t,this.increment=n,this.body=r}get astNodeType(){return"for"}search(e){var t,n,r;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(r=this.increment)||void 0===r||r.search(e),this.searchBlock(this.body,e)}}class gw extends uw{constructor(e,t,n,r,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=i}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class _w extends uw{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class yw extends uw{constructor(e,t,n,r,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=i}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class vw extends uw{constructor(e,t,n,r,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=i}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var xw,bw,ww,Sw;(e=>{e.increment="++",e.decrement="--"})(xw||(xw={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})(xw||(xw={}));class Ew extends uw{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(bw||(bw={})),(e=>{e.parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t}})(bw||(bw={}));class Tw extends uw{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Aw extends uw{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return cw.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class Cw extends uw{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null===(t=this.continuing)||void 0===t||t.search(e)}}class Pw extends uw{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class Iw extends uw{constructor(e,t,n,r){super(),this.condition=e,this.body=t,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class kw extends uw{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class Mw extends uw{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Rw extends uw{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Ow extends uw{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Lw extends uw{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class Dw extends uw{constructor(){super()}get astNodeType(){return"discard"}}class Nw extends uw{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class zw extends uw{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Fw extends uw{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const r=Fw._priority.get(t.name);Fw._priority.get(e[n].name)<r&&(t=e[n])}return"x32"===t.name?Fw.i32:t}getTypeName(){return this.name}}Fw.x32=new Fw("x32"),Fw.f32=new Fw("f32"),Fw.i32=new Fw("i32"),Fw.u32=new Fw("u32"),Fw.f16=new Fw("f16"),Fw.bool=new Fw("bool"),Fw.void=new Fw("void"),Fw._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Bw extends Fw{constructor(e){super(e)}}class jw extends Fw{constructor(e,t,n,r){super(e),this.members=t,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class Uw extends Fw{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}Uw.vec2f=new Uw("vec2",Fw.f32,null),Uw.vec3f=new Uw("vec3",Fw.f32,null),Uw.vec4f=new Uw("vec4",Fw.f32,null),Uw.vec2i=new Uw("vec2",Fw.i32,null),Uw.vec3i=new Uw("vec3",Fw.i32,null),Uw.vec4i=new Uw("vec4",Fw.i32,null),Uw.vec2u=new Uw("vec2",Fw.u32,null),Uw.vec3u=new Uw("vec3",Fw.u32,null),Uw.vec4u=new Uw("vec4",Fw.u32,null),Uw.vec2h=new Uw("vec2",Fw.f16,null),Uw.vec3h=new Uw("vec3",Fw.f16,null),Uw.vec4h=new Uw("vec4",Fw.f16,null),Uw.vec2b=new Uw("vec2",Fw.bool,null),Uw.vec3b=new Uw("vec3",Fw.bool,null),Uw.vec4b=new Uw("vec4",Fw.bool,null),Uw.mat2x2f=new Uw("mat2x2",Fw.f32,null),Uw.mat2x3f=new Uw("mat2x3",Fw.f32,null),Uw.mat2x4f=new Uw("mat2x4",Fw.f32,null),Uw.mat3x2f=new Uw("mat3x2",Fw.f32,null),Uw.mat3x3f=new Uw("mat3x3",Fw.f32,null),Uw.mat3x4f=new Uw("mat3x4",Fw.f32,null),Uw.mat4x2f=new Uw("mat4x2",Fw.f32,null),Uw.mat4x3f=new Uw("mat4x3",Fw.f32,null),Uw.mat4x4f=new Uw("mat4x4",Fw.f32,null),Uw.mat2x2h=new Uw("mat2x2",Fw.f16,null),Uw.mat2x3h=new Uw("mat2x3",Fw.f16,null),Uw.mat2x4h=new Uw("mat2x4",Fw.f16,null),Uw.mat3x2h=new Uw("mat3x2",Fw.f16,null),Uw.mat3x3h=new Uw("mat3x3",Fw.f16,null),Uw.mat3x4h=new Uw("mat3x4",Fw.f16,null),Uw.mat4x2h=new Uw("mat4x2",Fw.f16,null),Uw.mat4x3h=new Uw("mat4x3",Fw.f16,null),Uw.mat4x4h=new Uw("mat4x4",Fw.f16,null),Uw.mat2x2i=new Uw("mat2x2",Fw.i32,null),Uw.mat2x3i=new Uw("mat2x3",Fw.i32,null),Uw.mat2x4i=new Uw("mat2x4",Fw.i32,null),Uw.mat3x2i=new Uw("mat3x2",Fw.i32,null),Uw.mat3x3i=new Uw("mat3x3",Fw.i32,null),Uw.mat3x4i=new Uw("mat3x4",Fw.i32,null),Uw.mat4x2i=new Uw("mat4x2",Fw.i32,null),Uw.mat4x3i=new Uw("mat4x3",Fw.i32,null),Uw.mat4x4i=new Uw("mat4x4",Fw.i32,null),Uw.mat2x2u=new Uw("mat2x2",Fw.u32,null),Uw.mat2x3u=new Uw("mat2x3",Fw.u32,null),Uw.mat2x4u=new Uw("mat2x4",Fw.u32,null),Uw.mat3x2u=new Uw("mat3x2",Fw.u32,null),Uw.mat3x3u=new Uw("mat3x3",Fw.u32,null),Uw.mat3x4u=new Uw("mat3x4",Fw.u32,null),Uw.mat4x2u=new Uw("mat4x2",Fw.u32,null),Uw.mat4x3u=new Uw("mat4x3",Fw.u32,null),Uw.mat4x4u=new Uw("mat4x4",Fw.u32,null);class Vw extends Fw{constructor(e,t,n,r){super(e),this.storage=t,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class Gw extends Fw{constructor(e,t,n,r){super(e),this.attributes=t,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Hw extends Fw{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class $w extends sw{constructor(){super(),this.postfix=null}}class Ww extends $w{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class qw extends $w{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Xw extends $w{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return cw.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Zw extends $w{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Kw extends $w{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class Yw extends $w{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof pS}get isVector(){return this.value instanceof gS||this.value instanceof _S}get scalarValue(){return this.value instanceof pS?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof gS||this.value instanceof _S?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Jw extends $w{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Qw extends $w{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class eS extends $w{constructor(){super()}}class tS extends eS{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class nS extends eS{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?Fw.f32:"u32"===e.name||"u32"===t.name?Fw.u32:Fw.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class rS extends sw{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class iS extends $w{constructor(){super()}get astNodeType(){return"default"}}class oS extends rS{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class sS extends rS{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class aS extends sw{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class lS extends sw{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class cS extends sw{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class uS extends sw{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class hS{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=hS._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}hS._id=0;class dS extends hS{constructor(){super(new Lb("void",null),null)}toString(){return"void"}}dS.void=new dS;class fS extends hS{constructor(e){super(new Fb("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,r){this.reference.setDataValue(e,t,n,r)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class pS extends hS{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new pS(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new pS(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new pS(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,r){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof pS))return void console.error("SetDataValue: Invalid value",t);let i=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?i=Math.floor(i):"bool"===this.typeInfo.name&&(i=i?1:0),this.data[0]=i}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function mS(e,t,n){const r=t.length;return 2===r?"f32"===n?new gS(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new gS(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new gS(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new gS(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):3===r?"f32"===n?new gS(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new gS(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new gS(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new gS(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):4===r?"f32"===n?new gS(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new gS(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new gS(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new gS(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class gS extends hS{constructor(e,t){if(super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):"vec2"===t||"vec3"===t||"vec4"===t?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${t}`)}}clone(){if(this.data instanceof Float32Array)return new gS(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new gS(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new gS(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,r){n instanceof Ww?console.error("TODO: Set vector postfix"):t instanceof gS?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(null===t)return this;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof Bb)r=this.typeInfo.format||r;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?r=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?r=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?r=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?r=e.getTypeInfo("u32"):"vec2h"===t||"vec3h"===t||"vec4h"===t?r=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${t}`)}let i=this;for(;null!==t&&null!==i;){if(t instanceof Qw){const o=t.index;let s=-1;if(o instanceof Yw){if(!(o.value instanceof pS))return console.error(`GetSubData: Invalid array index ${o.value}`),null;s=o.value.value}else{const t=e.evalExpression(o,n);if(!(t instanceof pS))return console.error("GetSubData: Unknown index type",o),null;s=t.value}if(s<0||s>=i.data.length)return console.error("GetSubData: Index out of range",s),null;if(i.data instanceof Float32Array){const e=new Float32Array(i.data.buffer,i.data.byteOffset+4*s,1);return new pS(e,r)}if(i.data instanceof Int32Array){const e=new Int32Array(i.data.buffer,i.data.byteOffset+4*s,1);return new pS(e,r)}if(i.data instanceof Uint32Array){const e=new Uint32Array(i.data.buffer,i.data.byteOffset+4*s,1);return new pS(e,r)}throw"GetSubData: Invalid data type"}if(!(t instanceof Ww))return console.error("GetSubData: Unknown postfix",t),null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return console.error(`GetSubData: Unknown member ${n}`),null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new pS(t,r,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new pS(t,r,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new pS(t,r,this)}}const o=[];for(const e of n)"x"===e||"r"===e?o.push(this.data[0]):"y"===e||"g"===e?o.push(this.data[1]):"z"===e||"b"===e?o.push(this.data[2]):"w"===e||"a"===e?o.push(this.data[3]):console.error(`GetDataValue: Unknown member ${e}`);i=mS(e,o,r.name)}t=t.postfix}return i}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class _S extends hS{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new _S(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,r){n instanceof Ww?console.error("TODO: Set matrix postfix"):t instanceof _S?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(null===t)return this;const r=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Bb)this.typeInfo.format;else if(r.endsWith("f"))e.getTypeInfo("f32");else if(r.endsWith("i"))e.getTypeInfo("i32");else if(r.endsWith("u"))e.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;e.getTypeInfo("f16")}if(t instanceof Qw){const i=t.index;let o=-1;if(i instanceof Yw){if(!(i.value instanceof pS))return console.error(`GetDataValue: Invalid array index ${i.value}`),null;o=i.value.value}else{const t=e.evalExpression(i,n);if(!(t instanceof pS))return console.error("GetDataValue: Unknown index type",i),null;o=t.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const s=r.endsWith("h")?"h":"f";let a;if("mat2x2"===r||"mat2x2f"===r||"mat2x2h"===r||"mat3x2"===r||"mat3x2f"===r||"mat3x2h"===r||"mat4x2"===r||"mat4x2f"===r||"mat4x2h"===r)a=new gS(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${s}`));else if("mat2x3"===r||"mat2x3f"===r||"mat2x3h"===r||"mat3x3"===r||"mat3x3f"===r||"mat3x3h"===r||"mat4x3"===r||"mat4x3f"===r||"mat4x3h"===r)a=new gS(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${s}`));else{if("mat2x4"!==r&&"mat2x4f"!==r&&"mat2x4h"!==r&&"mat3x4"!==r&&"mat3x4f"!==r&&"mat3x4h"!==r&&"mat4x4"!==r&&"mat4x4f"!==r&&"mat4x4h"!==r)return console.error(`GetDataValue: Unknown type ${r}`),null;a=new gS(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${s}`))}return t.postfix?a.getSubData(e,t.postfix,n):a}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class yS extends hS{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new yS(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,r){if(null===t)return void console.log("setDataValue: NULL data.");let i=this.offset,o=this.typeInfo;for(;n;){if(n instanceof Qw)if(o instanceof zb){const t=n.index;if(t instanceof Yw){if(!(t.value instanceof pS))return void console.error(`SetDataValue: Invalid index type ${t.value}`);i+=t.value.value*o.stride}else{const n=e.evalExpression(t,r);if(!(n instanceof pS))return void console.error("SetDataValue: Unknown index type",t);i+=n.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(n instanceof Ww))return void console.error("SetDataValue: Unknown postfix type",n);{const e=n.value;if(o instanceof Nb){let t=!1;for(const n of o.members)if(n.name===e){i+=n.offset,o=n.type,t=!0;break}if(!t)return void console.error(`SetDataValue: Member ${e} not found`)}else if(o instanceof Lb){const n=o.getTypeName();let r=0;if("x"===e||"r"===e)r=0;else if("y"===e||"g"===e)r=1;else if("z"===e||"b"===e)r=2;else{if("w"!==e&&"a"!==e)return void console.error(`SetDataValue: Unknown member ${e}`);r=3}if(!(t instanceof pS))return void console.error("SetDataValue: Invalid value",t);const s=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,i,2)[r]=s):"vec3f"===n?void(new Float32Array(this.buffer,i,3)[r]=s):"vec4f"===n?void(new Float32Array(this.buffer,i,4)[r]=s):"vec2i"===n?void(new Int32Array(this.buffer,i,2)[r]=s):"vec3i"===n?void(new Int32Array(this.buffer,i,3)[r]=s):"vec4i"===n?void(new Int32Array(this.buffer,i,4)[r]=s):"vec2u"===n?void(new Uint32Array(this.buffer,i,2)[r]=s):"vec3u"===n?void(new Uint32Array(this.buffer,i,3)[r]=s):"vec4u"===n?void(new Uint32Array(this.buffer,i,4)[r]=s):void console.error(`SetDataValue: Type ${n} is not a struct`)}}}n=n.postfix}this.setData(e,t,o,i,r)}setData(e,t,n,r,i){const o=n.getTypeName();if("f32"!==o&&"f16"!==o)if("i32"!==o&&"atomic<i32>"!==o&&"x32"!==o)if("u32"!==o&&"atomic<u32>"!==o)if("bool"!==o){if("vec2f"===o||"vec2h"===o){const e=new Float32Array(this.buffer,r,2);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===o||"vec3h"===o){const e=new Float32Array(this.buffer,r,3);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===o||"vec4h"===o){const e=new Float32Array(this.buffer,r,4);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===o){const e=new Int32Array(this.buffer,r,2);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===o){const e=new Int32Array(this.buffer,r,3);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===o){const e=new Int32Array(this.buffer,r,4);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===o){const e=new Uint32Array(this.buffer,r,2);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===o){const e=new Uint32Array(this.buffer,r,3);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===o){const e=new Uint32Array(this.buffer,r,4);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===o){const e=new Uint32Array(this.buffer,r,2);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===o){const e=new Uint32Array(this.buffer,r,3);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===o){const e=new Uint32Array(this.buffer,r,4);return void(t instanceof gS?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===o||"mat2x2h"===o){const e=new Float32Array(this.buffer,r,4);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===o||"mat2x3h"===o){const e=new Float32Array(this.buffer,r,6);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===o||"mat2x4h"===o){const e=new Float32Array(this.buffer,r,8);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===o||"mat3x2h"===o){const e=new Float32Array(this.buffer,r,6);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===o||"mat3x3h"===o){const e=new Float32Array(this.buffer,r,9);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===o||"mat3x4h"===o){const e=new Float32Array(this.buffer,r,12);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===o||"mat4x2h"===o){const e=new Float32Array(this.buffer,r,8);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===o||"mat4x3h"===o){const e=new Float32Array(this.buffer,r,12);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===o||"mat4x4h"===o){const e=new Float32Array(this.buffer,r,16);return void(t instanceof _S?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof yS){if(n===t.typeInfo)return void new Uint8Array(this.buffer,r,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`)}else t instanceof pS&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof pS&&(new Uint32Array(this.buffer,r,1)[0]=t.value);else t instanceof pS&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof pS&&(new Float32Array(this.buffer,r,1)[0]=t.value)}getSubData(e,t,n){var r,i,o;if(null===t)return this;let s=this.offset,a=this.typeInfo;for(;t;){if(t instanceof Qw){const r=t.index,i=r instanceof $w?e.evalExpression(r,n):r;let o=0;if(i instanceof pS?o=i.value:"number"==typeof i?o=i:console.error("GetDataValue: Invalid index type",r),a instanceof zb)s+=o*a.stride,a=a.format;else{const t=a.getTypeName();"mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t?(s+=16*o,a=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${a.getTypeName()} is not an array`)}}else{if(!(t instanceof Ww))return console.error("GetDataValue: Unknown postfix type",t),null;{const n=t.value;if(a instanceof Nb){let e=!1;for(const t of a.members)if(t.name===n){s+=t.offset,a=t.type,e=!0;break}if(!e)return console.error(`GetDataValue: Member ${n} not found`),null}else if(a instanceof Lb){const t=a.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let r="f";const i=[];for(let o=0;o<n.length;++o){const a=n[o].toLowerCase();let l=0;if("x"===a||"r"===a)l=0;else if("y"===a||"g"===a)l=1;else if("z"===a||"b"===a)l=2;else{if("w"!==a&&"a"!==a)return console.error(`Unknown member ${n}`),null;l=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<s+4*l+4?(console.log("Insufficient buffer data"),null):new pS(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new pS(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new pS(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new pS(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new pS(new Uint32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)i.push(new Float32Array(this.buffer,s,2)[l]);else if("vec3f"===t){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const e=new Float32Array(this.buffer,s,3);i.push(e[l])}else if("vec4f"===t)i.push(new Float32Array(this.buffer,s,4)[l]);else if("vec2i"===t)r="i",i.push(new Int32Array(this.buffer,s,2)[l]);else if("vec3i"===t)r="i",i.push(new Int32Array(this.buffer,s,3)[l]);else if("vec4i"===t)r="i",i.push(new Int32Array(this.buffer,s,4)[l]);else if("vec2u"===t){r="u";const e=new Uint32Array(this.buffer,s,2);i.push(e[l])}else"vec3u"===t?(r="u",i.push(new Uint32Array(this.buffer,s,3)[l])):"vec4u"===t&&(r="u",i.push(new Uint32Array(this.buffer,s,4)[l]))}return 2===i.length?a=e.getTypeInfo(`vec2${r}`):3===i.length?a=e.getTypeInfo(`vec3${r}`):4===i.length?a=e.getTypeInfo(`vec4${r}`):console.error(`GetDataValue: Invalid vector length ${i.length}`),new gS(i,a,null)}return console.error(`GetDataValue: Unknown member ${n}`),null}return console.error(`GetDataValue: Type ${t} is not a struct`),null}}}t=t.postfix}const l=a.getTypeName();return"f32"===l?new pS(new Float32Array(this.buffer,s,1),a,this):"i32"===l?new pS(new Int32Array(this.buffer,s,1),a,this):"u32"===l?new pS(new Uint32Array(this.buffer,s,1),a,this):"vec2f"===l?new gS(new Float32Array(this.buffer,s,2),a,this):"vec3f"===l?new gS(new Float32Array(this.buffer,s,3),a,this):"vec4f"===l?new gS(new Float32Array(this.buffer,s,4),a,this):"vec2i"===l?new gS(new Int32Array(this.buffer,s,2),a,this):"vec3i"===l?new gS(new Int32Array(this.buffer,s,3),a,this):"vec4i"===l?new gS(new Int32Array(this.buffer,s,4),a,this):"vec2u"===l?new gS(new Uint32Array(this.buffer,s,2),a,this):"vec3u"===l?new gS(new Uint32Array(this.buffer,s,3),a,this):"vec4u"===l?new gS(new Uint32Array(this.buffer,s,4),a,this):a instanceof Bb&&"atomic"===a.name?"u32"===(null===(r=a.format)||void 0===r?void 0:r.name)?new pS(new Uint32Array(this.buffer,s,1)[0],a.format,this):"i32"===(null===(i=a.format)||void 0===i?void 0:i.name)?new pS(new Int32Array(this.buffer,s,1)[0],a.format,this):(console.error(`GetDataValue: Invalid atomic format ${null===(o=a.format)||void 0===o?void 0:o.name}`),null):new yS(this.buffer,a,s,this)}toString(){let e="";if(this.typeInfo instanceof zb)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof Nb?e+="{...}":e="[...]";return e}}class vS extends hS{constructor(e,t,n,r){super(t,null),this.data=e,this.descriptor=n,this.view=r}clone(){return new vS(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=ow[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=ow[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=ow[e],n=this.width;if(!e||n<=0||!t)return-1;const r=this.height,i=this.depthOrArrayLayers,o=this.dimension;return n/t.blockWidth*("1d"===o?1:r/t.blockHeight)*t.bytesPerBlock*i}getPixel(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=this.texelByteSize,o=this.bytesPerRow,s=this.height,a=this.data[r];return function(e,t,n,r,i,o,s,a,l){const c=r*(s>>=i)*(o>>=i)+n*s+t*a;switch(l){case"r8unorm":return[rw(e,c,"8unorm",1)[0]];case"r8snorm":return[rw(e,c,"8snorm",1)[0]];case"r8uint":return[rw(e,c,"8uint",1)[0]];case"r8sint":return[rw(e,c,"8sint",1)[0]];case"rg8unorm":{const t=rw(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=rw(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=rw(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=rw(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=rw(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=rw(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=rw(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=rw(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=rw(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[rw(e,c,"16uint",1)[0]];case"r16sint":return[rw(e,c,"16sint",1)[0]];case"r16float":return[rw(e,c,"16float",1)[0]];case"rg16uint":{const t=rw(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=rw(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=rw(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=rw(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=rw(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=rw(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[rw(e,c,"32uint",1)[0]];case"r32sint":return[rw(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[rw(e,c,"32float",1)[0]];case"rg32uint":{const t=rw(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=rw(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=rw(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=rw(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=rw(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=rw(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,c,1)[0],n=(4192256&t)>>11,r=(4290772992&t)>>22;return[nw(2047&t),nw(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return ew[0]=t,tw[0]}(r),1]}}return null}(new Uint8Array(a),e,t,n,r,s,o,i,this.format)}setPixel(e,t,n,r,i){const o=this.texelByteSize,s=this.bytesPerRow,a=this.height,l=this.data[r];!function(e,t,n,r,i,o,s,a,l,c){const u=r*(s>>=i)*(o>>=i)+n*s+t*a;switch(l){case"r8unorm":return void iw(e,u,"8unorm",1,c);case"r8snorm":return void iw(e,u,"8snorm",1,c);case"r8uint":return void iw(e,u,"8uint",1,c);case"r8sint":return void iw(e,u,"8sint",1,c);case"rg8unorm":return void iw(e,u,"8unorm",2,c);case"rg8snorm":return void iw(e,u,"8snorm",2,c);case"rg8uint":return void iw(e,u,"8uint",2,c);case"rg8sint":return void iw(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void iw(e,u,"8unorm",4,c);case"rgba8snorm":return void iw(e,u,"8snorm",4,c);case"rgba8uint":return void iw(e,u,"8uint",4,c);case"rgba8sint":return void iw(e,u,"8sint",4,c);case"r16uint":return void iw(e,u,"16uint",1,c);case"r16sint":return void iw(e,u,"16sint",1,c);case"r16float":return void iw(e,u,"16float",1,c);case"rg16uint":return void iw(e,u,"16uint",2,c);case"rg16sint":return void iw(e,u,"16sint",2,c);case"rg16float":return void iw(e,u,"16float",2,c);case"rgba16uint":return void iw(e,u,"16uint",4,c);case"rgba16sint":return void iw(e,u,"16sint",4,c);case"rgba16float":return void iw(e,u,"16float",4,c);case"r32uint":return void iw(e,u,"32uint",1,c);case"r32sint":return void iw(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void iw(e,u,"32float",1,c);case"rg32uint":return void iw(e,u,"32uint",2,c);case"rg32sint":return void iw(e,u,"32sint",2,c);case"rg32float":return void iw(e,u,"32float",2,c);case"rgba32uint":return void iw(e,u,"32uint",4,c);case"rgba32sint":return void iw(e,u,"32sint",4,c);case"rgba32float":return void iw(e,u,"32float",4,c);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(l),e,t,n,r,a,s,o,this.format,i)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(Sw||(Sw={}));class xS{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class bS{}ww=bS,bS.none=new xS("",Sw.reserved,""),bS.eof=new xS("EOF",Sw.token,""),bS.reserved={asm:new xS("asm",Sw.reserved,"asm"),bf16:new xS("bf16",Sw.reserved,"bf16"),do:new xS("do",Sw.reserved,"do"),enum:new xS("enum",Sw.reserved,"enum"),f16:new xS("f16",Sw.reserved,"f16"),f64:new xS("f64",Sw.reserved,"f64"),handle:new xS("handle",Sw.reserved,"handle"),i8:new xS("i8",Sw.reserved,"i8"),i16:new xS("i16",Sw.reserved,"i16"),i64:new xS("i64",Sw.reserved,"i64"),mat:new xS("mat",Sw.reserved,"mat"),premerge:new xS("premerge",Sw.reserved,"premerge"),regardless:new xS("regardless",Sw.reserved,"regardless"),typedef:new xS("typedef",Sw.reserved,"typedef"),u8:new xS("u8",Sw.reserved,"u8"),u16:new xS("u16",Sw.reserved,"u16"),u64:new xS("u64",Sw.reserved,"u64"),unless:new xS("unless",Sw.reserved,"unless"),using:new xS("using",Sw.reserved,"using"),vec:new xS("vec",Sw.reserved,"vec"),void:new xS("void",Sw.reserved,"void")},bS.keywords={array:new xS("array",Sw.keyword,"array"),atomic:new xS("atomic",Sw.keyword,"atomic"),bool:new xS("bool",Sw.keyword,"bool"),f32:new xS("f32",Sw.keyword,"f32"),i32:new xS("i32",Sw.keyword,"i32"),mat2x2:new xS("mat2x2",Sw.keyword,"mat2x2"),mat2x3:new xS("mat2x3",Sw.keyword,"mat2x3"),mat2x4:new xS("mat2x4",Sw.keyword,"mat2x4"),mat3x2:new xS("mat3x2",Sw.keyword,"mat3x2"),mat3x3:new xS("mat3x3",Sw.keyword,"mat3x3"),mat3x4:new xS("mat3x4",Sw.keyword,"mat3x4"),mat4x2:new xS("mat4x2",Sw.keyword,"mat4x2"),mat4x3:new xS("mat4x3",Sw.keyword,"mat4x3"),mat4x4:new xS("mat4x4",Sw.keyword,"mat4x4"),ptr:new xS("ptr",Sw.keyword,"ptr"),sampler:new xS("sampler",Sw.keyword,"sampler"),sampler_comparison:new xS("sampler_comparison",Sw.keyword,"sampler_comparison"),struct:new xS("struct",Sw.keyword,"struct"),texture_1d:new xS("texture_1d",Sw.keyword,"texture_1d"),texture_2d:new xS("texture_2d",Sw.keyword,"texture_2d"),texture_2d_array:new xS("texture_2d_array",Sw.keyword,"texture_2d_array"),texture_3d:new xS("texture_3d",Sw.keyword,"texture_3d"),texture_cube:new xS("texture_cube",Sw.keyword,"texture_cube"),texture_cube_array:new xS("texture_cube_array",Sw.keyword,"texture_cube_array"),texture_multisampled_2d:new xS("texture_multisampled_2d",Sw.keyword,"texture_multisampled_2d"),texture_storage_1d:new xS("texture_storage_1d",Sw.keyword,"texture_storage_1d"),texture_storage_2d:new xS("texture_storage_2d",Sw.keyword,"texture_storage_2d"),texture_storage_2d_array:new xS("texture_storage_2d_array",Sw.keyword,"texture_storage_2d_array"),texture_storage_3d:new xS("texture_storage_3d",Sw.keyword,"texture_storage_3d"),texture_depth_2d:new xS("texture_depth_2d",Sw.keyword,"texture_depth_2d"),texture_depth_2d_array:new xS("texture_depth_2d_array",Sw.keyword,"texture_depth_2d_array"),texture_depth_cube:new xS("texture_depth_cube",Sw.keyword,"texture_depth_cube"),texture_depth_cube_array:new xS("texture_depth_cube_array",Sw.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new xS("texture_depth_multisampled_2d",Sw.keyword,"texture_depth_multisampled_2d"),texture_external:new xS("texture_external",Sw.keyword,"texture_external"),u32:new xS("u32",Sw.keyword,"u32"),vec2:new xS("vec2",Sw.keyword,"vec2"),vec3:new xS("vec3",Sw.keyword,"vec3"),vec4:new xS("vec4",Sw.keyword,"vec4"),bitcast:new xS("bitcast",Sw.keyword,"bitcast"),block:new xS("block",Sw.keyword,"block"),break:new xS("break",Sw.keyword,"break"),case:new xS("case",Sw.keyword,"case"),continue:new xS("continue",Sw.keyword,"continue"),continuing:new xS("continuing",Sw.keyword,"continuing"),default:new xS("default",Sw.keyword,"default"),diagnostic:new xS("diagnostic",Sw.keyword,"diagnostic"),discard:new xS("discard",Sw.keyword,"discard"),else:new xS("else",Sw.keyword,"else"),enable:new xS("enable",Sw.keyword,"enable"),fallthrough:new xS("fallthrough",Sw.keyword,"fallthrough"),false:new xS("false",Sw.keyword,"false"),fn:new xS("fn",Sw.keyword,"fn"),for:new xS("for",Sw.keyword,"for"),function:new xS("function",Sw.keyword,"function"),if:new xS("if",Sw.keyword,"if"),let:new xS("let",Sw.keyword,"let"),const:new xS("const",Sw.keyword,"const"),loop:new xS("loop",Sw.keyword,"loop"),while:new xS("while",Sw.keyword,"while"),private:new xS("private",Sw.keyword,"private"),read:new xS("read",Sw.keyword,"read"),read_write:new xS("read_write",Sw.keyword,"read_write"),return:new xS("return",Sw.keyword,"return"),requires:new xS("requires",Sw.keyword,"requires"),storage:new xS("storage",Sw.keyword,"storage"),switch:new xS("switch",Sw.keyword,"switch"),true:new xS("true",Sw.keyword,"true"),alias:new xS("alias",Sw.keyword,"alias"),type:new xS("type",Sw.keyword,"type"),uniform:new xS("uniform",Sw.keyword,"uniform"),var:new xS("var",Sw.keyword,"var"),override:new xS("override",Sw.keyword,"override"),workgroup:new xS("workgroup",Sw.keyword,"workgroup"),write:new xS("write",Sw.keyword,"write"),r8unorm:new xS("r8unorm",Sw.keyword,"r8unorm"),r8snorm:new xS("r8snorm",Sw.keyword,"r8snorm"),r8uint:new xS("r8uint",Sw.keyword,"r8uint"),r8sint:new xS("r8sint",Sw.keyword,"r8sint"),r16uint:new xS("r16uint",Sw.keyword,"r16uint"),r16sint:new xS("r16sint",Sw.keyword,"r16sint"),r16float:new xS("r16float",Sw.keyword,"r16float"),rg8unorm:new xS("rg8unorm",Sw.keyword,"rg8unorm"),rg8snorm:new xS("rg8snorm",Sw.keyword,"rg8snorm"),rg8uint:new xS("rg8uint",Sw.keyword,"rg8uint"),rg8sint:new xS("rg8sint",Sw.keyword,"rg8sint"),r32uint:new xS("r32uint",Sw.keyword,"r32uint"),r32sint:new xS("r32sint",Sw.keyword,"r32sint"),r32float:new xS("r32float",Sw.keyword,"r32float"),rg16uint:new xS("rg16uint",Sw.keyword,"rg16uint"),rg16sint:new xS("rg16sint",Sw.keyword,"rg16sint"),rg16float:new xS("rg16float",Sw.keyword,"rg16float"),rgba8unorm:new xS("rgba8unorm",Sw.keyword,"rgba8unorm"),rgba8unorm_srgb:new xS("rgba8unorm_srgb",Sw.keyword,"rgba8unorm_srgb"),rgba8snorm:new xS("rgba8snorm",Sw.keyword,"rgba8snorm"),rgba8uint:new xS("rgba8uint",Sw.keyword,"rgba8uint"),rgba8sint:new xS("rgba8sint",Sw.keyword,"rgba8sint"),bgra8unorm:new xS("bgra8unorm",Sw.keyword,"bgra8unorm"),bgra8unorm_srgb:new xS("bgra8unorm_srgb",Sw.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new xS("rgb10a2unorm",Sw.keyword,"rgb10a2unorm"),rg11b10float:new xS("rg11b10float",Sw.keyword,"rg11b10float"),rg32uint:new xS("rg32uint",Sw.keyword,"rg32uint"),rg32sint:new xS("rg32sint",Sw.keyword,"rg32sint"),rg32float:new xS("rg32float",Sw.keyword,"rg32float"),rgba16uint:new xS("rgba16uint",Sw.keyword,"rgba16uint"),rgba16sint:new xS("rgba16sint",Sw.keyword,"rgba16sint"),rgba16float:new xS("rgba16float",Sw.keyword,"rgba16float"),rgba32uint:new xS("rgba32uint",Sw.keyword,"rgba32uint"),rgba32sint:new xS("rgba32sint",Sw.keyword,"rgba32sint"),rgba32float:new xS("rgba32float",Sw.keyword,"rgba32float"),static_assert:new xS("static_assert",Sw.keyword,"static_assert")},bS.tokens={decimal_float_literal:new xS("decimal_float_literal",Sw.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new xS("hex_float_literal",Sw.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new xS("int_literal",Sw.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new xS("uint_literal",Sw.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new xS("name",Sw.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new xS("ident",Sw.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new xS("and",Sw.token,"&"),and_and:new xS("and_and",Sw.token,"&&"),arrow:new xS("arrow ",Sw.token,"->"),attr:new xS("attr",Sw.token,"@"),forward_slash:new xS("forward_slash",Sw.token,"/"),bang:new xS("bang",Sw.token,"!"),bracket_left:new xS("bracket_left",Sw.token,"["),bracket_right:new xS("bracket_right",Sw.token,"]"),brace_left:new xS("brace_left",Sw.token,"{"),brace_right:new xS("brace_right",Sw.token,"}"),colon:new xS("colon",Sw.token,":"),comma:new xS("comma",Sw.token,","),equal:new xS("equal",Sw.token,"="),equal_equal:new xS("equal_equal",Sw.token,"=="),not_equal:new xS("not_equal",Sw.token,"!="),greater_than:new xS("greater_than",Sw.token,">"),greater_than_equal:new xS("greater_than_equal",Sw.token,">="),shift_right:new xS("shift_right",Sw.token,">>"),less_than:new xS("less_than",Sw.token,"<"),less_than_equal:new xS("less_than_equal",Sw.token,"<="),shift_left:new xS("shift_left",Sw.token,"<<"),modulo:new xS("modulo",Sw.token,"%"),minus:new xS("minus",Sw.token,"-"),minus_minus:new xS("minus_minus",Sw.token,"--"),period:new xS("period",Sw.token,"."),plus:new xS("plus",Sw.token,"+"),plus_plus:new xS("plus_plus",Sw.token,"++"),or:new xS("or",Sw.token,"|"),or_or:new xS("or_or",Sw.token,"||"),paren_left:new xS("paren_left",Sw.token,"("),paren_right:new xS("paren_right",Sw.token,")"),semicolon:new xS("semicolon",Sw.token,";"),star:new xS("star",Sw.token,"*"),tilde:new xS("tilde",Sw.token,"~"),underscore:new xS("underscore",Sw.token,"_"),xor:new xS("xor",Sw.token,"^"),plus_equal:new xS("plus_equal",Sw.token,"+="),minus_equal:new xS("minus_equal",Sw.token,"-="),times_equal:new xS("times_equal",Sw.token,"*="),division_equal:new xS("division_equal",Sw.token,"/="),modulo_equal:new xS("modulo_equal",Sw.token,"%="),and_equal:new xS("and_equal",Sw.token,"&="),or_equal:new xS("or_equal",Sw.token,"|="),xor_equal:new xS("xor_equal",Sw.token,"^="),shift_right_equal:new xS("shift_right_equal",Sw.token,">>="),shift_left_equal:new xS("shift_left_equal",Sw.token,"<<=")},bS.simpleTokens={"@":ww.tokens.attr,"{":ww.tokens.brace_left,"}":ww.tokens.brace_right,":":ww.tokens.colon,",":ww.tokens.comma,"(":ww.tokens.paren_left,")":ww.tokens.paren_right,";":ww.tokens.semicolon},bS.literalTokens={"&":ww.tokens.and,"&&":ww.tokens.and_and,"->":ww.tokens.arrow,"/":ww.tokens.forward_slash,"!":ww.tokens.bang,"[":ww.tokens.bracket_left,"]":ww.tokens.bracket_right,"=":ww.tokens.equal,"==":ww.tokens.equal_equal,"!=":ww.tokens.not_equal,">":ww.tokens.greater_than,">=":ww.tokens.greater_than_equal,">>":ww.tokens.shift_right,"<":ww.tokens.less_than,"<=":ww.tokens.less_than_equal,"<<":ww.tokens.shift_left,"%":ww.tokens.modulo,"-":ww.tokens.minus,"--":ww.tokens.minus_minus,".":ww.tokens.period,"+":ww.tokens.plus,"++":ww.tokens.plus_plus,"|":ww.tokens.or,"||":ww.tokens.or_or,"*":ww.tokens.star,"~":ww.tokens.tilde,_:ww.tokens.underscore,"^":ww.tokens.xor,"+=":ww.tokens.plus_equal,"-=":ww.tokens.minus_equal,"*=":ww.tokens.times_equal,"/=":ww.tokens.division_equal,"%=":ww.tokens.modulo_equal,"&=":ww.tokens.and_equal,"|=":ww.tokens.or_equal,"^=":ww.tokens.xor_equal,">>=":ww.tokens.shift_right_equal,"<<=":ww.tokens.shift_left_equal},bS.regexTokens={decimal_float_literal:ww.tokens.decimal_float_literal,hex_float_literal:ww.tokens.hex_float_literal,int_literal:ww.tokens.int_literal,uint_literal:ww.tokens.uint_literal,ident:ww.tokens.ident},bS.storage_class=[ww.keywords.function,ww.keywords.private,ww.keywords.workgroup,ww.keywords.uniform,ww.keywords.storage],bS.access_mode=[ww.keywords.read,ww.keywords.write,ww.keywords.read_write],bS.sampler_type=[ww.keywords.sampler,ww.keywords.sampler_comparison],bS.sampled_texture_type=[ww.keywords.texture_1d,ww.keywords.texture_2d,ww.keywords.texture_2d_array,ww.keywords.texture_3d,ww.keywords.texture_cube,ww.keywords.texture_cube_array],bS.multisampled_texture_type=[ww.keywords.texture_multisampled_2d],bS.storage_texture_type=[ww.keywords.texture_storage_1d,ww.keywords.texture_storage_2d,ww.keywords.texture_storage_2d_array,ww.keywords.texture_storage_3d],bS.depth_texture_type=[ww.keywords.texture_depth_2d,ww.keywords.texture_depth_2d_array,ww.keywords.texture_depth_cube,ww.keywords.texture_depth_cube_array,ww.keywords.texture_depth_multisampled_2d],bS.texture_external_type=[ww.keywords.texture_external],bS.any_texture_type=[...ww.sampled_texture_type,...ww.multisampled_texture_type,...ww.storage_texture_type,...ww.depth_texture_type,...ww.texture_external_type],bS.texel_format=[ww.keywords.r8unorm,ww.keywords.r8snorm,ww.keywords.r8uint,ww.keywords.r8sint,ww.keywords.r16uint,ww.keywords.r16sint,ww.keywords.r16float,ww.keywords.rg8unorm,ww.keywords.rg8snorm,ww.keywords.rg8uint,ww.keywords.rg8sint,ww.keywords.r32uint,ww.keywords.r32sint,ww.keywords.r32float,ww.keywords.rg16uint,ww.keywords.rg16sint,ww.keywords.rg16float,ww.keywords.rgba8unorm,ww.keywords.rgba8unorm_srgb,ww.keywords.rgba8snorm,ww.keywords.rgba8uint,ww.keywords.rgba8sint,ww.keywords.bgra8unorm,ww.keywords.bgra8unorm_srgb,ww.keywords.rgb10a2unorm,ww.keywords.rg11b10float,ww.keywords.rg32uint,ww.keywords.rg32sint,ww.keywords.rg32float,ww.keywords.rgba16uint,ww.keywords.rgba16sint,ww.keywords.rgba16float,ww.keywords.rgba32uint,ww.keywords.rgba32sint,ww.keywords.rgba32float],bS.const_literal=[ww.tokens.int_literal,ww.tokens.uint_literal,ww.tokens.decimal_float_literal,ww.tokens.hex_float_literal,ww.keywords.true,ww.keywords.false],bS.literal_or_ident=[ww.tokens.ident,ww.tokens.int_literal,ww.tokens.uint_literal,ww.tokens.decimal_float_literal,ww.tokens.hex_float_literal,ww.tokens.name],bS.element_count_expression=[ww.tokens.int_literal,ww.tokens.uint_literal,ww.tokens.ident],bS.template_types=[ww.keywords.vec2,ww.keywords.vec3,ww.keywords.vec4,ww.keywords.mat2x2,ww.keywords.mat2x3,ww.keywords.mat2x4,ww.keywords.mat3x2,ww.keywords.mat3x3,ww.keywords.mat3x4,ww.keywords.mat4x2,ww.keywords.mat4x3,ww.keywords.mat4x4,ww.keywords.atomic,ww.keywords.bitcast,...ww.any_texture_type],bS.attribute_name=[ww.tokens.ident,ww.keywords.block,ww.keywords.diagnostic],bS.assignment_operators=[ww.tokens.equal,ww.tokens.plus_equal,ww.tokens.minus_equal,ww.tokens.times_equal,ww.tokens.division_equal,ww.tokens.modulo_equal,ww.tokens.and_equal,ww.tokens.or_equal,ww.tokens.xor_equal,ww.tokens.shift_right_equal,ww.tokens.shift_left_equal],bS.increment_operators=[ww.tokens.plus_plus,ww.tokens.minus_minus];class wS{constructor(e,t,n,r,i){this.type=e,this.lexeme=t,this.line=n,this.start=r,this.end=i}toString(){return this.lexeme}isTemplateType(){return-1!=bS.template_types.indexOf(this.type)}isArrayType(){return this.type==bS.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class SS{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new wS(bS.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=bS.simpleTokens[e];if(t)return this._addToken(t),!0;let n=bS.none;const r=this._isAlpha(e),i="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(r){const t=bS.keywords[e];if(t)return this._addToken(t),!0}if(r||i)return this._addToken(bS.tokens.ident),!0;for(;;){let t=this._findType(e);const r=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==r)return this._current++,e+=r,this._addToken(bS.tokens.minus_equal),!0;if("-"==r)return this._current++,e+=r,this._addToken(bS.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=bS.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==bS.tokens.paren_right)&&">"!=r)return this._addToken(t),!0}if(">"==e&&(">"==r||"="==r)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===bS.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===bS.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===bS.none){let r=e,i=0;const o=2;for(let e=0;e<o;++e)if(r+=this._peekAhead(e),t=this._findType(r),t!==bS.none){i=e;break}if(t===bS.none)return n!==bS.none&&(this._current--,this._addToken(n),!0);e=r,this._current+=i+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==bS.none&&(this._addToken(n),!0)}_findType(e){for(const t in bS.regexTokens){const n=bS.regexTokens[t];if(this._match(e,n.rule))return n}return bS.literalTokens[e]||bS.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new wS(e,t,this._line,this._start,this._current))}}function ES(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const TS=new Float32Array(1),AS=new Uint32Array(TS.buffer),CS=new Uint32Array(TS.buffer),PS=new Int32Array(1),IS=new Float32Array(PS.buffer),kS=new Uint32Array(PS.buffer),MS=new Uint32Array(1),RS=new Float32Array(MS.buffer),OS=new Int32Array(MS.buffer);function LS(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return TS[0]=e,AS[0];if("u32"===n)return TS[0]=e,CS[0]}else if("i32"===t||"x32"===t){if("f32"===n)return PS[0]=e,IS[0];if("u32"===n)return PS[0]=e,kS[0]}else if("u32"===t){if("f32"===n)return MS[0]=e,RS[0];if("i32"===n||"x32"===n)return MS[0]=e,OS[0]}return console.error(`Unsupported cast from ${t} to ${n}`),e}class DS{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class NS{constructor(e,t){this.align=e,this.size=t}}class zS{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Xb,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof hw&&this._functions.set(t.name,new DS(t));for(const t of e)if(t instanceof jw){const e=this.getTypeInfo(t,null);e instanceof Nb&&this.structs.push(e)}for(const t of e)if(t instanceof Lw)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof _w){const e=t,n=this._getAttributeNum(e.attributes,"id",0),r=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new $b(e.name,r,e.attributes,n));continue}if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),i=this.getTypeInfo(e.type,e.attributes),o=new Ub(e.name,i,n,r,e.attributes,jb.Uniform,e.access);o.access||(o.access="read"),this.uniforms.push(o);continue}if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),i=this.getTypeInfo(e.type,e.attributes),o=this._isStorageTexture(i),s=new Ub(e.name,i,n,r,e.attributes,o?jb.StorageTexture:jb.Storage,e.access);s.access||(s.access="read"),this.storage.push(s);continue}if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),i=this.getTypeInfo(e.type,e.attributes),o=this._isStorageTexture(i),s=new Ub(e.name,i,n,r,e.attributes,o?jb.StorageTexture:jb.Texture,e.access);s.access||(s.access="read"),o?this.storage.push(s):this.textures.push(s);continue}if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),i=this.getTypeInfo(e.type,e.attributes),o=new Ub(e.name,i,n,r,e.attributes,jb.Sampler,e.access);this.samplers.push(o);continue}}for(const t of e)if(t instanceof hw){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),r=this._getAttribute(t,"compute"),i=e||n||r,o=new qb(t.name,null==i?void 0:i.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,i&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!i),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[i.name].push(o)),o.arguments=t.args.map(e=>new Wb(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(e=>{var n,r,i;if(e instanceof uS){if(e.value)if(ES(e.value))for(const o of e.value)for(const e of this.overrides)o===e.name&&(null===(n=t.info)||void 0===n||n.overrides.push(e));else for(const o of this.overrides)e.value===o.name&&(null===(r=t.info)||void 0===r||r.overrides.push(o))}else if(e instanceof Zw)for(const o of this.overrides)e.name===o.name&&(null===(i=t.info)||void 0===i||i.overrides.push(o))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const r of e.calls){const e=null===(n=this._functions.get(r.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const r of this.entry.compute)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n;for(const r of this.entry.vertex)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n;for(const r of this.entry.fragment)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n}for(const r of this.uniforms)if(r.group==e&&r.binding==t)return r;for(const r of this.storage)if(r.group==e&&r.binding==t)return r;for(const r of this.textures)if(r.group==e&&r.binding==t)return r;for(const r of this.samplers)if(r.group==e&&r.binding==t)return r;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],r=this,i=[];return e.search(o=>{if(o instanceof aw)i.push({});else if(o instanceof lw)i.pop();else if(o instanceof gw){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type),i.length>0&&(i[i.length-1][e.name]=e)}else if(o instanceof qw){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(o instanceof yw){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type),i.length>0&&(i[i.length-1][e.name]=e)}else if(o instanceof Zw){const e=o;if(i.length>0&&i[i.length-1][e.name])return;const t=r._findResource(e.name);t&&n.push(t)}else if(o instanceof Xw){const i=o,s=r._functions.get(i.name);s&&(t&&(s.inUse=!0),e.calls.add(s.node),null===s.resources&&(s.resources=r._findResources(s.node,t)),n.push(...s.resources))}else if(o instanceof Aw){const i=o,s=r._functions.get(i.name);s&&(t&&(s.inUse=!0),e.calls.add(s.node),null===s.resources&&(s.resources=r._findResources(s.node,t)),n.push(...s.resources))}}),[...new Map(n.map(e=>[e.name,e])).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(void 0===t&&(t=[]),e instanceof jw)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof jw)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const r=this.getTypeInfo(n.type,n.type.attributes),i=this._parseInt(e.value),o=new Hb(n.name,r,e.name,i);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),r=this._parseInt(t.value);return new Hb("",n,t.name,r)}return null}_getInputs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0===t&&(t=[]);for(const n of e)if(n.type instanceof jw)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof jw)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),r=this.getTypeInfo(e.type,e.attributes),i=this._parseInt(t.value),o=new Gb(e.name,r,t.name,i);return null!==n&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new Vb(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._types.has(e))return this._types.get(e);if(e instanceof Vw){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,r=new Fb(e.name,n,t);return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Gw){const n=e,r=n.format?this.getTypeInfo(n.format,n.attributes):null,i=new zb(n.name,t);return i.format=r,i.count=n.count,this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof jw){const n=e,r=new Nb(n.name,t);r.startLine=n.startLine,r.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);r.members.push(new Db(e.name,t,e.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Hw){const n=e,r=n.format instanceof Fw,i=n.format?r?this.getTypeInfo(n.format,null):new Lb(n.format,null):null,o=new Bb(n.name,i,t,n.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Uw){const n=e,r=n.format?this.getTypeInfo(n.format,null):null,i=new Bb(n.name,r,t,n.access);return this._types.set(e,i),this._updateTypeInfo(i),i}const n=new Lb(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,r;const i=this._getTypeSize(e);if(e.size=null!==(t=null==i?void 0:i.size)&&void 0!==t?t:0,e instanceof zb&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(r=null==t?void 0:t.align)&&void 0!==r?r:0),this._updateTypeInfo(e.format)}e instanceof Fb&&this._updateTypeInfo(e.format),e instanceof Nb&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,r=0,i=0,o=0;for(let s=0,a=e.members.length;s<a;++s){const a=e.members[s],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+r),r=u,i=n,o=Math.max(o,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(o,i+r),e.align=o}_getTypeSize(e){var t,n;if(null==e)return null;const r=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Db&&(e=e.type),e instanceof Lb){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=zS._typeInfo[e.name];if(void 0!==n){const o="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new NS(Math.max(i,n.align/o),Math.max(r,n.size/o))}}{const t=zS._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new NS(Math.max(i,t.align/n),Math.max(r,t.size/n))}}if(e instanceof zb){let t=e,o=8,s=8;const a=this._getTypeSize(t.format);return null!==a&&(s=a.size,o=a.align),s=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(o,s)),r&&(s=r),new NS(Math.max(i,o),Math.max(r,s))}if(e instanceof Nb){let t=0,n=0,o=0,s=0,a=0;for(const r of e.members){const e=this._getTypeSize(r.type);null!==e&&(t=Math.max(e.align,t),o=this._roundUp(e.align,o+s),s=e.size,a=o)}return n=this._roundUp(t,a+s),new NS(Math.max(i,t),Math.max(r,n))}return null}_isUniformVar(e){return e instanceof gw&&"uniform"==e.storage}_isStorageVar(e){return e instanceof gw&&"storage"==e.storage}_isTextureVar(e){return e instanceof gw&&null!==e.type&&-1!=zS._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof gw&&null!==e.type&&-1!=zS._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const r=n.attributes;for(let i of r)if(i.name==t)return i;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let r of e)if(r.name==t){let e=null!==r&&null!==r.value?r.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}zS._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},zS._textureTypes=bS.any_texture_type.map(e=>e.name),zS._samplerTypes=bS.sampler_type.map(e=>e.name);let FS=0;class BS{constructor(e,t,n){this.id=FS++,this.name=e,this.value=t,this.node=n}clone(){return new BS(this.name,this.value,this.node)}}class jS{constructor(e){this.id=FS++,this.name=e.name,this.node=e}clone(){return new jS(this.node)}}class US{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=FS++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new BS(e,t,null!=n?n:null))}setVariable(e,t,n){const r=this.getVariable(e);null!==r?r.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new US(this)}}class VS{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class GS{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let r=!0;if(n instanceof gS)return n.data.forEach(e=>{e||(r=!1)}),new pS(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS){const e=n.data.some(e=>e);return new pS(e?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof pS))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.evalExpression(n,t);if(r instanceof yS&&0===r.typeInfo.size){const e=r.typeInfo,t=r.buffer.byteLength/e.stride;return new pS(t,this.getTypeInfo("u32"))}return new pS(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.abs(e)),n.typeInfo);const r=n;return new pS(Math.abs(r.value),r.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.acos(e)),n.typeInfo);const r=n;return new pS(Math.acos(r.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.acosh(e)),n.typeInfo);const r=n;return new pS(Math.acosh(r.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.asin(e)),n.typeInfo);const r=n;return new pS(Math.asin(r.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.asinh(e)),n.typeInfo);const r=n;return new pS(Math.asinh(r.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.atan(e)),n.typeInfo);const r=n;return new pS(Math.atan(r.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.atanh(e)),n.typeInfo);const r=n;return new pS(Math.atanh(r.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof gS&&r instanceof gS)return new gS(n.data.map((e,t)=>Math.atan2(e,r.data[t])),n.typeInfo);const i=n,o=r;return new pS(Math.atan2(i.value,o.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.ceil(e)),n.typeInfo);const r=n;return new pS(Math.ceil(r.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof gS&&r instanceof gS&&i instanceof gS)return new gS(n.data.map((e,t)=>this._clamp(e,r.data[t],i.data[t])),n.typeInfo);const o=n,s=r,a=i;return new pS(this._clamp(o.value,s.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.cos(e)),n.typeInfo);const r=n;return new pS(Math.cos(r.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.cosh(e)),n.typeInfo);const r=n;return new pS(Math.cos(r.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.clz32(e)),n.typeInfo);const r=n;return new pS(Math.clz32(r.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>this._countOneBits(e)),n.typeInfo);const r=n;return new pS(this._countOneBits(r.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>this._countTrailingZeros(e)),n.typeInfo);const r=n;return new pS(this._countTrailingZeros(r.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof gS&&r instanceof gS){if(3!==n.data.length||3!==r.data.length)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const t=n.data,i=r.data;return new gS([t[1]*i[2]-i[1]*t[2],t[2]*i[0]-i[2]*t[0],t[0]*i[1]-i[0]*t[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),r=180/Math.PI;return n instanceof gS?new gS(n.data.map(e=>e*r),n.typeInfo):new pS(n.value*r,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof _S){const e=n.data,t=n.typeInfo.getTypeName(),r=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new pS(e[0]*e[3]-e[1]*e[2],r);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new pS(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),r);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t)console.error(`TODO: Determinant for ${t}`);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t)console.error(`TODO: Determinant for ${t}`);else{if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new pS(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),r);"mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t||"mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t||"mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t?console.error(`TODO: Determinant for ${t}`):"mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||console.error(`TODO: Determinant for ${t}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof gS&&r instanceof gS){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-r.data[t])*(n.data[t]-r.data[t]);return new pS(Math.sqrt(e),this.getTypeInfo("f32"))}const i=n,o=r;return new pS(Math.abs(i.value-o.value),n.typeInfo)}_dot(e,t){let n=0;for(let r=0;r<e.length;++r)n+=t[r]*e[r];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return n instanceof gS&&r instanceof gS?new pS(this._dot(n.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.exp(e)),n.typeInfo);const r=n;return new pS(Math.exp(r.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.pow(2,e)),n.typeInfo);const r=n;return new pS(Math.pow(2,r.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=r.value,s=i.value;if(n instanceof gS)return new gS(n.data.map(e=>e>>o&(1<<s)-1),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const a=n.value;return new pS(a>>o&(1<<s)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof gS&&r instanceof gS&&i instanceof gS){const e=this._dot(r.data,i.data);return new gS(e<0?Array.from(n.data):n.data.map(e=>-e),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>this._firstLeadingBit(e)),n.typeInfo);const r=n;return new pS(this._firstLeadingBit(r.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>this._firstTrailingBit(e)),n.typeInfo);const r=n;return new pS(this._firstTrailingBit(r.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.floor(e)),n.typeInfo);const r=n;return new pS(Math.floor(r.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof gS&&r instanceof gS&&i instanceof gS)return n.data.length!==r.data.length||n.data.length!==i.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new gS(n.data.map((e,t)=>e*r.data[t]+i.data[t]),n.typeInfo);const o=n,s=r,a=i;return new pS(o.value*s.value+a.value,o.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>e-Math.floor(e)),n.typeInfo);const r=n;return new pS(r.value-Math.floor(r.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const s=i.value,a=(1<<o.value)-1<<s,l=~a;if(n instanceof gS&&r instanceof gS)return new gS(n.data.map((e,t)=>e&l|r.data[t]<<s&a),n.typeInfo);const c=n.value,u=r.value;return new pS(c&l|u<<s&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>1/Math.sqrt(e)),n.typeInfo);const r=n;return new pS(1/Math.sqrt(r.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS){let e=0;return n.data.forEach(t=>{e+=t*t}),new pS(Math.sqrt(e),this.getTypeInfo("f32"))}const r=n;return new pS(Math.abs(r.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.log(e)),n.typeInfo);const r=n;return new pS(Math.log(r.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.log2(e)),n.typeInfo);const r=n;return new pS(Math.log2(r.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof gS&&r instanceof gS)return new gS(n.data.map((e,t)=>Math.max(e,r.data[t])),n.typeInfo);const i=n,o=r;return new pS(Math.max(i.value,o.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof gS&&r instanceof gS)return new gS(n.data.map((e,t)=>Math.min(e,r.data[t])),n.typeInfo);const i=n,o=r;return new pS(Math.min(i.value,o.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof gS&&r instanceof gS&&i instanceof gS)return new gS(n.data.map((e,t)=>n.data[t]*(1-i.data[t])+r.data[t]*i.data[t]),n.typeInfo);const o=r,s=i;return new pS(n.value*(1-s.value)+o.value*s.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof gS&&r instanceof gS)return new gS(n.data.map((e,t)=>e%r.data[t]),n.typeInfo);const i=r;return new pS(n.value%i.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS){const r=this.Length(e,t).value;return new gS(n.data.map(e=>e/r),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof gS&&r instanceof gS)return new gS(n.data.map((e,t)=>Math.pow(e,r.data[t])),n.typeInfo);const i=n,o=r;return new pS(Math.pow(i.value,o.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof gS?new gS(n.data.map(e=>e),n.typeInfo):new pS(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof gS?new gS(n.data.map(e=>e*Math.PI/180),n.typeInfo):new pS(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof gS&&r instanceof gS){const e=this._dot(n.data,r.data);return new gS(n.data.map((t,n)=>t-2*e*r.data[n]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof gS&&r instanceof gS&&i instanceof pS){const e=this._dot(r.data,n.data);return new gS(n.data.map((t,n)=>{const o=1-i.value*i.value*(1-e*e);if(o<0)return 0;const s=Math.sqrt(o);return i.value*t-(i.value*e+s)*r.data[n]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.round(e)),n.typeInfo);const r=n;return new pS(Math.round(r.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.min(Math.max(e,0),1)),n.typeInfo);const r=n;return new pS(Math.min(Math.max(r.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.sign(e)),n.typeInfo);const r=n;return new pS(Math.sign(r.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.sin(e)),n.typeInfo);const r=n;return new pS(Math.sin(r.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.sinh(e)),n.typeInfo);const r=n;return new pS(Math.sinh(r.value),n.typeInfo)}_smoothstep(e,t,n){const r=Math.min(Math.max((n-e)/(t-e),0),1);return r*r*(3-2*r)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(i instanceof gS&&n instanceof gS&&r instanceof gS)return new gS(i.data.map((e,t)=>this._smoothstep(n.data[t],r.data[t],e)),i.typeInfo);const o=n,s=r,a=i;return new pS(this._smoothstep(o.value,s.value,a.value),i.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.sqrt(e)),n.typeInfo);const r=n;return new pS(Math.sqrt(r.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(r instanceof gS&&n instanceof gS)return new gS(r.data.map((e,t)=>e<n.data[t]?0:1),r.typeInfo);const i=n;return new pS(r.value<i.value?0:1,i.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.tan(e)),n.typeInfo);const r=n;return new pS(Math.tan(r.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.tanh(e)),n.typeInfo);const r=n;return new pS(Math.tanh(r.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):("mat4x4f"===t||"mat4x4h"===t||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof _S))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const r=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[2],e[1],e[3]],r)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[3],e[6],e[1],e[4],e[7]],r)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],r)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[3],e[1],e[4],e[2],e[5]],r)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],r)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],r)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[4],e[1],e[5],e[2],e[6]],r)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],r)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new _S([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],r)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof gS)return new gS(n.data.map(e=>Math.trunc(e)),n.typeInfo);const r=n;return new pS(Math.trunc(r.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],r=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof Zw){const i=n.name,o=t.getVariableValue(i);if(o instanceof vS){if(r<0||r>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const t=o.getMipLevelSize(r),n=o.dimension;return"1d"===n?new pS(t[0],this.getTypeInfo("u32")):"3d"===n?new gS(t,this.getTypeInfo("vec3u")):"2d"===n?new gS(t.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${n} not found. Line ${e.line}`),null)}return console.error(`Texture ${i} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],r=this.exec.evalExpression(e.args[1],t),i=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(r instanceof gS)||2!==r.data.length)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof Zw){const o=n.name,s=t.getVariableValue(o);if(s instanceof vS){const t=Math.floor(r.data[0]),n=Math.floor(r.data[1]);if(t<0||t>=s.width||n<0||n>=s.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const a=s.getPixel(t,n,0,i);return null===a?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new gS(a,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof Zw){const r=n.name,i=t.getVariableValue(r);return i instanceof vS?new pS(i.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof Zw){const r=n.name,i=t.getVariableValue(r);return i instanceof vS?new pS(i.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof Zw){const r=n.name,i=t.getVariableValue(r);return i instanceof vS?new pS(i.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],r=this.exec.evalExpression(e.args[1],t),i=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,o=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==o.length)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(r instanceof gS)||2!==r.data.length)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof Zw){const s=n.name,a=t.getVariableValue(s);if(a instanceof vS){const t=a.getMipLevelSize(0),n=Math.floor(r.data[0]),l=Math.floor(r.data[1]);return n<0||n>=t[0]||l<0||l>=t[1]?(console.error(`Texture ${s} out of bounds. Line ${e.line}`),null):(a.setPixel(n,l,0,i,Array.from(o)),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t);return t.getVariable(r).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t);return a instanceof pS&&s instanceof pS&&(a.value=s.value),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t),l=new pS(a.value,a.typeInfo);return a instanceof pS&&s instanceof pS&&(a.value+=s.value),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicSub(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t),l=new pS(a.value,a.typeInfo);return a instanceof pS&&s instanceof pS&&(a.value-=s.value),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMax(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t),l=new pS(a.value,a.typeInfo);return a instanceof pS&&s instanceof pS&&(a.value=Math.max(a.value,s.value)),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMin(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t),l=new pS(a.value,a.typeInfo);return a instanceof pS&&s instanceof pS&&(a.value=Math.min(a.value,s.value)),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicAnd(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t),l=new pS(a.value,a.typeInfo);return a instanceof pS&&s instanceof pS&&(a.value=a.value&s.value),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicOr(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t),l=new pS(a.value,a.typeInfo);return a instanceof pS&&s instanceof pS&&(a.value=a.value|s.value),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicXor(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t),l=new pS(a.value,a.typeInfo);return a instanceof pS&&s instanceof pS&&(a.value=a.value^s.value),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicExchange(e,t){let n=e.args[0];n instanceof tS&&(n=n.right);const r=this.exec.getVariableName(n,t),i=t.getVariable(r);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=i.value.getSubData(this.exec,n.postfix,t),l=new pS(a.value,a.typeInfo);return a instanceof pS&&s instanceof pS&&(a.value=s.value),i.value instanceof yS&&i.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const HS={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},$S={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class WS extends VS{constructor(e,t){var n;super(),this.ast=null!=e?e:[],this.reflection=new zS,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new US,this.builtins=new GS(this),this.typeInfo={bool:this.getTypeInfo(Fw.bool),i32:this.getTypeInfo(Fw.i32),u32:this.getTypeInfo(Fw.u32),f32:this.getTypeInfo(Fw.f32),f16:this.getTypeInfo(Fw.f16),vec2f:this.getTypeInfo(Uw.vec2f),vec2u:this.getTypeInfo(Uw.vec2u),vec2i:this.getTypeInfo(Uw.vec2i),vec2h:this.getTypeInfo(Uw.vec2h),vec3f:this.getTypeInfo(Uw.vec3f),vec3u:this.getTypeInfo(Uw.vec3u),vec3i:this.getTypeInfo(Uw.vec3i),vec3h:this.getTypeInfo(Uw.vec3h),vec4f:this.getTypeInfo(Uw.vec4f),vec4u:this.getTypeInfo(Uw.vec4u),vec4i:this.getTypeInfo(Uw.vec4i),vec4h:this.getTypeInfo(Uw.vec4h),mat2x2f:this.getTypeInfo(Uw.mat2x2f),mat2x3f:this.getTypeInfo(Uw.mat2x3f),mat2x4f:this.getTypeInfo(Uw.mat2x4f),mat3x2f:this.getTypeInfo(Uw.mat3x2f),mat3x3f:this.getTypeInfo(Uw.mat3x3f),mat3x4f:this.getTypeInfo(Uw.mat3x4f),mat4x2f:this.getTypeInfo(Uw.mat4x2f),mat4x3f:this.getTypeInfo(Uw.mat4x3f),mat4x4f:this.getTypeInfo(Uw.mat4x4f)}}getVariableValue(e){var t,n;const r=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===r)return null;if(r instanceof pS)return r.value;if(r instanceof gS)return Array.from(r.data);if(r instanceof _S)return Array.from(r.data);if(r instanceof yS&&r.typeInfo instanceof zb){if("u32"===r.typeInfo.format.name)return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if("i32"===r.typeInfo.format.name)return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if("f32"===r.typeInfo.format.name)return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,r){const i=this.context.clone();(r=null!=r?r:{}).constants&&this._setOverrides(r.constants,i),this._execStatements(this.ast,i);const o=i.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return void console.error("Invalid dispatch count");1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const s=t[0],a=t[1],l=t[2],c=this.getTypeInfo("vec3u");i.setVariable("@num_workgroups",new gS(t,c));const u=this.reflection.getFunctionInfo(e);null===u&&console.error(`Function ${e} not found in reflection data`);for(const h in n)for(const e in n[h]){const t=n[h][e];i.variables.forEach(n=>{var r;const i=n.node;if(null==i?void 0:i.attributes){let o=null,s=null;for(const e of i.attributes)"binding"===e.name?o=e.value:"group"===e.name&&(s=e.value);if(e==o&&h==s){let o=!1;for(const t of u.resources)if(t.name===n.name&&t.group===parseInt(h)&&t.binding===parseInt(e)){o=!0;break}if(o)if(void 0!==t.texture&&void 0!==t.descriptor){const e=new vS(t.texture,this.getTypeInfo(i.type),t.descriptor,null!==(r=t.texture.view)&&void 0!==r?r:null);n.value=e}else void 0!==t.uniform?n.value=new yS(t.uniform,this.getTypeInfo(i.type)):n.value=new yS(t,this.getTypeInfo(i.type))}}})}for(let h=0;h<l;++h)for(let e=0;e<a;++e)for(let t=0;t<s;++t)i.setVariable("@workgroup_id",new gS([t,e,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[t,e,h],i)}execStatement(e,t){if(e instanceof kw)return this.evalExpression(e.value,t);if(e instanceof Nw){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof pS))throw new Error("Invalid break-if condition");if(!n.value)return null}return WS._breakObj}if(e instanceof zw)return WS._continueObj;if(e instanceof yw)this._let(e,t);else if(e instanceof gw)this._var(e,t);else if(e instanceof vw)this._const(e,t);else if(e instanceof hw)this._function(e,t);else{if(e instanceof Iw)return this._if(e,t);if(e instanceof Pw)return this._switch(e,t);if(e instanceof mw)return this._for(e,t);if(e instanceof fw)return this._while(e,t);if(e instanceof Cw)return this._loop(e,t);if(e instanceof pw){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Tw)this._assign(e,t);else if(e instanceof Ew)this._increment(e,t);else{if(e instanceof jw)return null;if(e instanceof _w){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new pS(0,this.getTypeInfo("u32")))}else if(e instanceof Aw)this._call(e,t);else{if(e instanceof Ow)return null;if(e instanceof Lw)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof nS?this._evalBinaryOp(e,t):e instanceof Yw?this._evalLiteral(e,t):e instanceof Zw?this._evalVariable(e,t):e instanceof Xw?this._evalCall(e,t):e instanceof qw?this._evalCreate(e,t):e instanceof Kw?this._evalConst(e,t):e instanceof Jw?this._evalBitcast(e,t):e instanceof tS?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Fw){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const r=e[n],i=this.reflection.getOverrideInfo(n);null!==i?(null===i.type&&(i.type=this.getTypeInfo("u32")),"u32"===i.type.name||"i32"===i.type.name||"f32"===i.type.name||"f16"===i.type.name?t.setVariable(n,new pS(r,i.type)):"bool"===i.type.name?t.setVariable(n,new pS(r?1:0,i.type)):"vec2"===i.type.name||"vec3"===i.type.name||"vec4"===i.type.name||"vec2f"===i.type.name||"vec3f"===i.type.name||"vec4f"===i.type.name||"vec2i"===i.type.name||"vec3i"===i.type.name||"vec4i"===i.type.name||"vec2u"===i.type.name||"vec3u"===i.type.name||"vec4u"===i.type.name||"vec2h"===i.type.name||"vec3h"===i.type.name||"vec4h"===i.type.name?t.setVariable(n,new gS(r,i.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const r=[1,1,1];for(const c of e.node.attributes)if("workgroup_size"===c.name){if(c.value.length>0){const e=n.getVariableValue(c.value[0]);r[0]=e instanceof pS?e.value:parseInt(c.value[0])}if(c.value.length>1){const e=n.getVariableValue(c.value[1]);r[1]=e instanceof pS?e.value:parseInt(c.value[1])}if(c.value.length>2){const e=n.getVariableValue(c.value[2]);r[2]=e instanceof pS?e.value:parseInt(c.value[2])}}const i=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new gS(r,i));const s=r[0],a=r[1],l=r[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<a;++l)for(let a=0;a<s;++a,++u){const s=[a,l,c],h=[a+t[0]*r[0],l+t[1]*r[1],c+t[2]*r[2]];n.setVariable("@local_invocation_id",new gS(s,i)),n.setVariable("@global_invocation_id",new gS(h,i)),n.setVariable("@local_invocation_index",new pS(u,o)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const r=`@${e.value}`,i=t.getVariable(r);void 0!==i&&t.variables.set(n.name,i)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof tS;)e=e.right;return e instanceof Zw?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),r=this._execStatements(n,e);if(r)return r;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const r=t.getFunction(e.name);if(r){for(let t=0;t<r.node.args.length;++t){const i=r.node.args[t],o=this.evalExpression(e.args[t],n);n.setVariable(i.name,o,i)}this._execStatements(r.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),r=t.getVariable(n);r?"++"===e.operator?r.value instanceof pS?r.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):"--"===e.operator?r.value instanceof pS?r.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Zw){const n=this.getVariableName(e,t),r=t.getVariable(n);return null===r?(console.error(`Variable ${n} not found. Line ${e.line}`),null):r.value.getSubData(this,e.postfix,t)}if(e instanceof tS){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof fS?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new fS(n)}}return null}_assign(e,t){let n=null,r="<var>",i=null;if(e.variable instanceof tS){const n=this._getVariableData(e.variable,t),r=this.evalExpression(e.value,t),i=e.operator;if("="===i){if(n instanceof pS||n instanceof gS||n instanceof _S){if(r instanceof pS||r instanceof gS||r instanceof _S&&n.data.length===r.data.length)return void n.data.set(r.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(n instanceof yS&&r instanceof yS&&n.buffer.byteLength-n.offset>=r.buffer.byteLength-r.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(r.buffer,r.offset,r.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(r.buffer,r.offset,r.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if("+="===i)return n instanceof pS||n instanceof gS||n instanceof _S?r instanceof pS||r instanceof gS||r instanceof _S?void n.data.set(r.data.map((e,t)=>n.data[t]+e)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if("-="===i)return(n instanceof pS||n instanceof gS||n instanceof _S)&&(r instanceof pS||r instanceof gS||r instanceof _S)?void n.data.set(r.data.map((e,t)=>n.data[t]-e)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof tS){if("*"===e.variable.operator){r=this.getVariableName(e.variable.right,t);const i=t.getVariable(r);if(!(i&&i.value instanceof fS))return void console.error(`Variable ${r} is not a pointer. Line ${e.line}`);n=i.value.reference;let o=e.variable.postfix;if(!o){let t=e.variable.right;for(;t instanceof tS;){if(t.postfix){o=t.postfix;break}t=t.right}}o&&(n=n.getSubData(this,o,t))}}else{i=e.variable.postfix,r=this.getVariableName(e.variable,t);const o=t.getVariable(r);if(null===o)return void console.error(`Variable ${r} not found. Line ${e.line}`);n=o.value}if(n instanceof fS&&(n=n.reference),null===n)return void console.error(`Variable ${r} not found. Line ${e.line}`);const o=this.evalExpression(e.value,t),s=e.operator;if("="!==s){const r=n.getSubData(this,i,t);if(r instanceof gS&&o instanceof pS){const t=r.data,n=o.value;if("+="===s)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=n;else console.error(`Invalid operator ${s}. Line ${e.line}`)}else if(r instanceof gS&&o instanceof gS){const t=r.data,n=o.data;if(t.length!==n.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if("+="===s)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=n[e];else console.error(`Invalid operator ${s}. Line ${e.line}`)}else{if(!(r instanceof pS&&o instanceof pS))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);"+="===s?r.value+=o.value:"-="===s?r.value-=o.value:"*="===s?r.value*=o.value:"/="===s?r.value/=o.value:"%="===s?r.value%=o.value:"&="===s?r.value&=o.value:"|="===s?r.value|=o.value:"^="===s?r.value^=o.value:"<<="===s?r.value<<=o.value:">>="===s?r.value>>=o.value:console.error(`Invalid operator ${s}. Line ${e.line}`)}return void(n instanceof yS&&n.setDataValue(this,r,i,t))}if(n instanceof yS)n.setDataValue(this,o,i,t);else if(i){if(!(n instanceof gS||n instanceof _S))return void console.error(`Variable ${r} is not a vector or matrix. Line ${e.line}`);if(i instanceof Qw){const s=this.evalExpression(i.index,t).value;if(n instanceof gS){if(!(o instanceof pS))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[s]=o.value}else{if(!(n instanceof _S))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const s=this.evalExpression(i.index,t).value;if(s<0)return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(o instanceof gS))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(s<2&&2===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(s<2&&3===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(s<2&&4===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(s<3&&2===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(s<3&&3===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(s<3&&4===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(s<4&&2===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(s<4&&3===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(s<4&&4===o.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}}}}}else if(i instanceof Ww){const t=i.value;if(!(n instanceof gS))return void console.error(`Invalid assignment to ${t}. Variable ${r} is not a vector. Line ${e.line}`);if(o instanceof pS){if(t.length>1)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);if("x"===t)n.data[0]=o.value;else if("y"===t){if(n.data.length<2)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);n.data[1]=o.value}else if("z"===t){if(n.data.length<3)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);n.data[2]=o.value}else if("w"===t){if(n.data.length<4)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);n.data[3]=o.value}}else{if(!(o instanceof gS))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(t.length!==o.data.length)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);for(let i=0;i<t.length;++i){const s=t[i];if("x"===s||"r"===s)n.data[0]=o.data[i];else if("y"===s||"g"===s){if(o.data.length<2)return void console.error(`Invalid assignment to ${s} for variable ${r}. Line ${e.line}`);n.data[1]=o.data[i]}else if("z"===s||"b"===s){if(o.data.length<3)return void console.error(`Invalid assignment to ${s} for variable ${r}. Line ${e.line}`);n.data[2]=o.data[i]}else{if("w"!==s&&"a"!==s)return void console.error(`Invalid assignment to ${s} for variable ${r}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${s} for variable ${r}. Line ${e.line}`);n.data[3]=o.data[i]}}}}}else n instanceof pS&&o instanceof pS?n.value=o.value:n instanceof gS&&o instanceof gS||n instanceof _S&&o instanceof _S?n.data.set(o.data):console.error(`Invalid assignment to ${r}. Line ${e.line}`)}_function(e,t){const n=new jS(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof tS||(n=n.clone())}else{const r=e.type.name;if("f32"===r||"i32"===r||"u32"===r||"bool"===r||"f16"===r||"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2b"===r||"vec3b"===r||"vec4b"===r||"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r||"array"===r){const r=new qw(e.type,[]);n=this._evalCreate(r,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof tS||(n=n.clone())}else{if(null===e.type)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const r=e.type.name;if("f32"===r||"i32"===r||"u32"===r||"bool"===r||"f16"===r||"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2b"===r||"vec3b"===r||"vec4b"===r||"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r||e.type instanceof Gw||e.type instanceof jw||e.type instanceof Uw){const r=new qw(e.type,[]);n=this._evalCreate(r,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof pS))return console.error(`Invalid if condition. Line ${e.line}`),null;let r=null;for(const i of e.cases)if(i instanceof oS)for(const o of i.selectors){if(o instanceof iS){r=i;continue}const s=this.evalExpression(o,t);if(!(s instanceof pS))return console.error(`Invalid case selector. Line ${e.line}`),null;if(s.value===n.value)return this._execStatements(i.body,t)}else i instanceof sS&&(r=i);return r?this._execStatements(r.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof pS))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const r of e.elseif){const n=this.evalExpression(r.condition,t);if(!(n instanceof pS))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(r.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof pS?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===WS._breakObj)break;if(null!==n&&n!==WS._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===WS._breakObj)break;if(n===WS._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===WS._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===WS._breakObj)break;if(n!==WS._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),r=e.type;if(n instanceof pS){const e=LS(n.value,n.typeInfo.name,r.name);return new pS(e,this.getTypeInfo(r))}if(n instanceof gS){const t=n.typeInfo.getTypeName();let i="";if(t.endsWith("f"))i="f32";else if(t.endsWith("i"))i="i32";else if(t.endsWith("u"))i="u32";else if(t.endsWith("b"))i="bool";else{if(!t.endsWith("h"))return console.error(`Unknown vector type ${t}. Line ${e.line}`),null;i="f16"}const o=r.getTypeName();let s="";if(o.endsWith("f"))s="f32";else if(o.endsWith("i"))s="i32";else if(o.endsWith("u"))s="u32";else if(o.endsWith("b"))s="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;s="f16"}const a=function(e,t,n){if(t===n)return e;const r=new Array(e.length);for(let i=0;i<e.length;i++)r[i]=LS(e[i],t,n);return r}(Array.from(n.data),i,s);return new gS(a,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof qw){if(null===e.type)return dS.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const r=e instanceof qw?e.type.name:e.name,i=e instanceof qw?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===i)return console.error(`Unknown type ${r}. Line ${e.line}`),null;if(0===i.size)return null;const o=new yS(new ArrayBuffer(i.size),i,0);if(i instanceof Nb){if(e.args)for(let s=0;s<e.args.length;++s){const n=i.members[s],r=e.args[s],a=this.evalExpression(r,t);o.setData(this,a,n.type,n.offset,t)}}else if(i instanceof zb){let r=0;if(e.args)for(let s=0;s<e.args.length;++s){const a=e.args[s],l=this.evalExpression(a,t);null===i.format&&("x32"===(null===(n=l.typeInfo)||void 0===n?void 0:n.name)?i.format=this.getTypeInfo("i32"):i.format=l.typeInfo),o.setData(this,l,i.format,r,t),r+=i.stride}}else console.error(`Unknown type "${r}". Line ${e.line}`);return e instanceof qw?o.getSubData(this,e.postfix,t):o}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),r=n.name;return"x32"===r||"u32"===r||"f32"===r||"f16"===r||"i32"===r||"bool"===r?new pS(e.scalarValue,n):"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r?this._callConstructorVec(e,t):"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const r=WS._priority.get(t.name);WS._priority.get(e[n].name)<r&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new fS(n);if("*"===e.operator)return n instanceof fS?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const r=n instanceof pS?n.value:n instanceof gS?Array.from(n.data):null;switch(e.operator){case"+":{if(ES(r)){const e=r.map((e,t)=>+e);return new gS(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new pS(+e,t)}case"-":{if(ES(r)){const e=r.map((e,t)=>-e);return new gS(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new pS(-e,t)}case"!":{if(ES(r)){const e=r.map((e,t)=>e?0:1);return new gS(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new pS(e?0:1,t)}case"~":{if(ES(r)){const e=r.map((e,t)=>~e);return new gS(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new pS(~e,t)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),r=this.evalExpression(e.right,t),i=n instanceof pS?n.value:n instanceof gS||n instanceof _S?Array.from(n.data):null,o=r instanceof pS?r.value:r instanceof gS||r instanceof _S?Array.from(r.data):null;switch(e.operator){case"+":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e+r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t+e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e+t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t+s,a)}case"-":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e-r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t-e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e-t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t-s,a)}case"*":{if(ES(i)&&ES(o)){const t=i,s=o;if(n instanceof _S&&r instanceof _S){const i=function(e,t,n,r){if(void 0===$S[t.name]||void 0===$S[r.name])return null;const i=$S[t.name][0],o=$S[t.name][1],s=$S[r.name][0];if(i!==$S[r.name][1])return null;const a=new Array(s*o);for(let l=0;l<o;l++)for(let t=0;t<s;t++){let r=0;for(let s=0;s<i;s++)r+=e[s*o+l]*n[t*i+s];a[l*s+t]=r}return a}(t,n.typeInfo,s,r.typeInfo);if(null===i)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const o=$S[r.typeInfo.name][0],a=$S[n.typeInfo.name][1],l=this.getTypeInfo(`mat${o}x${a}f`);return new _S(i,l)}if(n instanceof _S&&r instanceof gS){const i=function(e,t,n,r){if(void 0===$S[t.name]||void 0===HS[r.name])return null;const i=$S[t.name][0],o=$S[t.name][1];if(i!==n.length)return null;const s=new Array(o);for(let a=0;a<o;a++){let t=0;for(let r=0;r<i;r++)t+=e[r*o+a]*n[r];s[a]=t}return s}(t,n.typeInfo,s,r.typeInfo);return null===i?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new gS(i,r.typeInfo)}if(n instanceof gS&&r instanceof _S){const i=function(e,t,n,r){if(void 0===HS[t.name]||void 0===$S[r.name])return null;const i=$S[r.name][0],o=$S[r.name][1];if(o!==e.length)return null;const s=[];for(let a=0;a<i;a++){let t=0;for(let r=0;r<o;r++)t+=e[r]*n[r*i+a];s[a]=t}return s}(t,n.typeInfo,s,r.typeInfo);return null===i?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new gS(i,n.typeInfo)}{if(t.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const r=t.map((e,t)=>e*s[t]);return new gS(r,n.typeInfo)}}if(ES(i)){const e=o,t=i.map((t,n)=>t*e);return n instanceof _S?new _S(t,n.typeInfo):new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e*t);return r instanceof _S?new _S(t,r.typeInfo):new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t*s,a)}case"%":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e%r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t%e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e%t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t%s,a)}case"/":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e/r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t/e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e/t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t/s,a)}case"&":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e&r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t&e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e&t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t&s,a)}case"|":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e|r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t|e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e|t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t|s,a)}case"^":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e^r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t^e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e^t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t^s,a)}case"<<":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e<<r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t<<e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e<<t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t<<s,a)}case">>":{if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e>>r[t]);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t>>e);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e>>t);return new gS(t,r.typeInfo)}const t=i,s=o,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new pS(t>>s,a)}case">":if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e>r[t]?1:0);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t>e?1:0);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e>t?1:0);return new gS(t,r.typeInfo)}return new pS(i>o?1:0,this.getTypeInfo("bool"));case"<":if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e<r[t]?1:0);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t<e?1:0);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e<t?1:0);return new gS(t,r.typeInfo)}return new pS(i<o?1:0,this.getTypeInfo("bool"));case"==":if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e===r[t]?1:0);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t==e?1:0);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e==t?1:0);return new gS(t,r.typeInfo)}return new pS(i===o?1:0,this.getTypeInfo("bool"));case"!=":if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e!==r[t]?1:0);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t!==e?1:0);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e!==t?1:0);return new gS(t,r.typeInfo)}return new pS(i!==o?1:0,this.getTypeInfo("bool"));case">=":if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e>=r[t]?1:0);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t>=e?1:0);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e>=t?1:0);return new gS(t,r.typeInfo)}return new pS(i>=o?1:0,this.getTypeInfo("bool"));case"<=":if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e<=r[t]?1:0);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t<=e?1:0);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e<=t?1:0);return new gS(t,r.typeInfo)}return new pS(i<=o?1:0,this.getTypeInfo("bool"));case"&&":if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e&&r[t]?1:0);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t&&e?1:0);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e&&t?1:0);return new gS(t,r.typeInfo)}return new pS(i&&o?1:0,this.getTypeInfo("bool"));case"||":if(ES(i)&&ES(o)){const t=i,r=o;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e||r[t]?1:0);return new gS(s,n.typeInfo)}if(ES(i)){const e=o,t=i.map((t,n)=>t||e?1:0);return new gS(t,n.typeInfo)}if(ES(o)){const e=i,t=o.map((t,n)=>e||t?1:0);return new gS(t,r.typeInfo)}return new pS(i||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const r=t.getFunction(e.name);if(!r)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let i=0;i<r.node.args.length;++i){const t=r.node.args[i],o=this.evalExpression(e.args[i],n);n.createVariable(t.name,o,t)}return this._execStatements(r.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const r=t.clone();for(let t=0;t<n.node.args.length;++t){const i=n.node.args[t],o=this.evalExpression(e.args[t],r);r.setVariable(i.name,o,i)}return this._execStatements(n.node.body,r)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new pS(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),r=e.type.getTypeName(),i=HS[r];if(void 0===i)return console.error(`Invalid vec constructor ${r}. Line ${e.line}`),null;const o=[];if(e instanceof Yw)if(e.isVector){const t=e.vectorValue;for(const e of t)o.push(e)}else o.push(e.scalarValue);else if(e.args)for(const s of e.args){const e=this.evalExpression(s,t);if(e instanceof gS){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];o.push(n)}}else if(e instanceof pS){let t=e.value;o.push(t)}}if(e.type instanceof Uw&&null===e.type.format&&(e.type.format=Uw.f32),0===o.length){const r=new Array(i).fill(0);return new gS(r,n).getSubData(this,e.postfix,t)}if(1===o.length)for(;o.length<i;)o.push(o[0]);return o.length<i?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new gS(o.length>i?o.slice(0,i):o,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),r=e.type.getTypeName(),i=$S[r];if(void 0===i)return console.error(`Invalid matrix constructor ${r}. Line ${e.line}`),null;const o=[];if(e instanceof Yw)if(e.isVector){const t=e.vectorValue;for(const e of t)o.push(e)}else o.push(e.scalarValue);else if(e.args)for(const s of e.args){const e=this.evalExpression(s,t);e instanceof gS?o.push(...e.data):e instanceof pS?o.push(e.value):e instanceof _S&&o.push(...e.data)}if(n instanceof Bb&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===o.length){const r=new Array(i[2]).fill(0);return new _S(r,n).getSubData(this,e.postfix,t)}return o.length!==i[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new _S(o,n).getSubData(this,e.postfix,t)}}WS._breakObj=new hS(new Lb("BREAK",null),null),WS._continueObj=new hS(new Lb("CONTINUE",null),null),WS._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class qS{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class XS{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new qS,this._exec=new WS,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const t of this._deferArrayCountEval){const n=t.arrayType,r=t.countNode;if(r instanceof Zw){const t=r.name,i=this._context.constants.get(t);if(i)try{const e=i.constEvaluate(this._exec);n.count=e}catch(e){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search(e=>{e instanceof cS||e instanceof Vw?e.type=this._forwardType(e.type):e instanceof Gw?e.format=this._forwardType(e.format):e instanceof gw||e instanceof yw||e instanceof vw?e.type=this._forwardType(e.type):e instanceof hw?e.returnType=this._forwardType(e.returnType):e instanceof aS&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof Bw){const t=this._getType(e.name);if(t)return t}else e instanceof Vw?e.type=this._forwardType(e.type):e instanceof Gw&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new SS(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==bS.eof}_match(e){if(e instanceof xS)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let r=!1;for(const t of e){if(n===t)return!0;t===bS.tokens.name&&(r=!0)}if(r){const e=bS.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===bS.tokens.name){const e=bS.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(bS.tokens.semicolon)&&!this._isAtEnd(););if(this._match(bS.keywords.alias)){const e=this._type_alias();return this._consume(bS.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(bS.keywords.diagnostic)){const e=this._diagnostic();return this._consume(bS.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(bS.keywords.requires)){const e=this._requires_directive();return this._consume(bS.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(bS.keywords.enable)){const e=this._enable_directive();return this._consume(bS.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(bS.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(bS.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(bS.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(bS.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(bS.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(bS.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(bS.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(bS.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(bS.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(bS.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(bS.keywords.fn))return null;const e=this._currentLine,t=this._consume(bS.tokens.ident,"Expected function name.").toString();this._consume(bS.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(bS.tokens.paren_right))do{if(this._check(bS.tokens.paren_right))break;const e=this._attribute(),t=this._consume(bS.tokens.name,"Expected argument name.").toString();this._consume(bS.tokens.colon,"Expected ':' for argument type.");const r=this._attribute(),i=this._type_decl();null!=i&&(i.attributes=r,n.push(this._updateNode(new aS(t,i,e))))}while(this._match(bS.tokens.comma));this._consume(bS.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(bS.tokens.arrow)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}const i=this._compound_statement(),o=this._currentLine;return this._updateNode(new hw(t,n,r,i,e,o),e)}_compound_statement(){const e=[];for(this._consume(bS.tokens.brace_left,"Expected '{' for block.");!this._check(bS.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(bS.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(bS.tokens.semicolon)&&!this._isAtEnd(););if(this._check(bS.tokens.attr)&&this._attribute(),this._check(bS.keywords.if))return this._if_statement();if(this._check(bS.keywords.switch))return this._switch_statement();if(this._check(bS.keywords.loop))return this._loop_statement();if(this._check(bS.keywords.for))return this._for_statement();if(this._check(bS.keywords.while))return this._while_statement();if(this._check(bS.keywords.continuing))return this._continuing_statement();if(this._check(bS.keywords.static_assert))return this._static_assert_statement();if(this._check(bS.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(bS.keywords.return))e=this._return_statement();else if(this._check([bS.keywords.var,bS.keywords.let,bS.keywords.const]))e=this._variable_statement();else if(this._match(bS.keywords.discard))e=this._updateNode(new Dw);else if(this._match(bS.keywords.break)){const t=this._updateNode(new Nw);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(bS.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(bS.keywords.continue)){const t=this._updateNode(new zw);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(bS.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(bS.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new dw(t),e)}_while_statement(){if(!this._match(bS.keywords.while))return null;const e=this._updateNode(new fw(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(bS.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(bS.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new pw(n,e),t)}_for_statement(){if(!this._match(bS.keywords.for))return null;this._consume(bS.tokens.paren_left,"Expected '('.");const e=this._updateNode(new mw(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(bS.tokens.semicolon)?null:this._for_init(),this._consume(bS.tokens.semicolon,"Expected ';'."),e.condition=this._check(bS.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(bS.tokens.semicolon,"Expected ';'."),e.increment=this._check(bS.tokens.paren_right)?null:this._for_increment(),this._consume(bS.tokens.paren_right,"Expected ')'."),this._check(bS.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(bS.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(bS.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new gw(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(bS.keywords.let)){const e=this._currentLine,t=this._consume(bS.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(bS.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(bS.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new yw(t,n,null,null,r),e)}if(this._match(bS.keywords.const)){const e=this._currentLine,t=this._consume(bS.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(bS.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(bS.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return null===n&&r instanceof Yw&&(n=r.type),this._updateNode(new vw(t,n,null,null,r),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(bS.increment_operators))return this._current=e,null;const n=this._consume(bS.increment_operators,"Expected increment operator");return this._updateNode(new Ew(n.type===bS.tokens.plus_plus?xw.increment:xw.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(bS.tokens.brace_right))return null;let n=this._match(bS.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const r=this._consume(bS.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return this._updateNode(new Tw(bw.parse(r.lexeme),e,i),t)}_func_call_statement(){if(!this._check(bS.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(bS.tokens.ident,"Expected function name."),r=this._argument_expression_list();return null===r?(this._current=t,null):this._updateNode(new Aw(n.lexeme,r),e)}_loop_statement(){if(!this._match(bS.keywords.loop))return null;this._check(bS.tokens.attr)&&this._attribute(),this._consume(bS.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Cw([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof pw){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(bS.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(bS.keywords.switch))return null;const e=this._updateNode(new Pw(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(bS.tokens.attr)&&this._attribute(),this._consume(bS.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(bS.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([bS.keywords.default,bS.keywords.case]);){if(this._match(bS.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof iS){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(bS.tokens.colon),this._check(bS.tokens.attr)&&this._attribute(),this._consume(bS.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(bS.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new oS(n,r)))}if(this._match(bS.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(bS.tokens.colon),this._check(bS.tokens.attr)&&this._attribute(),this._consume(bS.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(bS.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new sS(n)))}}return e}_case_selectors(){const e=[];for(this._match(bS.keywords.default)?e.push(this._updateNode(new iS)):e.push(this._shift_expression());this._match(bS.tokens.comma);)this._match(bS.keywords.default)?e.push(this._updateNode(new iS)):e.push(this._shift_expression());return e}_case_body(){if(this._match(bS.keywords.fallthrough))return this._consume(bS.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(bS.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(bS.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(bS.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let i=null;return this._match(bS.keywords.else)&&(this._check(bS.tokens.attr)&&this._attribute(),i=this._compound_statement()),this._updateNode(new Iw(t,n,r,i),e)}_match_elseif(){return this._tokens[this._current].type===bS.keywords.else&&this._tokens[this._current+1].type===bS.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new lS(t,n))),this._match_elseif()&&(this._check(bS.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(bS.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new kw(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(bS.tokens.or_or);)e=this._updateNode(new nS(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(bS.tokens.and_and);)e=this._updateNode(new nS(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(bS.tokens.or);)e=this._updateNode(new nS(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(bS.tokens.xor);)e=this._updateNode(new nS(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(bS.tokens.and);)e=this._updateNode(new nS(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([bS.tokens.equal_equal,bS.tokens.not_equal])?this._updateNode(new nS(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([bS.tokens.less_than,bS.tokens.greater_than,bS.tokens.less_than_equal,bS.tokens.greater_than_equal]);)e=this._updateNode(new nS(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([bS.tokens.shift_left,bS.tokens.shift_right]);)e=this._updateNode(new nS(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([bS.tokens.plus,bS.tokens.minus]);)e=this._updateNode(new nS(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([bS.tokens.star,bS.tokens.forward_slash,bS.tokens.modulo]);)e=this._updateNode(new nS(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([bS.tokens.minus,bS.tokens.bang,bS.tokens.tilde,bS.tokens.star,bS.tokens.and])?this._updateNode(new tS(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(bS.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(bS.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Qw(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(bS.tokens.period)){const e=this._consume(bS.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new Ww(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return Fw.void;case"bool":return Fw.bool;case"i32":return Fw.i32;case"u32":return Fw.u32;case"f32":return Fw.f32;case"f16":return Fw.f16;case"vec2f":return Uw.vec2f;case"vec3f":return Uw.vec3f;case"vec4f":return Uw.vec4f;case"vec2i":return Uw.vec2i;case"vec3i":return Uw.vec3i;case"vec4i":return Uw.vec4i;case"vec2u":return Uw.vec2u;case"vec3u":return Uw.vec3u;case"vec4u":return Uw.vec4u;case"vec2h":return Uw.vec2h;case"vec3h":return Uw.vec3h;case"vec4h":return Uw.vec4h;case"mat2x2f":return Uw.mat2x2f;case"mat2x3f":return Uw.mat2x3f;case"mat2x4f":return Uw.mat2x4f;case"mat3x2f":return Uw.mat3x2f;case"mat3x3f":return Uw.mat3x3f;case"mat3x4f":return Uw.mat3x4f;case"mat4x2f":return Uw.mat4x2f;case"mat4x3f":return Uw.mat4x3f;case"mat4x4f":return Uw.mat4x4f;case"mat2x2h":return Uw.mat2x2h;case"mat2x3h":return Uw.mat2x3h;case"mat2x4h":return Uw.mat2x4h;case"mat3x2h":return Uw.mat3x2h;case"mat3x3h":return Uw.mat3x3h;case"mat3x4h":return Uw.mat3x4h;case"mat4x2h":return Uw.mat4x2h;case"mat4x3h":return Uw.mat4x3h;case"mat4x4h":return Uw.mat4x4h;case"mat2x2i":return Uw.mat2x2i;case"mat2x3i":return Uw.mat2x3i;case"mat2x4i":return Uw.mat2x4i;case"mat3x2i":return Uw.mat3x2i;case"mat3x3i":return Uw.mat3x3i;case"mat3x4i":return Uw.mat3x4i;case"mat4x2i":return Uw.mat4x2i;case"mat4x3i":return Uw.mat4x3i;case"mat4x4i":return Uw.mat4x4i;case"mat2x2u":return Uw.mat2x2u;case"mat2x3u":return Uw.mat2x3u;case"mat2x4u":return Uw.mat2x4u;case"mat3x2u":return Uw.mat3x2u;case"mat3x3u":return Uw.mat3x3u;case"mat3x4u":return Uw.mat3x4u;case"mat4x2u":return Uw.mat4x2u;case"mat4x3u":return Uw.mat4x3u;case"mat4x4u":return Uw.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(bS.tokens.ident)){const e=this._previous().toString();if(this._check(bS.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new qw(n,t)):this._updateNode(new Xw(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new Kw(e,t.value))}return this._updateNode(new Zw(e))}if(this._match(bS.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?Fw.i32:e.endsWith("u")||e.endsWith("U")?Fw.u32:Fw.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new Yw(new pS(n,this._exec.getTypeInfo(t)),t))}if(this._match(bS.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,Fw.u32),this._updateNode(new Yw(new pS(e,this._exec.getTypeInfo(Fw.u32)),Fw.u32))}if(this._match([bS.tokens.decimal_float_literal,bS.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?Fw.f16:Fw.f32);const r=t?Fw.f16:Fw.f32;return this._updateNode(new Yw(new pS(n,this._exec.getTypeInfo(r)),r))}if(this._match([bS.keywords.true,bS.keywords.false])){let e=this._previous().toString()===bS.keywords.true.rule;return this._updateNode(new Yw(new pS(e?1:0,this._exec.getTypeInfo(Fw.bool)),Fw.bool))}if(this._check(bS.tokens.paren_left))return this._paren_expression();if(this._match(bS.keywords.bitcast)){this._consume(bS.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(bS.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new Jw(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new qw(e,t))}_argument_expression_list(){if(!this._match(bS.tokens.paren_left))return null;const e=[];do{if(this._check(bS.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(bS.tokens.comma));return this._consume(bS.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(bS.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(bS.tokens.paren_right),e}_paren_expression(){this._consume(bS.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(bS.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(bS.keywords.struct))return null;const e=this._currentLine,t=this._consume(bS.tokens.ident,"Expected name for struct.").toString();this._consume(bS.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(bS.tokens.brace_right);){const e=this._attribute(),t=this._consume(bS.tokens.name,"Expected variable name.").toString();this._consume(bS.tokens.colon,"Expected ':' for struct member type.");const r=this._attribute(),i=this._type_decl();null!=i&&(i.attributes=r),this._check(bS.tokens.brace_right)?this._match(bS.tokens.comma):this._consume(bS.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new cS(t,i,e)))}this._consume(bS.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,i=this._updateNode(new jw(t,n,e,r),e);return this._context.structs.set(t,i),i}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(bS.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof Yw){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof Yw&&(e.type="x32"===e.value.type.name?Fw.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(bS.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(bS.keywords.const))return null;const t=this._consume(bS.tokens.name,"Expected variable name"),n=this._currentLine;let r=null;if(this._match(bS.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}let i=null;this._consume(bS.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let e=[Fw.f32],n=o.constEvaluate(this._exec,e);n instanceof pS&&this._validateTypeRange(n.value,e[0]),e[0]instanceof Uw&&null===e[0].format&&n.typeInfo instanceof Bb&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=Fw.f16:"f32"===n.typeInfo.format.name?e[0].format=Fw.f32:"i32"===n.typeInfo.format.name?e[0].format=Fw.i32:"u32"===n.typeInfo.format.name?e[0].format=Fw.u32:"bool"===n.typeInfo.format.name?e[0].format=Fw.bool:console.error(`TODO: impelement template format type ${n.typeInfo.format.name}`)),i=this._updateNode(new Yw(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch(e){i=o}if(null!==r&&i instanceof Yw){if("x32"!==i.type.name&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r,i.isScalar&&this._validateTypeRange(i.scalarValue,i.type)}else null===r&&i instanceof Yw&&(r=null!==(e=null==i?void 0:i.type)&&void 0!==e?e:Fw.f32,r===Fw.x32&&(r=Fw.i32));const s=this._updateNode(new vw(t.toString(),r,"","",i),n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(bS.keywords.let))return null;const e=this._currentLine,t=this._consume(bS.tokens.name,"Expected variable name");let n=null;if(this._match(bS.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let r=null;if(this._match(bS.tokens.equal)&&(r=this._const_expression()),null!==n&&r instanceof Yw){if("x32"!==r.type.name&&n.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${n.name}. Line:${this._currentLine}`);r.type=n}else null===n&&r instanceof Yw&&(n="x32"===r.type.name?Fw.i32:r.type);return r instanceof Yw&&r.isScalar&&this._validateTypeRange(r.scalarValue,n),this._updateNode(new yw(t.toString(),n,"","",r),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(bS.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(bS.tokens.less_than)&&(t=this._consume(bS.storage_class,"Expected storage_class.").toString(),this._match(bS.tokens.comma)&&(n=this._consume(bS.access_mode,"Expected access_mode.").toString()),this._consume(bS.tokens.greater_than,"Expected '>'."));const r=this._consume(bS.tokens.name,"Expected variable name");let i=null;if(this._match(bS.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}return this._updateNode(new gw(r.toString(),i,t,n,null),e)}_override_decl(){if(!this._match(bS.keywords.override))return null;const e=this._consume(bS.tokens.name,"Expected variable name");let t=null;if(this._match(bS.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new _w(e.toString(),t,null))}_diagnostic(){this._consume(bS.tokens.paren_left,"Expected '('");const e=this._consume(bS.tokens.ident,"Expected severity control name.");this._consume(bS.tokens.comma,"Expected ','");let t=this._consume(bS.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(bS.tokens.period)&&(t+=`.${this._consume(bS.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(bS.tokens.paren_right,"Expected ')'"),this._updateNode(new Ow(e.toString(),t))}_enable_directive(){const e=this._consume(bS.tokens.ident,"identity expected.");return this._updateNode(new Mw(e.toString()))}_requires_directive(){const e=[this._consume(bS.tokens.ident,"identity expected.").toString()];for(;this._match(bS.tokens.comma);){const t=this._consume(bS.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Rw(e))}_type_alias(){const e=this._consume(bS.tokens.ident,"identity expected.");this._consume(bS.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new Lw(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([bS.tokens.ident,...bS.texel_format,bS.keywords.bool,bS.keywords.f32,bS.keywords.i32,bS.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new Bw(e));return this._forwardTypeCount++,t}return this._updateNode(new Fw(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(bS.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(bS.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(bS.tokens.comma)&&(n=this._consume(bS.access_mode,"Expected access_mode for pointer").toString()),this._consume(bS.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Uw(e,t,n))}if(this._match(bS.keywords.ptr)){let e=this._previous().toString();this._consume(bS.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(bS.storage_class,"Expected storage_class for pointer");this._consume(bS.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let r=null;return this._match(bS.tokens.comma)&&(r=this._consume(bS.access_mode,"Expected access_mode for pointer").toString()),this._consume(bS.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Vw(e,t.toString(),n,r))}const t=this._attribute();if(this._match(bS.keywords.array)){let n=null,r=-1;const i=this._previous();let o=null;if(this._match(bS.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let t="";if(this._match(bS.tokens.comma)){o=this._shift_expression();try{t=o.constEvaluate(this._exec).toString(),o=null}catch(e){t="1"}}this._consume(bS.tokens.greater_than,"Expected '>' for array."),r=t?parseInt(t):0}const s=this._updateNode(new Gw(i.toString(),t,n,r));return o&&this._deferArrayCountEval.push({arrayType:s,countNode:o}),s}return null}_texture_sampler_types(){if(this._match(bS.sampler_type))return this._updateNode(new Hw(this._previous().toString(),null,null));if(this._match(bS.depth_texture_type))return this._updateNode(new Hw(this._previous().toString(),null,null));if(this._match(bS.sampled_texture_type)||this._match(bS.multisampled_texture_type)){const e=this._previous();this._consume(bS.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(bS.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Hw(e.toString(),t,null))}if(this._match(bS.storage_texture_type)){const e=this._previous();this._consume(bS.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(bS.texel_format,"Invalid texel format.").toString();this._consume(bS.tokens.comma,"Expected ',' after texel format.");const n=this._consume(bS.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(bS.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Hw(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(bS.tokens.attr);){const t=this._consume(bS.attribute_name,"Expected attribute name"),n=this._updateNode(new uS(t.toString(),null));if(this._match(bS.tokens.paren_left)){if(n.value=this._consume(bS.literal_or_ident,"Expected attribute value").toString(),this._check(bS.tokens.comma)){this._advance();do{const e=this._consume(bS.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(bS.tokens.comma))}this._consume(bS.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class ZS extends zS{constructor(e){super(),e&&this.update(e)}update(e){const t=(new XS).parse(e);this.updateAST(t)}}function KS(e){const t={attributes:[],bindings:[]};let n;try{n=function(e){try{return new ZS(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"===typeof t&&t?.message&&(e+=`: ${t.message} `),"object"===typeof t&&t?.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e)}catch(o){return $_.error(o.message)(),t}for(const s of n.uniforms){const e=[];for(const t of s.type?.members||[])e.push({name:t.name,type:YS(t.type)});t.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:e})}for(const s of n.textures)t.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of n.samplers)t.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const r=n.entry.vertex[0],i=r?.inputs.length||0;for(let s=0;s<i;s++){const e=r.inputs[s];if("location"===e.locationType){const n=YS(e.type);t.attributes.push({name:e.name,location:Number(e.location),type:n})}}return t}function YS(e){return e.format?`${e.name}<${e.format.name}>`:e.name}const JS={};function QS(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";JS[e]=JS[e]||1;return`${e}-${JS[e]++}`}class eE{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||QS("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Z_.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function tE(e,t){if(t instanceof eE)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:Z_.INDEX,data:n})}(e,t),{attributes:r,bufferLayout:i}=function(e,t){const n=[],r={};for(const[o,s]of Object.entries(t.attributes)){let t=o;switch(o){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(s){r[t]=e.createBuffer({data:s.value,id:`${o}-buffer`});const{value:i,size:a,normalized:l}=s;n.push({name:t,format:cb(i,a,l)})}}const i=t._calculateVertexCount(t.attributes,t.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}(e,t);return new eE({topology:t.topology||"triangle-list",bufferLayout:i,vertexCount:t.vertexCount,indices:n,attributes:r})}class nE extends X_{static defaultProps=(()=>({...X_.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}))();get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,nE.defaultProps),this.shaderLayout=t.shaderLayout}}class rE{static defaultProps={...ax.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new rE(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t={...ax.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const e=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=n,this._renderPipelineCache[n]={pipeline:e,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...nE.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const e=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=n,this._computePipelineCache[n]={pipeline:e,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof nE?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,0===n[t].useCount&&"unused"===this.destroyPolicy&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,r=this._getHash(JSON.stringify(e.bufferLayout));if("webgl"===this.device.type)return`${t}/${n}V-BL${r}`;{const i=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V-T${e.topology}P${i}BL${r}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class iE{static defaultProps={...kv.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new iE(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:r,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,0===n.useCount&&"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}let oE=null,sE=null;function aE(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!aE(e[r],t[r],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"===typeof e&&"object"===typeof t){const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const o of r){if(!t.hasOwnProperty(o))return!1;if(!aE(e[o],t[o],n-1))return!1}return!0}return!1}function lE(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const r=e[n];!function(e){return yx(e)||"number"===typeof e||"boolean"===typeof e}(r)?t.bindings[n]=r:t.uniforms[n]=r}),t}class cE{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const n=Wc(Object.values(e).filter(e=>e.dependencies));for(const r of n)e[r.name]=r;$_.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e))this._addModule(i),i.name&&r!==i.name&&!this.options.disableWarnings&&$_.warn(`Module name: ${r} vs ${i.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,r=e[n]||{},i=this.modules[n];if(!i){this.options.disableWarnings||$_.warn(`Module ${t} not found`)();continue}const o=this.moduleUniforms[n],s=this.moduleBindings[n],a=i.getUniforms?.(r,o)||r,{uniforms:l,bindings:c}=lE(a);this.moduleUniforms[n]={...o,...l},this.moduleBindings[n]={...s,...c}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,n]of Object.entries(this.moduleUniforms))for(const[r,i]of Object.entries(n))e[`${t}.${r}`]={type:this.modules[t].uniformTypes?.[r],value:String(i)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let uE="";async function hE(e,t){const n=new Image;return n.crossOrigin=t?.crossOrigin||"anonymous",n.src=e.startsWith("http")?e:uE+e,await n.decode(),t?await createImageBitmap(n,t):await createImageBitmap(n)}class dE{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||QS("async-texture"),"string"===typeof t?.data&&"2d"===t.dimension&&(t={...t,data:hE(t.data)}),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(t)}async initAsync(e){const t=e.data;let n;try{n=await fE(t)}catch(i){this.rejectReady(i)}if(this.destroyed)return;const r={...e,data:n};this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function fE(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(fE));if(e&&"object"===typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),r=Object.keys(t),i={};for(let e=0;e<r.length;e++)i[r[e]]=n[e];return i}return e}class pE{static defaultProps=(()=>({...ax.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:hu.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0}))();device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...pE.defaultProps,...t},t=this.props,this.id=t.id||QS("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(this.props.modules?.map(e=>[e.name,e])||[]),r=t.shaderInputs||new cE(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const i=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:i,...this.props,modules:o});this.source=e,this._getModuleUniforms=t,this.props.shaderLayout||=KS(this.source)}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:i,...this.props,modules:o});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||rE.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||iE.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return $_.info(2,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings}),gE(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,i=r?r.byteLength/("uint32"===r.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&tE(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const e=new Ab(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Ab(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){aE(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Ob(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(mE(n)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=e}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=t?.disableWarnings??this.props.disableWarnings;e.indices&&$_.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map(e=>[e.name,e.location])),r=t.slice();return r.sort((e,t)=>{const r=e.attributes?e.attributes.map(e=>e.attribute):[e.name],i=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...r.map(e=>n[e]))-Math.min(...i.map(e=>n[e]))}),r}(this.pipeline.shaderLayout,this.bufferLayout);const r=new Ab(this.bufferLayout);for(const[i,o]of Object.entries(e)){const e=r.getBufferLayout(i);if(!e){n||$_.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const t=r.getAttributeNamesForBuffer(e);let s=!1;for(const n of t){const e=this._attributeInfos[n];if(e){const t="webgpu"===this.device.type?r.getBufferIndex(e.bufferName):e.location;this.vertexArray.setBuffer(t,o),s=!0}}s||n||$_.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,r]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,r):(t?.disableWarnings??this.props.disableWarnings)||$_.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){gE(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:n}=lE(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof dE&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof dE?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof qv?e=Math.max(e,t.texture.updateTimestamp):t instanceof Z_||t instanceof hv?e=Math.max(e,t.updateTimestamp):t instanceof dE?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Dv||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(e=>e.name===n)||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&($_.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:r}),this._attributeInfos=Ox(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=$_.level>3?0:1e4;$_.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,$_.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:$_.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){const t={},n="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const r of e.attributes)r&&(t[`in ${r.location} ${r.name}: ${r.type}`]={[n]:r.stepMode||"vertex"});for(const r of e.varyings||[])t[`out ${r.location} ${r.name}`]={[n]:JSON.stringify(r)};return t}(this.pipeline.shaderLayout,this.id);$_.table(2,e)();const t=this.shaderInputs.getDebugTable();for(const[r,i]of Object.entries(this.uniforms))t[r]={value:i};$_.table(2,t)();const n=this._getAttributeDebugTable();$_.table(2,this._attributeInfos)(),$_.table(2,n)(),$_.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,t){let{id:n,minimap:r,opaque:i,top:o="0",left:s="0",rgbaScale:a=1}=t;oE||(oE=document.createElement("canvas"),oE.id=n,oE.title=n,oE.style.zIndex="100",oE.style.position="absolute",oE.style.top=o,oE.style.left=s,oE.style.border="blue 5px solid",oE.style.transform="scaleY(-1)",document.body.appendChild(oE),sE=oE.getContext("2d")),oE.width===e.width&&oE.height===e.height||(oE.width=e.width/2,oE.height=e.height/2,oE.style.width="400px",oE.style.height="400px");const l=e.device.readPixelsToArrayWebGL(e),c=sE?.createImageData(e.width,e.height);if(c){const e=0;for(let t=0;t<l.length;t+=4)c.data[e+t+0]=l[t+0]*a,c.data[e+t+1]=l[t+1]*a,c.data[e+t+2]=l[t+2]*a,c.data[e+t+3]=i?255:l[t+3]*a;sE?.putImageData(c,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:r?this._getBufferOrConstantValues(r,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=lb(t);return(e instanceof Z_?new n(e.debugData):e).toString()}}function mE(e){return Boolean(e.uniformTypes&&!gE(e.uniformTypes))}function gE(e){for(const t in e)return!1;return!0}class _E{device;model;transformFeedback;static defaultProps=(()=>({...pE.defaultProps,outputs:void 0,feedbackBuffers:void 0}))();static isSupported(e){return"webgl"===e?.info?.type}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_E.defaultProps;if(!_E.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new pE(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||Tb(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Z_)return t.readAsync();const{buffer:n,byteOffset:r=0,byteLength:i=n.byteLength}=t;return n.readAsync(r,i)}}function yE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.fround(e),i=e-r;return t[n]=r,t[n+1]=i,t}function vE(e){return e-Math.fround(e)}function xE(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=4*n+r;yE(e[4*r+n],t,2*i)}return t}const bE={name:"fp64arithmetic",vs:"\nuniform fp64arithmeticUniforms {\n  uniform float ONE;\n} fp64;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' form.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * fp64.ONE - (t - a);\n  float a_lo = a * fp64.ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * fp64.ONE;\n  float err = b - (sum - a) * fp64.ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *\n    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:yE,fp64LowPart:vE,fp64ifyMatrix4:xE};function wE(e){const{source:t,target:n,start:r=0,size:i,getData:o}=e,s=e.end||n.length,a=t.length,l=s-r;if(a>l)return void n.set(t.subarray(0,l),r);if(n.set(t,r),!o)return;let c=a;for(;c<l;){const e=o(c,t);for(let t=0;t<i;t++)n[r+c]=e[t]||0,c++}}function SE(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function EE(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function TE(e){e.push(e.shift())}function AE(e){let{device:t,source:n,target:r}=e;return(!r||r.byteLength<n.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:n.byteLength,usage:n.usage})),r}function CE(e){let{device:t,buffer:n,attribute:r,fromLength:i,toLength:o,fromStartIndices:s,getData:a=e=>e}=e;const l=r.doublePrecision&&r.value instanceof Float64Array?2:1,c=r.size*l,u=r.byteOffset,h=r.settings.bytesPerElement<4?u/r.settings.bytesPerElement*4:u,d=r.startIndices,f=s&&d,p=r.isConstant;if(!f&&n&&i>=o)return n;const m=r.value instanceof Float64Array?Float32Array:r.value.constructor,g=p?r.value:new m(r.getBuffer().readSyncWebGL(u,o*m.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!p){const e=a;a=(t,n)=>r.normalizeConstant(e(t,n))}const _=p?(e,t)=>a(g,t):(e,t)=>a(g.subarray(e+u,e+u+c),t),y=n?new Float32Array(n.readSyncWebGL(h,4*i).buffer):new Float32Array(0),v=new Float32Array(o);return function(e){let{source:t,target:n,size:r,getData:i,sourceStartIndices:o,targetStartIndices:s}=e;if(!o||!s)return wE({source:t,target:n,size:r,getData:i}),n;let a=0,l=0;const c=i&&((e,t)=>i(e+l,t)),u=Math.min(o.length,s.length);for(let h=1;h<u;h++){const e=o[h]*r,i=s[h]*r;wE({source:t.subarray(a,e),target:n,start:l,end:i,size:r,getData:c}),a=e,l=i}l<n.length&&wE({source:[],target:n,start:l,size:r,getData:c})}({source:y,target:v,sourceStartIndices:s,targetStartIndices:d,size:c,getData:_}),(!n||n.byteLength<v.byteLength+h)&&(n?.destroy(),n=t.createBuffer({byteLength:v.byteLength+h,usage:35050})),n.write(v,h),n}class PE{constructor(e){let{device:t,attribute:n,timeline:r}=e;this.buffers=[],this.currentLength=0,this.device=t,this.transition=new jm(r),this.attribute=n,this.attributeInTransition=function(e){const{device:t,settings:n,value:r}=e,i=new Eb(t,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:n,settings:r,value:i,size:o}=e,s=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=e.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?i.length:(t+a)*o)*s}(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}const IE={name:"interpolation",vs:"uniform interpolationUniforms {\n  float time;\n} interpolation;\n",uniformTypes:{time:"f32"}},kE="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, interpolation.time);\n  gl_Position = vec4(0.0);\n}\n",ME="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n";function RE(e){return e.doublePrecision&&e.value instanceof Float64Array}const OE={name:"spring",vs:"uniform springUniforms {\n  float damping;\n  float stiffness;\n} spring;\n",uniformTypes:{damping:"f32",stiffness:"f32"}},LE="#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE force = delta * spring.stiffness;\n  ATTRIBUTE_TYPE resistance = velocity * spring.damping;\n  return force - resistance + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",DE="#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}";const NE={interpolation:class extends PE{constructor(e){let{device:t,attribute:n,timeline:r}=e;super({device:t,attribute:n,timeline:r}),this.type="interpolation",this.transform=function(e,t){const n=t.size,r=SE(n),i=EE(n),o=t.getBufferLayout();if(RE(t))return new _E(e,{vs:ME,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[bE,IE],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0});return new _E(e,{vs:kE,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:o.attributes[0].format}],modules:[IE],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}(t,n)}start(e,t){const n=this.currentLength,r=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:i,attribute:o}=this;TE(i),i[0]=CE({device:this.device,buffer:i[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),i[1]=AE({device:this.device,source:i[0],target:i[1]}),this.setBuffer(i[1]);const{transform:s}=this,a=s.model;let l=Math.floor(this.currentLength/o.size);RE(o)&&(l/=2),a.setVertexCount(l),o.isConstant?(a.setAttributes({aFrom:i[0]}),a.setConstantAttributes({aTo:o.value})):a.setAttributes({aFrom:i[0],aTo:o.getBuffer()}),s.transformFeedback.setBuffers({vCurrent:i[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let r=n/e;t&&(r=t(r));const{model:i}=this.transform,o={time:r};i.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends PE{constructor(e){let{device:t,attribute:n,timeline:r}=e;super({device:t,attribute:n,timeline:r}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}(t),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(t,this.texture),this.transform=function(e,t){const n=SE(t.size),r=EE(t.size);return new _E(e,{vs:LE,fs:DE,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[OE],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(t,n)}start(e,t){const n=this.currentLength,r=this.currentStartIndices;super.start(e,t);const{buffers:i,attribute:o}=this;for(let a=0;a<2;a++)i[a]=CE({device:this.device,buffer:i[a],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});i[2]=AE({device:this.device,source:i[0],target:i[2]}),this.setBuffer(i[1]);const{model:s}=this.transform;s.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?s.setConstantAttributes({aTo:o.value}):s.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:r}=this,i=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:i.stiffness,damping:i.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),TE(e),this.setBuffer(e[1]);this.device.readPixelsToArrayWebGL(n)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class zE{constructor(e,t){let{id:n,timeline:r}=t;if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:n,numInstances:r}=e;this.numInstances=r||1;for(const i in t){const e=t[i],r=e.getTransitionSetting(n);r&&this._updateAttribute(i,e,r)}for(const i in this.transitions){const e=t[i];e&&e.getTransitionSetting(n)||this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const t in this.transitions){this.transitions[t].update()&&(this.needsRedraw=!0)}const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const r=this.transitions[e];let i=!r||r.type!==n.type;if(i){r&&this._removeTransition(e);const o=NE[n.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(Ju.error(`unsupported transition type '${n.type}'`)(),i=!1)}(i||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const FE="attributeManager.invalidate";class BE{constructor(e){let{id:t="attribute-manager",stats:n,timeline:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.mergeBoundsMemoized=Ig(bf),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new zE(e,{id:`${t}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);th(FE,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);th(FE,this,"all")}update(e){let{data:t,numInstances:n,startIndices:r=null,transitions:i,props:o={},buffers:s={},context:a={}}=e,l=!1;th("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const e=this.attributes[c],i=e.settings.accessor;e.startIndices=r,e.numInstances=n,o[c]&&Ju.removed(`props.${c}`,`data.attributes.${c}`)(),e.setExternalBuffer(s[c])||e.setBinaryValue("string"===typeof i?s[i]:void 0,t.startIndices)||"string"===typeof i&&!s[i]&&e.setConstantValue(o[i])||e.needsUpdate()&&(l=!0,this._updateAttribute({attribute:e,numInstances:n,data:t,props:o,context:a})),this.needsRedraw=this.needsRedraw||e.needsRedraw()}l&&th("attributeManager.updateEnd",this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(e=>this.attributes[e]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:n}=this,r={...n.getAttributes()};for(const i in t){const o=t[i];o.needsRedraw(e)&&!n.hasAttribute(i)&&(r[i]=o)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const r=e[n],i={...r,id:n,size:(r.isIndexed?1:r.size)||1,...t};this.attributes[n]=new Eb(this.device,i)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes){this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)})}this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:r}=this,i=r[e];return i&&i.forEach(e=>{const r=n[e];r&&r.setNeedsUpdate(r.id,t)}),i}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(th("attribute.updateStart",t),t.constant)return void t.setConstantValue(t.value);t.allocate(n)&&th("attribute.allocate",t,n);t.updateBuffer(e)&&(this.needsRedraw=!0,th("attribute.updateEnd",t,n))}}const jE=1e-5;function UE(e,t,n,r,i){const o=t-e;return(n-t)*i+-o*r+o+t}function VE(e,t){if(Array.isArray(e)){let n=0;for(let r=0;r<e.length;r++){const i=e[r]-t[r];n+=i*i}return Math.sqrt(n)}return Math.abs(e-t)}const GE={interpolation:class extends jm{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:r,easing:i}}=this,o=i(e/r);this._value=Hd(t,n,o)}},spring:class extends jm{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:r}=this.settings,{_prevValue:i=e,_currValue:o=e}=this;let s=function(e,t,n,r,i){if(Array.isArray(n)){const o=[];for(let s=0;s<n.length;s++)o[s]=UE(e[s],t[s],n[s],r,i);return o}return UE(e,t,n,r,i)}(i,o,t,n,r);const a=VE(s,t),l=VE(s,o);a<jE&&l<jE&&(s=t,this.end()),this._prevValue=o,this._currValue=s}}};class HE{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,r){const{transitions:i}=this;if(i.has(e)){const n=i.get(e),{value:r=n.settings.fromValue}=n;t=r,this.remove(e)}if(!(r=Sb(r)))return;const o=GE[r.type];if(!o)return void Ju.error(`unsupported transition type '${r.type}'`)();const s=new o(this.timeline);s.start({...r,fromValue:t,toValue:n}),i.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function $E(e,t){const n=qE({newProps:e,oldProps:t,propTypes:e[Cu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=e;r?r(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied");n&&i&&(n=i(e.data,t.data)||n);return n}(e,t);let i=!1;return r||(i=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers){if(KE(e,t,"all"))return{all:!0}}const n={};let r=!1;for(const i in e.updateTriggers)if("all"!==i){KE(e,t,i)&&(n[i]=!0,r=!0)}return!!r&&n}(e,t)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:ZE(e,t),transitionsChanged:WE(e,t)}}function WE(e,t){if(!e.transitions)return!1;const n={},r=e[Cu];let i=!1;for(const o in e.transitions){const s=r[o],a=s&&s.type;("number"===a||"color"===a||"array"===a)&&XE(e[o],t[o],s)&&(n[o]=!0,i=!0)}return!!i&&n}function qE(e){let{newProps:t,oldProps:n,ignoreProps:r={},propTypes:i={},triggerName:o="props"}=e;if(n===t)return!1;if("object"!==typeof t||null===t)return`${o} changed shallowly`;if("object"!==typeof n||null===n)return`${o} changed shallowly`;for(const s of Object.keys(t))if(!(s in r)){if(!(s in n))return`${o}.${s} added`;const e=XE(t[s],n[s],i[s]);if(e)return`${o}.${s} ${e}`}for(const s of Object.keys(n))if(!(s in r)){if(!(s in t))return`${o}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const e=XE(t[s],n[s],i[s]);if(e)return`${o}.${s} ${e}`}}return!1}function XE(e,t,n){let r=n&&n.equal;return r&&!r(e,t,n)?"changed deeply":r||(r=e&&t&&e.equals,!r||r.call(e,t))?r||t===e?null:"changed shallowly":"changed deeply"}function ZE(e,t){if(null===t)return!0;const n=t.extensions,{extensions:r}=e;if(r===n)return!1;if(!n||!r)return!0;if(r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function KE(e,t,n){let r=e.updateTriggers[n];r=void 0===r||null===r?{}:r;let i=t.updateTriggers[n];i=void 0===i||null===i?{}:i;return qE({oldProps:i,newProps:r,triggerName:n})}function YE(e){if(!function(e){return null!==e&&"object"===typeof e}(e))throw new Error("count(): argument not an object");if("function"===typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"===typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}function JE(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){const e=n.modules.findIndex(e=>"project32"===e.name);e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const r={...e.inject};for(const e in t.inject)r[e]=(r[e]||"")+t.inject[e];n.inject=r}else n.inject=t.inject;return n}const QE=[0,0,0];function eT(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t.projectPosition(e);if(n&&t instanceof Bm){const[n,i,o=0]=e,s=t.getDistanceScales([n,i]);r[2]=o*s.unitsPerMeter[2]}return r}function tT(e,t){let{viewport:n,modelMatrix:r,coordinateSystem:i,coordinateOrigin:o,offsetMode:s}=t,[a,l,c=0]=e;switch(r&&([a,l,c]=zf([],[a,l,c,1],r)),i){case xm.LNGLAT:return eT([a,l,c],n,s);case xm.LNGLAT_OFFSETS:return eT([a+o[0],l+o[1],c+(o[2]||0)],n,s);case xm.METER_OFFSETS:return eT(dp(o,[a,l,c]),n,s);case xm.CARTESIAN:default:return n.isGeospatial?[a+o[0],l+o[1],c+o[2]]:n.projectPosition([a,l,c])}}function nT(e,t){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=function(e){const{viewport:t,modelMatrix:n,coordinateOrigin:r}=e;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:s}=e;return i===xm.DEFAULT&&(i=t.isGeospatial?xm.LNGLAT:xm.CARTESIAN),void 0===o&&(o=i),void 0===s&&(s=r),{viewport:t,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:o,fromCoordinateOrigin:s}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=QE,shaderCoordinateOrigin:u=QE,offsetMode:h=!1}=l?Ng(n,r,i):{},d=tT(e,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:h});if(h){const e=n.projectPosition(c||u);lf(d,d,e)}return d}const rT={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},iT={};const oT={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||lT(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>Rm(e,t,1)},accessor:{validate(e,t){const n=cT(e);return"function"===n||n===cT(t.value)},equal:(e,t,n)=>"function"===typeof t||Rm(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||lT(e),equal(e,t,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Rm(e,t,i):e===t}},object:{equal(e,t,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Rm(e,t,i):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"===typeof e,equal:(e,t,n)=>!n.compare&&!1!==n.ignore||e===t},data:{transform:(e,t,n)=>{if(!e)return e;const{dataTransform:r}=n.props;return r?r(e):"string"===typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,n)=>{const r=n.context;return r&&r.device?function(e,t,n,r){if(n instanceof hv)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const o=t.createTexture({...n,sampler:{...rT,...i,...r},mipmaps:!0});return iT[o.id]=e,o}(n.id,r.device,e,{...t.parameters,...n.props.textureParameters}):null},release:(e,t,n)=>{var r,i;r=n.id,(i=e)&&i instanceof hv&&iT[i.id]===r&&(i.delete(),delete iT[i.id])}}};function sT(e,t){switch(cT(t)){case"object":return aT(e,t);case"array":return aT(e,{type:"array",value:t,compare:!1});case"boolean":return aT(e,{type:"boolean",value:t});case"number":return aT(e,{type:"number",value:t});case"function":return aT(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function aT(e,t){return"type"in t?{name:e,...oT[t.type],...t}:"value"in t?{name:e,type:cT(t.value),...t}:{name:e,type:"object",value:t}}function lT(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function cT(e){return lT(e)?"array":null===e?"null":typeof e}const uT="_mergedDefaultProps";function hT(e,t){if(!(e instanceof _T.constructor))return{};let n=uT;if(t)for(const i of t){const e=i.constructor;e&&(n+=`:${e.extensionName||e.name}`)}const r=pT(e,n);return r||(e[n]=function(e,t){const n=e.prototype;if(!n)return null;const r=Object.getPrototypeOf(e),i=hT(r),o=pT(e,"defaultProps")||{},s=function(e){const t={},n={},r={};for(const[i,o]of Object.entries(e)){const e=o?.deprecatedFor;if(e)r[i]=Array.isArray(e)?e:[e];else{const e=sT(i,o);t[i]=e,n[i]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:r}}(o),a=Object.assign(Object.create(null),i,s.defaultProps),l=Object.assign(Object.create(null),i?.[Cu],s.propTypes),c=Object.assign(Object.create(null),i?.[Pu],s.deprecatedProps);for(const u of t){const e=hT(u.constructor);e&&(Object.assign(a,e),Object.assign(l,e[Cu]),Object.assign(c,e[Pu]))}(function(e,t){const n=function(e){const t=e.componentName;t||Ju.warn(`${e.name}.componentName not specified`)();return t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:n}})})(a,e),function(e,t){const n={},r={};for(const i in t){const e=t[i],{name:o,value:s}=e;e.async&&(n[o]=s,r[o]=dT(o))}e[Iu]=n,e[ku]={},Object.defineProperties(e,r)}(a,l),function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const r=`${this.id}: ${n}`;for(const i of t[n])fT(this,i)||(this[i]=e);Ju.deprecated(r,t[n].join("/"))()}})}(a,c),a[Cu]=l,a[Pu]=c,0!==t.length||fT(e,"_propTypes")||(e._propTypes=l);return a}(e,t||[]))}function dT(e){return{enumerable:!0,set(t){"string"===typeof t||t instanceof Promise||yb(t)?this[ku][e]=t:this[Mu][e]=t},get(){if(this[Mu]){if(e in this[Mu]){return this[Mu][e]||this[Iu][e]}if(e in this[ku]){const t=this[Au]&&this[Au].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Iu][e]}}return this[Iu][e]}}}function fT(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function pT(e,t){return fT(e,t)&&e[t]}let mT=0;class gT{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.props=function(e,t){let n;for(let o=t.length-1;o>=0;o--){const e=t[o];"extensions"in e&&(n=e.extensions)}const r=hT(e.constructor,n),i=Object.create(r);i[Au]=e,i[ku]={},i[Mu]={};for(let o=0;o<t.length;++o){const e=t[o];for(const t in e)i[t]=e[t]}return Object.freeze(i),i}(this,t),this.id=this.props.id,this.count=mT++}clone(e){const{props:t}=this,n={};for(const r in t[Iu])r in t[Mu]?n[r]=t[Mu][r]:r in t[ku]&&(n[r]=t[ku][r]);return new this.constructor({...t,...n,...e})}}gT.componentName="Component",gT.defaultProps={};const _T=gT,yT=Object.freeze({});class vT{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||yT}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Au]||this.component;const t=e[Mu]||{},n=e[ku]||e,r=e[Iu]||{};for(const i in t){const e=t[i];this._createAsyncPropData(i,r[i]),this._updateAsyncProp(i,e),t[i]=this.getAsyncProp(i)}for(const i in n){const e=n[i];this._createAsyncPropData(i,r[i]),this._updateAsyncProp(i,e)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"===typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):yb(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const r=this.asyncProps[e];r&&n>=r.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),r.resolvedValue=t,r.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const r=n.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,r),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const r=n.pendingLoadCount;let i=[],o=0;for await(const s of t){if(!this.component)return;const{dataTransform:t}=this.component.props;i=t?t(s,i):i.concat(s),Object.defineProperty(i,"__diff",{enumerable:!1,value:[{startRow:o,endRow:i.length}]}),o=i.length,this._setAsyncPropValue(e,i,r)}this._onResolve(e,i)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[Cu];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class xT extends vT{constructor(e){let{attributeManager:t,layer:n}=e;super(n),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,r=n?.props.fetch;return r?r(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const r=n.props.onDataLoad;"data"===e&&r&&r(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const bT=2**24-1,wT=Object.freeze([]),ST=Ig(e=>{let{oldViewport:t,viewport:n}=e;return t.equals(n)});let ET=new Uint8ClampedArray(0);const TT={data:{type:"data",value:wT,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,t)=>{let{propName:n,layer:r,loaders:i,loadOptions:o,signal:s}=t;const{resourceManager:a}=r.context;o=o||r.getLoadOptions(),i=i||r.props.loaders,s&&(o={...o,fetch:{...o?.fetch,signal:s}});let l=a.contains(e);return l||o||(a.add({resourceId:e,data:Nd(e,i),persistent:!1}),l=!0),l?a.subscribe({resourceId:e,onChange:e=>r.internalState?.reloadAsyncProp(n,e),consumerId:r.id,requestId:n}):Nd(e,i,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:xm.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:e=>{let{layerIndex:t}=e;return[0,100*-t]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class AT extends _T{constructor(){super(...arguments),this.internalState=null,this.lifecycle=xu,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){qm(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=tT(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,i,o]=gp(n,t.pixelProjectionMatrix);return 2===e.length?[r,i]:[r,i,o]}unproject(e){qm(this.internalState);return(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){qm(this.internalState);return nT(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(){for(const e of this.getModels())e.shaderInputs.setProps(...arguments)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===xm.DEFAULT||e===xm.LNGLAT||e===xm.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){qm(e instanceof Uint8Array);const[t,n,r]=e;return t+256*n+65536*r-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:YE(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=JE(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=JE(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const r of n)t.invalidateAll(r);else t.invalidateAll();if(t){const{props:n}=e,r=this.internalState.hasPickingBuffer,i=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(r!==i){this.internalState.hasPickingBuffer=i;const{pickingColors:e,instancePickingColors:n}=t.attributes,r=e||n;r&&(i&&r.constant&&(r.constant=!1,t.invalidate(r.id)),r.value||i||(r.constant=!0,r.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo(e){let{info:t,mode:n,sourceLayer:r}=e;const{index:i}=t;return i>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[i]),t}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&ST({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),r=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:r,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,t){let{numInstances:n}=t;if(e.constant)return;const r=Math.floor(ET.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>bT&&Ju.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ET=Bd.allocate(ET,n,{size:4,copy:!0,maxCount:Math.max(n,bT)});const e=Math.floor(ET.length/4),t=[0,0,0];for(let n=r;n<e;n++)this.encodePickingColor(n,t),ET[4*n+0]=t[0],ET[4*n+1]=t[1],ET[4*n+2]=t[2],ET[4*n+3]=0}e.value=ET.subarray(0,4*n)}_setModelAttributes(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Object.keys(t).length)return;if(n){const n=this.getAttributeManager();e.setBufferLayout(n.getBufferLayouts(e)),t=n.getAttributes()}const r=e.userData?.excludeAttributes||{},i={},o={};for(const s in t){if(r[s])continue;const n=t[s].getValue();for(const r in n){const a=n[r];a instanceof Z_?t[s].settings.isIndexed?e.setIndexBuffer(a):i[r]=a:a&&(o[r]=a)}}e.setAttributes(i),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r,o=i&&t.attributes&&t.attributes[i.id];if(o&&o.value){const n=o.value,r=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=i.getVertexOffset(e);n[t]===r[0]&&n[t+1]===r[1]&&n[t+2]===r[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,r=t||n;if(!r)return;const i=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(o-i),i)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==ET.buffer&&(n.value=ET.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){qm(!this.internalState),qm(Number.isFinite(this.props.coordinateSystem)),th("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new xT({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ju.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new HE(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){th("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(th("layer.update",this,e),!e)return;const t=this.props,n=this.context,r=this.internalState,i=n.viewport,o=this._updateUniformTransition();r.propsInTransition=o,n.viewport=r.viewport||i,this.props=o;try{const e=this._getUpdateParams(),t=this.getModels();if(n.device)this.updateState(e);else try{this.updateState(e)}catch(s){}for(const n of this.props.extensions)n.updateState.call(this,e,n);this.setNeedsRedraw(),this._updateAttributes();const r=this.getModels()[0]!==t[0];this._postUpdate(e,r)}finally{n.viewport=i,this.props=t,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){th("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{renderPass:t,shaderModuleProps:n=null,uniforms:r={},parameters:i={}}=e;this._updateAttributeTransition();const o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:e}=this.props,o=e&&e(r)||[0,0];s.device instanceof $x&&s.device.setParametersWebGL({polygonOffset:o});for(const t of this.getModels())"webgpu"===t.device.type?t.setParameters({...t.parameters,...i}):t.setParameters(i);if(s.device instanceof $x)s.device.withParametersWebGL(i,()=>{const e={renderPass:t,shaderModuleProps:n,uniforms:r,parameters:i,context:s};for(const t of this.props.extensions)t.draw.call(this,e,t);this.draw(e)});else{const e={renderPass:t,shaderModuleProps:n,uniforms:r,parameters:i,context:s};for(const t of this.props.extensions)t.draw.call(this,e,t);this.draw(e)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const r in e)if(e[r]){let n=!1;if("dataChanged"===r){const i=e[r],o=t[r];i&&Array.isArray(o)&&(t.dataChanged=Array.isArray(i)?o.concat(i):i,n=!0)}t[r]||(t[r]=e[r],n=!0),n&&th("layer.changeFlag",this,r,e)}const n=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const n=$E(e,t);if(n.updateTriggersChanged)for(const r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(const r in n.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],e.transitions?.[r]);return this.setChangeFlags(n)}validateProps(){!function(e){const t=e[Cu];for(const n in t){const r=t[n],{validate:i}=r;if(i&&!i(e[n],r))throw new Error(`Invalid prop ${n}: ${e[n]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"===typeof n&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new BE(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:r}=e,i=this.state.model;i?.isInstanced&&i.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:s,highlightColor:a}=n;if(t||r.autoHighlight!==o||r.highlightedObjectIndex!==s||r.highlightColor!==a){const e={};Array.isArray(a)&&(e.highlightColor=a),(t||r.autoHighlight!==o||s!==r.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),r=!!n&&n.getNeedsRedraw(e);if(t=t||r,t)for(const i of this.props.extensions)i.onNeedsRedraw.call(this,i);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}AT.defaultProps=TT,AT.layerName="Layer";const CT=AT,PT={position:"absolute",zIndex:-1};function IT(e,t){if("function"===typeof e)return e(t);if(Array.isArray(e))return e.map(e=>IT(e,t));if(kT(e)){if(n=e,n.props?.mapStyle)return t.style=PT,(0,i.cloneElement)(e,t);if(function(e){const t=e.type;return t&&t.deckGLViewProps}(e))return(0,i.cloneElement)(e,t)}var n;return e}function kT(e){return e&&"object"===typeof e&&"type"in e||!1}function MT(e){if("function"===typeof e)return(0,i.createElement)(zm,{},e);if(Array.isArray(e))return e.map(MT);if(kT(e)){if(e.type===i.Fragment)return MT(e.props.children);if(sb(e.type,zm))return e}return e}const RT=(0,i.createContext)();const OT={mixBlendMode:null};function LT(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}const DT=i.forwardRef(function(e,t){const[n,r]=(0,i.useState)(0),o=(0,i.useRef)({control:null,version:n,forceUpdate:()=>r(e=>e+1)}),s=o.current,a=(0,i.useRef)(null),l=(0,i.useRef)(null),c=(0,i.useMemo)(()=>function(e){let{children:t,layers:n=[],views:r=null}=e;const o=[],s=[],a={};return i.Children.forEach(MT(t),e=>{if(kT(e)){const t=e.type;if(sb(t,CT)){const n=function(e,t){const n={},r=e.defaultProps||{};for(const i in t)r[i]!==t[i]&&(n[i]=t[i]);return new e(n)}(t,e.props);s.push(n)}else o.push(e);if(sb(t,zm)&&t!==zm&&e.props.id){const n=new t(e.props);a[n.id]=n}}else e&&o.push(e)}),Object.keys(a).length>0&&(Array.isArray(r)?r.forEach(e=>{a[e.id]=e}):r&&(a[r.id]=r),r=Object.values(a)),n=s.length>0?[...s,...n]:n,{layers:n,children:o,views:r}}(e),[e.layers,e.views,e.children]);let u=!0;const h=t=>u&&e.viewState?(s.viewStateUpdateRequested=t,null):(s.viewStateUpdateRequested=null,e.onViewStateChange?.(t)),d=t=>{u?s.interactionStateUpdateRequested=t:(s.interactionStateUpdateRequested=null,e.onInteractionStateChange?.(t))},f=(0,i.useMemo)(()=>{const t={widgets:[],...e,style:null,width:"100%",height:"100%",parent:a.current,canvas:l.current,layers:c.layers,views:c.views,onViewStateChange:h,onInteractionStateChange:d};return delete t._customRender,s.deck&&s.deck.setProps(t),t},[e]);(0,i.useEffect)(()=>{const t=e.Deck||ib;return s.deck=function(e,t,n){const r=new t({...n,_customRender:"webgpu"===n.deviceProps?.adapters?.[0]?.type?void 0:t=>{e.redrawReason=t;const n=r.getViewports();e.lastRenderedViewports!==n?e.forceUpdate():LT(e)}});return r}(s,t,{...f,parent:a.current,canvas:l.current}),()=>s.deck?.finalize()},[]),ob(()=>{LT(s);const{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=s;e&&h(e),t&&d(t)}),(0,i.useImperativeHandle)(t,()=>function(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}(s),[]);const p=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:m,width:g="100%",height:_="100%",id:y,style:v}=e,{containerStyle:x,canvasStyle:b}=(0,i.useMemo)(()=>function(e){let{width:t,height:n,style:r}=e;const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:n},o={left:0,top:0};if(r)for(const s in r)s in OT?o[s]=r[s]:i[s]=r[s];return{containerStyle:i,canvasStyle:o}}({width:g,height:_,style:v}),[g,_,v]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===p||s.version!==n){s.lastRenderedViewports=p,s.version=n;const e=function(e){let{children:t,deck:n,ContextProvider:r=RT.Provider}=e;const{viewManager:o}=n||{};if(!o||!o.views.length)return[];const s={},a=o.views[0].id;for(const i of t){let e=a,t=i;kT(i)&&sb(i.type,zm)&&(e=i.props.id||a,t=i.props.children);const n=o.getViewport(e),r=o.getViewState(e);if(n){r.padding=n.padding;const{x:i,y:o,width:a,height:l}=n;t=IT(t,{x:i,y:o,width:a,height:l,viewport:n,viewState:r}),s[e]||(s[e]={viewport:n,children:[]}),s[e].children.push(t)}}return Object.keys(s).map(e=>{const{viewport:t,children:o}=s[e],{x:a,y:l,width:c,height:u}=t,h={position:"absolute",left:a,top:l,width:c,height:u},d=`view-${e}`,f=(0,i.createElement)("div",{key:d,id:d,style:h},...o),p={deck:n,viewport:t,container:n.canvas.offsetParent,eventManager:n.eventManager,onViewStateChange:t=>{t.viewId=e,n._onViewStateChange(t)},widgets:[]},m=`view-${e}-context`;return(0,i.createElement)(r,{key:m,value:p},f)})}({children:c.children,deck:s.deck,ContextProvider:m}),t=(0,i.createElement)("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:l,style:b});s.control=(0,i.createElement)("div",{id:`${y||"deckgl"}-wrapper`,ref:a,style:x},[t,e])}return u=!1,s.control}),NT=DT,zT={name:"project32",dependencies:[Vg],source:"// Define a structure to hold both the clip-space position and the common position.\nstruct ProjectResult {\n  clipPosition: vec4<f32>,\n  commonPosition: vec4<f32>,\n};\n\n// This function mimics the GLSL version with the 'out' parameter by returning both values.\nfn project_position_to_clipspace_and_commonspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> ProjectResult {\n  // Compute the projected position.\n  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);\n\n  // Start with the provided offset.\n  var finalOffset: vec3<f32> = offset;\n\n  // Get whether a rotation is needed and the rotation matrix.\n  let rotationResult = project_needs_rotation(projectedPosition);\n\n  // If rotation is needed, update the offset.\n  if (rotationResult.needsRotation) {\n    finalOffset = rotationResult.transform * offset;\n  }\n\n  // Compute the common position.\n  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);\n\n  // Convert to clip-space.\n  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);\n\n  return ProjectResult(clipPosition, commonPosition);\n}\n\n// A convenience overload that returns only the clip-space position.\nfn project_position_to_clipspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> vec4<f32> {\n  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;\n}\n",vs:"vec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},FT={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!bool(picking.isAttribute)) {\n      // Stores the picking color so that the fragment shader can render it during picking\n      picking_vRGBcolor_Avalid.rgb = pickingColor;\n    }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n",getUniforms:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const n=e.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=n}if(e.highlightColor){const n=Array.from(e.highlightColor,e=>e/255);Number.isFinite(n[3])||(n[3]=1),t.highlightColor=n}void 0!==e.isActive&&(t.isActive=Boolean(e.isActive),t.isAttribute=Boolean(e.isAttribute));void 0!==e.useFloatColors&&(t.useFloatColors=Boolean(e.useFloatColors));return t}};const BT={...FT,defaultUniforms:{...FT.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}};class jT{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:n=null,vertexCount:r=null}=e;this.id=e.id||QS("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[i,o]of Object.entries(t)){const e=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(e.value))throw new Error(`${this._print(i)}: must be typed array or object with value as typed array`);if("POSITION"!==i&&"positions"!==i||e.size||(e.size=3),"indices"===i){if(this.indices)throw new Error("Multiple indices detected");this.indices=e}else this.attributes[i]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const r of Object.values(e)){const{value:e,size:t,constant:i}=r;!i&&e&&void 0!==t&&t>=1&&(n=Math.min(n,e.length/t))}return n}}const UT="uniform iconUniforms {\n  float sizeScale;\n  vec2 iconsTextureDim;\n  float sizeMinPixels;\n  float sizeMaxPixels;\n  bool billboard;\n  highp int sizeUnits;\n  float alphaCutoff;\n} icon;\n",VT={name:"icon",vs:UT,fs:UT,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},GT=()=>{},HT={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},$T={x:0,y:0,width:0,height:0};function WT(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function qT(e,t,n,r){const i=Math.min(n/t.width,r/t.height),o=Math.floor(t.width*i),s=Math.floor(t.height*i);return 1===i?{image:t,width:o,height:s}:(e.canvas.height=s,e.canvas.width=o,e.clearRect(0,0,o,s),e.drawImage(t,0,0,t.width,t.height,0,0,o,s),{image:e.canvas,width:o,height:s})}function XT(e){return e&&(e.id||e.url)}function ZT(e,t,n){for(let r=0;r<t.length;r++){const{icon:i,xOffset:o}=t[r];e[XT(i)]={...i,x:o,y:n}}}class KT{constructor(e,t){let{onUpdate:n=GT,onError:r=GT}=t;this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=r}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?XT(e):e;return this._mapping[t]||$T}setProps(e){let{loadOptions:t,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:o}=e;t&&(this._loadOptions=t),void 0!==n&&(this._autoPacking=n),i&&(this._mapping=i),r&&(this._texture?.delete(),this._texture=null,this._externalTexture=r),o&&(this._samplerParameters=o)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){if(!this._autoPacking||"undefined"===typeof document)return;const n=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};const r={},{iterable:i,objectInfo:o}=_b(e);for(const s of i){o.index++;const e=t(s,o),i=XT(e);if(!e)throw new Error("Icon is missing.");if(!e.url)throw new Error("Icon url is missing.");r[i]||n[i]&&e.url===n[i].url||(r[i]={...e,source:s,sourceIndex:o.index})}return r}(e,t,this._mapping)||{});if(n.length>0){const{mapping:e,xOffset:t,yOffset:r,rowHeight:i,canvasHeight:o}=function(e){let{icons:t,buffer:n,mapping:r={},xOffset:i=0,yOffset:o=0,rowHeight:s=0,canvasWidth:a}=e,l=[];for(let c=0;c<t.length;c++){const e=t[c];if(!r[XT(e)]){const{height:t,width:c}=e;i+c+n>a&&(ZT(r,l,o),i=0,o=s+o+n,s=0,l=[]),l.push({icon:e,xOffset:i}),i=i+c+n,s=Math.max(s,t)}}return l.length>0&&ZT(r,l,o),{mapping:r,rowHeight:s,xOffset:i,yOffset:o,canvasWidth:a,canvasHeight:WT(s+o+n)}}({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=i,this._mapping=e,this._xOffset=t,this._yOffset=r,this._canvasHeight=o,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||HT,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,n,r){const{width:i,height:o,device:s}=e,a=s.createTexture({format:"rgba8unorm",width:t,height:n,sampler:r,mipmaps:!0}),l=s.createCommandEncoder();return l.copyTextureToTexture({sourceTexture:e,destinationTexture:a,width:i,height:o}),l.finish(),e.destroy(),a}(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||HT)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,Nd(n.url,this._loadOptions).then(e=>{const r=XT(n),i=this._mapping[r],{x:o,y:s,width:a,height:l}=i,{image:c,width:u,height:h}=qT(t,e,a,l);this._texture?.copyExternalImage({image:c,x:o+(a-u)/2,y:s+(l-h)/2,width:u,height:h}),i.width=u,i.height=h,this._texture.generateMipmap(),this.onUpdate()}).catch(e=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:e})}).finally(()=>{this._pendingCount--})}}const YT=[0,0,0,255],JT={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:YT},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class QT extends CT{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME icon-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceSizes;\nin float instanceAngles;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec4 instanceIconFrames;\nin float instanceColorModes;\nin vec2 instanceOffsets;\nin vec2 instancePixelOffset;\nout float vColorMode;\nout vec4 vColor;\nout vec2 vTextureCoords;\nout vec2 uv;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = angle * PI / 180.0;\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvec2 iconSize = instanceIconFrames.zw;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),\nicon.sizeMinPixels, icon.sizeMaxPixels\n);\nfloat instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\nvec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\npixelOffset += instancePixelOffset;\npixelOffset.y *= -1.0;\nif (icon.billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvTextureCoords = mix(\ninstanceIconFrames.xy,\ninstanceIconFrames.xy + iconSize,\n(positions.xy + 1.0) / 2.0\n) / icon.iconsTextureDim;\nvColor = instanceColors;\nDECKGL_FILTER_COLOR(vColor, geometry);\nvColorMode = instanceColorModes;\n}\n",fs:"#version 300 es\n#define SHADER_NAME icon-layer-fragment-shader\nprecision highp float;\nuniform sampler2D iconsTexture;\nin float vColorMode;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec4 texColor = texture(iconsTexture, vTextureCoords);\nvec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\nfloat a = texColor.a * layer.opacity * vColor.a;\nif (a < icon.alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color, a);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[zT,BT,VT]})}initializeState(){this.state={iconManager:new KT(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:YT},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:n,changeFlags:r}=e,i=this.getAttributeManager(),{iconAtlas:o,iconMapping:s,data:a,getIcon:l,textureParameters:c}=t,{iconManager:u}=this.state;if("string"===typeof o)return;const h=o||this.internalState.isAsyncPropLoading("iconAtlas");u.setProps({loadOptions:t.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?s:null,textureParameters:c}),h?n.iconMapping!==t.iconMapping&&i.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&u.packIcons(a,l),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw(e){let{uniforms:t}=e;const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:o,billboard:s,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();if(c){const e=this.state.model,t={iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:wm[o],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:s,alphaCutoff:a};e.shaderInputs.setProps({icon:t}),e.draw(this.context.renderPass)}}_getModel(){return new pE(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jT({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([-1,-1,1,-1,-1,1,1,1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):Ju.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:r=t/2,anchorY:i=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-r,n/2-i]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:r,height:i}=this.state.iconManager.getIconMapping(e);return[t,n,r,i]}}QT.defaultProps=JT,QT.layerName="IconLayer";const eA=QT,tA="uniform scatterplotUniforms {\n  float radiusScale;\n  float radiusMinPixels;\n  float radiusMaxPixels;\n  float lineWidthScale;\n  float lineWidthMinPixels;\n  float lineWidthMaxPixels;\n  float stroked;\n  float filled;\n  bool antialiasing;\n  bool billboard;\n  highp int radiusUnits;\n  highp int lineWidthUnits;\n} scatterplot;\n",nA={name:"scatterplot",vs:tA,fs:tA,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},rA=[0,0,0,255],iA={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:rA},getLineColor:{type:"accessor",value:rA},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class oA extends CT{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),\nscatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),\nscatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n);\nouterRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\nfloat edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;\nif (scatterplot.billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = scatterplot.antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (scatterplot.stroked > 0.5) {\nfloat isLine = scatterplot.antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (scatterplot.filled > 0.5) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (scatterplot.filled < 0.5) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",source:'// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)\n\nstruct LayerUniforms {\n  opacity: f32,\n};\n\nvar<private> layer: LayerUniforms = LayerUniforms(1.0);\n// @group(0) @binding(1) var<uniform> layer: LayerUniforms;\n\n// Main shaders\n\nstruct ScatterplotUniforms {\n  radiusScale: f32,\n  radiusMinPixels: f32,\n  radiusMaxPixels: f32,\n  lineWidthScale: f32,\n  lineWidthMinPixels: f32,\n  lineWidthMaxPixels: f32,\n  stroked: f32,\n  filled: i32,\n  antialiasing: i32,\n  billboard: i32,\n  radiusUnits: i32,\n  lineWidthUnits: i32,\n};\n\nstruct ConstantAttributeUniforms {\n instancePositions: vec3<f32>,\n instancePositions64Low: vec3<f32>,\n instanceRadius: f32,\n instanceLineWidths: f32,\n instanceFillColors: vec4<f32>,\n instanceLineColors: vec4<f32>,\n instancePickingColors: vec3<f32>,\n\n instancePositionsConstant: i32,\n instancePositions64LowConstant: i32,\n instanceRadiusConstant: i32,\n instanceLineWidthsConstant: i32,\n instanceFillColorsConstant: i32,\n instanceLineColorsConstant: i32,\n instancePickingColorsConstant: i32\n};\n\n@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;\n\nstruct ConstantAttributes {\n  instancePositions: vec3<f32>,\n  instancePositions64Low: vec3<f32>,\n  instanceRadius: f32,\n  instanceLineWidths: f32,\n  instanceFillColors: vec4<f32>,\n  instanceLineColors: vec4<f32>,\n  instancePickingColors: vec3<f32>\n};\n\nconst constants = ConstantAttributes(\n  vec3<f32>(0.0),\n  vec3<f32>(0.0),\n  0.0,\n  0.0,\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec3<f32>(0.0)\n);\n\nstruct Attributes {\n  @builtin(instance_index) instanceIndex : u32,\n  @builtin(vertex_index) vertexIndex : u32,\n  @location(0) positions: vec3<f32>,\n  @location(1) instancePositions: vec3<f32>,\n  @location(2) instancePositions64Low: vec3<f32>,\n  @location(3) instanceRadius: f32,\n  @location(4) instanceLineWidths: f32,\n  @location(5) instanceFillColors: vec4<f32>,\n  @location(6) instanceLineColors: vec4<f32>,\n  @location(7) instancePickingColors: vec3<f32>\n};\n\nstruct Varyings {\n  @builtin(position) position: vec4<f32>,\n  @location(0) vFillColor: vec4<f32>,\n  @location(1) vLineColor: vec4<f32>,\n  @location(2) unitPosition: vec2<f32>,\n  @location(3) innerUnitRadius: f32,\n  @location(4) outerRadiusPixels: f32,\n};\n\n@vertex\nfn vertexMain(attributes: Attributes) -> Varyings {\n  var varyings: Varyings;\n\n  // Draw an inline geometry constant array clip space triangle to verify that rendering works.\n  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));\n  // if (attributes.instanceIndex == 0) {\n  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);\n  //   return varyings;\n  // }\n\n  // var geometry: Geometry;\n  // geometry.worldPosition = instancePositions;\n\n  // Multiply out radius and clamp to limits\n  varyings.outerRadiusPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),\n    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n  );\n\n  // Multiply out line width and clamp to limits\n  let lineWidthPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),\n    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\n  // Expand geometry to accommodate edge smoothing\n  let edgePadding = select(\n    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,\n    1.0,\n    scatterplot.antialiasing != 0\n  );\n\n  // position on the containing square in [-1, 1] space\n  varyings.unitPosition = edgePadding * attributes.positions.xy;\n  geometry.uv = varyings.unitPosition;\n  geometry.pickingColor = attributes.instancePickingColors;\n\n  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;\n\n  if (scatterplot.billboard != 0) {\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    let clipPixels = project_pixel_size_to_clipspace(offset.xy);\n    varyings.position.x = clipPixels.x;\n    varyings.position.y = clipPixels.y;\n  } else {\n    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n  }\n\n  // Apply opacity to instance color, or return instance picking color\n  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);\n  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);\n\n  return varyings;\n}\n\n@fragment\nfn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {\n  // var geometry: Geometry;\n  // geometry.uv = unitPosition;\n\n  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;\n  let inCircle = select(\n    smoothedge(distToCenter, varyings.outerRadiusPixels),\n    step(distToCenter, varyings.outerRadiusPixels),\n    scatterplot.antialiasing != 0\n  );\n\n  if (inCircle == 0.0) {\n    // discard;\n  }\n\n  var fragColor: vec4<f32>;\n\n  if (scatterplot.stroked != 0) {\n    let isLine = select(\n      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      scatterplot.antialiasing != 0\n    );\n\n    if (scatterplot.filled != 0) {\n      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        // discard;\n      }\n      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);\n    }\n  } else if (scatterplot.filled == 0) {\n    // discard;\n  } else {\n    fragColor = varyings.vFillColor;\n  }\n\n  fragColor.a *= inCircle;\n  // DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  return fragColor;\n  // return vec4<f32>(0, 0, 1, 1);\n}\n',modules:[zT,BT,nA]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw(e){let{uniforms:t}=e;const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o,stroked:s,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:f}=this.props,p={stroked:s,filled:a,billboard:l,antialiasing:c,radiusUnits:wm[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:wm[u],lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:f},m=this.state.model;m.shaderInputs.setProps({scatterplot:p}),m.draw(this.context.renderPass)}_getModel(){return new pE(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jT({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0})}}oA.defaultProps=iA,oA.layerName="ScatterplotLayer";const sA=oA,aA="uniform lineUniforms {\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  float useShortestPath;\n  highp int widthUnits;\n} line;\n",lA={name:"line",source:"struct LineUniforms {\n  widthScale: f32,\n  widthMinPixels: f32,\n  widthMaxPixels: f32,\n  useShortestPath: f32,\n  widthUnits: i32,\n};\n\n@group(0) @binding(1)\nvar<uniform> line: LineUniforms;\n",vs:aA,fs:aA,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},cA={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:[0,0,0,255]},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class uA extends CT{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME line-layer-vertex-shader\nin vec3 positions;\nin vec3 instanceSourcePositions;\nin vec3 instanceTargetPositions;\nin vec3 instanceSourcePositions64Low;\nin vec3 instanceTargetPositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin float instanceWidths;\nout vec4 vColor;\nout vec2 uv;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\nvec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn dir_screenspace * offset_direction * width / 2.0;\n}\nvec3 splitLine(vec3 a, vec3 b, float x) {\nfloat t = (x - a.x) / (b.x - a.x);\nreturn vec3(x, mix(a.yz, b.yz, t));\n}\nvoid main(void) {\ngeometry.worldPosition = instanceSourcePositions;\ngeometry.worldPositionAlt = instanceTargetPositions;\nvec3 source_world = instanceSourcePositions;\nvec3 target_world = instanceTargetPositions;\nvec3 source_world_64low = instanceSourcePositions64Low;\nvec3 target_world_64low = instanceTargetPositions64Low;\nif (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {\nsource_world.x = mod(source_world.x + 180., 360.0) - 180.;\ntarget_world.x = mod(target_world.x + 180., 360.0) - 180.;\nfloat deltaLng = target_world.x - source_world.x;\nif (deltaLng * line.useShortestPath > 180.) {\nsource_world.x += 360. * line.useShortestPath;\nsource_world = splitLine(source_world, target_world, 180. * line.useShortestPath);\nsource_world_64low = vec3(0.0);\n} else if (deltaLng * line.useShortestPath < -180.) {\ntarget_world.x += 360. * line.useShortestPath;\ntarget_world = splitLine(source_world, target_world, 180. * line.useShortestPath);\ntarget_world_64low = vec3(0.0);\n} else if (line.useShortestPath < 0.) {\ngl_Position = vec4(0.);\nreturn;\n}\n}\nvec4 source_commonspace;\nvec4 target_commonspace;\nvec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);\nvec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);\nfloat segmentIndex = positions.x;\nvec4 p = mix(source, target, segmentIndex);\ngeometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\nuv = positions.xy;\ngeometry.uv = uv;\ngeometry.pickingColor = instancePickingColors;\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),\nline.widthMinPixels, line.widthMaxPixels\n);\nvec3 offset = vec3(\ngetExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\nDECKGL_FILTER_GL_POSITION(p, geometry);\ngl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\nvColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME line-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",source:'// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)\nstruct LayerUniforms {\n  opacity: f32,\n};\nvar<private> layer: LayerUniforms = LayerUniforms(1.0);\n// @group(0) @binding(1) var<uniform> layer: LayerUniforms;\n\n// ---------- Helper Structures & Functions ----------\n\n// Placeholder filter functions.\nfn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {\n  return offset;\n}\nfn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {\n  return p;\n}\nfn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {\n  return color;\n}\n\n// Compute an extrusion offset given a line direction (in clipspace),\n// an offset direction (-1 or 1), and a width in pixels.\n// Assumes a uniform "project" with a viewportSize field is available.\nfn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {\n  // project.viewportSize should be provided as a uniform (not shown here)\n  let dir_screenspace = normalize(line_clipspace * project.viewportSize);\n  // Rotate by 90\xb0: (x,y) becomes (-y,x)\n  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);\n  return rotated * offset_direction * width / 2.0;\n}\n\n// Splits the line between two points at a given x coordinate.\n// Interpolates the y and z components.\nfn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {\n  let t: f32 = (x - a.x) / (b.x - a.x);\n  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));\n}\n\n// ---------- Uniforms & Global Structures ----------\n\n// Uniforms for line, layer, and project are assumed to be defined elsewhere.\n// For example:\n//\n// @group(0) @binding(0)\n// var<uniform> line: LineUniform;\n//\n// struct LayerUniform {\n//   opacity: f32,\n// };\n// @group(0) @binding(1)\n// var<uniform> layer: LayerUniform;\n//\n// struct ProjectUniform {\n//   viewportSize: vec2<f32>,\n// };\n// @group(0) @binding(2)\n// var<uniform> project: ProjectUniform;\n\n\n\n// ---------- Vertex Output Structure ----------\n\nstruct Varyings {\n  @builtin(position) gl_Position: vec4<f32>,\n  @location(0) vColor: vec4<f32>,\n  @location(1) uv: vec2<f32>,\n};\n\n// ---------- Vertex Shader Entry Point ----------\n\n@vertex\nfn vertexMain(\n  @location(0) positions: vec3<f32>,\n  @location(1) instanceSourcePositions: vec3<f32>,\n  @location(2) instanceTargetPositions: vec3<f32>,\n  @location(3) instanceSourcePositions64Low: vec3<f32>,\n  @location(4) instanceTargetPositions64Low: vec3<f32>,\n  @location(5) instanceColors: vec4<f32>,\n  @location(6) instancePickingColors: vec3<f32>,\n  @location(7) instanceWidths: f32\n) -> Varyings {\n  var geometry: Geometry;\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  var source_world: vec3<f32> = instanceSourcePositions;\n  var target_world: vec3<f32> = instanceTargetPositions;\n  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;\n  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;\n\n  // Apply shortest-path adjustments if needed.\n  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {\n    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;\n    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;\n    let deltaLng: f32 = target_world.x - source_world.x;\n\n    if (deltaLng * line.useShortestPath > 180.0) {\n      source_world.x = source_world.x + 360.0 * line.useShortestPath;\n      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);\n      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);\n    } else if (deltaLng * line.useShortestPath < -180.0) {\n      target_world.x = target_world.x + 360.0 * line.useShortestPath;\n      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);\n      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);\n    } else if (line.useShortestPath < 0.0) {\n      var abortOut: Varyings;\n      abortOut.gl_Position = vec4<f32>(0.0);\n      abortOut.vColor = vec4<f32>(0.0);\n      abortOut.uv = vec2<f32>(0.0);\n      return abortOut;\n    }\n  }\n\n  // Project Pos and target positions to clip space.\n  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));\n  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));\n  let sourcePos: vec4<f32> = sourceResult.clipPosition;\n  let targetPos: vec4<f32> = targetResult.clipPosition;\n  let source_commonspace: vec4<f32> = sourceResult.commonPosition;\n  let target_commonspace: vec4<f32> = targetResult.commonPosition;\n\n  // Interpolate along the line segment.\n  let segmentIndex: f32 = positions.x;\n  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);\n  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);\n  let uv: vec2<f32> = positions.xy;\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n\n  // Determine width in pixels.\n  let widthPixels: f32 = clamp(\n    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),\n    line.widthMinPixels, line.widthMaxPixels\n  );\n\n  // Compute extrusion offset.\n  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);\n  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);\n\n  // Apply deck.gl filter functions.\n  let filteredOffset = deckgl_filter_size(offset, geometry);\n  let filteredP = deckgl_filter_gl_position(p, geometry);\n\n  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);\n  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);\n\n  // Compute color.\n  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);\n  // vColor = deckgl_filter_color(vColor, geometry);\n\n  var output: Varyings;\n  output.gl_Position = finalPosition;\n  output.vColor = vColor;\n  output.uv = uv;\n  return output;\n}\n\n@fragment\nfn fragmentMain(\n  @location(0) vColor: vec4<f32>,\n  @location(1) uv: vec2<f32>\n) -> @location(0) vec4<f32> {\n  // Create and initialize geometry with the provided uv.\n  var geometry: Geometry;\n  geometry.uv = uv;\n\n  // Start with the input color.\n  var fragColor: vec4<f32> = vColor;\n\n  // Apply the deck.gl filter to the color.\n  fragColor = deckgl_filter_color(fragColor, geometry);\n\n  return fragColor;\n}\n',modules:[zT,BT,lA]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw(e){let{uniforms:t}=e;const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:o,wrapLongitude:s}=this.props,a=this.state.model,l={widthUnits:wm[n],widthScale:r,widthMinPixels:i,widthMaxPixels:o,useShortestPath:s?1:0};a.shaderInputs.setProps({line:l}),a.draw(this.context.renderPass),s&&(a.shaderInputs.setProps({line:{...l,useShortestPath:-1}}),a.draw(this.context.renderPass))}_getModel(){return new pE(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jT({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}}),isInstanced:!0})}}uA.layerName="LineLayer",uA.defaultProps=cA;const hA=uA;const dA=new Float32Array(12);function fA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=0;for(const r of e)for(let e=0;e<t;e++)dA[n++]=r[e]||0;return dA}class pA{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,t){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new pE(this.device,{id:t.id||"texture-transform-model",fs:t.fs||Tb({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:"transform_output"}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){this.model.destroy();for(const e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(n),n.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,t){let{sourceBuffers:n,sourceTextures:r,targetTexture:i}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,n),i){e.targetTexture=i;const{width:t,height:n}=i;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:t,height:n,colorAttachments:[i]}),e.framebuffer.resize({width:t,height:n})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const n in t)t[n].sampler=this.sampler}}const mA="uniform triangleUniforms {\n  float aggregationMode;\n  vec2 colorDomain;\n  float intensity;\n  float threshold;\n} triangle;\n",gA={name:"triangle",vs:mA,fs:mA,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class _A extends CT{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME heatp-map-layer-vertex-shader\nuniform sampler2D maxTexture;\nin vec3 positions;\nin vec2 texCoords;\nout vec2 vTexCoords;\nout float vIntensityMin;\nout float vIntensityMax;\nvoid main(void) {\ngl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));\nvTexCoords = texCoords;\nvec4 maxTexture = texture(maxTexture, vec2(0.5));\nfloat maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;\nfloat minValue = maxValue * triangle.threshold;\nif (triangle.colorDomain[1] > 0.) {\nmaxValue = triangle.colorDomain[1];\nminValue = triangle.colorDomain[0];\n}\nvIntensityMax = triangle.intensity / maxValue;\nvIntensityMin = triangle.intensity / minValue;\n}\n",fs:"#version 300 es\n#define SHADER_NAME triangle-layer-fragment-shader\nprecision highp float;\nuniform sampler2D weightsTexture;\nuniform sampler2D colorTexture;\nin vec2 vTexCoords;\nin float vIntensityMin;\nin float vIntensityMax;\nout vec4 fragColor;\nvec4 getLinearColor(float value) {\nfloat factor = clamp(value * vIntensityMax, 0., 1.);\nvec4 color = texture(colorTexture, vec2(factor, 0.5));\ncolor.a *= min(value * vIntensityMin, 1.0);\nreturn color;\n}\nvoid main(void) {\nvec4 weights = texture(weightsTexture, vTexCoords);\nfloat weight = weights.r;\nif (triangle.aggregationMode > 0.5) {\nweight /= max(1.0, weights.a);\n}\nif (weight <= 0.) {\ndiscard;\n}\nvec4 linearColor = getLinearColor(weight);\nlinearColor.a *= layer.opacity;\nfragColor = linearColor;\n}\n",modules:[zT,gA]})}initializeState(e){let{device:t}=e;this.setState({model:this._getModel(t)})}_getModel(e){const{vertexCount:t,data:n}=this.props;return new pE(e,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:n,intensity:r,threshold:i,colorTexture:o,maxTexture:s,weightsTexture:a}=this.props,l={aggregationMode:t,colorDomain:n,intensity:r,threshold:i,colorTexture:o,maxTexture:s,weightsTexture:a};e.shaderInputs.setProps({triangle:l}),e.draw(this.context.renderPass)}}_A.layerName="TriangleLayer";const yA=_A;class vA extends CT{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:n}=t;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id?(t.object=n.__source.object,t.index=n.__source.index,t):t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if("function"===typeof e){const t={index:-1,data:this.props.data,target:[]};return(n,r)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,r)}return e}getSubLayerProps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{opacity:t,pickable:n,visible:r,parameters:i,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:f,extensions:p,fetch:m,operation:g,_subLayerProps:_}=this.props,y={id:"",updateTriggers:{},opacity:t,pickable:n,visible:r,parameters:i,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:f,extensions:p,fetch:m,operation:g},v=_&&e.id&&_[e.id],x=v&&v.updateTriggers,b=e.id||"sublayer";if(v){const t=this.props[Cu],n=e.type?e.type._propTypes:{};for(const e in v){const r=n[e]||t[e];r&&"accessor"===r.type&&(v[e]=this.getSubLayerAccessor(v[e]))}}Object.assign(y,e,v),y.id=`${this.props.id}-${b}`,y.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...x};for(const w of p){const e=w.getSubLayerProps.call(this,w);e&&Object.assign(y,e,{updateTriggers:Object.assign(y.updateTriggers,e.updateTriggers)})}return y}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const r=!n||this.needsUpdate();if(r){n=nh(this.renderLayers(),Boolean),this.internalState.subLayers=n}th("compositeLayer.renderLayers",this,r,n);for(const i of n)i.parent=this}}vA.layerName="CompositeLayer";const xA=vA;function bA(e,t){const n={};for(const r in e)t.includes(r)||(n[r]=e[r]);return n}class wA extends xA{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:bA(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const e=this.getShaders({});e&&e.defines&&(e.defines.NON_INSTANCED_MODEL=1),this.updateShaders(e)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{props:n,oldProps:r,changeFlags:i}=e,{compareAll:o=!1,dimension:s}=t,{ignoreProps:a}=this.state,{props:l,accessors:c=[]}=s,{updateTriggersChanged:u}=i;if(i.dataChanged)return!0;if(u){if(u.all)return!0;for(const e of c)if(u[e])return!0}if(o)return!!i.extensionsChanged||qE({oldProps:r,newProps:n,ignoreProps:a,propTypes:this.constructor._propTypes});for(const h of l)if(n[h]!==r[h])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&void 0!==t[e]:!function(e){let t=!0;for(const n in e){t=!1;break}return t}(t)}_getAttributeManager(){return new BE(this.context.device,{id:this.props.id,stats:this.context.stats})}}wA.layerName="AggregationLayer";const SA=wA;const EA=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function TA(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float32Array;if(Number.isFinite(e[0]))t=new r(e);else{t=new r(4*e.length);let n=0;for(let r=0;r<e.length;r++){const i=e[r];t[n++]=i[0],t[n++]=i[1],t[n++]=i[2],t[n++]=Number.isFinite(i[3])?i[3]:255}}if(n)for(let i=0;i<t.length;i++)t[i]/=255;return t}const AA={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};const CA="#version 300 es\nin vec3 positions;\nin vec3 positions64Low;\nin float weights;\nout vec4 weightsTexture;\nvoid main()\n{\nweightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);\nfloat radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);\ngl_PointSize = radiusTexels * 2.;\nvec3 commonPosition = project_position(positions, positions64Low);\ngl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;\ngl_Position.xy = (gl_Position.xy * 2.) - (1.);\ngl_Position.w = 1.0;\n}\n",PA="#version 300 es\nin vec4 weightsTexture;\nout vec4 fragColor;\nfloat gaussianKDE(float u){\nreturn pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);\n}\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(0.5, 0.5));\nif (dist > 0.5) {\ndiscard;\n}\nfragColor = weightsTexture * gaussianKDE(2. * dist);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",IA={name:"weight",vs:"uniform weightUniforms {\n  vec4 commonBounds;\n  float radiusPixels;\n  float textureWidth;\n  float weightsScale;\n} weight;\n",uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},kA={name:"maxWeight",vs:"uniform maxWeightUniforms {\n  float textureSize;\n} maxWeight;\n",uniformTypes:{textureSize:"f32"}},MA={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},RA=[0,0],OA={SUM:0,MEAN:1},LA={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:EA,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},DA=["float32-renderable-webgl","texture-blend-float-webgl"],NA={data:{props:["radiusPixels"]}};class zA extends SA{getShaders(e){let t=[zT];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(NA),this.setState({colorDomain:RA}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:n}=e,r=this._getChangeFlags(e);(r.dataChanged||r.viewportChanged)&&(r.boundsChanged=this._updateBounds(r.dataChanged),this._updateTextureRenderingBounds()),r.dataChanged||r.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):r.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==n.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:n,maxWeightsTexture:r,colorTexture:i,colorDomain:o}=this.state,{updateTriggers:s,intensity:a,threshold:l,aggregation:c}=this.props;return new(this.getSubLayerClass("triangle",yA))(this.getSubLayerProps({id:"triangle-layer",updateTriggers:s}),{coordinateSystem:xm.DEFAULT,data:{attributes:{positions:t,texCoords:n}},vertexCount:4,maxTexture:r,colorTexture:i,aggregationMode:OA[c]||0,weightsTexture:e,intensity:a,threshold:l,colorDomain:o})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:n,maxWeightTransform:r,maxWeightsTexture:i,triPositionBuffer:o,triTexCoordBuffer:s,colorTexture:a,updateTimer:l}=this.state;t?.destroy(),n?.destroy(),r?.destroy(),i?.destroy(),o?.destroy(),s?.destroy(),a?.destroy(),l&&clearTimeout(l)}_getAttributeManager(){return new BE(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:n}=this.state;t.dataChanged=this.isAttributeChanged()?"attribute changed":this.isAggregationDirty(e,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:r}=this.state;return e.context.viewport&&e.context.viewport.zoom===r||(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...MA,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...MA,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,n=Math.min(t,e.limits.maxTextureDimension2D),r=DA.every(t=>e.features.has(t)),i=r?"rgba32float":"rgba8unorm",o=r?1:1/255;this.setState({textureSize:n,format:i,weightsScale:o}),r||Ju.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:n}=this.state,r=this.getAttributeManager();t?.destroy(),t=new pA(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:r.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,IA]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:n,maxWeightsTexture:r}=this.state,i=this.getShaders({vs:CA,fs:PA});this._createWeightsTransform(i);const o=this.getShaders({vs:"#version 300 es\nuniform sampler2D inTexture;\nout vec4 outTexture;\nvoid main()\n{\nint yIndex = gl_VertexID / int(maxWeight.textureSize);\nint xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));\nvec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;\noutTexture = texture(inTexture, uv);\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\ngl_PointSize = 1.0;\n}\n",fs:"#version 300 es\nin vec4 outTexture;\nout vec4 fragColor;\nvoid main() {\nfragColor = outTexture;\nfragColor.g = outTexture.r / max(1.0, outTexture.a);\n}\n",modules:[kA]}),s=new pA(e,{id:`${this.id}-max-weights-transform`,targetTexture:r,...o,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),a={inTexture:n,textureSize:t};s.model.shaderInputs.setProps({maxWeight:a}),this.setState({weightsTexture:n,maxWeightsTexture:r,maxWeightTransform:s,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:CA,fs:PA,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{viewport:t}=this.context,n=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(e=>e.map(Math.fround)),r=function(e){const t=e.map(e=>e[0]),n=e.map(e=>e[1]),r=Math.min.apply(null,t),i=Math.max.apply(null,t);return[r,Math.min.apply(null,n),i,Math.max.apply(null,n)]}(n),i={visibleWorldBounds:r,viewportCorners:n};let o=!1;if(e||!this.state.worldBounds||(s=this.state.worldBounds,!((a=r)[0]>=s[0]&&a[2]<=s[2]&&a[1]>=s[1]&&a[3]<=s[3]))){const e=this._worldToCommonBounds(r),t=this._commonToWorldBounds(e);this.props.coordinateSystem===xm.LNGLAT&&(t[1]=Math.max(t[1],-85.051129),t[3]=Math.min(t[3],85.051129),t[0]=Math.max(t[0],-360),t[2]=Math.min(t[2],360));const n=this._worldToCommonBounds(t);i.worldBounds=t,i.normalizedCommonBounds=n,o=!0}var s,a;return this.setState(i),o}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:n,viewportCorners:r}=this.state,{viewport:i}=this.context;e.write(fA(r,3));const o=r.map(e=>function(e,t){const[n,r,i,o]=t;return[(e[0]-n)/(i-n),(e[1]-r)/(o-r)]}(i.projectPosition(e),n));t.write(fA(o,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:n}=this.state;const r=TA(t,!1,Uint8Array);n&&n?.width===t.length?n.setTexture2DData({data:r}):(n?.destroy(),n=this.context.device.createTexture({...MA,data:r,width:t.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:n}=this.props,{worldBounds:r,textureSize:i,weightsScale:o,weightsTexture:s}=this.state,a=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const l=this._worldToCommonBounds(r,{useLayerCoordinateSystem:!0});if(t&&"SUM"===n){const{viewport:e}=this.context,n=e.distanceScales.metersPerUnit[2]*(l[2]-l[0])/i;this.state.colorDomain=t.map(e=>e*n*o)}else this.state.colorDomain=t||RA;const c=this.getAttributeManager().getAttributes(),u=this.getModuleSettings();this._setModelAttributes(a.model,c),a.model.setVertexCount(this.getNumInstances());const h={radiusPixels:e,commonBounds:l,textureWidth:i,weightsScale:o,weightsTexture:s},{viewport:d,devicePixelRatio:f,coordinateSystem:p,coordinateOrigin:m}=u,{modelMatrix:g}=this.props;a.model.shaderInputs.setProps({project:{viewport:d,devicePixelRatio:f,modelMatrix:g,coordinateSystem:p,coordinateOrigin:m},weight:h}),a.run({parameters:{viewport:[0,0,i,i]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{updateTimer:t}=this.state;const{debounceTimeout:n}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:t})}_worldToCommonBounds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{useLayerCoordinateSystem:n=!1}=t,[r,i,o,s]=e,{viewport:a}=this.context,{textureSize:l}=this.state,{coordinateSystem:c}=this.props,u=n&&(c===xm.LNGLAT_OFFSETS||c===xm.METER_OFFSETS),h=u?a.projectPosition(this.props.coordinateOrigin):[0,0],d=2*l/a.scale;let f,p;return n&&!u?(f=this.projectPosition([r,i,0]),p=this.projectPosition([o,s,0])):(f=a.projectPosition([r,i,0]),p=a.projectPosition([o,s,0])),function(e,t,n){const[r,i,o,s]=e,a=o-r,l=s-i;let c=a,u=l;a/l<t/n?c=t/n*l:u=n/t*a,c<t&&(c=t,u=n);const h=(o+r)/2,d=(s+i)/2;return[h-c/2,d-u/2,h+c/2,d+u/2]}([f[0]-h[0],f[1]-h[1],p[0]-h[0],p[1]-h[1]],d,d)}_commonToWorldBounds(e){const[t,n,r,i]=e,{viewport:o}=this.context,s=o.unprojectPosition([t,n]),a=o.unprojectPosition([r,i]);return s.slice(0,2).concat(a.slice(0,2))}}zA.layerName="HeatmapLayer",zA.defaultProps=LA;const FA=zA;function BA(e,t,n){return e.createFramebuffer({width:t,height:n,colorAttachments:[e.createTexture({width:t,height:n,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const jA={name:"binSorter",vs:"uniform binSorterUniforms {\n  ivec4 binIdRange;\n  ivec2 targetSize;\n} binSorter;\n",uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},UA=[1,2,4,8],VA=3e38,GA={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},HA=1024;class $A{constructor(e,t){this.binsFBO=null,this.device=e,this.model=function(e,t){let n=t.vs;2===t.dimensions&&(n+="\nvoid getBin(out int binId) {\n  ivec2 binId2;\n  getBin(binId2);\n  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {\n    binId = -1;\n  } else {\n    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;\n  }\n}\n");const r=`#version 300 es\n#define SHADER_NAME gpu-aggregation-sort-bins-vertex\n\n${n}\n\nout vec3 v_Value;\n\nvoid main() {\n  int binIndex;\n  getBin(binIndex);\n  binIndex = binIndex - binSorter.binIdRange.x;\n  if (binIndex < 0) {\n    gl_Position = vec4(0.);\n    return;\n  }\n  int row = binIndex / binSorter.targetSize.x;\n  int col = binIndex - row * binSorter.targetSize.x;\n  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;\n  gl_Position = vec4(position, 0.0, 1.0);\n  gl_PointSize = 1.0;\n\n#if NUM_CHANNELS == 3\n  getValue(v_Value);\n#elif NUM_CHANNELS == 2\n  getValue(v_Value.xy);\n#else\n  getValue(v_Value.x);\n#endif\n}\n`,i="#version 300 es\n#define SHADER_NAME gpu-aggregation-sort-bins-fragment\n\nprecision highp float;\n\nin vec3 v_Value;\nout vec4 fragColor;\n\nvoid main() {\n  fragColor.xyz = v_Value;\n\n  #ifdef MODULE_GEOMETRY\n  geometry.uv = vec2(0.);\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n  #endif\n\n  fragColor.w = 1.0;\n}\n",o=new pE(e,{bufferLayout:t.bufferLayout,modules:[...t.modules||[],jA],defines:{...t.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:t.channelCount},isInstanced:!1,vs:r,fs:i,topology:"point-list",disableWarnings:!0});return o}(e,t)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(e){if(!this.binsFBO)return null;const t=e%HA,n=Math.floor(e/HA),r=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:t,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(r)}setDimensions(e,t){const n=HA,r=Math.ceil(e/n);this.binsFBO?this.binsFBO.height<r&&this.binsFBO.resize({width:n,height:r}):this.binsFBO=BA(this.device,n,r);const i={binIdRange:[t[0][0],t[0][1],t[1]?.[0]||0,t[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:i})}setModelProps(e){const t=this.model;e.attributes&&t.setAttributes(e.attributes),e.constantAttributes&&t.setConstantAttributes(e.constantAttributes),void 0!==e.vertexCount&&t.setVertexCount(e.vertexCount),e.shaderModuleProps&&t.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const t=function(e){const t={...GA};for(let n=0;n<e.length;n++){const r=e[n];r&&(t[r]+=UA[n])}return t}(e);this._updateBins("SUM",t.SUM+t.MEAN),this._updateBins("MIN",t.MIN),this._updateBins("MAX",t.MAX)}_updateBins(e,t){if(0===t)return;t|=UA[3];const n=this.model,r=this.binsFBO,i="MAX"===e?-VA:"MIN"===e?VA:0,o=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:r,parameters:{viewport:[0,0,r.width,r.height],colorMask:t},clearColor:[i,i,i,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:"MAX"===e?"max":"MIN"===e?"min":"add",blendAlphaOperation:"add"}),n.draw(o),o.end()}}const WA={name:"aggregatorTransform",vs:"uniform aggregatorTransformUniforms {\n  ivec4 binIdRange;\n  bvec3 isCount;\n  bvec3 isMean;\n  float naN;\n} aggregatorTransform;\n",uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class qA{constructor(e,t){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=t.channelCount,this.transform=function(e,t){const n="#version 300 es\n#define SHADER_NAME gpu-aggregation-domain-vertex\n\nuniform sampler2D bins;\n\n#if NUM_DIMS == 1\nout float binIds;\n#else\nout vec2 binIds;\n#endif\n\n#if NUM_CHANNELS == 1\nflat out float values;\n#elif NUM_CHANNELS == 2\nflat out vec2 values;\n#else\nflat out vec3 values;\n#endif\n\nconst float NAN = intBitsToFloat(-1);\n\nvoid main() {\n  int row = gl_VertexID / SAMPLER_WIDTH;\n  int col = gl_VertexID - row * SAMPLER_WIDTH;\n  vec4 weights = texelFetch(bins, ivec2(col, row), 0);\n  vec3 value3 = mix(\n    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),\n    weights.rgb / max(weights.a, 1.0),\n    aggregatorTransform.isMean\n  );\n  if (weights.a == 0.0) {\n    value3 = vec3(NAN);\n  }\n\n#if NUM_DIMS == 1\n  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);\n#else\n  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);\n  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);\n  binIds.y = float(y + aggregatorTransform.binIdRange.z);\n  binIds.x = float(x + aggregatorTransform.binIdRange.x);\n#endif\n\n#if NUM_CHANNELS == 3\n  values = value3;\n#elif NUM_CHANNELS == 2\n  values = value3.xy;\n#else\n  values = value3.x;\n#endif\n\n  gl_Position = vec4(0., 0., 0., 1.);\n  // This model renders into a 2x1 texture to obtain min and max simultaneously.\n  // See comments in fragment shader\n  gl_PointSize = 2.0;\n}\n",r="#version 300 es\n#define SHADER_NAME gpu-aggregation-domain-fragment\n\nprecision highp float;\n\n#if NUM_CHANNELS == 1\nflat in float values;\n#elif NUM_CHANNELS == 2\nflat in vec2 values;\n#else\nflat in vec3 values;\n#endif\n\nout vec4 fragColor;\n\nvoid main() {\n  vec3 value3;\n#if NUM_CHANNELS == 3\n  value3 = values;\n#elif NUM_CHANNELS == 2\n  value3.xy = values;\n#else\n  value3.x = values;\n#endif\n  if (isnan(value3.x)) discard;\n  // This shader renders into a 2x1 texture with blending=max\n  // The left pixel yields the max value of each channel\n  // The right pixel yields the min value of each channel\n  if (gl_FragCoord.x < 1.0) {\n    fragColor = vec4(value3, 1.0);\n  } else {\n    fragColor = vec4(-value3, 1.0);\n  }\n}\n";return new _E(e,{vs:n,fs:r,topology:"point-list",modules:[WA],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:t.dimensions,NUM_CHANNELS:t.channelCount,SAMPLER_WIDTH:HA},varyings:["binIds","values"],disableWarnings:!0})}(e,t),this.domainFBO=BA(e,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,t=new Float32Array(e);this._domains=[[-t[4],t[0]],[-t[5],t[1]],[-t[6],t[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,t){const{model:n,transformFeedback:r}=this.transform;n.setVertexCount(e);const i={binIdRange:[t[0][0],t[0][1],t[1]?.[0]||0,t[1]?.[1]||0]};n.shaderInputs.setProps({aggregatorTransform:i});const o=e*t.length*4;(!this.binBuffer||this.binBuffer.byteLength<o)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:o}),r.setBuffer("binIds",this.binBuffer));const s=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<s)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:s}),r.setBuffer("values",this.valueBuffer))}update(e,t){if(!e)return;const n=this.transform,r=this.domainFBO,i=[0,1,2].map(e=>"COUNT"===t[e]?1:0),o=[0,1,2].map(e=>"MEAN"===t[e]?1:0),s={isCount:i,isMean:o,bins:e};n.model.shaderInputs.setProps({aggregatorTransform:s}),n.run({id:"gpu-aggregation-domain",framebuffer:r,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}class XA{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,t){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=t.dimensions,this.channelCount=t.channelCount,this.props={...t,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new $A(e,t),this.aggregationTransform=new qA(e,t),this.setProps(t)}getBins(){const e=this.aggregationTransform.binBuffer;return e?(this.binIds?.buffer!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){const t=this.aggregationTransform.valueBuffer;return!t||e>=this.channelCount?null:(this.results[e]?.buffer!==t&&(this.results[e]={buffer:t,type:"float32",size:1,stride:4*this.channelCount,offset:4*e}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:t}=this.props;let n;if(1===this.dimensions)n=[e+t[0][0]];else{const[[r,i],[o]]=t,s=i-r;n=[e%s+r,Math.floor(e/s)+o]}const r=this.binSorter.getBinValues(e);if(!r)return null;const i=r[3],o=[];for(let s=0;s<this.channelCount;s++){const e=this.props.operations[s];o[s]="COUNT"===e?i:0===i?NaN:"MEAN"===e?r[s]/i:r[s]}return{id:n,value:o,count:i}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const t=this.props;if("binIdRange"in e&&!Rm(e.binIdRange,t.binIdRange,2)){const t=e.binIdRange;if(Ju.assert(t.length===this.dimensions),1===this.dimensions){const[[e,n]]=t;this.binCount=n-e}else{const[[e,n],[r,i]]=t;this.binCount=(n-e)*(i-r)}this.binSorter.setDimensions(this.binCount,t),this.aggregationTransform.setDimensions(this.binCount,t),this.setNeedsUpdate()}if(e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==t.operations[n]&&this.setNeedsUpdate(n);if(void 0!==e.pointCount&&e.pointCount!==t.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(Rm(e.binOptions,t.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const t={},n={};for(const r of Object.values(e.attributes))for(const[e,i]of Object.entries(r.getValue()))ArrayBuffer.isView(i)?n[e]=i:i&&(t[e]=i);this.binSorter.setModelProps({attributes:t,constantAttributes:n})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){void 0===e?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,t=this.needsUpdate.map((t,n)=>t?e[n]:null);this.binSorter.update(t),this.aggregationTransform.update(this.binSorter.texture,e);for(let n=0;n<this.channelCount;n++)this.needsUpdate[n]&&(this.needsUpdate[n]=!1,this.props.onUpdate?.({channel:n}))}}const ZA=(e,t)=>{let n=0;for(const r of e)n+=t(r);return n},KA={COUNT:e=>e.length,SUM:ZA,MEAN:(e,t)=>0===e.length?NaN:ZA(e,t)/e.length,MIN:(e,t)=>{let n=1/0;for(const r of e){const e=t(r);e<n&&(n=e)}return n},MAX:(e,t)=>{let n=-1/0;for(const r of e){const e=t(r);e>n&&(n=e)}return n}};function YA(e){let{bins:t,getValue:n,operation:r,target:i}=e;(!i||i.length<t.length)&&(i=new Float32Array(t.length));let o=1/0,s=-1/0;for(let a=0;a<t.length;a++){const{points:e}=t[a];i[a]=r(e,n),i[a]<o&&(o=i[a]),i[a]>s&&(s=i[a])}return{value:i,domain:[o,s]}}function JA(e,t,n){const r={};for(const o of e.sources||[]){const e=t[o];if(!e)throw new Error(`Cannot find attribute ${o}`);r[o]=QA(e)}const i={};return t=>{for(const e in r)i[e]=r[e](t);return e.getValue(i,t,n)}}function QA(e){const t=e.value,{offset:n=0,stride:r,size:i}=e.getAccessor(),o=t.BYTES_PER_ELEMENT,s=n/o,a=r?r/o:i;if(1===i)return e.isConstant?()=>t[0]:e=>t[s+a*e];let l;return e.isConstant?(l=Array.from(t),()=>l):(l=new Array(i),e=>{const n=s+a*e;for(let r=0;r<i;r++)l[r]=t[n+r];return l})}class eC{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const t=this.props;if(e.binOptions&&(Rm(e.binOptions,t.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==t.operations[n]&&this.setNeedsUpdate(n);if(e.customOperations)for(let n=0;n<this.channelCount;n++)Boolean(e.customOperations[n])!==Boolean(t.customOperations[n])&&this.setNeedsUpdate(n);void 0!==e.pointCount&&e.pointCount!==t.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...t.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){void 0===e?this.needsUpdate=!0:!0!==this.needsUpdate&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){if(!0===this.needsUpdate){this.bins=function(e){let{pointCount:t,getBinId:n}=e;const r=new Map;for(let i=0;i<t;i++){const e=n(i);if(null===e)continue;let t=r.get(String(e));t?t.points.push(i):(t={id:e,index:r.size,points:[i]},r.set(String(e),t))}return Array.from(r.values())}({pointCount:this.props.pointCount,getBinId:JA(this.props.getBin,this.props.attributes,this.props.binOptions)});const e=function(e){let{bins:t,dimensions:n,target:r}=e;const i=t.length*n;(!r||r.length<i)&&(r=new Float32Array(i));for(let o=0;o<t.length;o++){const{id:e}=t[o];Array.isArray(e)?r.set(e,o*n):r[o]=e}return r}({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:e,type:"float32",size:this.dimensions}}for(let e=0;e<this.channelCount;e++)if(!0===this.needsUpdate||this.needsUpdate[e]){const t=this.props.customOperations[e]||KA[this.props.operations[e]],{value:n,domain:r}=YA({bins:this.bins,getValue:JA(this.props.getValue[e],this.props.attributes,void 0),operation:t,target:this.results[e]?.value});this.results[e]={value:n,domain:r,type:"float32",size:1},this.props.onUpdate?.({channel:e})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){return this.results[e]?.domain??[1/0,-1/0]}getBin(e){const t=this.bins[e];if(!t)return null;const n=new Array(this.channelCount);for(let r=0;r<n.length;r++){const t=this.results[r];n[r]=t?.value[e]}return{id:t.id,value:n,count:t.points.length,pointIndices:t.points}}}class tC extends xA{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){super.updateState(e);const t=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==t){this.state.aggregator?.destroy();const e=this.createAggregator(t);return e.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:e,aggregatorType:t}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:t}=this.state;t.setProps({attributes:e});for(const n in e)this.onAttributeChange(n);t.update()}draw(e){let{shaderModuleProps:t}=e;const{aggregator:n}=this.state;n.setProps({shaderModuleProps:t}),n.preDraw()}_getAttributeManager(){return new BE(this.context.device,{id:this.props.id,stats:this.context.stats})}}tC.layerName="AggregationLayer";const nC=tC;class rC{constructor(e,t){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=t,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=iC(this.input,this.inputLength);this._percentile=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const n=Array.from(e).filter(Number.isFinite).sort(oC);let r=0;const i=Math.max(1,t),o=new Array(i-1);for(;++r<i;)o[r-1]=sC(n,r/i);return{attribute:{value:e.map(e=>Number.isFinite(e)?function(e,t){let n=0,r=e.length;for(;n<r;){const i=n+r>>>1;e[i]>t?r=i:n=i+1}return n}(o,e):NaN),type:"float32",size:1},domain:o}}(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=iC(this.input,this.inputLength);this._ordinal=function(e){const t=new Set;for(const i of e)Number.isFinite(i)&&t.add(i);const n=Array.from(t).sort(),r=new Map;for(let i=0;i<n.length;i++)r.set(n[i],i);return{attribute:{value:e.map(e=>Number.isFinite(e)?r.get(e):NaN),type:"float32",size:1},domain:n}}(e)}return this._ordinal}getCutoff(e){let{scaleType:t,lowerPercentile:n,upperPercentile:r}=e;if("quantile"===t)return[n,r-1];if(n>0||r<100){const{domain:e}=this.getScalePercentile();let i=e[Math.floor(n)-1]??-1/0,o=e[Math.floor(r)-1]??1/0;if("ordinal"===t){const{domain:e}=this.getScaleOrdinal();i=e.findIndex(e=>e>=i),o=e.findIndex(e=>e>o)-1,-2===o&&(o=e.length-1)}return[i,o]}return null}update(e){const t=this.props;if(e.scaleType!==t.scaleType)switch(e.scaleType){case"quantile":{const{attribute:e}=this.getScalePercentile();this.attribute=e,this.domain=[0,99];break}case"ordinal":{const{attribute:e,domain:t}=this.getScaleOrdinal();this.attribute=e,this.domain=[0,t.length-1];break}default:this.attribute=this.input,this.domain=null}return e.scaleType===t.scaleType&&e.lowerPercentile===t.lowerPercentile&&e.upperPercentile===t.upperPercentile||(this.cutoff=this.getCutoff(e)),this.props=e,this}}function iC(e,t){const n=(e.stride??4)/4,r=(e.offset??0)/4;let i=e.value;if(!i){const r=e.buffer?.readSyncWebGL(0,4*n*t);r&&(i=new Float32Array(r.buffer),e.value=i)}if(1===n)return i.subarray(0,t);const o=new Float32Array(t);for(let s=0;s<t;s++)o[s]=i[s*n+r];return o}function oC(e,t){return e-t}function sC(e,t){const n=e.length;if(t<=0||n<2)return e[0];if(t>=1)return e[n-1];const r=(n-1)*t,i=Math.floor(r),o=e[i];return o+(e[i+1]-o)*(r-i)}const aC="precision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int lightType;\n\n  int directionalLightCount;\n  int pointLightCount;\n\n  vec3 ambientColor;\n\n  vec3 lightColor0;\n  vec3 lightPosition0;\n  vec3 lightDirection0;\n  vec3 lightAttenuation0;\n\n  vec3 lightColor1;\n  vec3 lightPosition1;\n  vec3 lightDirection1;\n  vec3 lightAttenuation1;\n\n  vec3 lightColor2;\n  vec3 lightPosition2;\n  vec3 lightDirection2;\n  vec3 lightAttenuation2;\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  switch (index) {\n    case 0:\n      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);\n    case 1:\n      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);\n    case 2:\n    default:  \n      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);\n  }\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  switch (index) {\n    case 0:\n      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);\n    case 1:\n      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);\n    case 2:\n    default:   \n      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);\n  }\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n";var lC;!function(e){e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL"}(lC||(lC={}));const cC={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:3},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:lC.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:"// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  color: vec3<f32>,\n};\n\nstruct PointLight {\n  color: vec3<f32>,\n  position: vec3<f32>,\n  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  color: vec3<f32>,\n  direction: vec3<f32>,\n};\n\nstruct lightingUniforms {\n  enabled: i32,\n  pointLightCount: i32,\n  directionalLightCount: i32,\n\n  ambientColor: vec3<f32>,\n\n  // TODO - support multiple lights by uncommenting arrays below\n  lightType: i32,\n  lightColor: vec3<f32>,\n  lightDirection: vec3<f32>,\n  lightPosition: vec3<f32>,\n  lightAttenuation: vec3<f32>,\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n};\n\n// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)\n@binding(1) @group(0) var<uniform> lighting : lightingUniforms;\n\nfn lighting_getPointLight(index: i32) -> PointLight {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nfn lighting_getDirectionalLight(index: i32) -> DirectionalLight {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n",vs:aC,fs:aC,getUniforms:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e=e?{...e}:e))return{...cC.defaultUniforms};e.lights&&(e={...e,...hC(e.lights),lights:void 0});const{ambientLight:n,pointLights:r,directionalLights:i}=e||{};if(!(n||r&&r.length>0||i&&i.length>0))return{...cC.defaultUniforms,enabled:0};const o={...cC.defaultUniforms,...t,...uC({ambientLight:n,pointLights:r,directionalLights:i})};void 0!==e.enabled&&(o.enabled=e.enabled?1:0);return o}};function uC(e){let{ambientLight:t,pointLights:n=[],directionalLights:r=[]}=e;const i={};i.ambientLightColor=dC(t);let o=0;for(const s of n){i.lightType=lC.POINT;const e=o;i[`lightColor${e}`]=dC(s),i[`lightPosition${e}`]=s.position,i[`lightAttenuation${e}`]=s.attenuation||[1,0,0],o++}for(const s of r){i.lightType=lC.DIRECTIONAL;const e=o;i[`lightColor${e}`]=dC(s),i[`lightDirection${e}`]=s.direction,o++}return o>3&&$_.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=r.length,i.pointLightCount=n.length,i}function hC(e){const t={pointLights:[],directionalLights:[]};for(const n of e||[])switch(n.type){case"ambient":t.ambientLight=n;break;case"directional":t.directionalLights?.push(n);break;case"point":t.pointLights?.push(n)}return t}function dC(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{color:t=[0,0,0],intensity:n=1}=e;return t.map(e=>e*n/255)}const fC="struct phongMaterialUniforms {\n  ambient: f32,\n  diffuse: f32,\n  shininess: f32,\n  specularColor: vec3<f32>,\n};\n\n@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;\n\nfn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {\n  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);\n  var lambertian: f32 = dot(light_direction, normal_worldspace);\n  var specular: f32 = 0.0;\n  if (lambertian > 0.0) {\n    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, phongMaterial.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;\n}\n\nfn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {\n  var lightColor: vec3<f32> = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);\n  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    let pointLight: PointLight  = lighting_getPointLight(0);\n    let light_position_worldspace: vec3<f32> = pointLight.position;\n    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n}\n\nfn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{\n  var lightColor = vec3<f32>(0, 0, 0);\n  let surfaceColor = vec3<f32>(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    let view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0, default: {\n        let pointLight: PointLight = lighting_getPointLight(0);\n        let light_position_worldspace: vec3<f32> = pointLight.position;\n        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n      }\n      case 1: {\n        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n      }\n    }\n  }\n  return lightColor;\n}\n",pC="uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n",mC="uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  for (int i = 0; i < lighting.pointLightCount; i++) {\n    PointLight pointLight = lighting_getPointLight(i);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);\n  }\n\n  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);\n  for (int i = lighting.pointLightCount; i < totalLights; i++) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(i);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n}\n",gC={name:"phongMaterial",dependencies:[cC],source:fC,vs:pC,fs:mC,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...gC.defaultUniforms,...t}}},_C={props:{},name:"gouraudMaterial",vs:mC.replace("phongMaterial","gouraudMaterial"),fs:pC.replace("phongMaterial","gouraudMaterial"),source:fC.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[cC],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{..._C.defaultUniforms,...t}}},yC=1,vC=-1;function xC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Math.sign(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{start:n=0,end:r=e.length,plane:i="xy"}=t,o=t.size||2;let s=0;const a=bC[i[0]],l=bC[i[1]];for(let c=n,u=r-o;c<r;c+=o)s+=(e[c+a]-e[u+a])*(e[c+l]+e[u+l]),u=c;return s/2}(e,t))}(e,n);return r!==t&&(function(e,t){const{start:n=0,end:r=e.length,size:i=2}=t,o=(r-n)/i,s=Math.floor(o/2);for(let a=0;a<s;++a){const t=n+a*i,r=n+(o-1-a)*i;for(let n=0;n<i;++n){const i=e[t+n];e[t+n]=e[r+n],e[r+n]=i}}}(e,n),!0)}const bC={x:0,y:1,z:2};function wC(e,t,n,r){let i,o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(8&n)i=(r[3]-e[1])/(t[1]-e[1]),o=3;else if(4&n)i=(r[1]-e[1])/(t[1]-e[1]),o=1;else if(2&n)i=(r[2]-e[0])/(t[0]-e[0]),o=2;else{if(!(1&n))return null;i=(r[0]-e[0])/(t[0]-e[0]),o=0}for(let a=0;a<e.length;a++)s[a]=(1&o)===a?r[o]:i*(t[a]-e[a])+e[a];return s}function SC(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function EC(e,t){const n=t.length,r=e.length;if(r>0){let i=!0;for(let o=0;o<n;o++)if(e[r-n+o]!==t[o]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)e[r+i]=t[i];return!0}function TC(e,t){const n=t.length;for(let r=0;r<n;r++)e[r]=t[r]}function AC(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];const o=r+t*n;for(let s=0;s<n;s++)i[s]=e[o+s];return i}function CC(e,t){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:a=e.length}=t||{},l=(a-s)/n;let c=[];const u=[c],h=AC(e,0,n,s);let d,f;const p=kC(h,i,o,[]),m=[];EC(c,h);for(let g=1;g<l;g++){for(d=AC(e,g,n,s,d),f=SC(d,p);f;){wC(h,d,f,p,m);const e=SC(m,p);e&&(wC(h,m,e,p,m),f=e),EC(c,m),TC(h,m),MC(p,i,f),r&&c.length>n&&(c=[],u.push(c),EC(c,h)),f=SC(d,p)}EC(c,d),TC(h,d)}return r?u:u[0]}function PC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;if(!e.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:o=[0,0],edgeTypes:s=!1}=n||{},a=[],l=[{pos:e,types:s?new Array(e.length/r).fill(1):null,holes:t||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:e,types:t,holes:n}=l.shift();RC(e,r,n[0]||e.length,c),u=kC(c[0],i,o,u);const h=SC(c[1],u);if(h){let i=IC(e,t,r,0,n[0]||e.length,u,h);const o={pos:i[0].pos,types:i[0].types,holes:[]},a={pos:i[1].pos,types:i[1].types,holes:[]};l.push(o,a);for(let l=0;l<n.length;l++)i=IC(e,t,r,n[l],n[l+1]||e.length,u,h),i[0]&&(o.holes.push(o.pos.length),o.pos=OC(o.pos,i[0].pos),s&&(o.types=OC(o.types,i[0].types))),i[1]&&(a.holes.push(a.pos.length),a.pos=OC(a.pos,i[1].pos),s&&(a.types=OC(a.types,i[1].types)))}else{const r={positions:e};s&&(r.edgeTypes=t),n.length&&(r.holeIndices=n),a.push(r)}}return a}function IC(e,t,n,r,i,o,s){const a=(i-r)/n,l=[],c=[],u=[],h=[],d=[];let f,p,m;const g=AC(e,a-1,n,r);let _=Math.sign(8&s?g[1]-o[3]:g[0]-o[2]),y=t&&t[a-1],v=0,x=0;for(let b=0;b<a;b++)f=AC(e,b,n,r,f),p=Math.sign(8&s?f[1]-o[3]:f[0]-o[2]),m=t&&t[r/n+b],p&&_&&_!==p&&(wC(g,f,s,o,d),EC(l,d)&&u.push(y),EC(c,d)&&h.push(y)),p<=0?(EC(l,f)&&u.push(m),v-=p):u.length&&(u[u.length-1]=0),p>=0?(EC(c,f)&&h.push(m),x+=p):h.length&&(h[h.length-1]=0),TC(g,f),_=p,y=m;return[v?{pos:l,types:t&&u}:null,x?{pos:c,types:t&&h}:null]}function kC(e,t,n,r){const i=Math.floor((e[0]-n[0])/t)*t+n[0],o=Math.floor((e[1]-n[1])/t)*t+n[1];return r[0]=i,r[1]=o,r[2]=i+t,r[3]=o+t,r}function MC(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function RC(e,t,n,r){let i=1/0,o=-1/0,s=1/0,a=-1/0;for(let l=0;l<n;l+=t){const t=e[l],n=e[l+1];i=t<i?t:i,o=t>o?t:o,s=n<s?n:s,a=n>a?n:a}return r[0][0]=i,r[0][1]=s,r[1][0]=o,r[1][1]=a,r}function OC(e,t){for(let n=0;n<t.length;n++)e.push(t[n]);return e}function LC(e,t,n,r){let i=-1,o=-1;for(let s=n+1;s<r;s+=t){const t=Math.abs(e[s]);t>i&&(i=t,o=s-1)}return o}function DC(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:85.051129;const o=e[n],s=e[r-t];if(Math.abs(o-s)>180){const r=AC(e,0,t,n);r[0]+=360*Math.round((s-o)/360),EC(e,r),r[1]=Math.sign(r[1])*i,EC(e,r),r[0]=o,EC(e,r)}}function NC(e,t,n,r){let i,o=e[0];for(let s=n;s<r;s+=t){i=e[s];const t=i-o;(t>180||t<-180)&&(i-=360*Math.round(t/360)),e[s]=o=i}}function zC(e,t){let n;const r=e.length/t;for(let o=0;o<r&&(n=e[o*t],(n+180)%360===0);o++);const i=360*-Math.round(n/360);if(0!==i)for(let o=0;o<r;o++)e[o*t]+=i}class FC extends jT{constructor(e){const{indices:t,attributes:n}=function(e){const{radius:t,height:n=1,nradial:r=10}=e;let{vertices:i}=e;i&&(Ju.assert(i.length>=r),i=i.flatMap(e=>[e[0],e[1]]),xC(i,vC));const o=n>0,s=r+1,a=o?3*s+1:r,l=2*Math.PI/r,c=new Uint16Array(o?3*r*2:0),u=new Float32Array(3*a),h=new Float32Array(3*a);let d=0;if(o){for(let e=0;e<s;e++){const o=e*l,s=e%r,a=Math.sin(o),c=Math.cos(o);for(let e=0;e<2;e++)u[d+0]=i?i[2*s]:c*t,u[d+1]=i?i[2*s+1]:a*t,u[d+2]=(.5-e)*n,h[d+0]=i?i[2*s]:c,h[d+1]=i?i[2*s+1]:a,d+=3}u[d+0]=u[d-3],u[d+1]=u[d-2],u[d+2]=u[d-1],d+=3}for(let f=o?0:1;f<s;f++){const e=Math.floor(f/2)*Math.sign(.5-f%2),o=e*l,s=(e+r)%r,a=Math.sin(o),c=Math.cos(o);u[d+0]=i?i[2*s]:c*t,u[d+1]=i?i[2*s+1]:a*t,u[d+2]=n/2,h[d+2]=1,d+=3}if(o){let e=0;for(let t=0;t<r;t++)c[e++]=2*t+0,c[e++]=2*t+2,c[e++]=2*t+0,c[e++]=2*t+1,c[e++]=2*t+1,c[e++]=2*t+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:h}}}}(e);super({...e,indices:t,attributes:n})}}const BC="uniform columnUniforms {\n  float radius;\n  float angle;\n  vec2 offset;\n  bool extruded;\n  bool stroked;\n  bool isStroke;\n  float coverage;\n  float elevationScale;\n  float edgeDistance;\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  highp int radiusUnits;\n  highp int widthUnits;\n} column;\n",jC={name:"column",vs:BC,fs:BC,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},UC=[0,0,0,255],VC={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:UC},getLineColor:{type:"accessor",value:UC},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class GC extends CT{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME column-layer-vertex-shader\nin vec3 positions;\nin vec3 normals;\nin vec3 instancePositions;\nin float instanceElevations;\nin vec3 instancePositions64Low;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin float instanceStrokeWidths;\nin vec3 instancePickingColors;\nout vec4 vColor;\n#ifdef FLAT_SHADING\nout vec3 cameraPosition;\nout vec4 position_commonspace;\n#endif\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nvec4 color = column.isStroke ? instanceLineColors : instanceFillColors;\nmat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));\nfloat elevation = 0.0;\nfloat strokeOffsetRatio = 1.0;\nif (column.extruded) {\nelevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;\n} else if (column.stroked) {\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),\ncolumn.widthMinPixels, column.widthMaxPixels) / 2.0;\nfloat halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);\nif (column.isStroke) {\nstrokeOffsetRatio -= sign(positions.z) * halfOffset;\n} else {\nstrokeOffsetRatio -= halfOffset;\n}\n}\nfloat shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\nfloat dotRadius = column.radius * column.coverage * shouldRender;\ngeometry.pickingColor = instancePickingColors;\nvec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\nvec3 centroidPosition64Low = instancePositions64Low;\nvec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;\nif (column.radiusUnits == UNIT_METERS) {\noffset = project_size(offset);\n}\nvec3 pos = vec3(offset, 0.);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\ngeometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (column.extruded && !column.isStroke) {\n#ifdef FLAT_SHADING\ncameraPosition = project.cameraPosition;\nposition_commonspace = geometry.position;\nvColor = vec4(color.rgb, color.a * layer.opacity);\n#else\nvec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, color.a * layer.opacity);\n#endif\n} else {\nvColor = vec4(color.rgb, color.a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME column-layer-fragment-shader\nprecision highp float;\nout vec4 fragColor;\nin vec4 vColor;\n#ifdef FLAT_SHADING\nin vec3 cameraPosition;\nin vec4 position_commonspace;\n#endif\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\n#ifdef FLAT_SHADING\nif (column.extruded && !column.isStroke && !bool(picking.isActive)) {\nvec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\nfragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);\n}\n#endif\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:e,modules:[zT,t?gC:_C,BT,jC]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:UC},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:UC},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:t,oldProps:n,changeFlags:r}=e,i=r.extensionsChanged||t.flatShading!==n.flatShading;i&&(this.state.models?.forEach(e=>e.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(i||t.diskResolution!==n.diskResolution||t.vertices!==n.vertices||(t.extruded||t.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(t)}getGeometry(e,t,n){const r=new FC({radius:1,height:n?2:0,vertices:t,nradial:e});let i=0;if(t)for(let o=0;o<e;o++){const n=t[o];i+=Math.sqrt(n[0]*n[0]+n[1]*n[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),r}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),n=new pE(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),r=new pE(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:n,wireframeModel:r,models:[r,n]}}_updateGeometry(e){let{diskResolution:t,vertices:n,extruded:r,stroked:i}=e;const o=this.getGeometry(t,n,r||i);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});const s=this.state.fillModel,a=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),a.setGeometry(o),a.setTopology("line-list")}draw(e){let{uniforms:t}=e;const{lineWidthUnits:n,lineWidthScale:r,lineWidthMinPixels:i,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:a,extruded:l,filled:c,stroked:u,wireframe:h,offset:d,coverage:f,radius:p,angle:m}=this.props,g=this.state.fillModel,_=this.state.wireframeModel,{fillVertexCount:y,edgeDistance:v}=this.state,x={radius:p,angle:m/180*Math.PI,offset:d,extruded:l,stroked:u,coverage:f,elevationScale:a,edgeDistance:v,radiusUnits:wm[s],widthUnits:wm[n],widthScale:r,widthMinPixels:i,widthMaxPixels:o};l&&h&&(_.shaderInputs.setProps({column:{...x,isStroke:!0}}),_.draw(this.context.renderPass)),c&&(g.setVertexCount(y),g.shaderInputs.setProps({column:{...x,isStroke:!1}}),g.draw(this.context.renderPass)),!l&&u&&(g.setVertexCount(2*y/3),g.shaderInputs.setProps({column:{...x,isStroke:!0}}),g.draw(this.context.renderPass))}}GC.layerName="ColumnLayer",GC.defaultProps=VC;const HC=GC,$C=Math.PI/3,WC=2*Math.sin($C),qC=1.5,XC=Array.from({length:6},(e,t)=>{const n=t*$C;return[Math.sin(n),-Math.cos(n)]});function ZC(e,t){let[n,r]=e,i=Math.round(r=r/t/qC),o=Math.round(n=n/t/WC-(1&i)/2);const s=r-i;if(3*Math.abs(s)>1){const e=n-o,t=o+(n<o?-1:1)/2,a=i+(r<i?-1:1),l=n-t,c=r-a;e*e+s*s>l*l+c*c&&(o=t+(1&i?1:-1)/2,i=a)}return[o,i]}const KC=`\nconst vec2 DIST = vec2(${WC}, 1.5);\n\nivec2 pointToHexbin(vec2 p, float radius) {\n  p /= radius * DIST;\n  float pj = round(p.y);\n  float pjm2 = mod(pj, 2.0);\n  p.x -= pjm2 * 0.5;\n  float pi = round(p.x);\n  vec2 d1 = p - vec2(pi, pj);\n\n  if (abs(d1.y) * 3. > 1.) {\n    vec2 v2 = step(0.0, d1) - 0.5;\n    v2.y *= 2.0;\n    vec2 d2 = d1 - v2;\n    if (dot(d1, d1) > dot(d2, d2)) {\n      pi += v2.x + pjm2 - 0.5;\n      pj += v2.y;\n    }\n  }\n  return ivec2(pi, pj);\n}\n`;function YC(e,t){let[n,r]=e;return[(n+(1&r)/2)*t*WC,r*t*qC]}const JC=`#version 300 es\n#define SHADER_NAME hexagon-cell-layer-vertex-shader\nin vec3 positions;\nin vec3 normals;\nin vec2 instancePositions;\nin float instanceElevationValues;\nin float instanceColorValues;\nin vec3 instancePickingColors;\nuniform sampler2D colorRange;\nout vec4 vColor;\n${`\nconst vec2 DIST = vec2(${WC}, 1.5);\n\nvec2 hexbinCentroid(vec2 binId, float radius) {\n  binId.x += fract(binId.y * 0.5);\n  return binId * DIST * radius;\n}\n`}\nfloat interp(float value, vec2 domain, vec2 range) {\nfloat r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);\nreturn mix(range.x, range.y, r);\n}\nvec4 interp(float value, vec2 domain, sampler2D range) {\nfloat r = (value - domain.x) / (domain.y - domain.x);\nreturn texture(range, vec2(r, 0.5));\n}\nvoid main(void) {\ngeometry.pickingColor = instancePickingColors;\nif (isnan(instanceColorValues) ||\ninstanceColorValues < hexagon.colorDomain.z ||\ninstanceColorValues > hexagon.colorDomain.w ||\ninstanceElevationValues < hexagon.elevationDomain.z ||\ninstanceElevationValues > hexagon.elevationDomain.w\n) {\ngl_Position = vec4(0.);\nreturn;\n}\nvec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);\ncommonPosition += positions.xy * column.radius * column.coverage;\ngeometry.position = vec4(commonPosition, 0.0, 1.0);\ngeometry.normal = project_normal(normals);\nfloat elevation = 0.0;\nif (column.extruded) {\nelevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);\nelevation = project_size(elevation);\ngeometry.position.z = (positions.z + 1.0) / 2.0 * elevation;\n}\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);\nvColor.a *= layer.opacity;\nif (column.extruded) {\nvColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n`,QC={name:"hexagon",vs:"uniform hexagonUniforms {\n  vec4 colorDomain;\n  vec4 elevationDomain;\n  vec2 elevationRange;\n  vec2 originCommon;\n} hexagon;\n",uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class eP extends HC{getShaders(){const e=super.getShaders();return e.modules.push(QC),{...e,vs:JC}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e,r=this.state.fillModel;if(n.colorRange!==t.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"linear";const r=TA(t,!1,Uint8Array);return e.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:AA[n],magFilter:AA[n],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:r,width:r.length/4,height:1})}(this.context.device,t.colorRange,t.colorScaleType);const e={colorRange:this.state.colorTexture};r.shaderInputs.setProps({hexagon:e})}else n.colorScaleType!==t.colorScaleType&&(i=this.state.colorTexture,o=t.colorScaleType,i.setSampler({minFilter:AA[o],magFilter:AA[o]}));var i,o}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw(e){let{uniforms:t}=e;const{radius:n,hexOriginCommon:r,elevationRange:i,elevationScale:o,extruded:s,coverage:a,colorDomain:l,elevationDomain:c}=this.props,u=this.props.colorCutoff||[-1/0,1/0],h=this.props.elevationCutoff||[-1/0,1/0],d=this.state.fillModel;d.vertexArray.indexBuffer&&d.setIndexBuffer(null),d.setVertexCount(this.state.fillVertexCount);const f={colorDomain:[Math.max(l[0],u[0]),Math.min(l[1],u[1]),Math.max(l[0]-1,u[0]),Math.min(l[1]+1,u[1])],elevationDomain:[Math.max(c[0],h[0]),Math.min(c[1],h[1]),Math.max(c[0]-1,h[0]),Math.min(c[1]+1,h[1])],elevationRange:[i[0]*o,i[1]*o],originCommon:r};d.shaderInputs.setProps({column:{extruded:s,coverage:a,radius:n},hexagon:f}),d.draw(this.context.renderPass)}}eP.layerName="HexagonCellLayer";const tP=eP,nP={name:"binOptions",vs:"uniform binOptionsUniforms {\n  vec2 hexOriginCommon;\n  float radiusCommon;\n} binOptions;\n",uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function rP(){}const iP={gpuAggregation:!0,colorDomain:null,colorRange:EA,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:rP,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:rP,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class oP extends nC{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:t,getColorValue:n,getElevationValue:r}=this.props;return e&&(t||n||r)?(Ju.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&XA.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if("cpu"===e){const{hexagonAggregator:e,radius:t}=this.props;return new eC({dimensions:2,getBin:{sources:["positions"],getValue:(n,r,i)=>{let{positions:o}=n;if(e)return e(o,t);const s=this.state.aggregatorViewport.projectPosition(o),{radiusCommon:a,hexOriginCommon:l}=i;return ZC([s[0]-l[0],s[1]-l[1]],a)}},getValue:[{sources:["colorWeights"],getValue:e=>{let{colorWeights:t}=e;return t}},{sources:["elevationWeights"],getValue:e=>{let{elevationWeights:t}=e;return t}}]})}return new XA(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[zT,nP],vs:`\n  in vec3 positions;\n  in vec3 positions64Low;\n  in float colorWeights;\n  in float elevationWeights;\n  \n  ${KC}\n\n  void getBin(out ivec2 binId) {\n    vec3 positionCommon = project_position(positions, positions64Low);\n    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);\n  }\n  void getValue(out vec2 value) {\n    value = vec2(colorWeights, elevationWeights);\n  }\n  `})})}initializeState(){super.initializeState();this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:n,oldProps:r,changeFlags:i}=e,{aggregator:o}=this.state;if(!i.dataChanged&&this.state.dataAsArray||!n.getColorValue&&!n.getElevationValue||(this.state.dataAsArray=Array.from(_b(n.data).iterable)),t||i.dataChanged||n.radius!==r.radius||n.getColorValue!==r.getColorValue||n.getElevationValue!==r.getElevationValue||n.colorAggregation!==r.colorAggregation||n.elevationAggregation!==r.elevationAggregation){this._updateBinOptions();const{radiusCommon:e,hexOriginCommon:t,binIdRange:r,dataAsArray:i}=this.state;if(o.setProps({binIdRange:r,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:e,hexOriginCommon:t},onUpdate:this._onAggregationUpdate.bind(this)}),i){const{getColorValue:e,getElevationValue:t}=this.props;o.setProps({customOperations:[e&&(t=>e(t.map(e=>i[e]),{indices:t,data:n.data})),t&&(e=>t(e.map(e=>i[e]),{indices:e,data:n.data}))]})}}return i.updateTriggersChanged&&i.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),i.updateTriggersChanged&&i.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds();let t=1,n=[0,0],r=[[0,1],[0,1]],i=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let o=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:s}=this.props,{unitsPerMeter:a}=i.getDistanceScales(o);t=a[0]*s;const l=ZC(i.projectFlat(o),t);o=i.unprojectFlat(YC(l,t));const c=i.constructor;i=i.isGeospatial?new c({longitude:o[0],latitude:o[1],zoom:12}):new km({position:[o[0],o[1],0],zoom:12}),n=[Math.fround(i.center[0]),Math.fround(i.center[1])],r=function(e){let{dataBounds:t,getBinId:n,padding:r=0}=e;const i=[t[0],t[1],[t[0][0],t[1][1]],[t[1][0],t[0][1]]].map(e=>n(e)),o=Math.min(...i.map(e=>e[0]))-r,s=Math.min(...i.map(e=>e[1]))-r,a=Math.max(...i.map(e=>e[0]))+r+1,l=Math.max(...i.map(e=>e[1]))+r+1;return[[o,a],[s,l]]}({dataBounds:e,getBinId:e=>{const r=i.projectFlat(e);return r[0]-=n[0],r[1]-=n[1],ZC(r,t)},padding:1})}this.setState({radiusCommon:t,hexOriginCommon:n,binIdRange:r,aggregatorViewport:i})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(e){let{channel:t}=e;const n=this.getCurrentLayer().props,{aggregator:r}=this.state;if(0===t){const e=r.getResult(0);this.setState({colors:new rC(e,r.binCount)}),n.onSetColorDomain(r.getResultDomain(0))}else if(1===t){const e=r.getResult(1);this.setState({elevations:new rC(e,r.binCount)}),n.onSetElevationDomain(r.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:e,hexOriginCommon:n,binIdRange:r}=this.state;t.setProps({binIdRange:r,binOptions:{radiusCommon:e,hexOriginCommon:n}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1)}}renderLayers(){const{aggregator:e,radiusCommon:t,hexOriginCommon:n}=this.state,{elevationScale:r,colorRange:i,elevationRange:o,extruded:s,coverage:a,material:l,transitions:c,colorScaleType:u,lowerPercentile:h,upperPercentile:d,colorDomain:f,elevationScaleType:p,elevationLowerPercentile:m,elevationUpperPercentile:g,elevationDomain:_}=this.props,y=this.getSubLayerClass("cells",tP),v=e.getBins(),x=this.state.colors?.update({scaleType:u,lowerPercentile:h,upperPercentile:d}),b=this.state.elevations?.update({scaleType:p,lowerPercentile:m,upperPercentile:g});return x&&b?new y(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:v,getColorValue:x.attribute,getElevationValue:b.attribute}},dataComparator:(e,t)=>e.length===t.length,updateTriggers:{getBin:[v],getColorValue:[x.attribute],getElevationValue:[b.attribute]},diskResolution:6,vertices:XC,radius:t,hexOriginCommon:n,elevationScale:r,colorRange:i,colorScaleType:u,elevationRange:o,extruded:s,coverage:a,material:l,colorDomain:x.domain||f||e.getResultDomain(0),elevationDomain:b.domain||_||e.getResultDomain(1),colorCutoff:x.cutoff,elevationCutoff:b.cutoff,transitions:c&&{getFillColor:c.getColorValue||c.getColorWeight,getElevation:c.getElevationValue||c.getElevationWeight},extensions:[]}):null}getPickingInfo(e){const t=e.info,{index:n}=t;if(n>=0){const e=this.state.aggregator.getBin(n);let r;if(e){const t=YC(e.id,this.state.radiusCommon),n=this.context.viewport.unprojectFlat(t);r={col:e.id[0],row:e.id[1],position:n,colorValue:e.value[0],elevationValue:e.value[1],count:e.count},e.pointIndices&&(r.pointIndices=e.pointIndices,r.points=Array.isArray(this.props.data)?e.pointIndices.map(e=>this.props.data[e]):[])}t.object=r}return t}}oP.layerName="HexagonLayer",oP.defaultProps=iP;const sP=oP;function aP(e){let{data:t,getIndex:n,dataRange:r,replace:i}=e;const{startRow:o=0,endRow:s=1/0}=r,a=t.length;let l=a,c=a;for(let d=0;d<a;d++){const e=n(t[d]);if(l>d&&e>=o&&(l=d),e>=s){c=d;break}}let u=l;const h=c-l!==i.length?t.slice(c):void 0;for(let d=0;d<i.length;d++)t[u++]=i[d];if(h){for(let e=0;e<h.length;e++)t[u++]=h[e];t.length=u}return{startRow:l,endRow:l+i.length}}const lP="uniform sdfUniforms {\n  float gamma;\n  bool enabled;\n  float buffer;\n  float outlineBuffer;\n  vec4 outlineColor;\n} sdf;\n",cP={name:"sdf",vs:lP,fs:lP,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},uP=.75,hP=[];class dP extends eA{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,cP],fs:"#version 300 es\n#define SHADER_NAME multi-icon-layer-fragment-shader\nprecision highp float;\nuniform sampler2D iconsTexture;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nif (!bool(picking.isActive)) {\nfloat alpha = texture(iconsTexture, vTextureCoords).a;\nvec4 color = vColor;\nif (sdf.enabled) {\nfloat distance = alpha;\nalpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);\nif (sdf.outlineBuffer > 0.0) {\nfloat inFill = alpha;\nfloat inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);\ncolor = mix(sdf.outlineColor, vColor, inFill);\nalpha = inBorder;\n}\n}\nfloat a = alpha * color.a;\nif (a < icon.alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color.rgb, a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){super.initializeState();this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,t)=>{let{index:n,target:r}=t;return this.encodePickingColor(n,r)}}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:r}=t;r!==n.outlineColor&&(r=r.map(e=>e/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!t.sdf&&t.outlineWidth&&Ju.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:n,outlineWidth:r}=this.props,{outlineColor:i}=this.state,o=r?Math.max(n,uP*(1-r)):-1,s=this.state.model,a={buffer:uP,outlineBuffer:o,gamma:n,enabled:Boolean(t),outlineColor:i};if(s.shaderInputs.setProps({sdf:a}),super.draw(e),t&&r){const{iconManager:e}=this.state;e.getTexture()&&(s.shaderInputs.setProps({sdf:{...a,outlineBuffer:uP}}),s.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(e=>super.getInstanceOffset(e)):hP}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(e=>super.getInstanceIconFrame(e)):hP}}dP.defaultProps={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},dP.layerName="MultiIconLayer";const fP=dP,pP=1e20;class mP{constructor(){let{fontSize:e=24,buffer:t=3,radius:n=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:s="normal",lang:a=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=r,this.radius=n,this.lang=a;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${o} ${e}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),f={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return f;const{ctx:p,buffer:m,gridInner:g,gridOuter:_}=this;this.lang&&(p.lang=this.lang),p.clearRect(m,m,a,l),p.fillText(e,m,m+s);const y=p.getImageData(m,m,a,l);_.fill(pP,0,h),g.fill(0,0,h);for(let v=0;v<l;v++)for(let e=0;e<a;e++){const t=y.data[4*(v*a+e)+3]/255;if(0===t)continue;const n=(v+m)*c+e+m;if(1===t)_[n]=0,g[n]=pP;else{const e=.5-t;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}gP(_,0,0,c,u,c,this.f,this.v,this.z),gP(g,m,m,a,l,c,this.f,this.v,this.z);for(let v=0;v<h;v++){const e=Math.sqrt(_[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return f}}function gP(e,t,n,r,i,o,s,a,l){for(let c=t;c<t+r;c++)_P(e,n*o+c,o,i,s,a,l);for(let c=n;c<n+i;c++)_P(e,c*o+t,1,r,s,a,l)}function _P(e,t,n,r,i,o,s){o[0]=0,s[0]=-pP,s[1]=pP,i[0]=e[t];for(let a=1,l=0,c=0;a<r;a++){i[a]=e[t+a*n];const r=a*a;do{const e=o[l];c=(i[a]-i[e]+r-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=pP}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;e[t+a*n]=i[r]+c*c}}const yP=[];function vP(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function xP(e,t,n,r){let i=0;for(let o=t;o<n;o++){const t=e[o];i+=r[t]?.layoutWidth||0}return i}function bP(e,t,n,r,i,o){let s=t,a=0;for(let l=t;l<n;l++){const t=xP(e,l,l+1,i);a+t>r&&(s<l&&o.push(l),s=l,a=0),a+=t}return a}function wP(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;void 0===o&&(o=e.length);const s=[];return"break-all"===t?bP(e,i,o,n,r,s):function(e,t,n,r,i,o){let s=t,a=t,l=t,c=0;for(let u=t;u<n;u++)if(" "===e[u]?l=u+1:" "!==e[u+1]&&u+1!==n||(l=u+1),l>a){let t=xP(e,a,l,i);c+t>r&&(s<a&&(o.push(a),s=a,c=0),t>r&&(t=bP(e,a,l,r,i,o),s=o[o.length-1])),a=l,c+=t}}(e,i,o,n,r,s),s}function SP(e,t,n,r,i,o){let s=0,a=0;for(let l=t;l<n;l++){const t=e[l],n=r[t];n?(a||(a=n.layoutHeight),i[l]=s+n.layoutWidth/2,s+=n.layoutWidth):(Ju.warn(`Missing character: ${t} (${t.codePointAt(0)})`)(),i[l]=s,s+=32)}o[0]=s,o[1]=a}class EP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}const TP={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1};let AP=new EP(3);function CP(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function PP(e,t,n,r){e.font=`${r} ${n}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}class IP{constructor(){this.props={...TP}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(1.2*e+2*t)/e}setProps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this.props,e),this._key=this._getKey();const t=function(e,t){let n;n="string"===typeof t?new Set(Array.from(t)):new Set(t);const r=AP.get(e);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}(this._key,this.props.characterSet),n=AP.get(this._key);if(n&&0===t.size)return void(this._atlas!==n&&(this._atlas=n));const r=this._generateFontAtlas(t,n);this._atlas=r,AP.set(this._key,r)}_generateFontAtlas(e,t){const{fontFamily:n,fontWeight:r,fontSize:i,buffer:o,sdf:s,radius:a,cutoff:l}=this.props;let c=t&&t.data;c||(c=document.createElement("canvas"),c.width=1024);const u=c.getContext("2d",{willReadFrequently:!0});PP(u,n,i,r);const{mapping:h,canvasHeight:d,xOffset:f,yOffset:p}=function(e){let{characterSet:t,getFontWidth:n,fontHeight:r,buffer:i,maxCanvasWidth:o,mapping:s={},xOffset:a=0,yOffset:l=0}=e,c=0,u=a;const h=r+2*i;for(const d of t)if(!s[d]){const e=n(d);u+e+2*i>o&&(u=0,c++),s[d]={x:u+i,y:l+c*h+i,width:e,height:h,layoutWidth:e,layoutHeight:r},u+=e+2*i}return{mapping:s,xOffset:u,yOffset:l+c*h,canvasHeight:vP(l+(c+1)*h)}}({getFontWidth:e=>u.measureText(e).width,fontHeight:1.2*i,buffer:o,characterSet:e,maxCanvasWidth:1024,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(c.height!==d){const e=u.getImageData(0,0,c.width,c.height);c.height=d,u.putImageData(e,0,0)}if(PP(u,n,i,r),s){const t=new mP({fontSize:i,buffer:o,radius:a,cutoff:l,fontFamily:n,fontWeight:`${r}`});for(const n of e){const{data:e,width:r,height:o,glyphTop:s}=t.draw(n);h[n].width=r,h[n].layoutOffsetY=.9*i-s;const a=u.createImageData(r,o);CP(e,a),u.putImageData(a,h[n].x,h[n].y)}}else for(const m of e)u.fillText(m,h[m].x,h[m].y+o+.9*i);return{xOffset:f,yOffset:p,mapping:h,data:c,width:c.width,height:c.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:r,sdf:i,radius:o,cutoff:s}=this.props;return i?`${e} ${t} ${n} ${r} ${o} ${s}`:`${e} ${t} ${n} ${r}`}}const kP="uniform textBackgroundUniforms {\n  bool billboard;\n  float sizeScale;\n  float sizeMinPixels;\n  float sizeMaxPixels;\n  vec4 borderRadius;\n  vec4 padding;\n  highp int sizeUnits;\n  bool stroked;\n} textBackground;\n",MP={name:"textBackground",vs:kP,fs:kP,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},RP={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class OP extends CT{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME text-background-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceRects;\nin float instanceSizes;\nin float instanceAngles;\nin vec2 instancePixelOffsets;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout float vLineWidth;\nout vec2 uv;\nout vec2 dimensions;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = radians(angle);\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvLineWidth = instanceLineWidths;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),\ntextBackground.sizeMinPixels, textBackground.sizeMaxPixels\n);\ndimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;\nvec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\npixelOffset += instancePixelOffsets;\npixelOffset.y *= -1.0;\nif (textBackground.billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME text-background-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin float vLineWidth;\nin vec2 uv;\nin vec2 dimensions;\nout vec4 fragColor;\nfloat round_rect(vec2 p, vec2 size, vec4 radii) {\nvec2 pixelPositionCB = (p - 0.5) * size;\nvec2 sizeCB = size * 0.5;\nfloat maxBorderRadius = min(size.x, size.y) * 0.5;\nvec4 borderRadius = vec4(min(radii, maxBorderRadius));\nborderRadius.xy =\n(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;\nborderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;\nvec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;\nreturn -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);\n}\nfloat rect(vec2 p, vec2 size) {\nvec2 pixelPosition = p * size;\nreturn min(min(pixelPosition.x, size.x - pixelPosition.x),\nmin(pixelPosition.y, size.y - pixelPosition.y));\n}\nvec4 get_stroked_fragColor(float dist) {\nfloat isBorder = smoothedge(dist, vLineWidth);\nreturn mix(vFillColor, vLineColor, isBorder);\n}\nvoid main(void) {\ngeometry.uv = uv;\nif (textBackground.borderRadius != vec4(0.0)) {\nfloat distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);\nif (textBackground.stroked) {\nfragColor = get_stroked_fragColor(distToEdge);\n} else {\nfragColor = vFillColor;\n}\nfloat shapeAlpha = smoothedge(-distToEdge, 0.0);\nfragColor.a *= shapeAlpha;\n} else {\nif (textBackground.stroked) {\nfloat distToEdge = rect(uv, dimensions);\nfragColor = get_stroked_fragColor(distToEdge);\n} else {\nfragColor = vFillColor;\n}\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[zT,BT,MP]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw(e){let{uniforms:t}=e;const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:o,sizeMaxPixels:s,getLineWidth:a}=this.props;let{padding:l,borderRadius:c}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),Array.isArray(c)||(c=[c,c,c,c]);const u=this.state.model,h={billboard:n,stroked:Boolean(a),borderRadius:c,padding:l,sizeUnits:wm[i],sizeScale:r,sizeMinPixels:o,sizeMaxPixels:s};u.shaderInputs.setProps({textBackground:h}),u.draw(this.context.renderPass)}_getModel(){return new pE(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jT({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,0,1,1,1])}}}),isInstanced:!0})}}OP.defaultProps=RP,OP.layerName="TextBackgroundLayer";const LP=OP,DP={start:1,middle:0,end:-1},NP={top:1,center:0,bottom:-1},zP=[0,0,0,255],FP={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:zP},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:TP.characterSet},fontFamily:TP.fontFamily,fontWeight:TP.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:zP},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:zP},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class BP extends xA{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[n,r]}=this.transformParagraph(e,t);const{fontSize:i}=this.state.fontAtlasManager.props;n/=i,r/=i;const{getTextAnchor:o,getAlignmentBaseline:s}=this.props;return[(DP["function"===typeof o?o(e,t):o]-1)*n/2,(NP["function"===typeof s?s(e,t):s]-1)*r/2,n,r]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:n,getAlignmentBaseline:r}=this.props,{x:i,y:o,rowWidth:s,size:[a,l]}=this.transformParagraph(e,t),c=DP["function"===typeof n?n(e,t):n],u=NP["function"===typeof r?r(e,t):r],h=i.length,d=new Array(2*h);let f=0;for(let p=0;p<h;p++){const e=(1-c)*(a-s[p])/2;d[f++]=(c-1)*a/2+e+i[p],d[f++]=(u-1)*l/2+o[p]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new IP},this.props.maxWidth>0&&Ju.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:n,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText();(this._updateFontAtlas()||t.lineHeight!==n.lineHeight||t.wordBreak!==n.wordBreak||t.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo(e){let{info:t}=e;return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:n}=this.props,{fontAtlasManager:r,characterSet:i}=this.state,o={...e,characterSet:i,fontFamily:t,fontWeight:n};if(!r.mapping)return r.setProps(o),!0;for(const s in o)if(o[s]!==r.props[s])return r.setProps(o),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,n=e.attributes?.getText;let r,{getText:i}=this.props,o=e.startIndices;const s="auto"===t&&new Set;if(n&&o){const{texts:t,characterCount:a}=function(e){let{value:t,length:n,stride:r,offset:i,startIndices:o,characterSet:s}=e;const a=t.BYTES_PER_ELEMENT,l=r?r/a:1,c=i?i/a:0,u=o[n]||Math.ceil((t.length-c)/l),h=s&&new Set,d=new Array(n);let f=t;if(l>1||c>0){f=new(0,t.constructor)(u);for(let e=0;e<u;e++)f[e]=t[e*l+c]}for(let p=0;p<n;p++){const e=o[p],t=o[p+1]||u,n=f.subarray(e,t);d[p]=String.fromCodePoint.apply(null,n),h&&n.forEach(h.add,h)}if(h)for(const p of h)s.add(String.fromCodePoint(p));return{texts:d,characterCount:u}}({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:s});r=a,i=(e,n)=>{let{index:r}=n;return t[r]}}else{const{iterable:t,objectInfo:n}=_b(e);o=[0],r=0;for(const e of t){n.index++;const t=Array.from(i(e,n)||"");s&&t.forEach(s.add,s),r+=t.length,o.push(r)}}this.setState({getText:i,startIndices:o,numInstances:r,characterSet:s||t})}transformParagraph(e,t){const{fontAtlasManager:n}=this.state,r=n.mapping,i=this.state.getText,{wordBreak:o,lineHeight:s,maxWidth:a}=this.props;return function(e,t,n,r,i){const o=Array.from(e),s=o.length,a=new Array(s),l=new Array(s),c=new Array(s),u=("break-word"===n||"break-all"===n)&&isFinite(r)&&r>0,h=[0,0],d=[0,0];let f=0,p=0,m=0;for(let g=0;g<=s;g++){const e=o[g];if("\n"!==e&&g!==s||(m=g),m>p){const e=u?wP(o,n,r,i,p,m):yP;for(let n=0;n<=e.length;n++){const r=0===n?p:e[n-1],s=n<e.length?e[n]:m;SP(o,r,s,i,a,d);for(let e=r;e<s;e++){a[e];const t=o[e],n=i[t]?.layoutOffsetY||0;l[e]=f+d[1]/2+n,c[e]=d[0]}f+=d[1]*t,h[0]=Math.max(h[0],d[0])}p=m}"\n"===e&&(a[p]=0,l[p]=0,c[p]=0,p++)}return h[1]=f,{x:a,y:l,rowWidth:c,size:h}}(i(e,t)||"",s,o,a*n.props.fontSize,r)}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:r,atlas:i,mapping:o},styleVersion:s}=this.state,{data:a,_dataDiff:l,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,getBackgroundColor:p,getBorderColor:m,getBorderWidth:g,backgroundBorderRadius:_,backgroundPadding:y,background:v,billboard:x,fontSettings:b,outlineWidth:w,outlineColor:S,sizeScale:E,sizeUnits:T,sizeMinPixels:A,sizeMaxPixels:C,transitions:P,updateTriggers:I}=this.props,k=this.getSubLayerClass("characters",fP),M=this.getSubLayerClass("background",LP);return[v&&new M({getFillColor:p,getLineColor:m,getLineWidth:g,borderRadius:_,padding:y,getPosition:c,getSize:h,getAngle:d,getPixelOffset:f,billboard:x,sizeScale:E,sizeUnits:T,sizeMinPixels:A,sizeMaxPixels:C,transitions:P&&{getPosition:P.getPosition,getAngle:P.getAngle,getSize:P.getSize,getFillColor:P.getBackgroundColor,getLineColor:P.getBorderColor,getLineWidth:P.getBorderWidth,getPixelOffset:P.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:I.getPosition,getAngle:I.getAngle,getSize:I.getSize,getFillColor:I.getBackgroundColor,getLineColor:I.getBorderColor,getLineWidth:I.getBorderWidth,getPixelOffset:I.getPixelOffset,getBoundingRect:{getText:I.getText,getTextAnchor:I.getTextAnchor,getAlignmentBaseline:I.getAlignmentBaseline,styleVersion:s}}}),{data:a.attributes&&a.attributes.background?{length:a.length,attributes:a.attributes.background}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new k({sdf:b.sdf,smoothing:Number.isFinite(b.smoothing)?b.smoothing:TP.smoothing,outlineWidth:w/(b.radius||TP.radius),outlineColor:S,iconAtlas:i,iconMapping:o,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,billboard:x,sizeScale:E*r,sizeUnits:T,sizeMinPixels:A*r,sizeMaxPixels:C*r,transitions:P&&{getPosition:P.getPosition,getAngle:P.getAngle,getColor:P.getColor,getSize:P.getSize,getPixelOffset:P.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:I.getText,getPosition:I.getPosition,getAngle:I.getAngle,getColor:I.getColor,getSize:I.getSize,getPixelOffset:I.getPixelOffset,getIconOffsets:{getTextAnchor:I.getTextAnchor,getAlignmentBaseline:I.getAlignmentBaseline,styleVersion:s}}}),{data:a,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){!function(e){Ju.assert(Number.isFinite(e)&&e>=3,"Invalid cache limit"),AP=new EP(e)}(e)}}BP.defaultProps=FP,BP.layerName="TextLayer";const jP=BP;class UP{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Bd,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:r,geometryBuffer:i,positionFormat:o,dataChanged:s,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=r,this.positionSize=i&&i.size||("XY"===o?2:3),this.buffers=n,this.normalize=a,i&&(qm(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(i),a||(n.vertexPositions=i)),this.geometryBuffer=n.vertexPositions,Array.isArray(s))for(const l of s)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry(e){let{startRow:t,endRow:n}=e;this._rebuildGeometry({startRow:t,endRow:n})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?vb(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:n,buffers:r,_attributeDefs:i,typedArrayManager:o}=this;for(const s in i)if(s in r)o.release(n[s]),n[s]=null;else{const r=i[s];r.copy=t,n[s]=o.allocate(n[s],e,r)}}_forEachGeometry(e,t,n){const{data:r,getGeometry:i}=this,{iterable:o,objectInfo:s}=_b(r,t,n);for(const a of o){s.index++;e(i?i(a,s):null,s.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:n,instanceCount:r}=this;const{data:i,geometryBuffer:o}=this,{startRow:s=0,endRow:a=1/0}=e||{},l={};if(e||(t=[0],n=[0]),this.normalize||!o)this._forEachGeometry((e,t)=>{const r=e&&this.normalizeGeometry(e);l[t]=r,n[t+1]=n[t]+(r?this.getGeometrySize(r):0)},s,a),r=n[n.length-1];else if(n=i.startIndices,r=n[i.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof Z_){const e=4*this.positionSize;r=r||o.byteLength/e}else if(o.buffer){const e=o.stride||4*this.positionSize;r=r||o.buffer.byteLength/e}else if(o.value){const e=o.value,t=o.stride/e.BYTES_PER_ELEMENT||this.positionSize;r=r||e.length/t}this._allocate(r,Boolean(e)),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=r;const c={};this._forEachGeometry((e,i)=>{const o=l[i]||e;c.vertexStart=n[i],c.indexStart=t[i];const s=i<n.length-1?n[i+1]:r;c.geometrySize=s-n[i],c.geometryIndex=i,this.updateGeometryAttributes(o,c)},s,a),this.vertexCount=t[t.length-1]}}function VP(e,t,n,r){let i;if(Array.isArray(e[0])){const n=e.length*t;i=new Array(n);for(let r=0;r<e.length;r++)for(let n=0;n<t;n++)i[r*t+n]=e[r][n]||0}else i=e;return n?CC(i,{size:t,gridResolution:n}):r?function(e,t){const{size:n=2,startIndex:r=0,endIndex:i=e.length,normalize:o=!0}=t||{},s=e.slice(r,i);NC(s,n,0,i-r);const a=CC(s,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const l of a)zC(l,n);return a}(i,{size:t}):i}class GP extends UP{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?VP(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(HP(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&HP(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const n=this.attributes.segmentTypes,r=!!e&&this.isClosed(e),{vertexStart:i,geometrySize:o}=t;n.fill(0,i,i+o),r?(n[i]=4,n[i+o-2]=4):(n[i]+=1,n[i+o-2]+=2),n[i+o-1]=4}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:r,geometrySize:i}=t,o=new Array(3);for(let s=r,a=0;a<i;s++,a++)this.getPointOnPath(e,a,o),n[3*s]=o[0],n[3*s+1]=o[1],n[3*s+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const{positionSize:r}=this;t*r>=e.length&&(t+=1-e.length/r);const i=t*r;return n[0]=e[i],n[1]=e[i+1],n[2]=3===r&&e[i+2]||0,n}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}function HP(e){return Array.isArray(e[0])}const $P="uniform pathUniforms {\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  float jointType;\n  float capType;\n  float miterLimit;\n  bool billboard;\n  highp int widthUnits;\n} path;\n",WP={name:"path",vs:$P,fs:$P,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},qP=[0,0,0,255],XP={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:qP},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ZP={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class KP extends CT{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME path-layer-vertex-shader\nin vec2 positions;\nin float instanceTypes;\nin vec3 instanceStartPositions;\nin vec3 instanceEndPositions;\nin vec3 instanceLeftPositions;\nin vec3 instanceRightPositions;\nin vec3 instanceLeftPositions64Low;\nin vec3 instanceStartPositions64Low;\nin vec3 instanceEndPositions64Low;\nin vec3 instanceRightPositions64Low;\nin float instanceStrokeWidths;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nuniform float opacity;\nout vec4 vColor;\nout vec2 vCornerOffset;\nout float vMiterLength;\nout vec2 vPathPosition;\nout float vPathLength;\nout float vJointType;\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\nfloat flipIfTrue(bool flag) {\nreturn -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\nvec3 prevPoint, vec3 currPoint, vec3 nextPoint,\nvec2 width\n) {\nbool isEnd = positions.x > 0.0;\nfloat sideOfPath = positions.y;\nfloat isJoint = float(sideOfPath == 0.0);\nvec3 deltaA3 = (currPoint - prevPoint);\nvec3 deltaB3 = (nextPoint - currPoint);\nmat3 rotationMatrix;\nbool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);\nif (needsRotation) {\ndeltaA3 = deltaA3 * rotationMatrix;\ndeltaB3 = deltaB3 * rotationMatrix;\n}\nvec2 deltaA = deltaA3.xy / width;\nvec2 deltaB = deltaB3.xy / width;\nfloat lenA = length(deltaA);\nfloat lenB = length(deltaB);\nvec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\nvec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\nvec2 perpA = vec2(-dirA.y, dirA.x);\nvec2 perpB = vec2(-dirB.y, dirB.x);\nvec2 tangent = dirA + dirB;\ntangent = length(tangent) > 0. ? normalize(tangent) : perpA;\nvec2 miterVec = vec2(-tangent.y, tangent.x);\nvec2 dir = isEnd ? dirA : dirB;\nvec2 perp = isEnd ? perpA : perpB;\nfloat L = isEnd ? lenA : lenB;\nfloat sinHalfA = abs(dot(miterVec, perp));\nfloat cosHalfA = abs(dot(dirA, miterVec));\nfloat turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\nfloat cornerPosition = sideOfPath * turnDirection;\nfloat miterSize = 1.0 / max(sinHalfA, EPSILON);\nmiterSize = mix(\nmin(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\nmiterSize,\nstep(0.0, cornerPosition)\n);\nvec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n* (sideOfPath + isJoint * turnDirection);\nbool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\nbool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\nbool isCap = isStartCap || isEndCap;\nif (isCap) {\noffsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);\nvJointType = path.capType;\n} else {\nvJointType = path.jointType;\n}\nvPathLength = L;\nvCornerOffset = offsetVec;\nvMiterLength = dot(vCornerOffset, miterVec * turnDirection);\nvMiterLength = isCap ? isJoint : vMiterLength;\nvec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\nvPathPosition = vec2(\ndot(offsetFromStartOfPath, perp),\ndot(offsetFromStartOfPath, dir)\n);\ngeometry.uv = vPathPosition;\nfloat isValid = step(instanceTypes, 3.5);\nvec3 offset = vec3(offsetVec * width * isValid, 0.0);\nif (needsRotation) {\noffset = rotationMatrix * offset;\n}\nreturn offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\nif (position.w < EPSILON) {\nfloat r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\nposition = refPosition + (position - refPosition) * r;\n}\n}\nvoid main() {\ngeometry.pickingColor = instancePickingColors;\nvColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);\nfloat isEnd = positions.x;\nvec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\nvec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\nvec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\nvec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\nvec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\nvec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\ngeometry.worldPosition = currPosition;\nvec2 widthPixels = vec2(clamp(\nproject_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),\npath.widthMinPixels, path.widthMaxPixels) / 2.0);\nvec3 width;\nif (path.billboard) {\nvec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\nvec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\nvec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\nclipLine(prevPositionScreen, currPositionScreen);\nclipLine(nextPositionScreen, currPositionScreen);\nclipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\nwidth = vec3(widthPixels, 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(\nprevPositionScreen.xyz / prevPositionScreen.w,\ncurrPositionScreen.xyz / currPositionScreen.w,\nnextPositionScreen.xyz / nextPositionScreen.w,\nproject_pixel_size_to_clipspace(width.xy)\n);\nDECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\ngl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n} else {\nprevPosition = project_position(prevPosition, prevPosition64Low);\ncurrPosition = project_position(currPosition, currPosition64Low);\nnextPosition = project_position(nextPosition, nextPosition64Low);\nwidth = vec3(project_pixel_size(widthPixels), 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\ngeometry.position = vec4(currPosition + offset, 1.0);\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME path-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 vCornerOffset;\nin float vMiterLength;\nin vec2 vPathPosition;\nin float vPathLength;\nin float vJointType;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vPathPosition;\nif (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\nif (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\ndiscard;\n}\nif (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {\ndiscard;\n}\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[zT,BT,WP]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const e=!0;this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:ZP,accessor:"getPath",update:this.calculatePositions,noAlloc:e,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:e},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ZP,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:ZP,defaultValue:qP},instancePickingColors:{size:4,type:"uint8",accessor:(e,t)=>{let{index:n,target:r}=t;return this.encodePickingColor(e&&e.__source?e.__source.index:n,r)}}}),this.setState({pathTesselator:new GP({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:n}=e,r=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,i=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:i.getPath,buffers:i,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),n.dataChanged||r.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,r=this.props.data;return r[0]&&r[0].__source&&(t.object=r.find(e=>e.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw(e){let{uniforms:t}=e;const{jointRounded:n,capRounded:r,billboard:i,miterLimit:o,widthUnits:s,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props,u=this.state.model,h={jointType:Number(n),capType:Number(r),billboard:i,widthUnits:wm[s],widthScale:a,miterLimit:o,widthMinPixels:l,widthMaxPixels:c};u.shaderInputs.setProps({path:h}),u.draw(this.context.renderPass)}_getModel(){return new pE(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jT({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}KP.defaultProps=XP,KP.layerName="PathLayer";const YP=KP;var JP=n(973);const QP=yC,eI=vC,tI={isClosed:!0};function nI(e){return"positions"in e?e.positions:e}function rI(e){return"holeIndices"in e?e.holeIndices:null}function iI(e,t,n,r,i){let o=t;const s=n.length;for(let a=0;a<s;a++)for(let t=0;t<r;t++)e[o++]=n[a][t]||0;if(!function(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(let a=0;a<r;a++)e[o++]=n[0][a]||0;return tI.start=t,tI.end=o,tI.size=r,xC(e,i,tI),o}function oI(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;o=o||n.length;const a=o-i;if(a<=0)return t;let l=t;for(let c=0;c<a;c++)e[l++]=n[i+c];if(!function(e,t,n,r){for(let i=0;i<t;i++)if(e[n+i]!==e[r-t+i])return!1;return!0}(n,r,i,o))for(let c=0;c<r;c++)e[l++]=n[i+c];return tI.start=t,tI.end=l,tI.size=r,xC(e,s,tI),l}function sI(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const n=[],r=[];if("positions"in e){const{positions:i,holeIndices:o}=e;if(o){let e=0;for(let s=0;s<=o.length;s++)e=oI(n,e,i,t,o[s-1],o[s],0===s?QP:eI),r.push(e);return r.pop(),{positions:n,holeIndices:r}}e=i}if(!function(e){return Array.isArray(e[0])}(e))return oI(n,0,e,t,0,n.length,QP),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let i=0;for(const[o,s]of e.entries())i=iI(n,i,s,t,0===o?QP:eI),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return iI(n,0,e,t,QP),n}function aI(e,t,n){const r=e.length/3;let i=0;for(let o=0;o<r;o++){const s=(o+1)%r;i+=e[3*o+t]*e[3*s+n],i-=e[3*s+t]*e[3*o+n]}return Math.abs(i/2)}function lI(e,t,n,r){const i=e.length/3;for(let o=0;o<i;o++){const i=3*o,s=e[i+0],a=e[i+1],l=e[i+2];e[i+t]=s,e[i+n]=a,e[i+r]=l}}class cI extends UP{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=sI(e,this.positionSize);return this.opts.resolution?PC(nI(t),rI(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;const{size:r=2,normalize:i=!0,edgeTypes:o=!1}=n||{};t=t||[];const s=[],a=[];let l=0,c=0;for(let h=0;h<=t.length;h++){const i=t[h]||e.length,o=c,u=LC(e,r,l,i);for(let t=u;t<i;t++)s[c++]=e[t];for(let t=l;t<u;t++)s[c++]=e[t];NC(s,r,o,c),DC(s,r,o,c,n?.maxLatitude),l=i,a[h]=c}a.pop();const u=PC(s,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(i)for(const h of u)zC(h.positions,r);return u}(nI(t),rI(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(uI(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return nI(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&uI(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const n=e;this._updateIndices(n,t),this._updatePositions(n,t),this._updateVertexValid(n,t)}}_updateIndices(e,t){let{geometryIndex:n,vertexStart:r,indexStart:i}=t;const{attributes:o,indexStarts:s,typedArrayManager:a}=this;let l=o.indices;if(!l||!e)return;let c=i;const u=function(e,t,n,r){let i=rI(e);i&&(i=i.map(e=>e/t));let o=nI(e);const s=r&&3===t;if(n){const e=o.length;o=o.slice();const r=[];for(let i=0;i<e;i+=t){r[0]=o[i],r[1]=o[i+1],s&&(r[2]=o[i+2]);const e=n(r);o[i]=e[0],o[i+1]=e[1],s&&(o[i+2]=e[2])}}if(s){const e=aI(o,0,1),t=aI(o,0,2),r=aI(o,1,2);if(!e&&!t&&!r)return[];e>t&&e>r||(t>r?(n||(o=o.slice()),lI(o,0,2,1)):(n||(o=o.slice()),lI(o,2,0,1)))}return JP(o,i,t)}(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,i+u.length,{copy:!0});for(let h=0;h<u.length;h++)l[c++]=u[h]+r;s[n+1]=i+u.length,o.indices=l}_updatePositions(e,t){let{vertexStart:n,geometrySize:r}=t;const{attributes:{positions:i},positionSize:o}=this;if(!i||!e)return;const s=nI(e);for(let a=n,l=0;l<r;a++,l++){const e=s[l*o],t=s[l*o+1],n=o>2?s[l*o+2]:0;i[3*a]=e,i[3*a+1]=t,i[3*a+2]=n}}_updateVertexValid(e,t){let{vertexStart:n,geometrySize:r}=t;const{positionSize:i}=this,o=this.attributes.vertexValid,s=e&&rI(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,n):o.fill(1,n,n+r),s)for(let a=0;a<s.length;a++)o[n+s[a]/i-1]=0;o[n+r-1]=0}}function uI(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const hI="uniform solidPolygonUniforms {\n  bool extruded;\n  bool isWireframe;\n  float elevationScale;\n} solidPolygon;\n",dI={name:"solidPolygon",vs:hI,fs:hI,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},fI="in vec4 fillColors;\nin vec4 lineColors;\nin vec3 pickingColors;\nout vec4 vColor;\nstruct PolygonProps {\nvec3 positions;\nvec3 positions64Low;\nvec3 normal;\nfloat elevations;\n};\nvec3 project_offset_normal(vec3 vector) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\nreturn normalize(vector * project.commonUnitsPerWorldUnit);\n}\nreturn project_normal(vector);\n}\nvoid calculatePosition(PolygonProps props) {\nvec3 pos = props.positions;\nvec3 pos64Low = props.positions64Low;\nvec3 normal = props.normal;\nvec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;\ngeometry.worldPosition = props.positions;\ngeometry.pickingColor = pickingColors;\nif (solidPolygon.extruded) {\npos.z += props.elevations * solidPolygon.elevationScale;\n}\ngl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (solidPolygon.extruded) {\n#ifdef IS_SIDE_VERTEX\nnormal = project_offset_normal(normal);\n#else\nnormal = project_normal(normal);\n#endif\ngeometry.normal = normal;\nvec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, colors.a * layer.opacity);\n} else {\nvColor = vec4(colors.rgb, colors.a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",pI=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader\nin vec3 vertexPositions;\nin vec3 vertexPositions64Low;\nin float elevations;\n${fI}\nvoid main(void) {\nPolygonProps props;\nprops.positions = vertexPositions;\nprops.positions64Low = vertexPositions64Low;\nprops.elevations = elevations;\nprops.normal = vec3(0.0, 0.0, 1.0);\ncalculatePosition(props);\n}\n`,mI=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\nin vec2 positions;\nin vec3 vertexPositions;\nin vec3 nextVertexPositions;\nin vec3 vertexPositions64Low;\nin vec3 nextVertexPositions64Low;\nin float elevations;\nin float instanceVertexValid;\n${fI}\nvoid main(void) {\nif(instanceVertexValid < 0.5){\ngl_Position = vec4(0.);\nreturn;\n}\nPolygonProps props;\nvec3 pos;\nvec3 pos64Low;\nvec3 nextPos;\nvec3 nextPos64Low;\n#if RING_WINDING_ORDER_CW == 1\npos = vertexPositions;\npos64Low = vertexPositions64Low;\nnextPos = nextVertexPositions;\nnextPos64Low = nextVertexPositions64Low;\n#else\npos = nextVertexPositions;\npos64Low = nextVertexPositions64Low;\nnextPos = vertexPositions;\nnextPos64Low = vertexPositions64Low;\n#endif\nprops.positions = mix(pos, nextPos, positions.x);\nprops.positions64Low = mix(pos64Low, nextPos64Low, positions.x);\nprops.normal = vec3(\npos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),\nnextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),\n0.0);\nprops.elevations = elevations * positions.y;\ncalculatePosition(props);\n}\n`,gI=[0,0,0,255],_I={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:gI},getLineColor:{type:"accessor",value:gI},material:!0},yI={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class vI extends CT{getShaders(e){return super.getShaders({vs:"top"===e?pI:mI,fs:"#version 300 es\n#define SHADER_NAME solid-polygon-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[zT,_C,BT,dI]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:n}=this.props;let r;e.isGeospatial&&t===xm.DEFAULT&&(t=xm.LNGLAT),t===xm.LNGLAT&&(r=n?e.projectPosition.bind(e):e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new cI({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const i=this.getAttributeManager(),o=!0;i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:yI,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:yI,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:yI,accessor:"getFillColor",defaultValue:gI},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:yI,accessor:"getLineColor",defaultValue:gI},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,t)=>{let{index:n,target:r}=t;return this.encodePickingColor(e&&e.__source?e.__source.index:n,r)}}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,r=this.props.data;return r[0]&&r[0].__source&&(t.object=r.find(e=>e.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw(e){let{uniforms:t}=e;const{extruded:n,filled:r,wireframe:i,elevationScale:o}=this.props,{topModel:s,sideModel:a,wireframeModel:l,polygonTesselator:c}=this.state,u={extruded:Boolean(n),elevationScale:o,isWireframe:!1};l&&i&&(l.setInstanceCount(c.instanceCount-1),l.shaderInputs.setProps({solidPolygon:{...u,isWireframe:!0}}),l.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(c.instanceCount-1),a.shaderInputs.setProps({solidPolygon:u}),a.draw(this.context.renderPass)),s&&r&&(s.setVertexCount(c.vertexCount),s.shaderInputs.setProps({solidPolygon:u}),s.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n,changeFlags:r}=e,i=this.getAttributeManager();(r.extensionsChanged||t.filled!==n.filled||t.extruded!==n.extruded)&&(this.state.models?.forEach(e=>e.destroy()),this.setState(this._getModels()),i.invalidateAll())}updateGeometry(e){let{props:t,oldProps:n,changeFlags:r}=e;if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:e}=this.state,n=t.data.attributes||{};e.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:n.getPolygon,buffers:n,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:t._full3d}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:n}=this.props;let r,i,o;if(t){const t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;const n=this.getAttributeManager().getBufferLayouts({isInstanced:!1});r=new pE(this.context.device,{...t,id:`${e}-top`,topology:"triangle-list",bufferLayout:n,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const t=this.getAttributeManager().getBufferLayouts({isInstanced:!0});i=new pE(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:t,geometry:new jT({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new pE(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:t,geometry:new jT({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[i,o,r].filter(Boolean),topModel:r,sideModel:i,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}vI.defaultProps=_I,vI.layerName="SolidPolygonLayer";const xI={circle:{type:sA,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:eA,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:jP,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},bI={type:YP,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},wI={type:vI,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function SI(e){let{type:t,props:n}=e;const r={};for(const i in n)r[i]=t.defaultProps[n[i]];return r}function EI(e,t){const{transitions:n,updateTriggers:r}=e.props,i={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const o in t){const s=t[o];let a=e.props[o];o.startsWith("get")&&(a=e.getSubLayerAccessor(a),i.updateTriggers[s]=r[o],n&&(i.transitions[s]=n[o])),i[s]=a}return i}function TI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:o=e.length}=n;for(let s=i;s<o;s++){const n=e[s],{geometry:i}=n;if(i)if("GeometryCollection"===i.type){Ju.assert(Array.isArray(i.geometries),"GeoJSON does not have geometries array");const{geometries:e}=i;for(let i=0;i<e.length;i++){AI(e[i],r,t,n,s)}}else AI(i,r,t,n,s)}return r}function AI(e,t,n,r,i){const{type:o,coordinates:s}=e,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=t;if(function(e,t){let n=CI[e];Ju.assert(n,`Unknown GeoJSON type ${e}`);for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(o,s))switch(o){case"Point":a.push(n({geometry:e},r,i));break;case"MultiPoint":s.forEach(e=>{a.push(n({geometry:{type:"Point",coordinates:e}},r,i))});break;case"LineString":l.push(n({geometry:e},r,i));break;case"MultiLineString":s.forEach(e=>{l.push(n({geometry:{type:"LineString",coordinates:e}},r,i))});break;case"Polygon":c.push(n({geometry:e},r,i)),s.forEach(e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},r,i))});break;case"MultiPolygon":s.forEach(e=>{c.push(n({geometry:{type:"Polygon",coordinates:e}},r,i)),e.forEach(e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},r,i))})})}else Ju.warn(`${o} coordinates are malformed`)()}const CI={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function PI(e){return e.geometry.coordinates}function II(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:r,lines:i,polygons:o}=e,s=function(e,t){const n={points:null,lines:null,polygons:null};for(const r in n){const i=e[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(4*i.length);const o=[];for(let e=0;e<i.length;e++)t(i[e],o),n[r][4*e+0]=o[0],n[r][4*e+1]=o[1],n[r][4*e+2]=o[2],n[r][4*e+3]=255}return n}(e,t);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:s.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:s.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines._pathType="open",n.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygons._normalize=!1,o.triangles&&(n.polygons.data.attributes.indices=o.triangles.value),n.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygonsOutline._pathType="open",n}const kI=["points","linestrings","polygons"],MI={...SI(xI.circle),...SI(xI.icon),...SI(xI.text),...SI(bI),...SI(wI),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class RI extends xA{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState(e){let{props:t,changeFlags:n}=e;if(!n.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:t,changeFlags:n}):this._updateStateJSON({props:t,changeFlags:n})}_updateStateBinary(e){let{props:t,changeFlags:n}=e;const r=II(t.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON(e){let{props:t,changeFlags:n}=e;const r=function(e){if(Array.isArray(e))return e;switch(Ju.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return Ju.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(t.data),i=this.getSubLayerRow.bind(this);let o={};const s={};if(Array.isArray(n.dataChanged)){const e=this.state.features;for(const t in e)o[t]=e[t].slice(),s[t]=[];for(const t of n.dataChanged){const n=TI(r,i,t);for(const r in e)s[r].push(aP({data:o[r],getIndex:e=>e.__source.index,dataRange:t,replace:n[r]}))}}else o=TI(r,i);const a=function(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:r,lineFeatures:i,polygonFeatures:o,polygonOutlineFeatures:s}=e;return n.points.data=r,n.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),n.points.getPosition=PI,n.lines.data=i,n.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),n.lines.getPath=PI,n.polygons.data=o,n.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),n.polygons.getPolygon=PI,n.polygonsOutline.data=s,n.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),n.polygonsOutline.getPath=PI,n}(o,s);this.setState({features:o,featuresDiff:s,layerProps:a})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n,sourceLayer:r}=t;return t.featureType=kI.find(e=>r.id.startsWith(`${this.id}-${e}-`)),n>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[n]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,n="points"===e.featureType;for(const r of this.getSubLayers())r.id.startsWith(t)===n&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:n}=this.state,r="polygons-fill",i=this.shouldRenderSubLayer(r,n.polygons?.data)&&this.getSubLayerClass(r,wI.type);if(i){const o=EI(this,wI.props),s=e&&t;return s||delete o.getLineColor,o.updateTriggers.lineColors=s,new i(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:n}=this.state,r="polygons-stroke",i="linestrings",o=!e&&t&&this.shouldRenderSubLayer(r,n.polygonsOutline?.data)&&this.getSubLayerClass(r,bI.type),s=this.shouldRenderSubLayer(i,n.lines?.data)&&this.getSubLayerClass(i,bI.type);if(o||s){const e=EI(this,bI.props);return[o&&new o(e,this.getSubLayerProps({id:r,updateTriggers:e.updateTriggers}),n.polygonsOutline),s&&new s(e,this.getSubLayerProps({id:i,updateTriggers:e.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:n}=this.state;let{highlightedObjectIndex:r}=this.props;!n&&Number.isFinite(r)&&(r=t.points.data.findIndex(e=>e.__source.index===r));const i=new Set(e.split("+")),o=[];for(const s of i){const e=`points-${s}`,i=xI[s],a=i&&this.shouldRenderSubLayer(e,t.points?.data)&&this.getSubLayerClass(e,i.type);if(a){const l=EI(this,i.props);let c=t.points;if("text"===s&&n){const{instancePickingColors:e,...t}=c.data.attributes;c={...c,data:{...c.data,attributes:t}}}o.push(new a(l,this.getSubLayerProps({id:e,updateTriggers:l.updateTriggers,highlightedObjectIndex:r}),c))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return t&&"function"===typeof e?(t,n)=>{const{data:r,index:i}=n,o=function(e,t){if(!e)return null;const n="startIndices"in e?e.startIndices[t]:t,r=e.featureIds.value[n];return-1!==n?function(e,t,n){const r={properties:{...e.properties[t]}};for(const i in e.numericProps)r.properties[i]=e.numericProps[i].value[n];return r}(e,r,n):null}(r,i);return e(o,n)}:super.getSubLayerAccessor(e)}}RI.layerName="GeoJsonLayer",RI.defaultProps=MI;const OI=RI,LI={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class DI{props;stats;activeRequestCount=0;requestQueue=[];requestMap=(()=>new Map)();updateTimer=null;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.props={...LI,...e},this.stats=new ah({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},r=new Promise(e=>(n.resolve=e,n));return this.requestQueue.push(n),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:t,resolve:n}=e;let r=!1;const i=()=>{r||(r=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:i}):Promise.resolve({done:i})}_issueNewRequests(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){const e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((e,t)=>e.priority-t.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}class NI{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,this.boundingBox="west"in e?[[e.west,e.south],[e.east,e.north]]:[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData(e){let{getData:t,requestScheduler:n,onLoad:r,onError:i}=e;const{index:o,id:s,bbox:a,userData:l,zoom:c}=this,u=this._loaderId;this._abortController=new AbortController;const{signal:h}=this._abortController,d=await n.scheduleRequest(this,e=>e.isSelected?1:-1);if(!d)return void(this._isCancelled=!0);if(this._isCancelled)return void d.done();let f,p=null;try{p=await t({index:o,id:s,bbox:a,userData:l,zoom:c,signal:h})}catch(m){f=m||!0}finally{d.done()}u===this._loaderId&&(this._loader=void 0,this.content=p,!this._isCancelled||p?(this._isLoaded=!0,this._isCancelled=!1,f?i(f,this):r(this)):this._isLoaded=!1)}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const zI=Math.PI/180,FI=180/Math.PI,BI=6370972,jI=256;function UI(){const e=4018225162502676e-20,t=Math.PI/180*jI;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}class VI extends km{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{longitude:t=0,zoom:n=0,nearZMultiplier:r=.5,farZMultiplier:i=1,resolution:o=10}=e;let{latitude:s=0,height:a,altitude:l=1.5,fovy:c}=e;s=Math.max(Math.min(s,op),-85.051129),a=a||1,c?l=mp(c):c=pp(l);const u=1/Math.PI/Math.cos(s*Math.PI/180),h=Math.pow(2,n)*u,d=e.nearZ??r,f=e.farZ??(l+512*h/a)*i,p=(new Hf).lookAt({eye:[0,-l,0],up:[0,0,1]});p.rotateX(s*zI),p.rotateZ(-t*zI),p.scale(h/a),super({...e,height:a,viewMatrix:p,longitude:t,latitude:s,zoom:n,distanceScales:UI(),fovy:c,focalDistance:l,near:d,far:f}),this.scale=h,this.latitude=s,this.longitude=t,this.resolution=o}get projectionMode(){return bm.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(){const e={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},t=this.unproject([0,this.height/2],e),n=this.unproject([this.width/2,0],e),r=this.unproject([this.width,this.height/2],e),i=this.unproject([this.width/2,this.height],e);return r[0]<this.longitude&&(r[0]+=360),t[0]>this.longitude&&(t[0]-=360),[Math.min(t[0],r[0],n[0],i[0]),Math.min(t[1],r[1],n[1],i[1]),Math.max(t[0],r[0],n[0],i[0]),Math.max(t[1],r[1],n[1],i[1])]}unproject(e){let{topLeft:t=!0,targetZ:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[r,i,o]=e,s=t?i:this.height-i,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(o))l=GI(a,[r,s,o,1]);else{const e=GI(a,[r,s,-1,1]),t=GI(a,[r,s,1,1]),i=((n||0)/BI+1)*jI,o=uf(lf([],e,t)),c=uf(e),u=uf(t),h=4*((4*c*u-(o-c-u)**2)/16)/o;l=function(e,t,n,r){const i=t[0],o=t[1],s=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e}([],e,t,(Math.sqrt(c-h)-Math.sqrt(Math.max(0,i*i-h)))/Math.sqrt(o))}const[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n,r=0]=e,i=t*zI,o=n*zI,s=Math.cos(o),a=(r/BI+1)*jI;return[Math.sin(i)*s*a,-Math.cos(i)*s*a,Math.sin(o)*a]}unprojectPosition(e){const[t,n,r]=e,i=cf(e),o=Math.asin(r/i);return[Math.atan2(t,-n)*FI,o*FI,(i/jI-1)*BI]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function GI(e,t){const n=zf([],t,e);return Lf(n,n,1/n[3]),n}const HI=-1,$I=0,WI=1,qI=new mf,XI=new mf;class ZI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2?arguments[2]:void 0;n=n||qI.copy(e).add(t).scale(.5),this.center=new mf(n),this.halfDiagonal=new mf(t).subtract(this.center),this.minimum=new mf(e),this.maximum=new mf(t)}clone(){return new ZI(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,n=XI.from(e.normal),r=t.x*Math.abs(n.x)+t.y*Math.abs(n.y)+t.z*Math.abs(n.z),i=this.center.dot(n)+e.distance;return i-r>0?WI:i+r<0?HI:$I}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=qI.from(e).subtract(this.center),{halfDiagonal:n}=this;let r,i=0;return r=Math.abs(t.x)-n.x,r>0&&(i+=r*r),r=Math.abs(t.y)-n.y,r>0&&(i+=r*r),r=Math.abs(t.z)-n.z,r>0&&(i+=r*r),i}}const KI=new mf,YI=new mf;class JI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.radius=-0,this.center=new mf,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=KI.from(t),this.center=(new mf).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new JI(this.center,this.radius)}union(e){const t=this.center,n=this.radius,r=e.center,i=e.radius,o=KI.copy(r).subtract(t),s=o.magnitude();if(n>=s+i)return this.clone();if(i>=s+n)return e.clone();const a=.5*(n+s+i);return YI.copy(o).scale((-n+a)/s).add(t),this.center.copy(YI),this.radius=a,this}expand(e){const t=KI.from(e).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);const t=If(KI,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const t=KI.from(e).subtract(this.center);return Math.max(0,t.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,r=e.normal.dot(t)+e.distance;return r<-n?HI:r<n?$I:WI}}function QI(e,t,n){const r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],f=n[1],p=n[2],m=n[3],g=n[4],_=n[5],y=n[6],v=n[7],x=n[8];return e[0]=d*r+f*s+p*c,e[1]=d*i+f*a+p*u,e[2]=d*o+f*l+p*h,e[3]=m*r+g*s+_*c,e[4]=m*i+g*a+_*u,e[5]=m*o+g*l+_*h,e[6]=y*r+v*s+x*c,e[7]=y*i+v*a+x*u,e[8]=y*o+v*l+x*h,e}function ek(e,t,n){const r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}var tk;!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"}(tk||(tk={}));const nk=Object.freeze([1,0,0,0,1,0,0,0,1]);class rk extends wf{static get IDENTITY(){return function(){sk||(sk=new rk,Object.freeze(sk));return sk}()}static get ZERO(){return function(){ik||(ik=new rk([0,0,0,0,0,0,0,0,0]),Object.freeze(ik));return ik}()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return tk}constructor(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(nk)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,l=i+i,c=n*s,u=r*s,h=r*a,d=i*s,f=i*a,p=i*l,m=o*s,g=o*a,_=o*l;e[0]=1-h-p,e[3]=u-_,e[6]=d+g,e[1]=u+_,e[4]=1-c-p,e[7]=f-m,e[2]=d-g,e[5]=f+m,e[8]=1-c-h}(this,e),this.check()}set(e,t,n,r,i,o,s,a,l){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this.check()}setRowMajor(e,t,n,r,i,o,s,a,l){return this[0]=e,this[1]=r,this[2]=s,this[3]=t,this[4]=i,this[5]=a,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return function(e){const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*(c*o-s*l)+n*(-c*i+s*a)+r*(l*i-o*a)}(this)}transpose(){return function(e,t){if(e===t){const n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){return function(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,f=c*o-s*l;let p=n*h+r*d+i*f;p&&(p=1/p,e[0]=h*p,e[1]=(-u*r+i*c)*p,e[2]=(a*r-i*s)*p,e[3]=d*p,e[4]=(u*n-i*l)*p,e[5]=(-a*n+i*o)*p,e[6]=f*p,e[7]=(-c*n+r*l)*p,e[8]=(s*n-r*o)*p)}(this,this),this.check()}multiplyLeft(e){return QI(this,e,this),this.check()}multiplyRight(e){return QI(this,this,e),this.check()}rotate(e){return function(e,t,n){const r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),f=Math.cos(n);e[0]=f*r+d*s,e[1]=f*i+d*a,e[2]=f*o+d*l,e[3]=f*s-d*r,e[4]=f*a-d*i,e[5]=f*l-d*o,e[6]=c,e[7]=u,e[8]=h}(this,this,e),this.check()}scale(e){return Array.isArray(e)?ek(this,this,e):ek(this,this,[e,e]),this.check()}translate(e){return function(e,t,n){const r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],f=n[1];e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d*r+f*s+c,e[7]=d*i+f*a+u,e[8]=d*o+f*l+h}(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e}(t||[-0,-0],e,this);break;case 3:n=sf(t||[-0,-0,-0],e,this);break;case 4:n=df(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Zd(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let ik,ok,sk=null;class ak extends Yd{static get ZERO(){return ok||(ok=new ak(0,0,0,0),Object.freeze(ok)),ok}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(-0,-0,-0,-0),Vd(e)&&1===arguments.length?this.copy(e):(jd.debug&&(Xd(e),Xd(t),Xd(n),Xd(r)),this[0]=e,this[1]=t,this[2]=n,this[3]=r)}set(e,t,n,r){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return jd.debug&&(Xd(e.x),Xd(e.y),Xd(e.z),Xd(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Xd(e)}get w(){return this[3]}set w(e){this[3]=Xd(e)}transform(e){return of(this,this,e),this.check()}transformByMatrix3(e){return df(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const r=t[0],i=t[1];e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e[2]=t[2],e[3]=t[3]}(this,this,e),this.check()}transformByQuaternion(e){return af(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}function lk(){const e=new Qd(4);return Qd!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ck(e,t,n){n*=.5;const r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function uk(e,t,n){const r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*u+s*a+i*c-o*l,e[1]=i*u+s*l+o*a-r*c,e[2]=o*u+s*c+r*l-i*a,e[3]=s*u-r*a-i*l-o*c,e}function hk(e,t,n,r){const i=t[0],o=t[1],s=t[2],a=t[3];let l,c,u,h,d,f=n[0],p=n[1],m=n[2],g=n[3];return l=i*f+o*p+s*m+a*g,l<0&&(l=-l,f=-f,p=-p,m=-m,g=-g),1-l>Jd?(c=Math.acos(l),d=Math.sin(c),u=Math.sin((1-r)*c)/d,h=Math.sin(r*c)/d):(u=1-r,h=r),e[0]=u*i+h*f,e[1]=u*o+h*p,e[2]=u*s+h*m,e[3]=u*a+h*g,e}function dk(e,t){const n=t[0]+t[4]+t[8];let r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const i=(n+1)%3,o=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*o+o]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*i+o]-t[3*o+i])*r,e[i]=(t[3*i+n]+t[3*n+i])*r,e[o]=(t[3*o+n]+t[3*n+o])*r}return e}const fk=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},pk=Lf,mk=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},gk=function(e,t,n,r){const i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e[3]=a+r*(n[3]-a),e},_k=Df,yk=Nf,vk=function(e,t){const n=t[0],r=t[1],i=t[2],o=t[3];let s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=o*s,e};const xk=function(){const e=ef(),t=tf(1,0,0),n=tf(0,1,0);return function(r,i,o){const s=nf(i,o);return s<-.999999?(rf(e,t,i),cf(e)<1e-6&&rf(e,n,i),function(e,t){const n=t[0],r=t[1],i=t[2];let o=n*n+r*r+i*i;o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o}(e,e),ck(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(rf(e,i,o),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,vk(r,r))}}(),bk=(function(){const e=lk(),t=lk()}(),function(){const e=function(){const e=new Qd(9);return Qd!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}(),[0,0,0,1]);class wk extends qd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&1===arguments.length?this.copy(e):this.set(e,t,n,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,r){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return dk(this,e),this.check()}fromAxisRotation(e,t){return ck(this,e,t),this.check()}identity(){var e;return(e=this)[0]=0,e[1]=0,e[2]=0,e[3]=1,this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Xd(e)}get y(){return this[1]}set y(e){this[1]=Xd(e)}get z(){return this[2]}set z(e){this[2]=Xd(e)}get w(){return this[3]}set w(e){this[3]=Xd(e)}len(){return _k(this)}lengthSquared(){return yk(this)}dot(e){return mk(this,e)}rotationTo(e,t){return xk(this,e,t),this.check()}add(e){return fk(this,this,e),this.check()}calculateW(){return function(e,t){const n=t[0],r=t[1],i=t[2];e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i))}(this,this),this.check()}conjugate(){return function(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3]}(this,this),this.check()}invert(){return function(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o,a=s?1/s:0;e[0]=-n*a,e[1]=-r*a,e[2]=-i*a,e[3]=o*a}(this,this),this.check()}lerp(e,t,n){return void 0===n?this.lerp(this,e,t):(gk(this,e,t,n),this.check())}multiplyRight(e){return uk(this,this,e),this.check()}multiplyLeft(e){return uk(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){return function(e,t,n){n*=.5;const r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=r*l+s*a,e[1]=i*l+o*a,e[2]=o*l-i*a,e[3]=s*l-r*a}(this,this,e),this.check()}rotateY(e){return function(e,t,n){n*=.5;const r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=r*l-o*a,e[1]=i*l+s*a,e[2]=o*l+r*a,e[3]=s*l-i*a}(this,this,e),this.check()}rotateZ(e){return function(e,t,n){n*=.5;const r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=r*l+i*a,e[1]=i*l-r*a,e[2]=o*l+s*a,e[3]=s*l-o*a}(this,this,e),this.check()}scale(e){return pk(this,this,e),this.check()}slerp(e,t,n){let r,i,o;switch(arguments.length){case 1:({start:r=bk,target:i,ratio:o}=e);break;case 2:r=this,i=e,o=t;break;default:r=e,i=t,o=n}return hk(this,r,i,o),this.check()}transformVector4(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ak;return function(e,t,n){const r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2],c=n[3],u=c*r+a*o-l*i,h=c*i+l*r-s*o,d=c*o+s*i-a*r,f=-s*r-a*i-l*o;e[0]=u*c+f*-s+h*-l-d*-a,e[1]=h*c+f*-a+d*-s-u*-l,e[2]=d*c+f*-l+u*-a-h*-s,e[3]=t[3]}(t,e,this),Zd(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Sk=new mf,Ek=new mf,Tk=new mf,Ak=new mf,Ck=new mf,Pk=new mf,Ik=new mf,kk=0,Mk=1,Rk=2,Ok=3,Lk=4,Dk=5,Nk=6,zk=7,Fk=8;class Bk{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];this.center=(new mf).from(e),this.halfAxes=new rk(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new mf(e).len(),new mf(t).len(),new mf(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),r=new mf(e).normalize(),i=new mf(t).normalize(),o=new mf(n).normalize();return(new wk).fromMatrix3(new rk([...r,...i,...o]))}fromCenterHalfSizeQuaternion(e,t,n){const r=new wk(n),i=(new rk).fromQuaternion(r);return i[0]=i[0]*t[0],i[1]=i[1]*t[0],i[2]=i[2]*t[0],i[3]=i[3]*t[1],i[4]=i[4]*t[1],i[5]=i[5]*t[1],i[6]=i[6]*t[2],i[7]=i[7]*t[2],i[8]=i[8]*t[2],this.center=(new mf).from(e),this.halfAxes=i,this}clone(){return new Bk(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new JI;const t=this.halfAxes,n=t.getColumn(0,Tk),r=t.getColumn(1,Ak),i=t.getColumn(2,Ck),o=Sk.copy(n).add(r).add(i);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,r=this.halfAxes,i=n.x,o=n.y,s=n.z,a=Math.abs(i*r[kk]+o*r[Mk]+s*r[Rk])+Math.abs(i*r[Ok]+o*r[Lk]+s*r[Dk])+Math.abs(i*r[Nk]+o*r[zk]+s*r[Fk]),l=n.dot(t)+e.distance;return l<=-a?HI:l>=a?WI:$I}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Ek.from(e).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,Tk),i=n.getColumn(1,Ak),o=n.getColumn(2,Ck),s=r.magnitude(),a=i.magnitude(),l=o.magnitude();r.normalize(),i.normalize(),o.normalize();let c,u=0;return c=Math.abs(t.dot(r))-s,c>0&&(u+=c*c),c=Math.abs(t.dot(i))-a,c>0&&(u+=c*c),c=Math.abs(t.dot(o))-l,c>0&&(u+=c*c),u}computePlaneDistances(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-0,-0],r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,s=this.halfAxes,a=s.getColumn(0,Tk),l=s.getColumn(1,Ak),c=s.getColumn(2,Ck),u=Pk.copy(a).add(l).add(c).add(o),h=Ik.copy(u).subtract(e);let d=t.dot(h);return r=Math.min(d,r),i=Math.max(d,i),u.copy(o).add(a).add(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),r=Math.min(d,r),i=Math.max(d,i),u.copy(o).add(a).subtract(l).add(c),h.copy(u).subtract(e),d=t.dot(h),r=Math.min(d,r),i=Math.max(d,i),u.copy(o).add(a).subtract(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),r=Math.min(d,r),i=Math.max(d,i),o.copy(u).subtract(a).add(l).add(c),h.copy(u).subtract(e),d=t.dot(h),r=Math.min(d,r),i=Math.max(d,i),o.copy(u).subtract(a).add(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),r=Math.min(d,r),i=Math.max(d,i),o.copy(u).subtract(a).subtract(l).add(c),h.copy(u).subtract(e),d=t.dot(h),r=Math.min(d,r),i=Math.max(d,i),o.copy(u).subtract(a).subtract(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),r=Math.min(d,r),i=Math.max(d,i),n[0]=r,n[1]=i,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Tk);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,Ak);n.transformAsPoint(e);const r=this.halfAxes.getColumn(2,Ck);return r.transformAsPoint(e),this.halfAxes=new rk([...t,...n,...r]),this}getTransform(){throw new Error("not implemented")}}const jk=new mf,Uk=new mf;class Vk{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.normal=new mf,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Kd(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=jk.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,r){return this.normal.set(e,t,n),Kd($d(this.normal.len(),1)),this.distance=r,this}clone(){return new Vk(this.normal,this.distance)}equals(e){return $d(this.distance,e.distance)&&$d(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=Uk.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];const n=jk.from(e),r=this.getPointDistance(n),i=Uk.copy(this.normal).scale(r);return n.subtract(i).to(t)}}const Gk=[new mf([1,0,0]),new mf([0,1,0]),new mf([0,0,1])],Hk=new mf,$k=new mf;class Wk{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.planes=e}fromBoundingSphere(e){this.planes.length=2*Gk.length;const t=e.center,n=e.radius;let r=0;for(const i of Gk){let e=this.planes[r],o=this.planes[r+1];e||(e=this.planes[r]=new Vk),o||(o=this.planes[r+1]=new Vk);const s=Hk.copy(i).scale(-n).add(t);e.fromPointNormal(s,i);const a=Hk.copy(i).scale(n).add(t),l=$k.copy(i).negate();o.fromPointNormal(a,l),r+=2}return this}computeVisibility(e){let t=WI;for(const n of this.planes){switch(e.intersectPlane(n)){case HI:return HI;case $I:t=$I}}return t}computeVisibilityWithPlaneMask(e,t){if(Kd(Number.isFinite(t),"parentPlaneMask is required."),t===Wk.MASK_OUTSIDE||t===Wk.MASK_INSIDE)return t;let n=Wk.MASK_INSIDE;const r=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&0===(t&o))continue;const s=r[i],a=e.intersectPlane(s);if(a===HI)return Wk.MASK_OUTSIDE;a===$I&&(n|=o)}return n}}Wk.MASK_OUTSIDE=4294967295,Wk.MASK_INSIDE=0,Wk.MASK_INDETERMINATE=2147483647;new mf,new mf,new mf,new mf,new mf;new mf,new mf,new mf,new mf,new mf,new mf,new mf,new mf,new mf,new mf,new mf,new mf;Math.PI,Math.PI,Math.PI,Math.PI;const qk=new rk,Xk=new rk,Zk=new rk,Kk=new rk,Yk=new rk;function Jk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};let n=0,r=0;const i=Xk,o=Zk;i.identity(),o.copy(e);const s=1e-20*function(e){let t=0;for(let n=0;n<9;++n){const r=e[n];t+=r*r}return Math.sqrt(t)}(o);for(;r<10&&tM(o)>s;)nM(o,Kk),Yk.copy(Kk).transpose(),o.multiplyRight(Kk),o.multiplyLeft(Yk),i.multiplyRight(Kk),++n>2&&(++r,n=0);return t.unitary=i.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}const Qk=[1,0,0],eM=[2,2,1];function tM(e){let t=0;for(let n=0;n<3;++n){const r=e[qk.getElementIndex(eM[n],Qk[n])];t+=2*r*r}return Math.sqrt(t)}function nM(e,t){let n=0,r=1;for(let l=0;l<3;++l){const t=Math.abs(e[qk.getElementIndex(eM[l],Qk[l])]);t>n&&(r=l,n=t)}const i=Qk[r],o=eM[r];let s=1,a=0;if(Math.abs(e[qk.getElementIndex(o,i)])>1e-15){const t=(e[qk.getElementIndex(o,o)]-e[qk.getElementIndex(i,i)])/2/e[qk.getElementIndex(o,i)];let n;n=t<0?-1/(-t+Math.sqrt(1+t*t)):1/(t+Math.sqrt(1+t*t)),s=1/Math.sqrt(1+n*n),a=n*s}return rk.IDENTITY.to(t),t[qk.getElementIndex(i,i)]=t[qk.getElementIndex(o,o)]=s,t[qk.getElementIndex(o,i)]=a,t[qk.getElementIndex(i,o)]=-a,t}const rM=new mf,iM=new mf,oM=new mf,sM=new mf,aM=new mf,lM=new rk,cM={diagonal:new rk,unitary:new rk};const uM=512,hM=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],dM=hM.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),fM=dM.concat([[.25,.5],[.75,.5]]);class pM{constructor(e,t,n){this.x=e,this.y=t,this.z=n}get children(){if(!this._children){const e=2*this.x,t=2*this.y,n=this.z+1;this._children=[new pM(e,t,n),new pM(e,t+1,n),new pM(e+1,t,n),new pM(e+1,t+1,n)]}return this._children}update(e){const{viewport:t,cullingVolume:n,elevationBounds:r,minZ:i,maxZ:o,bounds:s,offset:a,project:l}=e,c=this.getBoundingVolume(r,a,l);if(s&&!this.insideBounds(s))return!1;if(n.computeVisibility(c)<0)return!1;if(!this.childVisible){let{z:e}=this;if(e<o&&e>=i){const n=c.distanceTo(t.cameraPosition)*t.scale/t.height;e+=Math.floor(Math.log2(n))}if(e>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const u of this.children)u.update(e);return!0}getSelected(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds(e){let[t,n,r,i]=e;const o=Math.pow(2,this.z),s=uM/o;return this.x*s<r&&this.y*s<i&&(this.x+1)*s>t&&(this.y+1)*s>n}getBoundingVolume(e,t,n){if(n){const t=this.z<1?fM:this.z<2?dM:hM,r=[];for(const i of t){const t=SM(this.x+i[0],this.y+i[1],this.z);t[2]=e[0],r.push(n(t)),e[0]!==e[1]&&(t[2]=e[1],r.push(n(t)))}return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bk;if(!e||0===e.length)return t.halfAxes=new rk([0,0,0,0,0,0,0,0,0]),t.center=new mf,t;const n=e.length,r=new mf(0,0,0);for(const T of e)r.add(T);const i=1/n;r.multiplyByScalar(i);let o=0,s=0,a=0,l=0,c=0,u=0;for(const T of e){const e=rM.copy(T).subtract(r);o+=e.x*e.x,s+=e.x*e.y,a+=e.x*e.z,l+=e.y*e.y,c+=e.y*e.z,u+=e.z*e.z}o*=i,s*=i,a*=i,l*=i,c*=i,u*=i;const h=lM;h[0]=o,h[1]=s,h[2]=a,h[3]=s,h[4]=l,h[5]=c,h[6]=a,h[7]=c,h[8]=u;const{unitary:d}=Jk(h,cM),f=t.halfAxes.copy(d);let p=f.getColumn(0,oM),m=f.getColumn(1,sM),g=f.getColumn(2,aM),_=-Number.MAX_VALUE,y=-Number.MAX_VALUE,v=-Number.MAX_VALUE,x=Number.MAX_VALUE,b=Number.MAX_VALUE,w=Number.MAX_VALUE;for(const T of e)rM.copy(T),_=Math.max(rM.dot(p),_),y=Math.max(rM.dot(m),y),v=Math.max(rM.dot(g),v),x=Math.min(rM.dot(p),x),b=Math.min(rM.dot(m),b),w=Math.min(rM.dot(g),w);p=p.multiplyByScalar(.5*(x+_)),m=m.multiplyByScalar(.5*(b+y)),g=g.multiplyByScalar(.5*(w+v)),t.center.copy(p).add(m).add(g);const S=iM.set(_-x,y-b,v-w).multiplyByScalar(.5),E=new rk([S[0],0,0,0,S[1],0,0,0,S[2]]);return t.halfAxes.multiplyRight(E),t}(r)}const r=Math.pow(2,this.z),i=uM/r,o=this.x*i+t*uM,s=uM-(this.y+1)*i;return new ZI([o,s,e[0]],[o+i,s+i,e[1]])}}const mM=512,gM=[-1/0,-1/0,1/0,1/0],_M={type:"object",value:null,validate:(e,t)=>t.optional&&null===e||"string"===typeof e||Array.isArray(e)&&e.every(e=>"string"===typeof e),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}};function yM(e,t){const n=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])],r=[Math.min(...n.map(e=>e[0])),Math.min(...n.map(e=>e[1])),Math.max(...n.map(e=>e[0])),Math.max(...n.map(e=>e[1]))];return r}function vM(e,t){if(!e||!e.length)return null;const{index:n,id:r}=t;if(Array.isArray(e)){const t=function(e){return Math.abs(e.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}(r)%e.length;e=e[t]}let i=e;for(const o of Object.keys(n)){const e=new RegExp(`{${o}}`,"g");i=i.replace(e,String(n[o]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),i}function xM(e){let{viewport:t,z:n,cullRect:r}=e;return(t.subViewports||[t]).map(e=>bM(e,n||0,r))}function bM(e,t,n){if(!Array.isArray(t)){const r=n.x-e.x,i=n.y-e.y,{width:o,height:s}=n,a={targetZ:t},l=e.unproject([r,i],a),c=e.unproject([r+o,i],a),u=e.unproject([r,i+s],a),h=e.unproject([r+o,i+s],a);return[Math.min(l[0],c[0],u[0],h[0]),Math.min(l[1],c[1],u[1],h[1]),Math.max(l[0],c[0],u[0],h[0]),Math.max(l[1],c[1],u[1],h[1])]}const r=bM(e,t[0],n),i=bM(e,t[1],n);return[Math.min(r[0],i[0]),Math.min(r[1],i[1]),Math.max(r[2],i[2]),Math.max(r[3],i[3])]}function wM(e,t){return Math.pow(2,e)*mM/t}function SM(e,t,n){const r=wM(n,mM),i=e/r*360-180,o=Math.PI-2*Math.PI*t/r;return[i,180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)))]}function EM(e,t,n,r){const i=wM(n,r);return[e/i*mM,t/i*mM]}function TM(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:mM;if(e.isGeospatial){const[e,i]=SM(t,n,r),[o,s]=SM(t+1,n+1,r);return{west:e,north:i,east:o,south:s}}const[o,s]=EM(t,n,r,i),[a,l]=EM(t+1,n+1,r,i);return{left:o,top:s,right:a,bottom:l}}function AM(e,t,n,r,i){const o=function(e,t,n){let r;if(t&&2===t.length){const[n,i]=t,o=e.getBounds({z:n}),s=e.getBounds({z:i});r=[Math.min(o[0],s[0]),Math.min(o[1],s[1]),Math.max(o[2],s[2]),Math.max(o[3],s[3])]}else r=e.getBounds();return e.isGeospatial?[Math.max(r[0],n[0]),Math.max(r[1],n[1]),Math.min(r[2],n[2]),Math.min(r[3],n[3])]:[Math.max(Math.min(r[0],n[2]),n[0]),Math.max(Math.min(r[1],n[3]),n[1]),Math.min(Math.max(r[2],n[0]),n[2]),Math.min(Math.max(r[3],n[1]),n[3])]}(e,null,r),s=wM(t,n),[a,l,c,u]=function(e,t,n){if(n){const r=yM(e,n).map(e=>e*t/mM);return r}return e.map(e=>e*t/mM)}(o,s,i),h=[];for(let d=Math.floor(a);d<c;d++)for(let e=Math.floor(l);e<u;e++)h.push({x:d,y:e,z:t});return h}function CM(e){let{viewport:t,maxZoom:n,minZoom:r,zRange:i,extent:o,tileSize:s=mM,modelMatrix:a,modelMatrixInverse:l,zoomOffset:c=0}=e,u=t.isGeospatial?Math.round(t.zoom+Math.log2(mM/s))+c:Math.ceil(t.zoom)+c;if("number"===typeof r&&Number.isFinite(r)&&u<r){if(!o)return[];u=r}"number"===typeof n&&Number.isFinite(n)&&u>n&&(u=n);let h=o;return a&&l&&o&&!t.isGeospatial&&(h=yM(o,a)),t.isGeospatial?function(e,t,n,r){const i=e instanceof VI&&e.resolution?e.projectPosition:null,o=Object.values(e.getFrustumPlanes()).map(e=>{let{normal:t,distance:n}=e;return new Vk(t.clone().negate(),n)}),s=new Wk(o),a=e.distanceScales.unitsPerMeter[2],l=n&&n[0]*a||0,c=n&&n[1]*a||0,u=e instanceof Bm&&e.pitch<=60?t:0;if(r){const[e,t,n,i]=r,o=ap([e,i]),s=ap([n,t]);r=[o[0],uM-o[1],s[0],uM-s[1]]}const h=new pM(0,0,0),d={viewport:e,project:i,cullingVolume:s,elevationBounds:[l,c],minZ:u,maxZ:t,bounds:r,offset:0};if(h.update(d),e instanceof Bm&&e.subViewports&&e.subViewports.length>1){for(d.offset=-1;h.update(d)&&!(--d.offset<-3););for(d.offset=1;h.update(d)&&!(++d.offset>3););}return h.getSelected()}(t,u,i,o):AM(t,u,s,h||gM,l)}function PM(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}return!1}const IM="never",kM="no-overlap",MM="best-available",RM={[MM]:function(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&!LM(t)&&DM(t);for(const t of e)t.isVisible=Boolean(2&t.state)},[kM]:function(e){for(const n of e)n.state=0;for(const n of e)n.isSelected&&LM(n);const t=Array.from(e).sort((e,t)=>e.zoom-t.zoom);for(const n of t)if(n.isVisible=Boolean(2&n.state),n.children&&(n.isVisible||1&n.state))for(const e of n.children)e.state=1;else n.isSelected&&DM(n)},[IM]:()=>{}},OM={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};function LM(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=2,!0;t=t.parent}return!1}function DM(e){for(const t of e.children)t.isLoaded||t.content?t.state|=2:DM(t)}const NM={TilesetClass:class{constructor(e){this._getCullBounds=function(e){let t,n={};return r=>{for(const i in r)if(!PM(r[i],n[i])){t=e(r),n=r;break}return t}}(xM),this.opts={...OM,...e},this.setOptions(this.opts),this.onTileLoad=e=>{this.opts.onTileLoad?.(e),null!==this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new DI({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Hf,this._modelMatrixInverse=new Hf}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return null!==this._selectedTiles&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return null!==this._selectedTiles&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);this._selectedTiles&&this._selectedTiles.includes(t)?t.setNeedsReload():this._cache.delete(e)}}update(e){let{zRange:t,modelMatrix:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{zRange:null,modelMatrix:null};const r=n?new Hf(n):new Hf,i=!r.equals(this._modelMatrix);if(this._viewport&&e.equals(this._viewport)&&$d(this._zRange,t)&&!i)this.needsReload&&(this._selectedTiles=this._selectedTiles.map(e=>this._getTile(e.index,!0)));else{i&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=t;const n=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=n.map(e=>this._getTile(e,!0)),this._dirty&&this._rebuildTree()}const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:r}=e;for(const[e,t,i,o]of n){let n;if("west"in r)n=r.west<i&&r.east>e&&r.south<o&&r.north>t;else{const s=Math.min(r.top,r.bottom),a=Math.max(r.top,r.bottom);n=r.left<i&&r.right>e&&s<o&&a>t}if(n)return!0}return!1}return!0}getTileIndices(e){let{viewport:t,maxZoom:n,minZoom:r,zRange:i,modelMatrix:o,modelMatrixInverse:s}=e;const{tileSize:a,extent:l,zoomOffset:c}=this.opts;return CM({viewport:t,maxZoom:n,minZoom:r,zRange:i,tileSize:a,extent:l,modelMatrix:o,modelMatrixInverse:s,zoomOffset:c})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:TM(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){return{x:Math.floor(e.x/2),y:Math.floor(e.y/2),z:e.z-1}}updateTileStates(){const e=this.opts.refinementStrategy||MM,t=new Array(this._cache.size);let n=0;for(const r of this._cache.values())t[n++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;("function"===typeof e?e:RM[e])(Array.from(this._cache.values())),n=0;for(const r of this._cache.values())if(t[n++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let n=0;for(const r of this._cache.values())r.isLoading&&(n++,r.isSelected||r.isVisible||t.push(r));for(;e>0&&n>e&&t.length>0;){t.shift().abort(),n--}}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const e=this._getNearestAncestor(t);t.parent=e,e?.children&&e.children.push(t)}}_resizeCache(){const{_cache:e,opts:t}=this,n=t.maxCacheSize??(null!==t.maxCacheByteSize?1/0:5*this.selectedTiles.length),r=t.maxCacheByteSize??1/0;if(e.size>n||this._cacheByteSize>r){for(const[i,o]of e)if(o.isVisible||o.isSelected||(this._cacheByteSize-=null!==t.maxCacheByteSize?o.byteLength:0,e.delete(i),this.opts.onTileUnload?.(o)),e.size<=n&&this._cacheByteSize<=r)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((e,t)=>e.zoom-t.zoom),this._dirty=!1)}_getTile(e,t){const n=this.getTileId(e);let r=this._cache.get(n),i=!1;return!r&&t?(r=new NI(e),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:n,zoom:this.getTileZoom(r.index)}),i=!0,this._cache.set(n,r),this._dirty=!0):r&&r.needsReload&&(i=!0),r&&i&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e){const{_minZoom:t=0}=this;let n=e.index;for(;this.getTileZoom(n)>t;){n=this.getParentIndex(n);const e=this._getTile(n);if(e)return e}return null}},data:{type:"data",value:[]},dataComparator:_M.equal,renderSubLayers:{type:"function",value:e=>new OI(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:MM,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class zM extends xA{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return Boolean(this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(e=>e.isLoaded)))}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{changeFlags:t}=e,{tileset:n}=this.state;const r=t.propsOrDataChanged||t.updateTriggersChanged,i=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);n?r&&(n.setOptions(this._getTilesetOptions()),i?n.reloadAll():n.tiles.forEach(e=>{e.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:n,refinementStrategy:r,extent:i,maxZoom:o,minZoom:s,maxRequests:a,debounceTime:l,zoomOffset:c}=this.props;return{maxCacheSize:t,maxCacheByteSize:n,maxZoom:o,minZoom:s,tileSize:e,refinementStrategy:r,extent:i,maxRequests:a,debounceTime:l,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:n}=this.props,r=e.update(this.context.viewport,{zRange:t,modelMatrix:n}),{isLoaded:i}=e,o=this.state.isLoaded!==i,s=this.state.frameNumber!==r;i&&(o||s)&&this._onViewportLoad(),s&&this.setState({frameNumber:r}),this.state.isLoaded=i}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:n,fetch:r}=this.props,{signal:i}=e;return e.url="string"===typeof t||Array.isArray(t)?vM(t,e):null,n?n(e):r&&e.url?r(e.url,{propName:"data",layer:this,signal:i}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,n=t.props.tile,r=e.info;return r.picked&&(r.tile=n),r.sourceTile=n,r.sourceTileSubLayer=t,r}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(e.isLoaded||e.content)if(e.layers)t&&e.layers[0]&&Object.keys(t).some(n=>e.layers[0].props[n]!==t[n])&&(e.layers=e.layers.map(e=>e.clone(t)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=nh(n,Boolean).map(n=>n.clone({tile:e,...t}))}else;return e.layers})}filterSubLayer(e){let{layer:t,cullRect:n}=e;const{tile:r}=t.props;return this.state.tileset.isTileVisible(r,n)}}zM.defaultProps=NM,zM.layerName="TileLayer";const FM=zM,BM=new Uint32Array([0,2,1,0,3,2]),jM=new Float32Array([0,1,0,0,1,0,1,1]);function UM(e,t){if(!t)return function(e){const t=new Float64Array(12);for(let n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return{vertexCount:6,positions:t,indices:BM,texCoords:jM}}(e);const n=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),r=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),i=Math.ceil(n/t)+1,o=Math.ceil(r/t)+1,s=(i-1)*(o-1)*6,a=new Uint32Array(s),l=new Float32Array(i*o*2),c=new Float64Array(i*o*3);let u=0,h=0;for(let d=0;d<i;d++){const t=d/(i-1);for(let n=0;n<o;n++){const r=n/(o-1),i=VM(e,t,r);c[3*u+0]=i[0],c[3*u+1]=i[1],c[3*u+2]=i[2]||0,l[2*u+0]=t,l[2*u+1]=1-r,d>0&&n>0&&(a[h++]=u-o,a[h++]=u-o-1,a[h++]=u-1,a[h++]=u-o,a[h++]=u-1,a[h++]=u),u++}}return{vertexCount:s,positions:c,indices:a,texCoords:l}}function VM(e,t,n){return Hd(Hd(e[0],e[1],n),Hd(e[3],e[2],n),t)}const GM="uniform bitmapUniforms {\n  vec4 bounds;\n  float coordinateConversion;\n  float desaturate;\n  vec3 tintColor;\n  vec4 transparentColor;\n} bitmap;\n",HM={name:"bitmap",vs:GM,fs:GM,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},$M={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:xm.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class WM extends CT{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nin vec2 texCoords;\nin vec3 positions;\nin vec3 positions64Low;\n\nout vec2 vTexCoord;\nout vec2 vTexPos;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (bitmap.coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project.commonOrigin.xy;\n  } else if (bitmap.coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nin vec2 vTexCoord;\nin vec2 vTexPos;\n\nout vec4 fragColor;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), bitmap.desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * bitmap.tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (bitmap.transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),\n    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])\n  );\n}\n\n\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (bitmap.coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (bitmap.coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture(bitmapTexture, uv);\n\n  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  if (bool(picking.isActive) && !bool(picking.isAttribute)) {\n    // Since instance information is not used, we can use picking color for pixel index\n    fragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n",modules:[zT,BT,HM]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:t}})}updateState(e){let{props:t,oldProps:n,changeFlags:r}=e;const i=this.getAttributeManager();if(r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll()),t.bounds!==n.bounds){const e=this.state.mesh,t=this._createMesh();this.state.model.setVertexCount(t.vertexCount);for(const n in t)e&&e[n]!==t[n]&&i.invalidate(n);this.setState({mesh:t,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==n._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,n=e.info;if(!n.color||!t)return n.bitmap=null,n;const{width:r,height:i}=t;n.index=0;const o=function(e){const[t,n,r]=e;return[(t+(15&r)/16)/256,(n+(240&r)/256)/256]}(n.color);return n.bitmap={size:{width:r,height:i},uv:o,pixel:[Math.floor(o[0]*r),Math.floor(o[1]*i)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return XM(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),UM(t,this.context.viewport.resolution)}_getModel(){return new pE(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:n,coordinateConversion:r,bounds:i,disablePicking:o}=this.state,{image:s,desaturate:a,transparentColor:l,tintColor:c}=this.props;if((!t.picking.isActive||!o)&&s&&n){const e={bitmapTexture:s,bounds:i,coordinateConversion:r,desaturate:a,tintColor:c.slice(0,3).map(e=>e/255),transparentColor:l.map(e=>e/255)};n.shaderInputs.setProps({bitmap:e}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:n}=xm;let{_imageCoordinateSystem:r}=this.props;if(r!==n){const{bounds:n}=this.props;if(!XM(n))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const i=this.context.viewport.resolution?e:t;if(r=r===e?e:t,r===e&&i===t)return{coordinateConversion:-1,bounds:n};if(r===t&&i===e){const e=ap([n[0],n[1]]),t=ap([n[2],n[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}WM.layerName="BitmapLayer",WM.defaultProps=$M;const qM=WM;function XM(e){return Number.isFinite(e[0])}const ZM=e=>{let{station:t,showDetails:n=!0,showDataPreview:r=!1,timeSeriesData:o=[],currentFrame:s=0,className:a=""}=e;const[l,c]=(0,i.useState)(!1),[u,h]=(0,i.useState)({x:0,y:0});(0,i.useEffect)(()=>{t?(c(!0),h({x:t.x,y:t.y})):c(!1)},[t]);const d=(e,t)=>{const n=e>=0?"N":"S",r=t>=0?"E":"W";return`${Math.abs(e).toFixed(4)}\xb0${n}, ${Math.abs(t).toFixed(4)}\xb0${r}`},f=(null===t||void 0===t?void 0:t.isCoordinate)||(null===t||void 0===t?void 0:t.isPOV)||(null===t||void 0===t?void 0:t.isGrid)||(null===t||void 0===t?void 0:t.isWind)||!(null!==t&&void 0!==t&&t.type);if(!l||!t)return null;const p=(e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"usm":return{color:"text-blue-400",bgColor:"bg-blue-400/10",label:"USM Station"};case"ndbc":return{color:"text-yellow-400",bgColor:"bg-yellow-400/10",label:"NDBC Buoy"};case"api_station":return{color:"text-green-400",bgColor:"bg-green-400/10",label:"Data Station"};case"ssh":return{color:"text-indigo-400",bgColor:"bg-indigo-400/10",label:"Surface Elevation"};default:return{color:"text-slate-400",bgColor:"bg-slate-400/10",label:"Unknown"}}})(t.type),m=(()=>{if(!o.length||!t)return null;return o[s%o.length]})(),g=(e=>{if(!e.timeRange)return null;const{start:t,end:n}=e.timeRange,r=n-t,i=Math.floor(r/864e5);return{start:t.toLocaleDateString(),end:n.toLocaleDateString(),duration:i>0?`${i} days`:"Same day"}})(t);return f?(0,jr.jsxs)("div",{className:`absolute pointer-events-none bg-slate-800/95 backdrop-blur-sm border border-cyan-400/50 rounded-lg shadow-xl z-50 transition-opacity duration-200 ${a}`,style:{left:u.x+15,top:u.y-10,transform:"translateY(-100%)",maxWidth:"260px"},children:[(0,jr.jsx)("div",{className:"p-3 border-b border-slate-700/50",children:(0,jr.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[t.isPOV&&(0,jr.jsx)("div",{className:"w-4 h-4 rounded-full bg-green-400"}),t.isGrid&&(0,jr.jsx)(pc,{className:"w-4 h-4 text-blue-400"}),t.isWind&&(0,jr.jsx)(Fr,{className:"w-4 h-4 text-cyan-400"}),t.isCoordinate&&(0,jr.jsx)($r,{className:"w-4 h-4 text-cyan-400"}),!t.isPOV&&!t.isGrid&&!t.isWind&&!t.isCoordinate&&(0,jr.jsx)(Fr,{className:"w-4 h-4 text-indigo-400"}),(0,jr.jsx)("div",{className:"font-semibold text-cyan-300 text-sm",children:t.name})]})}),(0,jr.jsxs)("div",{className:"p-3 space-y-2",children:[t.isCoordinate&&t.longitude&&t.latitude&&(0,jr.jsxs)("div",{className:"text-xs",children:[(0,jr.jsx)("div",{className:"text-slate-400 mb-1",children:"Coordinates"}),(0,jr.jsx)("div",{className:"text-slate-200 font-mono",children:d(t.latitude,t.longitude)})]}),t.details&&(0,jr.jsxs)("div",{className:"text-xs",children:[(0,jr.jsxs)("div",{className:"text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(Nr,{className:"w-3 h-3"}),t.isCoordinate?"Available Data":"Details"]}),(0,jr.jsx)("div",{className:"text-slate-200 space-y-1",children:t.details.split("\n").map((e,t)=>e.includes("Available data:")?null:(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400"}),e]},t)).filter(Boolean)})]})]}),t.isCoordinate&&(0,jr.jsx)("div",{className:"px-3 py-2 border-t border-slate-700/50 bg-slate-900/50",children:(0,jr.jsx)("div",{className:"text-xs text-slate-400 text-center",children:"Data within 0.1\xb0 radius"})}),(0,jr.jsx)("div",{className:"absolute w-2 h-2 bg-slate-800 border-l border-b border-cyan-400/50 transform rotate-45",style:{left:"-4px",top:"20px"}})]}):(0,jr.jsxs)("div",{className:`absolute pointer-events-none bg-slate-800/95 backdrop-blur-sm border border-blue-400/50 rounded-lg shadow-xl z-50 transition-opacity duration-200 ${a}`,style:{left:u.x+15,top:u.y-10,transform:"translateY(-100%)",maxWidth:"280px"},children:[(0,jr.jsxs)("div",{className:"p-3 border-b border-slate-700/50",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,jr.jsx)($r,{className:"w-4 h-4 text-blue-400"}),(0,jr.jsx)("div",{className:"font-semibold text-blue-300 text-sm",children:t.name})]}),(0,jr.jsxs)("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs ${p.bgColor} ${p.color}`,children:[(0,jr.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-current"}),p.label]})]}),(0,jr.jsxs)("div",{className:"p-3 space-y-2",children:[(0,jr.jsxs)("div",{className:"text-xs",children:[(0,jr.jsx)("div",{className:"text-slate-400 mb-1",children:"Location"}),(0,jr.jsx)("div",{className:"text-slate-200 font-mono",children:t.coordinates?d(t.coordinates[1],t.coordinates[0]):"Unknown location"})]}),t.details&&(0,jr.jsxs)("div",{className:"text-xs",children:[(0,jr.jsxs)("div",{className:"text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(Nr,{className:"w-3 h-3"}),"Details"]}),(0,jr.jsx)("div",{className:"text-slate-200 space-y-1",children:t.details.split("\n").map((e,t)=>{const n=e.split(":");return(0,jr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jr.jsx)("span",{children:n[0]}),n.length>1&&(0,jr.jsx)("span",{className:"font-mono font-semibold",children:n[1].trim()})]},t)})})]}),n&&(0,jr.jsxs)(jr.Fragment,{children:[t.dataPoints&&(0,jr.jsxs)("div",{className:"text-xs",children:[(0,jr.jsxs)("div",{className:"text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(Nr,{className:"w-3 h-3"}),"Data Points"]}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[(e=>e>=1e3?`${(e/1e3).toFixed(1)}k`:e.toString())(t.dataPoints)," measurements"]})]}),g&&(0,jr.jsxs)("div",{className:"text-xs",children:[(0,jr.jsxs)("div",{className:"text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(ii,{className:"w-3 h-3"}),"Time Range"]}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[(0,jr.jsxs)("div",{children:[g.start," - ",g.end]}),(0,jr.jsxs)("div",{className:"text-slate-400",children:["(",g.duration,")"]})]})]}),t.sourceFiles&&t.sourceFiles.length>0&&(0,jr.jsxs)("div",{className:"text-xs",children:[(0,jr.jsx)("div",{className:"text-slate-400 mb-1",children:"Data Sources"}),(0,jr.jsxs)("div",{className:"text-slate-200 space-y-0.5",children:[t.sourceFiles.slice(0,3).map((e,t)=>(0,jr.jsx)("div",{className:"truncate font-mono text-xs",children:e},t)),t.sourceFiles.length>3&&(0,jr.jsxs)("div",{className:"text-slate-400",children:["+",t.sourceFiles.length-3," more files"]})]})]}),t.availableParameters&&t.availableParameters.length>0&&(0,jr.jsxs)("div",{className:"text-xs",children:[(0,jr.jsx)("div",{className:"text-slate-400 mb-1",children:"Available Parameters"}),(0,jr.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.availableParameters.slice(0,4).map((e,t)=>(0,jr.jsx)("span",{className:"px-1.5 py-0.5 bg-slate-700/50 text-slate-300 rounded text-xs",children:e},t)),t.availableParameters.length>4&&(0,jr.jsxs)("span",{className:"px-1.5 py-0.5 bg-slate-700/50 text-slate-400 rounded text-xs",children:["+",t.availableParameters.length-4]})]})]})]}),r&&m&&(0,jr.jsxs)("div",{className:"border-t border-slate-700/50 pt-2 mt-2",children:[(0,jr.jsxs)("div",{className:"text-slate-400 mb-2 text-xs flex items-center gap-1",children:[(0,jr.jsx)(zr,{className:"w-3 h-3"}),"Current Readings"]}),(0,jr.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[m.currentSpeed&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)(Fr,{className:"w-3 h-3 text-cyan-400"}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("div",{className:"text-slate-400",children:"Current"}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[m.currentSpeed," m/s"]})]})]}),m.temperature&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)(sc,{className:"w-3 h-3 text-red-400"}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("div",{className:"text-slate-400",children:"Temp"}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[m.temperature,"\xb0F"]})]})]}),m.waveHeight&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)(Fr,{className:"w-3 h-3 text-blue-400"}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("div",{className:"text-slate-400",children:"Wave"}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[m.waveHeight," m"]})]})]}),m.salinity&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("div",{className:"text-slate-400",children:"Salinity"}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[m.salinity," PSU"]})]})]})]})]})]}),(0,jr.jsx)("div",{className:"absolute w-2 h-2 bg-slate-800 border-l border-b border-blue-400/50 transform rotate-45",style:{left:"-4px",top:"20px"}})]})},KM=Dr("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),YM=Dr("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),JM=Dr("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),QM=Dr("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),eR=Dr("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var tR=n(7820),nR=n.n(tR),rR=n(7770),iR=n.n(rR),oR=e=>0===e?0:e>0?1:-1,sR=e=>"number"==typeof e&&e!=+e,aR=e=>"string"===typeof e&&e.indexOf("%")===e.length-1,lR=e=>("number"===typeof e||e instanceof Number)&&!sR(e),cR=e=>lR(e)||"string"===typeof e,uR=0,hR=e=>{var t=++uR;return"".concat(e||"").concat(t)},dR=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!lR(e)&&"string"!==typeof e)return r;if(aR(e)){if(null==t)return r;var o=e.indexOf("%");n=t*parseFloat(e.slice(0,o))/100}else n=+e;return sR(n)&&(n=r),i&&null!=t&&n>t&&(n=t),n},fR=e=>{if(!Array.isArray(e))return!1;for(var t=e.length,n={},r=0;r<t;r++){if(n[e[r]])return!0;n[e[r]]=!0}return!1};function pR(e,t,n){return lR(e)&&lR(t)?e+n*(t-e):t}function mR(e,t,n){if(e&&e.length)return e.find(e=>e&&("function"===typeof t?t(e):iR()(e,t))===n)}var gR=e=>null===e||"undefined"===typeof e,_R=e=>gR(e)?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1)),yR=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i]};function vR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function xR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vR(Object(n),!0).forEach(function(t){bR(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vR(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function bR(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var wR=(0,i.forwardRef)((e,t)=>{var{aspect:n,initialDimension:r={width:-1,height:-1},width:o="100%",height:s="100%",minWidth:a=0,minHeight:l,maxHeight:c,children:u,debounce:h=0,id:d,className:f,onResize:p,style:m={}}=e,g=(0,i.useRef)(null),_=(0,i.useRef)();_.current=p,(0,i.useImperativeHandle)(t,()=>g.current);var[y,v]=(0,i.useState)({containerWidth:r.width,containerHeight:r.height}),x=(0,i.useCallback)((e,t)=>{v(n=>{var r=Math.round(e),i=Math.round(t);return n.containerWidth===r&&n.containerHeight===i?n:{containerWidth:r,containerHeight:i}})},[]);(0,i.useEffect)(()=>{var e=e=>{var t,{width:n,height:r}=e[0].contentRect;x(n,r),null===(t=_.current)||void 0===t||t.call(_,n,r)};h>0&&(e=nR()(e,h,{trailing:!0,leading:!1}));var t=new ResizeObserver(e),{width:n,height:r}=g.current.getBoundingClientRect();return x(n,r),t.observe(g.current),()=>{t.disconnect()}},[x,h]);var b=(0,i.useMemo)(()=>{var{containerWidth:e,containerHeight:t}=y;if(e<0||t<0)return null;yR(aR(o)||aR(s),"The width(%s) and height(%s) are both fixed numbers,\n       maybe you don't need to use a ResponsiveContainer.",o,s),yR(!n||n>0,"The aspect(%s) must be greater than zero.",n);var r=aR(o)?e:o,h=aR(s)?t:s;return n&&n>0&&(r?h=r/n:h&&(r=h*n),c&&h>c&&(h=c)),yR(r>0||h>0,"The width(%s) and height(%s) of chart should be greater than 0,\n       please check the style of container, or the props width(%s) and height(%s),\n       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the\n       height and width.",r,h,o,s,a,l,n),i.Children.map(u,e=>(0,i.cloneElement)(e,{width:r,height:h,style:xR({width:r,height:h},e.props.style)}))},[n,u,s,c,l,a,y,o]);return i.createElement("div",{id:d?"".concat(d):void 0,className:yi("recharts-responsive-container",f),style:xR(xR({},m),{},{width:o,height:s,minWidth:a,minHeight:l,maxHeight:c}),ref:g},i.createElement("div",{style:{width:0,height:0,overflow:"visible"}},b))});function SR(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var ER=(()=>"function"===typeof Symbol&&Symbol.observable||"@@observable")(),TR=()=>Math.random().toString(36).substring(7).split("").join("."),AR={INIT:`@@redux/INIT${TR()}`,REPLACE:`@@redux/REPLACE${TR()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${TR()}`};function CR(e){if("object"!==typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function PR(e,t,n){if("function"!==typeof e)throw new Error(SR(2));if("function"===typeof t&&"function"===typeof n||"function"===typeof n&&"function"===typeof arguments[3])throw new Error(SR(0));if("function"===typeof t&&"undefined"===typeof n&&(n=t,t=void 0),"undefined"!==typeof n){if("function"!==typeof n)throw new Error(SR(1));return n(PR)(e,t)}let r=e,i=t,o=new Map,s=o,a=0,l=!1;function c(){s===o&&(s=new Map,o.forEach((e,t)=>{s.set(t,e)}))}function u(){if(l)throw new Error(SR(3));return i}function h(e){if("function"!==typeof e)throw new Error(SR(4));if(l)throw new Error(SR(5));let t=!0;c();const n=a++;return s.set(n,e),function(){if(t){if(l)throw new Error(SR(6));t=!1,c(),s.delete(n),o=null}}}function d(e){if(!CR(e))throw new Error(SR(7));if("undefined"===typeof e.type)throw new Error(SR(8));if("string"!==typeof e.type)throw new Error(SR(17));if(l)throw new Error(SR(9));try{l=!0,i=r(i,e)}finally{l=!1}return(o=s).forEach(e=>{e()}),e}d({type:AR.INIT});return{dispatch:d,subscribe:h,getState:u,replaceReducer:function(e){if("function"!==typeof e)throw new Error(SR(10));r=e,d({type:AR.REPLACE})},[ER]:function(){const e=h;return{subscribe(t){if("object"!==typeof t||null===t)throw new Error(SR(11));function n(){const e=t;e.next&&e.next(u())}n();return{unsubscribe:e(n)}},[ER](){return this}}}}}function IR(e){const t=Object.keys(e),n={};for(let o=0;o<t.length;o++){const r=t[o];0,"function"===typeof e[r]&&(n[r]=e[r])}const r=Object.keys(n);let i;try{!function(e){Object.keys(e).forEach(t=>{const n=e[t];if("undefined"===typeof n(void 0,{type:AR.INIT}))throw new Error(SR(12));if("undefined"===typeof n(void 0,{type:AR.PROBE_UNKNOWN_ACTION()}))throw new Error(SR(13))})}(n)}catch(_t){i=_t}return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(i)throw i;let o=!1;const s={};for(let i=0;i<r.length;i++){const a=r[i],l=n[a],c=e[a],u=l(c,t);if("undefined"===typeof u){t&&t.type;throw new Error(SR(14))}s[a]=u,o=o||u!==c}return o=o||r.length!==Object.keys(e).length,o?s:e}}function kR(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?e=>e:1===t.length?t[0]:t.reduce((e,t)=>function(){return e(t(...arguments))})}function MR(e){return CR(e)&&"type"in e&&"string"===typeof e.type}function RR(e){return t=>{let{dispatch:n,getState:r}=t;return t=>i=>"function"===typeof i?i(n,r,e):t(i)}}var OR=RR(),LR=RR,DR=Symbol.for("immer-nothing"),NR=Symbol.for("immer-draftable"),zR=Symbol.for("immer-state");function FR(e){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var BR=Object.getPrototypeOf;function jR(e){return!!e&&!!e[zR]}function UR(e){return!!e&&(GR(e)||Array.isArray(e)||!!e[NR]||!!e.constructor?.[NR]||XR(e)||ZR(e))}var VR=Object.prototype.constructor.toString();function GR(e){if(!e||"object"!==typeof e)return!1;const t=BR(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===VR}function HR(e,t){0===$R(e)?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function $R(e){const t=e[zR];return t?t.type_:Array.isArray(e)?1:XR(e)?2:ZR(e)?3:0}function WR(e,t){return 2===$R(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function qR(e,t,n){const r=$R(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function XR(e){return e instanceof Map}function ZR(e){return e instanceof Set}function KR(e){return e.copy_||e.base_}function YR(e,t){if(XR(e))return new Map(e);if(ZR(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=GR(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[zR];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const i=n[r],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(BR(e),t)}{const t=BR(e);if(null!==t&&n)return{...e};const r=Object.create(t);return Object.assign(r,e)}}function JR(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return eO(e)||jR(e)||!UR(e)||($R(e)>1&&(e.set=e.add=e.clear=e.delete=QR),Object.freeze(e),t&&Object.entries(e).forEach(e=>{let[t,n]=e;return JR(n,!0)})),e}function QR(){FR(2)}function eO(e){return Object.isFrozen(e)}var tO,nO={};function rO(e){const t=nO[e];return t||FR(0),t}function iO(){return tO}function oO(e,t){t&&(rO("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function sO(e){aO(e),e.drafts_.forEach(cO),e.drafts_=null}function aO(e){e===tO&&(tO=e.parent_)}function lO(e){return tO={drafts_:[],parent_:tO,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function cO(e){const t=e[zR];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function uO(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[zR].modified_&&(sO(t),FR(4)),UR(e)&&(e=hO(t,e),t.parent_||fO(t,e)),t.patches_&&rO("Patches").generateReplacementPatches_(n[zR].base_,e,t.patches_,t.inversePatches_)):e=hO(t,n,[]),sO(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==DR?e:void 0}function hO(e,t,n){if(eO(t))return t;const r=t[zR];if(!r)return HR(t,(i,o)=>dO(e,r,t,i,o,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return fO(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let i=t,o=!1;3===r.type_&&(i=new Set(t),t.clear(),o=!0),HR(i,(i,s)=>dO(e,r,t,i,s,n,o)),fO(e,t,!1),n&&e.patches_&&rO("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function dO(e,t,n,r,i,o,s){if(jR(i)){const s=hO(e,i,o&&t&&3!==t.type_&&!WR(t.assigned_,r)?o.concat(r):void 0);if(qR(n,r,s),!jR(s))return;e.canAutoFreeze_=!1}else s&&n.add(i);if(UR(i)&&!eO(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;hO(e,i),t&&t.scope_.parent_||"symbol"===typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||fO(e,i)}}function fO(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&JR(t,n)}var pO={get(e,t){if(t===zR)return e;const n=KR(e);if(!WR(n,t))return function(e,t,n){const r=_O(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!UR(r)?r:r===gO(e.base_,t)?(vO(e),e.copy_[t]=xO(r,e)):r},has:(e,t)=>t in KR(e),ownKeys:e=>Reflect.ownKeys(KR(e)),set(e,t,n){const r=_O(KR(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=gO(KR(e),t),i=r?.[zR];if(i&&i.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}(n,r)&&(void 0!==n||WR(e.base_,t)))return!0;vO(e),yO(e)}return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==gO(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,vO(e),yO(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=KR(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){FR(11)},getPrototypeOf:e=>BR(e.base_),setPrototypeOf(){FR(12)}},mO={};function gO(e,t){const n=e[zR];return(n?KR(n):e)[t]}function _O(e,t){if(!(t in e))return;let n=BR(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=BR(n)}}function yO(e){e.modified_||(e.modified_=!0,e.parent_&&yO(e.parent_))}function vO(e){e.copy_||(e.copy_=YR(e.base_,e.scope_.immer_.useStrictShallowCopy_))}HR(pO,(e,t)=>{mO[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),mO.deleteProperty=function(e,t){return mO.set.call(this,e,t,void 0)},mO.set=function(e,t,n){return pO.set.call(this,e[0],t,n,e[0])};function xO(e,t){const n=XR(e)?rO("MapSet").proxyMap_(e,t):ZR(e)?rO("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:iO(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,o=pO;n&&(i=[r],o=mO);const{revoke:s,proxy:a}=Proxy.revocable(i,o);return r.draft_=a,r.revoke_=s,a}(e,t);return(t?t.scope_:iO()).drafts_.push(n),n}function bO(e){return jR(e)||FR(10),wO(e)}function wO(e){if(!UR(e)||eO(e))return e;const t=e[zR];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=YR(e,t.scope_.immer_.useStrictShallowCopy_)}else n=YR(e,!0);return HR(n,(e,t)=>{qR(n,e,wO(t))}),t&&(t.finalized_=!1),n}var SO=new class{constructor(e){var t=this;this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"===typeof e&&"function"!==typeof t){const n=t;t=e;const r=this;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;for(var i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];return r.produce(e,e=>t.call(this,e,...o))}}let r;if("function"!==typeof t&&FR(6),void 0!==n&&"function"!==typeof n&&FR(7),UR(e)){const i=lO(this),o=xO(e,void 0);let s=!0;try{r=t(o),s=!1}finally{s?sO(i):aO(i)}return oO(i,n),uO(r,i)}if(!e||"object"!==typeof e){if(r=t(e),void 0===r&&(r=e),r===DR&&(r=void 0),this.autoFreeze_&&JR(r,!0),n){const t=[],i=[];rO("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}FR(1)},this.produceWithPatches=(e,n)=>{if("function"===typeof e)return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return t.produceWithPatches(n,t=>e(t,...i))};let r,i;const o=this.produce(e,n,(e,t)=>{r=e,i=t});return[o,r,i]},"boolean"===typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"===typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){UR(e)||FR(8),jR(e)&&(e=bO(e));const t=lO(this),n=xO(e,void 0);return n[zR].isManual_=!0,aO(t),n}finishDraft(e,t){const n=e&&e[zR];n&&n.isManual_||FR(9);const{scope_:r}=n;return oO(r,t),uO(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=rO("Patches").applyPatches_;return jR(e)?r(e,t):this.produce(e,e=>r(e,t))}},EO=SO.produce;SO.produceWithPatches.bind(SO),SO.setAutoFreeze.bind(SO),SO.setUseStrictShallowCopy.bind(SO),SO.applyPatches.bind(SO),SO.createDraft.bind(SO),SO.finishDraft.bind(SO);var TO="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"===typeof arguments[0]?kR:kR.apply(null,arguments)};"undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;function AO(e,t){function n(){if(t){let n=t(...arguments);if(!n)throw new Error(xL(0));return{type:e,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:e,payload:arguments.length<=0?void 0:arguments[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>MR(t)&&t.type===e,n}var CO=class e extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return super.concat.apply(this,t)}prepend(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return 1===n.length&&Array.isArray(n[0])?new e(...n[0].concat(this)):new e(...n.concat(this))}};function PO(e){return UR(e)?EO(e,()=>{}):e}function IO(e,t,n){return e.has(t)?e.get(t):e.set(t,n(t)).get(t)}var kO="RTK_autoBatch",MO=e=>t=>{setTimeout(t,e)},RO=e=>function(t){const{autoBatch:n=!0}=t??{};let r=new CO(e);return n&&r.push(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"raf"};return t=>function(){const n=t(...arguments);let r=!0,i=!1,o=!1;const s=new Set,a="tick"===e.type?queueMicrotask:"raf"===e.type?"undefined"!==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:MO(10):"callback"===e.type?e.queueNotification:MO(e.timeout),l=()=>{o=!1,i&&(i=!1,s.forEach(e=>e()))};return Object.assign({},n,{subscribe(e){const t=n.subscribe(()=>r&&e());return s.add(e),()=>{t(),s.delete(e)}},dispatch(e){try{return r=!e?.meta?.[kO],i=!r,i&&(o||(o=!0,a(l))),n.dispatch(e)}finally{r=!0}}})}}("object"===typeof n?n:void 0)),r};function OO(e){const t=function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:i=!0}=e??{};let o=new CO;return t&&(function(e){return"boolean"===typeof e}(t)?o.push(OR):o.push(LR(t.extraArgument))),o},{reducer:n,middleware:r,devTools:i=!0,duplicateMiddlewareCheck:o=!0,preloadedState:s,enhancers:a}=e||{};let l,c;if("function"===typeof n)l=n;else{if(!CR(n))throw new Error(xL(1));l=IR(n)}c="function"===typeof r?r(t):t();let u=kR;i&&(u=TO({trace:!1,..."object"===typeof i&&i}));const h=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>(n,r)=>{const i=e(n,r);let o=()=>{throw new Error(SR(15))};const s={getState:i.getState,dispatch:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o(e,...n)}},a=t.map(e=>e(s));return o=kR(...a)(i.dispatch),{...i,dispatch:o}}}(...c),d=RO(h);return PR(l,s,u(..."function"===typeof a?a(d):d()))}function LO(e){const t={},n=[];let r;const i={addCase(e,n){const r="string"===typeof e?e:e.type;if(!r)throw new Error(xL(28));if(r in t)throw new Error(xL(29));return t[r]=n,i},addMatcher:(e,t)=>(n.push({matcher:e,reducer:t}),i),addDefaultCase:e=>(r=e,i)};return e(i),[t,n,r]}var DO=function(){let e="",t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;for(;t--;)e+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return e};var NO=Symbol.for("rtk-slice-createasyncthunk");function zO(e,t){return`${e}/${t}`}function FO(){let{creators:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=e?.asyncThunk?.[NO];return function(e){const{name:n,reducerPath:r=n}=e;if(!n)throw new Error(xL(11));const i=("function"===typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name](){return e(...arguments)}}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},o=Object.keys(i),s={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},a={addCase(e,t){const n="string"===typeof e?e:e.type;if(!n)throw new Error(xL(12));if(n in s.sliceCaseReducersByType)throw new Error(xL(13));return s.sliceCaseReducersByType[n]=t,a},addMatcher:(e,t)=>(s.sliceMatchers.push({matcher:e,reducer:t}),a),exposeAction:(e,t)=>(s.actionCreators[e]=t,a),exposeCaseReducer:(e,t)=>(s.sliceCaseReducersByName[e]=t,a)};function l(){const[t={},n=[],r]="function"===typeof e.extraReducers?LO(e.extraReducers):[e.extraReducers],i={...t,...s.sliceCaseReducersByType};return function(e,t){let n,[r,i,o]=LO(t);if(function(e){return"function"===typeof e}(e))n=()=>PO(e());else{const t=PO(e);n=()=>t}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n(),t=arguments.length>1?arguments[1]:void 0,s=[r[t.type],...i.filter(e=>{let{matcher:n}=e;return n(t)}).map(e=>{let{reducer:t}=e;return t})];return 0===s.filter(e=>!!e).length&&(s=[o]),s.reduce((e,n)=>{if(n){if(jR(e)){const r=n(e,t);return void 0===r?e:r}if(UR(e))return EO(e,e=>n(e,t));{const r=n(e,t);if(void 0===r){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return r}}return e},e)}return s.getInitialState=n,s}(e.initialState,e=>{for(let t in i)e.addCase(t,i[t]);for(let t of s.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of n)e.addMatcher(t.matcher,t.reducer);r&&e.addDefaultCase(r)})}o.forEach(r=>{const o=i[r],s={reducerName:r,type:zO(n,r),createNotation:"function"===typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(o)?function(e,t,n){let r,i,{type:o,reducerName:s,createNotation:a}=e;if("reducer"in t){if(a&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(t))throw new Error(xL(17));r=t.reducer,i=t.prepare}else r=t;n.addCase(o,r).exposeCaseReducer(s,r).exposeAction(s,i?AO(o,i):AO(o))}(s,o,a):function(e,t,n,r){let{type:i,reducerName:o}=e;if(!r)throw new Error(xL(18));const{payloadCreator:s,fulfilled:a,pending:l,rejected:c,settled:u,options:h}=t,d=r(i,s,h);n.exposeAction(o,d),a&&n.addCase(d.fulfilled,a);l&&n.addCase(d.pending,l);c&&n.addCase(d.rejected,c);u&&n.addMatcher(d.settled,u);n.exposeCaseReducer(o,{fulfilled:a||UO,pending:l||UO,rejected:c||UO,settled:u||UO})}(s,o,a,t)});const c=e=>e,u=new Map,h=new WeakMap;let d;function f(e,t){return d||(d=l()),d(e,t)}function p(){return d||(d=l()),d.getInitialState()}function m(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function r(e){let i=e[t];return"undefined"===typeof i&&n&&(i=IO(h,r,p)),i}function i(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;const r=IO(u,n,()=>new WeakMap);return IO(r,t,()=>{const r={};for(const[i,o]of Object.entries(e.selectors??{}))r[i]=BO(o,t,()=>IO(h,t,p),n);return r})}return{reducerPath:t,getSelectors:i,get selectors(){return i(r)},selectSlice:r}}const g={name:n,reducer:f,actions:s.actionCreators,caseReducers:s.sliceCaseReducersByName,getInitialState:p,...m(r),injectInto(e){let{reducerPath:t,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=t??r;return e.inject({reducerPath:i,reducer:f},n),{...g,...m(i,!0)}}};return g}}function BO(e,t,n,r){function i(i){let o=t(i);"undefined"===typeof o&&r&&(o=n());for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];return e(o,...a)}return i.unwrapped=e,i}var jO=FO();function UO(){}var VO="listener",GO="completed",HO="cancelled",$O=`task-${HO}`,WO=`task-${GO}`,qO=`${VO}-${HO}`,XO=`${VO}-${GO}`,ZO=class{constructor(e){this.code=e,this.message=`task ${HO} (reason: ${e})`}name="TaskAbortError";message},KO=(e,t)=>{if("function"!==typeof e)throw new TypeError(xL(32))},YO=()=>{},JO=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:YO;return e.catch(t),e},QO=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),eL=(e,t)=>{const n=e.signal;n.aborted||("reason"in n||Object.defineProperty(n,"reason",{enumerable:!0,value:t,configurable:!0,writable:!0}),e.abort(t))},tL=e=>{if(e.aborted){const{reason:t}=e;throw new ZO(t)}};function nL(e,t){let n=YO;return new Promise((r,i)=>{const o=()=>i(new ZO(e.reason));e.aborted?o():(n=QO(e,o),t.finally(()=>n()).then(r,i))}).finally(()=>{n=YO})}var rL=e=>t=>JO(nL(e,t).then(t=>(tL(e),t))),iL=e=>{const t=rL(e);return e=>t(new Promise(t=>setTimeout(t,e)))},{assign:oL}=Object,sL={},aL="listenerMiddleware",lL=(e,t)=>(n,r)=>{KO(n);const i=new AbortController;var o;o=i,QO(e,()=>eL(o,e.reason));const s=(async(e,t)=>{try{return await Promise.resolve(),{status:"ok",value:await e()}}catch(n){return{status:n instanceof ZO?"cancelled":"rejected",error:n}}finally{t?.()}})(async()=>{tL(e),tL(i.signal);const t=await n({pause:rL(i.signal),delay:iL(i.signal),signal:i.signal});return tL(i.signal),t},()=>eL(i,WO));return r?.autoJoin&&t.push(s.catch(YO)),{result:rL(e)(s),cancel(){eL(i,$O)}}},cL=(e,t)=>(n,r)=>JO((async(n,r)=>{tL(t);let i=()=>{};const o=new Promise((t,r)=>{let o=e({predicate:n,effect:(e,n)=>{n.unsubscribe(),t([e,n.getState(),n.getOriginalState()])}});i=()=>{o(),r()}}),s=[o];null!=r&&s.push(new Promise(e=>setTimeout(e,r,null)));try{const e=await nL(t,Promise.race(s));return tL(t),e}finally{i()}})(n,r)),uL=e=>{let{type:t,actionCreator:n,matcher:r,predicate:i,effect:o}=e;if(t)i=AO(t).match;else if(n)t=n.type,i=n.match;else if(r)i=r;else if(!i)throw new Error(xL(21));return KO(o),{predicate:i,type:t,effect:o}},hL=oL(e=>{const{type:t,predicate:n,effect:r}=uL(e);return{id:DO(),effect:r,type:t,predicate:n,pending:new Set,unsubscribe:()=>{throw new Error(xL(22))}}},{withTypes:()=>hL}),dL=(e,t)=>{const{type:n,effect:r,predicate:i}=uL(t);return Array.from(e.values()).find(e=>("string"===typeof n?e.type===n:e.predicate===i)&&e.effect===r)},fL=e=>{e.pending.forEach(e=>{eL(e,qO)})},pL=(e,t,n)=>{try{e(t,n)}catch(r){setTimeout(()=>{throw r},0)}},mL=oL(AO(`${aL}/add`),{withTypes:()=>mL}),gL=AO(`${aL}/removeAll`),_L=oL(AO(`${aL}/remove`),{withTypes:()=>_L}),yL=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.error(`${aL}/error`,...t)},vL=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new Map,{extra:n,onError:r=yL}=e;KO(r);const i=e=>(e=>(e.unsubscribe=()=>t.delete(e.id),t.set(e.id,e),t=>{e.unsubscribe(),t?.cancelActive&&fL(e)}))(dL(t,e)??hL(e));oL(i,{withTypes:()=>i});const o=e=>{const n=dL(t,e);return n&&(n.unsubscribe(),e.cancelActive&&fL(n)),!!n};oL(o,{withTypes:()=>o});const s=async(e,o,s,a)=>{const l=new AbortController,c=cL(i,l.signal),u=[];try{e.pending.add(l),await Promise.resolve(e.effect(o,oL({},s,{getOriginalState:a,condition:(e,t)=>c(e,t).then(Boolean),take:c,delay:iL(l.signal),pause:rL(l.signal),extra:n,signal:l.signal,fork:lL(l.signal,u),unsubscribe:e.unsubscribe,subscribe:()=>{t.set(e.id,e)},cancelActiveListeners:()=>{e.pending.forEach((e,t,n)=>{e!==l&&(eL(e,qO),n.delete(e))})},cancel:()=>{eL(l,qO),e.pending.delete(l)},throwIfCancelled:()=>{tL(l.signal)}})))}catch(h){h instanceof ZO||pL(r,h,{raisedBy:"effect"})}finally{await Promise.all(u),eL(l,XO),e.pending.delete(l)}},a=(e=>()=>{e.forEach(fL),e.clear()})(t);return{middleware:e=>n=>l=>{if(!MR(l))return n(l);if(mL.match(l))return i(l.payload);if(gL.match(l))return void a();if(_L.match(l))return o(l.payload);let c=e.getState();const u=()=>{if(c===sL)throw new Error(xL(23));return c};let h;try{if(h=n(l),t.size>0){const n=e.getState(),i=Array.from(t.values());for(const t of i){let i=!1;try{i=t.predicate(l,n,c)}catch(d){i=!1,pL(r,d,{raisedBy:"predicate"})}i&&s(t,l,e,u)}}}finally{c=sL}return h},startListening:i,stopListening:o,clearListeners:a}};Symbol.for("rtk-state-proxy-original");function xL(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}function bL(e,t){if(t){var n=Number.parseInt(t,10);if(!sR(n))return null===e||void 0===e?void 0:e[n]}}var wL=jO({name:"options",initialState:{chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},reducers:{createEventEmitter:e=>{null==e.eventEmitter&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),SL=wL.reducer,{createEventEmitter:EL}=wL.actions;n(7237);function TL(e){e()}var AL={notify(){},get:()=>[]};function CL(e,t){let n,r=AL,i=0,o=!1;function s(){c.onStateChange&&c.onStateChange()}function a(){i++,n||(n=t?t.addNestedSub(s):e.subscribe(s),r=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){TL(()=>{let t=e;for(;t;)t.callback(),t=t.next})},get(){const t=[];let n=e;for(;n;)t.push(n),n=n.next;return t},subscribe(n){let r=!0;const i=t={callback:n,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){r&&null!==e&&(r=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}())}function l(){i--,n&&0===i&&(n(),n=void 0,r.clear(),r=AL)}const c={addNestedSub:function(e){a();const t=r.subscribe(e);let n=!1;return()=>{n||(n=!0,t(),l())}},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:s,isSubscribed:function(){return o},trySubscribe:function(){o||(o=!0,a())},tryUnsubscribe:function(){o&&(o=!1,l())},getListeners:()=>r};return c}var PL=(()=>!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement))(),IL=(()=>"undefined"!==typeof navigator&&"ReactNative"===navigator.product)(),kL=(()=>PL||IL?i.useLayoutEffect:i.useEffect)();Object.defineProperty,Object.getOwnPropertyNames,Object.getOwnPropertySymbols,Object.getOwnPropertyDescriptor,Object.getPrototypeOf,Object.prototype;var ML=Symbol.for("react-redux-context"),RL="undefined"!==typeof globalThis?globalThis:{};function OL(){if(!i.createContext)return{};const e=RL[ML]??=new Map;let t=e.get(i.createContext);return t||(t=i.createContext(null),e.set(i.createContext,t)),t}var LL=OL();var DL=function(e){const{children:t,context:n,serverState:r,store:o}=e,s=i.useMemo(()=>{const e=CL(o);return{store:o,subscription:e,getServerState:r?()=>r:void 0}},[o,r]),a=i.useMemo(()=>o.getState(),[o]);kL(()=>{const{subscription:e}=s;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),a!==o.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}},[s,a]);const l=n||LL;return i.createElement(l.Provider,{value:s},t)};var NL=Symbol.for("immer-nothing"),zL=Symbol.for("immer-draftable"),FL=Symbol.for("immer-state");function BL(e){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var jL=Object.getPrototypeOf;function UL(e){return!!e&&!!e[FL]}function VL(e){return!!e&&(HL(e)||Array.isArray(e)||!!e[zL]||!!e.constructor?.[zL]||ZL(e)||KL(e))}var GL=Object.prototype.constructor.toString();function HL(e){if(!e||"object"!==typeof e)return!1;const t=jL(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===GL}function $L(e,t){0===WL(e)?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function WL(e){const t=e[FL];return t?t.type_:Array.isArray(e)?1:ZL(e)?2:KL(e)?3:0}function qL(e,t){return 2===WL(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function XL(e,t,n){const r=WL(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function ZL(e){return e instanceof Map}function KL(e){return e instanceof Set}function YL(e){return e.copy_||e.base_}function JL(e,t){if(ZL(e))return new Map(e);if(KL(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=HL(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[FL];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const i=n[r],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(jL(e),t)}{const t=jL(e);if(null!==t&&n)return{...e};const r=Object.create(t);return Object.assign(r,e)}}function QL(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return tD(e)||UL(e)||!VL(e)||(WL(e)>1&&(e.set=e.add=e.clear=e.delete=eD),Object.freeze(e),t&&Object.entries(e).forEach(e=>{let[t,n]=e;return QL(n,!0)})),e}function eD(){BL(2)}function tD(e){return Object.isFrozen(e)}var nD,rD={};function iD(e){const t=rD[e];return t||BL(0),t}function oD(){return nD}function sD(e,t){t&&(iD("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function aD(e){lD(e),e.drafts_.forEach(uD),e.drafts_=null}function lD(e){e===nD&&(nD=e.parent_)}function cD(e){return nD={drafts_:[],parent_:nD,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function uD(e){const t=e[FL];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function hD(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[FL].modified_&&(aD(t),BL(4)),VL(e)&&(e=dD(t,e),t.parent_||pD(t,e)),t.patches_&&iD("Patches").generateReplacementPatches_(n[FL].base_,e,t.patches_,t.inversePatches_)):e=dD(t,n,[]),aD(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==NL?e:void 0}function dD(e,t,n){if(tD(t))return t;const r=t[FL];if(!r)return $L(t,(i,o)=>fD(e,r,t,i,o,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return pD(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let i=t,o=!1;3===r.type_&&(i=new Set(t),t.clear(),o=!0),$L(i,(i,s)=>fD(e,r,t,i,s,n,o)),pD(e,t,!1),n&&e.patches_&&iD("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function fD(e,t,n,r,i,o,s){if(UL(i)){const s=dD(e,i,o&&t&&3!==t.type_&&!qL(t.assigned_,r)?o.concat(r):void 0);if(XL(n,r,s),!UL(s))return;e.canAutoFreeze_=!1}else s&&n.add(i);if(VL(i)&&!tD(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;dD(e,i),t&&t.scope_.parent_||"symbol"===typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||pD(e,i)}}function pD(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&QL(t,n)}var mD={get(e,t){if(t===FL)return e;const n=YL(e);if(!qL(n,t))return function(e,t,n){const r=yD(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!VL(r)?r:r===_D(e.base_,t)?(xD(e),e.copy_[t]=bD(r,e)):r},has:(e,t)=>t in YL(e),ownKeys:e=>Reflect.ownKeys(YL(e)),set(e,t,n){const r=yD(YL(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=_D(YL(e),t),i=r?.[FL];if(i&&i.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}(n,r)&&(void 0!==n||qL(e.base_,t)))return!0;xD(e),vD(e)}return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==_D(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,xD(e),vD(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=YL(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){BL(11)},getPrototypeOf:e=>jL(e.base_),setPrototypeOf(){BL(12)}},gD={};function _D(e,t){const n=e[FL];return(n?YL(n):e)[t]}function yD(e,t){if(!(t in e))return;let n=jL(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=jL(n)}}function vD(e){e.modified_||(e.modified_=!0,e.parent_&&vD(e.parent_))}function xD(e){e.copy_||(e.copy_=JL(e.base_,e.scope_.immer_.useStrictShallowCopy_))}$L(mD,(e,t)=>{gD[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),gD.deleteProperty=function(e,t){return gD.set.call(this,e,t,void 0)},gD.set=function(e,t,n){return mD.set.call(this,e[0],t,n,e[0])};function bD(e,t){const n=ZL(e)?iD("MapSet").proxyMap_(e,t):KL(e)?iD("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:oD(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,o=mD;n&&(i=[r],o=gD);const{revoke:s,proxy:a}=Proxy.revocable(i,o);return r.draft_=a,r.revoke_=s,a}(e,t);return(t?t.scope_:oD()).drafts_.push(n),n}function wD(e){if(!VL(e)||tD(e))return e;const t=e[FL];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=JL(e,t.scope_.immer_.useStrictShallowCopy_)}else n=JL(e,!0);return $L(n,(e,t)=>{XL(n,e,wD(t))}),t&&(t.finalized_=!1),n}var SD=new class{constructor(e){var t=this;this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"===typeof e&&"function"!==typeof t){const n=t;t=e;const r=this;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;for(var i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];return r.produce(e,e=>t.call(this,e,...o))}}let r;if("function"!==typeof t&&BL(6),void 0!==n&&"function"!==typeof n&&BL(7),VL(e)){const i=cD(this),o=bD(e,void 0);let s=!0;try{r=t(o),s=!1}finally{s?aD(i):lD(i)}return sD(i,n),hD(r,i)}if(!e||"object"!==typeof e){if(r=t(e),void 0===r&&(r=e),r===NL&&(r=void 0),this.autoFreeze_&&QL(r,!0),n){const t=[],i=[];iD("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}BL(1)},this.produceWithPatches=(e,n)=>{if("function"===typeof e)return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return t.produceWithPatches(n,t=>e(t,...i))};let r,i;const o=this.produce(e,n,(e,t)=>{r=e,i=t});return[o,r,i]},"boolean"===typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"===typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){VL(e)||BL(8),UL(e)&&(e=function(e){UL(e)||BL(10);return wD(e)}(e));const t=cD(this),n=bD(e,void 0);return n[FL].isManual_=!0,lD(t),n}finishDraft(e,t){const n=e&&e[FL];n&&n.isManual_||BL(9);const{scope_:r}=n;return sD(r,t),hD(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=iD("Patches").applyPatches_;return UL(e)?r(e,t):this.produce(e,e=>r(e,t))}};SD.produce,SD.produceWithPatches.bind(SD),SD.setAutoFreeze.bind(SD),SD.setUseStrictShallowCopy.bind(SD),SD.applyPatches.bind(SD),SD.createDraft.bind(SD),SD.finishDraft.bind(SD);var ED={active:!1,index:null,dataKey:void 0,coordinate:void 0},TD=jO({name:"tooltip",initialState:{itemInteraction:{click:ED,hover:ED},axisInteraction:{click:ED,hover:ED},keyboardInteraction:ED,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},reducers:{addTooltipEntrySettings(e,t){e.tooltipItemPayloads.push(t.payload)},removeTooltipEntrySettings(e,t){var n=bO(e).tooltipItemPayloads.indexOf(t.payload);n>-1&&e.tooltipItemPayloads.splice(n,1)},setTooltipSettingsState(e,t){e.settings=t.payload},setActiveMouseOverItemIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=t.payload.activeIndex,e.itemInteraction.hover.dataKey=t.payload.activeDataKey,e.itemInteraction.hover.coordinate=t.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,t){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=t.payload.activeIndex,e.itemInteraction.click.dataKey=t.payload.activeDataKey,e.itemInteraction.click.coordinate=t.payload.activeCoordinate},setMouseOverAxisIndex(e,t){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=t.payload.activeIndex,e.axisInteraction.hover.dataKey=t.payload.activeDataKey,e.axisInteraction.hover.coordinate=t.payload.activeCoordinate},setMouseClickAxisIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=t.payload.activeIndex,e.axisInteraction.click.dataKey=t.payload.activeDataKey,e.axisInteraction.click.coordinate=t.payload.activeCoordinate},setSyncInteraction(e,t){e.syncInteraction=t.payload},setKeyboardInteraction(e,t){e.keyboardInteraction.active=t.payload.active,e.keyboardInteraction.index=t.payload.activeIndex,e.keyboardInteraction.coordinate=t.payload.activeCoordinate,e.keyboardInteraction.dataKey=t.payload.activeDataKey}}}),{addTooltipEntrySettings:AD,removeTooltipEntrySettings:CD,setTooltipSettingsState:PD,setActiveMouseOverItemIndex:ID,mouseLeaveItem:kD,mouseLeaveChart:MD,setActiveClickItemIndex:RD,setMouseOverAxisIndex:OD,setMouseClickAxisIndex:LD,setSyncInteraction:DD,setKeyboardInteraction:ND}=TD.actions,zD=TD.reducer,FD=jO({name:"chartData",initialState:{chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},reducers:{setChartData(e,t){if(e.chartData=t.payload,null==t.payload)return e.dataStartIndex=0,void(e.dataEndIndex=0);t.payload.length>0&&e.dataEndIndex!==t.payload.length-1&&(e.dataEndIndex=t.payload.length-1)},setComputedData(e,t){e.computedData=t.payload},setDataStartEndIndexes(e,t){var{startIndex:n,endIndex:r}=t.payload;null!=n&&(e.dataStartIndex=n),null!=r&&(e.dataEndIndex=r)}}}),{setChartData:BD,setDataStartEndIndexes:jD,setComputedData:UD}=FD.actions,VD=FD.reducer,GD=jO({name:"chartLayout",initialState:{layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},reducers:{setLayout(e,t){e.layoutType=t.payload},setChartSize(e,t){e.width=t.payload.width,e.height=t.payload.height},setMargin(e,t){e.margin.top=t.payload.top,e.margin.right=t.payload.right,e.margin.bottom=t.payload.bottom,e.margin.left=t.payload.left},setScale(e,t){e.scale=t.payload}}}),{setMargin:HD,setLayout:$D,setChartSize:WD,setScale:qD}=GD.actions,XD=GD.reducer;function ZD(e){if("function"!==typeof e)throw new TypeError(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected a function, instead received "+typeof e)}var KD=e=>Array.isArray(e)?e:[e];function YD(e){const t=Array.isArray(e[0])?e[0]:e;return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected all items to be functions, instead received the following types: ";if(!e.every(e=>"function"===typeof e)){const n=e.map(e=>"function"===typeof e?`function ${e.name||"unnamed"}()`:typeof e).join(", ");throw new TypeError(`${t}[${n}]`)}}(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}Symbol(),Object.getPrototypeOf({});var JD="undefined"!==typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}};function QD(){return{s:0,v:void 0,o:null,p:null}}function eN(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={s:0,v:void 0,o:null,p:null};const{resultEqualityCheck:r}=t;let i,o=0;function s(){let t=n;const{length:s}=arguments;for(let e=0,n=s;e<n;e++){const n=arguments[e];if("function"===typeof n||"object"===typeof n&&null!==n){let e=t.o;null===e&&(t.o=e=new WeakMap);const r=e.get(n);void 0===r?(t=QD(),e.set(n,t)):t=r}else{let e=t.p;null===e&&(t.p=e=new Map);const r=e.get(n);void 0===r?(t=QD(),e.set(n,t)):t=r}}const a=t;let l;if(1===t.s)l=t.v;else if(l=e.apply(null,arguments),o++,r){const e=i?.deref?.()??i;null!=e&&r(e,l)&&(l=e,0!==o&&o--);i="object"===typeof l&&null!==l||"function"===typeof l?new JD(l):l}return a.s=1,a.v=l,l}return s.clearCache=()=>{n={s:0,v:void 0,o:null,p:null},s.resetResultsCount()},s.resultsCount=()=>o,s.resetResultsCount=()=>{o=0},s}function tN(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i="function"===typeof e?{memoize:e,memoizeOptions:n}:e,o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r,o=0,s=0,a={},l=t.pop();"object"===typeof l&&(a=l,l=t.pop()),ZD(l,`createSelector expects an output function after the inputs, but received: [${typeof l}]`);const c={...i,...a},{memoize:u,memoizeOptions:h=[],argsMemoize:d=eN,argsMemoizeOptions:f=[],devModeChecks:p={}}=c,m=KD(h),g=KD(f),_=YD(t),y=u(function(){return o++,l.apply(null,arguments)},...m);const v=d(function(){s++;const e=function(e,t){const n=[],{length:r}=e;for(let i=0;i<r;i++)n.push(e[i].apply(null,t));return n}(_,arguments);return r=y.apply(null,e),r},...g);return Object.assign(v,{resultFunc:l,memoizedResultFunc:y,dependencies:_,dependencyRecomputations:()=>s,resetDependencyRecomputations:()=>{s=0},lastResult:()=>r,recomputations:()=>o,resetRecomputations:()=>{o=0},memoize:u,argsMemoize:d})};return Object.assign(o,{withTypes:()=>o}),o}var nN=tN(eN),rN=Object.assign(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nN;!function(e){if("object"!==typeof e)throw new TypeError(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected an object, instead received "+typeof e)}(e,"createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);const n=Object.keys(e),r=t(n.map(t=>e[t]),function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((e,t,r)=>(e[n[r]]=t,e),{})});return r},{withTypes:()=>rN}),iN=n(8443),oN=(0,i.createContext)(null),sN=e=>e,aN=()=>{var e=(0,i.useContext)(oN);return e?e.store.dispatch:sN},lN=()=>{},cN=()=>lN,uN=(e,t)=>e===t;function hN(e){var t=(0,i.useContext)(oN);return(0,iN.useSyncExternalStoreWithSelector)(t?t.subscription.addNestedSub:cN,t?t.store.getState:lN,t?t.store.getState:lN,t?e:lN,uN)}var dN=n(3821),fN=n.n(dN),pN=e=>e.legend.settings;nN([e=>e.legend.payload,pN],(e,t)=>{var{itemSorter:n}=t,r=e.flat(1);return n?fN()(r,n):r});function mN(e,t){if((i=e.length)>1)for(var n,r,i,o=1,s=e[t[0]],a=s.length;o<i;++o)for(r=s,s=e[t[o]],n=0;n<a;++n)s[n][1]+=s[n][0]=isNaN(r[n][1])?r[n][0]:r[n][1]}Array.prototype.slice;function gN(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function _N(e){return function(){return e}}function yN(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n}function vN(e,t){return e[t]}function xN(e){const t=[];return t.key=e,t}function bN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function wN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bN(Object(n),!0).forEach(function(t){SN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bN(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function SN(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var EN=Math.PI/180,TN=e=>180*e/Math.PI,AN=(e,t,n,r)=>({x:e+Math.cos(-EN*r)*n,y:t+Math.sin(-EN*r)*n}),CN=(e,t)=>{var{x:n,y:r}=e,{cx:i,cy:o}=t,s=((e,t)=>{var{x:n,y:r}=e,{x:i,y:o}=t;return Math.sqrt((n-i)**2+(r-o)**2)})({x:n,y:r},{x:i,y:o});if(s<=0)return{radius:s,angle:0};var a=(n-i)/s,l=Math.acos(a);return r>o&&(l=2*Math.PI-l),{radius:s,angle:TN(l),angleInRadian:l}},PN=(e,t)=>{var{startAngle:n,endAngle:r}=t,i=Math.floor(n/360),o=Math.floor(r/360);return e+360*Math.min(i,o)},IN=(e,t)=>{var{x:n,y:r}=e,{radius:i,angle:o}=CN({x:n,y:r},t),{innerRadius:s,outerRadius:a}=t;if(i<s||i>a)return null;if(0===i)return null;var l,{startAngle:c,endAngle:u}=(e=>{var{startAngle:t,endAngle:n}=e,r=Math.floor(t/360),i=Math.floor(n/360),o=Math.min(r,i);return{startAngle:t-360*o,endAngle:n-360*o}})(t),h=o;if(c<=u){for(;h>u;)h-=360;for(;h<c;)h+=360;l=h>=c&&h<=u}else{for(;h>c;)h-=360;for(;h<u;)h+=360;l=h>=u&&h<=c}return l?wN(wN({},t),{},{radius:i,angle:PN(h,t)}):null};function kN(e,t,n){return Array.isArray(e)&&e&&t+n!==0?e.slice(t,n+1):e}function MN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function RN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?MN(Object(n),!0).forEach(function(t){ON(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MN(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ON(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LN(e,t,n){return gR(e)||gR(t)?n:cR(t)?iR()(e,t,n):"function"===typeof t?t(e):n}var DN=(e,t)=>"horizontal"===e&&"xAxis"===t||"vertical"===e&&"yAxis"===t||"centric"===e&&"angleAxis"===t||"radial"===e&&"radiusAxis"===t,NN=(e,t,n,r)=>{if(r)return e.map(e=>e.coordinate);var i,o,s=e.map(e=>(e.coordinate===t&&(i=!0),e.coordinate===n&&(o=!0),e.coordinate));return i||s.push(t),o||s.push(n),s},zN=(e,t,n)=>{if(!e)return null;var{duplicateDomain:r,type:i,range:o,scale:s,realScaleType:a,isCategorical:l,categoricalDomain:c,tickCount:u,ticks:h,niceTicks:d,axisType:f}=e;if(!s)return null;var p="scaleBand"===a&&s.bandwidth?s.bandwidth()/2:2,m=(t||n)&&"category"===i&&s.bandwidth?s.bandwidth()/p:0;if(m="angleAxis"===f&&o&&o.length>=2?2*oR(o[0]-o[1])*m:m,t&&(h||d)){var g=(h||d||[]).map((e,t)=>{var n=r?r.indexOf(e):e;return{coordinate:s(n)+m,value:e,offset:m,index:t}});return g.filter(e=>!sR(e.coordinate))}return l&&c?c.map((e,t)=>({coordinate:s(e)+m,value:e,index:t,offset:m})):s.ticks&&!n&&null!=u?s.ticks(u).map((e,t)=>({coordinate:s(e)+m,value:e,offset:m,index:t})):s.domain().map((e,t)=>({coordinate:s(e)+m,value:r?r[e]:e,index:t,offset:m}))},FN=1e-4,BN={sign:e=>{var t=e.length;if(!(t<=0))for(var n=0,r=e[0].length;n<r;++n)for(var i=0,o=0,s=0;s<t;++s){var a=sR(e[s][n][1])?e[s][n][0]:e[s][n][1];a>=0?(e[s][n][0]=i,e[s][n][1]=i+a,i=e[s][n][1]):(e[s][n][0]=o,e[s][n][1]=o+a,o=e[s][n][1])}},expand:function(e,t){if((r=e.length)>0){for(var n,r,i,o=0,s=e[0].length;o<s;++o){for(i=n=0;n<r;++n)i+=e[n][o][1]||0;if(i)for(n=0;n<r;++n)e[n][o][1]/=i}mN(e,t)}},none:mN,silhouette:function(e,t){if((n=e.length)>0){for(var n,r=0,i=e[t[0]],o=i.length;r<o;++r){for(var s=0,a=0;s<n;++s)a+=e[s][r][1]||0;i[r][1]+=i[r][0]=-a/2}mN(e,t)}},wiggle:function(e,t){if((i=e.length)>0&&(r=(n=e[t[0]]).length)>0){for(var n,r,i,o=0,s=1;s<r;++s){for(var a=0,l=0,c=0;a<i;++a){for(var u=e[t[a]],h=u[s][1]||0,d=(h-(u[s-1][1]||0))/2,f=0;f<a;++f){var p=e[t[f]];d+=(p[s][1]||0)-(p[s-1][1]||0)}l+=h,c+=d*h}n[s-1][1]+=n[s-1][0]=o,l&&(o-=c/l)}n[s-1][1]+=n[s-1][0]=o,mN(e,t)}},positive:e=>{var t=e.length;if(!(t<=0))for(var n=0,r=e[0].length;n<r;++n)for(var i=0,o=0;o<t;++o){var s=sR(e[o][n][1])?e[o][n][0]:e[o][n][1];s>=0?(e[o][n][0]=i,e[o][n][1]=i+s,i=e[o][n][1]):(e[o][n][0]=0,e[o][n][1]=0)}}},jN=(e,t,n)=>{var r=BN[n],i=function(){var e=_N([]),t=yN,n=mN,r=vN;function i(i){var o,s,a=Array.from(e.apply(this,arguments),xN),l=a.length,c=-1;for(const e of i)for(o=0,++c;o<l;++o)(a[o][c]=[0,+r(e,a[o].key,c,i)]).data=e;for(o=0,s=gN(t(a));o<l;++o)a[s[o]].index=o;return n(a,s),a}return i.keys=function(t){return arguments.length?(e="function"===typeof t?t:_N(Array.from(t)),i):e},i.value=function(e){return arguments.length?(r="function"===typeof e?e:_N(+e),i):r},i.order=function(e){return arguments.length?(t=null==e?yN:"function"===typeof e?e:_N(Array.from(e)),i):t},i.offset=function(e){return arguments.length?(n=null==e?mN:e,i):n},i}().keys(t).value((e,t)=>+LN(e,t,0)).order(yN).offset(r);return i(e)};function UN(e){return null==e?void 0:String(e)}function VN(e){var{axis:t,ticks:n,bandSize:r,entry:i,index:o,dataKey:s}=e;if("category"===t.type){if(!t.allowDuplicatedCategory&&t.dataKey&&!gR(i[t.dataKey])){var a=mR(n,"value",i[t.dataKey]);if(a)return a.coordinate+r/2}return n[o]?n[o].coordinate+r/2:null}var l=LN(i,gR(s)?t.dataKey:s);return gR(l)?null:t.scale(l)}var GN=e=>{var{axis:t,ticks:n,offset:r,bandSize:i,entry:o,index:s}=e;if("category"===t.type)return n[s]?n[s].coordinate+r:null;var a=LN(o,t.dataKey,t.scale.domain()[s]);return gR(a)?null:t.scale(a)-i/2+r},HN=(e,t,n)=>{if(null!=e)return(e=>[e[0]===1/0?0:e[0],e[1]===-1/0?0:e[1]])(Object.keys(e).reduce((r,i)=>{var o=e[i],{stackedData:s}=o,a=s.reduce((e,r)=>{var i=(e=>{var t=e.flat(2).filter(lR);return[Math.min(...t),Math.max(...t)]})(kN(r,t,n));return[Math.min(e[0],i[0]),Math.max(e[1],i[1])]},[1/0,-1/0]);return[Math.min(a[0],r[0]),Math.max(a[1],r[1])]},[1/0,-1/0]))},$N=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,WN=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,qN=(e,t,n)=>{if(e&&e.scale&&e.scale.bandwidth){var r=e.scale.bandwidth();if(!n||r>0)return r}if(e&&t&&t.length>=2){for(var i=fN()(t,e=>e.coordinate),o=1/0,s=1,a=i.length;s<a;s++){var l=i[s],c=i[s-1];o=Math.min((l.coordinate||0)-(c.coordinate||0),o)}return o===1/0?0:o}return n?void 0:0};function XN(e){var{tooltipEntrySettings:t,dataKey:n,payload:r,value:i,name:o}=e;return RN(RN({},t),{},{dataKey:n,payload:r,value:i,name:o})}function ZN(e,t){return e?String(e):"string"===typeof t?t:void 0}var KN=e=>e.layout.width,YN=e=>e.layout.height,JN=e=>e.layout.scale,QN=e=>e.layout.margin,ez=nN(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),tz=nN(e=>e.cartesianAxis.yAxis,e=>Object.values(e));function nz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nz(Object(n),!0).forEach(function(t){iz(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nz(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function iz(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oz=nN([KN,YN,QN,e=>e.brush.height,ez,tz,pN,e=>e.legend.size],(e,t,n,r,i,o,s,a)=>{var l=o.reduce((e,t)=>{var{orientation:n}=t;if(!t.mirror&&!t.hide){var r="number"===typeof t.width?t.width:60;return rz(rz({},e),{},{[n]:e[n]+r})}return e},{left:n.left||0,right:n.right||0}),c=i.reduce((e,t)=>{var{orientation:n}=t;return t.mirror||t.hide?e:rz(rz({},e),{},{[n]:iR()(e,"".concat(n))+t.height})},{top:n.top||0,bottom:n.bottom||0}),u=rz(rz({},c),l),h=u.bottom;u.bottom+=r,u=((e,t,n)=>{if(t&&n){var{width:r,height:i}=n,{align:o,verticalAlign:s,layout:a}=t;if(("vertical"===a||"horizontal"===a&&"middle"===s)&&"center"!==o&&lR(e[o]))return RN(RN({},e),{},{[o]:e[o]+(r||0)});if(("horizontal"===a||"vertical"===a&&"center"===o)&&"middle"!==s&&lR(e[s]))return RN(RN({},e),{},{[s]:e[s]+(i||0)})}return e})(u,s,a);var d=e-u.left-u.right,f=t-u.top-u.bottom;return rz(rz({brushBottom:h},u),{},{width:Math.max(d,0),height:Math.max(f,0)})}),sz=nN(oz,e=>({x:e.left,y:e.top,width:e.width,height:e.height})),az=nN(KN,YN,(e,t)=>({x:0,y:0,width:e,height:t})),lz=(0,i.createContext)(null),cz=()=>null!=(0,i.useContext)(lz),uz=e=>e.brush,hz=nN([uz,oz,QN],(e,t,n)=>({height:e.height,x:lR(e.x)?e.x:t.left,y:lR(e.y)?e.y:t.top+t.height+t.brushBottom-((null===n||void 0===n?void 0:n.bottom)||0),width:lR(e.width)?e.width:t.width})),dz=()=>{var e,t=cz(),n=hN(sz),r=hN(hz),i=null===(e=hN(uz))||void 0===e?void 0:e.padding;return t&&r&&i?{width:r.width-i.left-i.right,height:r.height-i.top-i.bottom,x:i.left,y:i.top}:n},fz={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},pz=()=>{var e;return null!==(e=hN(oz))&&void 0!==e?e:fz},mz=()=>hN(KN),gz=()=>hN(YN),_z=e=>e.layout.layoutType,yz=()=>hN(_z),vz=n(9859),xz=n.n(vz);function bz(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function wz(e,t){switch(arguments.length){case 0:break;case 1:"function"===typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"===typeof t?this.interpolator(t):this.range(t)}return this}class Sz extends Map{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Cz;if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[n,r]of e)this.set(n,r)}get(e){return super.get(Ez(this,e))}has(e){return super.has(Ez(this,e))}set(e,t){return super.set(Tz(this,e),t)}delete(e){return super.delete(Az(this,e))}}Set;function Ez(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)?n.get(i):t}function Tz(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)?n.get(i):(n.set(i,t),t)}function Az(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)&&(t=n.get(i),n.delete(i)),t}function Cz(e){return null!==e&&"object"===typeof e?e.valueOf():e}const Pz=Symbol("implicit");function Iz(){var e=new Sz,t=[],n=[],r=Pz;function i(i){let o=e.get(i);if(void 0===o){if(r!==Pz)return r;e.set(i,o=t.push(i)-1)}return n[o%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Sz;for(const r of n)e.has(r)||e.set(r,t.push(r)-1);return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return Iz(t,n).unknown(r)},bz.apply(i,arguments),i}function kz(){var e,t,n=Iz().unknown(void 0),r=n.domain,i=n.range,o=0,s=1,a=!1,l=0,c=0,u=.5;function h(){var n=r().length,h=s<o,d=h?s:o,f=h?o:s;e=(f-d)/Math.max(1,n-l+2*c),a&&(e=Math.floor(e)),d+=(f-d-e*(n-l))*u,t=e*(1-l),a&&(d=Math.round(d),t=Math.round(t));var p=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),o=new Array(i);++r<i;)o[r]=e+r*n;return o}(n).map(function(t){return d+e*t});return i(h?p.reverse():p)}return delete n.unknown,n.domain=function(e){return arguments.length?(r(e),h()):r()},n.range=function(e){return arguments.length?([o,s]=e,o=+o,s=+s,h()):[o,s]},n.rangeRound=function(e){return[o,s]=e,o=+o,s=+s,a=!0,h()},n.bandwidth=function(){return t},n.step=function(){return e},n.round=function(e){return arguments.length?(a=!!e,h()):a},n.padding=function(e){return arguments.length?(l=Math.min(1,c=+e),h()):l},n.paddingInner=function(e){return arguments.length?(l=Math.min(1,e),h()):l},n.paddingOuter=function(e){return arguments.length?(c=+e,h()):c},n.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),h()):u},n.copy=function(){return kz(r(),[o,s]).round(a).paddingInner(l).paddingOuter(c).align(u)},bz.apply(h(),arguments)}function Mz(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Mz(t())},e}function Rz(){return Mz(kz.apply(null,arguments).paddingInner(1))}const Oz=Math.sqrt(50),Lz=Math.sqrt(10),Dz=Math.sqrt(2);function Nz(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),s=o>=Oz?10:o>=Lz?5:o>=Dz?2:1;let a,l,c;return i<0?(c=Math.pow(10,-i)/s,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=n&&n<2?Nz(e,t,2*n):[a,l,c]}function zz(e,t,n){if(!((n=+n)>0))return[];if((e=+e)===(t=+t))return[e];const r=t<e,[i,o,s]=r?Nz(t,e,n):Nz(e,t,n);if(!(o>=i))return[];const a=o-i+1,l=new Array(a);if(r)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(i+c)/-s;else for(let c=0;c<a;++c)l[c]=(i+c)*s;return l}function Fz(e,t,n){return Nz(e=+e,t=+t,n=+n)[2]}function Bz(e,t,n){n=+n;const r=(t=+t)<(e=+e),i=r?Fz(t,e,n):Fz(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function jz(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Uz(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Vz(e){let t,n,r;function i(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<o){if(0!==t(r,r))return o;do{const t=i+o>>>1;n(e[t],r)<0?i=t+1:o=t}while(i<o)}return i}return 2!==e.length?(t=jz,n=(t,n)=>jz(e(t),n),r=(t,n)=>e(t)-n):(t=e===jz||e===Uz?e:Gz,n=e,r=e),{left:i,center:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=i(e,t,n,(arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length)-1);return o>n&&r(e[o-1],t)>-r(e[o],t)?o-1:o},right:function(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<o){if(0!==t(r,r))return o;do{const t=i+o>>>1;n(e[t],r)<=0?i=t+1:o=t}while(i<o)}return i}}}function Gz(){return 0}function Hz(e){return null===e?NaN:+e}const $z=Vz(jz),Wz=$z.right,qz=($z.left,Vz(Hz).center,Wz);function Xz(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Zz(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Kz(){}var Yz=.7,Jz=1/Yz,Qz="\\s*([+-]?\\d+)\\s*",eF="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",tF="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",nF=/^#([0-9a-f]{3,8})$/,rF=new RegExp(`^rgb\\(${Qz},${Qz},${Qz}\\)$`),iF=new RegExp(`^rgb\\(${tF},${tF},${tF}\\)$`),oF=new RegExp(`^rgba\\(${Qz},${Qz},${Qz},${eF}\\)$`),sF=new RegExp(`^rgba\\(${tF},${tF},${tF},${eF}\\)$`),aF=new RegExp(`^hsl\\(${eF},${tF},${tF}\\)$`),lF=new RegExp(`^hsla\\(${eF},${tF},${tF},${eF}\\)$`),cF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function uF(){return this.rgb().formatHex()}function hF(){return this.rgb().formatRgb()}function dF(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=nF.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?fF(t):3===n?new gF(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?pF(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?pF(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=rF.exec(e))?new gF(t[1],t[2],t[3],1):(t=iF.exec(e))?new gF(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=oF.exec(e))?pF(t[1],t[2],t[3],t[4]):(t=sF.exec(e))?pF(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=aF.exec(e))?wF(t[1],t[2]/100,t[3]/100,1):(t=lF.exec(e))?wF(t[1],t[2]/100,t[3]/100,t[4]):cF.hasOwnProperty(e)?fF(cF[e]):"transparent"===e?new gF(NaN,NaN,NaN,0):null}function fF(e){return new gF(e>>16&255,e>>8&255,255&e,1)}function pF(e,t,n,r){return r<=0&&(e=t=n=NaN),new gF(e,t,n,r)}function mF(e,t,n,r){return 1===arguments.length?function(e){return e instanceof Kz||(e=dF(e)),e?new gF((e=e.rgb()).r,e.g,e.b,e.opacity):new gF}(e):new gF(e,t,n,null==r?1:r)}function gF(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function _F(){return`#${bF(this.r)}${bF(this.g)}${bF(this.b)}`}function yF(){const e=vF(this.opacity);return`${1===e?"rgb(":"rgba("}${xF(this.r)}, ${xF(this.g)}, ${xF(this.b)}${1===e?")":`, ${e})`}`}function vF(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function xF(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function bF(e){return((e=xF(e))<16?"0":"")+e.toString(16)}function wF(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new EF(e,t,n,r)}function SF(e){if(e instanceof EF)return new EF(e.h,e.s,e.l,e.opacity);if(e instanceof Kz||(e=dF(e)),!e)return new EF;if(e instanceof EF)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(s=t===o?(n-r)/a+6*(n<r):n===o?(r-t)/a+2:(t-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new EF(s,a,l,e.opacity)}function EF(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function TF(e){return(e=(e||0)%360)<0?e+360:e}function AF(e){return Math.max(0,Math.min(1,e||0))}function CF(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function PF(e,t,n,r,i){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*r+s*i)/6}Xz(Kz,dF,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:uF,formatHex:uF,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return SF(this).formatHsl()},formatRgb:hF,toString:hF}),Xz(gF,mF,Zz(Kz,{brighter(e){return e=null==e?Jz:Math.pow(Jz,e),new gF(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Yz:Math.pow(Yz,e),new gF(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new gF(xF(this.r),xF(this.g),xF(this.b),vF(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_F,formatHex:_F,formatHex8:function(){return`#${bF(this.r)}${bF(this.g)}${bF(this.b)}${bF(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:yF,toString:yF})),Xz(EF,function(e,t,n,r){return 1===arguments.length?SF(e):new EF(e,t,n,null==r?1:r)},Zz(Kz,{brighter(e){return e=null==e?Jz:Math.pow(Jz,e),new EF(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Yz:Math.pow(Yz,e),new EF(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new gF(CF(e>=240?e-240:e+120,i,r),CF(e,i,r),CF(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new EF(TF(this.h),AF(this.s),AF(this.l),vF(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=vF(this.opacity);return`${1===e?"hsl(":"hsla("}${TF(this.h)}, ${100*AF(this.s)}%, ${100*AF(this.l)}%${1===e?")":`, ${e})`}`}}));const IF=e=>()=>e;function kF(e,t){return function(n){return e+n*t}}function MF(e){return 1===(e=+e)?RF:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):IF(isNaN(t)?n:t)}}function RF(e,t){var n=t-e;return n?kF(e,n):IF(isNaN(e)?t:e)}const OF=function e(t){var n=MF(t);function r(e,t){var r=n((e=mF(e)).r,(t=mF(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),s=RF(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=s(t),e+""}}return r.gamma=e,r}(1);function LF(e){return function(t){var n,r,i=t.length,o=new Array(i),s=new Array(i),a=new Array(i);for(n=0;n<i;++n)r=mF(t[n]),o[n]=r.r||0,s[n]=r.g||0,a[n]=r.b||0;return o=e(o),s=e(s),a=e(a),r.opacity=1,function(e){return r.r=o(e),r.g=s(e),r.b=a(e),r+""}}}LF(function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],s=r>0?e[r-1]:2*i-o,a=r<t-1?e[r+2]:2*o-i;return PF((n-r/t)*t,s,i,o,a)}}),LF(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],o=e[r%t],s=e[(r+1)%t],a=e[(r+2)%t];return PF((n-r/t)*t,i,o,s,a)}});function DF(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),s=new Array(r);for(n=0;n<i;++n)o[n]=GF(e[n],t[n]);for(;n<r;++n)s[n]=t[n];return function(e){for(n=0;n<i;++n)s[n]=o[n](e);return s}}function NF(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function zF(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function FF(e,t){var n,r={},i={};for(n in null!==e&&"object"===typeof e||(e={}),null!==t&&"object"===typeof t||(t={}),t)n in e?r[n]=GF(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var BF=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,jF=new RegExp(BF.source,"g");function UF(e,t){var n,r,i,o=BF.lastIndex=jF.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=BF.exec(e))&&(r=jF.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:zF(n,r)})),o=jF.lastIndex;return o<t.length&&(i=t.slice(o),a[s]?a[s]+=i:a[++s]=i),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)a[(n=l[r]).i]=n.x(e);return a.join("")})}function VF(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function GF(e,t){var n,r=typeof t;return null==t||"boolean"===r?IF(t):("number"===r?zF:"string"===r?(n=dF(t))?(t=n,OF):UF:t instanceof dF?OF:t instanceof Date?NF:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?VF:Array.isArray(t)?DF:"function"!==typeof t.valueOf&&"function"!==typeof t.toString||isNaN(t)?FF:zF)(e,t)}function HF(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function $F(e){return+e}var WF=[0,1];function qF(e){return e}function XF(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function ZF(e,t,n){var r=e[0],i=e[1],o=t[0],s=t[1];return i<r?(r=XF(i,r),o=n(s,o)):(r=XF(r,i),o=n(o,s)),function(e){return o(r(e))}}function KF(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=XF(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(t){var n=qz(e,t,1,r)-1;return o[n](i[n](t))}}function YF(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function JF(){var e,t,n,r,i,o,s=WF,a=WF,l=GF,c=qF;function u(){var e=Math.min(s.length,a.length);return c!==qF&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(s[0],s[e-1])),r=e>2?KF:ZF,i=o=null,h}function h(t){return null==t||isNaN(t=+t)?n:(i||(i=r(s.map(e),a,l)))(e(c(t)))}return h.invert=function(n){return c(t((o||(o=r(a,s.map(e),zF)))(n)))},h.domain=function(e){return arguments.length?(s=Array.from(e,$F),u()):s.slice()},h.range=function(e){return arguments.length?(a=Array.from(e),u()):a.slice()},h.rangeRound=function(e){return a=Array.from(e),l=HF,u()},h.clamp=function(e){return arguments.length?(c=!!e||qF,u()):c!==qF},h.interpolate=function(e){return arguments.length?(l=e,u()):l},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,u()}}function QF(){return JF()(qF,qF)}var eB,tB=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nB(e){if(!(t=tB.exec(e)))throw new Error("invalid format: "+e);var t;return new rB({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function rB(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function iB(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function oB(e){return(e=iB(Math.abs(e)))?e[1]:NaN}function sB(e,t){var n=iB(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}nB.prototype=rB.prototype,rB.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const aB={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>sB(100*e,t),r:sB,s:function(e,t){var n=iB(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(eB=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+iB(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function lB(e){return e}var cB,uB,hB,dB=Array.prototype.map,fB=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function pB(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?lB:(t=dB.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],s=0,a=t[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(e.substring(i-=a,i+a)),!((l+=a+1)>r));)a=t[s=(s+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?lB:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(dB.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"\u2212":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=nB(e)).fill,n=e.align,h=e.sign,d=e.symbol,f=e.zero,p=e.width,m=e.comma,g=e.precision,_=e.trim,y=e.type;"n"===y?(m=!0,y="g"):aB[y]||(void 0===g&&(g=12),_=!0,y="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var v="$"===d?i:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===d?o:/[%p]/.test(y)?l:"",b=aB[y],w=/[defgprs%]/.test(y);function S(e){var i,o,l,d=v,S=x;if("c"===y)S=b(e)+S,e="";else{var E=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:b(Math.abs(e),g),_&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),E&&0===+e&&"+"!==h&&(E=!1),d=(E?"("===h?h:c:"-"===h||"("===h?"":h)+d,S=("s"===y?fB[8+eB/3]:"")+S+(E&&"("===h?")":""),w)for(i=-1,o=e.length;++i<o;)if(48>(l=e.charCodeAt(i))||l>57){S=(46===l?s+e.slice(i+1):e.slice(i))+S,e=e.slice(0,i);break}}m&&!f&&(e=r(e,1/0));var T=d.length+e.length+S.length,A=T<p?new Array(p-T+1).join(t):"";switch(m&&f&&(e=r(A+e,A.length?p-S.length:1/0),A=""),n){case"<":e=d+e+S+A;break;case"=":e=d+A+e+S;break;case"^":e=A.slice(0,T=A.length>>1)+d+e+S+A.slice(T);break;default:e=A+d+e+S}return a(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),S.toString=function(){return e+""},S}return{format:h,formatPrefix:function(e,t){var n=h(((e=nB(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(oB(t)/3))),i=Math.pow(10,-r),o=fB[8+r/3];return function(e){return n(i*e)+o}}}}function mB(e,t,n,r){var i,o=Bz(e,t,n);switch((r=nB(null==r?",f":r)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(oB(t)/3)))-oB(Math.abs(e)))}(o,s))||(r.precision=i),hB(r,s);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,oB(t)-oB(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-oB(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return uB(r)}function gB(e){var t=e.domain;return e.ticks=function(e){var n=t();return zz(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return mB(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,o=t(),s=0,a=o.length-1,l=o[s],c=o[a],u=10;for(c<l&&(i=l,l=c,c=i,i=s,s=a,a=i);u-- >0;){if((i=Fz(l,c,n))===r)return o[s]=l,o[a]=c,t(o);if(i>0)l=Math.floor(l/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,c=Math.floor(c*i)/i}r=i}return e},e}function _B(){var e=QF();return e.copy=function(){return YF(e,_B())},bz.apply(e,arguments),gB(e)}function yB(e){var t;function n(e){return null==e||isNaN(e=+e)?t:e}return n.invert=n,n.domain=n.range=function(t){return arguments.length?(e=Array.from(t,$F),n):e.slice()},n.unknown=function(e){return arguments.length?(t=e,n):t},n.copy=function(){return yB(e).unknown(t)},e=arguments.length?Array.from(e,$F):[0,1],gB(n)}function vB(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],s=e[i];return s<o&&(n=r,r=i,i=n,n=o,o=s,s=n),e[r]=t.floor(o),e[i]=t.ceil(s),e}function xB(e){return Math.log(e)}function bB(e){return Math.exp(e)}function wB(e){return-Math.log(-e)}function SB(e){return-Math.exp(-e)}function EB(e){return isFinite(e)?+("1e"+e):e<0?0:e}function TB(e){return(t,n)=>-e(-t,n)}function AB(e){const t=e(xB,bB),n=t.domain;let r,i,o=10;function s(){return r=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(o),i=function(e){return 10===e?EB:e===Math.E?Math.exp:t=>Math.pow(e,t)}(o),n()[0]<0?(r=TB(r),i=TB(i),e(wB,SB)):e(xB,bB),t}return t.base=function(e){return arguments.length?(o=+e,s()):o},t.domain=function(e){return arguments.length?(n(e),s()):n()},t.ticks=e=>{const t=n();let s=t[0],a=t[t.length-1];const l=a<s;l&&([s,a]=[a,s]);let c,u,h=r(s),d=r(a);const f=null==e?10:+e;let p=[];if(!(o%1)&&d-h<f){if(h=Math.floor(h),d=Math.ceil(d),s>0){for(;h<=d;++h)for(c=1;c<o;++c)if(u=h<0?c/i(-h):c*i(h),!(u<s)){if(u>a)break;p.push(u)}}else for(;h<=d;++h)for(c=o-1;c>=1;--c)if(u=h>0?c/i(-h):c*i(h),!(u<s)){if(u>a)break;p.push(u)}2*p.length<f&&(p=zz(s,a,f))}else p=zz(h,d,Math.min(d-h,f)).map(i);return l?p.reverse():p},t.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===o?"s":","),"function"!==typeof n&&(o%1||null!=(n=nB(n)).precision||(n.trim=!0),n=uB(n)),e===1/0)return n;const s=Math.max(1,o*e/t.ticks().length);return e=>{let t=e/i(Math.round(r(e)));return t*o<o-.5&&(t*=o),t<=s?n(e):""}},t.nice=()=>n(vB(n(),{floor:e=>i(Math.floor(r(e))),ceil:e=>i(Math.ceil(r(e)))})),t}function CB(){const e=AB(JF()).domain([1,10]);return e.copy=()=>YF(e,CB()).base(e.base()),bz.apply(e,arguments),e}function PB(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function IB(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function kB(e){var t=1,n=e(PB(t),IB(t));return n.constant=function(n){return arguments.length?e(PB(t=+n),IB(t)):t},gB(n)}function MB(){var e=kB(JF());return e.copy=function(){return YF(e,MB()).constant(e.constant())},bz.apply(e,arguments)}function RB(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function OB(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function LB(e){return e<0?-e*e:e*e}function DB(e){var t=e(qF,qF),n=1;return t.exponent=function(t){return arguments.length?1===(n=+t)?e(qF,qF):.5===n?e(OB,LB):e(RB(n),RB(1/n)):n},gB(t)}function NB(){var e=DB(JF());return e.copy=function(){return YF(e,NB()).exponent(e.exponent())},bz.apply(e,arguments),e}function zB(){return NB.apply(null,arguments).exponent(.5)}function FB(e){return Math.sign(e)*e*e}function BB(){var e,t=QF(),n=[0,1],r=!1;function i(n){var i=function(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}(t(n));return isNaN(i)?e:r?Math.round(i):i}return i.invert=function(e){return t.invert(FB(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain()},i.range=function(e){return arguments.length?(t.range((n=Array.from(e,$F)).map(FB)),i):n.slice()},i.rangeRound=function(e){return i.range(e).round(!0)},i.round=function(e){return arguments.length?(r=!!e,i):r},i.clamp=function(e){return arguments.length?(t.clamp(e),i):t.clamp()},i.unknown=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return BB(t.domain(),n).round(r).clamp(t.clamp()).unknown(e)},bz.apply(i,arguments),gB(i)}function jB(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function UB(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function VB(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jz;if(e===jz)return GB;if("function"!==typeof e)throw new TypeError("compare is not a function");return(t,n)=>{const r=e(t,n);return r||0===r?r:(0===e(n,n))-(0===e(t,t))}}function GB(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:e>t?1:0)}function HB(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=arguments.length>4?arguments[4]:void 0;if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(e.length-1,r)),!(n<=t&&t<=r))return e;for(i=void 0===i?GB:VB(i);r>n;){if(r-n>600){const o=r-n+1,s=t-n+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);HB(e,t,Math.max(n,Math.floor(t-s*l/o+c)),Math.min(r,Math.floor(t+(o-s)*l/o+c)),i)}const o=e[t];let s=n,a=r;for($B(e,n,t),i(e[r],o)>0&&$B(e,n,r);s<a;){for($B(e,s,a),++s,--a;i(e[s],o)<0;)++s;for(;i(e[a],o)>0;)--a}0===i(e[n],o)?$B(e,n,a):(++a,$B(e,a,r)),a<=t&&(n=a+1),t<=a&&(r=a-1)}return e}function $B(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function WB(e,t,n){if(e=Float64Array.from(function*(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n)),(r=e.length)&&!isNaN(t=+t)){if(t<=0||r<2)return UB(e);if(t>=1)return jB(e);var r,i=(r-1)*t,o=Math.floor(i),s=jB(HB(e,o).subarray(0,o+1));return s+(UB(e.subarray(o+1))-s)*(i-o)}}function qB(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Hz;if((r=e.length)&&!isNaN(t=+t)){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),s=+n(e[o],o,e);return s+(+n(e[o+1],o+1,e)-s)*(i-o)}}function XB(){var e,t=[],n=[],r=[];function i(){var e=0,i=Math.max(1,n.length);for(r=new Array(i-1);++e<i;)r[e-1]=qB(t,e/i);return o}function o(t){return null==t||isNaN(t=+t)?e:n[qz(r,t)]}return o.invertExtent=function(e){var i=n.indexOf(e);return i<0?[NaN,NaN]:[i>0?r[i-1]:t[0],i<r.length?r[i]:t[t.length-1]]},o.domain=function(e){if(!arguments.length)return t.slice();t=[];for(let n of e)null==n||isNaN(n=+n)||t.push(n);return t.sort(jz),i()},o.range=function(e){return arguments.length?(n=Array.from(e),i()):n.slice()},o.unknown=function(t){return arguments.length?(e=t,o):e},o.quantiles=function(){return r.slice()},o.copy=function(){return XB().domain(t).range(n).unknown(e)},bz.apply(o,arguments)}function ZB(){var e,t=0,n=1,r=1,i=[.5],o=[0,1];function s(t){return null!=t&&t<=t?o[qz(i,t,0,r)]:e}function a(){var e=-1;for(i=new Array(r);++e<r;)i[e]=((e+1)*n-(e-r)*t)/(r+1);return s}return s.domain=function(e){return arguments.length?([t,n]=e,t=+t,n=+n,a()):[t,n]},s.range=function(e){return arguments.length?(r=(o=Array.from(e)).length-1,a()):o.slice()},s.invertExtent=function(e){var s=o.indexOf(e);return s<0?[NaN,NaN]:s<1?[t,i[0]]:s>=r?[i[r-1],n]:[i[s-1],i[s]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return i.slice()},s.copy=function(){return ZB().domain([t,n]).range(o).unknown(e)},bz.apply(gB(s),arguments)}function KB(){var e,t=[.5],n=[0,1],r=1;function i(i){return null!=i&&i<=i?n[qz(t,i,0,r)]:e}return i.domain=function(e){return arguments.length?(t=Array.from(e),r=Math.min(t.length,n.length-1),i):t.slice()},i.range=function(e){return arguments.length?(n=Array.from(e),r=Math.min(t.length,n.length-1),i):n.slice()},i.invertExtent=function(e){var r=n.indexOf(e);return[t[r-1],t[r]]},i.unknown=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return KB().domain(t).range(n).unknown(e)},bz.apply(i,arguments)}!function(e){cB=pB(e),uB=cB.format,hB=cB.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});const YB=1e3,JB=6e4,QB=36e5,ej=864e5,tj=6048e5,nj=2592e6,rj=31536e6,ij=new Date,oj=new Date;function sj(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=t=>(e(t=new Date(+t)),t),i.ceil=n=>(e(n=new Date(n-1)),t(n,1),e(n),n),i.round=e=>{const t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=(e,n)=>(t(e=new Date(+e),null==n?1:Math.floor(n)),e),i.range=(n,r,o)=>{const s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r)||!(o>0))return s;let a;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=n=>sj(t=>{if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)},(e,r)=>{if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}),n&&(i.count=(t,r)=>(ij.setTime(+t),oj.setTime(+r),e(ij),e(oj),Math.floor(n(ij,oj))),i.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?t=>r(t)%e===0:t=>i.count(0,t)%e===0):i:null)),i}const aj=sj(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);aj.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?sj(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):aj:null);aj.range;const lj=sj(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*YB)},(e,t)=>(t-e)/YB,e=>e.getUTCSeconds()),cj=(lj.range,sj(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*YB)},(e,t)=>{e.setTime(+e+t*JB)},(e,t)=>(t-e)/JB,e=>e.getMinutes())),uj=(cj.range,sj(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*JB)},(e,t)=>(t-e)/JB,e=>e.getUTCMinutes())),hj=(uj.range,sj(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*YB-e.getMinutes()*JB)},(e,t)=>{e.setTime(+e+t*QB)},(e,t)=>(t-e)/QB,e=>e.getHours())),dj=(hj.range,sj(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*QB)},(e,t)=>(t-e)/QB,e=>e.getUTCHours())),fj=(dj.range,sj(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*JB)/ej,e=>e.getDate()-1)),pj=(fj.range,sj(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ej,e=>e.getUTCDate()-1)),mj=(pj.range,sj(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ej,e=>Math.floor(e/ej)));mj.range;function gj(e){return sj(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+7*t)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*JB)/tj)}const _j=gj(0),yj=gj(1),vj=gj(2),xj=gj(3),bj=gj(4),wj=gj(5),Sj=gj(6);_j.range,yj.range,vj.range,xj.range,bj.range,wj.range,Sj.range;function Ej(e){return sj(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+7*t)},(e,t)=>(t-e)/tj)}const Tj=Ej(0),Aj=Ej(1),Cj=Ej(2),Pj=Ej(3),Ij=Ej(4),kj=Ej(5),Mj=Ej(6),Rj=(Tj.range,Aj.range,Cj.range,Pj.range,Ij.range,kj.range,Mj.range,sj(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth())),Oj=(Rj.range,sj(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth())),Lj=(Oj.range,sj(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear()));Lj.every=e=>isFinite(e=Math.floor(e))&&e>0?sj(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)}):null;Lj.range;const Dj=sj(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Dj.every=e=>isFinite(e=Math.floor(e))&&e>0?sj(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null;Dj.range;function Nj(e,t,n,r,i,o){const s=[[lj,1,YB],[lj,5,5e3],[lj,15,15e3],[lj,30,3e4],[o,1,JB],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,QB],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,ej],[r,2,1728e5],[n,1,tj],[t,1,nj],[t,3,7776e6],[e,1,rj]];function a(t,n,r){const i=Math.abs(n-t)/r,o=Vz(e=>{let[,,t]=e;return t}).right(s,i);if(o===s.length)return e.every(Bz(t/rj,n/rj,r));if(0===o)return aj.every(Math.max(Bz(t,n,r),1));const[a,l]=s[i/s[o-1][2]<s[o][2]/i?o-1:o];return a.every(l)}return[function(e,t,n){const r=t<e;r&&([e,t]=[t,e]);const i=n&&"function"===typeof n.range?n:a(e,t,n),o=i?i.range(e,+t+1):[];return r?o.reverse():o},a]}const[zj,Fj]=Nj(Dj,Oj,Tj,mj,dj,uj),[Bj,jj]=Nj(Lj,Rj,_j,fj,hj,cj);function Uj(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Vj(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Gj(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var Hj,$j,Wj,qj={"-":"",_:" ",0:"0"},Xj=/^\s*\d+/,Zj=/^%/,Kj=/[\\^$*+?|[\]().{}]/g;function Yj(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function Jj(e){return e.replace(Kj,"\\$&")}function Qj(e){return new RegExp("^(?:"+e.map(Jj).join("|")+")","i")}function eU(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function tU(e,t,n){var r=Xj.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function nU(e,t,n){var r=Xj.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function rU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function iU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function oU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function sU(e,t,n){var r=Xj.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function aU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function lU(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function cU(e,t,n){var r=Xj.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function uU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function hU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function dU(e,t,n){var r=Xj.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function fU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function pU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function mU(e,t,n){var r=Xj.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function gU(e,t,n){var r=Xj.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function _U(e,t,n){var r=Xj.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function yU(e,t,n){var r=Zj.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function vU(e,t,n){var r=Xj.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function xU(e,t,n){var r=Xj.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function bU(e,t){return Yj(e.getDate(),t,2)}function wU(e,t){return Yj(e.getHours(),t,2)}function SU(e,t){return Yj(e.getHours()%12||12,t,2)}function EU(e,t){return Yj(1+fj.count(Lj(e),e),t,3)}function TU(e,t){return Yj(e.getMilliseconds(),t,3)}function AU(e,t){return TU(e,t)+"000"}function CU(e,t){return Yj(e.getMonth()+1,t,2)}function PU(e,t){return Yj(e.getMinutes(),t,2)}function IU(e,t){return Yj(e.getSeconds(),t,2)}function kU(e){var t=e.getDay();return 0===t?7:t}function MU(e,t){return Yj(_j.count(Lj(e)-1,e),t,2)}function RU(e){var t=e.getDay();return t>=4||0===t?bj(e):bj.ceil(e)}function OU(e,t){return e=RU(e),Yj(bj.count(Lj(e),e)+(4===Lj(e).getDay()),t,2)}function LU(e){return e.getDay()}function DU(e,t){return Yj(yj.count(Lj(e)-1,e),t,2)}function NU(e,t){return Yj(e.getFullYear()%100,t,2)}function zU(e,t){return Yj((e=RU(e)).getFullYear()%100,t,2)}function FU(e,t){return Yj(e.getFullYear()%1e4,t,4)}function BU(e,t){var n=e.getDay();return Yj((e=n>=4||0===n?bj(e):bj.ceil(e)).getFullYear()%1e4,t,4)}function jU(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Yj(t/60|0,"0",2)+Yj(t%60,"0",2)}function UU(e,t){return Yj(e.getUTCDate(),t,2)}function VU(e,t){return Yj(e.getUTCHours(),t,2)}function GU(e,t){return Yj(e.getUTCHours()%12||12,t,2)}function HU(e,t){return Yj(1+pj.count(Dj(e),e),t,3)}function $U(e,t){return Yj(e.getUTCMilliseconds(),t,3)}function WU(e,t){return $U(e,t)+"000"}function qU(e,t){return Yj(e.getUTCMonth()+1,t,2)}function XU(e,t){return Yj(e.getUTCMinutes(),t,2)}function ZU(e,t){return Yj(e.getUTCSeconds(),t,2)}function KU(e){var t=e.getUTCDay();return 0===t?7:t}function YU(e,t){return Yj(Tj.count(Dj(e)-1,e),t,2)}function JU(e){var t=e.getUTCDay();return t>=4||0===t?Ij(e):Ij.ceil(e)}function QU(e,t){return e=JU(e),Yj(Ij.count(Dj(e),e)+(4===Dj(e).getUTCDay()),t,2)}function eV(e){return e.getUTCDay()}function tV(e,t){return Yj(Aj.count(Dj(e)-1,e),t,2)}function nV(e,t){return Yj(e.getUTCFullYear()%100,t,2)}function rV(e,t){return Yj((e=JU(e)).getUTCFullYear()%100,t,2)}function iV(e,t){return Yj(e.getUTCFullYear()%1e4,t,4)}function oV(e,t){var n=e.getUTCDay();return Yj((e=n>=4||0===n?Ij(e):Ij.ceil(e)).getUTCFullYear()%1e4,t,4)}function sV(){return"+0000"}function aV(){return"%"}function lV(e){return+e}function cV(e){return Math.floor(+e/1e3)}function uV(e){return new Date(e)}function hV(e){return e instanceof Date?+e:+new Date(+e)}function dV(e,t,n,r,i,o,s,a,l,c){var u=QF(),h=u.invert,d=u.domain,f=c(".%L"),p=c(":%S"),m=c("%I:%M"),g=c("%I %p"),_=c("%a %d"),y=c("%b %d"),v=c("%B"),x=c("%Y");function b(e){return(l(e)<e?f:a(e)<e?p:s(e)<e?m:o(e)<e?g:r(e)<e?i(e)<e?_:y:n(e)<e?v:x)(e)}return u.invert=function(e){return new Date(h(e))},u.domain=function(e){return arguments.length?d(Array.from(e,hV)):d().map(uV)},u.ticks=function(t){var n=d();return e(n[0],n[n.length-1],null==t?10:t)},u.tickFormat=function(e,t){return null==t?b:c(t)},u.nice=function(e){var n=d();return e&&"function"===typeof e.range||(e=t(n[0],n[n.length-1],null==e?10:e)),e?d(vB(n,e)):u},u.copy=function(){return YF(u,dV(e,t,n,r,i,o,s,a,l,c))},u}function fV(){return bz.apply(dV(Bj,jj,Lj,Rj,_j,fj,hj,cj,lj,$j).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function pV(){return bz.apply(dV(zj,Fj,Dj,Oj,Tj,pj,dj,uj,lj,Wj).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function mV(){var e,t,n,r,i,o=0,s=1,a=qF,l=!1;function c(t){return null==t||isNaN(t=+t)?i:a(0===n?.5:(t=(r(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function u(e){return function(t){var n,r;return arguments.length?([n,r]=t,a=e(n,r),c):[a(0),a(1)]}}return c.domain=function(i){return arguments.length?([o,s]=i,e=r(o=+o),t=r(s=+s),n=e===t?0:1/(t-e),c):[o,s]},c.clamp=function(e){return arguments.length?(l=!!e,c):l},c.interpolator=function(e){return arguments.length?(a=e,c):a},c.range=u(GF),c.rangeRound=u(HF),c.unknown=function(e){return arguments.length?(i=e,c):i},function(i){return r=i,e=i(o),t=i(s),n=e===t?0:1/(t-e),c}}function gV(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function _V(){var e=gB(mV()(qF));return e.copy=function(){return gV(e,_V())},wz.apply(e,arguments)}function yV(){var e=AB(mV()).domain([1,10]);return e.copy=function(){return gV(e,yV()).base(e.base())},wz.apply(e,arguments)}function vV(){var e=kB(mV());return e.copy=function(){return gV(e,vV()).constant(e.constant())},wz.apply(e,arguments)}function xV(){var e=DB(mV());return e.copy=function(){return gV(e,xV()).exponent(e.exponent())},wz.apply(e,arguments)}function bV(){return xV.apply(null,arguments).exponent(.5)}function wV(){var e=[],t=qF;function n(n){if(null!=n&&!isNaN(n=+n))return t((qz(e,n,1)-1)/(e.length-1))}return n.domain=function(t){if(!arguments.length)return e.slice();e=[];for(let n of t)null==n||isNaN(n=+n)||e.push(n);return e.sort(jz),n},n.interpolator=function(e){return arguments.length?(t=e,n):t},n.range=function(){return e.map((n,r)=>t(r/(e.length-1)))},n.quantiles=function(t){return Array.from({length:t+1},(n,r)=>WB(e,r/t))},n.copy=function(){return wV(t).domain(e)},wz.apply(n,arguments)}function SV(){var e,t,n,r,i,o,s,a=0,l=.5,c=1,u=1,h=qF,d=!1;function f(e){return isNaN(e=+e)?s:(e=.5+((e=+o(e))-t)*(u*e<u*t?r:i),h(d?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,h=function(e,t){void 0===t&&(t=e,e=GF);for(var n=0,r=t.length-1,i=t[0],o=new Array(r<0?0:r);n<r;)o[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return o[t](e-t)}}(e,[n,r,i]),f):[h(0),h(.5),h(1)]}}return f.domain=function(s){return arguments.length?([a,l,c]=s,e=o(a=+a),t=o(l=+l),n=o(c=+c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),u=t<e?-1:1,f):[a,l,c]},f.clamp=function(e){return arguments.length?(d=!!e,f):d},f.interpolator=function(e){return arguments.length?(h=e,f):h},f.range=p(GF),f.rangeRound=p(HF),f.unknown=function(e){return arguments.length?(s=e,f):s},function(s){return o=s,e=s(a),t=s(l),n=s(c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),u=t<e?-1:1,f}}function EV(){var e=gB(SV()(qF));return e.copy=function(){return gV(e,EV())},wz.apply(e,arguments)}function TV(){var e=AB(SV()).domain([.1,1,10]);return e.copy=function(){return gV(e,TV()).base(e.base())},wz.apply(e,arguments)}function AV(){var e=kB(SV());return e.copy=function(){return gV(e,AV()).constant(e.constant())},wz.apply(e,arguments)}function CV(){var e=DB(SV());return e.copy=function(){return gV(e,CV()).exponent(e.exponent())},wz.apply(e,arguments)}function PV(){return CV.apply(null,arguments).exponent(.5)}!function(e){Hj=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,s=e.shortDays,a=e.months,l=e.shortMonths,c=Qj(i),u=eU(i),h=Qj(o),d=eU(o),f=Qj(s),p=eU(s),m=Qj(a),g=eU(a),_=Qj(l),y=eU(l),v={a:function(e){return s[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return a[e.getMonth()]},c:null,d:bU,e:bU,f:AU,g:zU,G:BU,H:wU,I:SU,j:EU,L:TU,m:CU,M:PU,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:lV,s:cV,S:IU,u:kU,U:MU,V:OU,w:LU,W:DU,x:null,X:null,y:NU,Y:FU,Z:jU,"%":aV},x={a:function(e){return s[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return a[e.getUTCMonth()]},c:null,d:UU,e:UU,f:WU,g:rV,G:oV,H:VU,I:GU,j:HU,L:$U,m:qU,M:XU,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:lV,s:cV,S:ZU,u:KU,U:YU,V:QU,w:eV,W:tV,x:null,X:null,y:nV,Y:iV,Z:sV,"%":aV},b={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=_.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return E(e,t,n,r)},d:hU,e:hU,f:_U,g:aU,G:sU,H:fU,I:fU,j:dU,L:gU,m:uU,M:pU,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=u.get(r[0].toLowerCase()),n+r[0].length):-1},q:cU,Q:vU,s:xU,S:mU,u:nU,U:rU,V:iU,w:tU,W:oU,x:function(e,t,r){return E(e,n,t,r)},X:function(e,t,n){return E(e,r,t,n)},y:aU,Y:sU,Z:lU,"%":yU};function w(e,t){return function(n){var r,i,o,s=[],a=-1,l=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++a<c;)37===e.charCodeAt(a)&&(s.push(e.slice(l,a)),null!=(i=qj[r=e.charAt(++a)])?r=e.charAt(++a):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),s.push(r),l=a+1);return s.push(e.slice(l,a)),s.join("")}}function S(e,t){return function(n){var r,i,o=Gj(1900,void 0,1);if(E(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=Vj(Gj(o.y,0,1))).getUTCDay(),r=i>4||0===i?Aj.ceil(r):Aj(r),r=pj.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=Uj(Gj(o.y,0,1))).getDay(),r=i>4||0===i?yj.ceil(r):yj(r),r=fj.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?Vj(Gj(o.y,0,1)).getUTCDay():Uj(Gj(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Vj(o)):Uj(o)}}function E(e,t,n,r){for(var i,o,s=0,a=t.length,l=n.length;s<a;){if(r>=l)return-1;if(37===(i=t.charCodeAt(s++))){if(i=t.charAt(s++),!(o=b[i in qj?t.charAt(s++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return v.x=w(n,v),v.X=w(r,v),v.c=w(t,v),x.x=w(n,x),x.X=w(r,x),x.c=w(t,x),{format:function(e){var t=w(e+="",v);return t.toString=function(){return e},t},parse:function(e){var t=S(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=w(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=S(e+="",!0);return t.toString=function(){return e},t}}}(e),$j=Hj.format,Hj.parse,Wj=Hj.utcFormat,Hj.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var IV=e=>e.chartData,kV=nN([IV],e=>{var t=null!=e.chartData?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:t,dataStartIndex:0}}),MV=(e,t,n,r)=>r?kV(e):IV(e);function RV(e){return Number.isFinite(e)}function OV(e){return"number"===typeof e&&e>0&&Number.isFinite(e)}function LV(e){if(Array.isArray(e)&&2===e.length){var[t,n]=e;if(RV(t)&&RV(n))return!0}return!1}function DV(e,t,n){return n?e:[Math.min(e[0],t[0]),Math.max(e[1],t[1])]}var NV=n(8210),zV=n.n(NV),FV=e=>e,BV={"@@functional/placeholder":!0},jV=e=>e===BV,UV=e=>function t(){return 0===arguments.length||1===arguments.length&&jV(arguments.length<=0?void 0:arguments[0])?t:e(...arguments)},VV=(e,t)=>1===e?t:UV(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=r.filter(e=>e!==BV).length;return o>=e?t(...r):VV(e-o,UV(function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var o=r.map(e=>jV(e)?n.shift():e);return t(...o,...n)}))}),GV=e=>VV(e.length,e),HV=(e,t)=>{for(var n=[],r=e;r<t;++r)n[r-e]=r;return n},$V=GV((e,t)=>Array.isArray(t)?t.map(e):Object.keys(t).map(e=>t[e]).map(e)),WV=e=>Array.isArray(e)?e.reverse():e.split("").reverse().join(""),qV=e=>{var t=null,n=null;return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t&&i.every((e,n)=>{var r;return e===(null===(r=t)||void 0===r?void 0:r[n])})?n:(t=i,n=e(...i))}};function XV(e){return 0===e?1:Math.floor(new(zV())(e).abs().log(10).toNumber())+1}function ZV(e,t,n){for(var r=new(zV())(e),i=0,o=[];r.lt(t)&&i<1e5;)o.push(r.toNumber()),r=r.add(n),i++;return o}GV((e,t,n)=>{var r=+e;return r+n*(+t-r)}),GV((e,t,n)=>{var r=t-+e;return(n-e)/(r=r||1/0)}),GV((e,t,n)=>{var r=t-+e;return r=r||1/0,Math.max(0,Math.min(1,(n-e)/r))});var KV=e=>{var[t,n]=e,[r,i]=[t,n];return t>n&&([r,i]=[n,t]),[r,i]},YV=(e,t,n)=>{if(e.lte(0))return new(zV())(0);var r=XV(e.toNumber()),i=new(zV())(10).pow(r),o=e.div(i),s=1!==r?.05:.1,a=new(zV())(Math.ceil(o.div(s).toNumber())).add(n).mul(s).mul(i);return t?new(zV())(a.toNumber()):new(zV())(Math.ceil(a.toNumber()))},JV=(e,t,n)=>{var r=new(zV())(1),i=new(zV())(e);if(!i.isint()&&n){var o=Math.abs(e);o<1?(r=new(zV())(10).pow(XV(e)-1),i=new(zV())(Math.floor(i.div(r).toNumber())).mul(r)):o>1&&(i=new(zV())(Math.floor(e)))}else 0===e?i=new(zV())(Math.floor((t-1)/2)):n||(i=new(zV())(Math.floor(e)));var s=Math.floor((t-1)/2),a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t.length)return FV;var r=t.reverse(),i=r[0],o=r.slice(1);return function(){return o.reduce((e,t)=>t(e),i(...arguments))}}($V(e=>i.add(new(zV())(e-s).mul(r)).toNumber()),HV);return a(0,t)},QV=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!Number.isFinite((t-e)/(n-1)))return{step:new(zV())(0),tickMin:new(zV())(0),tickMax:new(zV())(0)};var o,s=YV(new(zV())(t).sub(e).div(n-1),r,i);o=e<=0&&t>=0?new(zV())(0):(o=new(zV())(e).add(t).div(2)).sub(new(zV())(o).mod(s));var a=Math.ceil(o.sub(e).div(s).toNumber()),l=Math.ceil(new(zV())(t).sub(o).div(s).toNumber()),c=a+l+1;return c>n?QV(e,t,n,r,i+1):(c<n&&(l=t>0?l+(n-c):l,a=t>0?a:a+(n-c)),{step:s,tickMin:o.sub(new(zV())(a).mul(s)),tickMax:o.add(new(zV())(l).mul(s))})};var eG=qV(function(e){var[t,n]=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=Math.max(r,2),[s,a]=KV([t,n]);if(s===-1/0||a===1/0){var l=a===1/0?[s,...HV(0,r-1).map(()=>1/0)]:[...HV(0,r-1).map(()=>-1/0),a];return t>n?WV(l):l}if(s===a)return JV(s,r,i);var{step:c,tickMin:u,tickMax:h}=QV(s,a,o,i,0),d=ZV(u,h.add(new(zV())(.1).mul(c)),c);return t>n?WV(d):d}),tG=qV(function(e,t){var[n,r]=e,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],[o,s]=KV([n,r]);if(o===-1/0||s===1/0)return[n,r];if(o===s)return[o];var a=Math.max(t,2),l=YV(new(zV())(s).sub(o).div(a-1),i,0),c=[...ZV(new(zV())(o),new(zV())(s),l),s];return!1===i&&(c=c.map(e=>Math.round(e))),n>r?WV(c):c}),nG=e=>e.rootProps.maxBarSize,rG=e=>e.rootProps.barCategoryGap,iG=e=>e.rootProps.stackOffset,oG=e=>e.options.chartName,sG=e=>e.rootProps.syncId,aG=e=>e.rootProps.syncMethod,lG=e=>e.options.eventEmitter,cG=0,uG="auto",hG=!0,dG=!1,fG=!0,pG=0,mG="auto",gG=!0,_G=5,yG=(e,t)=>{if(e&&t)return null!==e&&void 0!==e&&e.reversed?[t[1],t[0]]:t},vG={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:cG,includeHidden:!1,name:void 0,reversed:!1,scale:uG,tick:hG,tickCount:void 0,ticks:void 0,type:"category",unit:void 0},xG={allowDataOverflow:dG,allowDecimals:!1,allowDuplicatedCategory:fG,dataKey:void 0,domain:void 0,id:pG,includeHidden:!1,name:void 0,reversed:!1,scale:mG,tick:gG,tickCount:_G,ticks:void 0,type:"number",unit:void 0},bG={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,dataKey:void 0,domain:void 0,id:cG,includeHidden:!1,name:void 0,reversed:!1,scale:uG,tick:hG,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},wG={allowDataOverflow:dG,allowDecimals:!1,allowDuplicatedCategory:fG,dataKey:void 0,domain:void 0,id:pG,includeHidden:!1,name:void 0,reversed:!1,scale:mG,tick:gG,tickCount:_G,ticks:void 0,type:"category",unit:void 0},SG=(e,t)=>null!=e.polarAxis.angleAxis[t]?e.polarAxis.angleAxis[t]:"radial"===e.layout.layoutType?bG:vG,EG=(e,t)=>null!=e.polarAxis.radiusAxis[t]?e.polarAxis.radiusAxis[t]:"radial"===e.layout.layoutType?wG:xG,TG=e=>e.polarOptions,AG=nN([KN,YN,oz],function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{top:0,right:0,bottom:0,left:0,width:0,height:0,brushBottom:0};return Math.min(Math.abs(e-(n.left||0)-(n.right||0)),Math.abs(t-(n.top||0)-(n.bottom||0)))/2}),CG=nN([TG,AG],(e,t)=>{if(null!=e)return dR(e.innerRadius,t,0)}),PG=nN([TG,AG],(e,t)=>{if(null!=e)return dR(e.outerRadius,t,.8*t)}),IG=nN([TG],e=>{if(null==e)return[0,0];var{startAngle:t,endAngle:n}=e;return[t,n]}),kG=(nN([SG,IG],yG),nN([AG,CG,PG],(e,t,n)=>{if(null!=e&&null!=t&&null!=n)return[t,n]})),MG=(nN([EG,kG],yG),nN([_z,TG,CG,PG,KN,YN],(e,t,n,r,i,o)=>{if(("centric"===e||"radial"===e)&&null!=t&&null!=n&&null!=r){var{cx:s,cy:a,startAngle:l,endAngle:c}=t;return{cx:dR(s,i,i/2),cy:dR(a,o,o/2),innerRadius:n,outerRadius:r,startAngle:l,endAngle:c,clockWise:!1}}})),RG=(e,t)=>t,OG=(e,t,n)=>n;function LG(e){return null===e||void 0===e?void 0:e.id}var DG=e=>{var t=_z(e);return"horizontal"===t?"xAxis":"vertical"===t?"yAxis":"centric"===t?"angleAxis":"radiusAxis"},NG=e=>e.tooltip.settings.axisId,zG=e=>{var t=DG(e),n=NG(e);return YG(e,t,n)};function FG(e,t,n){var{chartData:r=[]}=t,i=null===n||void 0===n?void 0:n.dataKey,o=new Map;return e.forEach(e=>{var t,n=null!==(t=e.data)&&void 0!==t?t:r;if(null!=n&&0!==n.length){var s=LG(e);n.forEach((t,n)=>{var r,a=null==i?n:String(LN(t,i,null)),l=LN(t,e.dataKey,0);r=o.has(a)?o.get(a):{},Object.assign(r,{[s]:l}),o.set(a,r)})}}),Array.from(o.values())}function BG(e){return null!=e.stackId&&null!=e.dataKey}function jG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function UG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jG(Object(n),!0).forEach(function(t){VG(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function VG(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var GG=[0,"auto"],HG={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},$G=(e,t)=>{var n=e.cartesianAxis.xAxis[t];return null==n?HG:n},WG={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:GG,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:60},qG=(e,t)=>{var n=e.cartesianAxis.yAxis[t];return null==n?WG:n},XG={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},ZG=(e,t)=>{var n=e.cartesianAxis.zAxis[t];return null==n?XG:n},KG=(e,t,n)=>{switch(t){case"xAxis":return $G(e,n);case"yAxis":return qG(e,n);case"zAxis":return ZG(e,n);case"angleAxis":return SG(e,n);case"radiusAxis":return EG(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},YG=(e,t,n)=>{switch(t){case"xAxis":return $G(e,n);case"yAxis":return qG(e,n);case"angleAxis":return SG(e,n);case"radiusAxis":return EG(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},JG=e=>e.graphicalItems.cartesianItems.some(e=>"bar"===e.type)||e.graphicalItems.polarItems.some(e=>"radialBar"===e.type);function QG(e,t){return n=>{switch(e){case"xAxis":return"xAxisId"in n&&n.xAxisId===t;case"yAxis":return"yAxisId"in n&&n.yAxisId===t;case"zAxis":return"zAxisId"in n&&n.zAxisId===t;case"angleAxis":return"angleAxisId"in n&&n.angleAxisId===t;case"radiusAxis":return"radiusAxisId"in n&&n.radiusAxisId===t;default:return!1}}}var eH=e=>e.graphicalItems.cartesianItems,tH=nN([RG,OG],QG),nH=(e,t,n)=>e.filter(n).filter(e=>!0===(null===t||void 0===t?void 0:t.includeHidden)||!e.hide),rH=nN([eH,KG,tH],nH),iH=nN([rH],e=>e.filter(e=>"area"===e.type||"bar"===e.type).filter(BG)),oH=e=>e.filter(e=>!("stackId"in e)||void 0===e.stackId),sH=nN([rH],oH),aH=e=>e.map(e=>e.data).filter(Boolean).flat(1),lH=nN([rH],aH),cH=(e,t)=>{var{chartData:n=[],dataStartIndex:r,dataEndIndex:i}=t;return e.length>0?e:n.slice(r,i+1)},uH=nN([lH,MV],cH),hH=(e,t,n)=>null!=(null===t||void 0===t?void 0:t.dataKey)?e.map(e=>({value:LN(e,t.dataKey)})):n.length>0?n.map(e=>e.dataKey).flatMap(t=>e.map(e=>({value:LN(e,t)}))):e.map(e=>({value:e})),dH=nN([uH,KG,rH],hH);function fH(e,t){switch(e){case"xAxis":return"x"===t.direction;case"yAxis":return"y"===t.direction;default:return!1}}function pH(e){return e.filter(e=>cR(e)||e instanceof Date).map(Number).filter(e=>!1===sR(e))}function mH(e,t,n){return!n||"number"!==typeof t||sR(t)?[]:n.length?pH(n.flatMap(n=>{var r,i,o=LN(e,n.dataKey);if(Array.isArray(o)?[r,i]=o:r=i=o,RV(r)&&RV(i))return[t-r,t+i]})):[]}var gH=nN([iH,MV,zG],FG),_H=(e,t,n)=>{var r=t.reduce((e,t)=>(null==t.stackId||(null==e[t.stackId]&&(e[t.stackId]=[]),e[t.stackId].push(t)),e),{});return Object.fromEntries(Object.entries(r).map(t=>{var[r,i]=t,o=i.map(LG);return[r,{stackedData:jN(e,o,n),graphicalItems:i}]}))},yH=nN([gH,iH,iG],_H),vH=(e,t,n)=>{var{dataStartIndex:r,dataEndIndex:i}=t;if("zAxis"!==n){var o=HN(e,r,i);if(null==o||0!==o[0]||0!==o[1])return o}},xH=nN([yH,IV,RG],vH),bH=(e,t,n,r,i)=>n.length>0?e.flatMap(e=>n.flatMap(n=>{var o,s,a=null===(o=r[n.id])||void 0===o?void 0:o.filter(e=>fH(i,e)),l=LN(e,null!==(s=t.dataKey)&&void 0!==s?s:n.dataKey);return{value:l,errorDomain:mH(e,l,a)}})).filter(Boolean):null!=(null===t||void 0===t?void 0:t.dataKey)?e.map(e=>({value:LN(e,t.dataKey),errorDomain:[]})):e.map(e=>({value:e,errorDomain:[]})),wH=e=>e.errorBars,SH=(e,t,n)=>e.flatMap(e=>t[e.id]).filter(Boolean).filter(e=>fH(n,e)),EH=(nN([sH,wH,RG],SH),nN([uH,KG,sH,wH,RG],bH));function TH(e){var{value:t}=e;if(cR(t)||t instanceof Date)return t}var AH=e=>{var t=e.flatMap(e=>[e.value,e.errorDomain]).flat(1),n=pH(t);if(0!==n.length)return[Math.min(...n),Math.max(...n)]},CH=e=>{var t;if(null==e||!("domain"in e))return GG;if(null!=e.domain)return e.domain;if(null!=e.ticks){if("number"===e.type){var n=pH(e.ticks);return[Math.min(...n),Math.max(...n)]}if("category"===e.type)return e.ticks.map(String)}return null!==(t=null===e||void 0===e?void 0:e.domain)&&void 0!==t?t:GG},PH=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.filter(Boolean);if(0!==r.length){var i=r.flat();return[Math.min(...i),Math.max(...i)]}},IH=e=>e.referenceElements.dots,kH=(e,t,n)=>e.filter(e=>"extendDomain"===e.ifOverflow).filter(e=>"xAxis"===t?e.xAxisId===n:e.yAxisId===n),MH=nN([IH,RG,OG],kH),RH=e=>e.referenceElements.areas,OH=nN([RH,RG,OG],kH),LH=e=>e.referenceElements.lines,DH=nN([LH,RG,OG],kH),NH=(e,t)=>{var n=pH(e.map(e=>"xAxis"===t?e.x:e.y));if(0!==n.length)return[Math.min(...n),Math.max(...n)]},zH=nN(MH,RG,NH),FH=(e,t)=>{var n=pH(e.flatMap(e=>["xAxis"===t?e.x1:e.y1,"xAxis"===t?e.x2:e.y2]));if(0!==n.length)return[Math.min(...n),Math.max(...n)]},BH=nN([OH,RG],FH),jH=(e,t)=>{var n=pH(e.map(e=>"xAxis"===t?e.x:e.y));if(0!==n.length)return[Math.min(...n),Math.max(...n)]},UH=nN(DH,RG,jH),VH=nN(zH,UH,BH,(e,t,n)=>PH(e,n,t)),GH=nN([KG],CH),HH=(e,t,n,r,i,o,s)=>{var a=function(e,t){if(t&&"function"!==typeof e&&Array.isArray(e)&&2===e.length){var n,r,[i,o]=e;if(RV(i))n=i;else if("function"===typeof i)return;if(RV(o))r=o;else if("function"===typeof o)return;var s=[n,r];if(LV(s))return s}}(t,e.allowDataOverflow);return null!=a?a:function(e,t,n){if(n||null!=t){if("function"===typeof e&&null!=t)try{var r=e(t,n);if(LV(r))return DV(r,t,n)}catch(f){}if(Array.isArray(e)&&2===e.length){var i,o,[s,a]=e;if("auto"===s)null!=t&&(i=Math.min(...t));else if(lR(s))i=s;else if("function"===typeof s)try{null!=t&&(i=s(null===t||void 0===t?void 0:t[0]))}catch(p){}else if("string"===typeof s&&$N.test(s)){var l=$N.exec(s);if(null==l||null==t)i=void 0;else{var c=+l[1];i=t[0]-c}}else i=null===t||void 0===t?void 0:t[0];if("auto"===a)null!=t&&(o=Math.max(...t));else if(lR(a))o=a;else if("function"===typeof a)try{null!=t&&(o=a(null===t||void 0===t?void 0:t[1]))}catch(m){}else if("string"===typeof a&&WN.test(a)){var u=WN.exec(a);if(null==u||null==t)o=void 0;else{var h=+u[1];o=t[1]+h}}else o=null===t||void 0===t?void 0:t[1];var d=[i,o];if(LV(d))return null==t?d:DV(d,t,n)}}}(t,"vertical"===o&&"xAxis"===s||"horizontal"===o&&"yAxis"===s?PH(n,i,AH(r)):PH(i,AH(r)),e.allowDataOverflow)},$H=nN([KG,GH,xH,EH,VH,_z,RG],HH),WH=[0,1],qH=(e,t,n,r,i,o,s)=>{if(null!=e&&null!=n&&0!==n.length||void 0!==s){var{dataKey:a,type:l}=e,c=DN(t,o);return c&&null==a?xz()(0,n.length):"category"===l?((e,t,n)=>{var r=e.map(TH).filter(e=>null!=e);return n&&(null==t.dataKey||t.allowDuplicatedCategory&&fR(r))?xz()(0,e.length):t.allowDuplicatedCategory?r:Array.from(new Set(r))})(r,e,c):"expand"===i?WH:s}},XH=nN([KG,_z,uH,dH,iG,RG,$H],qH),ZH=(t,n,r,i,o)=>{if(null!=t){var{scale:s,type:a}=t;if("auto"===s)return"radial"===n&&"radiusAxis"===o?"band":"radial"===n&&"angleAxis"===o?"linear":"category"===a&&i&&(i.indexOf("LineChart")>=0||i.indexOf("AreaChart")>=0||i.indexOf("ComposedChart")>=0&&!r)?"point":"category"===a?"band":"linear";if("string"===typeof s){var l="scale".concat(_R(s));return l in e?l:"point"}}},KH=nN([KG,_z,JG,oG,RG],ZH);function YH(t,n,r,i){if(null!=r&&null!=i){if("function"===typeof t.scale)return t.scale.copy().domain(r).range(i);var o=function(t){if(null!=t){if(t in e)return e[t]();var n="scale".concat(_R(t));return n in e?e[n]():void 0}}(n);if(null!=o){var s=o.domain(r).range(i);return(e=>{var t=e.domain();if(t&&!(t.length<=2)){var n=t.length,r=e.range(),i=Math.min(r[0],r[1])-FN,o=Math.max(r[0],r[1])+FN,s=e(t[0]),a=e(t[n-1]);(s<i||s>o||a<i||a>o)&&e.domain([t[0],t[n-1]])}})(s),s}}}var JH=(e,t,n)=>{var r=CH(t);if("auto"===n||"linear"===n)return null!=t&&t.tickCount&&Array.isArray(r)&&("auto"===r[0]||"auto"===r[1])&&LV(e)?eG(e,t.tickCount,t.allowDecimals):null!=t&&t.tickCount&&"number"===t.type&&LV(e)?tG(e,t.tickCount,t.allowDecimals):void 0},QH=nN([XH,YG,KH],JH),e$=(e,t,n,r)=>{if("angleAxis"!==r&&"number"===(null===e||void 0===e?void 0:e.type)&&LV(t)&&Array.isArray(n)&&n.length>0){var i=t[0],o=n[0],s=t[1],a=n[n.length-1];return[Math.min(i,o),Math.max(s,a)]}return t},t$=nN([KG,XH,QH,RG],e$),n$=nN(dH,KG,(e,t)=>{if(t&&"number"===t.type){var n=1/0,r=Array.from(pH(e.map(e=>e.value))).sort((e,t)=>e-t);if(r.length<2)return 1/0;var i=r[r.length-1]-r[0];if(0===i)return 1/0;for(var o=0;o<r.length-1;o++){var s=r[o+1]-r[o];n=Math.min(n,s)}return n/i}}),r$=nN(n$,_z,rG,oz,(e,t,n,r)=>r,(e,t,n,r,i)=>{if(!RV(e))return 0;var o="vertical"===t?r.height:r.width;if("gap"===i)return e*o/2;if("no-gap"===i){var s=dR(n,e*o),a=e*o/2;return a-s-(a-s)/o*s}return 0}),i$=nN($G,(e,t)=>{var n=$G(e,t);return null==n||"string"!==typeof n.padding?0:r$(e,"xAxis",t,n.padding)},(e,t)=>{var n,r;if(null==e)return{left:0,right:0};var{padding:i}=e;return"string"===typeof i?{left:t,right:t}:{left:(null!==(n=i.left)&&void 0!==n?n:0)+t,right:(null!==(r=i.right)&&void 0!==r?r:0)+t}}),o$=nN(qG,(e,t)=>{var n=qG(e,t);return null==n||"string"!==typeof n.padding?0:r$(e,"yAxis",t,n.padding)},(e,t)=>{var n,r;if(null==e)return{top:0,bottom:0};var{padding:i}=e;return"string"===typeof i?{top:t,bottom:t}:{top:(null!==(n=i.top)&&void 0!==n?n:0)+t,bottom:(null!==(r=i.bottom)&&void 0!==r?r:0)+t}}),s$=nN([oz,i$,hz,uz,(e,t,n)=>n],(e,t,n,r,i)=>{var{padding:o}=r;return i?[o.left,n.width-o.right]:[e.left+t.left,e.left+e.width-t.right]}),a$=nN([oz,_z,o$,hz,uz,(e,t,n)=>n],(e,t,n,r,i,o)=>{var{padding:s}=i;return o?[r.height-s.bottom,s.top]:"horizontal"===t?[e.top+e.height-n.bottom,e.top+n.top]:[e.top+n.top,e.top+e.height-n.bottom]}),l$=(e,t,n,r)=>{var i;switch(t){case"xAxis":return s$(e,n,r);case"yAxis":return a$(e,n,r);case"zAxis":return null===(i=ZG(e,n))||void 0===i?void 0:i.range;case"angleAxis":return IG(e);case"radiusAxis":return kG(e,n);default:return}},c$=nN([KG,l$],yG),u$=nN([KG,KH,t$,c$],YH);nN([rH,wH,RG],SH);function h$(e,t){return e.id<t.id?-1:e.id>t.id?1:0}var d$=(e,t)=>t,f$=(e,t,n)=>n,p$=nN(ez,d$,f$,(e,t,n)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===n).sort(h$)),m$=nN(tz,d$,f$,(e,t,n)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===n).sort(h$)),g$=(e,t)=>({width:e.width,height:t.height}),_$=nN(oz,$G,g$),y$=nN(YN,oz,p$,d$,f$,(e,t,n,r,i)=>{var o,s={};return n.forEach(n=>{var a=g$(t,n);null==o&&(o=((e,t,n)=>{switch(t){case"top":return e.top;case"bottom":return n-e.bottom;default:return 0}})(t,r,e));var l="top"===r&&!i||"bottom"===r&&i;s[n.id]=o-Number(l)*a.height,o+=(l?-1:1)*a.height}),s}),v$=nN(KN,oz,m$,d$,f$,(e,t,n,r,i)=>{var o,s={};return n.forEach(n=>{var a=((e,t)=>({width:"number"===typeof t.width?t.width:60,height:e.height}))(t,n);null==o&&(o=((e,t,n)=>{switch(t){case"left":return e.left;case"right":return n-e.right;default:return 0}})(t,r,e));var l="left"===r&&!i||"right"===r&&i;s[n.id]=o-Number(l)*a.width,o+=(l?-1:1)*a.width}),s}),x$=nN(oz,qG,(e,t)=>({width:"number"===typeof t.width?t.width:60,height:e.height})),b$=(e,t,n)=>{switch(t){case"xAxis":return _$(e,n).width;case"yAxis":return x$(e,n).height;default:return}},w$=(e,t,n,r)=>{if(null!=n){var{allowDuplicatedCategory:i,type:o,dataKey:s}=n,a=DN(e,r),l=t.map(e=>e.value);return s&&a&&"category"===o&&i&&fR(l)?l:void 0}},S$=nN([_z,dH,KG,RG],w$),E$=(e,t,n,r)=>{if(null!=n&&null!=n.dataKey){var{type:i,scale:o}=n;return!DN(e,r)||"number"!==i&&"auto"===o?void 0:t.map(e=>e.value)}},T$=nN([_z,dH,YG,RG],E$),A$=nN([_z,(e,t,n)=>{switch(t){case"xAxis":return $G(e,n);case"yAxis":return qG(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},KH,u$,S$,T$,l$,QH,RG],(e,t,n,r,i,o,s,a,l)=>{if(null==t)return null;var c=DN(e,l);return{angle:t.angle,interval:t.interval,minTickGap:t.minTickGap,orientation:t.orientation,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit,axisType:l,categoricalDomain:o,duplicateDomain:i,isCategorical:c,niceTicks:a,range:s,realScaleType:n,scale:r}}),C$=nN([_z,YG,KH,u$,QH,l$,S$,T$,RG],(e,t,n,r,i,o,s,a,l)=>{if(null!=t&&null!=r){var c=DN(e,l),{type:u,ticks:h,tickCount:d}=t,f="scaleBand"===n&&"function"===typeof r.bandwidth?r.bandwidth()/2:2,p="category"===u&&r.bandwidth?r.bandwidth()/f:0;p="angleAxis"===l&&null!=o&&o.length>=2?2*oR(o[0]-o[1])*p:p;var m=h||i;if(m){var g=m.map((e,t)=>{var n=s?s.indexOf(e):e;return{index:t,coordinate:r(n)+p,value:e,offset:p}});return g.filter(e=>!sR(e.coordinate))}return c&&a?a.map((e,t)=>({coordinate:r(e)+p,value:e,index:t,offset:p})):r.ticks?r.ticks(d).map(e=>({coordinate:r(e)+p,value:e,offset:p})):r.domain().map((e,t)=>({coordinate:r(e)+p,value:s?s[e]:e,index:t,offset:p}))}}),P$=nN([_z,YG,u$,l$,S$,T$,RG],(e,t,n,r,i,o,s)=>{if(null!=t&&null!=n&&null!=r&&r[0]!==r[1]){var a=DN(e,s),{tickCount:l}=t,c=0;return c="angleAxis"===s&&(null===r||void 0===r?void 0:r.length)>=2?2*oR(r[0]-r[1])*c:c,a&&o?o.map((e,t)=>({coordinate:n(e)+c,value:e,index:t,offset:c})):n.ticks?n.ticks(l).map(e=>({coordinate:n(e)+c,value:e,offset:c})):n.domain().map((e,t)=>({coordinate:n(e)+c,value:i?i[e]:e,index:t,offset:c}))}}),I$=nN(KG,u$,(e,t)=>{if(null!=e&&null!=t)return UG(UG({},e),{},{scale:t})}),k$=nN([KG,KH,XH,c$],YH),M$=(nN((e,t,n)=>ZG(e,n),k$,(e,t)=>{if(null!=e&&null!=t)return UG(UG({},e),{},{scale:t})}),nN([_z,ez,tz],(e,t,n)=>{switch(e){case"horizontal":return t.some(e=>e.reversed)?"right-to-left":"left-to-right";case"vertical":return n.some(e=>e.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}})),R$=e=>e.options.defaultTooltipEventType,O$=e=>e.options.validateTooltipEventTypes;function L$(e,t,n){if(null==e)return t;var r=e?"axis":"item";return null==n?t:n.includes(r)?r:t}function D$(e,t){return L$(t,R$(e),O$(e))}var N$=(e,t)=>{var n,r=Number(t);if(!sR(r)&&null!=t)return r>=0?null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.value:void 0};function z$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function F$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z$(Object(n),!0).forEach(function(t){B$(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function B$(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j$=(e,t,n,r)=>{if(null==t)return ED;var i=function(e,t,n){return"axis"===t?"click"===n?e.axisInteraction.click:e.axisInteraction.hover:"click"===n?e.itemInteraction.click:e.itemInteraction.hover}(e,t,n);if(null==i)return ED;if(i.active)return i;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&null!=e.syncInteraction.index)return e.syncInteraction;var o=!0===e.settings.active;if(null!=i.index){if(o)return F$(F$({},i),{},{active:!0})}else if(null!=r)return{active:!0,coordinate:void 0,dataKey:void 0,index:r};return F$(F$({},ED),{},{coordinate:i.coordinate})},U$=(e,t)=>{var n=null===e||void 0===e?void 0:e.index;if(null==n)return null;var r=Number(n);if(!RV(r))return n;var i=1/0;return t.length>0&&(i=t.length-1),String(Math.max(0,Math.min(r,i)))},V$=(e,t,n,r,i,o,s,a)=>{if(null!=o&&null!=a){var l=s[0],c=null==l?void 0:a(l.positions,o);if(null!=c)return c;var u=null===i||void 0===i?void 0:i[Number(o)];if(u)return"horizontal"===n?{x:u.coordinate,y:(r.top+t)/2}:{x:(r.left+e)/2,y:u.coordinate}}},G$=(e,t,n,r)=>{return"axis"===t?e.tooltipItemPayloads:0===e.tooltipItemPayloads.length?[]:null==(i="hover"===n?e.itemInteraction.hover.dataKey:e.itemInteraction.click.dataKey)&&null!=r?[e.tooltipItemPayloads[0]]:e.tooltipItemPayloads.filter(e=>{var t;return(null===(t=e.settings)||void 0===t?void 0:t.dataKey)===i});var i},H$=e=>e.options.tooltipPayloadSearcher,$$=e=>e.tooltip;function W$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function q$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W$(Object(n),!0).forEach(function(t){X$(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function X$(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z$=(e,t,n,r,i,o,s)=>{if(null!=t&&null!=o){var{chartData:a,computedData:l,dataStartIndex:c,dataEndIndex:u}=n;return e.reduce((e,n)=>{var h,d,f,{dataDefinedOnItem:p,settings:m}=n,g=function(e,t){return null!=e?e:t}(p,a),_=Array.isArray(g)?kN(g,c,u):g,y=null!==(h=null===m||void 0===m?void 0:m.dataKey)&&void 0!==h?h:null===r||void 0===r?void 0:r.dataKey,v=null===m||void 0===m?void 0:m.nameKey;(d=null!==r&&void 0!==r&&r.dataKey&&Array.isArray(_)&&!Array.isArray(_[0])&&"axis"===s?mR(_,r.dataKey,i):o(_,t,l,v),Array.isArray(d))?d.forEach(t=>{var n=q$(q$({},m),{},{name:t.name,unit:t.unit,color:void 0,fill:void 0});e.push(XN({tooltipEntrySettings:n,dataKey:t.dataKey,payload:t.payload,value:LN(t.payload,t.dataKey),name:t.name}))}):e.push(XN({tooltipEntrySettings:m,dataKey:y,payload:d,value:LN(d,y),name:null!==(f=LN(d,v))&&void 0!==f?f:null===m||void 0===m?void 0:m.name}));return e},[])}},K$=nN([zG,_z,JG,oG,DG],ZH),Y$=nN([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,t)=>[...e,...t]),J$=nN([DG,NG],QG),Q$=nN([Y$,zG,J$],nH),eW=nN([Q$],e=>e.filter(BG)),tW=nN([Q$],aH),nW=nN([tW,IV],cH),rW=nN([eW,IV,zG],FG),iW=nN([nW,zG,Q$],hH),oW=nN([zG],CH),sW=nN([Q$],e=>e.filter(BG)),aW=nN([rW,sW,iG],_H),lW=nN([aW,IV,DG],vH),cW=nN([Q$],oH),uW=nN([nW,zG,cW,wH,DG],bH),hW=nN([IH,DG,NG],kH),dW=nN([hW,DG],NH),fW=nN([RH,DG,NG],kH),pW=nN([fW,DG],FH),mW=nN([LH,DG,NG],kH),gW=nN([mW,DG],jH),_W=nN([dW,gW,pW],PH),yW=nN([zG,oW,lW,uW,_W,_z,DG],HH),vW=nN([zG,_z,nW,iW,iG,DG,yW],qH),xW=nN([vW,zG,K$],JH),bW=nN([zG,vW,xW,DG],e$),wW=e=>{var t=DG(e),n=NG(e);return l$(e,t,n,!1)},SW=nN([zG,wW],yG),EW=nN([zG,K$,bW,SW],YH),TW=nN([_z,iW,zG,DG],w$),AW=nN([_z,iW,zG,DG],E$),CW=nN([_z,zG,K$,EW,wW,TW,AW,DG],(e,t,n,r,i,o,s,a)=>{if(t){var{type:l}=t,c=DN(e,a);if(r){var u="scaleBand"===n&&r.bandwidth?r.bandwidth()/2:2,h="category"===l&&r.bandwidth?r.bandwidth()/u:0;return h="angleAxis"===a&&null!=i&&(null===i||void 0===i?void 0:i.length)>=2?2*oR(i[0]-i[1])*h:h,c&&s?s.map((e,t)=>({coordinate:r(e)+h,value:e,index:t,offset:h})):r.domain().map((e,t)=>({coordinate:r(e)+h,value:o?o[e]:e,index:t,offset:h}))}}}),PW=nN([R$,O$,e=>e.tooltip.settings],(e,t,n)=>L$(n.shared,e,t)),IW=e=>e.tooltip.settings.trigger,kW=e=>e.tooltip.settings.defaultIndex,MW=nN([$$,PW,IW,kW],j$),RW=nN([MW,nW],U$),OW=nN([CW,RW],N$),LW=nN([MW],e=>{if(e)return e.dataKey}),DW=nN([$$,PW,IW,kW],G$),NW=nN([KN,YN,_z,oz,CW,kW,DW,H$],V$),zW=nN([MW,NW],(e,t)=>null!==e&&void 0!==e&&e.coordinate?e.coordinate:t),FW=nN([MW],e=>e.active),BW=nN([DW,RW,IV,zG,OW,H$,PW],Z$),jW=nN([BW],e=>{if(null!=e){var t=e.map(e=>e.payload).filter(e=>null!=e);return Array.from(new Set(t))}}),UW=()=>hN(oG),VW=(e,t)=>t,GW=(e,t,n)=>n,HW=(e,t,n,r)=>r,$W=nN(CW,e=>fN()(e,e=>e.coordinate)),WW=nN([$$,VW,GW,HW],j$),qW=nN([WW,nW],U$),XW=nN([$$,VW,GW,HW],G$),ZW=nN([KN,YN,_z,oz,CW,HW,XW,H$],V$),KW=nN([WW,ZW],(e,t)=>{var n;return null!==(n=e.coordinate)&&void 0!==n?n:t}),YW=nN(CW,qW,N$),JW=nN([XW,qW,IV,zG,YW,H$,VW],Z$),QW=nN([WW],e=>({isActive:e.active,activeIndex:e.index})),eq=nN([(e,t)=>t,_z,MG,DG,SW,CW,$W,oz],(e,t,n,r,i,o,s,a)=>{if(e&&t&&r&&i&&o){var l=function(e,t,n,r,i){return"horizontal"===n||"vertical"===n?e>=i.left&&e<=i.left+i.width&&t>=i.top&&t<=i.top+i.height?{x:e,y:t}:null:r?IN({x:e,y:t},r):null}(e.chartX,e.chartY,t,n,a);if(l){var c=((e,t)=>"horizontal"===t?e.x:"vertical"===t?e.y:"centric"===t?e.angle:e.radius)(l,t),u=((e,t,n,r,i)=>{var o,s=-1,a=null!==(o=null===t||void 0===t?void 0:t.length)&&void 0!==o?o:0;if(a<=1||null==e)return 0;if("angleAxis"===r&&null!=i&&Math.abs(Math.abs(i[1]-i[0])-360)<=1e-6)for(var l=0;l<a;l++){var c=l>0?n[l-1].coordinate:n[a-1].coordinate,u=n[l].coordinate,h=l>=a-1?n[0].coordinate:n[l+1].coordinate,d=void 0;if(oR(u-c)!==oR(h-u)){var f=[];if(oR(h-u)===oR(i[1]-i[0])){d=h;var p=u+i[1]-i[0];f[0]=Math.min(p,(p+c)/2),f[1]=Math.max(p,(p+c)/2)}else{d=c;var m=h+i[1]-i[0];f[0]=Math.min(u,(m+u)/2),f[1]=Math.max(u,(m+u)/2)}var g=[Math.min(u,(d+u)/2),Math.max(u,(d+u)/2)];if(e>g[0]&&e<=g[1]||e>=f[0]&&e<=f[1]){({index:s}=n[l]);break}}else{var _=Math.min(c,h),y=Math.max(c,h);if(e>(_+u)/2&&e<=(y+u)/2){({index:s}=n[l]);break}}}else if(t)for(var v=0;v<a;v++)if(0===v&&e<=(t[v].coordinate+t[v+1].coordinate)/2||v>0&&v<a-1&&e>(t[v].coordinate+t[v-1].coordinate)/2&&e<=(t[v].coordinate+t[v+1].coordinate)/2||v===a-1&&e>(t[v].coordinate+t[v-1].coordinate)/2){({index:s}=t[v]);break}return s})(c,s,o,r,i),h=((e,t,n,r)=>{var i=t.find(e=>e&&e.index===n);if(i){if("horizontal"===e)return{x:i.coordinate,y:r.y};if("vertical"===e)return{x:r.x,y:i.coordinate};if("centric"===e){var o=i.coordinate,{radius:s}=r;return RN(RN(RN({},r),AN(r.cx,r.cy,s,o)),{},{angle:o,radius:s})}var a=i.coordinate,{angle:l}=r;return RN(RN(RN({},r),AN(r.cx,r.cy,a,l)),{},{angle:l,radius:a})}return{x:0,y:0}})(t,o,u,l);return{activeIndex:String(u),activeCoordinate:h}}}}),tq=e=>{var t=e.currentTarget.getBoundingClientRect(),n=t.width/e.currentTarget.offsetWidth,r=t.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-t.left)/n),chartY:Math.round((e.clientY-t.top)/r)}},nq=AO("mouseClick"),rq=vL();rq.startListening({actionCreator:nq,effect:(e,t)=>{var n=e.payload,r=eq(t.getState(),tq(n));null!=(null===r||void 0===r?void 0:r.activeIndex)&&t.dispatch(LD({activeIndex:r.activeIndex,activeDataKey:void 0,activeCoordinate:r.activeCoordinate}))}});var iq=AO("mouseMove"),oq=vL();function sq(e,t){return t instanceof HTMLElement?"HTMLElement <".concat(t.tagName,' class="').concat(t.className,'">'):t===window?"global.window":t}function aq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function lq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aq(Object(n),!0).forEach(function(t){cq(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function cq(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}oq.startListening({actionCreator:iq,effect:(e,t)=>{var n=e.payload,r=t.getState(),i=D$(r,r.tooltip.settings.shared),o=eq(r,tq(n));"axis"===i&&(null!=(null===o||void 0===o?void 0:o.activeIndex)?t.dispatch(OD({activeIndex:o.activeIndex,activeDataKey:void 0,activeCoordinate:o.activeCoordinate})):t.dispatch(MD()))}});var uq=jO({name:"cartesianAxis",initialState:{xAxis:{},yAxis:{},zAxis:{}},reducers:{addXAxis(e,t){e.xAxis[t.payload.id]=t.payload},removeXAxis(e,t){delete e.xAxis[t.payload.id]},addYAxis(e,t){e.yAxis[t.payload.id]=t.payload},removeYAxis(e,t){delete e.yAxis[t.payload.id]},addZAxis(e,t){e.zAxis[t.payload.id]=t.payload},removeZAxis(e,t){delete e.zAxis[t.payload.id]},updateYAxisWidth(e,t){var{id:n,width:r}=t.payload;e.yAxis[n]&&(e.yAxis[n]=lq(lq({},e.yAxis[n]),{},{width:r}))}}}),{addXAxis:hq,removeXAxis:dq,addYAxis:fq,removeYAxis:pq,addZAxis:mq,removeZAxis:gq,updateYAxisWidth:_q}=uq.actions,yq=uq.reducer,vq=jO({name:"graphicalItems",initialState:{cartesianItems:[],polarItems:[]},reducers:{addCartesianGraphicalItem(e,t){e.cartesianItems.push(t.payload)},replaceCartesianGraphicalItem(e,t){var{prev:n,next:r}=t.payload,i=bO(e).cartesianItems.indexOf(n);i>-1&&(e.cartesianItems[i]=r)},removeCartesianGraphicalItem(e,t){var n=bO(e).cartesianItems.indexOf(t.payload);n>-1&&e.cartesianItems.splice(n,1)},addPolarGraphicalItem(e,t){e.polarItems.push(t.payload)},removePolarGraphicalItem(e,t){var n=bO(e).polarItems.indexOf(t.payload);n>-1&&e.polarItems.splice(n,1)}}}),{addCartesianGraphicalItem:xq,replaceCartesianGraphicalItem:bq,removeCartesianGraphicalItem:wq,addPolarGraphicalItem:Sq,removePolarGraphicalItem:Eq}=vq.actions,Tq=vq.reducer,Aq=jO({name:"referenceElements",initialState:{dots:[],areas:[],lines:[]},reducers:{addDot:(e,t)=>{e.dots.push(t.payload)},removeDot:(e,t)=>{var n=bO(e).dots.findIndex(e=>e===t.payload);-1!==n&&e.dots.splice(n,1)},addArea:(e,t)=>{e.areas.push(t.payload)},removeArea:(e,t)=>{var n=bO(e).areas.findIndex(e=>e===t.payload);-1!==n&&e.areas.splice(n,1)},addLine:(e,t)=>{e.lines.push(t.payload)},removeLine:(e,t)=>{var n=bO(e).lines.findIndex(e=>e===t.payload);-1!==n&&e.lines.splice(n,1)}}}),{addDot:Cq,removeDot:Pq,addArea:Iq,removeArea:kq,addLine:Mq,removeLine:Rq}=Aq.actions,Oq=Aq.reducer,Lq={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},Dq=jO({name:"brush",initialState:Lq,reducers:{setBrushSettings:(e,t)=>null==t.payload?Lq:t.payload}}),{setBrushSettings:Nq}=Dq.actions,zq=Dq.reducer,Fq=jO({name:"legend",initialState:{settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},reducers:{setLegendSize(e,t){e.size.width=t.payload.width,e.size.height=t.payload.height},setLegendSettings(e,t){e.settings.align=t.payload.align,e.settings.layout=t.payload.layout,e.settings.verticalAlign=t.payload.verticalAlign,e.settings.itemSorter=t.payload.itemSorter},addLegendPayload(e,t){e.payload.push(t.payload)},removeLegendPayload(e,t){var n=bO(e).payload.indexOf(t.payload);n>-1&&e.payload.splice(n,1)}}}),{setLegendSize:Bq,setLegendSettings:jq,addLegendPayload:Uq,removeLegendPayload:Vq}=Fq.actions,Gq=Fq.reducer,Hq={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index"},$q=jO({name:"rootProps",initialState:Hq,reducers:{updateOptions:(e,t)=>{var n;e.accessibilityLayer=t.payload.accessibilityLayer,e.barCategoryGap=t.payload.barCategoryGap,e.barGap=null!==(n=t.payload.barGap)&&void 0!==n?n:Hq.barGap,e.barSize=t.payload.barSize,e.maxBarSize=t.payload.maxBarSize,e.stackOffset=t.payload.stackOffset,e.syncId=t.payload.syncId,e.syncMethod=t.payload.syncMethod,e.className=t.payload.className}}}),Wq=$q.reducer,{updateOptions:qq}=$q.actions,Xq=jO({name:"polarAxis",initialState:{radiusAxis:{},angleAxis:{}},reducers:{addRadiusAxis(e,t){e.radiusAxis[t.payload.id]=t.payload},removeRadiusAxis(e,t){delete e.radiusAxis[t.payload.id]},addAngleAxis(e,t){e.angleAxis[t.payload.id]=t.payload},removeAngleAxis(e,t){delete e.angleAxis[t.payload.id]}}}),{addRadiusAxis:Zq,removeRadiusAxis:Kq,addAngleAxis:Yq,removeAngleAxis:Jq}=Xq.actions,Qq=Xq.reducer,eX=jO({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,t)=>t.payload}}),{updatePolarOptions:tX}=eX.actions,nX=eX.reducer,rX=AO("keyDown"),iX=AO("focus"),oX=vL();oX.startListening({actionCreator:rX,effect:(e,t)=>{var n=t.getState();if(!1!==n.rootProps.accessibilityLayer){var{keyboardInteraction:r}=n.tooltip,i=e.payload;if("ArrowRight"===i||"ArrowLeft"===i||"Enter"===i){var o=Number(U$(r,nW(n))),s=CW(n);if("Enter"!==i){var a=o+("ArrowRight"===i?1:-1)*("left-to-right"===M$(n)?1:-1);if(!(null==s||a>=s.length||a<0)){var l=ZW(n,"axis","hover",String(a));t.dispatch(ND({active:!0,activeIndex:a.toString(),activeDataKey:void 0,activeCoordinate:l}))}}else{var c=ZW(n,"axis","hover",String(r.index));t.dispatch(ND({active:!r.active,activeIndex:r.index,activeDataKey:r.dataKey,activeCoordinate:c}))}}}}}),oX.startListening({actionCreator:iX,effect:(e,t)=>{var n=t.getState();if(!1!==n.rootProps.accessibilityLayer){var{keyboardInteraction:r}=n.tooltip;if(!r.active&&null==r.index){var i=ZW(n,"axis","hover",String("0"));t.dispatch(ND({activeDataKey:void 0,active:!0,activeIndex:"0",activeCoordinate:i}))}}}});var sX=AO("externalEvent"),aX=vL();aX.startListening({actionCreator:sX,effect:(e,t)=>{if(null!=e.payload.handler){var n=t.getState(),r={activeCoordinate:zW(n),activeDataKey:LW(n),activeIndex:RW(n),activeLabel:OW(n),activeTooltipIndex:RW(n),isTooltipActive:FW(n)};e.payload.handler(r,e.payload.reactEvent)}}});var lX=nN([$$],e=>e.tooltipItemPayloads),cX=nN([lX,H$,(e,t,n)=>t,(e,t,n)=>n],(e,t,n,r)=>{var i=e.find(e=>e.settings.dataKey===r);if(null!=i){var{positions:o}=i;if(null!=o)return t(o,n)}}),uX=AO("touchMove"),hX=vL();hX.startListening({actionCreator:uX,effect:(e,t)=>{var n=e.payload,r=t.getState(),i=D$(r,r.tooltip.settings.shared);if("axis"===i){var o=eq(r,tq({clientX:n.touches[0].clientX,clientY:n.touches[0].clientY,currentTarget:n.currentTarget}));null!=(null===o||void 0===o?void 0:o.activeIndex)&&t.dispatch(OD({activeIndex:o.activeIndex,activeDataKey:void 0,activeCoordinate:o.activeCoordinate}))}else if("item"===i){var s,a=n.touches[0],l=document.elementFromPoint(a.clientX,a.clientY);if(!l||!l.getAttribute)return;var c=l.getAttribute("data-recharts-item-index"),u=null!==(s=l.getAttribute("data-recharts-item-data-key"))&&void 0!==s?s:void 0,h=cX(t.getState(),c,u);t.dispatch(ID({activeDataKey:u,activeIndex:c,activeCoordinate:h}))}}});var dX=jO({name:"errorBars",initialState:{},reducers:{addErrorBar:(e,t)=>{var{itemId:n,errorBar:r}=t.payload;e[n]||(e[n]=[]),e[n].push(r)},removeErrorBar:(e,t)=>{var{itemId:n,errorBar:r}=t.payload;e[n]&&(e[n]=e[n].filter(e=>e.dataKey!==r.dataKey||e.direction!==r.direction))}}}),{addErrorBar:fX,removeErrorBar:pX}=dX.actions,mX=IR({brush:zq,cartesianAxis:yq,chartData:VD,errorBars:dX.reducer,graphicalItems:Tq,layout:XD,legend:Gq,options:SL,polarAxis:Qq,polarOptions:nX,referenceElements:Oq,rootProps:Wq,tooltip:zD});function gX(e){var{preloadedState:t,children:n,reduxStoreName:r}=e,o=cz(),s=(0,i.useRef)(null);if(o)return n;null==s.current&&(s.current=function(e){return OO({reducer:mX,preloadedState:e,middleware:e=>e({serializableCheck:!1}).concat([rq.middleware,oq.middleware,oX.middleware,aX.middleware,hX.middleware]),devTools:{serialize:{replacer:sq},name:"recharts-".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart")}})}(t,r));var a=oN;return i.createElement(DL,{context:a,store:s.current},n)}var _X=e=>{var{chartData:t}=e,n=aN(),r=cz();return(0,i.useEffect)(()=>r?()=>{}:(n(BD(t)),()=>{n(BD(void 0))}),[t,n,r]),null};function yX(e){var{layout:t,width:n,height:r,margin:o}=e,s=aN(),a=cz();return(0,i.useEffect)(()=>{a||(s($D(t)),s(WD({width:n,height:r})),s(HD(o)))},[s,a,t,n,r,o]),null}function vX(e){var t=aN();return(0,i.useEffect)(()=>{t(qq(e))},[t,e]),null}var xX=()=>hN(e=>e.rootProps.accessibilityLayer),bX=n(528),wX=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function SX(e){return"string"===typeof e&&wX.includes(e)}var EX=["points","pathLength"],TX={svg:["viewBox","children"],polygon:EX,polyline:EX},AX=(e,t)=>{if(!e||"function"===typeof e||"boolean"===typeof e)return null;var n=e;if((0,i.isValidElement)(e)&&(n=e.props),"object"!==typeof n&&"function"!==typeof n)return null;var r={};return Object.keys(n).forEach(e=>{SX(e)&&(r[e]=t||(t=>n[e](n,t)))}),r},CX=(e,t,n)=>{if(null===e||"object"!==typeof e&&"function"!==typeof e)return null;var r=null;return Object.keys(e).forEach(i=>{var o=e[i];SX(i)&&"function"===typeof o&&(r||(r={}),r[i]=((e,t,n)=>r=>(e(t,n,r),null))(o,t,n))}),r},PX=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"];function IX(e){return"string"===typeof e&&PX.includes(e)}function kX(e){var t=Object.entries(e).filter(e=>{var[t]=e;return IX(t)});return Object.fromEntries(t)}var MX=e=>"string"===typeof e?e:e?e.displayName||e.name||"Component":"",RX=null,OX=null,LX=e=>{if(e===RX&&Array.isArray(OX))return OX;var t=[];return i.Children.forEach(e,e=>{gR(e)||((0,bX.zv)(e)?t=t.concat(LX(e.props.children)):t.push(e))}),OX=t,RX=e,t};function DX(e,t){var n=[],r=[];return r=Array.isArray(t)?t.map(e=>MX(e)):[MX(t)],LX(e).forEach(e=>{var t=iR()(e,"type.displayName")||iR()(e,"type.name");-1!==r.indexOf(t)&&n.push(e)}),n}var NX=e=>!e||"object"!==typeof e||!("clipDot"in e)||Boolean(e.clipDot),zX=(e,t,n)=>{if(!e||"function"===typeof e||"boolean"===typeof e)return null;var r=e;if((0,i.isValidElement)(e)&&(r=e.props),"object"!==typeof r&&"function"!==typeof r)return null;var o={};return Object.keys(r).forEach(e=>{var i;((e,t,n,r)=>{var i;if("symbol"===typeof t||"number"===typeof t)return!0;var o=null!==(i=r&&(null===TX||void 0===TX?void 0:TX[r]))&&void 0!==i?i:[],s=t.startsWith("data-"),a="function"!==typeof e&&(Boolean(r)&&o.includes(t)||IX(t)),l=Boolean(n)&&SX(t);return s||a||l})(null===(i=r)||void 0===i?void 0:i[e],e,t,n)&&(o[e]=r[e])}),o},FX=["children","width","height","viewBox","className","style","title","desc"];function BX(){return BX=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},BX.apply(null,arguments)}var jX=(0,i.forwardRef)((e,t)=>{var{children:n,width:r,height:o,viewBox:s,className:a,style:l,title:c,desc:u}=e,h=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,FX),d=s||{width:r,height:o,x:0,y:0},f=yi("recharts-surface",a);return i.createElement("svg",BX({},zX(h,!0,"svg"),{className:f,width:r,height:o,style:l,viewBox:"".concat(d.x," ").concat(d.y," ").concat(d.width," ").concat(d.height),ref:t}),i.createElement("title",null,c),i.createElement("desc",null,u),n)}),UX=["children"];function VX(){return VX=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},VX.apply(null,arguments)}var GX={width:"100%",height:"100%"},HX=(0,i.forwardRef)((e,t)=>{var n=mz(),r=gz(),o=xX();if(!OV(n)||!OV(r))return null;var s,a,{children:l,otherAttributes:c,title:u,desc:h}=e;return s="number"===typeof c.tabIndex?c.tabIndex:o?0:void 0,a="string"===typeof c.role?c.role:o?"application":void 0,i.createElement(jX,VX({},c,{title:u,desc:h,role:a,tabIndex:s,width:n,height:r,style:GX,ref:t}),l)}),$X=e=>{var{children:t}=e,n=hN(hz);if(!n)return null;var{width:r,height:o,y:s,x:a}=n;return i.createElement(jX,{width:r,height:o,x:a,y:s},t)},WX=(0,i.forwardRef)((e,t)=>{var{children:n}=e,r=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,UX);return cz()?i.createElement($X,null,n):i.createElement(HX,VX({ref:t},r),n)});var qX=new(n(7283)),XX="recharts.syncEvent.tooltip",ZX="recharts.syncEvent.brush";function KX(e){return e.tooltip.syncInteraction}var YX=()=>{};function JX(){var e=aN();(0,i.useEffect)(()=>{e(EL())},[e]),function(){var e=hN(sG),t=hN(lG),n=aN(),r=hN(aG),o=hN(CW),s=yz(),a=dz(),l=hN(e=>e.rootProps.className);(0,i.useEffect)(()=>{if(null==e)return YX;var i=(i,l,c)=>{if(t!==c&&e===i)if("index"!==r){if(null!=o){var u;if("function"===typeof r){var h={activeTooltipIndex:null==l.payload.index?void 0:Number(l.payload.index),isTooltipActive:l.payload.active,activeIndex:null==l.payload.index?void 0:Number(l.payload.index),activeLabel:l.payload.label,activeDataKey:l.payload.dataKey,activeCoordinate:l.payload.coordinate},d=r(o,h);u=o[d]}else"value"===r&&(u=o.find(e=>String(e.value)===l.payload.label));var{coordinate:f}=l.payload;if(null!=u&&!1!==l.payload.active&&null!=f&&null!=a){var{x:p,y:m}=f,g=Math.min(p,a.x+a.width),_=Math.min(m,a.y+a.height),y={x:"horizontal"===s?u.coordinate:g,y:"horizontal"===s?_:u.coordinate},v=DD({active:l.payload.active,coordinate:y,dataKey:l.payload.dataKey,index:String(u.index),label:l.payload.label});n(v)}else n(DD({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0}))}}else n(l)};return qX.on(XX,i),()=>{qX.off(XX,i)}},[l,n,t,e,r,o,s,a])}(),function(){var e=hN(sG),t=hN(lG),n=aN();(0,i.useEffect)(()=>{if(null==e)return YX;var r=(r,i,o)=>{t!==o&&e===r&&n(jD(i))};return qX.on(ZX,r),()=>{qX.off(ZX,r)}},[n,t,e])}()}function QX(e,t,n,r,o,s){var a=hN(n=>((e,t,n)=>{if(null!=t){var r=$$(e);return"axis"===t?"hover"===n?r.axisInteraction.hover.dataKey:r.axisInteraction.click.dataKey:"hover"===n?r.itemInteraction.hover.dataKey:r.itemInteraction.click.dataKey}})(n,e,t)),l=hN(lG),c=hN(sG),u=hN(aG),h=hN(KX),d=null===h||void 0===h?void 0:h.active;(0,i.useEffect)(()=>{if(!d&&null!=c&&null!=l){var e=DD({active:s,coordinate:n,dataKey:a,index:o,label:"number"===typeof r?String(r):r});qX.emit(XX,c,e,l)}},[d,n,a,o,r,l,c,u,s])}var eZ=(0,i.createContext)(null),tZ=(0,i.createContext)(null);function nZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rZ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nZ(Object(n),!0).forEach(function(t){iZ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nZ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function iZ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oZ=(0,i.forwardRef)((e,t)=>{var{children:n,className:r,height:o,onClick:s,onContextMenu:a,onDoubleClick:l,onMouseDown:c,onMouseEnter:u,onMouseLeave:h,onMouseMove:d,onMouseUp:f,onTouchEnd:p,onTouchMove:m,onTouchStart:g,style:_,width:y}=e,v=aN(),[x,b]=(0,i.useState)(null),[w,S]=(0,i.useState)(null);JX();var E=function(){var e=aN(),[t,n]=(0,i.useState)(null),r=hN(JN);return(0,i.useEffect)(()=>{if(null!=t){var n=t.getBoundingClientRect().width/t.offsetWidth;RV(n)&&n!==r&&e(qD(n))}},[t,e,r]),n}(),T=(0,i.useCallback)(e=>{E(e),"function"===typeof t&&t(e),b(e),S(e)},[E,t,b,S]),A=(0,i.useCallback)(e=>{v(nq(e)),v(sX({handler:s,reactEvent:e}))},[v,s]),C=(0,i.useCallback)(e=>{v(iq(e)),v(sX({handler:u,reactEvent:e}))},[v,u]),P=(0,i.useCallback)(e=>{v(MD()),v(sX({handler:h,reactEvent:e}))},[v,h]),I=(0,i.useCallback)(e=>{v(iq(e)),v(sX({handler:d,reactEvent:e}))},[v,d]),k=(0,i.useCallback)(()=>{v(iX())},[v]),M=(0,i.useCallback)(e=>{v(rX(e.key))},[v]),R=(0,i.useCallback)(e=>{v(sX({handler:a,reactEvent:e}))},[v,a]),O=(0,i.useCallback)(e=>{v(sX({handler:l,reactEvent:e}))},[v,l]),L=(0,i.useCallback)(e=>{v(sX({handler:c,reactEvent:e}))},[v,c]),D=(0,i.useCallback)(e=>{v(sX({handler:f,reactEvent:e}))},[v,f]),N=(0,i.useCallback)(e=>{v(sX({handler:g,reactEvent:e}))},[v,g]),z=(0,i.useCallback)(e=>{v(uX(e)),v(sX({handler:m,reactEvent:e}))},[v,m]),F=(0,i.useCallback)(e=>{v(sX({handler:p,reactEvent:e}))},[v,p]);return i.createElement(eZ.Provider,{value:x},i.createElement(tZ.Provider,{value:w},i.createElement("div",{className:yi("recharts-wrapper",r),style:rZ({position:"relative",cursor:"default",width:y,height:o},_),onClick:A,onContextMenu:R,onDoubleClick:O,onFocus:k,onKeyDown:M,onMouseDown:L,onMouseEnter:C,onMouseLeave:P,onMouseMove:I,onMouseUp:D,onTouchEnd:F,onTouchMove:z,onTouchStart:N,ref:T},n)))}),sZ=nN([oz],e=>{if(e)return{top:e.top,bottom:e.bottom,left:e.left,right:e.right}}),aZ=nN([sZ,KN,YN],(e,t,n)=>{if(e&&null!=t&&null!=n)return{x:e.left,y:e.top,width:Math.max(0,t-e.left-e.right),height:Math.max(0,n-e.top-e.bottom)}}),lZ=()=>hN(aZ),cZ=(0,i.createContext)(void 0),uZ=e=>{var{children:t}=e,[n]=(0,i.useState)("".concat(hR("recharts"),"-clip")),r=lZ();if(null==r)return null;var{x:o,y:s,width:a,height:l}=r;return i.createElement(cZ.Provider,{value:n},i.createElement("defs",null,i.createElement("clipPath",{id:n},i.createElement("rect",{x:o,y:s,height:l,width:a}))),t)},hZ=["children","className","width","height","style","compact","title","desc"];var dZ=(0,i.forwardRef)((e,t)=>{var{children:n,className:r,width:o,height:s,style:a,compact:l,title:c,desc:u}=e,h=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,hZ),d=kX(h);return l?i.createElement(WX,{otherAttributes:d,title:c,desc:u},n):i.createElement(oZ,{className:r,style:a,width:o,height:s,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},i.createElement(WX,{otherAttributes:d,title:c,desc:u,ref:t},i.createElement(uZ,null,n)))});function fZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pZ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mZ(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fZ(Object(n),!0).forEach(function(t){pZ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fZ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e),r=t;return Object.keys(t).reduce((e,t)=>(void 0===e[t]&&void 0!==r[t]&&(e[t]=r[t]),e),n)}var gZ=["width","height"];function _Z(){return _Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_Z.apply(null,arguments)}var yZ={accessibilityLayer:!0,layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},vZ=(0,i.forwardRef)(function(e,t){var n,r=mZ(e.categoricalChartProps,yZ),{width:o,height:s}=r,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(r,gZ);if(!OV(o)||!OV(s))return null;var{chartName:l,defaultTooltipEventType:c,validateTooltipEventTypes:u,tooltipPayloadSearcher:h,categoricalChartProps:d}=e,f={chartName:l,defaultTooltipEventType:c,validateTooltipEventTypes:u,tooltipPayloadSearcher:h,eventEmitter:void 0};return i.createElement(gX,{preloadedState:{options:f},reduxStoreName:null!==(n=d.id)&&void 0!==n?n:l},i.createElement(_X,{chartData:d.data}),i.createElement(yX,{width:o,height:s,layout:r.layout,margin:r.margin}),i.createElement(vX,{accessibilityLayer:r.accessibilityLayer,barCategoryGap:r.barCategoryGap,maxBarSize:r.maxBarSize,stackOffset:r.stackOffset,barGap:r.barGap,barSize:r.barSize,syncId:r.syncId,syncMethod:r.syncMethod,className:r.className}),i.createElement(dZ,_Z({},a,{width:o,height:s,ref:t})))}),xZ=["axis"],bZ=(0,i.forwardRef)((e,t)=>i.createElement(vZ,{chartName:"LineChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:xZ,tooltipPayloadSearcher:bL,categoricalChartProps:e,ref:t}));function wZ(e,t){for(var n in e)if({}.hasOwnProperty.call(e,n)&&(!{}.hasOwnProperty.call(t,n)||e[n]!==t[n]))return!1;for(var r in t)if({}.hasOwnProperty.call(t,r)&&!{}.hasOwnProperty.call(e,r))return!1;return!0}var SZ=["children","className"];function EZ(){return EZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},EZ.apply(null,arguments)}var TZ=i.forwardRef((e,t)=>{var{children:n,className:r}=e,o=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,SZ),s=yi("recharts-layer",r);return i.createElement("g",EZ({className:s},zX(o,!0),{ref:t}),n)}),AZ=!("undefined"!==typeof window&&window.document&&Boolean(window.document.createElement)&&window.setTimeout);function CZ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function PZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function IZ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PZ(Object(n),!0).forEach(function(t){kZ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PZ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function kZ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var MZ=IZ({},{cacheSize:2e3,enableCache:!0}),RZ=new class{constructor(e){CZ(this,"cache",new Map),this.maxSize=e}get(e){var t=this.cache.get(e);return void 0!==t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}clear(){this.cache.clear()}size(){return this.cache.size}}(MZ.cacheSize),OZ={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},LZ="recharts_measurement_span";var DZ=(e,t)=>{try{var n=document.getElementById(LZ);n||((n=document.createElement("span")).setAttribute("id",LZ),n.setAttribute("aria-hidden","true"),document.body.appendChild(n)),Object.assign(n.style,OZ,t),n.textContent="".concat(e);var r=n.getBoundingClientRect();return{width:r.width,height:r.height}}catch(i){return{width:0,height:0}}},NZ=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e||null===e||AZ)return{width:0,height:0};if(!MZ.enableCache)return DZ(e,t);var n=function(e,t){var n=t.fontSize||"",r=t.fontFamily||"",i=t.fontWeight||"",o=t.fontStyle||"",s=t.letterSpacing||"",a=t.textTransform||"";return"".concat(e,"|").concat(n,"|").concat(r,"|").concat(i,"|").concat(o,"|").concat(s,"|").concat(a)}(e,t),r=RZ.get(n);if(r)return r;var i=DZ(e,t);return RZ.set(n,i),i},zZ=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,FZ=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,BZ=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,jZ=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,UZ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,in:96,Q:96/101.6,px:1},VZ=Object.keys(UZ),GZ="NaN";class HZ{static parse(e){var t,[,n,r]=null!==(t=jZ.exec(e))&&void 0!==t?t:[];return new HZ(parseFloat(n),null!==r&&void 0!==r?r:"")}constructor(e,t){this.num=e,this.unit=t,this.num=e,this.unit=t,sR(e)&&(this.unit=""),""===t||BZ.test(t)||(this.num=NaN,this.unit=""),VZ.includes(t)&&(this.num=function(e,t){return e*UZ[t]}(e,t),this.unit="px")}add(e){return this.unit!==e.unit?new HZ(NaN,""):new HZ(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new HZ(NaN,""):new HZ(this.num-e.num,this.unit)}multiply(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new HZ(NaN,""):new HZ(this.num*e.num,this.unit||e.unit)}divide(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new HZ(NaN,""):new HZ(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return sR(this.num)}}function $Z(e){if(e.includes(GZ))return GZ;for(var t=e;t.includes("*")||t.includes("/");){var n,[,r,i,o]=null!==(n=zZ.exec(t))&&void 0!==n?n:[],s=HZ.parse(null!==r&&void 0!==r?r:""),a=HZ.parse(null!==o&&void 0!==o?o:""),l="*"===i?s.multiply(a):s.divide(a);if(l.isNaN())return GZ;t=t.replace(zZ,l.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var c,[,u,h,d]=null!==(c=FZ.exec(t))&&void 0!==c?c:[],f=HZ.parse(null!==u&&void 0!==u?u:""),p=HZ.parse(null!==d&&void 0!==d?d:""),m="+"===h?f.add(p):f.subtract(p);if(m.isNaN())return GZ;t=t.replace(FZ,m.toString())}return t}var WZ=/\(([^()]*)\)/;function qZ(e){var t=e.replace(/\s+/g,"");return t=function(e){for(var t,n=e;null!=(t=WZ.exec(n));){var[,r]=t;n=n.replace(WZ,$Z(r))}return n}(t),t=$Z(t)}function XZ(e){var t=function(e){try{return qZ(e)}catch(t){return GZ}}(e.slice(5,-1));return t===GZ?"":t}var ZZ=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],KZ=["dx","dy","angle","className","breakAll"];function YZ(){return YZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},YZ.apply(null,arguments)}function JZ(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var QZ=/[ \f\n\r\t\v\u2028\u2029]+/,eK=e=>{var{children:t,breakAll:n,style:r}=e;try{var i=[];return gR(t)||(i=n?t.toString().split(""):t.toString().split(QZ)),{wordsWithComputedWidth:i.map(e=>({word:e,width:NZ(e,r).width})),spaceWidth:n?0:NZ("\xa0",r).width}}catch(o){return null}},tK=e=>[{words:gR(e)?[]:e.toString().split(QZ)}],nK=e=>{var{width:t,scaleToFit:n,children:r,style:i,breakAll:o,maxLines:s}=e;if((t||n)&&!AZ){var a=eK({breakAll:o,children:r,style:i});if(!a)return tK(r);var{wordsWithComputedWidth:l,spaceWidth:c}=a;return((e,t,n,r,i)=>{var{maxLines:o,children:s,style:a,breakAll:l}=e,c=lR(o),u=s,h=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((e,t)=>{var{word:o,width:s}=t,a=e[e.length-1];if(a&&(null==r||i||a.width+s+n<Number(r)))a.words.push(o),a.width+=s+n;else{var l={words:[o],width:s};e.push(l)}return e},[])},d=h(t),f=e=>e.reduce((e,t)=>e.width>t.width?e:t);if(!c||i)return d;if(!(d.length>o||f(d).width>Number(r)))return d;for(var p,m=e=>{var t=u.slice(0,e),n=eK({breakAll:l,style:a,children:t+"\u2026"}).wordsWithComputedWidth,i=h(n);return[i.length>o||f(i).width>Number(r),i]},g=0,_=u.length-1,y=0;g<=_&&y<=u.length-1;){var v=Math.floor((g+_)/2),x=v-1,[b,w]=m(x),[S]=m(v);if(b||S||(g=v+1),b&&S&&(_=v-1),!b&&S){p=w;break}y++}return p||d})({breakAll:o,children:r,maxLines:s,style:i},l,c,t,n)}return tK(r)},rK="#808080",iK=(0,i.forwardRef)((e,t)=>{var{x:n=0,y:r=0,lineHeight:o="1em",capHeight:s="0.71em",scaleToFit:a=!1,textAnchor:l="start",verticalAnchor:c="end",fill:u=rK}=e,h=JZ(e,ZZ),d=(0,i.useMemo)(()=>nK({breakAll:h.breakAll,children:h.children,maxLines:h.maxLines,scaleToFit:a,style:h.style,width:h.width}),[h.breakAll,h.children,h.maxLines,a,h.style,h.width]),{dx:f,dy:p,angle:m,className:g,breakAll:_}=h,y=JZ(h,KZ);if(!cR(n)||!cR(r))return null;var v,x=n+(lR(f)?f:0),b=r+(lR(p)?p:0);switch(c){case"start":v=XZ("calc(".concat(s,")"));break;case"middle":v=XZ("calc(".concat((d.length-1)/2," * -").concat(o," + (").concat(s," / 2))"));break;default:v=XZ("calc(".concat(d.length-1," * -").concat(o,")"))}var w=[];if(a){var S=d[0].width,{width:E}=h;w.push("scale(".concat(lR(E)?E/S:1,")"))}return m&&w.push("rotate(".concat(m,", ").concat(x,", ").concat(b,")")),w.length&&(y.transform=w.join(" ")),i.createElement("text",YZ({},zX(y,!0),{ref:t,x:x,y:b,className:yi("recharts-text",g),textAnchor:l,fill:u.includes("url")?rK:u}),d.map((e,t)=>{var n=e.words.join(_?"":" ");return i.createElement("tspan",{x:x,dy:0===t?v:o,key:"".concat(n,"-").concat(t)},n)}))});iK.displayName="Text";var oK=["offset"],sK=["labelRef"];function aK(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function lK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lK(Object(n),!0).forEach(function(t){uK(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lK(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function uK(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hK(){return hK=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hK.apply(null,arguments)}var dK=e=>null!=e&&"function"===typeof e,fK=(e,t,n,r)=>{var o,s,{position:a,offset:l,className:c}=e,{cx:u,cy:h,innerRadius:d,outerRadius:f,startAngle:p,endAngle:m,clockWise:g}=r,_=(d+f)/2,y=((e,t)=>oR(t-e)*Math.min(Math.abs(t-e),360))(p,m),v=y>=0?1:-1;"insideStart"===a?(o=p+v*l,s=g):"insideEnd"===a?(o=m-v*l,s=!g):"end"===a&&(o=m+v*l,s=g),s=y<=0?s:!s;var x=AN(u,h,_,o),b=AN(u,h,_,o+359*(s?1:-1)),w="M".concat(x.x,",").concat(x.y,"\n    A").concat(_,",").concat(_,",0,1,").concat(s?0:1,",\n    ").concat(b.x,",").concat(b.y),S=gR(e.id)?hR("recharts-radial-line-"):e.id;return i.createElement("text",hK({},n,{dominantBaseline:"central",className:yi("recharts-radial-bar-label",c)}),i.createElement("defs",null,i.createElement("path",{id:S,d:w})),i.createElement("textPath",{xlinkHref:"#".concat(S)},t))};function pK(e){var{offset:t=5}=e,n=cK({offset:t},aK(e,oK)),{viewBox:r,position:o,value:s,children:a,content:l,className:c="",textBreakAll:u,labelRef:h}=n,d=hN(MG),f=dz(),p=r||("center"===o?f:null!==d&&void 0!==d?d:f);if(!p||gR(s)&&gR(a)&&!(0,i.isValidElement)(l)&&"function"!==typeof l)return null;var m,g=cK(cK({},n),{},{viewBox:p});if((0,i.isValidElement)(l)){var{labelRef:_}=g,y=aK(g,sK);return(0,i.cloneElement)(l,y)}if("function"===typeof l){if(m=(0,i.createElement)(l,g),(0,i.isValidElement)(m))return m}else m=(e=>{var{value:t,formatter:n}=e,r=gR(e.children)?t:e.children;return"function"===typeof n?n(r):r})(n);var v=(e=>"cx"in e&&lR(e.cx))(p),x=zX(n,!0);if(v&&("insideStart"===o||"insideEnd"===o||"end"===o))return fK(n,m,x,p);var b=v?((e,t,n)=>{var{cx:r,cy:i,innerRadius:o,outerRadius:s,startAngle:a,endAngle:l}=e,c=(a+l)/2;if("outside"===n){var{x:u,y:h}=AN(r,i,s+t,c);return{x:u,y:h,textAnchor:u>=r?"start":"end",verticalAnchor:"middle"}}if("center"===n)return{x:r,y:i,textAnchor:"middle",verticalAnchor:"middle"};if("centerTop"===n)return{x:r,y:i,textAnchor:"middle",verticalAnchor:"start"};if("centerBottom"===n)return{x:r,y:i,textAnchor:"middle",verticalAnchor:"end"};var d=(o+s)/2,{x:f,y:p}=AN(r,i,d,c);return{x:f,y:p,textAnchor:"middle",verticalAnchor:"middle"}})(p,n.offset,n.position):((e,t)=>{var{parentViewBox:n,offset:r,position:i}=e,{x:o,y:s,width:a,height:l}=t,c=l>=0?1:-1,u=c*r,h=c>0?"end":"start",d=c>0?"start":"end",f=a>=0?1:-1,p=f*r,m=f>0?"end":"start",g=f>0?"start":"end";if("top"===i)return cK(cK({},{x:o+a/2,y:s-c*r,textAnchor:"middle",verticalAnchor:h}),n?{height:Math.max(s-n.y,0),width:a}:{});if("bottom"===i)return cK(cK({},{x:o+a/2,y:s+l+u,textAnchor:"middle",verticalAnchor:d}),n?{height:Math.max(n.y+n.height-(s+l),0),width:a}:{});if("left"===i){var _={x:o-p,y:s+l/2,textAnchor:m,verticalAnchor:"middle"};return cK(cK({},_),n?{width:Math.max(_.x-n.x,0),height:l}:{})}if("right"===i){var y={x:o+a+p,y:s+l/2,textAnchor:g,verticalAnchor:"middle"};return cK(cK({},y),n?{width:Math.max(n.x+n.width-y.x,0),height:l}:{})}var v=n?{width:a,height:l}:{};return"insideLeft"===i?cK({x:o+p,y:s+l/2,textAnchor:g,verticalAnchor:"middle"},v):"insideRight"===i?cK({x:o+a-p,y:s+l/2,textAnchor:m,verticalAnchor:"middle"},v):"insideTop"===i?cK({x:o+a/2,y:s+u,textAnchor:"middle",verticalAnchor:d},v):"insideBottom"===i?cK({x:o+a/2,y:s+l-u,textAnchor:"middle",verticalAnchor:h},v):"insideTopLeft"===i?cK({x:o+p,y:s+u,textAnchor:g,verticalAnchor:d},v):"insideTopRight"===i?cK({x:o+a-p,y:s+u,textAnchor:m,verticalAnchor:d},v):"insideBottomLeft"===i?cK({x:o+p,y:s+l-u,textAnchor:g,verticalAnchor:h},v):"insideBottomRight"===i?cK({x:o+a-p,y:s+l-u,textAnchor:m,verticalAnchor:h},v):i&&"object"===typeof i&&(lR(i.x)||aR(i.x))&&(lR(i.y)||aR(i.y))?cK({x:o+dR(i.x,a),y:s+dR(i.y,l),textAnchor:"end",verticalAnchor:"end"},v):cK({x:o+a/2,y:s+l/2,textAnchor:"middle",verticalAnchor:"middle"},v)})(n,p);return i.createElement(iK,hK({ref:h,className:yi("recharts-label",c)},x,b,{breakAll:u}),m)}pK.displayName="Label";var mK=e=>{var{cx:t,cy:n,angle:r,startAngle:i,endAngle:o,r:s,radius:a,innerRadius:l,outerRadius:c,x:u,y:h,top:d,left:f,width:p,height:m,clockWise:g,labelViewBox:_}=e;if(_)return _;if(lR(p)&&lR(m)){if(lR(u)&&lR(h))return{x:u,y:h,width:p,height:m};if(lR(d)&&lR(f))return{x:d,y:f,width:p,height:m}}return lR(u)&&lR(h)?{x:u,y:h,width:0,height:0}:lR(t)&&lR(n)?{cx:t,cy:n,startAngle:i||r||0,endAngle:o||r||0,innerRadius:l||0,outerRadius:c||a||s||0,clockWise:g}:e.viewBox?e.viewBox:void 0};function gK(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}pK.parseViewBox=mK,pK.renderCallByParent=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!e.children&&n&&!e.label)return null;var{children:r,labelRef:o}=e,s=mK(e),a=DX(r,pK).map((e,n)=>(0,i.cloneElement)(e,{viewBox:t||s,key:"label-".concat(n)}));if(!n)return a;var l=((e,t,n)=>{if(!e)return null;var r={viewBox:t,labelRef:n};return!0===e?i.createElement(pK,hK({key:"label-implicit"},r)):cR(e)?i.createElement(pK,hK({key:"label-implicit",value:e},r)):(0,i.isValidElement)(e)?e.type===pK?(0,i.cloneElement)(e,cK({key:"label-implicit"},r)):i.createElement(pK,hK({key:"label-implicit",content:e},r)):dK(e)?i.createElement(pK,hK({key:"label-implicit",content:e},r)):e&&"object"===typeof e?i.createElement(pK,hK({},e,{key:"label-implicit"},r)):null})(e.label,t||s,o);return[l,...a]};class _K{static create(e){return new _K(e)}constructor(e){this.scale=e}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(e){var{bandAware:t,position:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0!==e){if(n)switch(n){case"start":default:return this.scale(e);case"middle":var r=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+r;case"end":var i=this.bandwidth?this.bandwidth():0;return this.scale(e)+i}if(t){var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+o}return this.scale(e)}}isInRange(e){var t=this.range(),n=t[0],r=t[t.length-1];return n<=r?e>=n&&e<=r:e>=r&&e<=n}}gK(_K,"EPS",1e-4);function yK(e,t,n){if(t<1)return[];if(1===t&&void 0===n)return e;for(var r=[],i=0;i<e.length;i+=t){if(void 0!==n&&!0!==n(e[i]))return;r.push(e[i])}return r}function vK(e,t,n){return function(e){var{width:t,height:n}=e,r=function(e){return(e%180+180)%180}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),i=r*Math.PI/180,o=Math.atan(n/t),s=i>o&&i<Math.PI-o?n/Math.sin(i):t/Math.cos(i);return Math.abs(s)}({width:e.width+t.width,height:e.height+t.height},n)}function xK(e,t,n,r,i){if(e*t<e*r||e*t>e*i)return!1;var o=n();return e*(t-e*o/2-r)>=0&&e*(t+e*o/2-i)<=0}function bK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function wK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bK(Object(n),!0).forEach(function(t){SK(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bK(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function SK(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function EK(e,t,n){var r,{tick:i,ticks:o,viewBox:s,minTickGap:a,orientation:l,interval:c,tickFormatter:u,unit:h,angle:d}=e;if(!o||!o.length||!i)return[];if(lR(c)||AZ)return null!==(r=function(e,t){return yK(e,t+1)}(o,lR(c)?c:0))&&void 0!==r?r:[];var f=[],p="top"===l||"bottom"===l?"width":"height",m=h&&"width"===p?NZ(h,{fontSize:t,letterSpacing:n}):{width:0,height:0},g=(e,r)=>{var i="function"===typeof u?u(e.value,r):e.value;return"width"===p?vK(NZ(i,{fontSize:t,letterSpacing:n}),m,d):NZ(i,{fontSize:t,letterSpacing:n})[p]},_=o.length>=2?oR(o[1].coordinate-o[0].coordinate):1,y=function(e,t,n){var r="width"===n,{x:i,y:o,width:s,height:a}=e;return 1===t?{start:r?i:o,end:r?i+s:o+a}:{start:r?i+s:o+a,end:r?i:o}}(s,_,p);return"equidistantPreserveStart"===c?function(e,t,n,r,i){for(var o,s=(r||[]).slice(),{start:a,end:l}=t,c=0,u=1,h=a,d=function(){var t=null===r||void 0===r?void 0:r[c];if(void 0===t)return{v:yK(r,u)};var o,s=c,d=()=>(void 0===o&&(o=n(t,s)),o),f=t.coordinate,p=0===c||xK(e,f,d,h,l);p||(c=0,h=a,u+=1),p&&(h=f+e*(d()/2+i),c+=u)};u<=s.length;)if(o=d())return o.v;return[]}(_,y,g,o,a):(f="preserveStart"===c||"preserveStartEnd"===c?function(e,t,n,r,i,o){var s=(r||[]).slice(),a=s.length,{start:l,end:c}=t;if(o){var u=r[a-1],h=n(u,a-1),d=e*(u.coordinate+e*h/2-c);s[a-1]=u=wK(wK({},u),{},{tickCoord:d>0?u.coordinate-d*e:u.coordinate}),xK(e,u.tickCoord,()=>h,l,c)&&(c=u.tickCoord-e*(h/2+i),s[a-1]=wK(wK({},u),{},{isShow:!0}))}for(var f=o?a-1:a,p=function(t){var r,o=s[t],a=()=>(void 0===r&&(r=n(o,t)),r);if(0===t){var u=e*(o.coordinate-e*a()/2-l);s[t]=o=wK(wK({},o),{},{tickCoord:u<0?o.coordinate-u*e:o.coordinate})}else s[t]=o=wK(wK({},o),{},{tickCoord:o.coordinate});xK(e,o.tickCoord,a,l,c)&&(l=o.tickCoord+e*(a()/2+i),s[t]=wK(wK({},o),{},{isShow:!0}))},m=0;m<f;m++)p(m);return s}(_,y,g,o,a,"preserveStartEnd"===c):function(e,t,n,r,i){for(var o=(r||[]).slice(),s=o.length,{start:a}=t,{end:l}=t,c=function(t){var r,c=o[t],u=()=>(void 0===r&&(r=n(c,t)),r);if(t===s-1){var h=e*(c.coordinate+e*u()/2-l);o[t]=c=wK(wK({},c),{},{tickCoord:h>0?c.coordinate-h*e:c.coordinate})}else o[t]=c=wK(wK({},c),{},{tickCoord:c.coordinate});xK(e,c.tickCoord,u,a,l)&&(l=c.tickCoord-e*(u()/2+i),o[t]=wK(wK({},c),{},{isShow:!0}))},u=s-1;u>=0;u--)c(u);return o}(_,y,g,o,a),f.filter(e=>e.isShow))}var TK=["viewBox"],AK=["viewBox"];function CK(){return CK=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},CK.apply(null,arguments)}function PK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function IK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PK(Object(n),!0).forEach(function(t){MK(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PK(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function kK(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function MK(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class RK extends i.Component{constructor(e){super(e),this.tickRefs=i.createRef(),this.tickRefs.current=[],this.state={fontSize:"",letterSpacing:""}}shouldComponentUpdate(e,t){var{viewBox:n}=e,r=kK(e,TK),i=this.props,{viewBox:o}=i,s=kK(i,AK);return!wZ(n,o)||!wZ(r,s)||!wZ(t,this.state)}getTickLineCoord(e){var t,n,r,i,o,s,{x:a,y:l,width:c,height:u,orientation:h,tickSize:d,mirror:f,tickMargin:p}=this.props,m=f?-1:1,g=e.tickSize||d,_=lR(e.tickCoord)?e.tickCoord:e.coordinate;switch(h){case"top":t=n=e.coordinate,s=(r=(i=l+ +!f*u)-m*g)-m*p,o=_;break;case"left":r=i=e.coordinate,o=(t=(n=a+ +!f*c)-m*g)-m*p,s=_;break;case"right":r=i=e.coordinate,o=(t=(n=a+ +f*c)+m*g)+m*p,s=_;break;default:t=n=e.coordinate,s=(r=(i=l+ +f*u)+m*g)+m*p,o=_}return{line:{x1:t,y1:r,x2:n,y2:i},tick:{x:o,y:s}}}getTickTextAnchor(){var e,{orientation:t,mirror:n}=this.props;switch(t){case"left":e=n?"start":"end";break;case"right":e=n?"end":"start";break;default:e="middle"}return e}getTickVerticalAnchor(){var{orientation:e,mirror:t}=this.props;switch(e){case"left":case"right":return"middle";case"top":return t?"start":"end";default:return t?"end":"start"}}renderAxisLine(){var{x:e,y:t,width:n,height:r,orientation:o,mirror:s,axisLine:a}=this.props,l=IK(IK(IK({},zX(this.props,!1)),zX(a,!1)),{},{fill:"none"});if("top"===o||"bottom"===o){var c=+("top"===o&&!s||"bottom"===o&&s);l=IK(IK({},l),{},{x1:e,y1:t+c*r,x2:e+n,y2:t+c*r})}else{var u=+("left"===o&&!s||"right"===o&&s);l=IK(IK({},l),{},{x1:e+u*n,y1:t,x2:e+u*n,y2:t+r})}return i.createElement("line",CK({},l,{className:yi("recharts-cartesian-axis-line",iR()(a,"className"))}))}static renderTickItem(e,t,n){var r,o=yi(t.className,"recharts-cartesian-axis-tick-value");if(i.isValidElement(e))r=i.cloneElement(e,IK(IK({},t),{},{className:o}));else if("function"===typeof e)r=e(IK(IK({},t),{},{className:o}));else{var s="recharts-cartesian-axis-tick-value";"boolean"!==typeof e&&(s=yi(s,e.className)),r=i.createElement(iK,CK({},t,{className:s}),n)}return r}renderTicks(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],{tickLine:r,stroke:o,tick:s,tickFormatter:a,unit:l,padding:c}=this.props,u=EK(IK(IK({},this.props),{},{ticks:n}),e,t),h=this.getTickTextAnchor(),d=this.getTickVerticalAnchor(),f=kX(this.props),p=zX(s,!1),m=IK(IK({},f),{},{fill:"none"},zX(r,!1)),g=u.map((e,t)=>{var{line:n,tick:g}=this.getTickLineCoord(e),_=IK(IK(IK(IK({textAnchor:h,verticalAnchor:d},f),{},{stroke:"none",fill:o},p),g),{},{index:t,payload:e,visibleTicksCount:u.length,tickFormatter:a,padding:c});return i.createElement(TZ,CK({className:"recharts-cartesian-axis-tick",key:"tick-".concat(e.value,"-").concat(e.coordinate,"-").concat(e.tickCoord)},CX(this.props,e,t)),r&&i.createElement("line",CK({},m,n,{className:yi("recharts-cartesian-axis-tick-line",iR()(r,"className"))})),s&&RK.renderTickItem(s,_,"".concat("function"===typeof a?a(e.value,t):e.value).concat(l||"")))});return g.length>0?i.createElement("g",{className:"recharts-cartesian-axis-ticks"},g):null}render(){var{axisLine:e,width:t,height:n,className:r,hide:o}=this.props;if(o)return null;var{ticks:s}=this.props;return null!=t&&t<=0||null!=n&&n<=0?null:i.createElement(TZ,{className:yi("recharts-cartesian-axis",r),ref:e=>{if(e){var t=e.getElementsByClassName("recharts-cartesian-axis-tick-value");this.tickRefs.current=Array.from(t);var n=t[0];if(n){var r=window.getComputedStyle(n).fontSize,i=window.getComputedStyle(n).letterSpacing;r===this.state.fontSize&&i===this.state.letterSpacing||this.setState({fontSize:window.getComputedStyle(n).fontSize,letterSpacing:window.getComputedStyle(n).letterSpacing})}}}},e&&this.renderAxisLine(),this.renderTicks(this.state.fontSize,this.state.letterSpacing,s),pK.renderCallByParent(this.props))}}MK(RK,"displayName","CartesianAxis"),MK(RK,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var OK=["children"],LK=["dangerouslySetInnerHTML","ticks"];function DK(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NK(){return NK=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},NK.apply(null,arguments)}function zK(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function FK(e){var t=aN(),n=(0,i.useMemo)(()=>{var{children:t}=e;return zK(e,OK)},[e]),r=hN(e=>$G(e,n.id)),o=n===r;return(0,i.useEffect)(()=>(t(hq(n)),()=>{t(dq(n))}),[n,t]),o?e.children:null}var BK=e=>{var{xAxisId:t,className:n}=e,r=hN(az),o=cz(),s="xAxis",a=hN(e=>u$(e,s,t,o)),l=hN(e=>C$(e,s,t,o)),c=hN(e=>_$(e,t)),u=hN(e=>((e,t)=>{var n=oz(e),r=$G(e,t);if(null!=r){var i=y$(e,r.orientation,r.mirror)[t];return null==i?{x:n.left,y:0}:{x:n.left,y:i}}})(e,t));if(null==c||null==u)return null;var{dangerouslySetInnerHTML:h,ticks:d}=e,f=zK(e,LK);return i.createElement(RK,NK({},f,{scale:a,x:u.x,y:u.y,width:c.width,height:c.height,className:yi("recharts-".concat(s," ").concat(s),n),viewBox:r,ticks:l}))},jK=e=>{var t,n,r,o,s;return i.createElement(FK,{interval:null!==(t=e.interval)&&void 0!==t?t:"preserveEnd",id:e.xAxisId,scale:e.scale,type:e.type,padding:e.padding,allowDataOverflow:e.allowDataOverflow,domain:e.domain,dataKey:e.dataKey,allowDuplicatedCategory:e.allowDuplicatedCategory,allowDecimals:e.allowDecimals,tickCount:e.tickCount,includeHidden:null!==(n=e.includeHidden)&&void 0!==n&&n,reversed:e.reversed,ticks:e.ticks,height:e.height,orientation:e.orientation,mirror:e.mirror,hide:e.hide,unit:e.unit,name:e.name,angle:null!==(r=e.angle)&&void 0!==r?r:0,minTickGap:null!==(o=e.minTickGap)&&void 0!==o?o:5,tick:null===(s=e.tick)||void 0===s||s,tickFormatter:e.tickFormatter},i.createElement(BK,e))};class UK extends i.Component{render(){return i.createElement(jK,this.props)}}DK(UK,"displayName","XAxis"),DK(UK,"defaultProps",{allowDataOverflow:HG.allowDataOverflow,allowDecimals:HG.allowDecimals,allowDuplicatedCategory:HG.allowDuplicatedCategory,height:HG.height,hide:!1,mirror:HG.mirror,orientation:HG.orientation,padding:HG.padding,reversed:HG.reversed,scale:HG.scale,tickCount:HG.tickCount,type:HG.type,xAxisId:0});var VK=["dangerouslySetInnerHTML","ticks"];function GK(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function HK(){return HK=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},HK.apply(null,arguments)}function $K(e){var t=aN();return(0,i.useEffect)(()=>(t(fq(e)),()=>{t(pq(e))}),[e,t]),null}var WK=e=>{var t,{yAxisId:n,className:r,width:o,label:s}=e,a=(0,i.useRef)(null),l=(0,i.useRef)(null),c=hN(az),u=cz(),h=aN(),d="yAxis",f=hN(e=>u$(e,d,n,u)),p=hN(e=>x$(e,n)),m=hN(e=>((e,t)=>{var n=oz(e),r=qG(e,t);if(null!=r){var i=v$(e,r.orientation,r.mirror)[t];return null==i?{x:0,y:n.top}:{x:i,y:n.top}}})(e,n)),g=hN(e=>C$(e,d,n,u));if((0,i.useLayoutEffect)(()=>{var e;if("auto"===o&&p&&!dK(s)&&!(0,i.isValidElement)(s)){var t=a.current,r=null===t||void 0===t||null===(e=t.tickRefs)||void 0===e?void 0:e.current,{tickSize:c,tickMargin:u}=t.props,d=(e=>{var{ticks:t,label:n,labelGapWithTick:r=5,tickSize:i=0,tickMargin:o=0}=e,s=0;if(t){t.forEach(e=>{if(e){var t=e.getBoundingClientRect();t.width>s&&(s=t.width)}});var a=n?n.getBoundingClientRect().width:0,l=s+(i+o)+a+(n?r:0);return Math.round(l)}return 0})({ticks:r,label:l.current,labelGapWithTick:5,tickSize:c,tickMargin:u});Math.round(p.width)!==Math.round(d)&&h(_q({id:n,width:d}))}},[a,null===a||void 0===a||null===(t=a.current)||void 0===t||null===(t=t.tickRefs)||void 0===t?void 0:t.current,null===p||void 0===p?void 0:p.width,p,h,s,n,o]),null==p||null==m)return null;var{dangerouslySetInnerHTML:_,ticks:y}=e,v=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,VK);return i.createElement(RK,HK({},v,{ref:a,labelRef:l,scale:f,x:m.x,y:m.y,width:p.width,height:p.height,className:yi("recharts-".concat(d," ").concat(d),r),viewBox:c,ticks:g}))},qK=e=>{var t,n,r,o,s;return i.createElement(i.Fragment,null,i.createElement($K,{interval:null!==(t=e.interval)&&void 0!==t?t:"preserveEnd",id:e.yAxisId,scale:e.scale,type:e.type,domain:e.domain,allowDataOverflow:e.allowDataOverflow,dataKey:e.dataKey,allowDuplicatedCategory:e.allowDuplicatedCategory,allowDecimals:e.allowDecimals,tickCount:e.tickCount,padding:e.padding,includeHidden:null!==(n=e.includeHidden)&&void 0!==n&&n,reversed:e.reversed,ticks:e.ticks,width:e.width,orientation:e.orientation,mirror:e.mirror,hide:e.hide,unit:e.unit,name:e.name,angle:null!==(r=e.angle)&&void 0!==r?r:0,minTickGap:null!==(o=e.minTickGap)&&void 0!==o?o:5,tick:null===(s=e.tick)||void 0===s||s,tickFormatter:e.tickFormatter}),i.createElement(WK,e))},XK={allowDataOverflow:WG.allowDataOverflow,allowDecimals:WG.allowDecimals,allowDuplicatedCategory:WG.allowDuplicatedCategory,hide:!1,mirror:WG.mirror,orientation:WG.orientation,padding:WG.padding,reversed:WG.reversed,scale:WG.scale,tickCount:WG.tickCount,type:WG.type,width:WG.width,yAxisId:0};class ZK extends i.Component{render(){return i.createElement(qK,this.props)}}GK(ZK,"displayName","YAxis"),GK(ZK,"defaultProps",XK);var KK=["x1","y1","x2","y2","key"],YK=["offset"],JK=["xAxisId","yAxisId"],QK=["xAxisId","yAxisId"];function eY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eY(Object(n),!0).forEach(function(t){nY(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nY(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rY(){return rY=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},rY.apply(null,arguments)}function iY(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var oY=e=>{var{fill:t}=e;if(!t||"none"===t)return null;var{fillOpacity:n,x:r,y:o,width:s,height:a,ry:l}=e;return i.createElement("rect",{x:r,y:o,ry:l,width:s,height:a,stroke:"none",fill:t,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function sY(e,t){var n;if(i.isValidElement(e))n=i.cloneElement(e,t);else if("function"===typeof e)n=e(t);else{var{x1:r,y1:o,x2:s,y2:a,key:l}=t,c=kX(iY(t,KK)),{offset:u}=c,h=iY(c,YK);n=i.createElement("line",rY({},h,{x1:r,y1:o,x2:s,y2:a,fill:"none",key:l}))}return n}function aY(e){var{x:t,width:n,horizontal:r=!0,horizontalPoints:o}=e;if(!r||!o||!o.length)return null;var{xAxisId:s,yAxisId:a}=e,l=iY(e,JK),c=o.map((e,i)=>{var o=tY(tY({},l),{},{x1:t,y1:e,x2:t+n,y2:e,key:"line-".concat(i),index:i});return sY(r,o)});return i.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function lY(e){var{y:t,height:n,vertical:r=!0,verticalPoints:o}=e;if(!r||!o||!o.length)return null;var{xAxisId:s,yAxisId:a}=e,l=iY(e,QK),c=o.map((e,i)=>{var o=tY(tY({},l),{},{x1:e,y1:t,x2:e,y2:t+n,key:"line-".concat(i),index:i});return sY(r,o)});return i.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function cY(e){var{horizontalFill:t,fillOpacity:n,x:r,y:o,width:s,height:a,horizontalPoints:l,horizontal:c=!0}=e;if(!c||!t||!t.length)return null;var u=l.map(e=>Math.round(e+o-o)).sort((e,t)=>e-t);o!==u[0]&&u.unshift(0);var h=u.map((e,l)=>{var c=!u[l+1]?o+a-e:u[l+1]-e;if(c<=0)return null;var h=l%t.length;return i.createElement("rect",{key:"react-".concat(l),y:e,x:r,height:c,width:s,stroke:"none",fill:t[h],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return i.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},h)}function uY(e){var{vertical:t=!0,verticalFill:n,fillOpacity:r,x:o,y:s,width:a,height:l,verticalPoints:c}=e;if(!t||!n||!n.length)return null;var u=c.map(e=>Math.round(e+o-o)).sort((e,t)=>e-t);o!==u[0]&&u.unshift(0);var h=u.map((e,t)=>{var c=!u[t+1]?o+a-e:u[t+1]-e;if(c<=0)return null;var h=t%n.length;return i.createElement("rect",{key:"react-".concat(t),x:e,y:s,width:c,height:l,stroke:"none",fill:n[h],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return i.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},h)}var hY=(e,t)=>{var{xAxis:n,width:r,height:i,offset:o}=e;return NN(EK(tY(tY(tY({},RK.defaultProps),n),{},{ticks:zN(n,!0),viewBox:{x:0,y:0,width:r,height:i}})),o.left,o.left+o.width,t)},dY=(e,t)=>{var{yAxis:n,width:r,height:i,offset:o}=e;return NN(EK(tY(tY(tY({},RK.defaultProps),n),{},{ticks:zN(n,!0),viewBox:{x:0,y:0,width:r,height:i}})),o.top,o.top+o.height,t)},fY={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0};function pY(e){var t=mz(),n=gz(),r=pz(),o=tY(tY({},mZ(e,fY)),{},{x:lR(e.x)?e.x:r.left,y:lR(e.y)?e.y:r.top,width:lR(e.width)?e.width:r.width,height:lR(e.height)?e.height:r.height}),{xAxisId:s,yAxisId:a,x:l,y:c,width:u,height:h,syncWithTicks:d,horizontalValues:f,verticalValues:p}=o,m=cz(),g=hN(e=>A$(e,"xAxis",s,m)),_=hN(e=>A$(e,"yAxis",a,m));if(!lR(u)||u<=0||!lR(h)||h<=0||!lR(l)||l!==+l||!lR(c)||c!==+c)return null;var y=o.verticalCoordinatesGenerator||hY,v=o.horizontalCoordinatesGenerator||dY,{horizontalPoints:x,verticalPoints:b}=o;if((!x||!x.length)&&"function"===typeof v){var w=f&&f.length,S=v({yAxis:_?tY(tY({},_),{},{ticks:w?f:_.ticks}):void 0,width:t,height:n,offset:r},!!w||d);yR(Array.isArray(S),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof S,"]")),Array.isArray(S)&&(x=S)}if((!b||!b.length)&&"function"===typeof y){var E=p&&p.length,T=y({xAxis:g?tY(tY({},g),{},{ticks:E?p:g.ticks}):void 0,width:t,height:n,offset:r},!!E||d);yR(Array.isArray(T),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof T,"]")),Array.isArray(T)&&(b=T)}return i.createElement("g",{className:"recharts-cartesian-grid"},i.createElement(oY,{fill:o.fill,fillOpacity:o.fillOpacity,x:o.x,y:o.y,width:o.width,height:o.height,ry:o.ry}),i.createElement(cY,rY({},o,{horizontalPoints:x})),i.createElement(uY,rY({},o,{verticalPoints:b})),i.createElement(aY,rY({},o,{offset:r,horizontalPoints:x,xAxis:g,yAxis:_})),i.createElement(lY,rY({},o,{offset:r,verticalPoints:b,xAxis:g,yAxis:_})))}function mY(){}function gY(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function _Y(e){this._context=e}function yY(e){this._context=e}function vY(e){this._context=e}pY.displayName="CartesianGrid",_Y.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:gY(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:gY(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},yY.prototype={areaStart:mY,areaEnd:mY,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:gY(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},vY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:gY(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};class xY{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t)}this._x0=e,this._y0=t}}function bY(e){this._context=e}function wY(e){this._context=e}function SY(e){return new wY(e)}function EY(e){return e<0?-1:1}function TY(e,t,n){var r=e._x1-e._x0,i=t-e._x1,o=(e._y1-e._y0)/(r||i<0&&-0),s=(n-e._y1)/(i||r<0&&-0),a=(o*i+s*r)/(r+i);return(EY(o)+EY(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(a))||0}function AY(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function CY(e,t,n){var r=e._x0,i=e._y0,o=e._x1,s=e._y1,a=(o-r)/3;e._context.bezierCurveTo(r+a,i+a*t,o-a,s-a*n,o,s)}function PY(e){this._context=e}function IY(e){this._context=new kY(e)}function kY(e){this._context=e}function MY(e){this._context=e}function RY(e){var t,n,r=e.length-1,i=new Array(r),o=new Array(r),s=new Array(r);for(i[0]=0,o[0]=2,s[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,o[t]=4,s[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,o[r-1]=7,s[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/o[t-1],o[t]-=n,s[t]-=n*s[t-1];for(i[r-1]=s[r-1]/o[r-1],t=r-2;t>=0;--t)i[t]=(s[t]-i[t+1])/o[t];for(o[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-i[t+1];return[i,o]}function OY(e,t){this._context=e,this._t=t}bY.prototype={areaStart:mY,areaEnd:mY,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},wY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}},PY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:CY(this,this._t0,AY(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,CY(this,AY(this,n=TY(this,e,t)),n);break;default:CY(this,this._t0,n=TY(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(IY.prototype=Object.create(PY.prototype)).point=function(e,t){PY.prototype.point.call(this,t,e)},kY.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,o){this._context.bezierCurveTo(t,e,r,n,o,i)}},MY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=RY(e),i=RY(t),o=0,s=1;s<n;++o,++s)this._context.bezierCurveTo(r[0][o],i[0][o],r[1][o],i[1][o],e[s],t[s]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},OY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const LY=Math.PI,DY=2*LY,NY=1e-6,zY=DY-NY;function FY(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class BY{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?FY:function(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return FY;const n=10**t;return function(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=Math.round(arguments[t]*n)/n+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,r){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(e,t,n,r,i,o){this._append`C${+e},${+t},${+n},${+r},${this._x1=+i},${this._y1=+o}`}arcTo(e,t,n,r,i){if(e=+e,t=+t,n=+n,r=+r,(i=+i)<0)throw new Error(`negative radius: ${i}`);let o=this._x1,s=this._y1,a=n-e,l=r-t,c=o-e,u=s-t,h=c*c+u*u;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(h>NY)if(Math.abs(u*a-l*c)>NY&&i){let d=n-o,f=r-s,p=a*a+l*l,m=d*d+f*f,g=Math.sqrt(p),_=Math.sqrt(h),y=i*Math.tan((LY-Math.acos((p+h-m)/(2*g*_)))/2),v=y/_,x=y/g;Math.abs(v-1)>NY&&this._append`L${e+v*c},${t+v*u}`,this._append`A${i},${i},0,0,${+(u*d>c*f)},${this._x1=e+x*a},${this._y1=t+x*l}`}else this._append`L${this._x1=e},${this._y1=t}`;else;}arc(e,t,n,r,i,o){if(e=+e,t=+t,o=!!o,(n=+n)<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(r),a=n*Math.sin(r),l=e+s,c=t+a,u=1^o,h=o?r-i:i-r;null===this._x1?this._append`M${l},${c}`:(Math.abs(this._x1-l)>NY||Math.abs(this._y1-c)>NY)&&this._append`L${l},${c}`,n&&(h<0&&(h=h%DY+DY),h>zY?this._append`A${n},${n},0,1,${u},${e-s},${t-a}A${n},${n},0,1,${u},${this._x1=l},${this._y1=c}`:h>NY&&this._append`A${n},${n},0,${+(h>=LY)},${u},${this._x1=e+n*Math.cos(i)},${this._y1=t+n*Math.sin(i)}`)}rect(e,t,n,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function jY(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(null==n)t=null;else{const e=Math.floor(n);if(!(e>=0))throw new RangeError(`invalid digits: ${n}`);t=e}return e},()=>new BY(t)}function UY(e){return e[0]}function VY(e){return e[1]}function GY(e,t){var n=_N(!0),r=null,i=SY,o=null,s=jY(a);function a(a){var l,c,u,h=(a=gN(a)).length,d=!1;for(null==r&&(o=i(u=s())),l=0;l<=h;++l)!(l<h&&n(c=a[l],l,a))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+e(c,l,a),+t(c,l,a));if(u)return o=null,u+""||null}return e="function"===typeof e?e:void 0===e?UY:_N(e),t="function"===typeof t?t:void 0===t?VY:_N(t),a.x=function(t){return arguments.length?(e="function"===typeof t?t:_N(+t),a):e},a.y=function(e){return arguments.length?(t="function"===typeof e?e:_N(+e),a):t},a.defined=function(e){return arguments.length?(n="function"===typeof e?e:_N(!!e),a):n},a.curve=function(e){return arguments.length?(i=e,null!=r&&(o=i(r)),a):i},a.context=function(e){return arguments.length?(null==e?r=o=null:o=i(r=e),a):r},a}function HY(e,t,n){var r=null,i=_N(!0),o=null,s=SY,a=null,l=jY(c);function c(c){var u,h,d,f,p,m=(c=gN(c)).length,g=!1,_=new Array(m),y=new Array(m);for(null==o&&(a=s(p=l())),u=0;u<=m;++u){if(!(u<m&&i(f=c[u],u,c))===g)if(g=!g)h=u,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),d=u-1;d>=h;--d)a.point(_[d],y[d]);a.lineEnd(),a.areaEnd()}g&&(_[u]=+e(f,u,c),y[u]=+t(f,u,c),a.point(r?+r(f,u,c):_[u],n?+n(f,u,c):y[u]))}if(p)return a=null,p+""||null}function u(){return GY().defined(i).curve(s).context(o)}return e="function"===typeof e?e:void 0===e?UY:_N(+e),t="function"===typeof t?t:_N(void 0===t?0:+t),n="function"===typeof n?n:void 0===n?VY:_N(+n),c.x=function(t){return arguments.length?(e="function"===typeof t?t:_N(+t),r=null,c):e},c.x0=function(t){return arguments.length?(e="function"===typeof t?t:_N(+t),c):e},c.x1=function(e){return arguments.length?(r=null==e?null:"function"===typeof e?e:_N(+e),c):r},c.y=function(e){return arguments.length?(t="function"===typeof e?e:_N(+e),n=null,c):t},c.y0=function(e){return arguments.length?(t="function"===typeof e?e:_N(+e),c):t},c.y1=function(e){return arguments.length?(n=null==e?null:"function"===typeof e?e:_N(+e),c):n},c.lineX0=c.lineY0=function(){return u().x(e).y(t)},c.lineY1=function(){return u().x(e).y(n)},c.lineX1=function(){return u().x(r).y(t)},c.defined=function(e){return arguments.length?(i="function"===typeof e?e:_N(!!e),c):i},c.curve=function(e){return arguments.length?(s=e,null!=o&&(a=s(o)),c):s},c.context=function(e){return arguments.length?(null==e?o=a=null:a=s(o=e),c):o},c}function $Y(){return $Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$Y.apply(null,arguments)}function WY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WY(Object(n),!0).forEach(function(t){XY(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function XY(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ZY={curveBasisClosed:function(e){return new yY(e)},curveBasisOpen:function(e){return new vY(e)},curveBasis:function(e){return new _Y(e)},curveBumpX:function(e){return new xY(e,!0)},curveBumpY:function(e){return new xY(e,!1)},curveLinearClosed:function(e){return new bY(e)},curveLinear:SY,curveMonotoneX:function(e){return new PY(e)},curveMonotoneY:function(e){return new IY(e)},curveNatural:function(e){return new MY(e)},curveStep:function(e){return new OY(e,.5)},curveStepAfter:function(e){return new OY(e,1)},curveStepBefore:function(e){return new OY(e,0)}},KY=e=>RV(e.x)&&RV(e.y),YY=e=>e.x,JY=e=>e.y,QY=e=>{var t,{type:n="linear",points:r=[],baseLine:i,layout:o,connectNulls:s=!1}=e,a=((e,t)=>{if("function"===typeof e)return e;var n="curve".concat(_R(e));return"curveMonotone"!==n&&"curveBump"!==n||!t?ZY[n]||SY:ZY["".concat(n).concat("vertical"===t?"Y":"X")]})(n,o),l=s?r.filter(KY):r;if(Array.isArray(i)){var c=s?i.filter(e=>KY(e)):i,u=l.map((e,t)=>qY(qY({},e),{},{base:c[t]}));return t="vertical"===o?HY().y(JY).x1(YY).x0(e=>e.base.x):HY().x(YY).y1(JY).y0(e=>e.base.y),t.defined(KY).curve(a),t(u)}return(t="vertical"===o&&lR(i)?HY().y(JY).x1(YY).x0(i):lR(i)?HY().x(YY).y1(JY).y0(i):GY().x(YY).y(JY)).defined(KY).curve(a),t(l)},eJ=e=>{var{className:t,points:n,path:r,pathRef:o}=e;if((!n||!n.length)&&!r)return null;var s=n&&n.length?QY(e):r;return i.createElement("path",$Y({},kX(e),AX(e),{className:yi("recharts-curve",t),d:null===s?void 0:s,ref:o}))};function tJ(){return tJ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},tJ.apply(null,arguments)}var nJ=e=>{var{cx:t,cy:n,r:r,className:o}=e,s=yi("recharts-dot",o);return t===+t&&n===+n&&r===+r?i.createElement("circle",tJ({},kX(e),AX(e),{className:s,cx:t,cy:n,r:r})):null},rJ=n(356),iJ=n.n(rJ),oJ=["valueAccessor"],sJ=["data","dataKey","clockWise","id","textBreakAll"];function aJ(){return aJ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},aJ.apply(null,arguments)}function lJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cJ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lJ(Object(n),!0).forEach(function(t){uJ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lJ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function uJ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hJ(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var dJ=e=>Array.isArray(e.value)?iJ()(e.value):e.value;function fJ(e){var{valueAccessor:t=dJ}=e,n=hJ(e,oJ),{data:r,dataKey:o,clockWise:s,id:a,textBreakAll:l}=n,c=hJ(n,sJ);return r&&r.length?i.createElement(TZ,{className:"recharts-label-list"},r.map((e,n)=>{var r=gR(o)?t(e,n):LN(e&&e.payload,o),u=gR(a)?{}:{id:"".concat(a,"-").concat(n)};return i.createElement(pK,aJ({},zX(e,!0),c,u,{parentViewBox:e.parentViewBox,value:r,textBreakAll:l,viewBox:pK.parseViewBox(gR(s)?e:cJ(cJ({},e),{},{clockWise:s})),key:"label-".concat(n),index:n}))})):null}function pJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function mJ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pJ(Object(n),!0).forEach(function(t){gJ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pJ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function gJ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}fJ.displayName="LabelList",fJ.renderCallByParent=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!e.children&&n&&!e.label)return null;var{children:r}=e,o=DX(r,fJ).map((e,n)=>(0,i.cloneElement)(e,{data:t,key:"labelList-".concat(n)}));if(!n)return o;var s=function(e,t){return e?!0===e?i.createElement(fJ,{key:"labelList-implicit",data:t}):i.isValidElement(e)||dK(e)?i.createElement(fJ,{key:"labelList-implicit",data:t,content:e}):"object"===typeof e?i.createElement(fJ,aJ({data:t},e,{key:"labelList-implicit"})):null:null}(e.label,t);return[s,...o]};function _J(e){var{points:t,mainColor:n,activeDot:r,itemDataKey:o}=e,s=hN(RW),a=hN(jW);if(null==t||null==a)return null;var l=t.find(e=>a.includes(e.payload));return gR(l)?null:(e=>{var{point:t,childIndex:n,mainColor:r,activeDot:o,dataKey:s}=e;if(!1===o||null==t.x||null==t.y)return null;var a,l=mJ(mJ({index:n,dataKey:s,cx:t.x,cy:t.y,r:4,fill:null!==r&&void 0!==r?r:"none",strokeWidth:2,stroke:"#fff",payload:t.payload,value:t.value},zX(o,!1)),AX(o));return a=(0,i.isValidElement)(o)?(0,i.cloneElement)(o,l):"function"===typeof o?o(l):i.createElement(nJ,l),i.createElement(TZ,{className:"recharts-active-dot"},a)})({point:l,childIndex:Number(s),mainColor:n,dataKey:o,activeDot:r})}function yJ(e){var{fn:t,args:n}=e,r=aN(),o=cz();return(0,i.useEffect)(()=>{if(!o){var e=t(n);return r(AD(e)),()=>{r(CD(e))}}},[t,n,r,o]),null}var vJ=["children"];var xJ={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},bJ=(0,i.createContext)(xJ);function wJ(e){var{children:t}=e,n=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,vJ);return i.createElement(bJ.Provider,{value:n},t)}function SJ(e,t){var n,r,i=hN(t=>$G(t,e)),o=hN(e=>qG(e,t)),s=null!==(n=null===i||void 0===i?void 0:i.allowDataOverflow)&&void 0!==n?n:HG.allowDataOverflow,a=null!==(r=null===o||void 0===o?void 0:o.allowDataOverflow)&&void 0!==r?r:WG.allowDataOverflow;return{needClip:s||a,needClipX:s,needClipY:a}}function EJ(e){var{xAxisId:t,yAxisId:n,clipPathId:r}=e,o=lZ(),{needClipX:s,needClipY:a,needClip:l}=SJ(t,n);if(!l)return null;var{x:c,y:u,width:h,height:d}=o;return i.createElement("clipPath",{id:"clipPath-".concat(r)},i.createElement("rect",{x:s?c:c-h/2,y:a?u:u-d/2,width:s?h:2*h,height:a?d:2*d}))}var TJ=(e,t,n,r)=>I$(e,"xAxis",t,r),AJ=(e,t,n,r)=>P$(e,"xAxis",t,r),CJ=(e,t,n,r)=>I$(e,"yAxis",n,r),PJ=(e,t,n,r)=>P$(e,"yAxis",n,r),IJ=nN([_z,TJ,CJ,AJ,PJ],(e,t,n,r,i)=>DN(e,"xAxis")?qN(t,r,!1):qN(n,i,!1));function kJ(e){return"line"===e.type}var MJ,RJ=nN([eH,(e,t,n,r,i)=>i],(e,t)=>e.filter(kJ).find(e=>e.id===t)),OJ=nN([_z,TJ,CJ,AJ,PJ,RJ,IJ,MV],(e,t,n,r,i,o,s,a)=>{var{chartData:l,dataStartIndex:c,dataEndIndex:u}=a;if(null!=o&&null!=t&&null!=n&&null!=r&&null!=i&&0!==r.length&&0!==i.length&&null!=s){var h,{dataKey:d,data:f}=o;if(null!=(h=null!=f&&f.length>0?f:null===l||void 0===l?void 0:l.slice(c,u+1)))return function(e){var{layout:t,xAxis:n,yAxis:r,xAxisTicks:i,yAxisTicks:o,dataKey:s,bandSize:a,displayedData:l}=e;return l.map((e,l)=>{var c=LN(e,s);if("horizontal"===t)return{x:VN({axis:n,ticks:i,bandSize:a,entry:e,index:l}),y:gR(c)?null:r.scale(c),value:c,payload:e};var u=gR(c)?null:n.scale(c),h=VN({axis:r,ticks:o,bandSize:a,entry:e,index:l});return null==u||null==h?null:{x:u,y:h,value:c,payload:e}}).filter(Boolean)}({layout:e,xAxis:t,yAxis:n,xAxisTicks:r,yAxisTicks:i,dataKey:d,bandSize:s,displayedData:h})}}),LJ=()=>{};function DJ(e){var{legendPayload:t}=e,n=aN(),r=cz();return(0,i.useEffect)(()=>r?LJ:(n(Uq(t)),()=>{n(Vq(t))}),[n,r,t]),null}function NJ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"animation-",n=(0,i.useRef)(hR(t)),r=(0,i.useRef)(e);return r.current!==e&&(n.current=hR(t),r.current=e),n.current}var zJ=null!==(MJ=o["useId".toString()])&&void 0!==MJ?MJ:()=>{var[e]=i.useState(()=>hR("uid-"));return e};var FJ=(0,i.createContext)(void 0),BJ=e=>{var{id:t,type:n,children:r}=e,o=function(e,t){var n=zJ();return t||(e?"".concat(e,"-").concat(n):n)}("recharts-".concat(n),t);return i.createElement(FJ.Provider,{value:o},r(o))};function jJ(e){var t=aN(),n=(0,i.useRef)(null);return(0,i.useEffect)(()=>{null===n.current?t(xq(e)):n.current!==e&&t(bq({prev:n.current,next:e})),n.current=e},[t,e]),(0,i.useEffect)(()=>()=>{n.current&&(t(wq(n.current)),n.current=null)},[t]),null}function UJ(){}function VJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function GJ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VJ(Object(n),!0).forEach(function(t){HJ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VJ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function HJ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $J=(e,t)=>Object.keys(t).reduce((n,r)=>GJ(GJ({},n),{},{[r]:e(r,t[r])}),{});function WJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qJ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WJ(Object(n),!0).forEach(function(t){XJ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WJ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function XJ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ZJ=(e,t,n)=>e+(t-e)*n,KJ=e=>{var{from:t,to:n}=e;return t!==n},YJ=(e,t,n)=>{var r=$J((t,n)=>{if(KJ(n)){var[r,i]=e(n.from,n.to,n.velocity);return qJ(qJ({},n),{},{from:r,velocity:i})}return n},t);return n<1?$J((e,t)=>KJ(t)?qJ(qJ({},t),{},{velocity:ZJ(t.velocity,r[e].velocity,n),from:ZJ(t.from,r[e].from,n)}):t,t):YJ(e,r,n-1)};function JJ(e,t,n,r,i,o){var s,a=r.reduce((n,r)=>qJ(qJ({},n),{},{[r]:{from:e[r],velocity:0,to:t[r]}}),{}),l=null,c=r=>{s||(s=r);var u=(r-s)/n.dt;a=YJ(n,a,u),i(qJ(qJ(qJ({},e),t),$J((e,t)=>t.from,a))),s=r,Object.values(a).filter(KJ).length&&(l=o.setTimeout(c))};return()=>(l=o.setTimeout(c),()=>{l()})}const QJ=(e,t,n,r,i,o)=>{var s,a,l=(s=e,a=t,[Object.keys(s),Object.keys(a)].reduce((e,t)=>e.filter(e=>t.includes(e))));return!0===n.isStepper?JJ(e,t,n,l,i,o):function(e,t,n,r,i,o,s){var a,l=null,c=i.reduce((n,r)=>qJ(qJ({},n),{},{[r]:[e[r],t[r]]}),{}),u=i=>{a||(a=i);var h=(i-a)/r,d=$J((e,t)=>ZJ(...t,n(h)),c);if(o(qJ(qJ(qJ({},e),t),d)),h<1)l=s.setTimeout(u);else{var f=$J((e,t)=>ZJ(...t,n(1)),c);o(qJ(qJ(qJ({},e),t),f))}};return()=>(l=s.setTimeout(u),()=>{l()})}(e,t,n,r,l,i,o)};var eQ=1e-4,tQ=(e,t)=>[0,3*e,3*t-6*e,3*e-3*t+1],nQ=(e,t)=>e.map((e,n)=>e*t**n).reduce((e,t)=>e+t),rQ=(e,t)=>n=>{var r=tQ(e,t);return nQ(r,n)},iQ=function(){for(var e,t,n,r,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];if(1===o.length)switch(o[0]){case"linear":[e,n,t,r]=[0,0,1,1];break;case"ease":[e,n,t,r]=[.25,.1,.25,1];break;case"ease-in":[e,n,t,r]=[.42,0,1,1];break;case"ease-out":[e,n,t,r]=[.42,0,.58,1];break;case"ease-in-out":[e,n,t,r]=[0,0,.58,1];break;default:var a=o[0].split("(");"cubic-bezier"===a[0]&&4===a[1].split(")")[0].split(",").length&&([e,n,t,r]=a[1].split(")")[0].split(",").map(e=>parseFloat(e)))}else 4===o.length&&([e,n,t,r]=o);var l,c,u=rQ(e,t),h=rQ(n,r),d=(l=e,c=t,e=>{var t=[...tQ(l,c).map((e,t)=>e*t).slice(1),0];return nQ(t,e)}),f=e=>e>1?1:e<0?0:e,p=e=>{for(var t=e>1?1:e,n=t,r=0;r<8;++r){var i=u(n)-t,o=d(n);if(Math.abs(i-t)<eQ||o<eQ)return h(n);n=f(n-i/o)}return h(n)};return p.isStepper=!1,p},oQ=e=>{if("string"===typeof e)switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return iQ(e);case"spring":return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stiff:t=100,damping:n=8,dt:r=17}=e,i=(e,i,o)=>{var s=o+(-(e-i)*t-o*n)*r/1e3,a=o*r/1e3+e;return Math.abs(a-i)<eQ&&Math.abs(s)<eQ?[i,0]:[a,s]};return i.isStepper=!0,i.dt=r,i}();default:if("cubic-bezier"===e.split("(")[0])return iQ(e)}return"function"===typeof e?e:null};class sQ{setTimeout(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=performance.now(),r=null,i=o=>{o-n>=t?e(o):"function"===typeof requestAnimationFrame&&(r=requestAnimationFrame(i))};return r=requestAnimationFrame(i),()=>{cancelAnimationFrame(r)}}}function aQ(){return function(e){var t=()=>null,n=!1,r=null,i=o=>{if(!n){if(Array.isArray(o)){if(!o.length)return;var s=o,[a,...l]=s;return"number"===typeof a?void(r=e.setTimeout(i.bind(null,l),a)):(i(a),void(r=e.setTimeout(i.bind(null,l))))}"string"===typeof o&&t(o),"object"===typeof o&&t(o),"function"===typeof o&&o()}};return{stop:()=>{n=!0},start:e=>{n=!1,r&&(r(),r=null),i(e)},subscribe:e=>(t=e,()=>{t=()=>null}),getTimeoutController:()=>e}}(new sQ)}var lQ=(0,i.createContext)(aQ);function cQ(e,t){var n=(0,i.useContext)(lQ);return(0,i.useMemo)(()=>null!==t&&void 0!==t?t:n(e),[e,t,n])}var uQ={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},hQ={t:0},dQ={t:1};function fQ(e){var t=mZ(e,uQ),{isActive:n,canBegin:r,duration:o,easing:s,begin:a,onAnimationEnd:l,onAnimationStart:c,children:u}=t,h=cQ("JavascriptAnimate",t.animationManager),[d,f]=(0,i.useState)(n?hQ:dQ),p=(0,i.useRef)(null);return(0,i.useEffect)(()=>{n||f(dQ)},[n]),(0,i.useEffect)(()=>{if(!n||!r)return UJ;var e=QJ(hQ,dQ,oQ(s),o,f,h.getTimeoutController());return h.start([c,a,()=>{p.current=e()},o,l]),()=>{h.stop(),p.current&&p.current(),l()}},[n,r,o,s,a,c,l,h]),u(d.t)}var pQ=["id"],mQ=["type","layout","connectNulls","needClip"],gQ=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function _Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function yQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_Q(Object(n),!0).forEach(function(t){vQ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_Q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function vQ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xQ(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function bQ(){return bQ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bQ.apply(null,arguments)}var wQ=e=>{var{dataKey:t,name:n,stroke:r,legendType:i,hide:o}=e;return[{inactive:o,dataKey:t,type:i,color:r,value:ZN(n,t),payload:e}]};function SQ(e){var{dataKey:t,data:n,stroke:r,strokeWidth:i,fill:o,name:s,hide:a,unit:l}=e;return{dataDefinedOnItem:n,positions:void 0,settings:{stroke:r,strokeWidth:i,fill:o,dataKey:t,nameKey:void 0,name:ZN(s,t),hide:a,type:e.tooltipType,color:e.stroke,unit:l}}}var EQ=(e,t)=>"".concat(t,"px ").concat(e-t,"px");function TQ(e,t){for(var n=e.length%2!==0?[...e,0]:e,r=[],i=0;i<t;++i)r=[...r,...n];return r}function AQ(e){var{clipPathId:t,points:n,props:r}=e,{dot:o,dataKey:s,needClip:a}=r;if(!function(e,t){return null!=e&&(!!t||1===e.length)}(n,o))return null;var{id:l}=r,c=xQ(r,pQ),u=NX(o),h=kX(c),d=zX(o,!0),f=n.map((e,t)=>{var r=yQ(yQ(yQ({key:"dot-".concat(t),r:3},h),d),{},{index:t,cx:e.x,cy:e.y,dataKey:s,value:e.value,payload:e.payload,points:n});return function(e,t){var n;if(i.isValidElement(e))n=i.cloneElement(e,t);else if("function"===typeof e)n=e(t);else{var r=yi("recharts-line-dot","boolean"!==typeof e?e.className:"");n=i.createElement(nJ,bQ({},t,{className:r}))}return n}(o,r)}),p={clipPath:a?"url(#clipPath-".concat(u?"":"dots-").concat(t,")"):void 0};return i.createElement(TZ,bQ({className:"recharts-line-dots",key:"dots"},p),f)}function CQ(e){var{clipPathId:t,pathRef:n,points:r,strokeDasharray:o,props:s,showLabels:a}=e,{type:l,layout:c,connectNulls:u,needClip:h}=s,d=xQ(s,mQ),f=yQ(yQ({},zX(d,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:h?"url(#clipPath-".concat(t,")"):void 0,points:r,type:l,layout:c,connectNulls:u,strokeDasharray:null!==o&&void 0!==o?o:s.strokeDasharray});return i.createElement(i.Fragment,null,(null===r||void 0===r?void 0:r.length)>1&&i.createElement(eJ,bQ({},f,{pathRef:n})),i.createElement(AQ,{points:r,clipPathId:t,props:s}),a&&fJ.renderCallByParent(s,r))}function PQ(e){var{clipPathId:t,props:n,pathRef:r,previousPointsRef:o,longestAnimatedLengthRef:s}=e,{points:a,strokeDasharray:l,isAnimationActive:c,animationBegin:u,animationDuration:h,animationEasing:d,animateNewValues:f,width:p,height:m,onAnimationEnd:g,onAnimationStart:_}=n,y=o.current,v=NJ(n,"recharts-line-"),[x,b]=(0,i.useState)(!1),w=(0,i.useCallback)(()=>{"function"===typeof g&&g(),b(!1)},[g]),S=(0,i.useCallback)(()=>{"function"===typeof _&&_(),b(!0)},[_]),E=function(e){try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch(t){return 0}}(r.current),T=s.current;return i.createElement(fQ,{begin:u,duration:h,isActive:c,easing:d,onAnimationEnd:w,onAnimationStart:S,key:v},e=>{var c,u=pR(T,E+T,e),h=Math.min(u,E);if(l){var d="".concat(l).split(/[,\s]+/gim).map(e=>parseFloat(e));c=((e,t,n)=>{var r=n.reduce((e,t)=>e+t);if(!r)return EQ(t,e);for(var i=Math.floor(e/r),o=e%r,s=t-e,a=[],l=0,c=0;l<n.length;c+=n[l],++l)if(c+n[l]>o){a=[...n.slice(0,l),o-c];break}var u=a.length%2===0?[0,s]:[s];return[...TQ(n,i),...a,...u].map(e=>"".concat(e,"px")).join(", ")})(h,E,d)}else c=EQ(E,h);if(y){var g=y.length/a.length,_=1===e?a:a.map((t,n)=>{var r=Math.floor(n*g);if(y[r]){var i=y[r];return yQ(yQ({},t),{},{x:pR(i.x,t.x,e),y:pR(i.y,t.y,e)})}return yQ(yQ({},t),{},f?{x:pR(2*p,t.x,e),y:pR(m/2,t.y,e)}:{x:t.x,y:t.y})});return o.current=_,i.createElement(CQ,{props:n,points:_,clipPathId:t,pathRef:r,showLabels:!x,strokeDasharray:c})}return e>0&&E>0&&(o.current=a,s.current=h),i.createElement(CQ,{props:n,points:a,clipPathId:t,pathRef:r,showLabels:!x,strokeDasharray:c})})}function IQ(e){var{clipPathId:t,props:n}=e,{points:r,isAnimationActive:o}=n,s=(0,i.useRef)(null),a=(0,i.useRef)(0),l=(0,i.useRef)(null),c=s.current;return o&&r&&r.length&&c!==r?i.createElement(PQ,{props:n,clipPathId:t,previousPointsRef:s,longestAnimatedLengthRef:a,pathRef:l}):i.createElement(CQ,{props:n,points:r,clipPathId:t,pathRef:l,showLabels:!0})}var kQ=(e,t)=>({x:e.x,y:e.y,value:e.value,errorVal:LN(e.payload,t)});class MQ extends i.Component{render(){var e,{hide:t,dot:n,points:r,className:o,xAxisId:s,yAxisId:a,top:l,left:c,width:u,height:h,id:d,needClip:f}=this.props;if(t)return null;var p=yi("recharts-line",o),m=d,{r:g=3,strokeWidth:_=2}=null!==(e=zX(n,!1))&&void 0!==e?e:{r:3,strokeWidth:2},y=NX(n),v=2*g+_;return i.createElement(i.Fragment,null,i.createElement(TZ,{className:p},f&&i.createElement("defs",null,i.createElement(EJ,{clipPathId:m,xAxisId:s,yAxisId:a}),!y&&i.createElement("clipPath",{id:"clipPath-dots-".concat(m)},i.createElement("rect",{x:c-v/2,y:l-v/2,width:u+v,height:h+v}))),i.createElement(IQ,{props:this.props,clipPathId:m}),i.createElement(wJ,{xAxisId:s,yAxisId:a,data:r,dataPointFormatter:kQ,errorBarOffset:0},this.props.children)),i.createElement(_J,{activeDot:this.props.activeDot,points:r,mainColor:this.props.stroke,itemDataKey:this.props.dataKey}))}}var RQ={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:!AZ,label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0};function OQ(e){var t=mZ(e,RQ),{activeDot:n,animateNewValues:r,animationBegin:o,animationDuration:s,animationEasing:a,connectNulls:l,dot:c,hide:u,isAnimationActive:h,label:d,legendType:f,xAxisId:p,yAxisId:m,id:g}=t,_=xQ(t,gQ),{needClip:y}=SJ(p,m),v=lZ(),x=yz(),b=cz(),w=hN(e=>OJ(e,p,m,b,g));if("horizontal"!==x&&"vertical"!==x||null==w||null==v)return null;var{height:S,width:E,x:T,y:A}=v;return i.createElement(MQ,bQ({},_,{id:g,connectNulls:l,dot:c,activeDot:n,animateNewValues:r,animationBegin:o,animationDuration:s,animationEasing:a,isAnimationActive:h,hide:u,label:d,legendType:f,xAxisId:p,yAxisId:m,points:w,layout:x,height:S,width:E,left:T,top:A,needClip:y}))}function LQ(e){var t=mZ(e,RQ),n=cz();return i.createElement(BJ,{id:t.id,type:"line"},e=>i.createElement(i.Fragment,null,i.createElement(DJ,{legendPayload:wQ(t)}),i.createElement(yJ,{fn:SQ,args:t}),i.createElement(jJ,{type:"line",id:e,data:t.data,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,dataKey:t.dataKey,hide:t.hide,isPanorama:n}),i.createElement(OQ,bQ({},t,{id:e}))))}function DQ(){return DQ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},DQ.apply(null,arguments)}function NQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function zQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NQ(Object(n),!0).forEach(function(t){FQ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NQ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function FQ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function BQ(e){return Array.isArray(e)&&cR(e[0])&&cR(e[1])?e.join(" ~ "):e}LQ.displayName="Line";var jQ=e=>{var{separator:t=" : ",contentStyle:n={},itemStyle:r={},labelStyle:o={},payload:s,formatter:a,itemSorter:l,wrapperClassName:c,labelClassName:u,label:h,labelFormatter:d,accessibilityLayer:f=!1}=e,p=zQ({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},n),m=zQ({margin:0},o),g=!gR(h),_=g?h:"",y=yi("recharts-default-tooltip",c),v=yi("recharts-tooltip-label",u);g&&d&&void 0!==s&&null!==s&&(_=d(h,s));var x=f?{role:"status","aria-live":"assertive"}:{};return i.createElement("div",DQ({className:y,style:p},x),i.createElement("p",{className:v,style:m},i.isValidElement(_)?_:"".concat(_)),(()=>{if(s&&s.length){var e=(l?fN()(s,l):s).map((e,n)=>{if("none"===e.type)return null;var o=e.formatter||a||BQ,{value:l,name:c}=e,u=l,h=c;if(o){var d=o(l,c,e,n,s);if(Array.isArray(d))[u,h]=d;else{if(null==d)return null;u=d}}var f=zQ({display:"block",paddingTop:4,paddingBottom:4,color:e.color||"#000"},r);return i.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(n),style:f},cR(h)?i.createElement("span",{className:"recharts-tooltip-item-name"},h):null,cR(h)?i.createElement("span",{className:"recharts-tooltip-item-separator"},t):null,i.createElement("span",{className:"recharts-tooltip-item-value"},u),i.createElement("span",{className:"recharts-tooltip-item-unit"},e.unit||""))});return i.createElement("ul",{className:"recharts-tooltip-item-list",style:{padding:0,margin:0}},e)}return null})())},UQ="recharts-tooltip-wrapper",VQ={visibility:"hidden"};function GQ(e){var{coordinate:t,translateX:n,translateY:r}=e;return yi(UQ,{["".concat(UQ,"-right")]:lR(n)&&t&&lR(t.x)&&n>=t.x,["".concat(UQ,"-left")]:lR(n)&&t&&lR(t.x)&&n<t.x,["".concat(UQ,"-bottom")]:lR(r)&&t&&lR(t.y)&&r>=t.y,["".concat(UQ,"-top")]:lR(r)&&t&&lR(t.y)&&r<t.y})}function HQ(e){var{allowEscapeViewBox:t,coordinate:n,key:r,offsetTopLeft:i,position:o,reverseDirection:s,tooltipDimension:a,viewBox:l,viewBoxDimension:c}=e;if(o&&lR(o[r]))return o[r];var u=n[r]-a-(i>0?i:0),h=n[r]+i;if(t[r])return s[r]?u:h;var d=l[r];return null==d?0:s[r]?u<d?Math.max(h,d):Math.max(u,d):null==c?0:h+a>d+c?Math.max(u,d):Math.max(h,d)}function $Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function WQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$Q(Object(n),!0).forEach(function(t){qQ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$Q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function qQ(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class XQ extends i.PureComponent{constructor(){super(...arguments),qQ(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),qQ(this,"handleKeyDown",e=>{var t,n,r,i;"Escape"===e.key&&this.setState({dismissed:!0,dismissedAtCoordinate:{x:null!==(t=null===(n=this.props.coordinate)||void 0===n?void 0:n.x)&&void 0!==t?t:0,y:null!==(r=null===(i=this.props.coordinate)||void 0===i?void 0:i.y)&&void 0!==r?r:0}})})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,t;this.state.dismissed&&((null===(e=this.props.coordinate)||void 0===e?void 0:e.x)===this.state.dismissedAtCoordinate.x&&(null===(t=this.props.coordinate)||void 0===t?void 0:t.y)===this.state.dismissedAtCoordinate.y||(this.state.dismissed=!1))}render(){var{active:e,allowEscapeViewBox:t,animationDuration:n,animationEasing:r,children:o,coordinate:s,hasPayload:a,isAnimationActive:l,offset:c,position:u,reverseDirection:h,useTranslate3d:d,viewBox:f,wrapperStyle:p,lastBoundingBox:m,innerRef:g,hasPortalFromProps:_}=this.props,{cssClasses:y,cssProperties:v}=function(e){var t,n,r,{allowEscapeViewBox:i,coordinate:o,offsetTopLeft:s,position:a,reverseDirection:l,tooltipBox:c,useTranslate3d:u,viewBox:h}=e;return t=c.height>0&&c.width>0&&o?function(e){var{translateX:t,translateY:n,useTranslate3d:r}=e;return{transform:r?"translate3d(".concat(t,"px, ").concat(n,"px, 0)"):"translate(".concat(t,"px, ").concat(n,"px)")}}({translateX:n=HQ({allowEscapeViewBox:i,coordinate:o,key:"x",offsetTopLeft:s,position:a,reverseDirection:l,tooltipDimension:c.width,viewBox:h,viewBoxDimension:h.width}),translateY:r=HQ({allowEscapeViewBox:i,coordinate:o,key:"y",offsetTopLeft:s,position:a,reverseDirection:l,tooltipDimension:c.height,viewBox:h,viewBoxDimension:h.height}),useTranslate3d:u}):VQ,{cssProperties:t,cssClasses:GQ({translateX:n,translateY:r,coordinate:o})}}({allowEscapeViewBox:t,coordinate:s,offsetTopLeft:c,position:u,reverseDirection:h,tooltipBox:{height:m.height,width:m.width},useTranslate3d:d,viewBox:f}),x=_?{}:WQ(WQ({transition:l&&e?"transform ".concat(n,"ms ").concat(r):void 0},v),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&a?"visible":"hidden",position:"absolute",top:0,left:0}),b=WQ(WQ({},x),{},{visibility:!this.state.dismissed&&e&&a?"visible":"hidden"},p);return i.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:y,style:b,ref:g},o)}}var ZQ=n(4332),KQ=n.n(ZQ);var YQ=["x","y","top","left","width","height","className"];function JQ(){return JQ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},JQ.apply(null,arguments)}function QQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e0(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var t0=(e,t,n,r,i,o)=>"M".concat(e,",").concat(i,"v").concat(r,"M").concat(o,",").concat(t,"h").concat(n),n0=e=>{var{x:t=0,y:n=0,top:r=0,left:o=0,width:s=0,height:a=0,className:l}=e,c=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,YQ),u=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QQ(Object(n),!0).forEach(function(t){e0(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QQ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({x:t,y:n,top:r,left:o,width:s,height:a},c);return lR(t)&&lR(n)&&lR(s)&&lR(a)&&lR(r)&&lR(o)?i.createElement("path",JQ({},zX(u,!0),{className:yi("recharts-cross",l),d:t0(t,n,s,a,r,o)})):null};var r0=n(4250),i0=n.n(r0),o0=["children","begin","duration","attributeName","easing","isActive","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart","animationManager"];function s0(){return s0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s0.apply(null,arguments)}function a0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l0(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a0(Object(n),!0).forEach(function(t){c0(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a0(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c0(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class u0 extends i.PureComponent{constructor(e,t){super(e,t),c0(this,"mounted",!1),c0(this,"manager",void 0),c0(this,"stopJSAnimation",null),c0(this,"unSubscribe",null);var{isActive:n,attributeName:r,from:i,to:o,children:s,duration:a,animationManager:l}=this.props;if(this.manager=l,this.handleStyleChange=this.handleStyleChange.bind(this),this.changeStyle=this.changeStyle.bind(this),!n||a<=0)return this.state={style:{}},void("function"===typeof s&&(this.state={style:o}));if(i){if("function"===typeof s)return void(this.state={style:i});this.state={style:r?{[r]:i}:i}}else this.state={style:{}}}componentDidMount(){var{isActive:e,canBegin:t}=this.props;this.mounted=!0,e&&t&&this.runAnimation(this.props)}componentDidUpdate(e){var{isActive:t,canBegin:n,attributeName:r,shouldReAnimate:i,to:o,from:s}=this.props,{style:a}=this.state;if(n)if(t){if(!(i0()(e.to,o)&&e.canBegin&&e.isActive)){var l=!e.canBegin||!e.isActive;this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var c=l||i?s:e.to;if(this.state&&a){var u={style:r?{[r]:c}:c};(r&&a[r]!==c||!r&&a!==c)&&this.setState(u)}this.runAnimation(l0(l0({},this.props),{},{from:c,begin:0}))}}else{var h={style:r?{[r]:o}:o};this.state&&a&&(r&&a[r]!==o||!r&&a!==o)&&this.setState(h)}}componentWillUnmount(){this.mounted=!1;var{onAnimationEnd:e}=this.props;this.unSubscribe&&this.unSubscribe(),this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation(),e&&e()}handleStyleChange(e){this.changeStyle(e)}changeStyle(e){this.mounted&&this.setState({style:e})}runJSAnimation(e){var{from:t,to:n,duration:r,easing:i,begin:o,onAnimationEnd:s,onAnimationStart:a}=e,l=QJ(t,n,oQ(i),r,this.changeStyle,this.manager.getTimeoutController());this.manager.start([a,o,()=>{this.stopJSAnimation=l()},r,s])}runAnimation(e){var{begin:t,duration:n,attributeName:r,to:i,easing:o,onAnimationStart:s,onAnimationEnd:a,children:l}=e;if(this.unSubscribe=this.manager.subscribe(this.handleStyleChange),"function"!==typeof o&&"function"!==typeof l&&"spring"!==o){var c=r?{[r]:i}:i,u=((e,t,n)=>e.map(e=>"".concat((e=>e.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase())))(e)," ").concat(t,"ms ").concat(n)).join(","))(Object.keys(c),n,o);this.manager.start([s,t,l0(l0({},c),{},{transition:u}),n,a])}else this.runJSAnimation(e)}render(){var e=this.props,{children:t,begin:n,duration:r,attributeName:o,easing:s,isActive:a,from:l,to:c,canBegin:u,onAnimationEnd:h,shouldReAnimate:d,onAnimationReStart:f,animationManager:p}=e,m=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,o0),g=i.Children.count(t),_=this.state.style;if("function"===typeof t)return t(_);if(!a||0===g||r<=0)return t;var y=e=>{var{style:t={},className:n}=e.props;return(0,i.cloneElement)(e,l0(l0({},m),{},{style:l0(l0({},t),_),className:n}))};return 1===g?y(i.Children.only(t)):i.createElement("div",null,i.Children.map(t,e=>y(e)))}}function h0(e){var t,n=cQ(null!==(t=e.attributeName)&&void 0!==t?t:Object.keys(e.to).join(","),e.animationManager);return i.createElement(u0,s0({},e,{animationManager:n}))}function d0(){return d0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d0.apply(null,arguments)}c0(u0,"displayName","Animate"),c0(u0,"defaultProps",{begin:0,duration:1e3,attributeName:"",easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}});var f0=(e,t,n,r,i)=>{var o,s=Math.min(Math.abs(n)/2,Math.abs(r)/2),a=r>=0?1:-1,l=n>=0?1:-1,c=r>=0&&n>=0||r<0&&n<0?1:0;if(s>0&&i instanceof Array){for(var u=[0,0,0,0],h=0;h<4;h++)u[h]=i[h]>s?s:i[h];o="M".concat(e,",").concat(t+a*u[0]),u[0]>0&&(o+="A ".concat(u[0],",").concat(u[0],",0,0,").concat(c,",").concat(e+l*u[0],",").concat(t)),o+="L ".concat(e+n-l*u[1],",").concat(t),u[1]>0&&(o+="A ".concat(u[1],",").concat(u[1],",0,0,").concat(c,",\n        ").concat(e+n,",").concat(t+a*u[1])),o+="L ".concat(e+n,",").concat(t+r-a*u[2]),u[2]>0&&(o+="A ".concat(u[2],",").concat(u[2],",0,0,").concat(c,",\n        ").concat(e+n-l*u[2],",").concat(t+r)),o+="L ".concat(e+l*u[3],",").concat(t+r),u[3]>0&&(o+="A ".concat(u[3],",").concat(u[3],",0,0,").concat(c,",\n        ").concat(e,",").concat(t+r-a*u[3])),o+="Z"}else if(s>0&&i===+i&&i>0){var d=Math.min(s,i);o="M ".concat(e,",").concat(t+a*d,"\n            A ").concat(d,",").concat(d,",0,0,").concat(c,",").concat(e+l*d,",").concat(t,"\n            L ").concat(e+n-l*d,",").concat(t,"\n            A ").concat(d,",").concat(d,",0,0,").concat(c,",").concat(e+n,",").concat(t+a*d,"\n            L ").concat(e+n,",").concat(t+r-a*d,"\n            A ").concat(d,",").concat(d,",0,0,").concat(c,",").concat(e+n-l*d,",").concat(t+r,"\n            L ").concat(e+l*d,",").concat(t+r,"\n            A ").concat(d,",").concat(d,",0,0,").concat(c,",").concat(e,",").concat(t+r-a*d," Z")}else o="M ".concat(e,",").concat(t," h ").concat(n," v ").concat(r," h ").concat(-n," Z");return o},p0={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},m0=e=>{var t=mZ(e,p0),n=(0,i.useRef)(null),[r,o]=(0,i.useState)(-1);(0,i.useEffect)(()=>{if(n.current&&n.current.getTotalLength)try{var e=n.current.getTotalLength();e&&o(e)}catch(t){}},[]);var{x:s,y:a,width:l,height:c,radius:u,className:h}=t,{animationEasing:d,animationDuration:f,animationBegin:p,isAnimationActive:m,isUpdateAnimationActive:g}=t;if(s!==+s||a!==+a||l!==+l||c!==+c||0===l||0===c)return null;var _=yi("recharts-rectangle",h);return g?i.createElement(h0,{canBegin:r>0,from:{width:l,height:c,x:s,y:a},to:{width:l,height:c,x:s,y:a},duration:f,animationEasing:d,isActive:g},e=>{var{width:o,height:s,x:a,y:l}=e;return i.createElement(h0,{canBegin:r>0,from:"0px ".concat(-1===r?1:r,"px"),to:"".concat(r,"px 0px"),attributeName:"strokeDasharray",begin:p,duration:f,isActive:m,easing:d},i.createElement("path",d0({},zX(t,!0),{className:_,d:f0(a,l,o,s,u),ref:n})))}):i.createElement("path",d0({},zX(t,!0),{className:_,d:f0(s,a,l,c,u)}))};function g0(e){var{cx:t,cy:n,radius:r,startAngle:i,endAngle:o}=e;return{points:[AN(t,n,r,i),AN(t,n,r,o)],cx:t,cy:n,radius:r,startAngle:i,endAngle:o}}function _0(){return _0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_0.apply(null,arguments)}var y0=e=>{var{cx:t,cy:n,radius:r,angle:i,sign:o,isExternal:s,cornerRadius:a,cornerIsExternal:l}=e,c=a*(s?1:-1)+r,u=Math.asin(a/c)/EN,h=l?i:i+o*u,d=l?i-o*u:i;return{center:AN(t,n,c,h),circleTangency:AN(t,n,r,h),lineTangency:AN(t,n,c*Math.cos(u*EN),d),theta:u}},v0=e=>{var{cx:t,cy:n,innerRadius:r,outerRadius:i,startAngle:o,endAngle:s}=e,a=((e,t)=>oR(t-e)*Math.min(Math.abs(t-e),359.999))(o,s),l=o+a,c=AN(t,n,i,o),u=AN(t,n,i,l),h="M ".concat(c.x,",").concat(c.y,"\n    A ").concat(i,",").concat(i,",0,\n    ").concat(+(Math.abs(a)>180),",").concat(+(o>l),",\n    ").concat(u.x,",").concat(u.y,"\n  ");if(r>0){var d=AN(t,n,r,o),f=AN(t,n,r,l);h+="L ".concat(f.x,",").concat(f.y,"\n            A ").concat(r,",").concat(r,",0,\n            ").concat(+(Math.abs(a)>180),",").concat(+(o<=l),",\n            ").concat(d.x,",").concat(d.y," Z")}else h+="L ".concat(t,",").concat(n," Z");return h},x0={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},b0=e=>{var t=mZ(e,x0),{cx:n,cy:r,innerRadius:o,outerRadius:s,cornerRadius:a,forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:h,className:d}=t;if(s<o||u===h)return null;var f,p=yi("recharts-sector",d),m=s-o,g=dR(a,m,0,!0);return f=g>0&&Math.abs(u-h)<360?(e=>{var{cx:t,cy:n,innerRadius:r,outerRadius:i,cornerRadius:o,forceCornerRadius:s,cornerIsExternal:a,startAngle:l,endAngle:c}=e,u=oR(c-l),{circleTangency:h,lineTangency:d,theta:f}=y0({cx:t,cy:n,radius:i,angle:l,sign:u,cornerRadius:o,cornerIsExternal:a}),{circleTangency:p,lineTangency:m,theta:g}=y0({cx:t,cy:n,radius:i,angle:c,sign:-u,cornerRadius:o,cornerIsExternal:a}),_=a?Math.abs(l-c):Math.abs(l-c)-f-g;if(_<0)return s?"M ".concat(d.x,",").concat(d.y,"\n        a").concat(o,",").concat(o,",0,0,1,").concat(2*o,",0\n        a").concat(o,",").concat(o,",0,0,1,").concat(2*-o,",0\n      "):v0({cx:t,cy:n,innerRadius:r,outerRadius:i,startAngle:l,endAngle:c});var y="M ".concat(d.x,",").concat(d.y,"\n    A").concat(o,",").concat(o,",0,0,").concat(+(u<0),",").concat(h.x,",").concat(h.y,"\n    A").concat(i,",").concat(i,",0,").concat(+(_>180),",").concat(+(u<0),",").concat(p.x,",").concat(p.y,"\n    A").concat(o,",").concat(o,",0,0,").concat(+(u<0),",").concat(m.x,",").concat(m.y,"\n  ");if(r>0){var{circleTangency:v,lineTangency:x,theta:b}=y0({cx:t,cy:n,radius:r,angle:l,sign:u,isExternal:!0,cornerRadius:o,cornerIsExternal:a}),{circleTangency:w,lineTangency:S,theta:E}=y0({cx:t,cy:n,radius:r,angle:c,sign:-u,isExternal:!0,cornerRadius:o,cornerIsExternal:a}),T=a?Math.abs(l-c):Math.abs(l-c)-b-E;if(T<0&&0===o)return"".concat(y,"L").concat(t,",").concat(n,"Z");y+="L".concat(S.x,",").concat(S.y,"\n      A").concat(o,",").concat(o,",0,0,").concat(+(u<0),",").concat(w.x,",").concat(w.y,"\n      A").concat(r,",").concat(r,",0,").concat(+(T>180),",").concat(+(u>0),",").concat(v.x,",").concat(v.y,"\n      A").concat(o,",").concat(o,",0,0,").concat(+(u<0),",").concat(x.x,",").concat(x.y,"Z")}else y+="L".concat(t,",").concat(n,"Z");return y})({cx:n,cy:r,innerRadius:o,outerRadius:s,cornerRadius:Math.min(g,m/2),forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:h}):v0({cx:n,cy:r,innerRadius:o,outerRadius:s,startAngle:u,endAngle:h}),i.createElement("path",_0({},zX(t,!0),{className:p,d:f}))};function w0(e,t,n){var r,i,o,s;if("horizontal"===e)o=r=t.x,i=n.top,s=n.top+n.height;else if("vertical"===e)s=i=t.y,r=n.left,o=n.left+n.width;else if(null!=t.cx&&null!=t.cy){if("centric"!==e)return g0(t);var{cx:a,cy:l,innerRadius:c,outerRadius:u,angle:h}=t,d=AN(a,l,c,h),f=AN(a,l,u,h);r=d.x,i=d.y,o=f.x,s=f.y}return[{x:r,y:i},{x:o,y:s}]}function S0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function E0(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S0(Object(n),!0).forEach(function(t){T0(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S0(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function T0(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A0=()=>{var e=hN(zG),t=hN(CW),n=hN(EW);return qN(E0(E0({},e),{},{scale:n}),t)};function C0(){return C0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C0.apply(null,arguments)}function P0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function I0(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P0(Object(n),!0).forEach(function(t){k0(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P0(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function k0(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M0(e){var t,n,{coordinate:r,payload:o,index:s,offset:a,tooltipAxisBandSize:l,layout:c,cursor:u,tooltipEventType:h,chartName:d}=e,f=r,p=o,m=s;if(!u||!f||"ScatterChart"!==d&&"axis"!==h)return null;if("ScatterChart"===d)t=f,n=n0;else if("BarChart"===d)t=function(e,t,n,r){var i=r/2;return{stroke:"none",fill:"#ccc",x:"horizontal"===e?t.x-i:n.left+.5,y:"horizontal"===e?n.top+.5:t.y-i,width:"horizontal"===e?r:n.width-1,height:"horizontal"===e?n.height-1:r}}(c,f,a,l),n=m0;else if("radial"===c){var{cx:g,cy:_,radius:y,startAngle:v,endAngle:x}=g0(f);t={cx:g,cy:_,startAngle:v,endAngle:x,innerRadius:y,outerRadius:y},n=b0}else t={points:w0(c,f,a)},n=eJ;var b="object"===typeof u&&"className"in u?u.className:void 0,w=I0(I0(I0(I0({stroke:"#ccc",pointerEvents:"none"},a),t),zX(u,!1)),{},{payload:p,payloadIndex:m,className:yi("recharts-tooltip-cursor",b)});return(0,i.isValidElement)(u)?(0,i.cloneElement)(u,w):(0,i.createElement)(n,w)}function R0(e){var t=A0(),n=pz(),r=yz(),o=UW();return i.createElement(M0,C0({},e,{coordinate:e.coordinate,index:e.index,payload:e.payload,offset:n,layout:r,tooltipAxisBandSize:t,chartName:o}))}function O0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function L0(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O0(Object(n),!0).forEach(function(t){D0(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O0(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function D0(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N0(e){return e.dataKey}var z0=[],F0={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!AZ,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function B0(e){var t=mZ(e,F0),{active:n,allowEscapeViewBox:r,animationDuration:o,animationEasing:s,content:a,filterNull:l,isAnimationActive:c,offset:u,payloadUniqBy:h,position:d,reverseDirection:f,useTranslate3d:p,wrapperStyle:m,cursor:g,shared:_,trigger:y,defaultIndex:v,portal:x,axisId:b}=t,w=aN(),S="number"===typeof v?String(v):v;(0,i.useEffect)(()=>{w(PD({shared:_,trigger:y,axisId:b,active:n,defaultIndex:S}))},[w,_,y,b,n,S]);var E=dz(),T=xX(),A=function(e){return hN(t=>D$(t,e))}(_),{activeIndex:C,isActive:P}=hN(e=>QW(e,A,y,S)),I=hN(e=>JW(e,A,y,S)),k=hN(e=>YW(e,A,y,S)),M=hN(e=>KW(e,A,y,S)),R=I,O=(0,i.useContext)(eZ),L=null!==n&&void 0!==n?n:P,[D,N]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,n]=(0,i.useState)({height:0,left:0,top:0,width:0}),r=(0,i.useCallback)(e=>{if(null!=e){var r=e.getBoundingClientRect(),i={height:r.height,left:r.left,top:r.top,width:r.width};(Math.abs(i.height-t.height)>1||Math.abs(i.left-t.left)>1||Math.abs(i.top-t.top)>1||Math.abs(i.width-t.width)>1)&&n({height:i.height,left:i.left,top:i.top,width:i.width})}},[t.width,t.height,t.top,t.left,...e]);return[t,r]}([R,L]),z="axis"===A?k:void 0;QX(A,y,M,z,C,L);var F=null!==x&&void 0!==x?x:O;if(null==F)return null;var B=null!==R&&void 0!==R?R:z0;L||(B=z0),l&&B.length&&(B=function(e,t,n){return!0===t?KQ()(e,n):"function"===typeof t?KQ()(e,t):e}(R.filter(e=>null!=e.value&&(!0!==e.hide||t.includeHidden)),h,N0));var j=B.length>0,U=i.createElement(XQ,{allowEscapeViewBox:r,animationDuration:o,animationEasing:s,isAnimationActive:c,active:L,coordinate:M,hasPayload:j,offset:u,position:d,reverseDirection:f,useTranslate3d:p,viewBox:E,wrapperStyle:m,lastBoundingBox:D,innerRef:N,hasPortalFromProps:Boolean(x)},function(e,t){return i.isValidElement(e)?i.cloneElement(e,t):"function"===typeof e?i.createElement(e,t):i.createElement(jQ,t)}(a,L0(L0({},t),{},{payload:B,label:z,active:L,coordinate:M,accessibilityLayer:T})));return i.createElement(i.Fragment,null,(0,gi.createPortal)(U,F),L&&i.createElement(R0,{cursor:g,tooltipEventType:A,coordinate:M,payload:R,index:C}))}const j0=e=>{let{station:t,data:n=[],onClose:r,onAnalyze:o,onAddChatMessage:s,showCharts:a=!0,showDataExport:l=!0,className:c=""}=e;const[u,h]=(0,i.useState)("overview"),[d,f]=(0,i.useState)(!1),p=(0,i.useMemo)(()=>t&&n.length?n.filter(e=>{if(!e.lat||!e.lon)return!1;const n=Math.abs(e.lat-t.coordinates[1]),r=Math.abs(e.lon-t.coordinates[0]);return n<.001&&r<.001}):[],[t,n]),m=(0,i.useMemo)(()=>p.length?p.filter(e=>e.time).sort((e,t)=>new Date(e.time)-new Date(t.time)).slice(-48).map(e=>({time:new Date(e.time).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),timestamp:new Date(e.time),currentSpeed:e.speed||0,temperature:e.temp||null,salinity:e.salinity||null,ssh:e.ssh||0,pressure:e.pressure_dbars||null,windSpeed:e.windspeed||0})):[],[p]),g=(0,i.useMemo)(()=>{if(!p.length)return{totalMeasurements:0,timeSpan:null,avgTemperature:null,avgCurrentSpeed:null,maxSurfaceElevation:null,dataQuality:"No Data"};const e=p.filter(e=>e.time).map(e=>new Date(e.time)).sort((e,t)=>e-t),t=p.map(e=>e.temp).filter(e=>null!==e&&void 0!==e),n=p.map(e=>e.speed).filter(e=>null!==e&&void 0!==e),r=p.map(e=>e.ssh).filter(e=>null!==e&&void 0!==e);return{totalMeasurements:p.length,timeSpan:e.length>1?{start:e[0],end:e[e.length-1],duration:e[e.length-1]-e[0]}:null,avgTemperature:t.length>0?t.reduce((e,t)=>e+t,0)/t.length:null,avgCurrentSpeed:n.length>0?n.reduce((e,t)=>e+t,0)/n.length:null,maxSurfaceElevation:r.length>0?Math.max(...r):null,dataQuality:p.length>100?"Excellent":p.length>50?"Good":p.length>10?"Fair":"Limited"}},[p]),_=(e,t,n)=>{const r=`${e.coordinates[1]}, ${e.coordinates[0]}`;let i=`Station Analysis: ${e.name} located at ${r}`;if(t.totalMeasurements>0){if(i+=` contains ${t.totalMeasurements} measurements.`,t.timeSpan){const e=Math.floor(t.timeSpan.duration/864e5);i+=` Data spans ${e>0?`${e} days`:"single day"} from ${t.timeSpan.start.toLocaleDateString()} to ${t.timeSpan.end.toLocaleDateString()}.`}const e=[];null!==t.avgTemperature&&e.push(`average temperature: ${t.avgTemperature.toFixed(2)}\xb0F`),null!==t.avgCurrentSpeed&&e.push(`average current speed: ${t.avgCurrentSpeed.toFixed(3)} m/s`),null!==t.maxSurfaceElevation&&e.push(`max surface elevation (SSH): ${t.maxSurfaceElevation.toFixed(2)} m`),e.length>0&&(i+=` Latest conditions show ${e.join(", ")}.`),i+=` Data quality assessment: ${t.dataQuality}.`}else i+=" but no measurement data is currently available for analysis.";return i};if(!t)return null;return(0,jr.jsxs)("div",{className:`absolute top-4 md:top-16 left-2 md:left-4 bg-slate-800/95 backdrop-blur-sm border border-blue-400/30 rounded-lg shadow-xl max-w-sm md:max-w-md z-30 ${c}`,children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between p-3 md:p-4 border-b border-slate-700",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,jr.jsx)($r,{className:"w-4 h-4 text-blue-400"}),(0,jr.jsx)("div",{className:"font-semibold text-blue-300 text-sm md:text-base",children:t.name})]}),(0,jr.jsxs)("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs ${(e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"usm":return"text-blue-400 bg-blue-400/10";case"ndbc":return"text-yellow-400 bg-yellow-400/10";case"api_station":return"text-green-400 bg-green-400/10";default:return"text-slate-400 bg-slate-400/10"}})(t.type)}`,children:[(0,jr.jsx)("div",{className:"w-1.s h-1.5 rounded-full bg-current"}),"api_station"===t.type?"Data Station":"usm"===t.type?"USM Station":"ndbc"===t.type?"NDBC Buoy":"Station"]})]}),(0,jr.jsx)("button",{onClick:r,className:"text-slate-400 hover:text-white p-1 rounded transition-colors",children:(0,jr.jsx)(KM,{className:"w-4 h-4"})})]}),(0,jr.jsx)("div",{className:"flex border-b border-slate-700",children:(0,jr.jsx)("button",{onClick:()=>h("overview"),className:"flex-1 px-3 py-2 text-xs md:text-sm font-medium transition-colors "+("overview"===u?"text-blue-300 border-b-2 border-blue-400 bg-blue-400/5":"text-slate-400 hover:text-slate-300"),children:"Overview"})}),(0,jr.jsxs)("div",{className:"p-3 md:p-4 max-h-96 overflow-y-auto",children:["overview"===u&&(0,jr.jsxs)("div",{className:"space-y-4",children:[(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-3 rounded",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Location"}),(0,jr.jsxs)("div",{className:"text-slate-200 font-mono text-sm",children:[t.coordinates[1],(0,jr.jsx)("br",{}),t.coordinates[0]]})]}),(0,jr.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-3 rounded",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(Nr,{className:"w-3 h-3"}),"Data Points"]}),(0,jr.jsx)("div",{className:"text-slate-200 font-semibold",children:g.totalMeasurements.toLocaleString()})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-3 rounded",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(zr,{className:"w-3 h-3"}),"Quality"]}),(0,jr.jsx)("div",{className:"font-semibold text-xs "+("Excellent"===g.dataQuality?"text-green-400":"Good"===g.dataQuality?"text-blue-400":"Fair"===g.dataQuality?"text-yellow-400":"text-red-400"),children:g.dataQuality})]})]}),g.totalMeasurements>0&&(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-3 rounded",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1",children:[(0,jr.jsx)(YM,{className:"w-3 h-3"}),"Average Conditions"]}),(0,jr.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[null!==g.avgTemperature&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)(sc,{className:"w-3 h-3 text-red-400"}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("div",{className:"text-slate-400",children:"Temperature"}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[g.avgTemperature.toFixed(1),"\xb0F"]})]})]}),null!==g.avgCurrentSpeed&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)(oc,{className:"w-3 h-3 text-cyan-400"}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("div",{className:"text-slate-400",children:"Current"}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[g.avgCurrentSpeed.toFixed(2)," m/s"]})]})]}),null!==g.maxSurfaceElevation&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)(Fr,{className:"w-3 h-3 text-blue-400"}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("div",{className:"text-slate-400",children:"Max SSH"}),(0,jr.jsxs)("div",{className:"text-slate-200",children:[g.maxSurfaceElevation.toFixed(2)," m"]})]})]})]})]}),g.timeSpan&&(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-3 rounded",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-1 flex items-center gap-1",children:[(0,jr.jsx)(fc,{className:"w-3 h-3"}),"Data Range"]}),(0,jr.jsxs)("div",{className:"text-slate-200 text-xs",children:[(0,jr.jsxs)("div",{children:[g.timeSpan.start.toLocaleDateString()," - ",g.timeSpan.end.toLocaleDateString()]}),(0,jr.jsxs)("div",{className:"text-slate-400 mt-1",children:[Math.floor(g.timeSpan.duration/864e5)," days of data"]})]})]}),t.sourceFiles&&t.sourceFiles.length>0&&(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-3 rounded",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1",children:[(0,jr.jsx)(JM,{className:"w-3 h-3"}),"Data Sources"]}),(0,jr.jsxs)("div",{className:"space-y-1",children:[t.sourceFiles.slice(0,3).map((e,t)=>(0,jr.jsx)("div",{className:"text-xs text-slate-200 font-mono truncate",children:e},t)),t.sourceFiles.length>3&&(0,jr.jsxs)("div",{className:"text-xs text-slate-400",children:["+",t.sourceFiles.length-3," more files"]})]})]})]}),"charts"===u&&m.length>0&&(0,jr.jsxs)("div",{className:"space-y-4",children:[(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-3 rounded",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Current Speed (m/s)"}),(0,jr.jsx)(wR,{width:"100%",height:120,children:(0,jr.jsxs)(bZ,{data:m.slice(-24),children:[(0,jr.jsx)(UK,{dataKey:"time",tick:!1}),(0,jr.jsx)(ZK,{tick:!1}),(0,jr.jsx)(pY,{strokeDasharray:"3 3",stroke:"#334155"}),(0,jr.jsx)(LQ,{type:"monotone",dataKey:"currentSpeed",stroke:"#22d3ee",strokeWidth:2,dot:!1}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px"},formatter:e=>[`${e.toFixed(3)} m/s`,"Speed"]})]})})]}),m.some(e=>null!==e.temperature)&&(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-3 rounded",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Temperature (\xb0F)"}),(0,jr.jsx)(wR,{width:"100%",height:120,children:(0,jr.jsxs)(bZ,{data:m.slice(-24),children:[(0,jr.jsx)(UK,{dataKey:"time",tick:!1}),(0,jr.jsx)(ZK,{tick:!1}),(0,jr.jsx)(pY,{strokeDasharray:"3 3",stroke:"#334155"}),(0,jr.jsx)(LQ,{type:"monotone",dataKey:"temperature",stroke:"#f59e0b",strokeWidth:2,dot:!1}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px"},formatter:e=>[`${null===e||void 0===e?void 0:e.toFixed(2)}\xb0F`,"Temperature"]})]})})]})]})]}),(0,jr.jsxs)("div",{className:"p-3 md:p-4 border-t border-slate-700 space-y-2",children:[(0,jr.jsx)("button",{onClick:async()=>{if(t&&o){f(!0);try{o(t);const e=_(t,g,m);s&&s({id:Date.now(),content:e,isUser:!1,timestamp:new Date,type:"analysis"})}catch(e){console.error("Station analysis error:",e)}finally{f(!1)}}},disabled:d||0===g.totalMeasurements,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 disabled:cursor-not-allowed px-3 py-2 rounded text-xs md:text-sm font-medium transition-colors flex items-center justify-center gap-2",children:d?(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsx)("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Analyzing..."]}):(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsx)(QM,{className:"w-4 h-4"}),"Analyze Station Data"]})}),l&&p.length>0&&(0,jr.jsxs)("button",{onClick:()=>{if(!p.length)return;const e=[["timestamp","latitude","longitude","temperature","current_speed","ssh","salinity","pressure"],...p.map(e=>[e.time,e.lat,e.lon,e.temp||"",e.speed||"",e.ssh||"",e.salinity||"",e.pressure_dbars||""])].map(e=>e.join(",")).join("\n"),n=new Blob([e],{type:"text/csv"}),r=window.URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=`${t.name.replace(/\s+/g,"_")}_data.csv`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(r),document.body.removeChild(i)},className:"w-full bg-slate-600 hover:bg-slate-500 px-3 py-2 rounded text-xs md:text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[(0,jr.jsx)(eR,{className:"w-4 h-4"}),"Export Data (",p.length," records)"]})]})]})};let U0={};class V0 extends xA{getVector(e,t,n){if(!this._spatialIndex){this._spatialIndex=new Map;const e=.05;for(const t of n){if(null==t.lon||null==t.lat)continue;const n=`${Math.floor(t.lon/e)},${Math.floor(t.lat/e)}`;this._spatialIndex.has(n)||this._spatialIndex.set(n,[]),this._spatialIndex.get(n).push(t)}}const r=Math.floor(e/.05),i=Math.floor(t/.05);let o=null,s=1/0;for(let c=-1;c<=1;c++)for(let n=-1;n<=1;n++){const a=`${r+c},${i+n}`,l=this._spatialIndex.get(a);if(l)for(const n of l){const r=e-n.lon,i=t-n.lat,a=r*r+i*i;a<s&&(s=a,o=n)}}if(!o)return{u:0,v:0};const a=o.nspeed||o.speed||0,l=(90-(o.direction||0))*(Math.PI/180);return{u:a*Math.cos(l),v:a*Math.sin(l)}}initializeState(){this.setState({particles:this.generateParticles(),lastUpdateTime:0,frameCounter:0})}updateState(e){let{props:t,oldProps:n,changeFlags:r}=e;if(t.pauseAnimation){const{frameCounter:e}=this.state;return void this.setState({frameCounter:e+1})}const{frameCounter:i}=this.state,o=i+1;o%6===0||r.propsChanged?this.setState({particles:this.updateParticles(),lastUpdateTime:t.time,frameCounter:o}):this.setState({frameCounter:o})}generateParticles(){const{particleCount:e,data:t,getPosition:n}=this.props;if(!t||0===t.length)return[];const r=[];for(let i=0;i<e;i++){const e=[...n(t[Math.floor(Math.random()*t.length)])];e[0]+=.01*(Math.random()-.5),e[1]+=.01*(Math.random()-.5),r.push({id:i,position:e,age:Math.random()*this.props.maxAge,speed:0,direction:0})}return r}updateParticles(){const{data:e,bbox:t,maxAge:n,particleSpeedFactor:r,getPosition:i,getSpeed:o,getDirection:s}=this.props;return e&&0!==e.length?this.state.particles.map(a=>{const l=a.age+1;if(l>n||a.position[0]<t.minLng||a.position[0]>t.maxLng||a.position[1]<t.minLat||a.position[1]>t.maxLat){const t=e[Math.floor(Math.random()*e.length)],n=[...i(t)];return n[0]+=.01*(Math.random()-.5),n[1]+=.01*(Math.random()-.5),{...a,position:n,age:0}}const c=this.getVector(a.position[0],a.position[1],e),u=5e-4*r,h=[a.position[0]+c.u*u,a.position[1]+c.v*u],d=this.findNearestPoint(a.position[0],a.position[1],e,i),f=d?o(d):0,p=d?s(d):0;return{...a,position:h,age:l,speed:f,direction:p}}):this.state.particles||[]}findNearestPoint(e,t,n,r){let i=null,o=1/0;for(const s of n){const[n,a]=r(s),l=e-n,c=t-a,u=l*l+c*c;u<o&&(o=u,i=s)}return i}renderLayers(){const{particles:e}=this.state,{opacity:t,getColor:n,arrowColor:r}=this.props;if(!e||0===e.length)return[];const i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"blue";if(U0[e])return U0[e];const t=document.createElement("canvas");t.width=192,t.height=192;const n=t.getContext("2d");return n.fillStyle=e,n.beginPath(),n.moveTo(160,96),n.lineTo(32,32),n.lineTo(64,48),n.lineTo(32,160),n.closePath(),n.fill(),U0[e]={url:t.toDataURL(),width:192,height:192,anchorX:96,anchorY:96},U0[e]}(r);return[new eA({id:`${this.props.id}-arrows`,data:e.filter((e,t)=>t%8===0),getIcon:()=>i,getPosition:e=>e.position,getSize:e=>Math.max(8,Math.min(24,8*e.speed)),getAngle:e=>e.direction,getColor:e=>n(e.speed,Math.max(100,255*(1-e.age/this.props.maxAge))*t),sizeScale:1,sizeUnits:"pixels",billboard:!1}),new sA({id:`${this.props.id}-particles`,data:e,getPosition:e=>e.position,getRadius:1,getFillColor:e=>n(e.speed,Math.max(50,200*(1-e.age/this.props.maxAge))*t),radiusScale:1,radiusMinPixels:.5,radiusMaxPixels:2})]}}V0.layerName="ParticleLayer",V0.defaultProps={data:[],bbox:{minLng:-180,maxLng:180,minLat:-90,maxLat:90},particleCount:1e3,maxAge:10,opacity:1,time:0,particleSpeedFactor:1,vectorScale:1,arrowColor:"blue",pauseAnimation:!1,getPosition:e=>[e.lon,e.lat],getSpeed:e=>e.nspeed||e.speed||0,getDirection:e=>e.direction||0,getColor:(e,t)=>[255,255,255,t]};const G0=e=>{let{initialCenter:t=[0,20],initialZoom:n=1.5,rawData:r=[],selectedStation:o,onStationSelect:s,stationPositions:a=[],currentFrame:l=0,totalFrames:c=24,mapLayerVisibility:u={},selectedDepth:h=0,onDepthChange:d,currentDate:f="",currentTime:p="",selectedArea:m="Global",availableDepths:g=[],holoOceanPOV:_={x:50,y:50,depth:0},onPOVChange:y}=e;const[v,x]=(0,i.useState)(!1),b=(0,i.useRef)(null),w=(0,i.useRef)(null),S=(0,i.useRef)(null),[E,T]=(0,i.useState)(!1),[A,C]=(0,i.useState)(!1),[P,I]=(0,i.useState)({longitude:t[0],latitude:t[1],zoom:n,pitch:0,bearing:0}),[k,M]=(0,i.useState)("arcgis-ocean"),[R,O]=(0,i.useState)(!1),[L,D]=(0,i.useState)(.3),[N,z]=(0,i.useState)(10),[F,B]=(0,i.useState)(!1),[j,U]=(0,i.useState)(!0),[V,G]=(0,i.useState)(null),[H,$]=(0,i.useState)(null),[W,q]=(0,i.useState)(!1),X=(0,i.useRef)(null),[Z,K]=(0,i.useState)(0);(0,i.useEffect)(()=>(console.log("\ud83d\udd0c MapContainer: Waiting for bridge initialization..."),b.current=setTimeout(()=>{console.log("\u2705 MapContainer: Bridge ready, enabling callbacks"),x(!0)},500),()=>{b.current&&clearTimeout(b.current)}),[]);const Y=function(e){if(v&&e&&"function"===typeof e)try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e(...n)}catch(i){console.error("\ud83d\udea8 Bridge call error:",i)}else v||console.log("\u23f3 Bridge not ready, skipping callback")};(0,i.useEffect)(()=>{if(!W){const e=()=>{K(e=>e+1),X.current=requestAnimationFrame(e)};X.current=requestAnimationFrame(e)}return()=>{X.current&&cancelAnimationFrame(X.current)}},[W]),(0,i.useEffect)(()=>{if(!w.current||A)return;Cc().accessToken="pk.eyJ1IjoieW9zaGl0YWthamltYSIsImEiOiJjbTN3M2syM2MwOGhkMmlzY3p3dnBsMzZrIn0.Pc3d_qfvnp7NqLEkWZexXw";const e=new(Cc().Map)({container:w.current,style:"arcgis-ocean"===k?"mapbox://styles/mapbox/dark-v10":k,center:[P.longitude,P.latitude],zoom:P.zoom,pitch:P.pitch,bearing:P.bearing,projection:"globe",antialias:!0});return e.on("style.load",()=>{e.setFog({color:"rgb(186, 210, 235)","high-color":"rgb(36, 92, 223)","horizon-blend":.02,"space-color":"rgb(11, 11, 25)","star-intensity":.6})}),e.on("load",()=>{console.log("\ud83d\uddfa\ufe0f MAP INIT: Instance:",Math.floor(1e9*Math.random())),C(!0)}),S.current=e,()=>{S.current&&(S.current.remove(),S.current=null),C(!1)}},[E]);const J=()=>{if(!S.current||!F)return;const e=S.current,t=e.getCenter();t.lng+=.5,t.lng>180&&(t.lng=-180),e.easeTo({center:[t.lng,t.lat],duration:1e3,easing:e=>e}),F&&setTimeout(J,1e3)};(0,i.useEffect)(()=>{F&&J()},[F]);const Q=(0,i.useMemo)(()=>"arcgis-ocean"!==k?null:new FM({id:"arcgis-ocean-base",data:"https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",minZoom:0,maxZoom:16,tileSize:256,renderSubLayers:e=>{const{bbox:{west:t,south:n,east:r,north:i}}=e.tile;return new qM(e,{data:null,image:e.data,bounds:[t,n,r,i]})}}),[k]),ee=(0,i.useMemo)(()=>{if(!R)return null;const e=[];for(let t=-180;t<=180;t+=N)e.push({sourcePosition:[t,-90],targetPosition:[t,90],type:"meridian"});for(let t=-90;t<=90;t+=N)e.push({sourcePosition:[-180,t],targetPosition:[180,t],type:"parallel"});return new hA({id:"coordinate-grid",data:e,getSourcePosition:e=>e.sourcePosition,getTargetPosition:e=>e.targetPosition,getColor:e=>"meridian"===e.type?[100,150,255,255*L]:[150,200,255,255*L],getWidth:1,widthUnits:"pixels"})},[R,L,N]),te=(0,i.useMemo)(()=>{if(!_)return null;const e=_.x/100*.4-89.2,t=30+_.y/100*.4;return new sA({id:"holoocean-pov",data:[{position:[e,t]}],getPosition:e=>e.position,getFillColor:[255,0,255,200],getLineColor:[255,255,255,255],lineWidthMinPixels:2,getRadius:5e4,radiusScale:1,radiusMinPixels:8,radiusMaxPixels:20,stroked:!0,filled:!0,pickable:!0})},[_]),ne=(0,i.useMemo)(()=>a&&0!==a.length?new sA({id:"stations",data:a,getPosition:e=>[e.lon,e.lat],getFillColor:e=>e.station_id===(null===o||void 0===o?void 0:o.station_id)?[255,215,0,255]:[100,200,255,200],getRadius:e=>e.station_id===(null===o||void 0===o?void 0:o.station_id)?1e5:5e4,radiusScale:1,radiusMinPixels:e=>e.station_id===(null===o||void 0===o?void 0:o.station_id)?10:6,radiusMaxPixels:e=>e.station_id===(null===o||void 0===o?void 0:o.station_id)?25:15,pickable:!0,onHover:e=>{e.object?G({name:e.object.station_id,depth:e.object.depth||"N/A",x:e.x,y:e.y}):G(null)},onClick:e=>{e.object&&Y(s,e.object)}}):null,[a,o,v,s]),re={temperature:"\ud83c\udf21\ufe0f Temperature",salinity:"\ud83e\uddc2 Salinity",oceanCurrents:"\ud83c\udf0a Ocean Currents",ssh:"\ud83c\udf0a SSH",pressure:"\u2696\ufe0f Pressure",windVelocity:"\ud83d\udca8 Wind Velocity"},ie=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"heatmap";if(!e||0===e.length)return[];const o=e.filter(e=>{const t=n(e);return null!=t&&!isNaN(t)&&isFinite(t)});if(0===o.length)return[];const s=[];return"heatmap"===i?s.push(new FA({id:`${t}-heatmap`,data:o,getPosition:e=>[e.lon,e.lat],getWeight:e=>{const t=n(e);return Math.max(0,Math.min(1,t))},radiusPixels:30,intensity:1,threshold:.03,colorRange:r,aggregation:"SUM"})):"hexagon"===i&&s.push(new sP({id:`${t}-hexagon`,data:o,getPosition:e=>[e.lon,e.lat],getColorWeight:e=>n(e),colorAggregation:"MEAN",radius:5e4,elevationScale:0,extruded:!1,coverage:.9,colorRange:r,pickable:!0})),s},oe=[[0,0,255],[0,255,255],[0,255,0],[255,255,0],[255,165,0],[255,0,0]],se=[[255,255,255],[200,255,200],[0,255,0],[0,200,100],[0,150,150],[0,100,200]],ae=[[139,0,139],[75,0,130],[0,0,255],[0,255,255],[255,255,0],[255,0,0]],le=[[255,165,0],[255,215,0],[255,255,0],[173,255,47],[0,255,0],[0,200,0]];return(0,jr.jsxs)("div",{className:"relative w-full h-full",children:[(0,jr.jsx)("div",{ref:e=>{w.current=e,e&&!E&&T(!0)},className:"absolute inset-0 w-full h-full"}),E&&(0,jr.jsx)(NT,{viewState:P,onViewStateChange:e=>{let{viewState:t}=e;I(t),S.current&&S.current.jumpTo({center:[t.longitude,t.latitude],zoom:t.zoom,pitch:t.pitch,bearing:t.bearing})},controller:!0,layers:(()=>{const e=[];if(Q&&e.push(Q),ee&&e.push(ee),u.temperature&&r&&r.length>0){const t=r.filter(e=>null!=e.temp);if(t.length>0){const n=Math.min(...t.map(e=>e.temp)),r=Math.max(...t.map(e=>e.temp));e.push(...ie(t,"temperature",e=>(e.temp-n)/(r-n||1),oe,"hexagon"))}}if(u.salinity&&r&&r.length>0){const t=r.filter(e=>null!=e.salinity);if(t.length>0){const n=Math.min(...t.map(e=>e.salinity)),r=Math.max(...t.map(e=>e.salinity));e.push(...ie(t,"salinity",e=>(e.salinity-n)/(r-n||1),se,"hexagon"))}}if(u.ssh&&r&&r.length>0){const t=r.filter(e=>null!=e.ssh);if(t.length>0){const n=Math.min(...t.map(e=>e.ssh)),r=Math.max(...t.map(e=>e.ssh));e.push(...ie(t,"ssh",e=>(e.ssh-n)/(r-n||1),ae,"hexagon"))}}if(u.pressure&&r&&r.length>0){const t=r.filter(e=>null!=e.pressure);if(t.length>0){const n=Math.min(...t.map(e=>e.pressure)),r=Math.max(...t.map(e=>e.pressure));e.push(...ie(t,"pressure",e=>(e.pressure-n)/(r-n||1),le,"hexagon"))}}if(u.oceanCurrents&&r&&r.length>0){const t=r.filter(e=>null!=e.ucur&&null!=e.vcur&&!isNaN(e.ucur)&&!isNaN(e.vcur)&&isFinite(e.ucur)&&isFinite(e.vcur));if(t.length>0){const n=t.map(e=>{const t=Math.sqrt(e.ucur*e.ucur+e.vcur*e.vcur),n=(180*Math.atan2(e.vcur,e.ucur)/Math.PI+90+360)%360;return{lon:e.lon,lat:e.lat,nspeed:t,direction:n}});e.push(new V0({id:"ocean-currents-particles",data:n,particleCount:800,maxAge:12,opacity:.8,time:Z,particleSpeedFactor:1.5,vectorScale:1,arrowColor:"cyan",pauseAnimation:W,getColor:(e,t)=>[0,200,255,t]}))}}if(u.windVelocity&&r&&r.length>0){const t=r.filter(e=>null!=e.uwnd&&null!=e.vwnd&&!isNaN(e.uwnd)&&!isNaN(e.vwnd)&&isFinite(e.uwnd)&&isFinite(e.vwnd));if(t.length>0){const n=t.map(e=>{const t=Math.sqrt(e.uwnd*e.uwnd+e.vwnd*e.vwnd),n=(180*Math.atan2(e.vwnd,e.uwnd)/Math.PI+90+360)%360;return{lon:e.lon,lat:e.lat,speed:t,direction:n}});e.push(new V0({id:"wind-velocity-particles",data:n,particleCount:600,maxAge:10,opacity:.7,time:Z,particleSpeedFactor:2,vectorScale:1,arrowColor:"yellow",pauseAnimation:W,getPosition:e=>[e.lon,e.lat],getSpeed:e=>e.speed,getDirection:e=>e.direction,getColor:(e,t)=>[255,255,0,t]}))}}return te&&e.push(te),ne&&e.push(ne),e})(),onHover:e=>{var t,n,i,o,s,a,l,c;if(!e.coordinate)return void $(null);if(e.object||null!==(t=e.layer)&&void 0!==t&&null!==(n=t.id)&&void 0!==n&&n.includes("wind")||null!==(i=e.layer)&&void 0!==i&&null!==(o=i.id)&&void 0!==o&&o.includes("grid")||null!==(s=e.layer)&&void 0!==s&&null!==(a=s.id)&&void 0!==a&&a.includes("pov")||null!==(l=e.layer)&&void 0!==l&&null!==(c=l.id)&&void 0!==c&&c.includes("ssh"))return void $(null);const[h,d]=e.coordinate,f=((e,t)=>{const n=[],i=(i,o)=>{if(u[i]&&r&&r.length>0){const i=r.some(n=>{const r=Math.abs(n.lon-e),i=Math.abs(n.lat-t);return r<.5&&i<.5});i&&n.push(o)}};return i("temperature","\ud83c\udf21\ufe0f Temperature"),i("salinity","\ud83e\uddc2 Salinity"),i("oceanCurrents","\ud83c\udf0a Ocean Currents"),i("ssh","\ud83c\udf0a SSH"),i("pressure","\u2696\ufe0f Pressure"),i("windVelocity","\ud83d\udca8 Wind Velocity"),n})(h,d);f.length>0&&P.zoom>6?$({name:`${d.toFixed(4)}\xb0, ${h.toFixed(4)}\xb0`,details:`Available data:\n${f.join("\n")}`,x:e.x,y:e.y,isCoordinate:!0,longitude:h,latitude:d}):$(null)},onClick:e=>{console.log(e),!e.object&&e.coordinate&&_&&Y(y,{x:(e.coordinate[0]+89.2)/.4*100,y:(e.coordinate[1]-30)/.4*100,depth:h})},className:"absolute inset-0 w-full h-full z-10"}),(0,jr.jsxs)("div",{className:"absolute top-2 md:top-2 left-[200px] md:left-[200px] bg-slate-800/90 border border-slate-600/50 rounded-lg p-2 z-20 max-h-96 overflow-y-auto",children:[(0,jr.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,jr.jsx)("div",{className:"text-xs font-semibold text-slate-300",children:"Global Controls"}),(0,jr.jsx)("button",{onClick:()=>U(!j),className:"text-slate-400 hover:text-slate-200",children:j?"\u2227":"+"})]}),j&&(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsxs)("div",{className:"mb-3",children:[(0,jr.jsx)("label",{className:"text-xs text-slate-400 block mb-1",children:"Map Style"}),(0,jr.jsxs)("select",{value:k,onChange:e=>(e=>{if(M(e),S.current){const t="arcgis-ocean"===e?"mapbox://styles/mapbox/dark-v10":e;S.current.setStyle(t),S.current.once("style.load",()=>{S.current.setFog({color:"rgb(186, 210, 235)","high-color":"rgb(36, 92, 223)","horizon-blend":.02,"space-color":"rgb(11, 11, 25)","star-intensity":.6})})}})(e.target.value),className:"w-full text-xs bg-slate-700 border border-slate-600 rounded px-2 py-1 text-slate-200",children:[(0,jr.jsx)("option",{value:"arcgis-ocean",children:"\ud83c\udf0a Ocean (ArcGIS)"}),(0,jr.jsx)("option",{value:"mapbox://styles/mapbox/outdoors-v11",children:"\ud83c\udfde\ufe0f Outdoors"}),(0,jr.jsx)("option",{value:"mapbox://styles/mapbox/satellite-v9",children:"\ud83d\udef0\ufe0f Satellite"}),(0,jr.jsx)("option",{value:"mapbox://styles/mapbox/dark-v10",children:"\ud83c\udf11 Dark"}),(0,jr.jsx)("option",{value:"mapbox://styles/mapbox/light-v10",children:"\ud83d\udca1 Light"}),(0,jr.jsx)("option",{value:"mapbox://styles/mapbox/streets-v9",children:"\ud83d\udee3\ufe0f Streets"})]})]}),(0,jr.jsxs)("div",{className:"mb-3 pb-2 border-b border-slate-600",children:[(0,jr.jsx)("div",{className:"text-xs font-semibold text-slate-300 mb-2",children:"Globe Controls"}),(0,jr.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,jr.jsx)("button",{onClick:()=>{B(!F),F||J()},className:"w-4 h-4 rounded border "+(F?"bg-blue-500 border-blue-500":"bg-transparent border-slate-500"),children:F&&(0,jr.jsx)("svg",{className:"w-3 h-3 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,jr.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:"Auto Rotate Globe"})]}),(0,jr.jsx)("button",{onClick:()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.easeTo({center:[0,20],zoom:1.5,pitch:0,bearing:0,duration:2e3})},className:"w-full text-xs bg-slate-600 hover:bg-slate-500 text-slate-200 px-2 py-1 rounded mb-2",children:"\ud83c\udf0d Global View"})]}),(0,jr.jsxs)("div",{className:"mb-3 pb-2 border-b border-slate-600",children:[(0,jr.jsx)("div",{className:"text-xs font-semibold text-slate-300 mb-2",children:"Coordinate Grid"}),(0,jr.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,jr.jsx)("button",{onClick:()=>O(!R),className:"w-4 h-4 rounded border "+(R?"bg-blue-500 border-blue-500":"bg-transparent border-slate-500"),children:R&&(0,jr.jsx)("svg",{className:"w-3 h-3 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,jr.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:"\ud83d\udccb Lat/Lon Grid"})]}),R&&(0,jr.jsxs)("div",{className:"ml-4 space-y-2",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("label",{className:"text-xs text-slate-400 block mb-1",children:["Opacity: ",Math.round(100*L),"%"]}),(0,jr.jsx)("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:L,onChange:e=>D(parseFloat(e.target.value)),className:"w-full h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer"})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("label",{className:"text-xs text-slate-400 block mb-1",children:["Grid Spacing: ",N,"\xb0"]}),(0,jr.jsx)("input",{type:"range",min:"1",max:"30",step:"1",value:N,onChange:e=>z(parseInt(e.target.value)),className:"w-full h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer"})]})]})]})]})]}),(0,jr.jsxs)("div",{className:"absolute top-2 md:top-4 right-9 md:right-11 bg-slate-800/80 px-2 md:px-3 py-1 md:py-2 rounded-lg pointer-events-none z-20",children:[(0,jr.jsxs)("div",{className:"text-xs md:text-sm font-mono",children:["Frame: ",l+1,"/",c>0?c:24]}),(0,jr.jsx)("div",{className:"text-xs text-slate-400",children:m}),f&&p&&(0,jr.jsxs)("div",{className:"text-xs text-green-300 mt-1",children:[f," ",p]})]}),(0,jr.jsxs)("div",{className:"absolute bottom-5 md:bottom-7 left-2 md:left-4 bg-slate-800/80 px-2 md:px-3 py-1 md:py-2 rounded-lg pointer-events-none z-20 max-w-xs",children:[(0,jr.jsx)("div",{className:"text-xs md:text-sm font-semibold text-slate-300",children:"Interactive Ocean Map"}),(0,jr.jsxs)("div",{className:"text-xs text-slate-400",children:["Depth: ",h,"m"]}),(0,jr.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:Object.entries(u).filter(e=>{let[t,n]=e;return n&&re[t]}).map(e=>{let[t]=e;return(0,jr.jsx)("span",{className:"mr-2 inline-block bg-slate-700/50 px-1 rounded",children:re[t]},t)})}),(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mt-1",children:[u.oceanCurrents&&(0,jr.jsx)("span",{className:"text-blue-300",children:"\ud83c\udf0a Currents "}),u.temperature&&(0,jr.jsx)("span",{className:"text-red-300",children:"\ud83c\udf21\ufe0f Temperature "}),u.salinity&&(0,jr.jsx)("span",{className:"text-emerald-300",children:"\ud83e\uddc2 Salinity "}),u.ssh&&(0,jr.jsx)("span",{className:"text-indigo-300",children:"\ud83c\udf0a SSH "}),u.pressure&&(0,jr.jsx)("span",{className:"text-orange-300",children:"\u2696\ufe0f Pressure "}),u.windVelocity&&(0,jr.jsx)("span",{className:"text-yellow-300",children:"\ud83d\udca8 Wind Velocity "}),R&&(0,jr.jsx)("span",{className:"text-blue-300",children:"\ud83d\udccb Grid "}),"arcgis-ocean"===k&&(0,jr.jsx)("span",{className:"text-indigo-300",children:"\ud83c\udf0a Ocean Base "})]}),F&&(0,jr.jsx)("div",{className:"text-xs text-cyan-300 mt-1",children:"\ud83c\udf0d Globe Auto-Rotating"}),W&&(0,jr.jsx)("div",{className:"text-xs text-red-300 mt-1",children:"\u23f8\ufe0f Particles Paused"}),!v&&(0,jr.jsx)("div",{className:"text-xs text-yellow-300 mt-1",children:"\u23f3 Bridge initializing..."})]}),(0,jr.jsx)(ZM,{station:V}),(0,jr.jsx)(j0,{station:o,data:r,onClose:()=>{Y(s,null)}}),(0,jr.jsxs)("div",{className:"absolute top-2 md:top-2 left-2 md:left-4 bg-slate-800/80 px-2 md:px-3 py-1 md:py-2 rounded-lg z-20",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400",children:"HoloOcean POV"}),(0,jr.jsxs)("div",{className:"text-xs md:text-sm font-mono text-cyan-300",children:["(",_.x.toFixed(1),", ",_.y.toFixed(1),")"]}),(0,jr.jsxs)("div",{className:"mt-2",children:[(0,jr.jsxs)("label",{className:"text-xs text-slate-400 block mb-1",children:["Depth: ",_.depth,"m"]}),(0,jr.jsx)("input",{type:"range",min:g.length>0?Math.min(...g):0,max:g.length>0?Math.max(...g):12,step:g.length>1?(Math.max(...g)-Math.min(...g))/(g.length-1):1,value:_.depth,onChange:e=>{const t=Number(e.target.value);Y(y,{x:_.x,y:_.y,depth:t}),Y(d,t)},className:"w-full h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer",disabled:0===g.length}),(0,jr.jsxs)("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[(0,jr.jsxs)("span",{children:[g.length>0?Math.min(...g):0,"m"]}),(0,jr.jsxs)("span",{children:[g.length>0?Math.max(...g):12,"m"]})]})]})]})]})},H0=Dr("wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]),$0=Dr("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),W0=Dr("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),q0=Dr("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);var X0=["axis"],Z0=(0,i.forwardRef)((e,t)=>i.createElement(vZ,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:X0,tooltipPayloadSearcher:bL,categoricalChartProps:e,ref:t})),K0=(e,t,n,r)=>I$(e,"xAxis",t,r),Y0=(e,t,n,r)=>P$(e,"xAxis",t,r),J0=(e,t,n,r)=>I$(e,"yAxis",n,r),Q0=(e,t,n,r)=>P$(e,"yAxis",n,r),e1=nN([_z,K0,J0,Y0,Q0],(e,t,n,r,i)=>DN(e,"xAxis")?qN(t,r,!1):qN(n,i,!1)),t1=nN([eH,(e,t,n,r,i)=>i],(e,t)=>e.filter(e=>"area"===e.type).find(e=>e.id===t)),n1=nN([_z,K0,J0,Y0,Q0,(e,t,n,r,i)=>{var o,s=t1(e,t,n,r,i);if(null!=s){var a,l=_z(e);if(null!=(a=DN(l,"xAxis")?yH(e,"yAxis",n,r):yH(e,"xAxis",t,r))){var{stackId:c}=s,u=LG(s);if(null!=c&&null!=u){var h=null===(o=a[c])||void 0===o?void 0:o.stackedData;return null===h||void 0===h?void 0:h.find(e=>e.key===u)}}}},MV,e1,t1],(e,t,n,r,i,o,s,a,l)=>{var{chartData:c,dataStartIndex:u,dataEndIndex:h}=s;if(null!=l&&("horizontal"===e||"vertical"===e)&&null!=t&&null!=n&&null!=r&&null!=i&&0!==r.length&&0!==i.length&&null!=a){var d,{data:f}=l;if(null!=(d=f&&f.length>0?f:null===c||void 0===c?void 0:c.slice(u,h+1))){return function(e){var t,{areaSettings:{connectNulls:n,baseValue:r,dataKey:i},stackedData:o,layout:s,chartBaseValue:a,xAxis:l,yAxis:c,displayedData:u,dataStartIndex:h,xAxisTicks:d,yAxisTicks:f,bandSize:p}=e,m=o&&o.length,g=S1(s,a,r,l,c),_="horizontal"===s,y=!1,v=u.map((e,t)=>{var r;m?r=o[h+t]:(r=LN(e,i),Array.isArray(r)?y=!0:r=[g,r]);var s=null==r[1]||m&&!n&&null==LN(e,i);return _?{x:VN({axis:l,ticks:d,bandSize:p,entry:e,index:t}),y:s?null:c.scale(r[1]),value:r,payload:e}:{x:s?null:l.scale(r[1]),y:VN({axis:c,ticks:f,bandSize:p,entry:e,index:t}),value:r,payload:e}});t=m||y?v.map(e=>{var t=Array.isArray(e.value)?e.value[0]:null;return _?{x:e.x,y:null!=t&&null!=e.y?c.scale(t):null,payload:e.payload}:{x:null!=t?l.scale(t):null,y:e.y,payload:e.payload}}):_?c.scale(g):l.scale(g);return{points:v,baseLine:t,isRange:y}}({layout:e,xAxis:t,yAxis:n,xAxisTicks:r,yAxisTicks:i,dataStartIndex:u,areaSettings:l,stackedData:o,displayedData:d,chartBaseValue:undefined,bandSize:a})}}}),r1=["id"],i1=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function o1(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function s1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s1(Object(n),!0).forEach(function(t){l1(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s1(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l1(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c1(){return c1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c1.apply(null,arguments)}function u1(e,t){return e&&"none"!==e?e:t}var h1=e=>{var{dataKey:t,name:n,stroke:r,fill:i,legendType:o,hide:s}=e;return[{inactive:s,dataKey:t,type:o,color:u1(r,i),value:ZN(n,t),payload:e}]};function d1(e){var{dataKey:t,data:n,stroke:r,strokeWidth:i,fill:o,name:s,hide:a,unit:l}=e;return{dataDefinedOnItem:n,positions:void 0,settings:{stroke:r,strokeWidth:i,fill:o,dataKey:t,nameKey:void 0,name:ZN(s,t),hide:a,type:e.tooltipType,color:u1(r,o),unit:l}}}function f1(e){var{clipPathId:t,points:n,props:r}=e,{needClip:o,dot:s,dataKey:a}=r;if(!function(e,t){return null!=e&&(!!t||1===e.length)}(n,s))return null;var l=NX(s),c=kX(r),u=zX(s,!0),h=n.map((e,t)=>{var r=a1(a1(a1({key:"dot-".concat(t),r:3},c),u),{},{index:t,cx:e.x,cy:e.y,dataKey:a,value:e.value,payload:e.payload,points:n});return((e,t)=>{var n;if(i.isValidElement(e))n=i.cloneElement(e,t);else if("function"===typeof e)n=e(t);else{var r=yi("recharts-area-dot","boolean"!==typeof e?e.className:"");n=i.createElement(nJ,c1({},t,{className:r}))}return n})(s,r)}),d={clipPath:o?"url(#clipPath-".concat(l?"":"dots-").concat(t,")"):void 0};return i.createElement(TZ,c1({className:"recharts-area-dots"},d),h)}function p1(e){var{points:t,baseLine:n,needClip:r,clipPathId:o,props:s,showLabels:a}=e,{layout:l,type:c,stroke:u,connectNulls:h,isRange:d}=s,{id:f}=s,p=o1(s,r1),m=kX(p);return i.createElement(i.Fragment,null,(null===t||void 0===t?void 0:t.length)>1&&i.createElement(TZ,{clipPath:r?"url(#clipPath-".concat(o,")"):void 0},i.createElement(eJ,c1({},m,{id:f,points:t,connectNulls:h,type:c,baseLine:n,layout:l,stroke:"none",className:"recharts-area-area"})),"none"!==u&&i.createElement(eJ,c1({},m,{className:"recharts-area-curve",layout:l,type:c,connectNulls:h,fill:"none",points:t})),"none"!==u&&d&&i.createElement(eJ,c1({},m,{className:"recharts-area-curve",layout:l,type:c,connectNulls:h,fill:"none",points:n}))),i.createElement(f1,{points:t,props:p,clipPathId:o}),a&&fJ.renderCallByParent(p,t))}function m1(e){var{alpha:t,baseLine:n,points:r,strokeWidth:o}=e,s=r[0].y,a=r[r.length-1].y;if(!RV(s)||!RV(a))return null;var l=t*Math.abs(s-a),c=Math.max(...r.map(e=>e.x||0));return lR(n)?c=Math.max(n,c):n&&Array.isArray(n)&&n.length&&(c=Math.max(...n.map(e=>e.x||0),c)),lR(c)?i.createElement("rect",{x:0,y:s<a?s:s-l,width:c+(o?parseInt("".concat(o),10):1),height:Math.floor(l)}):null}function g1(e){var{alpha:t,baseLine:n,points:r,strokeWidth:o}=e,s=r[0].x,a=r[r.length-1].x;if(!RV(s)||!RV(a))return null;var l=t*Math.abs(s-a),c=Math.max(...r.map(e=>e.y||0));return lR(n)?c=Math.max(n,c):n&&Array.isArray(n)&&n.length&&(c=Math.max(...n.map(e=>e.y||0),c)),lR(c)?i.createElement("rect",{x:s<a?s:s-l,y:0,width:l,height:Math.floor(c+(o?parseInt("".concat(o),10):1))}):null}function _1(e){var{alpha:t,layout:n,points:r,baseLine:o,strokeWidth:s}=e;return"vertical"===n?i.createElement(m1,{alpha:t,points:r,baseLine:o,strokeWidth:s}):i.createElement(g1,{alpha:t,points:r,baseLine:o,strokeWidth:s})}function y1(e){var{needClip:t,clipPathId:n,props:r,previousPointsRef:o,previousBaselineRef:s}=e,{points:a,baseLine:l,isAnimationActive:c,animationBegin:u,animationDuration:h,animationEasing:d,onAnimationStart:f,onAnimationEnd:p}=r,m=NJ(r,"recharts-area-"),[g,_]=(0,i.useState)(!0),y=(0,i.useCallback)(()=>{"function"===typeof p&&p(),_(!1)},[p]),v=(0,i.useCallback)(()=>{"function"===typeof f&&f(),_(!0)},[f]),x=o.current,b=s.current;return i.createElement(fQ,{begin:u,duration:h,isActive:c,easing:d,onAnimationEnd:y,onAnimationStart:v,key:m},e=>{if(x){var c,u=x.length/a.length,h=1===e?a:a.map((t,n)=>{var r=Math.floor(n*u);if(x[r]){var i=x[r];return a1(a1({},t),{},{x:pR(i.x,t.x,e),y:pR(i.y,t.y,e)})}return t});return c=lR(l)?pR(b,l,e):gR(l)||sR(l)?pR(b,0,e):l.map((t,n)=>{var r=Math.floor(n*u);if(Array.isArray(b)&&b[r]){var i=b[r];return a1(a1({},t),{},{x:pR(i.x,t.x,e),y:pR(i.y,t.y,e)})}return t}),e>0&&(o.current=h,s.current=c),i.createElement(p1,{points:h,baseLine:c,needClip:t,clipPathId:n,props:r,showLabels:!g})}return e>0&&(o.current=a,s.current=l),i.createElement(TZ,null,i.createElement("defs",null,i.createElement("clipPath",{id:"animationClipPath-".concat(n)},i.createElement(_1,{alpha:e,points:a,baseLine:l,layout:r.layout,strokeWidth:r.strokeWidth}))),i.createElement(TZ,{clipPath:"url(#animationClipPath-".concat(n,")")},i.createElement(p1,{points:a,baseLine:l,needClip:t,clipPathId:n,props:r,showLabels:!0})))})}function v1(e){var{needClip:t,clipPathId:n,props:r}=e,{points:o,baseLine:s,isAnimationActive:a}=r,l=(0,i.useRef)(null),c=(0,i.useRef)(),u=l.current,h=c.current;return a&&o&&o.length&&(u!==o||h!==s)?i.createElement(y1,{needClip:t,clipPathId:n,props:r,previousPointsRef:l,previousBaselineRef:c}):i.createElement(p1,{points:o,baseLine:s,needClip:t,clipPathId:n,props:r,showLabels:!0})}class x1 extends i.PureComponent{render(){var e,{hide:t,dot:n,points:r,className:o,top:s,left:a,needClip:l,xAxisId:c,yAxisId:u,width:h,height:d,id:f,baseLine:p}=this.props;if(t)return null;var m=yi("recharts-area",o),g=f,{r:_=3,strokeWidth:y=2}=null!==(e=zX(n,!1))&&void 0!==e?e:{r:3,strokeWidth:2},v=NX(n),x=2*_+y;return i.createElement(i.Fragment,null,i.createElement(TZ,{className:m},l&&i.createElement("defs",null,i.createElement(EJ,{clipPathId:g,xAxisId:c,yAxisId:u}),!v&&i.createElement("clipPath",{id:"clipPath-dots-".concat(g)},i.createElement("rect",{x:a-x/2,y:s-x/2,width:h+x,height:d+x}))),i.createElement(v1,{needClip:l,clipPathId:g,props:this.props})),i.createElement(_J,{points:r,mainColor:u1(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}),this.props.isRange&&Array.isArray(p)&&i.createElement(_J,{points:p,mainColor:u1(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}))}}var b1={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:!AZ,legendType:"line",stroke:"#3182bd",xAxisId:0,yAxisId:0};function w1(e){var t,n=mZ(e,b1),{activeDot:r,animationBegin:o,animationDuration:s,animationEasing:a,connectNulls:l,dot:c,fill:u,fillOpacity:h,hide:d,isAnimationActive:f,legendType:p,stroke:m,xAxisId:g,yAxisId:_}=n,y=o1(n,i1),v=yz(),x=UW(),{needClip:b}=SJ(g,_),w=cz(),{points:S,isRange:E,baseLine:T}=null!==(t=hN(t=>n1(t,g,_,w,e.id)))&&void 0!==t?t:{},A=lZ();if("horizontal"!==v&&"vertical"!==v||null==A)return null;if("AreaChart"!==x&&"ComposedChart"!==x)return null;var{height:C,width:P,x:I,y:k}=A;return S&&S.length?i.createElement(x1,c1({},y,{activeDot:r,animationBegin:o,animationDuration:s,animationEasing:a,baseLine:T,connectNulls:l,dot:c,fill:u,fillOpacity:h,height:C,hide:d,layout:v,isAnimationActive:f,isRange:E,legendType:p,needClip:b,points:S,stroke:m,width:P,left:I,top:k,xAxisId:g,yAxisId:_})):null}var S1=(e,t,n,r,i)=>{var o=null!==n&&void 0!==n?n:t;if(lR(o))return o;var s="horizontal"===e?i:r,a=s.scale.domain();if("number"===s.type){var l=Math.max(a[0],a[1]),c=Math.min(a[0],a[1]);return"dataMin"===o?c:"dataMax"===o||l<0?l:Math.max(Math.min(a[0],a[1]),0)}return"dataMin"===o?a[0]:"dataMax"===o?a[1]:a[0]};function E1(e){var t=mZ(e,b1),n=cz();return i.createElement(BJ,{id:t.id,type:"area"},e=>i.createElement(i.Fragment,null,i.createElement(DJ,{legendPayload:h1(t)}),i.createElement(yJ,{fn:d1,args:t}),i.createElement(jJ,{type:"area",id:e,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:UN(t.stackId),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:n,connectNulls:t.connectNulls}),i.createElement(w1,c1({},t,{id:e}))))}E1.displayName="Area";const T1=n.p+"static/media/recording.eeb3b0e0f41b635904ac.mp4",A1=e=>{let{envData:t={temperature:null,salinity:null,pressure:null,depth:0},holoOceanPOV:n={x:0,y:0,depth:0},selectedDepth:r=0,selectedParameter:o="Wind Speed",timeSeriesData:s=[],currentFrame:a=0,availableDepths:l=[],showHoloOcean:c=!0,showEnvironmental:u=!0,showCharts:h=!0,showAdvancedMetrics:d=!1,onDepthChange:f,onParameterChange:p,onPOVChange:m,onRefreshData:g,className:_=""}=e;const[y,v]=(0,i.useState)(null),[x,b]=(0,i.useState)(24),[w,S]=(0,i.useState)(!0),{isConnected:E,isHoloOceanRunning:T,target:A,current:C,hasTarget:P,hasCurrent:I,distanceToTarget:k,isAtTarget:M,tickCount:R,lastUpdated:O,holoOceanError:L,connectionError:D}=Pr(),N=s,z=(0,i.useMemo)(()=>l&&0!==l.length?Math.max(...l):200,[l]);(0,i.useEffect)(()=>{const e=setInterval(()=>{S(e=>Math.random()>.1||e)},5e3);return()=>clearInterval(e)},[]);const F={"Wind Speed":"currentSpeed","Current Direction":"heading",Temperature:"temperature","Sound Speed":"soundSpeed",SSH:"ssh",Salinity:"salinity",Pressure:"pressure","Wind Direction":"windDirection"},B=(e,t)=>{if(null===e||void 0===e||isNaN(e))return"No Data";const n=Number(e);switch(t){case"temperature":return`${n.toFixed(2)}\xb0F`;case"salinity":return`${n.toFixed(2)} PSU`;case"pressure":return`${n.toFixed(1)} dbar`;case"depth":return`${n} m`;case"speed":return`${n.toFixed(3)} m/s`;case"direction":return`${n.toFixed(1)}\xb0`;case"height":return`${n.toFixed(2)} m`;case"soundSpeed":case"windSpeed":return`${n.toFixed(2)} m/s`;case"distance":return n<1e3?`${n.toFixed(1)}m`:`${(n/1e3).toFixed(2)}km`;case"coordinate":return`${n.toFixed(6)}\xb0`;default:return n.toString()}},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;const n=F[e]||"currentSpeed";if(!N.length)return[];const r=N.slice(-t).map((e,t)=>{let r;if(e.time)r=e.time;else if(e.timestamp){r=new Date(e.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}else r=`${String(t%24).padStart(2,"0")}:00`;return{time:r,value:Number(e[n])||0,originalData:e,...e}});return r},U=((0,i.useMemo)(()=>{if(!N.length)return["Wind Speed","Current Direction","Temperature","Sound Speed","Salinity","Pressure","SSH"];const e=N[0],t=[];return Object.entries(F).forEach(n=>{let[r,i]=n;void 0!==e[i]&&t.push(r)}),t.length?t:["Wind Speed","Current Direction","Temperature","Sound Speed","SSH"]},[N,F]),(()=>{if(N&&N.length>0){const e=Math.min(a,N.length-1),t=N[e],n=F[o]||"currentSpeed";return{...t,selectedValue:t[n]}}return null})()),V=(()=>{if(!N.length)return{level:"No Data",color:"text-red-400"};const e=N[N.length-1],t=(null===e||void 0===e?void 0:e.timestamp)||(null===e||void 0===e?void 0:e.time)||Date.now(),n=(Date.now()-new Date(t))/36e5;return n<1?{level:"Real-time",color:"text-green-400"}:n<6?{level:"Recent",color:"text-blue-400"}:n<24?{level:"Delayed",color:"text-yellow-400"}:{level:"Historical",color:"text-orange-400"}})(),G=e=>{if(!U)return null;return U[F[e]||"currentSpeed"]};return(0,jr.jsxs)("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 border-green-500/30 ${_}`,children:[(0,jr.jsx)("div",{className:"col-span-2 md:col-span-2 lg:col-span-2 p-2 md:p-4 bg-gradient-to-r from-green-900/20 to-emerald-900/20 border-r border-green-500/10",children:(0,jr.jsx)("div",{className:"w-full h-full relative overflow-hidden rounded-lg shadow-lg",children:(0,jr.jsx)("video",{src:T1,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,playbackRate:1.8,className:"w-full h-full object-cover rounded-lg"})})}),(0,jr.jsxs)("div",{className:"col-span-1 md:col-span-1 lg:col-span-1 p-2 md:p-4 border-slate-700 space-y-4",children:[u&&(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-2 md:mb-3",children:[(0,jr.jsxs)("h3",{className:"text-xs md:text-sm font-semibold text-slate-300 flex items-center gap-1",children:[(0,jr.jsx)(zr,{className:"w-3 h-3 md:w-4 md:h-4"}),"Environmental Data"]}),(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)("div",{className:`w-2 h-2 rounded-full ${V.color.replace("text-","bg-")}`}),(0,jr.jsx)("span",{className:`text-xs ${V.color}`,children:V.level})]})]}),(0,jr.jsxs)("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[(0,jr.jsxs)("div",{className:"bg-slate-700/50 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-1 md:gap-2 mb-1",children:[(0,jr.jsx)(sc,{className:"w-3 h-3 md:w-4 md:h-4 text-red-400"}),(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:"Temperature"})]}),(0,jr.jsx)("div",{className:"text-sm md:text-lg font-bold text-red-300",children:B((null===t||void 0===t?void 0:t.temperature)||G("Temperature"),"temperature")})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/50 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-1 md:gap-2 mb-1",children:[(0,jr.jsx)(lc,{className:"w-3 h-3 md:w-4 md:h-4 text-blue-400"}),(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:"Salinity"})]}),(0,jr.jsx)("div",{className:"text-sm md:text-lg font-bold text-blue-300",children:B((null===t||void 0===t?void 0:t.salinity)||G("Salinity"),"salinity")})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/50 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-1 md:gap-2 mb-1",children:[(0,jr.jsx)(oc,{className:"w-3 h-3 md:w-4 md:h-4 text-cyan-400"}),(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:"Current Dir"})]}),(0,jr.jsx)("div",{className:"text-sm md:text-lg font-bold text-cyan-300",children:B((null===t||void 0===t?void 0:t.currentDirection)||G("Current Direction"),"direction")})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/50 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-1 md:gap-2 mb-1",children:[(0,jr.jsx)(H0,{className:"w-3 h-3 md:w-4 md:h-4 text-amber-400"}),(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:"Wind Speed"})]}),(0,jr.jsx)("div",{className:"text-sm md:text-lg font-bold text-amber-300",children:B((null===t||void 0===t?void 0:t.currentSpeed)||G("Wind Speed"),"speed")})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/50 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-1 md:gap-2 mb-1",children:[(0,jr.jsx)(zr,{className:"w-3 h-3 md:w-4 md:h-4 text-purple-400"}),(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:"Pressure"})]}),(0,jr.jsx)("div",{className:"text-sm md:text-lg font-bold text-purple-300",children:B((null===t||void 0===t?void 0:t.pressure)||G("Pressure"),"pressure")})]})]})]}),c&&(0,jr.jsxs)("div",{className:"bg-gradient-to-r from-green-900/20 to-emerald-900/20 p-2 md:p-4 rounded-lg border border-green-500/10",children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-2 md:mb-4",children:[(0,jr.jsxs)("h2",{className:"font-semibold text-green-300 flex items-center gap-2 text-sm md:text-base",children:[(0,jr.jsx)(oi,{className:"w-4 h-4 md:w-5 md:h-5"}),"HoloOcean Visualization"]}),(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 rounded text-xs "+(E?"bg-green-600/20 text-green-400":"bg-red-600/20 text-red-400"),children:[(0,jr.jsx)("div",{className:"w-2 h-2 rounded-full "+(E?"bg-green-400":"bg-red-400")}),(0,jr.jsx)("span",{children:E?"Connected":"Offline"})]}),(0,jr.jsx)("button",{onClick:()=>v("holo"===y?null:"holo"),className:"p-1 text-green-400 hover:text-green-300",children:"holo"===y?(0,jr.jsx)($0,{className:"w-4 h-4"}):(0,jr.jsx)(W0,{className:"w-4 h-4"})})]})]}),E&&(0,jr.jsxs)("div",{className:"mb-3 grid grid-cols-2 gap-2",children:[(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-2 rounded",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Agent Status"}),(0,jr.jsx)("div",{className:"text-sm font-medium "+(T?"text-green-400":"text-red-400"),children:T?"Running":"Stopped"}),R>0&&(0,jr.jsxs)("div",{className:"text-xs text-slate-500",children:["Tick: ",R.toLocaleString()]})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-2 rounded",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Navigation"}),(0,jr.jsx)("div",{className:"text-sm font-medium "+(M?"text-green-400":P?"text-yellow-400":"text-slate-400"),children:M?"At Target":P?"En Route":"No Target"}),null!==k&&(0,jr.jsx)("div",{className:"text-xs text-slate-500",children:B(k,"distance")})]})]}),D&&(0,jr.jsxs)("div",{className:"mb-3 p-2 bg-red-600/20 border border-red-500/30 rounded text-xs text-red-400",children:["Connection Error: ",D]}),L&&(0,jr.jsxs)("div",{className:"mb-3 p-2 bg-red-600/20 border border-red-500/30 rounded text-xs text-red-400",children:["Simulation Error: ",L]}),(0,jr.jsx)("p",{className:"text-xs text-slate-400 mb-3",children:"3D Environmental Data Display"}),(0,jr.jsxs)("div",{className:"bg-gradient-to-b from-green-900/30 to-blue-900/30 rounded-lg border border-green-500/20 relative overflow-hidden transition-all duration-300 "+("holo"===y?"h-80 md:h-96":"h-48 md:h-64"),children:[(0,jr.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,jr.jsxs)("div",{className:"text-center text-green-300/70",children:[(0,jr.jsxs)("div",{className:"w-12 h-12 md:w-16 md:h-16 mx-auto mb-2 md:mb-4 relative",children:[(0,jr.jsx)("div",{className:"absolute inset-0 border-2 border-green-400/30 rounded-full animate-ping"}),(0,jr.jsx)("div",{className:"absolute inset-2 border-2 border-green-400/50 rounded-full animate-pulse"}),(0,jr.jsx)("div",{className:"absolute inset-4 bg-green-400/20 rounded-full"})]}),(0,jr.jsx)("p",{className:"text-xs md:text-sm font-semibold",children:"HoloOcean 3D Stream"}),(0,jr.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:w?"WebRTC Connected":"Connecting..."})]})}),(0,jr.jsx)("div",{className:"absolute top-2 left-2 px-2 py-1 rounded text-xs font-semibold "+(w?"bg-green-600":"bg-yellow-600"),children:w?"LIVE":"BUFFER"}),(0,jr.jsxs)("div",{className:"absolute top-2 right-2 text-xs text-green-300",children:["POV: ",n.x.toFixed(1),", ",n.y.toFixed(1)]}),I&&(0,jr.jsxs)("div",{className:"absolute top-10 right-2 bg-slate-800/80 p-2 rounded text-xs",children:[(0,jr.jsxs)("div",{className:"text-green-300 font-medium flex items-center gap-1",children:[(0,jr.jsx)($r,{className:"w-3 h-3"}),"Current Position"]}),(0,jr.jsxs)("div",{className:"text-slate-300 mt-1",children:[(0,jr.jsxs)("div",{children:["Lat: ",B(C.lat,"coordinate")]}),(0,jr.jsxs)("div",{children:["Lon: ",B(C.lon,"coordinate")]}),(0,jr.jsxs)("div",{children:["Depth: ",B(C.depth,"depth")]})]}),O&&(0,jr.jsx)("div",{className:"text-slate-500 text-xs mt-1",children:(e=>{if(!e)return"Unknown";try{return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}})(O)})]}),P&&(0,jr.jsxs)("div",{className:"absolute top-2 left-20 bg-slate-800/80 p-2 rounded text-xs",children:[(0,jr.jsxs)("div",{className:"text-yellow-300 font-medium flex items-center gap-1",children:[(0,jr.jsx)(q0,{className:"w-3 h-3"}),"Target"]}),(0,jr.jsxs)("div",{className:"text-slate-300 mt-1",children:[(0,jr.jsxs)("div",{children:["Lat: ",B(A.lat,"coordinate")]}),(0,jr.jsxs)("div",{children:["Lon: ",B(A.lon,"coordinate")]}),(0,jr.jsxs)("div",{children:["Depth: ",B(A.depth,"depth")]})]})]}),(0,jr.jsx)("div",{className:"absolute bottom-2 md:bottom-4 left-2 md:left-4 right-2 md:right-4",children:(0,jr.jsxs)("div",{className:"bg-slate-800/80 p-2 rounded",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center justify-between",children:[(0,jr.jsx)("span",{children:"Depth Profile"}),(0,jr.jsxs)("span",{children:[r,"m"]})]}),(0,jr.jsxs)("div",{className:"h-8 md:h-12 bg-gradient-to-r from-blue-600 via-blue-500 to-blue-400 rounded relative cursor-pointer",onClick:e=>{const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left)/t.width,r=Math.round(n*z);null===f||void 0===f||f(r)},children:[(0,jr.jsx)("div",{className:"absolute w-1 h-full bg-yellow-400 rounded shadow-lg",style:{left:r/z*100+"%"}}),I&&null!==C.depth&&(0,jr.jsx)("div",{className:"absolute w-1 h-full bg-green-400 rounded shadow-lg opacity-80",style:{left:`${Math.min(Math.abs(C.depth)/z*100,100)}%`}}),P&&null!==A.depth&&(0,jr.jsx)("div",{className:"absolute w-1 h-full bg-red-400 rounded shadow-lg opacity-80",style:{left:`${Math.min(Math.abs(A.depth)/z*100,100)}%`}})]}),(0,jr.jsxs)("div",{className:"flex justify-between text-xs text-slate-400 mt-1",children:[(0,jr.jsx)("span",{children:"Surface"}),(0,jr.jsxs)("span",{children:[z,"m"]})]}),(I||P)&&(0,jr.jsxs)("div",{className:"flex gap-3 mt-1 text-xs",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)("div",{className:"w-2 h-2 bg-yellow-400 rounded"}),(0,jr.jsx)("span",{className:"text-slate-400",children:"Selected"})]}),I&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded"}),(0,jr.jsx)("span",{className:"text-slate-400",children:"Current"})]}),P&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)("div",{className:"w-2 h-2 bg-red-400 rounded"}),(0,jr.jsx)("span",{className:"text-slate-400",children:"Target"})]})]})]})})]})]})]}),h&&(0,jr.jsxs)("div",{className:"col-span-1 md:col-span-1 lg:col-span-1 p-2 md:p-4 border-slate-700",children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-2 md:mb-3",children:[(0,jr.jsxs)("h3",{className:"text-xs md:text-sm font-semibold text-slate-300 flex items-center gap-1 md:gap-2",children:[(0,jr.jsx)(YM,{className:"w-3 h-3 md:w-4 md:h-4"}),"Time Series Analysis"]}),(0,jr.jsx)("div",{className:"flex items-center gap-1",children:(0,jr.jsxs)("select",{value:x,onChange:e=>b(Number(e.target.value)),className:"bg-slate-700 border border-slate-600 rounded px-1 py-0.5 text-xs text-white",children:[(0,jr.jsx)("option",{value:12,children:"12h"}),(0,jr.jsx)("option",{value:24,children:"24h"}),(0,jr.jsx)("option",{value:48,children:"48h"})]})})]}),(0,jr.jsxs)("div",{className:"space-y-2 md:space-y-4",children:[(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center justify-between",children:[(0,jr.jsx)("span",{children:"Wind Speed (m/s)"}),(0,jr.jsx)("span",{className:"text-amber-300",children:B(G("Wind Speed"),"speed")})]}),(0,jr.jsx)(wR,{width:"100%",height:60,children:(0,jr.jsxs)(bZ,{data:j("Wind Speed",x),children:[(0,jr.jsx)(LQ,{type:"monotone",dataKey:"value",stroke:"#fcd34d",strokeWidth:2,dot:!1}),(0,jr.jsx)(UK,{hide:!0}),(0,jr.jsx)(ZK,{hide:!0}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px",color:"#ffffff"},formatter:e=>[`${Number(e).toFixed(3)} m/s`,"Wind Speed"],labelFormatter:e=>`Time: ${e}`})]})})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center justify-between",children:[(0,jr.jsx)("span",{children:"Current Direction (\xb0)"}),(0,jr.jsx)("span",{className:"text-emerald-300",children:B(G("Current Direction"),"direction")})]}),(0,jr.jsx)(wR,{width:"100%",height:60,children:(0,jr.jsxs)(bZ,{data:j("Current Direction",x),children:[(0,jr.jsx)(LQ,{type:"monotone",dataKey:"value",stroke:"#10b981",strokeWidth:2,dot:!1}),(0,jr.jsx)(UK,{hide:!0}),(0,jr.jsx)(ZK,{hide:!0}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px",color:"#ffffff"},formatter:e=>[`${Number(e).toFixed(1)}\xb0`,"Direction"],labelFormatter:e=>`Time: ${e}`})]})})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center justify-between",children:[(0,jr.jsx)("span",{children:"Sound Speed (m/s)"}),(0,jr.jsx)("span",{className:"text-green-300",children:B(G("Sound Speed"),"soundSpeed")})]}),(0,jr.jsx)(wR,{width:"100%",height:60,children:(0,jr.jsxs)(Z0,{data:j("Sound Speed",x),children:[(0,jr.jsx)(E1,{type:"monotone",dataKey:"value",stroke:"#10b981",fill:"#10b981",fillOpacity:.3}),(0,jr.jsx)(UK,{hide:!0}),(0,jr.jsx)(ZK,{hide:!0}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px",color:"#ffffff"},formatter:e=>[`${Number(e).toFixed(2)} m/s`,"Sound Speed"],labelFormatter:e=>`Time: ${e}`})]})})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center justify-between",children:[(0,jr.jsx)("span",{children:"Temperature (\xb0F)"}),(0,jr.jsx)("span",{className:"text-orange-300",children:B(G("Temperature"),"temperature")})]}),(0,jr.jsx)(wR,{width:"100%",height:60,children:(0,jr.jsxs)(bZ,{data:j("Temperature",x),children:[(0,jr.jsx)(LQ,{type:"monotone",dataKey:"value",stroke:"#f59e0b",strokeWidth:2,dot:!1}),(0,jr.jsx)(UK,{hide:!0}),(0,jr.jsx)(ZK,{hide:!0}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px",color:"#ffffff"},formatter:e=>[`${Number(e).toFixed(2)}\xb0F`,"Temp"],labelFormatter:e=>`Time: ${e}`})]})})]}),E&&I&&"holo"===y&&(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center justify-between",children:[(0,jr.jsx)("span",{children:"Agent Latitude (\xb0)"}),(0,jr.jsx)("span",{className:"text-cyan-300",children:B(C.lat,"coordinate")})]}),(0,jr.jsx)(wR,{width:"100%",height:60,children:(0,jr.jsxs)(bZ,{data:[{time:"Current",value:C.lat}],children:[(0,jr.jsx)(LQ,{type:"monotone",dataKey:"value",stroke:"#22d3ee",strokeWidth:2,dot:!0}),(0,jr.jsx)(UK,{hide:!0}),(0,jr.jsx)(ZK,{hide:!0}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px",color:"#ffffff"},formatter:e=>[`${Number(e).toFixed(6)}\xb0`,"Latitude"]})]})})]}),(0,jr.jsxs)("div",{className:"bg-slate-700/30 p-2 md:p-3 rounded-lg",children:[(0,jr.jsxs)("div",{className:"text-xs text-slate-400 mb-2 flex items-center justify-between",children:[(0,jr.jsx)("span",{children:"Agent Longitude (\xb0)"}),(0,jr.jsx)("span",{className:"text-pink-300",children:B(C.lon,"coordinate")})]}),(0,jr.jsx)(wR,{width:"100%",height:60,children:(0,jr.jsxs)(bZ,{data:[{time:"Current",value:C.lon}],children:[(0,jr.jsx)(LQ,{type:"monotone",dataKey:"value",stroke:"#f472b6",strokeWidth:2,dot:!0}),(0,jr.jsx)(UK,{hide:!0}),(0,jr.jsx)(ZK,{hide:!0}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px",color:"#ffffff"},formatter:e=>[`${Number(e).toFixed(6)}\xb0`,"Longitude"]})]})})]})]})]})]})]})};function C1(){}function P1(){}const I1=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,k1=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,M1={};function R1(e,t){return((t||M1).jsx?k1:I1).test(e)}const O1=/[ \t\n\f\r]/g;function L1(e){return""===e.replace(O1,"")}class D1{constructor(e,t,n){this.normal=t,this.property=e,n&&(this.space=n)}}function N1(e,t){const n={},r={};for(const i of e)Object.assign(n,i.property),Object.assign(r,i.normal);return new D1(n,r,t)}function z1(e){return e.toLowerCase()}D1.prototype.normal={},D1.prototype.property={},D1.prototype.space=void 0;class F1{constructor(e,t){this.attribute=t,this.property=e}}F1.prototype.attribute="",F1.prototype.booleanish=!1,F1.prototype.boolean=!1,F1.prototype.commaOrSpaceSeparated=!1,F1.prototype.commaSeparated=!1,F1.prototype.defined=!1,F1.prototype.mustUseProperty=!1,F1.prototype.number=!1,F1.prototype.overloadedBoolean=!1,F1.prototype.property="",F1.prototype.spaceSeparated=!1,F1.prototype.space=void 0;let B1=0;const j1=q1(),U1=q1(),V1=q1(),G1=q1(),H1=q1(),$1=q1(),W1=q1();function q1(){return 2**++B1}const X1=Object.keys(t);class Z1 extends F1{constructor(e,n,r,i){let o=-1;if(super(e,n),K1(this,"space",i),"number"===typeof r)for(;++o<X1.length;){const e=X1[o];K1(this,X1[o],(r&t[e])===t[e])}}}function K1(e,t,n){n&&(e[t]=n)}function Y1(e){const t={},n={};for(const[r,i]of Object.entries(e.properties)){const o=new Z1(r,e.transform(e.attributes||{},r),i,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(o.mustUseProperty=!0),t[r]=o,n[z1(r)]=r,n[z1(o.attribute)]=r}return new D1(t,n,e.space)}Z1.prototype.defined=!0;const J1=Y1({properties:{ariaActiveDescendant:null,ariaAtomic:U1,ariaAutoComplete:null,ariaBusy:U1,ariaChecked:U1,ariaColCount:G1,ariaColIndex:G1,ariaColSpan:G1,ariaControls:H1,ariaCurrent:null,ariaDescribedBy:H1,ariaDetails:null,ariaDisabled:U1,ariaDropEffect:H1,ariaErrorMessage:null,ariaExpanded:U1,ariaFlowTo:H1,ariaGrabbed:U1,ariaHasPopup:null,ariaHidden:U1,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:H1,ariaLevel:G1,ariaLive:null,ariaModal:U1,ariaMultiLine:U1,ariaMultiSelectable:U1,ariaOrientation:null,ariaOwns:H1,ariaPlaceholder:null,ariaPosInSet:G1,ariaPressed:U1,ariaReadOnly:U1,ariaRelevant:null,ariaRequired:U1,ariaRoleDescription:H1,ariaRowCount:G1,ariaRowIndex:G1,ariaRowSpan:G1,ariaSelected:U1,ariaSetSize:G1,ariaSort:null,ariaValueMax:G1,ariaValueMin:G1,ariaValueNow:G1,ariaValueText:null,role:null},transform:(e,t)=>"role"===t?t:"aria-"+t.slice(4).toLowerCase()});function Q1(e,t){return t in e?e[t]:t}function e2(e,t){return Q1(e,t.toLowerCase())}const t2=Y1({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:$1,acceptCharset:H1,accessKey:H1,action:null,allow:null,allowFullScreen:j1,allowPaymentRequest:j1,allowUserMedia:j1,alt:null,as:null,async:j1,autoCapitalize:null,autoComplete:H1,autoFocus:j1,autoPlay:j1,blocking:H1,capture:null,charSet:null,checked:j1,cite:null,className:H1,cols:G1,colSpan:null,content:null,contentEditable:U1,controls:j1,controlsList:H1,coords:G1|$1,crossOrigin:null,data:null,dateTime:null,decoding:null,default:j1,defer:j1,dir:null,dirName:null,disabled:j1,download:V1,draggable:U1,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:j1,formTarget:null,headers:H1,height:G1,hidden:V1,high:G1,href:null,hrefLang:null,htmlFor:H1,httpEquiv:H1,id:null,imageSizes:null,imageSrcSet:null,inert:j1,inputMode:null,integrity:null,is:null,isMap:j1,itemId:null,itemProp:H1,itemRef:H1,itemScope:j1,itemType:H1,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:j1,low:G1,manifest:null,max:null,maxLength:G1,media:null,method:null,min:null,minLength:G1,multiple:j1,muted:j1,name:null,nonce:null,noModule:j1,noValidate:j1,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:j1,optimum:G1,pattern:null,ping:H1,placeholder:null,playsInline:j1,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:j1,referrerPolicy:null,rel:H1,required:j1,reversed:j1,rows:G1,rowSpan:G1,sandbox:H1,scope:null,scoped:j1,seamless:j1,selected:j1,shadowRootClonable:j1,shadowRootDelegatesFocus:j1,shadowRootMode:null,shape:null,size:G1,sizes:null,slot:null,span:G1,spellCheck:U1,src:null,srcDoc:null,srcLang:null,srcSet:null,start:G1,step:null,style:null,tabIndex:G1,target:null,title:null,translate:null,type:null,typeMustMatch:j1,useMap:null,value:U1,width:G1,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:H1,axis:null,background:null,bgColor:null,border:G1,borderColor:null,bottomMargin:G1,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:j1,declare:j1,event:null,face:null,frame:null,frameBorder:null,hSpace:G1,leftMargin:G1,link:null,longDesc:null,lowSrc:null,marginHeight:G1,marginWidth:G1,noResize:j1,noHref:j1,noShade:j1,noWrap:j1,object:null,profile:null,prompt:null,rev:null,rightMargin:G1,rules:null,scheme:null,scrolling:U1,standby:null,summary:null,text:null,topMargin:G1,valueType:null,version:null,vAlign:null,vLink:null,vSpace:G1,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:j1,disableRemotePlayback:j1,prefix:null,property:null,results:G1,security:null,unselectable:null},space:"html",transform:e2}),n2=Y1({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:W1,accentHeight:G1,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:G1,amplitude:G1,arabicForm:null,ascent:G1,attributeName:null,attributeType:null,azimuth:G1,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:G1,by:null,calcMode:null,capHeight:G1,className:H1,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:G1,diffuseConstant:G1,direction:null,display:null,dur:null,divisor:G1,dominantBaseline:null,download:j1,dx:null,dy:null,edgeMode:null,editable:null,elevation:G1,enableBackground:null,end:null,event:null,exponent:G1,externalResourcesRequired:null,fill:null,fillOpacity:G1,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:$1,g2:$1,glyphName:$1,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:G1,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:G1,horizOriginX:G1,horizOriginY:G1,id:null,ideographic:G1,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:G1,k:G1,k1:G1,k2:G1,k3:G1,k4:G1,kernelMatrix:W1,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:G1,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:G1,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:G1,overlineThickness:G1,paintOrder:null,panose1:null,path:null,pathLength:G1,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:H1,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:G1,pointsAtY:G1,pointsAtZ:G1,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:W1,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:W1,rev:W1,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:W1,requiredFeatures:W1,requiredFonts:W1,requiredFormats:W1,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:G1,specularExponent:G1,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:G1,strikethroughThickness:G1,string:null,stroke:null,strokeDashArray:W1,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:G1,strokeOpacity:G1,strokeWidth:null,style:null,surfaceScale:G1,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:W1,tabIndex:G1,tableValues:null,target:null,targetX:G1,targetY:G1,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:W1,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:G1,underlineThickness:G1,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:G1,values:null,vAlphabetic:G1,vMathematical:G1,vectorEffect:null,vHanging:G1,vIdeographic:G1,version:null,vertAdvY:G1,vertOriginX:G1,vertOriginY:G1,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:G1,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Q1}),r2=Y1({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform:(e,t)=>"xlink:"+t.slice(5).toLowerCase()}),i2=Y1({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:e2}),o2=Y1({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform:(e,t)=>"xml:"+t.slice(3).toLowerCase()}),s2=N1([J1,t2,r2,i2,o2],"html"),a2=N1([J1,n2,r2,i2,o2],"svg"),l2=/[A-Z]/g,c2=/-[a-z]/g,u2=/^data[-\w.:]+$/i;function h2(e){return"-"+e.toLowerCase()}function d2(e){return e.charAt(1).toUpperCase()}const f2={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"};var p2=n(7294);const m2=_2("end"),g2=_2("start");function _2(e){return function(t){const n=t&&t.position&&t.position[e]||{};if("number"===typeof n.line&&n.line>0&&"number"===typeof n.column&&n.column>0)return{line:n.line,column:n.column,offset:"number"===typeof n.offset&&n.offset>-1?n.offset:void 0}}}function y2(e){return e&&"object"===typeof e?"position"in e||"type"in e?x2(e.position):"start"in e||"end"in e?x2(e):"line"in e||"column"in e?v2(e):"":""}function v2(e){return b2(e&&e.line)+":"+b2(e&&e.column)}function x2(e){return v2(e&&e.start)+"-"+v2(e&&e.end)}function b2(e){return e&&"number"===typeof e?e:1}class w2 extends Error{constructor(e,t,n){super(),"string"===typeof t&&(n=t,t=void 0);let r="",i={},o=!1;if(t&&(i="line"in t&&"column"in t||"start"in t&&"end"in t?{place:t}:"type"in t?{ancestors:[t],place:t.position}:{...t}),"string"===typeof e?r=e:!i.cause&&e&&(o=!0,r=e.message,i.cause=e),!i.ruleId&&!i.source&&"string"===typeof n){const e=n.indexOf(":");-1===e?i.ruleId=n:(i.source=n.slice(0,e),i.ruleId=n.slice(e+1))}if(!i.place&&i.ancestors&&i.ancestors){const e=i.ancestors[i.ancestors.length-1];e&&(i.place=e.position)}const s=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=s?s.column:void 0,this.fatal=void 0,this.file="",this.message=r,this.line=s?s.line:void 0,this.name=y2(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&"string"===typeof i.cause.stack?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}w2.prototype.file="",w2.prototype.name="",w2.prototype.reason="",w2.prototype.message="",w2.prototype.stack="",w2.prototype.column=void 0,w2.prototype.line=void 0,w2.prototype.ancestors=void 0,w2.prototype.cause=void 0,w2.prototype.fatal=void 0,w2.prototype.place=void 0,w2.prototype.ruleId=void 0,w2.prototype.source=void 0;const S2={}.hasOwnProperty,E2=new Map,T2=/[A-Z]/g,A2=new Set(["table","tbody","thead","tfoot","tr"]),C2=new Set(["td","th"]),P2="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function I2(e,t){if(!t||void 0===t.Fragment)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let r;if(t.development){if("function"!==typeof t.jsxDEV)throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=function(e,t){return n;function n(n,r,i,o){const s=Array.isArray(i.children),a=g2(n);return t(r,i,o,s,{columnNumber:a?a.column-1:void 0,fileName:e,lineNumber:a?a.line:void 0},void 0)}}(n,t.jsxDEV)}else{if("function"!==typeof t.jsx)throw new TypeError("Expected `jsx` in production options");if("function"!==typeof t.jsxs)throw new TypeError("Expected `jsxs` in production options");r=function(e,t,n){return r;function r(e,r,i,o){const s=Array.isArray(i.children)?n:t;return o?s(r,i,o):s(r,i)}}(0,t.jsx,t.jsxs)}const i={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:r,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:!1!==t.passKeys,passNode:t.passNode||!1,schema:"svg"===t.space?a2:s2,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:!1!==t.tableCellAlignToStyle},o=k2(i,e,void 0);return o&&"string"!==typeof o?o:i.create(e,i.Fragment,{children:o||void 0},void 0)}function k2(e,t,n){return"element"===t.type?function(e,t,n){const r=e.schema;let i=r;"svg"===t.tagName.toLowerCase()&&"html"===r.space&&(i=a2,e.schema=i);e.ancestors.push(t);const o=D2(e,t.tagName,!1),s=function(e,t){const n={};let r,i;for(i in t.properties)if("children"!==i&&S2.call(t.properties,i)){const o=L2(e,i,t.properties[i]);if(o){const[i,s]=o;e.tableCellAlignToStyle&&"align"===i&&"string"===typeof s&&C2.has(t.tagName)?r=s:n[i]=s}}if(r){(n.style||(n.style={}))["css"===e.stylePropertyNameCase?"text-align":"textAlign"]=r}return n}(e,t);let a=O2(e,t);A2.has(t.tagName)&&(a=a.filter(function(e){return"string"!==typeof e||!("object"===typeof(t=e)?"text"===t.type&&L1(t.value):L1(t));var t}));return M2(e,s,o,t),R2(s,a),e.ancestors.pop(),e.schema=r,e.create(t,o,s,n)}(e,t,n):"mdxFlowExpression"===t.type||"mdxTextExpression"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater){const n=t.data.estree.body[0];return n.type,e.evaluater.evaluateExpression(n.expression)}N2(e,t.position)}(e,t):"mdxJsxFlowElement"===t.type||"mdxJsxTextElement"===t.type?function(e,t,n){const r=e.schema;let i=r;"svg"===t.name&&"html"===r.space&&(i=a2,e.schema=i);e.ancestors.push(t);const o=null===t.name?e.Fragment:D2(e,t.name,!0),s=function(e,t){const n={};for(const r of t.attributes)if("mdxJsxExpressionAttribute"===r.type)if(r.data&&r.data.estree&&e.evaluater){const t=r.data.estree.body[0];C1(t.type);const i=t.expression;C1(i.type);const o=i.properties[0];C1(o.type),Object.assign(n,e.evaluater.evaluateExpression(o.argument))}else N2(e,t.position);else{const i=r.name;let o;if(r.value&&"object"===typeof r.value)if(r.value.data&&r.value.data.estree&&e.evaluater){const t=r.value.data.estree.body[0];C1(t.type),o=e.evaluater.evaluateExpression(t.expression)}else N2(e,t.position);else o=null===r.value||r.value;n[i]=o}return n}(e,t),a=O2(e,t);return M2(e,s,o,t),R2(s,a),e.ancestors.pop(),e.schema=r,e.create(t,o,s,n)}(e,t,n):"mdxjsEsm"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);N2(e,t.position)}(e,t):"root"===t.type?function(e,t,n){const r={};return R2(r,O2(e,t)),e.create(t,e.Fragment,r,n)}(e,t,n):"text"===t.type?function(e,t){return t.value}(0,t):void 0}function M2(e,t,n,r){"string"!==typeof n&&n!==e.Fragment&&e.passNode&&(t.node=r)}function R2(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function O2(e,t){const n=[];let r=-1;const i=e.passKeys?new Map:E2;for(;++r<t.children.length;){const o=t.children[r];let s;if(e.passKeys){const e="element"===o.type?o.tagName:"mdxJsxFlowElement"===o.type||"mdxJsxTextElement"===o.type?o.name:void 0;if(e){const t=i.get(e)||0;s=e+"-"+t,i.set(e,t+1)}}const a=k2(e,o,s);void 0!==a&&n.push(a)}return n}function L2(e,t,n){const r=function(e,t){const n=z1(t);let r=t,i=F1;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&"data"===n.slice(0,4)&&u2.test(t)){if("-"===t.charAt(4)){const e=t.slice(5).replace(c2,d2);r="data"+e.charAt(0).toUpperCase()+e.slice(1)}else{const e=t.slice(4);if(!c2.test(e)){let n=e.replace(l2,h2);"-"!==n.charAt(0)&&(n="-"+n),t="data"+n}}i=Z1}return new i(r,t)}(e.schema,t);if(!(null===n||void 0===n||"number"===typeof n&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?function(e,t){const n=t||{};return(""===e[e.length-1]?[...e,""]:e).join((n.padRight?" ":"")+","+(!1===n.padLeft?"":" ")).trim()}(n):n.join(" ").trim()),"style"===r.property){let t="object"===typeof n?n:function(e,t){try{return p2(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const t=n,r=new w2("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:t,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw r.file=e.filePath||void 0,r.url=P2+"#cannot-parse-style-attribute",r}}(e,String(n));return"css"===e.stylePropertyNameCase&&(t=function(e){const t={};let n;for(n in e)S2.call(e,n)&&(t[z2(n)]=e[n]);return t}(t)),["style",t]}return["react"===e.elementAttributeNameCase&&r.space?f2[r.property]||r.property:r.attribute,n]}}function D2(e,t,n){let r;if(n)if(t.includes(".")){const e=t.split(".");let n,i=-1;for(;++i<e.length;){const t=R1(e[i])?{type:"Identifier",name:e[i]}:{type:"Literal",value:e[i]};n=n?{type:"MemberExpression",object:n,property:t,computed:Boolean(i&&"Literal"===t.type),optional:!1}:t}r=n}else r=R1(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};else r={type:"Literal",value:t};if("Literal"===r.type){const t=r.value;return S2.call(e.components,t)?e.components[t]:t}if(e.evaluater)return e.evaluater.evaluateExpression(r);N2(e)}function N2(e,t){const n=new w2("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=P2+"#cannot-handle-mdx-estrees-without-createevaluater",n}function z2(e){let t=e.replace(T2,F2);return"ms-"===t.slice(0,3)&&(t="-"+t),t}function F2(e){return"-"+e.toLowerCase()}const B2={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},j2={};function U2(e,t){const n=t||j2;return V2(e,"boolean"!==typeof n.includeImageAlt||n.includeImageAlt,"boolean"!==typeof n.includeHtml||n.includeHtml)}function V2(e,t,n){if(function(e){return Boolean(e&&"object"===typeof e)}(e)){if("value"in e)return"html"!==e.type||n?e.value:"";if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return G2(e.children,t,n)}return Array.isArray(e)?G2(e,t,n):""}function G2(e,t,n){const r=[];let i=-1;for(;++i<e.length;)r[i]=V2(e[i],t,n);return r.join("")}function H2(e,t,n,r){const i=e.length;let o,s=0;if(t=t<0?-t>i?0:i+t:t>i?i:t,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(t,n),e.splice(...o);else for(n&&e.splice(t,n);s<r.length;)o=r.slice(s,s+1e4),o.unshift(t,0),e.splice(...o),s+=1e4,t+=1e4}function $2(e,t){return e.length>0?(H2(e,e.length,0,t),e):t}class W2{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const n=null===t||void 0===t?Number.POSITIVE_INFINITY:t;return n<this.left.length?this.left.slice(e,n):e>this.left.length?this.right.slice(this.right.length-n+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-n+this.left.length).reverse())}splice(e,t,n){const r=t||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY);return n&&q2(this.left,n),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),q2(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),q2(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&0===this.right.length||e<0&&0===this.left.length))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);q2(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);q2(this.left,t.reverse())}}}function q2(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function X2(e){const t={};let n,r,i,o,s,a,l,c=-1;const u=new W2(e);for(;++c<u.length;){for(;c in t;)c=t[c];if(n=u.get(c),c&&"chunkFlow"===n[1].type&&"listItemPrefix"===u.get(c-1)[1].type&&(a=n[1]._tokenizer.events,i=0,i<a.length&&"lineEndingBlank"===a[i][1].type&&(i+=2),i<a.length&&"content"===a[i][1].type))for(;++i<a.length&&"content"!==a[i][1].type;)"chunkText"===a[i][1].type&&(a[i][1]._isInFirstContentOfListItem=!0,i++);if("enter"===n[0])n[1].contentType&&(Object.assign(t,Z2(u,c)),c=t[c],l=!0);else if(n[1]._container){for(i=c,r=void 0;i--;)if(o=u.get(i),"lineEnding"===o[1].type||"lineEndingBlank"===o[1].type)"enter"===o[0]&&(r&&(u.get(r)[1].type="lineEndingBlank"),o[1].type="lineEnding",r=i);else if("linePrefix"!==o[1].type&&"listItemIndent"!==o[1].type)break;r&&(n[1].end={...u.get(r)[1].start},s=u.slice(r,c),s.unshift(n),u.splice(r,c-r+1,s))}}return H2(e,0,Number.POSITIVE_INFINITY,u.slice(0)),!l}function Z2(e,t){const n=e.get(t)[1],r=e.get(t)[2];let i=t-1;const o=[];let s=n._tokenizer;s||(s=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(s._contentTypeTextTrailing=!0));const a=s.events,l=[],c={};let u,h,d=-1,f=n,p=0,m=0;const g=[m];for(;f;){for(;e.get(++i)[1]!==f;);o.push(i),f._tokenizer||(u=r.sliceStream(f),f.next||u.push(null),h&&s.defineSkip(f.start),f._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(u),f._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),h=f,f=f.next}for(f=n;++d<a.length;)"exit"===a[d][0]&&"enter"===a[d-1][0]&&a[d][1].type===a[d-1][1].type&&a[d][1].start.line!==a[d][1].end.line&&(m=d+1,g.push(m),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(s.events=[],f?(f._tokenizer=void 0,f.previous=void 0):g.pop(),d=g.length;d--;){const t=a.slice(g[d],g[d+1]),n=o.pop();l.push([n,n+t.length-1]),e.splice(n,2,t)}for(l.reverse(),d=-1;++d<l.length;)c[p+l[d][0]]=p+l[d][1],p+=l[d][1]-l[d][0]-1;return c}const K2={}.hasOwnProperty;function Y2(e){const t={};let n=-1;for(;++n<e.length;)J2(t,e[n]);return t}function J2(e,t){let n;for(n in t){const r=(K2.call(e,n)?e[n]:void 0)||(e[n]={}),i=t[n];let o;if(i)for(o in i){K2.call(r,o)||(r[o]=[]);const e=i[o];Q2(r[o],Array.isArray(e)?e:e?[e]:[])}}}function Q2(e,t){let n=-1;const r=[];for(;++n<t.length;)("after"===t[n].add?e:r).push(t[n]);H2(e,0,0,r)}const e3=d3(/[A-Za-z]/),t3=d3(/[\dA-Za-z]/),n3=d3(/[#-'*+\--9=?A-Z^-~]/);function r3(e){return null!==e&&(e<32||127===e)}const i3=d3(/\d/),o3=d3(/[\dA-Fa-f]/),s3=d3(/[!-/:-@[-`{-~]/);function a3(e){return null!==e&&e<-2}function l3(e){return null!==e&&(e<0||32===e)}function c3(e){return-2===e||-1===e||32===e}const u3=d3(/\p{P}|\p{S}/u),h3=d3(/\s/);function d3(e){return function(t){return null!==t&&t>-1&&e.test(String.fromCharCode(t))}}function f3(e,t,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let o=0;return function(r){if(c3(r))return e.enter(n),s(r);return t(r)};function s(r){return c3(r)&&o++<i?(e.consume(r),s):(e.exit(n),t(r))}}const p3={tokenize:function(e){const t=e.attempt(this.parser.constructs.contentInitial,function(n){if(null===n)return void e.consume(n);return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),f3(e,t,"linePrefix")},function(t){return e.enter("paragraph"),r(t)});let n;return t;function r(t){const r=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=r),n=r,i(t)}function i(t){return null===t?(e.exit("chunkText"),e.exit("paragraph"),void e.consume(t)):a3(t)?(e.consume(t),e.exit("chunkText"),r):(e.consume(t),i)}}};const m3={tokenize:function(e){const t=this,n=[];let r,i,o,s=0;return a;function a(r){if(s<n.length){const i=n[s];return t.containerState=i[1],e.attempt(i[0].continuation,l,c)(r)}return c(r)}function l(e){if(s++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,r&&y();const n=t.events.length;let i,o=n;for(;o--;)if("exit"===t.events[o][0]&&"chunkFlow"===t.events[o][1].type){i=t.events[o][1].end;break}_(s);let a=n;for(;a<t.events.length;)t.events[a][1].end={...i},a++;return H2(t.events,o+1,0,t.events.slice(n)),t.events.length=a,c(e)}return a(e)}function c(i){if(s===n.length){if(!r)return d(i);if(r.currentConstruct&&r.currentConstruct.concrete)return p(i);t.interrupt=Boolean(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(g3,u,h)(i)}function u(e){return r&&y(),_(s),d(e)}function h(e){return t.parser.lazy[t.now().line]=s!==n.length,o=t.now().offset,p(e)}function d(n){return t.containerState={},e.attempt(g3,f,p)(n)}function f(e){return s++,n.push([t.currentConstruct,t.containerState]),d(e)}function p(n){return null===n?(r&&y(),_(0),void e.consume(n)):(r=r||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:r,contentType:"flow",previous:i}),m(n))}function m(n){return null===n?(g(e.exit("chunkFlow"),!0),_(0),void e.consume(n)):a3(n)?(e.consume(n),g(e.exit("chunkFlow")),s=0,t.interrupt=void 0,a):(e.consume(n),m)}function g(e,n){const a=t.sliceStream(e);if(n&&a.push(null),e.previous=i,i&&(i.next=e),i=e,r.defineSkip(e.start),r.write(a),t.parser.lazy[e.start.line]){let e=r.events.length;for(;e--;)if(r.events[e][1].start.offset<o&&(!r.events[e][1].end||r.events[e][1].end.offset>o))return;const n=t.events.length;let i,a,l=n;for(;l--;)if("exit"===t.events[l][0]&&"chunkFlow"===t.events[l][1].type){if(i){a=t.events[l][1].end;break}i=!0}for(_(s),e=n;e<t.events.length;)t.events[e][1].end={...a},e++;H2(t.events,l+1,0,t.events.slice(n)),t.events.length=e}}function _(r){let i=n.length;for(;i-- >r;){const r=n[i];t.containerState=r[1],r[0].exit.call(t,e)}n.length=r}function y(){r.write([null]),i=void 0,r=void 0,t.containerState._closeFlow=void 0}}},g3={tokenize:function(e,t,n){return f3(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}};const _3={partial:!0,tokenize:function(e,t,n){return function(t){return c3(t)?f3(e,r,"linePrefix")(t):r(t)};function r(e){return null===e||a3(e)?t(e):n(e)}}};const y3={resolve:function(e){return X2(e),e},tokenize:function(e,t){let n;return function(t){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),r(t)};function r(t){return null===t?i(t):a3(t)?e.check(v3,o,i)(t):(e.consume(t),r)}function i(n){return e.exit("chunkContent"),e.exit("content"),t(n)}function o(t){return e.consume(t),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,r}}},v3={partial:!0,tokenize:function(e,t,n){const r=this;return function(t){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),f3(e,i,"linePrefix")};function i(i){if(null===i||a3(i))return n(i);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&"linePrefix"===o[1].type&&o[2].sliceSerialize(o[1],!0).length>=4?t(i):e.interrupt(r.parser.constructs.flow,n,t)(i)}}};const x3={tokenize:function(e){const t=this,n=e.attempt(_3,function(r){if(null===r)return void e.consume(r);return e.enter("lineEndingBlank"),e.consume(r),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n},e.attempt(this.parser.constructs.flowInitial,r,f3(e,e.attempt(this.parser.constructs.flow,r,e.attempt(y3,r)),"linePrefix")));return n;function r(r){if(null!==r)return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),t.currentConstruct=void 0,n;e.consume(r)}}};const b3={resolveAll:T3()},w3=E3("string"),S3=E3("text");function E3(e){return{resolveAll:T3("text"===e?A3:void 0),tokenize:function(t){const n=this,r=this.parser.constructs[e],i=t.attempt(r,o,s);return o;function o(e){return l(e)?i(e):s(e)}function s(e){if(null!==e)return t.enter("data"),t.consume(e),a;t.consume(e)}function a(e){return l(e)?(t.exit("data"),i(e)):(t.consume(e),a)}function l(e){if(null===e)return!0;const t=r[e];let i=-1;if(t)for(;++i<t.length;){const e=t[i];if(!e.previous||e.previous.call(n,n.previous))return!0}return!1}}}}function T3(e){return function(t,n){let r,i=-1;for(;++i<=t.length;)void 0===r?t[i]&&"data"===t[i][1].type&&(r=i,i++):t[i]&&"data"===t[i][1].type||(i!==r+2&&(t[r][1].end=t[i-1][1].end,t.splice(r+2,i-r-2),i=r+2),r=void 0);return e?e(t,n):t}}function A3(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||"lineEnding"===e[n][1].type)&&"data"===e[n-1][1].type){const r=e[n-1][1],i=t.sliceStream(r);let o,s=i.length,a=-1,l=0;for(;s--;){const e=i[s];if("string"===typeof e){for(a=e.length;32===e.charCodeAt(a-1);)l++,a--;if(a)break;a=-1}else if(-2===e)o=!0,l++;else if(-1!==e){s++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(l=0),l){const i={type:n===e.length||o||l<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:s?a:r.start._bufferIndex+a,_index:r.start._index+s,line:r.end.line,column:r.end.column-l,offset:r.end.offset-l},end:{...r.end}};r.end={...i.start},r.start.offset===r.end.offset?Object.assign(r,i):(e.splice(n,0,["enter",i,t],["exit",i,t]),n+=2)}n++}return e}const C3={name:"thematicBreak",tokenize:function(e,t,n){let r,i=0;return function(t){return e.enter("thematicBreak"),function(e){return r=e,o(e)}(t)};function o(o){return o===r?(e.enter("thematicBreakSequence"),s(o)):i>=3&&(null===o||a3(o))?(e.exit("thematicBreak"),t(o)):n(o)}function s(t){return t===r?(e.consume(t),i++,s):(e.exit("thematicBreakSequence"),c3(t)?f3(e,o,"whitespace")(t):o(t))}}};const P3={continuation:{tokenize:function(e,t,n){const r=this;return r.containerState._closeFlow=void 0,e.check(_3,i,o);function i(n){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,f3(e,t,"listItemIndent",r.containerState.size+1)(n)}function o(n){return r.containerState.furtherBlankLines||!c3(n)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,s(n)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(k3,t,s)(n))}function s(i){return r.containerState._closeFlow=!0,r.interrupt=void 0,f3(e,e.attempt(P3,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(i)}}},exit:function(e){e.exit(this.containerState.type)},name:"list",tokenize:function(e,t,n){const r=this,i=r.events[r.events.length-1];let o=i&&"linePrefix"===i[1].type?i[2].sliceSerialize(i[1],!0).length:0,s=0;return function(t){const i=r.containerState.type||(42===t||43===t||45===t?"listUnordered":"listOrdered");if("listUnordered"===i?!r.containerState.marker||t===r.containerState.marker:i3(t)){if(r.containerState.type||(r.containerState.type=i,e.enter(i,{_container:!0})),"listUnordered"===i)return e.enter("listItemPrefix"),42===t||45===t?e.check(C3,n,l)(t):l(t);if(!r.interrupt||49===t)return e.enter("listItemPrefix"),e.enter("listItemValue"),a(t)}return n(t)};function a(t){return i3(t)&&++s<10?(e.consume(t),a):(!r.interrupt||s<2)&&(r.containerState.marker?t===r.containerState.marker:41===t||46===t)?(e.exit("listItemValue"),l(t)):n(t)}function l(t){return e.enter("listItemMarker"),e.consume(t),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||t,e.check(_3,r.interrupt?n:c,e.attempt(I3,h,u))}function c(e){return r.containerState.initialBlankLine=!0,o++,h(e)}function u(t){return c3(t)?(e.enter("listItemPrefixWhitespace"),e.consume(t),e.exit("listItemPrefixWhitespace"),h):n(t)}function h(n){return r.containerState.size=o+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(n)}}},I3={partial:!0,tokenize:function(e,t,n){const r=this;return f3(e,function(e){const i=r.events[r.events.length-1];return!c3(e)&&i&&"listItemPrefixWhitespace"===i[1].type?t(e):n(e)},"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5)}},k3={partial:!0,tokenize:function(e,t,n){const r=this;return f3(e,function(e){const i=r.events[r.events.length-1];return i&&"listItemIndent"===i[1].type&&i[2].sliceSerialize(i[1],!0).length===r.containerState.size?t(e):n(e)},"listItemIndent",r.containerState.size+1)}};const M3={continuation:{tokenize:function(e,t,n){const r=this;return function(t){if(c3(t))return f3(e,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t);return i(t)};function i(r){return e.attempt(M3,t,n)(r)}}},exit:function(e){e.exit("blockQuote")},name:"blockQuote",tokenize:function(e,t,n){const r=this;return function(t){if(62===t){const n=r.containerState;return n.open||(e.enter("blockQuote",{_container:!0}),n.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(t),e.exit("blockQuoteMarker"),i}return n(t)};function i(n){return c3(n)?(e.enter("blockQuotePrefixWhitespace"),e.consume(n),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(n))}}};function R3(e,t,n,r,i,o,s,a,l){const c=l||Number.POSITIVE_INFINITY;let u=0;return function(t){if(60===t)return e.enter(r),e.enter(i),e.enter(o),e.consume(t),e.exit(o),h;if(null===t||32===t||41===t||r3(t))return n(t);return e.enter(r),e.enter(s),e.enter(a),e.enter("chunkString",{contentType:"string"}),p(t)};function h(n){return 62===n?(e.enter(o),e.consume(n),e.exit(o),e.exit(i),e.exit(r),t):(e.enter(a),e.enter("chunkString",{contentType:"string"}),d(n))}function d(t){return 62===t?(e.exit("chunkString"),e.exit(a),h(t)):null===t||60===t||a3(t)?n(t):(e.consume(t),92===t?f:d)}function f(t){return 60===t||62===t||92===t?(e.consume(t),d):d(t)}function p(i){return u||null!==i&&41!==i&&!l3(i)?u<c&&40===i?(e.consume(i),u++,p):41===i?(e.consume(i),u--,p):null===i||32===i||40===i||r3(i)?n(i):(e.consume(i),92===i?m:p):(e.exit("chunkString"),e.exit(a),e.exit(s),e.exit(r),t(i))}function m(t){return 40===t||41===t||92===t?(e.consume(t),p):p(t)}}function O3(e,t,n,r,i,o){const s=this;let a,l=0;return function(t){return e.enter(r),e.enter(i),e.consume(t),e.exit(i),e.enter(o),c};function c(h){return l>999||null===h||91===h||93===h&&!a||94===h&&!l&&"_hiddenFootnoteSupport"in s.parser.constructs?n(h):93===h?(e.exit(o),e.enter(i),e.consume(h),e.exit(i),e.exit(r),t):a3(h)?(e.enter("lineEnding"),e.consume(h),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),u(h))}function u(t){return null===t||91===t||93===t||a3(t)||l++>999?(e.exit("chunkString"),c(t)):(e.consume(t),a||(a=!c3(t)),92===t?h:u)}function h(t){return 91===t||92===t||93===t?(e.consume(t),l++,u):u(t)}}function L3(e,t,n,r,i,o){let s;return function(t){if(34===t||39===t||40===t)return e.enter(r),e.enter(i),e.consume(t),e.exit(i),s=40===t?41:t,a;return n(t)};function a(n){return n===s?(e.enter(i),e.consume(n),e.exit(i),e.exit(r),t):(e.enter(o),l(n))}function l(t){return t===s?(e.exit(o),a(s)):null===t?n(t):a3(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),f3(e,l,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(t))}function c(t){return t===s||null===t||a3(t)?(e.exit("chunkString"),l(t)):(e.consume(t),92===t?u:c)}function u(t){return t===s||92===t?(e.consume(t),c):c(t)}}function D3(e,t){let n;return function r(i){if(a3(i))return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),n=!0,r;if(c3(i))return f3(e,r,n?"linePrefix":"lineSuffix")(i);return t(i)}}function N3(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const z3={name:"definition",tokenize:function(e,t,n){const r=this;let i;return function(t){return e.enter("definition"),function(t){return O3.call(r,e,o,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(t)}(t)};function o(t){return i=N3(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),58===t?(e.enter("definitionMarker"),e.consume(t),e.exit("definitionMarker"),s):n(t)}function s(t){return l3(t)?D3(e,a)(t):a(t)}function a(t){return R3(e,l,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(t)}function l(t){return e.attempt(F3,c,c)(t)}function c(t){return c3(t)?f3(e,u,"whitespace")(t):u(t)}function u(o){return null===o||a3(o)?(e.exit("definition"),r.parser.defined.push(i),t(o)):n(o)}}},F3={partial:!0,tokenize:function(e,t,n){return function(t){return l3(t)?D3(e,r)(t):n(t)};function r(t){return L3(e,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(t)}function i(t){return c3(t)?f3(e,o,"whitespace")(t):o(t)}function o(e){return null===e||a3(e)?t(e):n(e)}}};const B3={name:"codeIndented",tokenize:function(e,t,n){const r=this;return function(t){return e.enter("codeIndented"),f3(e,i,"linePrefix",5)(t)};function i(e){const t=r.events[r.events.length-1];return t&&"linePrefix"===t[1].type&&t[2].sliceSerialize(t[1],!0).length>=4?o(e):n(e)}function o(t){return null===t?a(t):a3(t)?e.attempt(j3,o,a)(t):(e.enter("codeFlowValue"),s(t))}function s(t){return null===t||a3(t)?(e.exit("codeFlowValue"),o(t)):(e.consume(t),s)}function a(n){return e.exit("codeIndented"),t(n)}}},j3={partial:!0,tokenize:function(e,t,n){const r=this;return i;function i(t){return r.parser.lazy[r.now().line]?n(t):a3(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i):f3(e,o,"linePrefix",5)(t)}function o(e){const o=r.events[r.events.length-1];return o&&"linePrefix"===o[1].type&&o[2].sliceSerialize(o[1],!0).length>=4?t(e):a3(e)?i(e):n(e)}}};const U3={name:"headingAtx",resolve:function(e,t){let n,r,i=e.length-2,o=3;"whitespace"===e[o][1].type&&(o+=2);i-2>o&&"whitespace"===e[i][1].type&&(i-=2);"atxHeadingSequence"===e[i][1].type&&(o===i-1||i-4>o&&"whitespace"===e[i-2][1].type)&&(i-=o+1===i?2:4);i>o&&(n={type:"atxHeadingText",start:e[o][1].start,end:e[i][1].end},r={type:"chunkText",start:e[o][1].start,end:e[i][1].end,contentType:"text"},H2(e,o,i-o+1,[["enter",n,t],["enter",r,t],["exit",r,t],["exit",n,t]]));return e},tokenize:function(e,t,n){let r=0;return function(t){return e.enter("atxHeading"),function(t){return e.enter("atxHeadingSequence"),i(t)}(t)};function i(t){return 35===t&&r++<6?(e.consume(t),i):null===t||l3(t)?(e.exit("atxHeadingSequence"),o(t)):n(t)}function o(n){return 35===n?(e.enter("atxHeadingSequence"),s(n)):null===n||a3(n)?(e.exit("atxHeading"),t(n)):c3(n)?f3(e,o,"whitespace")(n):(e.enter("atxHeadingText"),a(n))}function s(t){return 35===t?(e.consume(t),s):(e.exit("atxHeadingSequence"),o(t))}function a(t){return null===t||35===t||l3(t)?(e.exit("atxHeadingText"),o(t)):(e.consume(t),a)}}};const V3={name:"setextUnderline",resolveTo:function(e,t){let n,r,i,o=e.length;for(;o--;)if("enter"===e[o][0]){if("content"===e[o][1].type){n=o;break}"paragraph"===e[o][1].type&&(r=o)}else"content"===e[o][1].type&&e.splice(o,1),i||"definition"!==e[o][1].type||(i=o);const s={type:"setextHeading",start:{...e[n][1].start},end:{...e[e.length-1][1].end}};e[r][1].type="setextHeadingText",i?(e.splice(r,0,["enter",s,t]),e.splice(i+1,0,["exit",e[n][1],t]),e[n][1].end={...e[i][1].end}):e[n][1]=s;return e.push(["exit",s,t]),e},tokenize:function(e,t,n){const r=this;let i;return function(t){let s,a=r.events.length;for(;a--;)if("lineEnding"!==r.events[a][1].type&&"linePrefix"!==r.events[a][1].type&&"content"!==r.events[a][1].type){s="paragraph"===r.events[a][1].type;break}if(!r.parser.lazy[r.now().line]&&(r.interrupt||s))return e.enter("setextHeadingLine"),i=t,function(t){return e.enter("setextHeadingLineSequence"),o(t)}(t);return n(t)};function o(t){return t===i?(e.consume(t),o):(e.exit("setextHeadingLineSequence"),c3(t)?f3(e,s,"lineSuffix")(t):s(t))}function s(r){return null===r||a3(r)?(e.exit("setextHeadingLine"),t(r)):n(r)}}};const G3=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],H3=["pre","script","style","textarea"],$3={concrete:!0,name:"htmlFlow",resolveTo:function(e){let t=e.length;for(;t--&&("enter"!==e[t][0]||"htmlFlow"!==e[t][1].type););t>1&&"linePrefix"===e[t-2][1].type&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2));return e},tokenize:function(e,t,n){const r=this;let i,o,s,a,l;return function(t){return function(t){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(t),c}(t)};function c(a){return 33===a?(e.consume(a),u):47===a?(e.consume(a),o=!0,f):63===a?(e.consume(a),i=3,r.interrupt?t:L):e3(a)?(e.consume(a),s=String.fromCharCode(a),p):n(a)}function u(o){return 45===o?(e.consume(o),i=2,h):91===o?(e.consume(o),i=5,a=0,d):e3(o)?(e.consume(o),i=4,r.interrupt?t:L):n(o)}function h(i){return 45===i?(e.consume(i),r.interrupt?t:L):n(i)}function d(i){const o="CDATA[";return i===o.charCodeAt(a++)?(e.consume(i),6===a?r.interrupt?t:A:d):n(i)}function f(t){return e3(t)?(e.consume(t),s=String.fromCharCode(t),p):n(t)}function p(a){if(null===a||47===a||62===a||l3(a)){const l=47===a,c=s.toLowerCase();return l||o||!H3.includes(c)?G3.includes(s.toLowerCase())?(i=6,l?(e.consume(a),m):r.interrupt?t(a):A(a)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(a):o?g(a):_(a)):(i=1,r.interrupt?t(a):A(a))}return 45===a||t3(a)?(e.consume(a),s+=String.fromCharCode(a),p):n(a)}function m(i){return 62===i?(e.consume(i),r.interrupt?t:A):n(i)}function g(t){return c3(t)?(e.consume(t),g):E(t)}function _(t){return 47===t?(e.consume(t),E):58===t||95===t||e3(t)?(e.consume(t),y):c3(t)?(e.consume(t),_):E(t)}function y(t){return 45===t||46===t||58===t||95===t||t3(t)?(e.consume(t),y):v(t)}function v(t){return 61===t?(e.consume(t),x):c3(t)?(e.consume(t),v):_(t)}function x(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),l=t,b):c3(t)?(e.consume(t),x):w(t)}function b(t){return t===l?(e.consume(t),l=null,S):null===t||a3(t)?n(t):(e.consume(t),b)}function w(t){return null===t||34===t||39===t||47===t||60===t||61===t||62===t||96===t||l3(t)?v(t):(e.consume(t),w)}function S(e){return 47===e||62===e||c3(e)?_(e):n(e)}function E(t){return 62===t?(e.consume(t),T):n(t)}function T(t){return null===t||a3(t)?A(t):c3(t)?(e.consume(t),T):n(t)}function A(t){return 45===t&&2===i?(e.consume(t),k):60===t&&1===i?(e.consume(t),M):62===t&&4===i?(e.consume(t),D):63===t&&3===i?(e.consume(t),L):93===t&&5===i?(e.consume(t),O):!a3(t)||6!==i&&7!==i?null===t||a3(t)?(e.exit("htmlFlowData"),C(t)):(e.consume(t),A):(e.exit("htmlFlowData"),e.check(W3,N,C)(t))}function C(t){return e.check(q3,P,N)(t)}function P(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),I}function I(t){return null===t||a3(t)?C(t):(e.enter("htmlFlowData"),A(t))}function k(t){return 45===t?(e.consume(t),L):A(t)}function M(t){return 47===t?(e.consume(t),s="",R):A(t)}function R(t){if(62===t){const n=s.toLowerCase();return H3.includes(n)?(e.consume(t),D):A(t)}return e3(t)&&s.length<8?(e.consume(t),s+=String.fromCharCode(t),R):A(t)}function O(t){return 93===t?(e.consume(t),L):A(t)}function L(t){return 62===t?(e.consume(t),D):45===t&&2===i?(e.consume(t),L):A(t)}function D(t){return null===t||a3(t)?(e.exit("htmlFlowData"),N(t)):(e.consume(t),D)}function N(n){return e.exit("htmlFlow"),t(n)}}},W3={partial:!0,tokenize:function(e,t,n){return function(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),e.attempt(_3,t,n)}}},q3={partial:!0,tokenize:function(e,t,n){const r=this;return function(t){if(a3(t))return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i;return n(t)};function i(e){return r.parser.lazy[r.now().line]?n(e):t(e)}}};const X3={partial:!0,tokenize:function(e,t,n){const r=this;return function(t){if(null===t)return n(t);return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i};function i(e){return r.parser.lazy[r.now().line]?n(e):t(e)}}},Z3={concrete:!0,name:"codeFenced",tokenize:function(e,t,n){const r=this,i={partial:!0,tokenize:function(e,t,n){let i=0;return s;function s(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),l}function l(t){return e.enter("codeFencedFence"),c3(t)?f3(e,c,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):c(t)}function c(t){return t===o?(e.enter("codeFencedFenceSequence"),u(t)):n(t)}function u(t){return t===o?(i++,e.consume(t),u):i>=a?(e.exit("codeFencedFenceSequence"),c3(t)?f3(e,h,"whitespace")(t):h(t)):n(t)}function h(r){return null===r||a3(r)?(e.exit("codeFencedFence"),t(r)):n(r)}}};let o,s=0,a=0;return function(t){return function(t){const n=r.events[r.events.length-1];return s=n&&"linePrefix"===n[1].type?n[2].sliceSerialize(n[1],!0).length:0,o=t,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),l(t)}(t)};function l(t){return t===o?(a++,e.consume(t),l):a<3?n(t):(e.exit("codeFencedFenceSequence"),c3(t)?f3(e,c,"whitespace")(t):c(t))}function c(n){return null===n||a3(n)?(e.exit("codeFencedFence"),r.interrupt?t(n):e.check(X3,f,y)(n)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),u(n))}function u(t){return null===t||a3(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),c(t)):c3(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),f3(e,h,"whitespace")(t)):96===t&&t===o?n(t):(e.consume(t),u)}function h(t){return null===t||a3(t)?c(t):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),d(t))}function d(t){return null===t||a3(t)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),c(t)):96===t&&t===o?n(t):(e.consume(t),d)}function f(t){return e.attempt(i,y,p)(t)}function p(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),m}function m(t){return s>0&&c3(t)?f3(e,g,"linePrefix",s+1)(t):g(t)}function g(t){return null===t||a3(t)?e.check(X3,f,y)(t):(e.enter("codeFlowValue"),_(t))}function _(t){return null===t||a3(t)?(e.exit("codeFlowValue"),g(t)):(e.consume(t),_)}function y(n){return e.exit("codeFenced"),t(n)}}};const K3=document.createElement("i");function Y3(e){const t="&"+e+";";K3.innerHTML=t;const n=K3.textContent;return(59!==n.charCodeAt(n.length-1)||"semi"===e)&&(n!==t&&n)}const J3={name:"characterReference",tokenize:function(e,t,n){const r=this;let i,o,s=0;return function(t){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(t),e.exit("characterReferenceMarker"),a};function a(t){return 35===t?(e.enter("characterReferenceMarkerNumeric"),e.consume(t),e.exit("characterReferenceMarkerNumeric"),l):(e.enter("characterReferenceValue"),i=31,o=t3,c(t))}function l(t){return 88===t||120===t?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(t),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,o=o3,c):(e.enter("characterReferenceValue"),i=7,o=i3,c(t))}function c(a){if(59===a&&s){const i=e.exit("characterReferenceValue");return o!==t3||Y3(r.sliceSerialize(i))?(e.enter("characterReferenceMarker"),e.consume(a),e.exit("characterReferenceMarker"),e.exit("characterReference"),t):n(a)}return o(a)&&s++<i?(e.consume(a),c):n(a)}}};const Q3={name:"characterEscape",tokenize:function(e,t,n){return function(t){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(t),e.exit("escapeMarker"),r};function r(r){return s3(r)?(e.enter("characterEscapeValue"),e.consume(r),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(r)}}};const e4={name:"lineEnding",tokenize:function(e,t){return function(n){return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),f3(e,t,"linePrefix")}}};function t4(e,t,n){const r=[];let i=-1;for(;++i<e.length;){const o=e[i].resolveAll;o&&!r.includes(o)&&(t=o(t,n),r.push(o))}return t}const n4={name:"labelEnd",resolveAll:function(e){let t=-1;const n=[];for(;++t<e.length;){const r=e[t][1];if(n.push(e[t]),"labelImage"===r.type||"labelLink"===r.type||"labelEnd"===r.type){const e="labelImage"===r.type?4:2;r.type="data",t+=e}}e.length!==n.length&&H2(e,0,e.length,n);return e},resolveTo:function(e,t){let n,r,i,o,s=e.length,a=0;for(;s--;)if(n=e[s][1],r){if("link"===n.type||"labelLink"===n.type&&n._inactive)break;"enter"===e[s][0]&&"labelLink"===n.type&&(n._inactive=!0)}else if(i){if("enter"===e[s][0]&&("labelImage"===n.type||"labelLink"===n.type)&&!n._balanced&&(r=s,"labelLink"!==n.type)){a=2;break}}else"labelEnd"===n.type&&(i=s);const l={type:"labelLink"===e[r][1].type?"link":"image",start:{...e[r][1].start},end:{...e[e.length-1][1].end}},c={type:"label",start:{...e[r][1].start},end:{...e[i][1].end}},u={type:"labelText",start:{...e[r+a+2][1].end},end:{...e[i-2][1].start}};return o=[["enter",l,t],["enter",c,t]],o=$2(o,e.slice(r+1,r+a+3)),o=$2(o,[["enter",u,t]]),o=$2(o,t4(t.parser.constructs.insideSpan.null,e.slice(r+a+4,i-3),t)),o=$2(o,[["exit",u,t],e[i-2],e[i-1],["exit",c,t]]),o=$2(o,e.slice(i+1)),o=$2(o,[["exit",l,t]]),H2(e,r,e.length,o),e},tokenize:function(e,t,n){const r=this;let i,o,s=r.events.length;for(;s--;)if(("labelImage"===r.events[s][1].type||"labelLink"===r.events[s][1].type)&&!r.events[s][1]._balanced){i=r.events[s][1];break}return function(t){if(!i)return n(t);if(i._inactive)return u(t);return o=r.parser.defined.includes(N3(r.sliceSerialize({start:i.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelEnd"),a};function a(t){return 40===t?e.attempt(r4,c,o?c:u)(t):91===t?e.attempt(i4,c,o?l:u)(t):o?c(t):u(t)}function l(t){return e.attempt(o4,c,u)(t)}function c(e){return t(e)}function u(e){return i._balanced=!0,n(e)}}},r4={tokenize:function(e,t,n){return function(t){return e.enter("resource"),e.enter("resourceMarker"),e.consume(t),e.exit("resourceMarker"),r};function r(t){return l3(t)?D3(e,i)(t):i(t)}function i(t){return 41===t?c(t):R3(e,o,s,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(t)}function o(t){return l3(t)?D3(e,a)(t):c(t)}function s(e){return n(e)}function a(t){return 34===t||39===t||40===t?L3(e,l,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(t):c(t)}function l(t){return l3(t)?D3(e,c)(t):c(t)}function c(r){return 41===r?(e.enter("resourceMarker"),e.consume(r),e.exit("resourceMarker"),e.exit("resource"),t):n(r)}}},i4={tokenize:function(e,t,n){const r=this;return function(t){return O3.call(r,e,i,o,"reference","referenceMarker","referenceString")(t)};function i(e){return r.parser.defined.includes(N3(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(e):n(e)}function o(e){return n(e)}}},o4={tokenize:function(e,t,n){return function(t){return e.enter("reference"),e.enter("referenceMarker"),e.consume(t),e.exit("referenceMarker"),r};function r(r){return 93===r?(e.enter("referenceMarker"),e.consume(r),e.exit("referenceMarker"),e.exit("reference"),t):n(r)}}};const s4={name:"labelStartImage",resolveAll:n4.resolveAll,tokenize:function(e,t,n){const r=this;return function(t){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(t),e.exit("labelImageMarker"),i};function i(t){return 91===t?(e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelImage"),o):n(t)}function o(e){return 94===e&&"_hiddenFootnoteSupport"in r.parser.constructs?n(e):t(e)}}};function a4(e){return null===e||l3(e)||h3(e)?1:u3(e)?2:void 0}const l4={name:"attention",resolveAll:function(e,t){let n,r,i,o,s,a,l,c,u=-1;for(;++u<e.length;)if("enter"===e[u][0]&&"attentionSequence"===e[u][1].type&&e[u][1]._close)for(n=u;n--;)if("exit"===e[n][0]&&"attentionSequence"===e[n][1].type&&e[n][1]._open&&t.sliceSerialize(e[n][1]).charCodeAt(0)===t.sliceSerialize(e[u][1]).charCodeAt(0)){if((e[n][1]._close||e[u][1]._open)&&(e[u][1].end.offset-e[u][1].start.offset)%3&&!((e[n][1].end.offset-e[n][1].start.offset+e[u][1].end.offset-e[u][1].start.offset)%3))continue;a=e[n][1].end.offset-e[n][1].start.offset>1&&e[u][1].end.offset-e[u][1].start.offset>1?2:1;const h={...e[n][1].end},d={...e[u][1].start};c4(h,-a),c4(d,a),o={type:a>1?"strongSequence":"emphasisSequence",start:h,end:{...e[n][1].end}},s={type:a>1?"strongSequence":"emphasisSequence",start:{...e[u][1].start},end:d},i={type:a>1?"strongText":"emphasisText",start:{...e[n][1].end},end:{...e[u][1].start}},r={type:a>1?"strong":"emphasis",start:{...o.start},end:{...s.end}},e[n][1].end={...o.start},e[u][1].start={...s.end},l=[],e[n][1].end.offset-e[n][1].start.offset&&(l=$2(l,[["enter",e[n][1],t],["exit",e[n][1],t]])),l=$2(l,[["enter",r,t],["enter",o,t],["exit",o,t],["enter",i,t]]),l=$2(l,t4(t.parser.constructs.insideSpan.null,e.slice(n+1,u),t)),l=$2(l,[["exit",i,t],["enter",s,t],["exit",s,t],["exit",r,t]]),e[u][1].end.offset-e[u][1].start.offset?(c=2,l=$2(l,[["enter",e[u][1],t],["exit",e[u][1],t]])):c=0,H2(e,n-1,u-n+3,l),u=n+l.length-c-2;break}u=-1;for(;++u<e.length;)"attentionSequence"===e[u][1].type&&(e[u][1].type="data");return e},tokenize:function(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=a4(r);let o;return function(t){return o=t,e.enter("attentionSequence"),s(t)};function s(a){if(a===o)return e.consume(a),s;const l=e.exit("attentionSequence"),c=a4(a),u=!c||2===c&&i||n.includes(a),h=!i||2===i&&c||n.includes(r);return l._open=Boolean(42===o?u:u&&(i||!h)),l._close=Boolean(42===o?h:h&&(c||!u)),t(a)}}};function c4(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const u4={name:"autolink",tokenize:function(e,t,n){let r=0;return function(t){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(t),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i};function i(t){return e3(t)?(e.consume(t),o):64===t?n(t):l(t)}function o(e){return 43===e||45===e||46===e||t3(e)?(r=1,s(e)):l(e)}function s(t){return 58===t?(e.consume(t),r=0,a):(43===t||45===t||46===t||t3(t))&&r++<32?(e.consume(t),s):(r=0,l(t))}function a(r){return 62===r?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(r),e.exit("autolinkMarker"),e.exit("autolink"),t):null===r||32===r||60===r||r3(r)?n(r):(e.consume(r),a)}function l(t){return 64===t?(e.consume(t),c):n3(t)?(e.consume(t),l):n(t)}function c(e){return t3(e)?u(e):n(e)}function u(n){return 46===n?(e.consume(n),r=0,c):62===n?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(n),e.exit("autolinkMarker"),e.exit("autolink"),t):h(n)}function h(t){if((45===t||t3(t))&&r++<63){const n=45===t?h:u;return e.consume(t),n}return n(t)}}};const h4={name:"htmlText",tokenize:function(e,t,n){const r=this;let i,o,s;return function(t){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(t),a};function a(t){return 33===t?(e.consume(t),l):47===t?(e.consume(t),x):63===t?(e.consume(t),y):e3(t)?(e.consume(t),S):n(t)}function l(t){return 45===t?(e.consume(t),c):91===t?(e.consume(t),o=0,f):e3(t)?(e.consume(t),_):n(t)}function c(t){return 45===t?(e.consume(t),d):n(t)}function u(t){return null===t?n(t):45===t?(e.consume(t),h):a3(t)?(s=u,R(t)):(e.consume(t),u)}function h(t){return 45===t?(e.consume(t),d):u(t)}function d(e){return 62===e?M(e):45===e?h(e):u(e)}function f(t){const r="CDATA[";return t===r.charCodeAt(o++)?(e.consume(t),6===o?p:f):n(t)}function p(t){return null===t?n(t):93===t?(e.consume(t),m):a3(t)?(s=p,R(t)):(e.consume(t),p)}function m(t){return 93===t?(e.consume(t),g):p(t)}function g(t){return 62===t?M(t):93===t?(e.consume(t),g):p(t)}function _(t){return null===t||62===t?M(t):a3(t)?(s=_,R(t)):(e.consume(t),_)}function y(t){return null===t?n(t):63===t?(e.consume(t),v):a3(t)?(s=y,R(t)):(e.consume(t),y)}function v(e){return 62===e?M(e):y(e)}function x(t){return e3(t)?(e.consume(t),b):n(t)}function b(t){return 45===t||t3(t)?(e.consume(t),b):w(t)}function w(t){return a3(t)?(s=w,R(t)):c3(t)?(e.consume(t),w):M(t)}function S(t){return 45===t||t3(t)?(e.consume(t),S):47===t||62===t||l3(t)?E(t):n(t)}function E(t){return 47===t?(e.consume(t),M):58===t||95===t||e3(t)?(e.consume(t),T):a3(t)?(s=E,R(t)):c3(t)?(e.consume(t),E):M(t)}function T(t){return 45===t||46===t||58===t||95===t||t3(t)?(e.consume(t),T):A(t)}function A(t){return 61===t?(e.consume(t),C):a3(t)?(s=A,R(t)):c3(t)?(e.consume(t),A):E(t)}function C(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),i=t,P):a3(t)?(s=C,R(t)):c3(t)?(e.consume(t),C):(e.consume(t),I)}function P(t){return t===i?(e.consume(t),i=void 0,k):null===t?n(t):a3(t)?(s=P,R(t)):(e.consume(t),P)}function I(t){return null===t||34===t||39===t||60===t||61===t||96===t?n(t):47===t||62===t||l3(t)?E(t):(e.consume(t),I)}function k(e){return 47===e||62===e||l3(e)?E(e):n(e)}function M(r){return 62===r?(e.consume(r),e.exit("htmlTextData"),e.exit("htmlText"),t):n(r)}function R(t){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),O}function O(t){return c3(t)?f3(e,L,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):L(t)}function L(t){return e.enter("htmlTextData"),s(t)}}};const d4={name:"labelStartLink",resolveAll:n4.resolveAll,tokenize:function(e,t,n){const r=this;return function(t){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelLink"),i};function i(e){return 94===e&&"_hiddenFootnoteSupport"in r.parser.constructs?n(e):t(e)}}};const f4={name:"hardBreakEscape",tokenize:function(e,t,n){return function(t){return e.enter("hardBreakEscape"),e.consume(t),r};function r(r){return a3(r)?(e.exit("hardBreakEscape"),t(r)):n(r)}}};const p4={name:"codeText",previous:function(e){return 96!==e||"characterEscape"===this.events[this.events.length-1][1].type},resolve:function(e){let t,n,r=e.length-4,i=3;if(("lineEnding"===e[i][1].type||"space"===e[i][1].type)&&("lineEnding"===e[r][1].type||"space"===e[r][1].type))for(t=i;++t<r;)if("codeTextData"===e[t][1].type){e[i][1].type="codeTextPadding",e[r][1].type="codeTextPadding",i+=2,r-=2;break}t=i-1,r++;for(;++t<=r;)void 0===n?t!==r&&"lineEnding"!==e[t][1].type&&(n=t):t!==r&&"lineEnding"!==e[t][1].type||(e[n][1].type="codeTextData",t!==n+2&&(e[n][1].end=e[t-1][1].end,e.splice(n+2,t-n-2),r-=t-n-2,t=n+2),n=void 0);return e},tokenize:function(e,t,n){let r,i,o=0;return function(t){return e.enter("codeText"),e.enter("codeTextSequence"),s(t)};function s(t){return 96===t?(e.consume(t),o++,s):(e.exit("codeTextSequence"),a(t))}function a(t){return null===t?n(t):32===t?(e.enter("space"),e.consume(t),e.exit("space"),a):96===t?(i=e.enter("codeTextSequence"),r=0,c(t)):a3(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),a):(e.enter("codeTextData"),l(t))}function l(t){return null===t||32===t||96===t||a3(t)?(e.exit("codeTextData"),a(t)):(e.consume(t),l)}function c(n){return 96===n?(e.consume(n),r++,c):r===o?(e.exit("codeTextSequence"),e.exit("codeText"),t(n)):(i.type="codeTextData",l(n))}}};const m4={42:P3,43:P3,45:P3,48:P3,49:P3,50:P3,51:P3,52:P3,53:P3,54:P3,55:P3,56:P3,57:P3,62:M3},g4={91:z3},_4={[-2]:B3,[-1]:B3,32:B3},y4={35:U3,42:C3,45:[V3,C3],60:$3,61:V3,95:C3,96:Z3,126:Z3},v4={38:J3,92:Q3},x4={[-5]:e4,[-4]:e4,[-3]:e4,33:s4,38:J3,42:l4,60:[u4,h4],91:d4,92:[f4,Q3],93:n4,95:l4,96:p4},b4={null:[l4,b3]},w4={null:[42,95]},S4={null:[]};function E4(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const i={},o=[];let s=[],a=[],l=!0;const c={attempt:y(function(e,t){v(e,t.from)}),check:y(_),consume:function(e){a3(e)?(r.line++,r.column=1,r.offset+=-3===e?2:1,x()):-1!==e&&(r.column++,r.offset++);r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++));u.previous=e,l=!0},enter:function(e,t){const n=t||{};return n.type=e,n.start=p(),u.events.push(["enter",n,u]),a.push(n),n},exit:function(e){const t=a.pop();return t.end=p(),u.events.push(["exit",t,u]),t},interrupt:y(_,{interrupt:!0})},u={code:null,containerState:{},defineSkip:function(e){i[e.line]=e.column,x()},events:[],now:p,parser:e,previous:null,sliceSerialize:function(e,t){return function(e,t){let n=-1;const r=[];let i;for(;++n<e.length;){const o=e[n];let s;if("string"===typeof o)s=o;else switch(o){case-5:s="\r";break;case-4:s="\n";break;case-3:s="\r\n";break;case-2:s=t?" ":"\t";break;case-1:if(!t&&i)continue;s=" ";break;default:s=String.fromCharCode(o)}i=-2===o,r.push(s)}return r.join("")}(f(e),t)},sliceStream:f,write:function(e){if(s=$2(s,e),m(),null!==s[s.length-1])return[];return v(t,0),u.events=t4(o,u.events,u),u.events}};let h,d=t.tokenize.call(u,c);return t.resolveAll&&o.push(t),u;function f(e){return function(e,t){const n=t.start._index,r=t.start._bufferIndex,i=t.end._index,o=t.end._bufferIndex;let s;if(n===i)s=[e[n].slice(r,o)];else{if(s=e.slice(n,i),r>-1){const e=s[0];"string"===typeof e?s[0]=e.slice(r):s.shift()}o>0&&s.push(e[i].slice(0,o))}return s}(s,e)}function p(){const{_bufferIndex:e,_index:t,line:n,column:i,offset:o}=r;return{_bufferIndex:e,_index:t,line:n,column:i,offset:o}}function m(){let e;for(;r._index<s.length;){const t=s[r._index];if("string"===typeof t)for(e=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===e&&r._bufferIndex<t.length;)g(t.charCodeAt(r._bufferIndex));else g(t)}}function g(e){l=void 0,h=e,d=d(e)}function _(e,t){t.restore()}function y(e,t){return function(n,i,o){let s,h,d,f;return Array.isArray(n)?m(n):"tokenize"in n?m([n]):function(e){return t;function t(t){const n=null!==t&&e[t],r=null!==t&&e.null;return m([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(r)?r:r?[r]:[]])(t)}}(n);function m(e){return s=e,h=0,0===e.length?o:g(e[h])}function g(e){return function(n){f=function(){const e=p(),t=u.previous,n=u.currentConstruct,i=u.events.length,o=Array.from(a);return{from:i,restore:s};function s(){r=e,u.previous=t,u.currentConstruct=n,u.events.length=i,a=o,x()}}(),d=e,e.partial||(u.currentConstruct=e);if(e.name&&u.parser.constructs.disable.null.includes(e.name))return y(n);return e.tokenize.call(t?Object.assign(Object.create(u),t):u,c,_,y)(n)}}function _(t){return l=!0,e(d,f),i}function y(e){return l=!0,f.restore(),++h<s.length?g(s[h]):o}}}function v(e,t){e.resolveAll&&!o.includes(e)&&o.push(e),e.resolve&&H2(u.events,t,u.events.length-t,e.resolve(u.events.slice(t),u)),e.resolveTo&&(u.events=e.resolveTo(u.events,u))}function x(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}const T4=/[\0\t\n\r]/g;function A4(e,t){const n=Number.parseInt(e,t);return n<9||11===n||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||65535===(65535&n)||65534===(65535&n)||n>1114111?"\ufffd":String.fromCodePoint(n)}const C4=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function P4(e,t,n){if(t)return t;if(35===n.charCodeAt(0)){const e=n.charCodeAt(1),t=120===e||88===e;return A4(n.slice(t?2:1),t?16:10)}return Y3(n)||e}const I4={}.hasOwnProperty;function k4(e,t,n){return"string"!==typeof t&&(n=t,t=void 0),function(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:o(te),autolinkProtocol:T,autolinkEmail:T,atxHeading:o(Y),blockQuote:o(W),characterEscape:T,characterReference:T,codeFenced:o(q),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:o(q,s),codeText:o(X,s),codeTextData:T,data:T,codeFlowValue:T,definition:o(Z),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:o(K),hardBreakEscape:o(J),hardBreakTrailing:o(J),htmlFlow:o(Q,s),htmlFlowData:T,htmlText:o(Q,s),htmlTextData:T,image:o(ee),label:s,link:o(te),listItem:o(re),listItemValue:d,listOrdered:o(ne,h),listUnordered:o(ne),paragraph:o(ie),reference:B,referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:o(Y),strong:o(oe),thematicBreak:o(ae)},exit:{atxHeading:l(),atxHeadingSequence:b,autolink:l(),autolinkEmail:$,autolinkProtocol:H,blockQuote:l(),characterEscapeValue:A,characterReferenceMarkerHexadecimal:U,characterReferenceMarkerNumeric:U,characterReferenceValue:V,characterReference:G,codeFenced:l(g),codeFencedFence:m,codeFencedFenceInfo:f,codeFencedFenceMeta:p,codeFlowValue:A,codeIndented:l(_),codeText:l(M),codeTextData:A,data:A,definition:l(),definitionDestinationString:x,definitionLabelString:y,definitionTitleString:v,emphasis:l(),hardBreakEscape:l(P),hardBreakTrailing:l(P),htmlFlow:l(I),htmlFlowData:A,htmlText:l(k),htmlTextData:A,image:l(O),label:D,labelText:L,lineEnding:C,link:l(R),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:j,resourceDestinationString:N,resourceTitleString:z,resource:F,setextHeading:l(E),setextHeadingLineSequence:S,setextHeadingText:w,strong:l(),thematicBreak:l()}};R4(t,(e||{}).mdastExtensions||[]);const n={};return r;function r(e){let r={type:"root",children:[]};const o={stack:[r],tokenStack:[],config:t,enter:a,exit:c,buffer:s,resume:u,data:n},l=[];let h=-1;for(;++h<e.length;)if("listOrdered"===e[h][1].type||"listUnordered"===e[h][1].type)if("enter"===e[h][0])l.push(h);else{h=i(e,l.pop(),h)}for(h=-1;++h<e.length;){const n=t[e[h][0]];I4.call(n,e[h][1].type)&&n[e[h][1].type].call(Object.assign({sliceSerialize:e[h][2].sliceSerialize},o),e[h][1])}if(o.tokenStack.length>0){const e=o.tokenStack[o.tokenStack.length-1];(e[1]||L4).call(o,void 0,e[0])}for(r.position={start:M4(e.length>0?e[0][1].start:{line:1,column:1,offset:0}),end:M4(e.length>0?e[e.length-2][1].end:{line:1,column:1,offset:0})},h=-1;++h<t.transforms.length;)r=t.transforms[h](r)||r;return r}function i(e,t,n){let r,i,o,s,a=t-1,l=-1,c=!1;for(;++a<=n;){const t=e[a];switch(t[1].type){case"listUnordered":case"listOrdered":case"blockQuote":"enter"===t[0]?l++:l--,s=void 0;break;case"lineEndingBlank":"enter"===t[0]&&(!r||s||l||o||(o=a),s=void 0);break;case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:s=void 0}if(!l&&"enter"===t[0]&&"listItemPrefix"===t[1].type||-1===l&&"exit"===t[0]&&("listUnordered"===t[1].type||"listOrdered"===t[1].type)){if(r){let s=a;for(i=void 0;s--;){const t=e[s];if("lineEnding"===t[1].type||"lineEndingBlank"===t[1].type){if("exit"===t[0])continue;i&&(e[i][1].type="lineEndingBlank",c=!0),t[1].type="lineEnding",i=s}else if("linePrefix"!==t[1].type&&"blockQuotePrefix"!==t[1].type&&"blockQuotePrefixWhitespace"!==t[1].type&&"blockQuoteMarker"!==t[1].type&&"listItemIndent"!==t[1].type)break}o&&(!i||o<i)&&(r._spread=!0),r.end=Object.assign({},i?e[i][1].start:t[1].end),e.splice(i||a,0,["exit",r,t[2]]),a++,n++}if("listItemPrefix"===t[1].type){const i={type:"listItem",_spread:!1,start:Object.assign({},t[1].start),end:void 0};r=i,e.splice(a,0,["enter",i,t[2]]),a++,n++,o=void 0,s=!0}}}return e[t][1]._spread=c,n}function o(e,t){return n;function n(n){a.call(this,e(n),n),t&&t.call(this,n)}}function s(){this.stack.push({type:"fragment",children:[]})}function a(e,t,n){this.stack[this.stack.length-1].children.push(e),this.stack.push(e),this.tokenStack.push([t,n||void 0]),e.position={start:M4(t.start),end:void 0}}function l(e){return t;function t(t){e&&e.call(this,t),c.call(this,t)}}function c(e,t){const n=this.stack.pop(),r=this.tokenStack.pop();if(!r)throw new Error("Cannot close `"+e.type+"` ("+y2({start:e.start,end:e.end})+"): it\u2019s not open");if(r[0].type!==e.type)if(t)t.call(this,e,r[0]);else{(r[1]||L4).call(this,e,r[0])}n.position.end=M4(e.end)}function u(){return U2(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function d(e){if(this.data.expectingFirstListItemValue){this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(e),10),this.data.expectingFirstListItemValue=void 0}}function f(){const e=this.resume();this.stack[this.stack.length-1].lang=e}function p(){const e=this.resume();this.stack[this.stack.length-1].meta=e}function m(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function g(){const e=this.resume();this.stack[this.stack.length-1].value=e.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function _(){const e=this.resume();this.stack[this.stack.length-1].value=e.replace(/(\r?\n|\r)$/g,"")}function y(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=N3(this.sliceSerialize(e)).toLowerCase()}function v(){const e=this.resume();this.stack[this.stack.length-1].title=e}function x(){const e=this.resume();this.stack[this.stack.length-1].url=e}function b(e){const t=this.stack[this.stack.length-1];if(!t.depth){const n=this.sliceSerialize(e).length;t.depth=n}}function w(){this.data.setextHeadingSlurpLineEnding=!0}function S(e){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(e).codePointAt(0)?1:2}function E(){this.data.setextHeadingSlurpLineEnding=void 0}function T(e){const t=this.stack[this.stack.length-1].children;let n=t[t.length-1];n&&"text"===n.type||(n=se(),n.position={start:M4(e.start),end:void 0},t.push(n)),this.stack.push(n)}function A(e){const t=this.stack.pop();t.value+=this.sliceSerialize(e),t.position.end=M4(e.end)}function C(e){const n=this.stack[this.stack.length-1];if(this.data.atHardBreak){return n.children[n.children.length-1].position.end=M4(e.end),void(this.data.atHardBreak=void 0)}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(n.type)&&(T.call(this,e),A.call(this,e))}function P(){this.data.atHardBreak=!0}function I(){const e=this.resume();this.stack[this.stack.length-1].value=e}function k(){const e=this.resume();this.stack[this.stack.length-1].value=e}function M(){const e=this.resume();this.stack[this.stack.length-1].value=e}function R(){const e=this.stack[this.stack.length-1];if(this.data.inReference){const t=this.data.referenceType||"shortcut";e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function O(){const e=this.stack[this.stack.length-1];if(this.data.inReference){const t=this.data.referenceType||"shortcut";e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function L(e){const t=this.sliceSerialize(e),n=this.stack[this.stack.length-2];n.label=function(e){return e.replace(C4,P4)}(t),n.identifier=N3(t).toLowerCase()}function D(){const e=this.stack[this.stack.length-1],t=this.resume(),n=this.stack[this.stack.length-1];if(this.data.inReference=!0,"link"===n.type){const t=e.children;n.children=t}else n.alt=t}function N(){const e=this.resume();this.stack[this.stack.length-1].url=e}function z(){const e=this.resume();this.stack[this.stack.length-1].title=e}function F(){this.data.inReference=void 0}function B(){this.data.referenceType="collapsed"}function j(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=N3(this.sliceSerialize(e)).toLowerCase(),this.data.referenceType="full"}function U(e){this.data.characterReferenceType=e.type}function V(e){const t=this.sliceSerialize(e),n=this.data.characterReferenceType;let r;if(n)r=A4(t,"characterReferenceMarkerNumeric"===n?10:16),this.data.characterReferenceType=void 0;else{r=Y3(t)}this.stack[this.stack.length-1].value+=r}function G(e){this.stack.pop().position.end=M4(e.end)}function H(e){A.call(this,e);this.stack[this.stack.length-1].url=this.sliceSerialize(e)}function $(e){A.call(this,e);this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(e)}function W(){return{type:"blockquote",children:[]}}function q(){return{type:"code",lang:null,meta:null,value:""}}function X(){return{type:"inlineCode",value:""}}function Z(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function K(){return{type:"emphasis",children:[]}}function Y(){return{type:"heading",depth:0,children:[]}}function J(){return{type:"break"}}function Q(){return{type:"html",value:""}}function ee(){return{type:"image",title:null,url:"",alt:null}}function te(){return{type:"link",title:null,url:"",children:[]}}function ne(e){return{type:"list",ordered:"listOrdered"===e.type,start:null,spread:e._spread,children:[]}}function re(e){return{type:"listItem",spread:e._spread,checked:null,children:[]}}function ie(){return{type:"paragraph",children:[]}}function oe(){return{type:"strong",children:[]}}function se(){return{type:"text",value:""}}function ae(){return{type:"thematicBreak"}}}(n)(function(e){for(;!X2(e););return e}(function(e){const t={constructs:Y2([r,...(e||{}).extensions||[]]),content:n(p3),defined:[],document:n(m3),flow:n(x3),lazy:{},string:n(w3),text:n(S3)};return t;function n(e){return function(n){return E4(t,e,n)}}}(n).document().write(function(){let e,t=1,n="",r=!0;return function(i,o,s){const a=[];let l,c,u,h,d;for(i=n+("string"===typeof i?i.toString():new TextDecoder(o||void 0).decode(i)),u=0,n="",r&&(65279===i.charCodeAt(0)&&u++,r=void 0);u<i.length;){if(T4.lastIndex=u,l=T4.exec(i),h=l&&void 0!==l.index?l.index:i.length,d=i.charCodeAt(h),!l){n=i.slice(u);break}if(10===d&&u===h&&e)a.push(-3),e=void 0;else switch(e&&(a.push(-5),e=void 0),u<h&&(a.push(i.slice(u,h)),t+=h-u),d){case 0:a.push(65533),t++;break;case 9:for(c=4*Math.ceil(t/4),a.push(-2);t++<c;)a.push(-1);break;case 10:a.push(-4),t=1;break;default:e=!0,t=1}u=h+1}return s&&(e&&a.push(-5),n&&a.push(n),a.push(null)),a}}()(e,t,!0))))}function M4(e){return{line:e.line,column:e.column,offset:e.offset}}function R4(e,t){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?R4(e,r):O4(e,r)}}function O4(e,t){let n;for(n in t)if(I4.call(t,n))switch(n){case"canContainEols":{const r=t[n];r&&e[n].push(...r);break}case"transforms":{const r=t[n];r&&e[n].push(...r);break}case"enter":case"exit":{const r=t[n];r&&Object.assign(e[n],r);break}}}function L4(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+y2({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+y2({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+y2({start:t.start,end:t.end})+") is still open")}function D4(e){const t=this;t.parser=function(n){return k4(n,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}const N4="object"===typeof self?self:globalThis,z4=e=>((e,t)=>{const n=(t,n)=>(e.set(n,t),t),r=i=>{if(e.has(i))return e.get(i);const[o,s]=t[i];switch(o){case 0:case-1:return n(s,i);case 1:{const e=n([],i);for(const t of s)e.push(r(t));return e}case 2:{const e=n({},i);for(const[t,n]of s)e[r(t)]=r(n);return e}case 3:return n(new Date(s),i);case 4:{const{source:e,flags:t}=s;return n(new RegExp(e,t),i)}case 5:{const e=n(new Map,i);for(const[t,n]of s)e.set(r(t),r(n));return e}case 6:{const e=n(new Set,i);for(const t of s)e.add(r(t));return e}case 7:{const{name:e,message:t}=s;return n(new N4[e](t),i)}case 8:return n(BigInt(s),i);case"BigInt":return n(Object(BigInt(s)),i);case"ArrayBuffer":return n(new Uint8Array(s).buffer,s);case"DataView":{const{buffer:e}=new Uint8Array(s);return n(new DataView(e),s)}}return n(new N4[o](s),i)};return r})(new Map,e)(0),F4="",{toString:B4}={},{keys:j4}=Object,U4=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const n=B4.call(e).slice(8,-1);switch(n){case"Array":return[1,F4];case"Object":return[2,F4];case"Date":return[3,F4];case"RegExp":return[4,F4];case"Map":return[5,F4];case"Set":return[6,F4];case"DataView":return[1,n]}return n.includes("Array")?[1,n]:n.includes("Error")?[7,n]:[2,n]},V4=e=>{let[t,n]=e;return 0===t&&("function"===n||"symbol"===n)},G4=function(e){let{json:t,lossy:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=[];return((e,t,n,r)=>{const i=(e,t)=>{const i=r.push(e)-1;return n.set(t,i),i},o=r=>{if(n.has(r))return n.get(r);let[s,a]=U4(r);switch(s){case 0:{let t=r;switch(a){case"bigint":s=8,t=r.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+a);t=null;break;case"undefined":return i([-1],r)}return i([s,t],r)}case 1:{if(a){let e=r;return"DataView"===a?e=new Uint8Array(r.buffer):"ArrayBuffer"===a&&(e=new Uint8Array(r)),i([a,[...e]],r)}const e=[],t=i([s,e],r);for(const n of r)e.push(o(n));return t}case 2:{if(a)switch(a){case"BigInt":return i([a,r.toString()],r);case"Boolean":case"Number":case"String":return i([a,r.valueOf()],r)}if(t&&"toJSON"in r)return o(r.toJSON());const n=[],l=i([s,n],r);for(const t of j4(r))!e&&V4(U4(r[t]))||n.push([o(t),o(r[t])]);return l}case 3:return i([s,r.toISOString()],r);case 4:{const{source:e,flags:t}=r;return i([s,{source:e,flags:t}],r)}case 5:{const t=[],n=i([s,t],r);for(const[i,s]of r)(e||!V4(U4(i))&&!V4(U4(s)))&&t.push([o(i),o(s)]);return n}case 6:{const t=[],n=i([s,t],r);for(const i of r)!e&&V4(U4(i))||t.push(o(i));return n}}const{message:l}=r;return i([s,{name:a,message:l}],r)};return o})(!(t||n),!!t,new Map,r)(e),r},H4="function"===typeof structuredClone?(e,t)=>t&&("json"in t||"lossy"in t)?z4(G4(e,t)):structuredClone(e):(e,t)=>z4(G4(e,t));function $4(e){const t=[];let n=-1,r=0,i=0;for(;++n<e.length;){const o=e.charCodeAt(n);let s="";if(37===o&&t3(e.charCodeAt(n+1))&&t3(e.charCodeAt(n+2)))i=2;else if(o<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(o))||(s=String.fromCharCode(o));else if(o>55295&&o<57344){const t=e.charCodeAt(n+1);o<56320&&t>56319&&t<57344?(s=String.fromCharCode(o,t),i=1):s="\ufffd"}else s=String.fromCharCode(o);s&&(t.push(e.slice(r,n),encodeURIComponent(s)),r=n+i+1,s=""),i&&(n+=i,i=0)}return t.join("")+e.slice(r)}function W4(e,t){const n=[{type:"text",value:"\u21a9"}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function q4(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}const X4=function(e){if(null===e||void 0===e)return K4;if("function"===typeof e)return Z4(e);if("object"===typeof e)return Array.isArray(e)?function(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=X4(e[n]);return Z4(r);function r(){let e=-1;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(;++e<t.length;)if(t[e].apply(this,r))return!0;return!1}}(e):function(e){const t=e;return Z4(n);function n(n){const r=n;let i;for(i in e)if(r[i]!==t[i])return!1;return!0}}(e);if("string"===typeof e)return function(e){return Z4(t);function t(t){return t&&t.type===e}}(e);throw new Error("Expected function, string, or object as test")};function Z4(e){return function(t,n,r){return Boolean(Y4(t)&&e.call(this,t,"number"===typeof n?n:void 0,r||void 0))}}function K4(){return!0}function Y4(e){return null!==e&&"object"===typeof e&&"type"in e}const J4=[],Q4=!0,e5=!1;function t5(e,t,n,r){let i;"function"===typeof t&&"function"!==typeof n?(r=n,n=t):i=t;const o=X4(i),s=r?-1:1;!function e(i,a,l){const c=i&&"object"===typeof i?i:{};if("string"===typeof c.type){const e="string"===typeof c.tagName?c.tagName:"string"===typeof c.name?c.name:void 0;Object.defineProperty(u,"name",{value:"node ("+i.type+(e?"<"+e+">":"")+")"})}return u;function u(){let c,u,h,d=J4;if((!t||o(i,a,l[l.length-1]||void 0))&&(d=function(e){if(Array.isArray(e))return e;if("number"===typeof e)return[Q4,e];return null===e||void 0===e?J4:[e]}(n(i,l)),d[0]===e5))return d;if("children"in i&&i.children){const t=i;if(t.children&&"skip"!==d[0])for(u=(r?t.children.length:-1)+s,h=l.concat(t);u>-1&&u<t.children.length;){const n=t.children[u];if(c=e(n,u,h)(),c[0]===e5)return c;u="number"===typeof c[1]?c[1]:u+s}}return d}}(e,void 0,[])()}function n5(e,t,n,r){let i,o,s;"function"===typeof t&&"function"!==typeof n?(o=void 0,s=t,i=n):(o=t,s=n,i=r),t5(e,o,function(e,t){const n=t[t.length-1],r=n?n.children.indexOf(e):void 0;return s(e,r,n)},i)}function r5(e,t){const n=t.referenceType;let r="]";if("collapsed"===n?r+="[]":"full"===n&&(r+="["+(t.label||t.identifier)+"]"),"imageReference"===t.type)return[{type:"text",value:"!["+t.alt+r}];const i=e.all(t),o=i[0];o&&"text"===o.type?o.value="["+o.value:i.unshift({type:"text",value:"["});const s=i[i.length-1];return s&&"text"===s.type?s.value+=r:i.push({type:"text",value:r}),i}function i5(e){const t=e.spread;return null===t||void 0===t?e.children.length>1:t}function o5(e){const t=String(e),n=/\r?\n|\r/g;let r=n.exec(t),i=0;const o=[];for(;r;)o.push(s5(t.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(t);return o.push(s5(t.slice(i),i>0,!1)),o.join("")}function s5(e,t,n){let r=0,i=e.length;if(t){let t=e.codePointAt(r);for(;9===t||32===t;)r++,t=e.codePointAt(r)}if(n){let t=e.codePointAt(i-1);for(;9===t||32===t;)i--,t=e.codePointAt(i-1)}return i>r?e.slice(r,i):""}const a5={blockquote:function(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)},break:function(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:"\n"}]},code:function(e,t){const n=t.value?t.value+"\n":"",r={};t.lang&&(r.className=["language-"+t.lang]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return t.meta&&(i.data={meta:t.meta}),e.patch(t,i),i=e.applyData(t,i),i={type:"element",tagName:"pre",properties:{},children:[i]},e.patch(t,i),i},delete:function(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},emphasis:function(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},footnoteReference:function(e,t){const n="string"===typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",r=String(t.identifier).toUpperCase(),i=$4(r.toLowerCase()),o=e.footnoteOrder.indexOf(r);let s,a=e.footnoteCounts.get(r);void 0===a?(a=0,e.footnoteOrder.push(r),s=e.footnoteOrder.length):s=o+1,a+=1,e.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+i,id:n+"fnref-"+i+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(s)}]};e.patch(t,l);const c={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,c),e.applyData(t,c)},heading:function(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},html:function(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}},imageReference:function(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return r5(e,t);const i={src:$4(r.url||""),alt:t.alt};null!==r.title&&void 0!==r.title&&(i.title=r.title);const o={type:"element",tagName:"img",properties:i,children:[]};return e.patch(t,o),e.applyData(t,o)},image:function(e,t){const n={src:$4(t.url)};null!==t.alt&&void 0!==t.alt&&(n.alt=t.alt),null!==t.title&&void 0!==t.title&&(n.title=t.title);const r={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,r),e.applyData(t,r)},inlineCode:function(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,r),e.applyData(t,r)},linkReference:function(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return r5(e,t);const i={href:$4(r.url||"")};null!==r.title&&void 0!==r.title&&(i.title=r.title);const o={type:"element",tagName:"a",properties:i,children:e.all(t)};return e.patch(t,o),e.applyData(t,o)},link:function(e,t){const n={href:$4(t.url)};null!==t.title&&void 0!==t.title&&(n.title=t.title);const r={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)},listItem:function(e,t,n){const r=e.all(t),i=n?function(e){let t=!1;if("list"===e.type){t=e.spread||!1;const n=e.children;let r=-1;for(;!t&&++r<n.length;)t=i5(n[r])}return t}(n):i5(t),o={},s=[];if("boolean"===typeof t.checked){const e=r[0];let n;e&&"element"===e.type&&"p"===e.tagName?n=e:(n={type:"element",tagName:"p",properties:{},children:[]},r.unshift(n)),n.children.length>0&&n.children.unshift({type:"text",value:" "}),n.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),o.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const e=r[a];(i||0!==a||"element"!==e.type||"p"!==e.tagName)&&s.push({type:"text",value:"\n"}),"element"!==e.type||"p"!==e.tagName||i?s.push(e):s.push(...e.children)}const l=r[r.length-1];l&&(i||"element"!==l.type||"p"!==l.tagName)&&s.push({type:"text",value:"\n"});const c={type:"element",tagName:"li",properties:o,children:s};return e.patch(t,c),e.applyData(t,c)},list:function(e,t){const n={},r=e.all(t);let i=-1;for("number"===typeof t.start&&1!==t.start&&(n.start=t.start);++i<r.length;){const e=r[i];if("element"===e.type&&"li"===e.tagName&&e.properties&&Array.isArray(e.properties.className)&&e.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const o={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(r,!0)};return e.patch(t,o),e.applyData(t,o)},paragraph:function(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},root:function(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)},strong:function(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},table:function(e,t){const n=e.all(t),r=n.shift(),i=[];if(r){const n={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(t.children[0],n),i.push(n)}if(n.length>0){const r={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},o=g2(t.children[1]),s=m2(t.children[t.children.length-1]);o&&s&&(r.position={start:o,end:s}),i.push(r)}const o={type:"element",tagName:"table",properties:{},children:e.wrap(i,!0)};return e.patch(t,o),e.applyData(t,o)},tableCell:function(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},tableRow:function(e,t,n){const r=n?n.children:void 0,i=0===(r?r.indexOf(t):1)?"th":"td",o=n&&"table"===n.type?n.align:void 0,s=o?o.length:t.children.length;let a=-1;const l=[];for(;++a<s;){const n=t.children[a],r={},s=o?o[a]:void 0;s&&(r.align=s);let c={type:"element",tagName:i,properties:r,children:[]};n&&(c.children=e.all(n),e.patch(n,c),c=e.applyData(n,c)),l.push(c)}const c={type:"element",tagName:"tr",properties:{},children:e.wrap(l,!0)};return e.patch(t,c),e.applyData(t,c)},text:function(e,t){const n={type:"text",value:o5(String(t.value))};return e.patch(t,n),e.applyData(t,n)},thematicBreak:function(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)},toml:l5,yaml:l5,definition:l5,footnoteDefinition:l5};function l5(){}const c5={}.hasOwnProperty,u5={};function h5(e,t){e.position&&(t.position=function(e){const t=g2(e),n=m2(e);if(t&&n)return{start:t,end:n}}(e))}function d5(e,t){let n=t;if(e&&e.data){const t=e.data.hName,r=e.data.hChildren,i=e.data.hProperties;if("string"===typeof t)if("element"===n.type)n.tagName=t;else{n={type:"element",tagName:t,properties:{},children:"children"in n?n.children:[n]}}"element"===n.type&&i&&Object.assign(n.properties,H4(i)),"children"in n&&n.children&&null!==r&&void 0!==r&&(n.children=r)}return n}function f5(e,t){const n=t.data||{},r=!("value"in t)||c5.call(n,"hProperties")||c5.call(n,"hChildren")?{type:"element",tagName:"div",properties:{},children:e.all(t)}:{type:"text",value:t.value};return e.patch(t,r),e.applyData(t,r)}function p5(e,t){const n=[];let r=-1;for(t&&n.push({type:"text",value:"\n"});++r<e.length;)r&&n.push({type:"text",value:"\n"}),n.push(e[r]);return t&&e.length>0&&n.push({type:"text",value:"\n"}),n}function m5(e){let t=0,n=e.charCodeAt(t);for(;9===n||32===n;)t++,n=e.charCodeAt(t);return e.slice(t)}function g5(e,t){const n=function(e,t){const n=t||u5,r=new Map,i=new Map,o=new Map,s={...a5,...n.handlers},a={all:function(e){const t=[];if("children"in e){const n=e.children;let r=-1;for(;++r<n.length;){const i=a.one(n[r],e);if(i){if(r&&"break"===n[r-1].type&&(Array.isArray(i)||"text"!==i.type||(i.value=m5(i.value)),!Array.isArray(i)&&"element"===i.type)){const e=i.children[0];e&&"text"===e.type&&(e.value=m5(e.value))}Array.isArray(i)?t.push(...i):t.push(i)}}}return t},applyData:d5,definitionById:r,footnoteById:i,footnoteCounts:o,footnoteOrder:[],handlers:s,one:function(e,t){const n=e.type,r=a.handlers[n];if(c5.call(a.handlers,n)&&r)return r(a,e,t);if(a.options.passThrough&&a.options.passThrough.includes(n)){if("children"in e){const{children:t,...n}=e,r=H4(n);return r.children=a.all(e),r}return H4(e)}return(a.options.unknownHandler||f5)(a,e,t)},options:n,patch:h5,wrap:p5};return n5(e,function(e){if("definition"===e.type||"footnoteDefinition"===e.type){const t="definition"===e.type?r:i,n=String(e.identifier).toUpperCase();t.has(n)||t.set(n,e)}}),a}(e,t),r=n.one(e,void 0),i=function(e){const t="string"===typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||W4,r=e.options.footnoteBackLabel||q4,i=e.options.footnoteLabel||"Footnotes",o=e.options.footnoteLabelTagName||"h2",s=e.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<e.footnoteOrder.length;){const i=e.footnoteById.get(e.footnoteOrder[l]);if(!i)continue;const o=e.all(i),s=String(i.identifier).toUpperCase(),c=$4(s.toLowerCase());let u=0;const h=[],d=e.footnoteCounts.get(s);for(;void 0!==d&&++u<=d;){h.length>0&&h.push({type:"text",value:" "});let e="string"===typeof n?n:n(l,u);"string"===typeof e&&(e={type:"text",value:e}),h.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+c+(u>1?"-"+u:""),dataFootnoteBackref:"",ariaLabel:"string"===typeof r?r:r(l,u),className:["data-footnote-backref"]},children:Array.isArray(e)?e:[e]})}const f=o[o.length-1];if(f&&"element"===f.type&&"p"===f.tagName){const e=f.children[f.children.length-1];e&&"text"===e.type?e.value+=" ":f.children.push({type:"text",value:" "}),f.children.push(...h)}else o.push(...h);const p={type:"element",tagName:"li",properties:{id:t+"fn-"+c},children:e.wrap(o,!0)};e.patch(i,p),a.push(p)}if(0!==a.length)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:o,properties:{...H4(s),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:e.wrap(a,!0)},{type:"text",value:"\n"}]}}(n),o=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&o.children.push({type:"text",value:"\n"},i),o}function _5(e,t){return e&&"run"in e?async function(n,r){const i=g5(n,{file:r,...t});await e.run(i,r)}:function(n,r){return g5(n,{file:r,...e||t})}}function y5(e){if(e)throw e}var v5=n(3240);function x5(e){if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function b5(){const e=[],t={run:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];let i=-1;const o=n.pop();if("function"!==typeof o)throw new TypeError("Expected function as last argument, not "+o);!function t(r){const s=e[++i];let a=-1;if(r)o(r);else{for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];for(;++a<n.length;)null!==c[a]&&void 0!==c[a]||(c[a]=n[a]);n=c,s?function(e,t){let n;return i;function i(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];const l=e.length>i.length;let c;l&&i.push(o);try{c=e.apply(this,i)}catch(r){if(l&&n)throw r;return o(r)}l||(c&&c.then&&"function"===typeof c.then?c.then(s,o):c instanceof Error?o(c):s(c))}function o(e){if(!n){n=!0;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];t(e,...i)}}function s(e){o(null,e)}}(s,t)(...c):o(null,...c)}}(null,...n)},use:function(n){if("function"!==typeof n)throw new TypeError("Expected `middelware` to be a function, not "+n);return e.push(n),t}};return t}const w5={basename:function(e,t){if(void 0!==t&&"string"!==typeof t)throw new TypeError('"ext" argument must be a string');S5(e);let n,r=0,i=-1,o=e.length;if(void 0===t||0===t.length||t.length>e.length){for(;o--;)if(47===e.codePointAt(o)){if(n){r=o+1;break}}else i<0&&(n=!0,i=o+1);return i<0?"":e.slice(r,i)}if(t===e)return"";let s=-1,a=t.length-1;for(;o--;)if(47===e.codePointAt(o)){if(n){r=o+1;break}}else s<0&&(n=!0,s=o+1),a>-1&&(e.codePointAt(o)===t.codePointAt(a--)?a<0&&(i=o):(a=-1,i=s));r===i?i=s:i<0&&(i=e.length);return e.slice(r,i)},dirname:function(e){if(S5(e),0===e.length)return".";let t,n=-1,r=e.length;for(;--r;)if(47===e.codePointAt(r)){if(t){n=r;break}}else t||(t=!0);return n<0?47===e.codePointAt(0)?"/":".":1===n&&47===e.codePointAt(0)?"//":e.slice(0,n)},extname:function(e){S5(e);let t,n=e.length,r=-1,i=0,o=-1,s=0;for(;n--;){const a=e.codePointAt(n);if(47!==a)r<0&&(t=!0,r=n+1),46===a?o<0?o=n:1!==s&&(s=1):o>-1&&(s=-1);else if(t){i=n+1;break}}if(o<0||r<0||0===s||1===s&&o===r-1&&o===i+1)return"";return e.slice(o,r)},join:function(){let e,t=-1;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(;++t<r.length;)S5(r[t]),r[t]&&(e=void 0===e?r[t]:e+"/"+r[t]);return void 0===e?".":function(e){S5(e);const t=47===e.codePointAt(0);let n=function(e,t){let n,r,i="",o=0,s=-1,a=0,l=-1;for(;++l<=e.length;){if(l<e.length)n=e.codePointAt(l);else{if(47===n)break;n=47}if(47===n){if(s===l-1||1===a);else if(s!==l-1&&2===a){if(i.length<2||2!==o||46!==i.codePointAt(i.length-1)||46!==i.codePointAt(i.length-2))if(i.length>2){if(r=i.lastIndexOf("/"),r!==i.length-1){r<0?(i="",o=0):(i=i.slice(0,r),o=i.length-1-i.lastIndexOf("/")),s=l,a=0;continue}}else if(i.length>0){i="",o=0,s=l,a=0;continue}t&&(i=i.length>0?i+"/..":"..",o=2)}else i.length>0?i+="/"+e.slice(s+1,l):i=e.slice(s+1,l),o=l-s-1;s=l,a=0}else 46===n&&a>-1?a++:a=-1}return i}(e,!t);0!==n.length||t||(n=".");n.length>0&&47===e.codePointAt(e.length-1)&&(n+="/");return t?"/"+n:n}(e)},sep:"/"};function S5(e){if("string"!==typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const E5={cwd:function(){return"/"}};function T5(e){return Boolean(null!==e&&"object"===typeof e&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&void 0===e.auth)}function A5(e){if("string"===typeof e)e=new URL(e);else if(!T5(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if("file:"!==e.protocol){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return function(e){if(""!==e.hostname){const e=new TypeError('File URL host must be "localhost" or empty on darwin');throw e.code="ERR_INVALID_FILE_URL_HOST",e}const t=e.pathname;let n=-1;for(;++n<t.length;)if(37===t.codePointAt(n)&&50===t.codePointAt(n+1)){const e=t.codePointAt(n+2);if(70===e||102===e){const e=new TypeError("File URL path must not include encoded / characters");throw e.code="ERR_INVALID_FILE_URL_PATH",e}}return decodeURIComponent(t)}(e)}const C5=["history","path","basename","stem","extname","dirname"];class P5{constructor(e){let t;t=e?T5(e)?{path:e}:"string"===typeof e||function(e){return Boolean(e&&"object"===typeof e&&"byteLength"in e&&"byteOffset"in e)}(e)?{value:e}:e:{},this.cwd="cwd"in t?"":E5.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n,r=-1;for(;++r<C5.length;){const e=C5[r];e in t&&void 0!==t[e]&&null!==t[e]&&(this[e]="history"===e?[...t[e]]:t[e])}for(n in t)C5.includes(n)||(this[n]=t[n])}get basename(){return"string"===typeof this.path?w5.basename(this.path):void 0}set basename(e){k5(e,"basename"),I5(e,"basename"),this.path=w5.join(this.dirname||"",e)}get dirname(){return"string"===typeof this.path?w5.dirname(this.path):void 0}set dirname(e){M5(this.basename,"dirname"),this.path=w5.join(e||"",this.basename)}get extname(){return"string"===typeof this.path?w5.extname(this.path):void 0}set extname(e){if(I5(e,"extname"),M5(this.dirname,"extname"),e){if(46!==e.codePointAt(0))throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=w5.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){T5(e)&&(e=A5(e)),k5(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return"string"===typeof this.path?w5.basename(this.path,this.extname):void 0}set stem(e){k5(e,"stem"),I5(e,"stem"),this.path=w5.join(this.dirname||"",e+(this.extname||""))}fail(e,t,n){const r=this.message(e,t,n);throw r.fatal=!0,r}info(e,t,n){const r=this.message(e,t,n);return r.fatal=void 0,r}message(e,t,n){const r=new w2(e,t,n);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){if(void 0===this.value)return"";if("string"===typeof this.value)return this.value;return new TextDecoder(e||void 0).decode(this.value)}}function I5(e,t){if(e&&e.includes(w5.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+w5.sep+"`")}function k5(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function M5(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}const R5=function(e){const t=this.constructor.prototype,n=t[e],r=function(){return n.apply(r,arguments)};return Object.setPrototypeOf(r,t),r},O5={}.hasOwnProperty;class L5 extends R5{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=b5()}copy(){const e=new L5;let t=-1;for(;++t<this.attachers.length;){const n=this.attachers[t];e.use(...n)}return e.data(v5(!0,{},this.namespace)),e}data(e,t){return"string"===typeof e?2===arguments.length?(F5("data",this.frozen),this.namespace[e]=t,this):O5.call(this.namespace,e)&&this.namespace[e]||void 0:e?(F5("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...n]=this.attachers[this.freezeIndex];if(!1===n[0])continue;!0===n[0]&&(n[0]=void 0);const r=t.call(e,...n);"function"===typeof r&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=U5(e),n=this.parser||this.Parser;return N5("parse",n),n(String(t),t)}process(e,t){const n=this;return this.freeze(),N5("process",this.parser||this.Parser),z5("process",this.compiler||this.Compiler),t?r(void 0,t):new Promise(r);function r(r,i){const o=U5(e),s=n.parse(o);function a(e,n){e||!n?i(e):r?r(n):t(void 0,n)}n.run(s,o,function(e,t,r){if(e||!t||!r)return a(e);const i=t,o=n.stringify(i,r);!function(e){return"string"===typeof e||function(e){return Boolean(e&&"object"===typeof e&&"byteLength"in e&&"byteOffset"in e)}(e)}(o)?r.result=o:r.value=o,a(e,r)})}}processSync(e){let t,n=!1;return this.freeze(),N5("processSync",this.parser||this.Parser),z5("processSync",this.compiler||this.Compiler),this.process(e,function(e,r){n=!0,y5(e),t=r}),j5("processSync","process",n),t}run(e,t,n){B5(e),this.freeze();const r=this.transformers;return n||"function"!==typeof t||(n=t,t=void 0),n?i(void 0,n):new Promise(i);function i(i,o){const s=U5(t);r.run(e,s,function(t,r,s){const a=r||e;t?o(t):i?i(a):n(void 0,a,s)})}}runSync(e,t){let n,r=!1;return this.run(e,t,function(e,t){y5(e),n=t,r=!0}),j5("runSync","run",r),n}stringify(e,t){this.freeze();const n=U5(t),r=this.compiler||this.Compiler;return z5("stringify",r),B5(e),r(e,n)}use(e){const t=this.attachers,n=this.namespace;if(F5("use",this.frozen),null===e||void 0===e);else if("function"===typeof e){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];c(e,i)}else{if("object"!==typeof e)throw new TypeError("Expected usable value, not `"+e+"`");Array.isArray(e)?l(e):a(e)}return this;function s(e){if("function"===typeof e)c(e,[]);else{if("object"!==typeof e)throw new TypeError("Expected usable value, not `"+e+"`");if(Array.isArray(e)){const[t,...n]=e;c(t,n)}else a(e)}}function a(e){if(!("plugins"in e)&&!("settings"in e))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");l(e.plugins),e.settings&&(n.settings=v5(!0,n.settings,e.settings))}function l(e){let t=-1;if(null===e||void 0===e);else{if(!Array.isArray(e))throw new TypeError("Expected a list of plugins, not `"+e+"`");for(;++t<e.length;){s(e[t])}}}function c(e,n){let r=-1,i=-1;for(;++r<t.length;)if(t[r][0]===e){i=r;break}if(-1===i)t.push([e,...n]);else if(n.length>0){let[r,...o]=n;const s=t[i][1];x5(s)&&x5(r)&&(r=v5(!0,s,r)),t[i]=[e,r,...o]}}}}const D5=(new L5).freeze();function N5(e,t){if("function"!==typeof t)throw new TypeError("Cannot `"+e+"` without `parser`")}function z5(e,t){if("function"!==typeof t)throw new TypeError("Cannot `"+e+"` without `compiler`")}function F5(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function B5(e){if(!x5(e)||"string"!==typeof e.type)throw new TypeError("Expected node, got `"+e+"`")}function j5(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function U5(e){return function(e){return Boolean(e&&"object"===typeof e&&"message"in e&&"messages"in e)}(e)?e:new P5(e)}const V5=[],G5={allowDangerousHtml:!0},H5=/^(https?|ircs?|mailto|xmpp)$/i,$5=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function W5(e){const t=q5(e),n=X5(e);return Z5(t.runSync(t.parse(n),n),e)}function q5(e){const t=e.rehypePlugins||V5,n=e.remarkPlugins||V5,r=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...G5}:G5;return D5().use(D4).use(n).use(_5,r).use(t)}function X5(e){const t=e.children||"",n=new P5;return"string"===typeof t&&(n.value=t),n}function Z5(e,t){const n=t.allowedElements,r=t.allowElement,i=t.components,o=t.disallowedElements,s=t.skipHtml,a=t.unwrapDisallowed,l=t.urlTransform||K5;for(const c of $5)Object.hasOwn(t,c.from)&&P1((c.from,c.to&&c.to,c.id));return n5(e,function(e,t,i){if("raw"===e.type&&i&&"number"===typeof t)return s?i.children.splice(t,1):i.children[t]={type:"text",value:e.value},t;if("element"===e.type){let t;for(t in B2)if(Object.hasOwn(B2,t)&&Object.hasOwn(e.properties,t)){const n=e.properties[t],r=B2[t];(null===r||r.includes(e.tagName))&&(e.properties[t]=l(String(n||""),t,e))}}if("element"===e.type){let s=n?!n.includes(e.tagName):!!o&&o.includes(e.tagName);if(!s&&r&&"number"===typeof t&&(s=!r(e,t,i)),s&&i&&"number"===typeof t)return a&&e.children?i.children.splice(t,1,...e.children):i.children.splice(t,1),t}}),I2(e,{Fragment:jr.Fragment,components:i,ignoreInvalidStyle:!0,jsx:jr.jsx,jsxs:jr.jsxs,passKeys:!0,passNode:!0})}function K5(e){const t=e.indexOf(":"),n=e.indexOf("?"),r=e.indexOf("#"),i=e.indexOf("/");return-1===t||-1!==i&&t>i||-1!==n&&t>n||-1!==r&&t>r||H5.test(e.slice(0,t))?e:""}function Y5(e,t){const n=String(e);if("string"!==typeof t)throw new TypeError("Expected character");let r=0,i=n.indexOf(t);for(;-1!==i;)r++,i=n.indexOf(t,i+t.length);return r}function J5(e,t,n){const r=X4((n||{}).ignore||[]),i=function(e){const t=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!e[0]||Array.isArray(e[0])?e:[e];let r=-1;for(;++r<n.length;){const e=n[r];t.push([Q5(e[0]),e6(e[1])])}return t}(t);let o=-1;for(;++o<i.length;)t5(e,"text",s);function s(e,t){let n,s=-1;for(;++s<t.length;){const e=t[s],i=n?n.children:void 0;if(r(e,i?i.indexOf(e):void 0,n))return;n=e}if(n)return function(e,t){const n=t[t.length-1],r=i[o][0],s=i[o][1];let a=0;const l=n.children.indexOf(e);let c=!1,u=[];r.lastIndex=0;let h=r.exec(e.value);for(;h;){const n=h.index,i={index:h.index,input:h.input,stack:[...t,e]};let o=s(...h,i);if("string"===typeof o&&(o=o.length>0?{type:"text",value:o}:void 0),!1===o?r.lastIndex=n+1:(a!==n&&u.push({type:"text",value:e.value.slice(a,n)}),Array.isArray(o)?u.push(...o):o&&u.push(o),a=n+h[0].length,c=!0),!r.global)break;h=r.exec(e.value)}c?(a<e.value.length&&u.push({type:"text",value:e.value.slice(a)}),n.children.splice(l,1,...u)):u=[e];return l+u.length}(e,t)}}function Q5(e){return"string"===typeof e?new RegExp(function(e){if("string"!==typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(e),"g"):e}function e6(e){return"function"===typeof e?e:function(){return e}}const t6="phrasing",n6=["autolink","link","image","label"];function r6(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function i6(e){this.config.enter.autolinkProtocol.call(this,e)}function o6(e){this.config.exit.autolinkProtocol.call(this,e)}function s6(e){this.config.exit.data.call(this,e);const t=this.stack[this.stack.length-1];t.type,t.url="http://"+this.sliceSerialize(e)}function a6(e){this.config.exit.autolinkEmail.call(this,e)}function l6(e){this.exit(e)}function c6(e){J5(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,u6],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,h6]],{ignore:["link","linkReference"]})}function u6(e,t,n,r,i){let o="";if(!d6(i))return!1;if(/^w/i.test(t)&&(n=t+n,t="",o="http://"),!function(e){const t=e.split(".");if(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))return!1;return!0}(n))return!1;const s=function(e){const t=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!t)return[e,void 0];e=e.slice(0,t.index);let n=t[0],r=n.indexOf(")");const i=Y5(e,"(");let o=Y5(e,")");for(;-1!==r&&i>o;)e+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),o++;return[e,n]}(n+r);if(!s[0])return!1;const a={type:"link",title:null,url:o+t+s[0],children:[{type:"text",value:t+s[0]}]};return s[1]?[a,{type:"text",value:s[1]}]:a}function h6(e,t,n,r){return!(!d6(r,!0)||/[-\d_]$/.test(n))&&{type:"link",title:null,url:"mailto:"+t+"@"+n,children:[{type:"text",value:t+"@"+n}]}}function d6(e,t){const n=e.input.charCodeAt(e.index-1);return(0===e.index||h3(n)||u3(n))&&(!t||47!==n)}function f6(){this.buffer()}function p6(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function m6(){this.buffer()}function g6(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function _6(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=N3(this.sliceSerialize(e)).toLowerCase(),n.label=t}function y6(e){this.exit(e)}function v6(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=N3(this.sliceSerialize(e)).toLowerCase(),n.label=t}function x6(e){this.exit(e)}function b6(e,t,n,r){const i=n.createTracker(r);let o=i.move("[^");const s=n.enter("footnoteReference"),a=n.enter("reference");return o+=i.move(n.safe(n.associationId(e),{after:"]",before:o})),a(),s(),o+=i.move("]"),o}function w6(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:function(e,n,r,i){const o=r.createTracker(i);let s=o.move("[^");const a=r.enter("footnoteDefinition"),l=r.enter("label");s+=o.move(r.safe(r.associationId(e),{before:s,after:"]"})),l(),s+=o.move("]:"),e.children&&e.children.length>0&&(o.shift(4),s+=o.move((t?"\n":" ")+r.indentLines(r.containerFlow(e,o.current()),t?E6:S6)));return a(),s},footnoteReference:b6},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]}}function S6(e,t,n){return 0===t?e:E6(e,t,n)}function E6(e,t,n){return(n?"":"    ")+e}b6.peek=function(){return"["};const T6=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];function A6(e){this.enter({type:"delete",children:[]},e)}function C6(e){this.exit(e)}function P6(e,t,n,r){const i=n.createTracker(r),o=n.enter("strikethrough");let s=i.move("~~");return s+=n.containerPhrasing(e,{...i.current(),before:s,after:"~"}),s+=i.move("~~"),o(),s}function I6(e){return e.length}function k6(e){return null===e||void 0===e?"":String(e)}function M6(e){const t="string"===typeof e?e.codePointAt(0):0;return 67===t||99===t?99:76===t||108===t?108:82===t||114===t?114:0}function R6(e,t,n){return">"+(n?"":" ")+e}function O6(e,t){return L6(e,t.inConstruct,!0)&&!L6(e,t.notInConstruct,!1)}function L6(e,t,n){if("string"===typeof t&&(t=[t]),!t||0===t.length)return n;let r=-1;for(;++r<t.length;)if(e.includes(t[r]))return!0;return!1}function D6(e,t,n,r){let i=-1;for(;++i<n.unsafe.length;)if("\n"===n.unsafe[i].character&&O6(n.stack,n.unsafe[i]))return/[ \t]/.test(r.before)?"":" ";return"\\\n"}function N6(e,t,n){return(n?"":"    ")+e}function z6(e){const t=e.options.quote||'"';if('"'!==t&&"'"!==t)throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function F6(e){return"&#x"+e.toString(16).toUpperCase()+";"}function B6(e,t,n){const r=a4(e),i=a4(t);return void 0===r?void 0===i?"_"===n?{inside:!0,outside:!0}:{inside:!1,outside:!1}:1===i?{inside:!0,outside:!0}:{inside:!1,outside:!0}:1===r?void 0===i?{inside:!1,outside:!1}:1===i?{inside:!0,outside:!0}:{inside:!1,outside:!1}:void 0===i?{inside:!1,outside:!1}:1===i?{inside:!0,outside:!1}:{inside:!1,outside:!1}}function j6(e,t,n,r){const i=function(e){const t=e.options.emphasis||"*";if("*"!==t&&"_"!==t)throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}(n),o=n.enter("emphasis"),s=n.createTracker(r),a=s.move(i);let l=s.move(n.containerPhrasing(e,{after:i,before:a,...s.current()}));const c=l.charCodeAt(0),u=B6(r.before.charCodeAt(r.before.length-1),c,i);u.inside&&(l=F6(c)+l.slice(1));const h=l.charCodeAt(l.length-1),d=B6(r.after.charCodeAt(0),h,i);d.inside&&(l=l.slice(0,-1)+F6(h));const f=s.move(i);return o(),n.attentionEncodeSurroundingInfo={after:d.outside,before:u.outside},a+l+f}function U6(e){return e.value||""}function V6(e,t,n,r){const i=z6(n),o='"'===i?"Quote":"Apostrophe",s=n.enter("image");let a=n.enter("label");const l=n.createTracker(r);let c=l.move("![");return c+=l.move(n.safe(e.alt,{before:c,after:"]",...l.current()})),c+=l.move("]("),a(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(a=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(e.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=n.enter("destinationRaw"),c+=l.move(n.safe(e.url,{before:c,after:e.title?" ":")",...l.current()}))),a(),e.title&&(a=n.enter(`title${o}`),c+=l.move(" "+i),c+=l.move(n.safe(e.title,{before:c,after:i,...l.current()})),c+=l.move(i),a()),c+=l.move(")"),s(),c}function G6(e,t,n,r){const i=e.referenceType,o=n.enter("imageReference");let s=n.enter("label");const a=n.createTracker(r);let l=a.move("![");const c=n.safe(e.alt,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),s();const u=n.stack;n.stack=[],s=n.enter("reference");const h=n.safe(n.associationId(e),{before:l,after:"]",...a.current()});return s(),n.stack=u,o(),"full"!==i&&c&&c===h?"shortcut"===i?l=l.slice(0,-1):l+=a.move("]"):l+=a.move(h+"]"),l}function H6(e,t,n){let r=e.value||"",i="`",o=-1;for(;new RegExp("(^|[^`])"+i+"([^`]|$)").test(r);)i+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++o<n.unsafe.length;){const e=n.unsafe[o],t=n.compilePattern(e);let i;if(e.atBreak)for(;i=t.exec(r);){let e=i.index;10===r.charCodeAt(e)&&13===r.charCodeAt(e-1)&&e--,r=r.slice(0,e)+" "+r.slice(i.index+1)}}return i+r+i}function $6(e,t){const n=U2(e);return Boolean(!t.options.resourceLink&&e.url&&!e.title&&e.children&&1===e.children.length&&"text"===e.children[0].type&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}function W6(e,t,n,r){const i=z6(n),o='"'===i?"Quote":"Apostrophe",s=n.createTracker(r);let a,l;if($6(e,n)){const t=n.stack;n.stack=[],a=n.enter("autolink");let r=s.move("<");return r+=s.move(n.containerPhrasing(e,{before:r,after:">",...s.current()})),r+=s.move(">"),a(),n.stack=t,r}a=n.enter("link"),l=n.enter("label");let c=s.move("[");return c+=s.move(n.containerPhrasing(e,{before:c,after:"](",...s.current()})),c+=s.move("]("),l(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(l=n.enter("destinationLiteral"),c+=s.move("<"),c+=s.move(n.safe(e.url,{before:c,after:">",...s.current()})),c+=s.move(">")):(l=n.enter("destinationRaw"),c+=s.move(n.safe(e.url,{before:c,after:e.title?" ":")",...s.current()}))),l(),e.title&&(l=n.enter(`title${o}`),c+=s.move(" "+i),c+=s.move(n.safe(e.title,{before:c,after:i,...s.current()})),c+=s.move(i),l()),c+=s.move(")"),a(),c}function q6(e,t,n,r){const i=e.referenceType,o=n.enter("linkReference");let s=n.enter("label");const a=n.createTracker(r);let l=a.move("[");const c=n.containerPhrasing(e,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),s();const u=n.stack;n.stack=[],s=n.enter("reference");const h=n.safe(n.associationId(e),{before:l,after:"]",...a.current()});return s(),n.stack=u,o(),"full"!==i&&c&&c===h?"shortcut"===i?l=l.slice(0,-1):l+=a.move("]"):l+=a.move(h+"]"),l}function X6(e){const t=e.options.bullet||"*";if("*"!==t&&"+"!==t&&"-"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function Z6(e){const t=e.options.rule||"*";if("*"!==t&&"-"!==t&&"_"!==t)throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}P6.peek=function(){return"~"},j6.peek=function(e,t,n){return n.options.emphasis||"*"},U6.peek=function(){return"<"},V6.peek=function(){return"!"},G6.peek=function(){return"!"},H6.peek=function(){return"`"},W6.peek=function(e,t,n){return $6(e,n)?"<":"["},q6.peek=function(){return"["};const K6=X4(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function Y6(e,t,n,r){const i=function(e){const t=e.options.strong||"*";if("*"!==t&&"_"!==t)throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}(n),o=n.enter("strong"),s=n.createTracker(r),a=s.move(i+i);let l=s.move(n.containerPhrasing(e,{after:i,before:a,...s.current()}));const c=l.charCodeAt(0),u=B6(r.before.charCodeAt(r.before.length-1),c,i);u.inside&&(l=F6(c)+l.slice(1));const h=l.charCodeAt(l.length-1),d=B6(r.after.charCodeAt(0),h,i);d.inside&&(l=l.slice(0,-1)+F6(h));const f=s.move(i+i);return o(),n.attentionEncodeSurroundingInfo={after:d.outside,before:u.outside},a+l+f}Y6.peek=function(e,t,n){return n.options.strong||"*"};const J6={blockquote:function(e,t,n,r){const i=n.enter("blockquote"),o=n.createTracker(r);o.move("> "),o.shift(2);const s=n.indentLines(n.containerFlow(e,o.current()),R6);return i(),s},break:D6,code:function(e,t,n,r){const i=function(e){const t=e.options.fence||"`";if("`"!==t&&"~"!==t)throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}(n),o=e.value||"",s="`"===i?"GraveAccent":"Tilde";if(function(e,t){return Boolean(!1===t.options.fences&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}(e,n)){const e=n.enter("codeIndented"),t=n.indentLines(o,N6);return e(),t}const a=n.createTracker(r),l=i.repeat(Math.max(function(e,t){const n=String(e);let r=n.indexOf(t),i=r,o=0,s=0;if("string"!==typeof t)throw new TypeError("Expected substring");for(;-1!==r;)r===i?++o>s&&(s=o):o=1,i=r+t.length,r=n.indexOf(t,i);return s}(o,i)+1,3)),c=n.enter("codeFenced");let u=a.move(l);if(e.lang){const t=n.enter(`codeFencedLang${s}`);u+=a.move(n.safe(e.lang,{before:u,after:" ",encode:["`"],...a.current()})),t()}if(e.lang&&e.meta){const t=n.enter(`codeFencedMeta${s}`);u+=a.move(" "),u+=a.move(n.safe(e.meta,{before:u,after:"\n",encode:["`"],...a.current()})),t()}return u+=a.move("\n"),o&&(u+=a.move(o+"\n")),u+=a.move(l),c(),u},definition:function(e,t,n,r){const i=z6(n),o='"'===i?"Quote":"Apostrophe",s=n.enter("definition");let a=n.enter("label");const l=n.createTracker(r);let c=l.move("[");return c+=l.move(n.safe(n.associationId(e),{before:c,after:"]",...l.current()})),c+=l.move("]: "),a(),!e.url||/[\0- \u007F]/.test(e.url)?(a=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(e.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=n.enter("destinationRaw"),c+=l.move(n.safe(e.url,{before:c,after:e.title?" ":"\n",...l.current()}))),a(),e.title&&(a=n.enter(`title${o}`),c+=l.move(" "+i),c+=l.move(n.safe(e.title,{before:c,after:i,...l.current()})),c+=l.move(i),a()),s(),c},emphasis:j6,hardBreak:D6,heading:function(e,t,n,r){const i=Math.max(Math.min(6,e.depth||1),1),o=n.createTracker(r);if(function(e,t){let n=!1;return n5(e,function(e){if("value"in e&&/\r?\n|\r/.test(e.value)||"break"===e.type)return n=!0,e5}),Boolean((!e.depth||e.depth<3)&&U2(e)&&(t.options.setext||n))}(e,n)){const t=n.enter("headingSetext"),r=n.enter("phrasing"),s=n.containerPhrasing(e,{...o.current(),before:"\n",after:"\n"});return r(),t(),s+"\n"+(1===i?"=":"-").repeat(s.length-(Math.max(s.lastIndexOf("\r"),s.lastIndexOf("\n"))+1))}const s="#".repeat(i),a=n.enter("headingAtx"),l=n.enter("phrasing");o.move(s+" ");let c=n.containerPhrasing(e,{before:"# ",after:"\n",...o.current()});return/^[\t ]/.test(c)&&(c=F6(c.charCodeAt(0))+c.slice(1)),c=c?s+" "+c:s,n.options.closeAtx&&(c+=" "+s),l(),a(),c},html:U6,image:V6,imageReference:G6,inlineCode:H6,link:W6,linkReference:q6,list:function(e,t,n,r){const i=n.enter("list"),o=n.bulletCurrent;let s=e.ordered?function(e){const t=e.options.bulletOrdered||".";if("."!==t&&")"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}(n):X6(n);const a=e.ordered?"."===s?")":".":function(e){const t=X6(e),n=e.options.bulletOther;if(!n)return"*"===t?"-":"*";if("*"!==n&&"+"!==n&&"-"!==n)throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}(n);let l=!(!t||!n.bulletLastUsed)&&s===n.bulletLastUsed;if(!e.ordered){const t=e.children?e.children[0]:void 0;if("*"!==s&&"-"!==s||!t||t.children&&t.children[0]||"list"!==n.stack[n.stack.length-1]||"listItem"!==n.stack[n.stack.length-2]||"list"!==n.stack[n.stack.length-3]||"listItem"!==n.stack[n.stack.length-4]||0!==n.indexStack[n.indexStack.length-1]||0!==n.indexStack[n.indexStack.length-2]||0!==n.indexStack[n.indexStack.length-3]||(l=!0),Z6(n)===s&&t){let t=-1;for(;++t<e.children.length;){const n=e.children[t];if(n&&"listItem"===n.type&&n.children&&n.children[0]&&"thematicBreak"===n.children[0].type){l=!0;break}}}}l&&(s=a),n.bulletCurrent=s;const c=n.containerFlow(e,r);return n.bulletLastUsed=s,n.bulletCurrent=o,i(),c},listItem:function(e,t,n,r){const i=function(e){const t=e.options.listItemIndent||"one";if("tab"!==t&&"one"!==t&&"mixed"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}(n);let o=n.bulletCurrent||X6(n);t&&"list"===t.type&&t.ordered&&(o=("number"===typeof t.start&&t.start>-1?t.start:1)+(!1===n.options.incrementListMarker?0:t.children.indexOf(e))+o);let s=o.length+1;("tab"===i||"mixed"===i&&(t&&"list"===t.type&&t.spread||e.spread))&&(s=4*Math.ceil(s/4));const a=n.createTracker(r);a.move(o+" ".repeat(s-o.length)),a.shift(s);const l=n.enter("listItem"),c=n.indentLines(n.containerFlow(e,a.current()),function(e,t,n){if(t)return(n?"":" ".repeat(s))+e;return(n?o:o+" ".repeat(s-o.length))+e});return l(),c},paragraph:function(e,t,n,r){const i=n.enter("paragraph"),o=n.enter("phrasing"),s=n.containerPhrasing(e,r);return o(),i(),s},root:function(e,t,n,r){const i=e.children.some(function(e){return K6(e)});return(i?n.containerPhrasing:n.containerFlow).call(n,e,r)},strong:Y6,text:function(e,t,n,r){return n.safe(e.value,r)},thematicBreak:function(e,t,n){const r=(Z6(n)+(n.options.ruleSpaces?" ":"")).repeat(function(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}(n));return n.options.ruleSpaces?r.slice(0,-1):r}};function Q6(e){const t=e._align;this.enter({type:"table",align:t.map(function(e){return"none"===e?null:e}),children:[]},e),this.data.inTable=!0}function e8(e){this.exit(e),this.data.inTable=void 0}function t8(e){this.enter({type:"tableRow",children:[]},e)}function n8(e){this.exit(e)}function r8(e){this.enter({type:"tableCell",children:[]},e)}function i8(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,o8));const n=this.stack[this.stack.length-1];n.type,n.value=t,this.exit(e)}function o8(e,t){return"|"===t?t:e}function s8(e){const t=e||{},n=t.tableCellPadding,r=t.tablePipeAlign,i=t.stringLength,o=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:"\n",inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[\t :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:function(e,t,n){let r=J6.inlineCode(e,t,n);n.stack.includes("tableCell")&&(r=r.replace(/\|/g,"\\$&"));return r},table:function(e,t,n,r){return a(function(e,t,n){const r=e.children;let i=-1;const o=[],s=t.enter("table");for(;++i<r.length;)o[i]=l(r[i],t,n);return s(),o}(e,n,r),e.align)},tableCell:s,tableRow:function(e,t,n,r){const i=a([l(e,n,r)]);return i.slice(0,i.indexOf("\n"))}}};function s(e,t,n,r){const i=n.enter("tableCell"),s=n.enter("phrasing"),a=n.containerPhrasing(e,{...r,before:o,after:o});return s(),i(),a}function a(e,t){return function(e,t){const n=t||{},r=(n.align||[]).concat(),i=n.stringLength||I6,o=[],s=[],a=[],l=[];let c=0,u=-1;for(;++u<e.length;){const t=[],r=[];let o=-1;for(e[u].length>c&&(c=e[u].length);++o<e[u].length;){const s=k6(e[u][o]);if(!1!==n.alignDelimiters){const e=i(s);r[o]=e,(void 0===l[o]||e>l[o])&&(l[o]=e)}t.push(s)}s[u]=t,a[u]=r}let h=-1;if("object"===typeof r&&"length"in r)for(;++h<c;)o[h]=M6(r[h]);else{const e=M6(r);for(;++h<c;)o[h]=e}h=-1;const d=[],f=[];for(;++h<c;){const e=o[h];let t="",r="";99===e?(t=":",r=":"):108===e?t=":":114===e&&(r=":");let i=!1===n.alignDelimiters?1:Math.max(1,l[h]-t.length-r.length);const s=t+"-".repeat(i)+r;!1!==n.alignDelimiters&&(i=t.length+i+r.length,i>l[h]&&(l[h]=i),f[h]=i),d[h]=s}s.splice(1,0,d),a.splice(1,0,f),u=-1;const p=[];for(;++u<s.length;){const e=s[u],t=a[u];h=-1;const r=[];for(;++h<c;){const i=e[h]||"";let s="",a="";if(!1!==n.alignDelimiters){const e=l[h]-(t[h]||0),n=o[h];114===n?s=" ".repeat(e):99===n?e%2?(s=" ".repeat(e/2+.5),a=" ".repeat(e/2-.5)):(s=" ".repeat(e/2),a=s):a=" ".repeat(e)}!1===n.delimiterStart||h||r.push("|"),!1===n.padding||!1===n.alignDelimiters&&""===i||!1===n.delimiterStart&&!h||r.push(" "),!1!==n.alignDelimiters&&r.push(s),r.push(i),!1!==n.alignDelimiters&&r.push(a),!1!==n.padding&&r.push(" "),!1===n.delimiterEnd&&h===c-1||r.push("|")}p.push(!1===n.delimiterEnd?r.join("").replace(/ +$/,""):r.join(""))}return p.join("\n")}(e,{align:t,alignDelimiters:r,padding:n,stringLength:i})}function l(e,t,n){const r=e.children;let i=-1;const o=[],a=t.enter("tableRow");for(;++i<r.length;)o[i]=s(r[i],0,t,n);return a(),o}}function a8(e){const t=this.stack[this.stack.length-2];t.type,t.checked="taskListCheckValueChecked"===e.type}function l8(e){const t=this.stack[this.stack.length-2];if(t&&"listItem"===t.type&&"boolean"===typeof t.checked){const e=this.stack[this.stack.length-1];e.type;const n=e.children[0];if(n&&"text"===n.type){const r=t.children;let i,o=-1;for(;++o<r.length;){const e=r[o];if("paragraph"===e.type){i=e;break}}i===e&&(n.value=n.value.slice(1),0===n.value.length?e.children.shift():e.position&&n.position&&"number"===typeof n.position.start.offset&&(n.position.start.column++,n.position.start.offset++,e.position.start=Object.assign({},n.position.start)))}}this.exit(e)}function c8(e,t,n,r){const i=e.children[0],o="boolean"===typeof e.checked&&i&&"paragraph"===i.type,s="["+(e.checked?"x":" ")+"] ",a=n.createTracker(r);o&&a.move(s);let l=J6.listItem(e,t,n,{...r,...a.current()});return o&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,function(e){return e+s})),l}const u8={tokenize:function(e,t,n){let r=0;return function t(o){if((87===o||119===o)&&r<3)return r++,e.consume(o),t;if(46===o&&3===r)return e.consume(o),i;return n(o)};function i(e){return null===e?n(e):t(e)}},partial:!0},h8={tokenize:function(e,t,n){let r,i,o;return s;function s(t){return 46===t||95===t?e.check(f8,l,a)(t):null===t||l3(t)||h3(t)||45!==t&&u3(t)?l(t):(o=!0,e.consume(t),s)}function a(t){return 95===t?r=!0:(i=r,r=void 0),e.consume(t),s}function l(e){return i||r||!o?n(e):t(e)}},partial:!0},d8={tokenize:function(e,t){let n=0,r=0;return i;function i(s){return 40===s?(n++,e.consume(s),i):41===s&&r<n?o(s):33===s||34===s||38===s||39===s||41===s||42===s||44===s||46===s||58===s||59===s||60===s||63===s||93===s||95===s||126===s?e.check(f8,t,o)(s):null===s||l3(s)||h3(s)?t(s):(e.consume(s),i)}function o(t){return 41===t&&r++,e.consume(t),i}},partial:!0},f8={tokenize:function(e,t,n){return r;function r(s){return 33===s||34===s||39===s||41===s||42===s||44===s||46===s||58===s||59===s||63===s||95===s||126===s?(e.consume(s),r):38===s?(e.consume(s),o):93===s?(e.consume(s),i):60===s||null===s||l3(s)||h3(s)?t(s):n(s)}function i(e){return null===e||40===e||91===e||l3(e)||h3(e)?t(e):r(e)}function o(e){return e3(e)?s(e):n(e)}function s(t){return 59===t?(e.consume(t),r):e3(t)?(e.consume(t),s):n(t)}},partial:!0},p8={tokenize:function(e,t,n){return function(t){return e.consume(t),r};function r(e){return t3(e)?n(e):t(e)}},partial:!0},m8={name:"wwwAutolink",tokenize:function(e,t,n){const r=this;return function(t){if(87!==t&&119!==t||!x8.call(r,r.previous)||E8(r.events))return n(t);return e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(u8,e.attempt(h8,e.attempt(d8,i),n),n)(t)};function i(n){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),t(n)}},previous:x8},g8={name:"protocolAutolink",tokenize:function(e,t,n){const r=this;let i="",o=!1;return function(t){if((72===t||104===t)&&b8.call(r,r.previous)&&!E8(r.events))return e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),i+=String.fromCodePoint(t),e.consume(t),s;return n(t)};function s(t){if(e3(t)&&i.length<5)return i+=String.fromCodePoint(t),e.consume(t),s;if(58===t){const n=i.toLowerCase();if("http"===n||"https"===n)return e.consume(t),a}return n(t)}function a(t){return 47===t?(e.consume(t),o?l:(o=!0,a)):n(t)}function l(t){return null===t||r3(t)||l3(t)||h3(t)||u3(t)?n(t):e.attempt(h8,e.attempt(d8,c),n)(t)}function c(n){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),t(n)}},previous:b8},_8={name:"emailAutolink",tokenize:function(e,t,n){const r=this;let i,o;return function(t){if(!S8(t)||!w8.call(r,r.previous)||E8(r.events))return n(t);return e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),s(t)};function s(t){return S8(t)?(e.consume(t),s):64===t?(e.consume(t),a):n(t)}function a(t){return 46===t?e.check(p8,c,l)(t):45===t||95===t||t3(t)?(o=!0,e.consume(t),a):c(t)}function l(t){return e.consume(t),i=!0,a}function c(s){return o&&i&&e3(r.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),t(s)):n(s)}},previous:w8},y8={};let v8=48;for(;v8<123;)y8[v8]=_8,v8++,58===v8?v8=65:91===v8&&(v8=97);function x8(e){return null===e||40===e||42===e||95===e||91===e||93===e||126===e||l3(e)}function b8(e){return!e3(e)}function w8(e){return!(47===e||S8(e))}function S8(e){return 43===e||45===e||46===e||95===e||t3(e)}function E8(e){let t=e.length,n=!1;for(;t--;){const r=e[t][1];if(("labelLink"===r.type||"labelImage"===r.type)&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return e.length>0&&!n&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}y8[43]=_8,y8[45]=_8,y8[46]=_8,y8[95]=_8,y8[72]=[_8,g8],y8[104]=[_8,g8],y8[87]=[_8,m8],y8[119]=[_8,m8];const T8={tokenize:function(e,t,n){const r=this;return f3(e,function(e){const i=r.events[r.events.length-1];return i&&"gfmFootnoteDefinitionIndent"===i[1].type&&4===i[2].sliceSerialize(i[1],!0).length?t(e):n(e)},"gfmFootnoteDefinitionIndent",5)},partial:!0};function A8(e,t,n){const r=this;let i=r.events.length;const o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s;for(;i--;){const e=r.events[i][1];if("labelImage"===e.type){s=e;break}if("gfmFootnoteCall"===e.type||"labelLink"===e.type||"label"===e.type||"image"===e.type||"link"===e.type)break}return function(i){if(!s||!s._balanced)return n(i);const a=N3(r.sliceSerialize({start:s.end,end:r.now()}));if(94!==a.codePointAt(0)||!o.includes(a.slice(1)))return n(i);return e.enter("gfmFootnoteCallLabelMarker"),e.consume(i),e.exit("gfmFootnoteCallLabelMarker"),t(i)}}function C8(e,t){let n,r=e.length;for(;r--;)if("labelImage"===e[r][1].type&&"enter"===e[r][0]){n=e[r][1];break}e[r+1][1].type="data",e[r+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},e[r+3][1].start),end:Object.assign({},e[e.length-1][1].end)},o={type:"gfmFootnoteCallMarker",start:Object.assign({},e[r+3][1].end),end:Object.assign({},e[r+3][1].end)};o.end.column++,o.end.offset++,o.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},o.end),end:Object.assign({},e[e.length-1][1].start)},a={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},l=[e[r+1],e[r+2],["enter",i,t],e[r+3],e[r+4],["enter",o,t],["exit",o,t],["enter",s,t],["enter",a,t],["exit",a,t],["exit",s,t],e[e.length-2],e[e.length-1],["exit",i,t]];return e.splice(r,e.length-r+1,...l),e}function P8(e,t,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o,s=0;return function(t){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(t),e.exit("gfmFootnoteCallLabelMarker"),a};function a(t){return 94!==t?n(t):(e.enter("gfmFootnoteCallMarker"),e.consume(t),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",l)}function l(a){if(s>999||93===a&&!o||null===a||91===a||l3(a))return n(a);if(93===a){e.exit("chunkString");const o=e.exit("gfmFootnoteCallString");return i.includes(N3(r.sliceSerialize(o)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(a),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):n(a)}return l3(a)||(o=!0),s++,e.consume(a),92===a?c:l}function c(t){return 91===t||92===t||93===t?(e.consume(t),s++,l):l(t)}}function I8(e,t,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o,s,a=0;return function(t){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionLabelMarker"),l};function l(t){return 94===t?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",c):n(t)}function c(t){if(a>999||93===t&&!s||null===t||91===t||l3(t))return n(t);if(93===t){e.exit("chunkString");const n=e.exit("gfmFootnoteDefinitionLabelString");return o=N3(r.sliceSerialize(n)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),h}return l3(t)||(s=!0),a++,e.consume(t),92===t?u:c}function u(t){return 91===t||92===t||93===t?(e.consume(t),a++,c):c(t)}function h(t){return 58===t?(e.enter("definitionMarker"),e.consume(t),e.exit("definitionMarker"),i.includes(o)||i.push(o),f3(e,d,"gfmFootnoteDefinitionWhitespace")):n(t)}function d(e){return t(e)}}function k8(e,t,n){return e.check(_3,t,e.attempt(T8,t,n))}function M8(e){e.exit("gfmFootnoteDefinition")}function R8(e){let t=(e||{}).singleTilde;const n={name:"strikethrough",tokenize:function(e,n,r){const i=this.previous,o=this.events;let s=0;return function(t){if(126===i&&"characterEscape"!==o[o.length-1][1].type)return r(t);return e.enter("strikethroughSequenceTemporary"),a(t)};function a(o){const l=a4(i);if(126===o)return s>1?r(o):(e.consume(o),s++,a);if(s<2&&!t)return r(o);const c=e.exit("strikethroughSequenceTemporary"),u=a4(o);return c._open=!u||2===u&&Boolean(l),c._close=!l||2===l&&Boolean(u),n(o)}},resolveAll:function(e,t){let n=-1;for(;++n<e.length;)if("enter"===e[n][0]&&"strikethroughSequenceTemporary"===e[n][1].type&&e[n][1]._close){let r=n;for(;r--;)if("exit"===e[r][0]&&"strikethroughSequenceTemporary"===e[r][1].type&&e[r][1]._open&&e[n][1].end.offset-e[n][1].start.offset===e[r][1].end.offset-e[r][1].start.offset){e[n][1].type="strikethroughSequence",e[r][1].type="strikethroughSequence";const i={type:"strikethrough",start:Object.assign({},e[r][1].start),end:Object.assign({},e[n][1].end)},o={type:"strikethroughText",start:Object.assign({},e[r][1].end),end:Object.assign({},e[n][1].start)},s=[["enter",i,t],["enter",e[r][1],t],["exit",e[r][1],t],["enter",o,t]],a=t.parser.constructs.insideSpan.null;a&&H2(s,s.length,0,t4(a,e.slice(r+1,n),t)),H2(s,s.length,0,[["exit",o,t],["enter",e[n][1],t],["exit",e[n][1],t],["exit",i,t]]),H2(e,r-1,n-r+3,s),n=r+s.length-2;break}}n=-1;for(;++n<e.length;)"strikethroughSequenceTemporary"===e[n][1].type&&(e[n][1].type="data");return e}};return null!==t&&void 0!==t||(t=!0),{text:{126:n},insideSpan:{null:[n]},attentionMarkers:{null:[126]}}}class O8{constructor(){this.map=[]}add(e,t,n){!function(e,t,n,r){let i=0;if(0===n&&0===r.length)return;for(;i<e.map.length;){if(e.map[i][0]===t)return e.map[i][1]+=n,void e.map[i][2].push(...r);i+=1}e.map.push([t,n,r])}(this,e,t,n)}consume(e){if(this.map.sort(function(e,t){return e[0]-t[0]}),0===this.map.length)return;let t=this.map.length;const n=[];for(;t>0;)t-=1,n.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];n.push(e.slice()),e.length=0;let r=n.pop();for(;r;){for(const t of r)e.push(t);r=n.pop()}this.map.length=0}}function L8(e,t){let n=!1;const r=[];for(;t<e.length;){const i=e[t];if(n){if("enter"===i[0])"tableContent"===i[1].type&&r.push("tableDelimiterMarker"===e[t+1][1].type?"left":"none");else if("tableContent"===i[1].type){if("tableDelimiterMarker"===e[t-1][1].type){const e=r.length-1;r[e]="left"===r[e]?"center":"right"}}else if("tableDelimiterRow"===i[1].type)break}else"enter"===i[0]&&"tableDelimiterRow"===i[1].type&&(n=!0);t+=1}return r}function D8(e,t,n){const r=this;let i,o=0,s=0;return function(e){let t=r.events.length-1;for(;t>-1;){const e=r.events[t][1].type;if("lineEnding"!==e&&"linePrefix"!==e)break;t--}const i=t>-1?r.events[t][1].type:null,o="tableHead"===i||"tableRow"===i?x:a;if(o===x&&r.parser.lazy[r.now().line])return n(e);return o(e)};function a(t){return e.enter("tableHead"),e.enter("tableRow"),function(e){if(124===e)return l(e);return i=!0,s+=1,l(e)}(t)}function l(t){return null===t?n(t):a3(t)?s>1?(s=0,r.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),h):n(t):c3(t)?f3(e,l,"whitespace")(t):(s+=1,i&&(i=!1,o+=1),124===t?(e.enter("tableCellDivider"),e.consume(t),e.exit("tableCellDivider"),i=!0,l):(e.enter("data"),c(t)))}function c(t){return null===t||124===t||l3(t)?(e.exit("data"),l(t)):(e.consume(t),92===t?u:c)}function u(t){return 92===t||124===t?(e.consume(t),c):c(t)}function h(t){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(t):(e.enter("tableDelimiterRow"),i=!1,c3(t)?f3(e,d,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):d(t))}function d(t){return 45===t||58===t?p(t):124===t?(i=!0,e.enter("tableCellDivider"),e.consume(t),e.exit("tableCellDivider"),f):v(t)}function f(t){return c3(t)?f3(e,p,"whitespace")(t):p(t)}function p(t){return 58===t?(s+=1,i=!0,e.enter("tableDelimiterMarker"),e.consume(t),e.exit("tableDelimiterMarker"),m):45===t?(s+=1,m(t)):null===t||a3(t)?y(t):v(t)}function m(t){return 45===t?(e.enter("tableDelimiterFiller"),g(t)):v(t)}function g(t){return 45===t?(e.consume(t),g):58===t?(i=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(t),e.exit("tableDelimiterMarker"),_):(e.exit("tableDelimiterFiller"),_(t))}function _(t){return c3(t)?f3(e,y,"whitespace")(t):y(t)}function y(n){return 124===n?d(n):(null===n||a3(n))&&i&&o===s?(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(n)):v(n)}function v(e){return n(e)}function x(t){return e.enter("tableRow"),b(t)}function b(n){return 124===n?(e.enter("tableCellDivider"),e.consume(n),e.exit("tableCellDivider"),b):null===n||a3(n)?(e.exit("tableRow"),t(n)):c3(n)?f3(e,b,"whitespace")(n):(e.enter("data"),w(n))}function w(t){return null===t||124===t||l3(t)?(e.exit("data"),b(t)):(e.consume(t),92===t?S:w)}function S(t){return 92===t||124===t?(e.consume(t),w):w(t)}}function N8(e,t){let n,r,i,o=-1,s=!0,a=0,l=[0,0,0,0],c=[0,0,0,0],u=!1,h=0;const d=new O8;for(;++o<e.length;){const f=e[o],p=f[1];"enter"===f[0]?"tableHead"===p.type?(u=!1,0!==h&&(F8(d,t,h,n,r),r=void 0,h=0),n={type:"table",start:Object.assign({},p.start),end:Object.assign({},p.end)},d.add(o,0,[["enter",n,t]])):"tableRow"===p.type||"tableDelimiterRow"===p.type?(s=!0,i=void 0,l=[0,0,0,0],c=[0,o+1,0,0],u&&(u=!1,r={type:"tableBody",start:Object.assign({},p.start),end:Object.assign({},p.end)},d.add(o,0,[["enter",r,t]])),a="tableDelimiterRow"===p.type?2:r?3:1):!a||"data"!==p.type&&"tableDelimiterMarker"!==p.type&&"tableDelimiterFiller"!==p.type?"tableCellDivider"===p.type&&(s?s=!1:(0!==l[1]&&(c[0]=c[1],i=z8(d,t,l,a,void 0,i)),l=c,c=[l[1],o,0,0])):(s=!1,0===c[2]&&(0!==l[1]&&(c[0]=c[1],i=z8(d,t,l,a,void 0,i),l=[0,0,0,0]),c[2]=o)):"tableHead"===p.type?(u=!0,h=o):"tableRow"===p.type||"tableDelimiterRow"===p.type?(h=o,0!==l[1]?(c[0]=c[1],i=z8(d,t,l,a,o,i)):0!==c[1]&&(i=z8(d,t,c,a,o,i)),a=0):!a||"data"!==p.type&&"tableDelimiterMarker"!==p.type&&"tableDelimiterFiller"!==p.type||(c[3]=o)}for(0!==h&&F8(d,t,h,n,r),d.consume(t.events),o=-1;++o<t.events.length;){const e=t.events[o];"enter"===e[0]&&"table"===e[1].type&&(e[1]._align=L8(t.events,o))}return e}function z8(e,t,n,r,i,o){const s=1===r?"tableHeader":2===r?"tableDelimiter":"tableData";0!==n[0]&&(o.end=Object.assign({},B8(t.events,n[0])),e.add(n[0],0,[["exit",o,t]]));const a=B8(t.events,n[1]);if(o={type:s,start:Object.assign({},a),end:Object.assign({},a)},e.add(n[1],0,[["enter",o,t]]),0!==n[2]){const i=B8(t.events,n[2]),o=B8(t.events,n[3]),s={type:"tableContent",start:Object.assign({},i),end:Object.assign({},o)};if(e.add(n[2],0,[["enter",s,t]]),2!==r){const r=t.events[n[2]],i=t.events[n[3]];if(r[1].end=Object.assign({},i[1].end),r[1].type="chunkText",r[1].contentType="text",n[3]>n[2]+1){const t=n[2]+1,r=n[3]-n[2]-1;e.add(t,r,[])}}e.add(n[3]+1,0,[["exit",s,t]])}return void 0!==i&&(o.end=Object.assign({},B8(t.events,i)),e.add(i,0,[["exit",o,t]]),o=void 0),o}function F8(e,t,n,r,i){const o=[],s=B8(t.events,n);i&&(i.end=Object.assign({},s),o.push(["exit",i,t])),r.end=Object.assign({},s),o.push(["exit",r,t]),e.add(n+1,0,o)}function B8(e,t){const n=e[t],r="enter"===n[0]?"start":"end";return n[1][r]}const j8={name:"tasklistCheck",tokenize:function(e,t,n){const r=this;return function(t){if(null!==r.previous||!r._gfmTasklistFirstContentOfListItem)return n(t);return e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(t),e.exit("taskListCheckMarker"),i};function i(t){return l3(t)?(e.enter("taskListCheckValueUnchecked"),e.consume(t),e.exit("taskListCheckValueUnchecked"),o):88===t||120===t?(e.enter("taskListCheckValueChecked"),e.consume(t),e.exit("taskListCheckValueChecked"),o):n(t)}function o(t){return 93===t?(e.enter("taskListCheckMarker"),e.consume(t),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),s):n(t)}function s(r){return a3(r)?t(r):c3(r)?e.check({tokenize:U8},t,n)(r):n(r)}}};function U8(e,t,n){return f3(e,function(e){return null===e?n(e):t(e)},"whitespace")}const V8={};function G8(e){const t=e||V8,n=this.data(),r=n.micromarkExtensions||(n.micromarkExtensions=[]),i=n.fromMarkdownExtensions||(n.fromMarkdownExtensions=[]),o=n.toMarkdownExtensions||(n.toMarkdownExtensions=[]);r.push(function(e){return Y2([{text:y8},{document:{91:{name:"gfmFootnoteDefinition",tokenize:I8,continuation:{tokenize:k8},exit:M8}},text:{91:{name:"gfmFootnoteCall",tokenize:P8},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:A8,resolveTo:C8}}},R8(e),{flow:{null:{name:"table",tokenize:D8,resolveAll:N8}}},{text:{91:j8}}])}(t)),i.push([{transforms:[c6],enter:{literalAutolink:r6,literalAutolinkEmail:i6,literalAutolinkHttp:i6,literalAutolinkWww:i6},exit:{literalAutolink:l6,literalAutolinkEmail:a6,literalAutolinkHttp:o6,literalAutolinkWww:s6}},{enter:{gfmFootnoteCallString:f6,gfmFootnoteCall:p6,gfmFootnoteDefinitionLabelString:m6,gfmFootnoteDefinition:g6},exit:{gfmFootnoteCallString:_6,gfmFootnoteCall:y6,gfmFootnoteDefinitionLabelString:v6,gfmFootnoteDefinition:x6}},{canContainEols:["delete"],enter:{strikethrough:A6},exit:{strikethrough:C6}},{enter:{table:Q6,tableData:r8,tableHeader:r8,tableRow:t8},exit:{codeText:i8,table:e8,tableData:n8,tableHeader:n8,tableRow:n8}},{exit:{taskListCheckValueChecked:a8,taskListCheckValueUnchecked:a8,paragraph:l8}}]),o.push(function(e){return{extensions:[{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:t6,notInConstruct:n6},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:t6,notInConstruct:n6},{character:":",before:"[ps]",after:"\\/",inConstruct:t6,notInConstruct:n6}]},w6(e),{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:T6}],handlers:{delete:P6}},s8(e),{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:c8}}]}}(t))}const H8=Dr("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),$8=Dr("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),W8=Dr("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),q8=Dr("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),X8=Dr("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Z8=Dr("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),K8=Dr("message-circle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),Y8=Dr("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var J8=["axis","item"],Q8=(0,i.forwardRef)((e,t)=>i.createElement(vZ,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:J8,tooltipPayloadSearcher:bL,categoricalChartProps:e,ref:t})),e7=e=>null;e7.displayName="Cell";var t7="Invariant failed";var n7=n(9397),r7=n.n(n7);function i7(){return i7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i7.apply(null,arguments)}var o7=(e,t,n,r,i)=>{var o,s=n-r;return o="M ".concat(e,",").concat(t),o+="L ".concat(e+n,",").concat(t),o+="L ".concat(e+n-s/2,",").concat(t+i),o+="L ".concat(e+n-s/2-r,",").concat(t+i),o+="L ".concat(e,",").concat(t," Z")},s7={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},a7=e=>{var t=mZ(e,s7),n=(0,i.useRef)(),[r,o]=(0,i.useState)(-1);(0,i.useEffect)(()=>{if(n.current&&n.current.getTotalLength)try{var e=n.current.getTotalLength();e&&o(e)}catch(t){}},[]);var{x:s,y:a,upperWidth:l,lowerWidth:c,height:u,className:h}=t,{animationEasing:d,animationDuration:f,animationBegin:p,isUpdateAnimationActive:m}=t;if(s!==+s||a!==+a||l!==+l||c!==+c||u!==+u||0===l&&0===c||0===u)return null;var g=yi("recharts-trapezoid",h);return m?i.createElement(h0,{canBegin:r>0,from:{upperWidth:0,lowerWidth:0,height:u,x:s,y:a},to:{upperWidth:l,lowerWidth:c,height:u,x:s,y:a},duration:f,animationEasing:d,isActive:m},e=>{var{upperWidth:o,lowerWidth:s,height:a,x:l,y:c}=e;return i.createElement(h0,{canBegin:r>0,from:"0px ".concat(-1===r?1:r,"px"),to:"".concat(r,"px 0px"),attributeName:"strokeDasharray",begin:p,duration:f,easing:d},i.createElement("path",i7({},zX(t,!0),{className:g,d:o7(l,c,o,s,a),ref:n})))}):i.createElement("g",null,i.createElement("path",i7({},zX(t,!0),{className:g,d:o7(s,a,l,c,u)})))};Math.abs,Math.atan2;const l7=Math.cos,c7=(Math.max,Math.min,Math.sin),u7=Math.sqrt,h7=Math.PI,d7=2*h7;const f7={draw(e,t){const n=u7(t/h7);e.moveTo(n,0),e.arc(0,0,n,0,d7)}},p7={draw(e,t){const n=u7(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},m7=u7(1/3),g7=2*m7,_7={draw(e,t){const n=u7(t/g7),r=n*m7;e.moveTo(0,-n),e.lineTo(r,0),e.lineTo(0,n),e.lineTo(-r,0),e.closePath()}},y7={draw(e,t){const n=u7(t),r=-n/2;e.rect(r,r,n,n)}},v7=c7(h7/10)/c7(7*h7/10),x7=c7(d7/10)*v7,b7=-l7(d7/10)*v7,w7={draw(e,t){const n=u7(.8908130915292852*t),r=x7*n,i=b7*n;e.moveTo(0,-n),e.lineTo(r,i);for(let o=1;o<5;++o){const t=d7*o/5,s=l7(t),a=c7(t);e.lineTo(a*n,-s*n),e.lineTo(s*r-a*i,a*r+s*i)}e.closePath()}},S7=u7(3),E7={draw(e,t){const n=-u7(t/(3*S7));e.moveTo(0,2*n),e.lineTo(-S7*n,-n),e.lineTo(S7*n,-n),e.closePath()}},T7=-.5,A7=u7(3)/2,C7=1/u7(12),P7=3*(C7/2+1),I7={draw(e,t){const n=u7(t/P7),r=n/2,i=n*C7,o=r,s=n*C7+n,a=-o,l=s;e.moveTo(r,i),e.lineTo(o,s),e.lineTo(a,l),e.lineTo(T7*r-A7*i,A7*r+T7*i),e.lineTo(T7*o-A7*s,A7*o+T7*s),e.lineTo(T7*a-A7*l,A7*a+T7*l),e.lineTo(T7*r+A7*i,T7*i-A7*r),e.lineTo(T7*o+A7*s,T7*s-A7*o),e.lineTo(T7*a+A7*l,T7*l-A7*a),e.closePath()}};u7(3),u7(3);var k7=["type","size","sizeType"];function M7(){return M7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},M7.apply(null,arguments)}function R7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function O7(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R7(Object(n),!0).forEach(function(t){L7(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R7(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function L7(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D7={symbolCircle:f7,symbolCross:p7,symbolDiamond:_7,symbolSquare:y7,symbolStar:w7,symbolTriangle:E7,symbolWye:I7},N7=Math.PI/180,z7=e=>{var{type:t="circle",size:n=64,sizeType:r="area"}=e,o=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,k7),s=O7(O7({},o),{},{type:t,size:n,sizeType:r}),{className:a,cx:l,cy:c}=s,u=zX(s,!0);return l===+l&&c===+c&&n===+n?i.createElement("path",M7({},u,{className:yi("recharts-symbols",a),transform:"translate(".concat(l,", ").concat(c,")"),d:(()=>{var e=(e=>{var t="symbol".concat(_R(e));return D7[t]||f7})(t),i=function(e,t){let n=null,r=jY(i);function i(){let i;if(n||(n=i=r()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return e="function"===typeof e?e:_N(e||f7),t="function"===typeof t?t:_N(void 0===t?64:+t),i.type=function(t){return arguments.length?(e="function"===typeof t?t:_N(t),i):e},i.size=function(e){return arguments.length?(t="function"===typeof e?e:_N(+e),i):t},i.context=function(e){return arguments.length?(n=null==e?null:e,i):n},i}().type(e).size(((e,t,n)=>{if("area"===t)return e;switch(n){case"cross":return 5*e*e/9;case"diamond":return.5*e*e/Math.sqrt(3);case"square":return e*e;case"star":var r=18*N7;return 1.25*e*e*(Math.tan(r)-Math.tan(2*r)*Math.tan(r)**2);case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}})(n,r,t));return i()})()})):null};z7.registerSymbol=(e,t)=>{D7["symbol".concat(_R(e))]=t};var F7=["option","shapeType","propTransformer","activeClassName","isActive"];function B7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function j7(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B7(Object(n),!0).forEach(function(t){U7(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B7(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function U7(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V7(e,t){return j7(j7({},t),e)}function G7(e){var{shapeType:t,elementProps:n}=e;switch(t){case"rectangle":return i.createElement(m0,n);case"trapezoid":return i.createElement(a7,n);case"sector":return i.createElement(b0,n);case"symbols":if(function(e){return"symbols"===e}(t))return i.createElement(z7,n);break;default:return null}}function H7(e){var t,{option:n,shapeType:r,propTransformer:o=V7,activeClassName:s="recharts-active-shape",isActive:a}=e,l=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,F7);if((0,i.isValidElement)(n))t=(0,i.cloneElement)(n,j7(j7({},l),function(e){return(0,i.isValidElement)(e)?e.props:e}(n)));else if("function"===typeof n)t=n(l);else if(r7()(n)&&"boolean"!==typeof n){var c=o(n,l);t=i.createElement(G7,{shapeType:r,elementProps:c})}else{var u=l;t=i.createElement(G7,{shapeType:r,elementProps:u})}return a?i.createElement(TZ,{className:s},t):t}var $7=["x","y"];function W7(){return W7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W7.apply(null,arguments)}function q7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function X7(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q7(Object(n),!0).forEach(function(t){Z7(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q7(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Z7(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K7(e,t){var{x:n,y:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,$7),o="".concat(n),s=parseInt(o,10),a="".concat(r),l=parseInt(a,10),c="".concat(t.height||i.height),u=parseInt(c,10),h="".concat(t.width||i.width),d=parseInt(h,10);return X7(X7(X7(X7(X7({},t),i),s?{x:s}:{}),l?{y:l}:{}),{},{height:u,width:d,name:t.name,radius:t.radius})}function Y7(e){return i.createElement(H7,W7({shapeType:"rectangle",propTransformer:K7,activeClassName:"recharts-active-bar"},e))}var J7=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(n,r)=>{if(lR(e))return e;var i=lR(n)||gR(n);return i?e(n,r):(i||function(e){if(!e)throw new Error(t7)}(!1),t)}},Q7=(e,t)=>{var n=aN();return(r,i)=>o=>{null===e||void 0===e||e(r,i,o),n(ID({activeIndex:String(i),activeDataKey:t,activeCoordinate:r.tooltipPosition}))}},e9=e=>{var t=aN();return(n,r)=>i=>{null===e||void 0===e||e(n,r,i),t(kD())}},t9=(e,t)=>{var n=aN();return(r,i)=>o=>{null===e||void 0===e||e(r,i,o),n(RD({activeIndex:String(i),activeDataKey:t,activeCoordinate:r.tooltipPosition}))}};function n9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function r9(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?n9(Object(n),!0).forEach(function(t){i9(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n9(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i9(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o9=nN([eH,(e,t,n,r,i)=>i],(e,t)=>e.filter(e=>"bar"===e.type).find(e=>e.id===t)),s9=nN([o9],e=>null===e||void 0===e?void 0:e.maxBarSize),a9=(e,t,n)=>{var r=null!==n&&void 0!==n?n:e;if(!gR(r))return dR(r,t,0)},l9=nN([_z,eH,(e,t)=>t,(e,t,n)=>n,(e,t,n,r)=>r],(e,t,n,r,i)=>t.filter(t=>"horizontal"===e?t.xAxisId===n:t.yAxisId===r).filter(e=>e.isPanorama===i).filter(e=>!1===e.hide).filter(e=>"bar"===e.type)),c9=nN([l9,e=>e.rootProps.barSize,(e,t,n)=>"horizontal"===_z(e)?b$(e,"xAxis",t):b$(e,"yAxis",n)],(e,t,n)=>{var r=e.filter(BG),i=e.filter(e=>null==e.stackId),o=r.reduce((e,t)=>(e[t.stackId]||(e[t.stackId]=[]),e[t.stackId].push(t),e),{}),s=Object.entries(o).map(e=>{var[r,i]=e,o=i.map(e=>e.dataKey);return{stackId:r,dataKeys:o,barSize:a9(t,n,i[0].barSize)}}),a=i.map(e=>({stackId:void 0,dataKeys:[e.dataKey].filter(e=>null!=e),barSize:a9(t,n,e.barSize)}));return[...s,...a]}),u9=(e,t,n,r)=>{var i,o;return"horizontal"===_z(e)?(i=I$(e,"xAxis",t,r),o=P$(e,"xAxis",t,r)):(i=I$(e,"yAxis",n,r),o=P$(e,"yAxis",n,r)),qN(i,o)};var h9=nN([c9,nG,e=>e.rootProps.barGap,rG,(e,t,n,r,i)=>{var o,s,a=o9(e,t,n,r,i);if(null!=a){var l,c,u=_z(e),h=nG(e),{maxBarSize:d}=a,f=gR(d)?h:d;return"horizontal"===u?(l=I$(e,"xAxis",t,r),c=P$(e,"xAxis",t,r)):(l=I$(e,"yAxis",n,r),c=P$(e,"yAxis",n,r)),null!==(o=null!==(s=qN(l,c,!0))&&void 0!==s?s:f)&&void 0!==o?o:0}},u9,s9],(e,t,n,r,i,o,s)=>{var a=gR(s)?t:s,l=function(e,t,n,r,i){var o=r.length;if(!(o<1)){var s,a=dR(e,n,0,!0),l=[];if(RV(r[0].barSize)){var c=!1,u=n/o,h=r.reduce((e,t)=>e+(t.barSize||0),0);(h+=(o-1)*a)>=n&&(h-=(o-1)*a,a=0),h>=n&&u>0&&(c=!0,h=o*(u*=.9));var d={offset:((n-h)/2|0)-a,size:0};s=r.reduce((e,t)=>{var n,r=[...e,{stackId:t.stackId,dataKeys:t.dataKeys,position:{offset:d.offset+d.size+a,size:c?u:null!==(n=t.barSize)&&void 0!==n?n:0}}];return d=r[r.length-1].position,r},l)}else{var f=dR(t,n,0,!0);n-2*f-(o-1)*a<=0&&(a=0);var p=(n-2*f-(o-1)*a)/o;p>1&&(p>>=0);var m=RV(i)?Math.min(p,i):p;s=r.reduce((e,t,n)=>[...e,{stackId:t.stackId,dataKeys:t.dataKeys,position:{offset:f+(p+a)*n+(p-m)/2,size:m}}],l)}return s}}(n,r,i!==o?i:o,e,a);return i!==o&&null!=l&&(l=l.map(e=>r9(r9({},e),{},{position:r9(r9({},e.position),{},{offset:e.position.offset-i/2})}))),l}),d9=nN([h9,o9],(e,t)=>{if(null!=e&&null!=t){var n=e.find(e=>e.stackId===t.stackId&&null!=t.dataKey&&e.dataKeys.includes(t.dataKey));if(null!=n)return n.position}}),f9=nN([(e,t,n,r)=>"horizontal"===_z(e)?yH(e,"yAxis",n,r):yH(e,"xAxis",t,r),o9],(e,t)=>{var n=LG(t);if(e&&null!=n&&null!=t){var{stackId:r}=t;if(null!=r){var i=e[r];if(i){var{stackedData:o}=i;if(o)return o.find(e=>e.key===n)}}}}),p9=nN([oz,(e,t,n,r)=>I$(e,"xAxis",t,r),(e,t,n,r)=>I$(e,"yAxis",n,r),(e,t,n,r)=>P$(e,"xAxis",t,r),(e,t,n,r)=>P$(e,"yAxis",n,r),d9,_z,MV,u9,f9,o9,(e,t,n,r,i,o)=>o],(e,t,n,r,i,o,s,a,l,c,u,h)=>{var{chartData:d,dataStartIndex:f,dataEndIndex:p}=a;if(null!=u&&null!=o&&("horizontal"===s||"vertical"===s)&&null!=t&&null!=n&&null!=r&&null!=i&&null!=l){var m,{data:g}=u;if(null!=(m=null!=g&&g.length>0?g:null===d||void 0===d?void 0:d.slice(f,p+1)))return function(e){var{layout:t,barSettings:{dataKey:n,minPointSize:r},pos:i,bandSize:o,xAxis:s,yAxis:a,xAxisTicks:l,yAxisTicks:c,stackedData:u,displayedData:h,offset:d,cells:f}=e,p="horizontal"===t?a:s,m=u?p.scale.domain():null,g=(e=>{var{numericAxis:t}=e,n=t.scale.domain();if("number"===t.type){var r=Math.min(n[0],n[1]),i=Math.max(n[0],n[1]);return r<=0&&i>=0?0:i<0?i:r}return n[0]})({numericAxis:p});return h.map((e,h)=>{var p,_,y,v,x,b;u?p=((e,t)=>{if(!t||2!==t.length||!lR(t[0])||!lR(t[1]))return e;var n=Math.min(t[0],t[1]),r=Math.max(t[0],t[1]),i=[e[0],e[1]];return(!lR(e[0])||e[0]<n)&&(i[0]=n),(!lR(e[1])||e[1]>r)&&(i[1]=r),i[0]>r&&(i[0]=r),i[1]<n&&(i[1]=n),i})(u[h],m):(p=LN(e,n),Array.isArray(p)||(p=[g,p]));var w=J7(r,k9)(p[1],h);if("horizontal"===t){var S,[E,T]=[a.scale(p[0]),a.scale(p[1])];_=GN({axis:s,ticks:l,bandSize:o,offset:i.offset,entry:e,index:h}),y=null!==(S=null!==T&&void 0!==T?T:E)&&void 0!==S?S:void 0,v=i.size;var A=E-T;if(x=sR(A)?0:A,b={x:_,y:d.top,width:v,height:d.height},Math.abs(w)>0&&Math.abs(x)<Math.abs(w)){var C=oR(x||w)*(Math.abs(w)-Math.abs(x));y-=C,x+=C}}else{var[P,I]=[s.scale(p[0]),s.scale(p[1])];if(_=P,y=GN({axis:a,ticks:c,bandSize:o,offset:i.offset,entry:e,index:h}),v=I-P,x=i.size,b={x:d.left,y:y,width:d.width,height:x},Math.abs(w)>0&&Math.abs(v)<Math.abs(w))v+=oR(v||w)*(Math.abs(w)-Math.abs(v))}return null==_||null==y||null==v||null==x?null:b9(b9({},e),{},{x:_,y:y,width:v,height:x,value:u?p:p[1],payload:e,background:b,tooltipPosition:{x:_+v/2,y:y+x/2}},f&&f[h]&&f[h].props)}).filter(Boolean)}({layout:s,barSettings:u,pos:o,bandSize:l,xAxis:t,yAxis:n,xAxisTicks:r,yAxisTicks:i,stackedData:c,displayedData:m,offset:e,cells:h})}}),m9=["onMouseEnter","onMouseLeave","onClick"],g9=["value","background","tooltipPosition"],_9=["id"],y9=["onMouseEnter","onClick","onMouseLeave"];function v9(){return v9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v9.apply(null,arguments)}function x9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b9(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x9(Object(n),!0).forEach(function(t){w9(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x9(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function w9(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S9(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var E9=e=>{var{dataKey:t,name:n,fill:r,legendType:i,hide:o}=e;return[{inactive:o,dataKey:t,type:i,color:r,value:ZN(n,t),payload:e}]};function T9(e){var{dataKey:t,stroke:n,strokeWidth:r,fill:i,name:o,hide:s,unit:a}=e;return{dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:n,strokeWidth:r,fill:i,dataKey:t,nameKey:void 0,name:ZN(o,t),hide:s,type:e.tooltipType,color:e.fill,unit:a}}}function A9(e){var t=hN(RW),{data:n,dataKey:r,background:o,allOtherBarProps:s}=e,{onMouseEnter:a,onMouseLeave:l,onClick:c}=s,u=S9(s,m9),h=Q7(a,r),d=e9(l),f=t9(c,r);if(!o||null==n)return null;var p=zX(o,!1);return i.createElement(i.Fragment,null,n.map((e,n)=>{var{value:s,background:a,tooltipPosition:l}=e,c=S9(e,g9);if(!a)return null;var m=h(e,n),g=d(e,n),_=f(e,n),y=b9(b9(b9(b9(b9({option:o,isActive:String(n)===t},c),{},{fill:"#eee"},a),p),CX(u,e,n)),{},{onMouseEnter:m,onMouseLeave:g,onClick:_,dataKey:r,index:n,className:"recharts-bar-background-rectangle"});return i.createElement(Y7,v9({key:"background-bar-".concat(n)},y))}))}function C9(e){var{data:t,props:n,showLabels:r}=e,o=kX(n),{id:s}=o,a=S9(o,_9),{shape:l,dataKey:c,activeBar:u}=n,h=hN(RW),d=hN(LW),{onMouseEnter:f,onClick:p,onMouseLeave:m}=n,g=S9(n,y9),_=Q7(f,c),y=e9(m),v=t9(p,c);return t?i.createElement(i.Fragment,null,t.map((e,t)=>{var n=u&&String(t)===h&&(null==d||c===d),r=n?u:l,o=b9(b9(b9({},a),e),{},{isActive:n,option:r,index:t,dataKey:c});return i.createElement(TZ,v9({className:"recharts-bar-rectangle"},CX(g,e,t),{onMouseEnter:_(e,t),onMouseLeave:y(e,t),onClick:v(e,t),key:"rectangle-".concat(null===e||void 0===e?void 0:e.x,"-").concat(null===e||void 0===e?void 0:e.y,"-").concat(null===e||void 0===e?void 0:e.value,"-").concat(t)}),i.createElement(Y7,o))}),r&&fJ.renderCallByParent(n,t)):null}function P9(e){var{props:t,previousRectanglesRef:n}=e,{data:r,layout:o,isAnimationActive:s,animationBegin:a,animationDuration:l,animationEasing:c,onAnimationEnd:u,onAnimationStart:h}=t,d=n.current,f=NJ(t,"recharts-bar-"),[p,m]=(0,i.useState)(!1),g=(0,i.useCallback)(()=>{"function"===typeof u&&u(),m(!1)},[u]),_=(0,i.useCallback)(()=>{"function"===typeof h&&h(),m(!0)},[h]);return i.createElement(fQ,{begin:a,duration:l,isActive:s,easing:c,onAnimationEnd:g,onAnimationStart:_,key:f},e=>{var s=1===e?r:null===r||void 0===r?void 0:r.map((t,n)=>{var r=d&&d[n];if(r)return b9(b9({},t),{},{x:pR(r.x,t.x,e),y:pR(r.y,t.y,e),width:pR(r.width,t.width,e),height:pR(r.height,t.height,e)});if("horizontal"===o){var i=pR(0,t.height,e);return b9(b9({},t),{},{y:t.y+t.height-i,height:i})}var s=pR(0,t.width,e);return b9(b9({},t),{},{width:s})});return e>0&&(n.current=null!==s&&void 0!==s?s:null),null==s?null:i.createElement(TZ,null,i.createElement(C9,{props:t,data:s,showLabels:!p}))})}function I9(e){var{data:t,isAnimationActive:n}=e,r=(0,i.useRef)(null);return n&&t&&t.length&&(null==r.current||r.current!==t)?i.createElement(P9,{previousRectanglesRef:r,props:e}):i.createElement(C9,{props:e,data:t,showLabels:!0})}var k9=0,M9=(e,t)=>{var n=Array.isArray(e.value)?e.value[1]:e.value;return{x:e.x,y:e.y,value:n,errorVal:LN(e,t)}};class R9 extends i.PureComponent{render(){var{hide:e,data:t,dataKey:n,className:r,xAxisId:o,yAxisId:s,needClip:a,background:l,id:c}=this.props;if(e)return null;var u=yi("recharts-bar",r),h=c;return i.createElement(TZ,{className:u,id:c},a&&i.createElement("defs",null,i.createElement(EJ,{clipPathId:h,xAxisId:o,yAxisId:s})),i.createElement(TZ,{className:"recharts-bar-rectangles",clipPath:a?"url(#clipPath-".concat(h,")"):void 0},i.createElement(A9,{data:t,dataKey:n,background:l,allOtherBarProps:this.props}),i.createElement(I9,this.props)),this.props.children)}}var O9={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",hide:!1,isAnimationActive:!AZ,legendType:"rect",minPointSize:k9,xAxisId:0,yAxisId:0};function L9(e){var t,{xAxisId:n,yAxisId:r,hide:o,legendType:s,minPointSize:a,activeBar:l,animationBegin:c,animationDuration:u,animationEasing:h,isAnimationActive:d}=e,{needClip:f}=SJ(n,r),p=yz(),m=cz(),g=DX(e.children,e7),_=hN(t=>p9(t,n,r,m,e.id,g));if("vertical"!==p&&"horizontal"!==p)return null;var y=null===_||void 0===_?void 0:_[0];return t=null==y||null==y.height||null==y.width?0:"vertical"===p?y.height/2:y.width/2,i.createElement(wJ,{xAxisId:n,yAxisId:r,data:_,dataPointFormatter:M9,errorBarOffset:t},i.createElement(R9,v9({},e,{layout:p,needClip:f,data:_,xAxisId:n,yAxisId:r,hide:o,legendType:s,minPointSize:a,activeBar:l,animationBegin:c,animationDuration:u,animationEasing:h,isAnimationActive:d})))}function D9(e){var t=mZ(e,O9),n=cz();return i.createElement(BJ,{id:t.id,type:"bar"},e=>i.createElement(i.Fragment,null,i.createElement(DJ,{legendPayload:E9(t)}),i.createElement(yJ,{fn:T9,args:t}),i.createElement(jJ,{type:"bar",id:e,data:void 0,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,dataKey:t.dataKey,stackId:UN(t.stackId),hide:t.hide,barSize:t.barSize,minPointSize:t.minPointSize,maxBarSize:t.maxBarSize,isPanorama:n}),i.createElement(L9,v9({},t,{id:e}))))}D9.displayName="Bar";const N9=e=>{let{chatMessages:t=[],timeSeriesData:n=[],currentFrame:r=0,selectedParameter:o="Current Speed",selectedDepth:s=0,showCharts:a=!0,showTables:l=!0,showScrollButton:c=!0,maxResponses:u=50,isCollapsed:h=!0,onToggleCollapse:d,onExportResponse:f,onCopyResponse:p,onShareResponse:m,className:g="",isTyping:_=!1,typingMessage:y="Processing..."}=e;const v=(0,i.useRef)(null),[x,b]=(0,i.useState)(!1),[w,S]=(0,i.useState)(null),[E,T]=(0,i.useState)("api"),[A,C]=(0,i.useState)({totalApiResponses:0,totalLocalResponses:0,successRate:0,avgResponseTime:0}),P=()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight)};(0,i.useEffect)(()=>{P()},[t.filter(e=>!e.isUser).length,_]),(0,i.useEffect)(()=>{const e=t.filter(e=>!e.isUser),n=e.filter(e=>"api"===e.source),r=e.filter(e=>"local"===e.source);C({totalApiResponses:n.length,totalLocalResponses:r.length,successRate:e.length>0?(n.length/e.length*100).toFixed(1):0,avgResponseTime:0})},[t]);const I=(e,t)=>{const n=e.toLowerCase();return"api"===t?{type:"api",icon:H8,color:"text-green-400",bgColor:"bg-green-900/20",borderColor:"border-green-500/30"}:"local"===t?{type:"local",icon:ri,color:"text-yellow-400",bgColor:"bg-yellow-900/20",borderColor:"border-yellow-500/30"}:"error"===t?{type:"error",icon:Xr,color:"text-red-400",bgColor:"bg-red-900/20",borderColor:"border-red-500/30"}:n.includes("chart")||n.includes("trend")||n.includes("ssh")?{type:"chart",icon:QM,color:"text-cyan-400",bgColor:"bg-cyan-900/20",borderColor:"border-cyan-500/30"}:n.includes("data")||n.includes("temperature")||n.includes("environmental")?{type:"table",icon:$8,color:"text-emerald-400",bgColor:"bg-emerald-900/20",borderColor:"border-emerald-500/30"}:n.includes("analysis")||n.includes("forecast")||n.includes("predict")?{type:"analysis",icon:YM,color:"text-purple-400",bgColor:"bg-purple-900/20",borderColor:"border-purple-500/30"}:{type:"text",icon:JM,color:"text-slate-400",bgColor:"bg-slate-700/20",borderColor:"border-slate-500/30"}},k=(e,t)=>{const r=e.content.toLowerCase();return r.includes("current")||r.includes("flow")?(0,jr.jsxs)("div",{className:"bg-slate-600/50 rounded p-2 md:p-3 mt-2",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Current Speed Analysis"}),(0,jr.jsx)(wR,{width:"100%",height:100,children:(0,jr.jsxs)(bZ,{data:n.slice(-12),children:[(0,jr.jsx)(LQ,{type:"monotone",dataKey:"currentSpeed",stroke:"#22d3ee",strokeWidth:2,dot:!1}),(0,jr.jsx)(UK,{hide:!0}),(0,jr.jsx)(ZK,{hide:!0}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px"},formatter:e=>[`${null===e||void 0===e?void 0:e.toFixed(3)} m/s`,"Current Speed"]})]})})]}):r.includes("ssh")||r.includes("elevation")?(0,jr.jsxs)("div",{className:"bg-slate-600/50 rounded p-2 md:p-3 mt-2",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Surface Elevation (SSH) Trends"}),(0,jr.jsx)(wR,{width:"100%",height:100,children:(0,jr.jsxs)(Q8,{data:n.slice(-8),children:[(0,jr.jsx)(D9,{dataKey:"ssh",fill:"#10b981",opacity:.7}),(0,jr.jsx)(UK,{hide:!0}),(0,jr.jsx)(ZK,{hide:!0}),(0,jr.jsx)(B0,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"6px",fontSize:"12px"},formatter:e=>[`${null===e||void 0===e?void 0:e.toFixed(2)} m`,"SSH"]})]})})]}):null},M=(e,t)=>{const r=e.content.toLowerCase();return(r.includes("data")||r.includes("temperature")||r.includes("environmental"))&&n.length>0?(0,jr.jsxs)("div",{className:"bg-slate-600/50 rounded p-2 md:p-3 mt-2",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Environmental Data Table"}),(0,jr.jsx)("div",{className:"overflow-x-auto",children:(0,jr.jsxs)("table",{className:"w-full text-xs",children:[(0,jr.jsx)("thead",{children:(0,jr.jsxs)("tr",{className:"border-b border-slate-500",children:[(0,jr.jsx)("th",{className:"text-left p-1 text-slate-300",children:"Time"}),(0,jr.jsx)("th",{className:"text-left p-1 text-slate-300",children:"Temp (\xb0F)"}),(0,jr.jsx)("th",{className:"text-left p-1 text-slate-300",children:"Current (m/s)"}),(0,jr.jsx)("th",{className:"text-left p-1 text-slate-300",children:"SSH (m)"})]})}),(0,jr.jsx)("tbody",{children:n.slice(-3).map((e,t)=>{var n,r,i;return(0,jr.jsxs)("tr",{className:"border-b border-slate-600/50",children:[(0,jr.jsx)("td",{className:"p-1 text-slate-200 font-mono",children:e.time}),(0,jr.jsx)("td",{className:"p-1 text-slate-200",children:(null===(n=e.temperature)||void 0===n?void 0:n.toFixed(1))||"N/A"}),(0,jr.jsx)("td",{className:"p-1 text-slate-200",children:(null===(r=e.currentSpeed)||void 0===r?void 0:r.toFixed(2))||"N/A"}),(0,jr.jsx)("td",{className:"p-1 text-slate-200",children:(null===(i=e.ssh)||void 0===i?void 0:i.toFixed(2))||"N/A"})]},t)})})]})})]}):null},R=(()=>{const e=t.filter(e=>!e.isUser);switch(E){case"api":return e.filter(e=>"api"===e.source);case"local":return e.filter(e=>"local"===e.source);case"charts":return e.filter(e=>e.content.toLowerCase().includes("chart")||e.content.toLowerCase().includes("trend")||e.content.toLowerCase().includes("analysis"));case"tables":return e.filter(e=>e.content.toLowerCase().includes("data")||e.content.toLowerCase().includes("measurement")||e.content.toLowerCase().includes("temperature"));case"text":return e.filter(e=>!e.content.toLowerCase().includes("chart")&&!e.content.toLowerCase().includes("data")&&!e.content.toLowerCase().includes("trend"));default:return e}})();return(0,jr.jsxs)("div",{className:`flex flex-col h-full transition-all duration-300 w-full ${g}`,children:[(0,jr.jsx)("div",{className:"flex-shrink-0 "+(h?"p-1":"p-2 md:p-4 bg-gradient-to-r from-yellow-900/20 to-orange-900/20 border-b border-yellow-500/20"),children:(0,jr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsxs)("h3",{className:"font-semibold text-yellow-300 flex items-center gap-2 "+(h?"text-xs":"text-sm md:text-base"),children:[(0,jr.jsx)(zr,{className:""+(h?"w-3 h-3":"w-4 h-4 md:w-5 md:h-5")}),h?"Analysis":"Analysis Output Module"]}),(0,jr.jsxs)("p",{className:"text-slate-400 mt-1 text-xs",children:["API: ",A.totalApiResponses," \u2022 Showing: ",R.length]})]}),(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[!h&&(0,jr.jsx)("div",{className:"text-xs text-slate-400",children:(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)(W8,{className:"w-3 h-3"}),(0,jr.jsxs)("span",{children:[A.successRate,"% API"]})]})}),!h&&(0,jr.jsxs)("select",{value:E,onChange:e=>T(e.target.value),className:"bg-slate-700 border border-slate-600 rounded px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-yellow-400",children:[(0,jr.jsx)("option",{value:"api",children:"API Responses"}),(0,jr.jsx)("option",{value:"all",children:"All Responses"}),(0,jr.jsx)("option",{value:"charts",children:"Charts & Trends"}),(0,jr.jsx)("option",{value:"tables",children:"Data & Tables"}),(0,jr.jsx)("option",{value:"text",children:"Text Analysis"})]}),(0,jr.jsx)("button",{onClick:d,className:"p-1 text-slate-400 hover:text-yellow-400 transition-colors border border-slate-600 rounded",title:h?"Expand Panel":"Collapse Panel",children:h?(0,jr.jsx)(q8,{className:"w-4 h-4"}):(0,jr.jsx)(X8,{className:"w-4 h-4"})})]})]})}),(0,jr.jsx)("div",{className:"flex-1 overflow-hidden "+(h?"p-1":"p-2 md:p-4"),children:(0,jr.jsxs)("div",{ref:v,onScroll:e=>{const{scrollTop:t,scrollHeight:n,clientHeight:r}=e.target;b(!(n-t-r<100))},className:"h-full overflow-y-auto rounded scroll-smooth "+(h?"p-1 space-y-1":"bg-slate-700/30 p-2 md:p-3 space-y-3 md:space-y-4"),children:[R.length>0?R.slice(-u).map((e,t)=>{const n=I(e.content,e.source),i=n.icon,c=w===e.id;return(0,jr.jsxs)("div",{className:"border-b border-slate-600/30 last:border-b-0 "+(h?"pb-1":"pb-3 md:pb-4"),children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jr.jsx)("div",{className:`w-2 h-2 rounded-full ${n.color.replace("text-","bg-")}`}),!h&&(0,jr.jsx)(i,{className:`w-4 h-4 ${n.color}`}),(0,jr.jsx)("span",{className:`font-medium ${n.color} text-xs`,children:h?`#${t+1}`:`Response #${t+1} \u2022 ${n.type.charAt(0).toUpperCase()+n.type.slice(1)}`}),!h&&e.source&&(0,jr.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded ${n.bgColor} ${n.borderColor} border`,children:e.source.toUpperCase()}),!h&&(0,jr.jsx)("span",{className:"text-xs text-slate-400 ml-auto",children:e.timestamp.toLocaleTimeString()})]}),!h&&(0,jr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jr.jsx)("button",{onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e.content),console.log("Response copied to clipboard")}catch(t){console.error("Failed to copy response:",t)}})(e),className:"p-1 text-slate-400 hover:text-slate-300 transition-colors",title:"Copy Response",children:(0,jr.jsx)(Z8,{className:"w-3 h-3"})}),(0,jr.jsx)("button",{onClick:()=>((e,t)=>{const n=I(e.content,e.source),i={id:e.id,timestamp:e.timestamp,content:e.content,source:e.source,type:n.type,frame:r,parameter:o,depth:s,retryAttempt:e.retryAttempt||0},a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),c=document.createElement("a");c.href=l,c.download=`ocean_analysis_response_${t+1}_${e.source}.json`,document.body.appendChild(c),c.click(),URL.revokeObjectURL(l),document.body.removeChild(c)})(e,t),className:"p-1 text-slate-400 hover:text-slate-300 transition-colors",title:"Export Response",children:(0,jr.jsx)(eR,{className:"w-3 h-3"})}),(0,jr.jsx)("button",{onClick:()=>S(c?null:e.id),className:"p-1 text-slate-400 hover:text-slate-300 transition-colors",title:c?"Collapse":"Expand",children:c?(0,jr.jsx)($0,{className:"w-3 h-3"}):(0,jr.jsx)(W0,{className:"w-3 h-3"})})]})]}),(0,jr.jsxs)("div",{className:h?"space-y-1":"space-y-2 md:space-y-3",children:[(0,jr.jsx)("div",{className:"text-slate-100 leading-relaxed markdown-content "+(h?"text-xs":"text-xs md:text-sm"),children:(0,jr.jsx)(W5,{remarkPlugins:[G8],components:{h1:e=>{let{children:t}=e;return(0,jr.jsx)("h1",{className:"text-lg md:text-xl font-bold text-yellow-300 mb-2 mt-4 first:mt-0",children:t})},h2:e=>{let{children:t}=e;return(0,jr.jsx)("h2",{className:"text-base md:text-lg font-semibold text-yellow-400 mb-2 mt-3 first:mt-0",children:t})},h3:e=>{let{children:t}=e;return(0,jr.jsx)("h3",{className:"text-sm md:text-base font-medium text-slate-200 mb-1 mt-2 first:mt-0",children:t})},h4:e=>{let{children:t}=e;return(0,jr.jsx)("h4",{className:"text-sm font-medium text-slate-300 mb-1 mt-2 first:mt-0",children:t})},h5:e=>{let{children:t}=e;return(0,jr.jsx)("h5",{className:"text-xs font-medium text-slate-400 mb-1 mt-2 first:mt-0",children:t})},h6:e=>{let{children:t}=e;return(0,jr.jsx)("h6",{className:"text-xs font-medium text-slate-500 mb-1 mt-2 first:mt-0",children:t})},p:e=>{let{children:t}=e;return(0,jr.jsx)("p",{className:"mb-2 last:mb-0",children:t})},ul:e=>{let{children:t}=e;return(0,jr.jsx)("ul",{className:"list-disc list-inside mb-2 space-y-1 text-slate-200",children:t})},ol:e=>{let{children:t}=e;return(0,jr.jsx)("ol",{className:"list-decimal list-inside mb-2 space-y-1 text-slate-200",children:t})},li:e=>{let{children:t}=e;return(0,jr.jsx)("li",{className:"text-slate-200",children:t})},a:e=>{let{href:t,children:n}=e;return(0,jr.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300 underline transition-colors",children:n})},code:e=>{let{inline:t,children:n}=e;return t?(0,jr.jsx)("code",{className:"bg-slate-600/50 px-1 py-0.5 rounded text-xs font-mono text-cyan-300",children:n}):(0,jr.jsx)("code",{className:"block bg-slate-800/50 p-2 rounded text-xs font-mono text-cyan-200 overflow-x-auto mb-2",children:n})},pre:e=>{let{children:t}=e;return(0,jr.jsx)("pre",{className:"bg-slate-800/50 p-3 rounded overflow-x-auto mb-2 border border-slate-600/30",children:t})},blockquote:e=>{let{children:t}=e;return(0,jr.jsx)("blockquote",{className:"border-l-4 border-yellow-400/50 pl-3 py-1 bg-slate-700/30 rounded-r mb-2 text-slate-300",children:t})},table:e=>{let{children:t}=e;return(0,jr.jsx)("div",{className:"overflow-x-auto mb-2",children:(0,jr.jsx)("table",{className:"w-full text-xs border border-slate-600/30 rounded",children:t})})},thead:e=>{let{children:t}=e;return(0,jr.jsx)("thead",{className:"bg-slate-700/50",children:t})},tbody:e=>{let{children:t}=e;return(0,jr.jsx)("tbody",{children:t})},tr:e=>{let{children:t}=e;return(0,jr.jsx)("tr",{className:"border-b border-slate-600/30 last:border-b-0",children:t})},th:e=>{let{children:t}=e;return(0,jr.jsx)("th",{className:"text-left p-2 text-slate-300 font-medium",children:t})},td:e=>{let{children:t}=e;return(0,jr.jsx)("td",{className:"p-2 text-slate-200",children:t})},strong:e=>{let{children:t}=e;return(0,jr.jsx)("strong",{className:"font-semibold text-yellow-300",children:t})},em:e=>{let{children:t}=e;return(0,jr.jsx)("em",{className:"italic text-slate-300",children:t})},hr:()=>(0,jr.jsx)("hr",{className:"border-slate-600/50 my-3"}),img:e=>{let{src:t,alt:n}=e;return(0,jr.jsx)("img",{src:t,alt:n,className:"max-w-full h-auto rounded border border-slate-600/30 mb-2"})}},children:e.content})}),!h&&a&&(c||"chart"===n.type)&&k(e),!h&&l&&(c||"table"===n.type)&&M(e),!h&&c&&(0,jr.jsxs)("div",{className:"bg-slate-800/50 rounded p-2 mt-2",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Response Metadata"}),(0,jr.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsx)("span",{className:"text-slate-500",children:"Source:"}),(0,jr.jsx)("br",{}),(0,jr.jsx)("span",{className:n.color,children:e.source||"unknown"})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("span",{className:"text-slate-500",children:"Parameter:"}),(0,jr.jsx)("br",{}),(0,jr.jsx)("span",{className:"text-slate-300",children:o})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("span",{className:"text-slate-500",children:"Depth:"}),(0,jr.jsx)("br",{}),(0,jr.jsxs)("span",{className:"text-slate-300",children:[s,"m"]})]}),(0,jr.jsxs)("div",{children:[(0,jr.jsx)("span",{className:"text-slate-500",children:"Frame:"}),(0,jr.jsx)("br",{}),(0,jr.jsx)("span",{className:"text-slate-300",children:r+1})]}),e.retryAttempt>0&&(0,jr.jsxs)("div",{className:"col-span-2",children:[(0,jr.jsx)("span",{className:"text-slate-500",children:"Retries:"}),(0,jr.jsx)("br",{}),(0,jr.jsx)("span",{className:"text-yellow-400",children:e.retryAttempt})]})]})]})]})]},e.id)}):(0,jr.jsxs)("div",{className:"text-center text-slate-400 "+(h?"py-2":"py-6 md:py-8"),children:[(0,jr.jsx)(K8,{className:"mx-auto mb-2 opacity-50 "+(h?"w-4 h-4":"w-6 h-6 md:w-8 md:h-8")}),(0,jr.jsx)("p",{className:"text-xs",children:h?"No API responses":"No API responses yet"}),!h&&(0,jr.jsx)("p",{className:"text-xs mt-1",children:"api"===E?"API responses will appear here. Check connection if none appear.":`No ${E} responses found`})]}),_&&(0,jr.jsxs)("div",{className:"flex items-center gap-2 py-2",children:[(0,jr.jsxs)("div",{className:"flex gap-1",children:[(0,jr.jsx)("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-pulse delay-0"}),(0,jr.jsx)("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-pulse delay-100"}),(0,jr.jsx)("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-pulse delay-200"})]}),(0,jr.jsx)("span",{className:"text-xs md:text-sm text-slate-400",children:y})]})]})}),!h&&c&&x&&(0,jr.jsx)("button",{onClick:P,className:"absolute bottom-2 right-2 md:bottom-4 md:right-4 bg-yellow-500 hover:bg-yellow-600 p-2 rounded-full shadow-lg transition-colors z-10 border-2 border-yellow-400","aria-label":"Scroll to bottom",children:(0,jr.jsx)(Y8,{className:"w-3 h-3 md:w-4 md:h-4 text-white"})})]})},z9=Dr("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),F9=e=>{let{timeSeriesData:t=[],data:n=[],dataSource:r="simulated",selectedDepth:o=0,availableDepths:s=[],selectedArea:a="",selectedModel:l="NGOSF2",selectedParameter:c="Current Speed",playbackSpeed:u=1,currentFrame:h=0,holoOceanPOV:d={x:0,y:0,depth:0},envData:f={},timeZone:p="UTC",startDate:m,endDate:g,onAddMessage:_}=e;const{chatMessages:y,isTyping:v,addUserMessage:x,addAIResponse:b,getThreadId:w,startTyping:S,stopTyping:E,clearChatMessages:T}=vr(),[A,C]=(0,i.useState)(!1),[P,I]=(0,i.useState)(""),[k,M]=(0,i.useState)(0),[R,O]=(0,i.useState)(!1),[L,D]=(0,i.useState)({connected:!1,endpoint:"",timestamp:null,hasApiKey:!1}),[N,z]=(0,i.useState)(!1),F=(0,i.useRef)(null);(0,i.useEffect)(()=>{(async()=>{if(!(R||y.length>0)){try{const e={currentData:t&&t.length>0?t[t.length-1]:null,timeSeriesData:t,dataSource:r,selectedDepth:o,selectedModel:l,selectedParameter:c,selectedArea:a,playbackSpeed:u,holoOceanPOV:d,currentFrame:h,totalFrames:(null===n||void 0===n?void 0:n.length)||24,startDate:m,endDate:g,envData:f},i=w(),s=await cr("Generate a welcome message for CubeAI oceanographic analysis platform",e,i);if(!s||s.includes("[Local Response"))throw new Error("API not available");b(s,"api")}catch(e){console.error("Failed to get API welcome message:",e),b("Unable to connect to CubeAI services. Please check your connection and try again.","error"),D(e=>({...e,connected:!1}))}O(!0)}})()},[r,l,c,R,y.length,w,b,m,g]),(0,i.useEffect)(()=>{B();const e=setInterval(B,6e4);return()=>clearInterval(e)},[]);const B=async()=>{try{const e=await pr();D(e)}catch(e){console.error("Failed to check API status:",e),D(e=>({...e,connected:!1}))}},j=async()=>{if(!P.trim())return;x(P);const e=P;I(""),S("Analyzing..."),M(0);try{await U(e)}catch(t){console.error("Failed to process AI response:",t),V("Sorry, I encountered an error processing your request. Please try again.")}finally{E()}},U=async function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{const s={currentData:t&&t.length>0?t[t.length-1]:null,timeSeriesData:t,dataSource:r,selectedDepth:o,selectedModel:l,selectedParameter:c,selectedArea:a,playbackSpeed:u,holoOceanPOV:d,currentFrame:h,totalFrames:(null===n||void 0===n?void 0:n.length)||24,startDate:m,endDate:g,envData:f},p=w(),y=await cr(e,s,p);if(!y||y.includes("[Local Response"))throw new Error("API not available");const v=b(y,"api",{retryAttempt:i});M(0),_&&_(v),D(e=>({...e,connected:!0,timestamp:(new Date).toISOString()}))}catch(s){if(console.error(`AI response attempt ${i+1} failed:`,s),i<2){M(i+1);const t=1e3*Math.pow(2,i);setTimeout(()=>{U(e,i+1)},t)}else V("Unable to connect to CubeAI services. Please check your connection and try again."),D(e=>({...e,connected:!1}))}},V=e=>{b(e,"error")},G=e=>{if(e.isUser)return"bg-blue-600/20 text-blue-100 ml-4";switch(e.source){case"api":return"bg-slate-700/50 text-slate-200 mr-4 border-l-2 border-green-400";case"error":return"bg-red-900/30 text-red-200 mr-4 border-l-2 border-red-500";default:return"bg-slate-700/50 text-slate-200 mr-4"}};return(0,i.useEffect)(()=>{var e;null===(e=F.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"nearest"})},[y]),(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsxs)("button",{onClick:()=>C(!A),className:"fixed bottom-4 md:bottom-6 right-4 md:right-6 z-50 bg-blue-500 hover:bg-blue-600 p-2 md:p-3 rounded-full shadow-lg transition-colors","aria-label":"Toggle Chatbot",children:[(0,jr.jsx)(K8,{className:"w-4 h-4 md:w-5 md:h-5 text-white"}),k>0&&(0,jr.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-yellow-500 rounded-full animate-pulse"})]}),A&&(0,jr.jsxs)("div",{className:"fixed bottom-16 md:bottom-20 right-2 md:right-6 z-40 w-72 md:w-80 bg-slate-800/90 backdrop-blur-md border border-blue-500/30 rounded-lg shadow-xl flex flex-col mx-2 md:mx-0",children:[(0,jr.jsxs)("div",{className:"p-2 md:p-3 border-b border-blue-500/20 bg-gradient-to-r from-blue-900/20 to-cyan-900/20 flex items-center justify-between",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jr.jsx)("div",{className:"w-2 h-2 rounded-full animate-pulse "+(L.connected?"bg-green-400":"bg-red-400")}),(0,jr.jsx)("h3",{className:"text-sm font-semibold text-blue-300",children:"CubeAI Assistant"}),(0,jr.jsx)("button",{onClick:()=>z(!N),className:"text-slate-400 hover:text-blue-300 transition-colors",title:"API Status",children:L.connected?(0,jr.jsx)(Gr,{className:"w-3 h-3"}):(0,jr.jsx)(ri,{className:"w-3 h-3"})})]}),(0,jr.jsx)("button",{onClick:()=>C(!1),className:"text-slate-400 hover:text-white transition-colors",children:(0,jr.jsx)(KM,{className:"w-4 h-4"})})]}),N&&(0,jr.jsxs)("div",{className:"p-2 bg-slate-700/50 border-b border-slate-600 text-xs",children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jr.jsx)("span",{className:"text-slate-300",children:"API Status:"}),(0,jr.jsx)("span",{className:L.connected?"text-green-400":"text-red-400",children:L.connected?"Connected":"Disconnected"})]}),(0,jr.jsxs)("div",{className:"mt-1 text-slate-400",children:["Endpoint: ",L.endpoint||"N/A"]}),L.timestamp&&(0,jr.jsxs)("div",{className:"text-slate-400",children:["Last check: ",new Date(L.timestamp).toLocaleTimeString()]})]}),(0,jr.jsxs)("div",{className:"flex-1 max-h-40 overflow-y-auto p-2 md:p-3 space-y-2",children:[y.map(e=>{const t=(e=>{switch(e){case"api":return{icon:Gr,color:"text-green-400",label:"AI API"};case"error":return{icon:Xr,color:"text-red-400",label:"Error"};default:return{icon:K8,color:"text-blue-400",label:"System"}}})(e.source),n=t.icon;return(0,jr.jsx)("div",{className:`p-2 rounded-lg text-xs ${G(e)}`,children:(0,jr.jsxs)("div",{className:"flex items-start gap-1",children:[!e.isUser&&(0,jr.jsx)(n,{className:`w-3 h-3 mt-0.5 ${t.color} flex-shrink-0`}),(0,jr.jsxs)("div",{className:"flex-1",children:[(0,jr.jsx)("div",{className:"line-clamp-3",children:e.content}),(0,jr.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,jr.jsx)("div",{className:"text-xs text-slate-400",children:e.timestamp.toLocaleTimeString()}),!e.isUser&&(0,jr.jsx)("div",{className:`text-xs ${t.color}`,children:t.label})]})]})]})},e.id)}),v&&(0,jr.jsx)("div",{className:"bg-slate-700/50 text-slate-200 mr-4 p-2 rounded-lg",children:(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jr.jsxs)("div",{className:"flex gap-1",children:[(0,jr.jsx)("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-pulse delay-0"}),(0,jr.jsx)("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-pulse delay-100"}),(0,jr.jsx)("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-pulse delay-200"})]}),(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:k>0?`Retrying (${k}/2)...`:"Analyzing..."}),k>0&&(0,jr.jsx)(Br,{className:"w-3 h-3 text-yellow-400 animate-spin"})]})}),(0,jr.jsx)("div",{ref:F})]}),(0,jr.jsxs)("div",{className:"p-2 md:p-3 border-t border-blue-500/20",children:[(0,jr.jsxs)("div",{className:"flex gap-2",children:[(0,jr.jsx)("textarea",{value:P,onChange:e=>I(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j())},placeholder:"Ask about currents, waves, temperature...",className:"flex-1 h-12 md:h-16 bg-slate-700 border border-slate-600 rounded px-2 md:px-3 py-1 md:py-2 text-xs md:text-sm resize-none",rows:"2",disabled:v}),(0,jr.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jr.jsx)("button",{onClick:j,disabled:!P.trim()||v,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 disabled:cursor-not-allowed px-3 py-2 rounded text-xs md:text-sm transition-colors flex items-center justify-center",children:(0,jr.jsx)(z9,{className:"w-3 h-3 md:w-4 md:h-4"})}),k>0&&(0,jr.jsx)("button",{onClick:()=>{const e=[...y].reverse().find(e=>e.isUser);e&&(S("Analyzing..."),U(e.content).finally(()=>E()))},disabled:v,className:"bg-yellow-600 hover:bg-yellow-700 disabled:bg-slate-600 px-3 py-1 rounded text-xs transition-colors",title:"Retry last message",children:(0,jr.jsx)(Br,{className:"w-3 h-3"})})]})]}),(0,jr.jsxs)("div",{className:"flex gap-1 mt-2",children:[(0,jr.jsx)("button",{onClick:()=>I("What are the current conditions?"),className:"text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded text-slate-300 transition-colors",disabled:v,children:"Conditions"}),(0,jr.jsx)("button",{onClick:()=>I("Analyze wave patterns"),className:"text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded text-slate-300 transition-colors",disabled:v,children:"Waves"}),(0,jr.jsx)("button",{onClick:()=>I("Safety assessment"),className:"text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded text-slate-300 transition-colors",disabled:v,children:"Safety"}),(0,jr.jsx)("button",{onClick:B,className:"text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded text-slate-300 transition-colors ml-auto",title:"Refresh API status",children:(0,jr.jsx)(Br,{className:"w-3 h-3"})})]})]})]})]})};function B9(){const{error:e,isLoading:t,isAuthenticated:n}=Xn(),r=oe(),[o,s]=(0,i.useState)(null),[a,l]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(n)return console.log("Auth0 callback successful - user authenticated"),void r("/",{replace:!0});if(a||t)return;if("/auth/callback"===window.location.pathname){const t=new URLSearchParams(window.location.search),n=t.get("code"),i=t.get("error");i?(console.error("Auth0 callback URL error:",i),s(new Error(i)),setTimeout(()=>r("/",{replace:!0}),3e3)):n?(async()=>{try{console.log("Processing Auth0 callback for SPA..."),l(!0);const e=new URLSearchParams(window.location.search),t=e.get("error"),n=e.get("error_description");if(t)throw new Error(`${t}: ${n||"Unknown error"}`);console.log("Auth0 SPA callback processing complete"),r("/",{replace:!0})}catch(e){console.error("Error handling redirect callback:",e),s(e),setTimeout(()=>{r("/",{replace:!0})},3e3)}})():(console.warn("No authorization code found in callback URL"),setTimeout(()=>r("/",{replace:!0}),2e3))}},[r,t,n,a]),o||e?(0,jr.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-slate-900 text-white",children:(0,jr.jsxs)("div",{className:"text-center max-w-md",children:[(0,jr.jsx)("h2",{className:"text-xl font-semibold mb-4 text-red-400",children:"Authentication Error"}),(0,jr.jsx)("p",{className:"text-gray-300 mb-4",children:"There was an issue completing your login. You will be redirected automatically."}),(0,jr.jsx)("div",{className:"text-sm text-gray-500 bg-slate-800 p-3 rounded",children:(null===o||void 0===o?void 0:o.message)||(null===e||void 0===e?void 0:e.message)||"Unknown authentication error"})]})}):(0,jr.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-slate-900 text-white",children:(0,jr.jsxs)("div",{className:"text-center",children:[(0,jr.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500 mx-auto mb-4"}),(0,jr.jsx)("p",{className:"text-lg",children:"Completing login..."}),(0,jr.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Processing authorization code..."})]})})}const j9=e=>{let{onSuccess:t,inline:n=!1}=e;const[r,o]=(0,i.useState)(""),[s,a]=(0,i.useState)(""),l=e=>{e.preventDefault(),"U!nd37w4t3r@"===r?(a(""),t()):(a("Incorrect password. Please try again."),o(""))};return n?(0,jr.jsxs)("div",{className:"space-y-4",children:[(0,jr.jsxs)("form",{onSubmit:l,className:"space-y-4",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsx)("label",{htmlFor:"password",className:"block mb-2 text-sm font-medium text-slate-300 sr-only",children:"Password"}),(0,jr.jsx)("input",{type:"password",id:"password",name:"password",value:r,onChange:e=>o(e.target.value),placeholder:"Enter password",className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-md placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition",autoFocus:!0})]}),(0,jr.jsx)("button",{type:"submit",className:"w-full py-2 px-4 bg-pink-600 hover:bg-pink-700 rounded-md font-semibold text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-pink-500",children:"Unlock"})]}),s&&(0,jr.jsx)("p",{className:"text-center text-red-400 text-sm",children:s})]}):(0,jr.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-slate-900 text-white",children:(0,jr.jsxs)("div",{className:"w-full max-w-sm p-8 space-y-6 bg-slate-800 rounded-xl shadow-lg border border-pink-500/30",children:[(0,jr.jsx)("h1",{className:"text-2xl font-bold text-center",children:"Access Required"}),(0,jr.jsx)("p",{className:"text-center text-slate-400",children:"Please enter the password to continue."}),(0,jr.jsxs)("form",{onSubmit:l,className:"space-y-6",children:[(0,jr.jsxs)("div",{children:[(0,jr.jsx)("label",{htmlFor:"password",className:"block mb-2 text-sm font-medium text-slate-300 sr-only",children:"Password"}),(0,jr.jsx)("input",{type:"password",id:"password",name:"password",value:r,onChange:e=>o(e.target.value),placeholder:"Enter password",className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-md placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition",autoFocus:!0})]}),(0,jr.jsx)("button",{type:"submit",className:"w-full py-2 px-4 bg-pink-600 hover:bg-pink-700 rounded-md font-semibold text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-pink-500",children:"Unlock"})]}),s&&(0,jr.jsx)("p",{className:"mt-4 text-center text-red-400 text-sm",children:s})]})})},U9=e=>{let{isOpen:t=!1,onClose:n,title:r="Tutorial",children:o,size:s="default",position:a="center",showCloseButton:l=!0,closeOnBackdrop:c=!0,closeOnEscape:u=!0,className:h="",backdropClassName:d="",contentClassName:f=""}=e;const p=(0,i.useRef)(null),m=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(!t||!u)return;const e=e=>{"Escape"===e.key&&(null===n||void 0===n||n())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,u,n]),(0,i.useEffect)(()=>{if(!t)return;const e=p.current;if(!e)return;const n=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),r=n[0],i=n[n.length-1],o=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===r&&(null===i||void 0===i||i.focus(),e.preventDefault()):document.activeElement===i&&(null===r||void 0===r||r.focus(),e.preventDefault()))};return null===r||void 0===r||r.focus(),document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t]),(0,i.useEffect)(()=>(document.body.style.overflow=t?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[t]);return t?(0,jr.jsxs)("div",{ref:m,onClick:e=>{c&&e.target===m.current&&(null===n||void 0===n||n())},className:`fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex justify-center transition-opacity duration-300 ${(()=>{switch(a){case"top":return"items-start pt-16";case"bottom":return"items-end pb-16";default:return"items-center"}})()} ${d}`,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[(0,jr.jsxs)("div",{ref:p,className:`bg-slate-800/95 backdrop-blur-md border border-blue-400/50 rounded-xl shadow-2xl w-full ${(()=>{switch(s){case"sm":return"max-w-sm";case"lg":return"max-w-2xl";case"xl":return"max-w-4xl";case"full":return"max-w-full mx-4";default:return"max-w-md md:max-w-lg"}})()} max-h-[90vh] flex flex-col animate-modal-enter ${h}`,onClick:e=>e.stopPropagation(),children:[(0,jr.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-700/50 flex-shrink-0",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-3",children:[(0,jr.jsx)("div",{className:"w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center",children:(0,jr.jsx)(Zr,{className:"w-5 h-5 text-blue-400"})}),(0,jr.jsx)("h2",{id:"modal-title",className:"text-lg font-semibold text-blue-300",children:r})]}),l&&(0,jr.jsx)("button",{onClick:n,className:"text-slate-400 hover:text-white transition-colors p-1 rounded hover:bg-slate-700/50","aria-label":"Close modal",children:(0,jr.jsx)(KM,{className:"w-5 h-5"})})]}),(0,jr.jsx)("div",{className:`flex-1 overflow-hidden ${f}`,children:o})]}),(0,jr.jsx)("style",{jsx:!0,children:"\n        @keyframes modal-enter {\n          0% {\n            opacity: 0;\n            transform: scale(0.95) translateY(-20px);\n          }\n          100% {\n            opacity: 1;\n            transform: scale(1) translateY(0);\n          }\n        }\n\n        .animate-modal-enter {\n          animation: modal-enter 0.3s ease-out;\n        }\n      "})]}):null},V9=U9,G9=Dr("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),H9={GETTING_STARTED:"getting_started",BASIC_FEATURES:"basic_features",ADVANCED_FEATURES:"advanced_features",DATA_ANALYSIS:"data_analysis"},$9=[{id:"welcome",category:H9.GETTING_STARTED,title:"Welcome to CubeAI",subtitle:"Your comprehensive platform for ocean data analysis",description:"Interactive ocean data visualization and analysis platform.",content:"Welcome to the CubeAI - a powerful platform for exploring and analyzing ocean data in real-time.\n  \n  **What you'll learn:**\n  \u2022 Navigate ocean data visualizations and controls\n  \u2022 Interact with monitoring stations and environmental data\n  \u2022 Use AI-powered analysis for oceanographic insights\n  \u2022 Export and analyze time-series data\n  \u2022 Explore advanced mapping and 3D visualization features\n  \n  **This tutorial takes approximately 5-7 minutes.**\n  \n  The platform integrates real-time oceanographic data, advanced modeling, and AI analysis to support marine research, maritime operations, and coastal management.",icon:Fr,target:null,position:"center",actions:["next"],duration:30,category_color:"blue"},{id:"control-panel",category:H9.BASIC_FEATURES,title:"Master the Control Panel",subtitle:"Your command center for ocean data exploration",description:"Learn to navigate data controls, animation, and parameter selection.",content:"The Control Panel is your primary interface for controlling the oceanographic visualization:\n  \n  **\ud83c\udfaf Study Area Selection**\n  Choose geographic regions: MSP (Mississippi Sound), USM (University of Southern Mississippi), MBL (Marine Biology Laboratory)\n  \n  **\ud83c\udf0a Ocean Model Selection**\n  \u2022 NGOSF2: Northern Gulf of Mexico operational forecast\n  \u2022 ROMS: Regional Ocean Modeling System\n  \u2022 HYCOM: Hybrid Coordinate Ocean Model\n  \n  **\ud83d\udcca Parameter Controls**\n  Monitor various oceanographic parameters:\n  \u2022 Current Speed & Direction (m/s, degrees)\n  \u2022 Surface Elevation & Direction (m, degrees)  \n  \u2022 Temperature, Salinity, Pressure\n  \u2022 Wind Speed & Direction\n  \n  **\u23f0 Temporal Navigation**\n  \u2022 Date/Time selection for historical data\n  \u2022 Animation playback controls (play/pause/speed)\n  \u2022 Frame-by-frame navigation\n  \u2022 Loop modes (repeat, once, bounce)\n  \n  **\ud83d\udccf Depth Selection**\n  Choose measurement depths from surface (0ft) to deep water (200+ ft) to analyze vertical ocean structure.\n  \n  **Try changing the playback speed or selecting different parameters to see live updates.**",icon:Wr,target:'[data-tutorial="control-panel"]',position:"bottom",actions:["prev","next"],highlight:!0,duration:45,tips:["Use keyboard shortcuts: Space for play/pause, arrow keys for frame navigation","Higher playback speeds help identify trends over longer time periods","Different depths reveal stratified ocean structure"]},{id:"map-interaction",category:H9.BASIC_FEATURES,title:"Interactive Ocean Mapping",subtitle:"Explore stations, currents, and environmental layers",description:"Navigate the map, interact with monitoring stations, and customize layers.",content:"The interactive map provides comprehensive ocean visualization with multiple data layers and controls:\n  \n  **\ud83d\uddfa\ufe0f Map Controls & Styles**\n  \u2022 Satellite, Dark, Outdoors, Streets view modes\n  \u2022 Globe projection with auto-rotation option\n  \u2022 Zoom and pan controls with touch/mouse support\n  \u2022 Global view and station zoom buttons\n  \n  **\ud83c\udfaf Monitoring Stations**\n  \u2022 Colored markers represent data collection stations\n  \u2022 Click stations to view detailed information\n  \u2022 Station colors indicate data density/quality\n  \u2022 Real ocean monitoring locations vs simulated data\n  \n  **\ud83c\udf2c\ufe0f Wind Visualization**\n  \u2022 **Live Wind Particles**: Real-time wind data visualization\n  \u2022 **Wind Vectors**: Synthetic wind pattern display  \n  \u2022 Adjustable particle count, speed, and fade settings\n  \u2022 Color-coded wind speeds (light air to storm conditions)\n  \n  **\ud83c\udf0a Oceanographic Layers**\n  \u2022 **Bathymetry**: Ocean depth visualization (-11,000m to surface)\n  \u2022 **Sea Surface Temperature**: MODIS satellite data overlay\n  \u2022 **Ocean Current Vectors**: Real-time flow direction and speed\n  \u2022 **Ocean Base Layer**: ArcGIS oceanographic reference map\n  \n  **\ud83d\udccd HoloOcean Integration**\n  \u2022 Green POV marker shows 3D simulation viewpoint\n  \u2022 Click anywhere to update simulation perspective\n  \u2022 Coordinate system for underwater environment\n  \n  **\ud83d\udca1 Pro Tips:**\n  \u2022 Enable globe auto-rotation for global exploration\n  \u2022 Combine multiple layers for comprehensive analysis\n  \u2022 Use wind particles for real-time atmospheric conditions",icon:pc,target:'[data-tutorial="map-container"]',position:"right",actions:["prev","next"],highlight:!0,duration:60,tips:["Right-click and drag to rotate the 3D globe view","Station validation shows whether locations are on water vs land","Wind particle density affects performance - adjust for your device"]},{id:"data-panels",category:H9.DATA_ANALYSIS,title:"Environmental Data Analysis",subtitle:"Real-time monitoring and trend analysis",description:"Understand environmental readings, time-series charts, and data quality.",content:"The Data Panels provide comprehensive environmental monitoring and analysis tools:\n  \n  **\ud83d\udcca Environmental Data Dashboard**\n  Real-time sensor readings with quality indicators:\n  \u2022 **Temperature**: Water temperature in \xb0F with depth correlation\n  \u2022 **Salinity**: Practical Salinity Units (PSU) for water density\n  \u2022 **Pressure**: Depth pressure in decibars (dbar)\n  \u2022 **Sensor Depth**: Current measurement depth in meters\n  \n  **\ud83d\udcc8 Time Series Analysis**\n  Interactive charts showing temporal trends:\n  \u2022 **Current Speed Trends**: Flow velocity over time (m/s)\n  \u2022 **Sound Speed Variations**: Acoustic velocity changes (m/s)\n  \u2022 **Surface Elevation (SSH) Patterns**: Sea surface elevation (m)\n  \u2022 **Temperature Fluctuations**: Thermal structure changes (\xb0F)\n  \n  **\ud83c\udfae HoloOcean 3D Visualization**\n  Immersive underwater environment simulation:\n  \u2022 Interactive depth profiling from surface to selected depth\n  \u2022 Real-time parameter visualization in 3D space\n  \u2022 WebRTC streaming for collaborative analysis\n  \u2022 POV coordinate system for spatial navigation\n  \n  **\u2699\ufe0f Data Quality Assessment**\n  \u2022 Real-time vs Historical data indicators\n  \u2022 Connection status monitoring\n  \u2022 Data freshness timestamps\n  \u2022 Station validation and reliability metrics\n  \n  **\ud83d\udd27 Customization Options**\n  \u2022 Adjustable time ranges: 12h/24h/48h views\n  \u2022 Parameter selection for focused analysis\n  \u2022 Refresh data capability\n  \u2022 Mobile-responsive charts and controls\n  \n  **Advanced Features:**\n  \u2022 API integration for historical analysis\n  \u2022 Multi-parameter correlation detection\n  \u2022 Export capabilities for external analysis",icon:QM,target:'[data-tutorial="data-panels"]',position:"left",actions:["prev","next"],highlight:!0,duration:50,tips:["Longer time ranges reveal seasonal patterns","Temperature gradients indicate thermocline depth","Sound speed affects sonar and acoustic equipment"]},{id:"output-module",category:H9.DATA_ANALYSIS,title:"Analysis Output & History",subtitle:"Track insights and export analysis results",description:"Manage AI analysis responses, export data, and review insights.",content:"The Output Module serves as your analysis command center and historical record:\n  \n  **\ud83d\udcdd Response Management**\n  \u2022 Complete history of AI analysis responses\n  \u2022 Automatic categorization (charts, tables, text analysis)\n  \u2022 Expandable/collapsible interface for space optimization\n  \u2022 Context preservation for each analysis\n  \n  **\ud83d\udd0d Filtering & Organization**\n  Smart filtering options:\n  \u2022 **All Responses**: Complete analysis history\n  \u2022 **Charts & Trends**: Graphical analysis results\n  \u2022 **Data & Tables**: Structured data presentations  \n  \u2022 **Text Analysis**: Narrative insights and recommendations\n  \n  **\ud83d\udcca Interactive Content**\n  Dynamic response enhancement:\n  \u2022 Auto-generated charts based on analysis context\n  \u2022 Environmental data tables with current conditions\n  \u2022 Parameter-specific visualizations\n  \u2022 Time-stamped analysis metadata\n  \n  **\ud83d\udcbe Export & Sharing**\n  Professional data export capabilities:\n  \u2022 JSON format for technical analysis\n  \u2022 Copy responses to clipboard\n  \u2022 Downloadable analysis reports\n  \u2022 Shareable insights for collaboration\n  \n  **\ud83d\udd04 Analysis Context Tracking**\n  Each response includes complete context:\n  \u2022 Current frame and temporal position\n  \u2022 Selected parameters and depth settings\n  \u2022 Environmental conditions at time of analysis\n  \u2022 Data source and quality metrics\n  \n  **\u26a1 Real-time Integration**\n  \u2022 Responses appear simultaneously in chat and output module\n  \u2022 Live updates during parameter changes\n  \u2022 Automatic context awareness for relevant insights\n  \n  **Pro Features:**\n  \u2022 Search through analysis history\n  \u2022 Bookmark important insights\n  \u2022 Export multiple responses as compiled report",icon:zr,target:'[data-tutorial="output-module"]',position:"left",actions:["prev","next"],highlight:!0,duration:40,tips:["Use filters to quickly find specific types of analysis","Export responses for inclusion in research reports","Context metadata helps reproduce analysis conditions"]},{id:"chatbot",category:H9.BASIC_FEATURES,title:"CubeAI Assistant",subtitle:"Intelligent oceanographic analysis and insights",description:"Master AI-powered analysis with natural language queries.",content:'CubeAI is your expert oceanographic analyst, providing intelligent insights about marine conditions:\n  \n  **\ud83e\udd16 Natural Language Interface**\n  Ask questions in plain English about:\n  \u2022 Current oceanographic conditions\n  \u2022 Weather and sea state analysis  \n  \u2022 Safety assessments for maritime operations\n  \u2022 Predictive forecasting and trend analysis\n  \u2022 Equipment recommendations and operational guidance\n  \n  **\ud83d\udcca Context-Aware Analysis**\n  CubeAI automatically considers:\n  \u2022 Your current parameter selections (depth, location, time)\n  \u2022 Real-time environmental data\n  \u2022 Historical trends and patterns\n  \u2022 Model outputs and confidence levels\n  \u2022 Data source quality and reliability\n  \n  **\ud83d\udd0d Specialized Capabilities**\n  \u2022 **Marine Safety**: Risk assessments for vessel operations\n  \u2022 **Environmental Analysis**: Temperature gradients, salinity fronts\n  \u2022 **Operational Forecasting**: 6-12 hour condition predictions\n  \u2022 **Research Support**: USM academic collaboration features\n  \u2022 **Data Interpretation**: Complex oceanographic phenomenon explanation\n  \n  **\ud83d\udcac Quick Query Examples**\n  Try these conversation starters:\n  \u2022 *"What are the current conditions?"*\n  \u2022 *"Analyze wave patterns for small boat safety"*\n  \u2022 *"Predict conditions for the next 6 hours"*\n  \u2022 *"How does temperature vary with depth?"*\n  \u2022 *"Is it safe for diving operations?"*\n  \u2022 *"Compare today\'s data to historical averages"*\n  \n  **\ud83c\udfaf Smart Suggestions**\n  \u2022 Quick-access buttons for common queries\n  \u2022 Context-sensitive question prompts\n  \u2022 Follow-up question recommendations\n  \u2022 Parameter adjustment suggestions\n  \n  **\u26a1 Integration Features**\n  \u2022 Responses automatically saved to Output Module\n  \u2022 Real-time data incorporation\n  \u2022 Cross-platform compatibility\n  \u2022 Mobile-optimized interface',icon:K8,target:'[data-tutorial="chatbot"]',position:"left",actions:["prev","next"],highlight:!0,duration:45,tips:["Be specific about location and conditions for best results","Ask follow-up questions to dive deeper into analysis","CubeAI learns from your current settings and selections"]},{id:"advanced-features",category:H9.ADVANCED_FEATURES,title:"Advanced Platform Features",subtitle:"Power user capabilities and hidden features",description:"Unlock advanced analysis tools and professional workflows.",content:'Discover powerful features for advanced oceanographic analysis and research:\n  \n  **\ud83c\udfaf Station Deep Analysis**\n  Professional monitoring station analysis:\n  \u2022 Click any station \u2192 "Analyze Station Data" for comprehensive reports\n  \u2022 Multi-parameter correlation analysis\n  \u2022 Data quality validation and reliability assessment\n  \u2022 Historical trend analysis with statistical confidence\n  \u2022 CSV export for external processing (research/reports)\n  \n  **\ud83c\udf0d Global Ocean Exploration**\n  Advanced mapping and visualization:\n  \u2022 **Globe Mode**: Worldwide ocean exploration with projection switching\n  \u2022 **Auto-rotation**: Continuous global scanning mode\n  \u2022 **Multi-scale Analysis**: Seamless zoom from global to local scales\n  \u2022 **Custom Projections**: Mercator, orthographic, stereographic views\n  \n  **\ud83d\udcca Data Management & Quality Control**\n  Professional data handling:\n  \u2022 **Real-time Quality Monitoring**: Connection status and data freshness\n  \u2022 **Data Validation**: Ocean vs land position verification\n  \u2022 **Performance Optimization**: Adaptive loading for large datasets\n  \n  **\ud83d\udd27 Research & Collaboration Tools**\n  Academic and professional features:\n  \u2022 **USM Integration**: University of Southern Mississippi research support\n  \u2022 **Export Capabilities**: NetCDF, MATLAB, CSV formats for analysis\n  \u2022 **API Documentation**: Programmatic access for researchers\n  \u2022 **Collaborative Analysis**: Shared sessions and viewpoints\n  \n  **\ud83d\udcf1 Mobile & Accessibility**\n  Cross-platform optimization:\n  \u2022 **Touch Controls**: Optimized for tablets and smartphones\n  \u2022 **Responsive Design**: Adaptive layouts for any screen size\n  \u2022 **Gesture Support**: Pinch-zoom, swipe navigation\n  \u2022 **Offline Capability**: Cached data for field operations\n  \n  **\u2699\ufe0f Customization & Automation**\n  Power user configuration:\n  \u2022 **Custom Layer Combinations**: Save preferred visualization setups\n  \u2022 **Automated Monitoring**: Set alerts for condition changes\n  \u2022 **Batch Processing**: Analyze multiple time periods simultaneously\n  \u2022 **Integration APIs**: Connect with external monitoring systems',icon:mc,target:null,position:"center",actions:["prev","next"],duration:60,tips:["Station validation ensures data quality in research applications","Export data in academic formats for peer-reviewed publications","Mobile optimization allows field data collection and analysis"]},{id:"completion",category:H9.GETTING_STARTED,title:"Tutorial Complete! \ud83c\udf89",subtitle:"You're ready for professional ocean data analysis",description:"Summary of learned features and next steps for exploration.",content:"Congratulations! You've mastered the CubeAI platform.\n  \n  **\ud83c\udf93 Skills Acquired:**\n  \u2705 **Control Panel Navigation** - Parameter selection, temporal controls, animation\n  \u2705 **Interactive Mapping** - Station analysis, layer management, global exploration\n  \u2705 **Data Analysis** - Environmental monitoring, time-series interpretation, quality assessment\n  \u2705 **AI-Powered Insights** - Natural language queries, predictive analysis, safety assessment\n  \u2705 **Advanced Features** - Export capabilities, research tools, mobile optimization\n  \n  **\ud83d\ude80 Next Steps for Exploration:**\n  \u2022 **Explore Your Region**: Focus on local waters and monitoring stations\n  \u2022 **Ask Complex Questions**: Use CubeAI for advanced oceanographic analysis\n  \u2022 **Compare Time Periods**: Analyze seasonal patterns and long-term trends\n  \u2022 **Export for Research**: Generate data for academic or operational use\n  \n  **\ud83d\udd27 Professional Applications:**\n  \u2022 **Marine Operations**: Safety assessments and route planning\n  \u2022 **Research Projects**: Data analysis for scientific publications\n  \u2022 **Environmental Monitoring**: Coastal and offshore condition tracking\n  \u2022 **Education**: Interactive learning for marine science students\n  \u2022 **Emergency Response**: Real-time conditions for maritime incidents\n  \n  **\ud83d\udcda Additional Resources:**\n  \u2022 Access this tutorial anytime via Settings \u2192 Tutorial\n  \u2022 Check the Documentation section for API details\n  \u2022 Contact USM Maritime Technology Solutions for research collaboration\n  \u2022 Join the CubeAI community for updates and support\n  \n  **Ready to dive deep into ocean data analysis! \ud83c\udf0a**\n  \n  *The ocean holds countless secrets - this platform helps you discover them.*",icon:G9,target:null,position:"center",actions:["prev","complete","restart"],duration:45,category_color:"green"}];const W9=e=>{let{isOpen:t=!1,onClose:n,onComplete:r,tutorialStep:o=0,onStepChange:s,className:a=""}=e;const[l,c]=(0,i.useState)(o),[u,h]=(0,i.useState)(!1),[d,f]=(0,i.useState)(new Set),p=$9,m=p[l],g=e=>{e>=0&&e<p.length&&(h(!0),setTimeout(()=>{c(e),f(e=>new Set([...e,l])),null===s||void 0===s||s(e),h(!1)},150))},_=()=>g(l+1),y=()=>g(l-1);if((0,i.useEffect)(()=>{const e=e=>{if(t)switch(e.key){case"ArrowRight":case"Enter":m.actions.includes("next")&&_();break;case"ArrowLeft":m.actions.includes("prev")&&y()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,l,m]),!t)return null;m.icon;return(0,jr.jsx)(V9,{isOpen:t,onClose:n,title:m.title,className:a,children:(0,jr.jsxs)("div",{className:"flex flex-col h-full",children:[(0,jr.jsx)("div",{className:"px-4 pb-2 border-b border-slate-700/50",children:(0,jr.jsxs)("p",{className:"text-xs text-slate-400",children:["Step ",l+1," of ",p.length,": ",m.subtitle]})}),(0,jr.jsxs)("div",{className:"px-4 py-2",children:[(0,jr.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-2",children:(0,jr.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full transition-all duration-500",style:{width:(l+1)/p.length*100+"%"}})}),(0,jr.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,jr.jsx)("span",{className:"text-xs text-slate-400",children:"Progress"}),(0,jr.jsxs)("span",{className:"text-xs text-blue-300",children:[Math.round((l+1)/p.length*100),"%"]})]})]}),(0,jr.jsx)("div",{className:"p-4 transition-opacity duration-150 flex-1 overflow-y-auto "+(u?"opacity-50":"opacity-100"),children:(0,jr.jsx)("div",{className:"max-h-64 overflow-y-auto",children:(0,jr.jsx)("div",{className:"text-sm text-slate-200 leading-relaxed whitespace-pre-line",children:m.content})})}),(0,jr.jsxs)("div",{className:"flex items-center justify-between p-4 border-t border-slate-700/50 flex-shrink-0",children:[(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[m.actions.includes("prev")&&(0,jr.jsxs)("button",{onClick:y,disabled:0===l,className:"flex items-center gap-2 px-3 py-2 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:[(0,jr.jsx)(X8,{className:"w-4 h-4"}),"Previous"]}),m.actions.includes("restart")&&(0,jr.jsxs)("button",{onClick:()=>{c(0),f(new Set),null===s||void 0===s||s(0)},className:"flex items-center gap-2 px-3 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg transition-colors text-sm",children:[(0,jr.jsx)(bc,{className:"w-4 h-4"}),"Restart"]})]}),(0,jr.jsxs)("div",{className:"flex items-center gap-2",children:[m.actions.includes("next")&&(0,jr.jsxs)("button",{onClick:_,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors text-sm font-medium",children:["Next",(0,jr.jsx)(q8,{className:"w-4 h-4"})]}),m.actions.includes("complete")&&(0,jr.jsxs)("button",{onClick:()=>{f(e=>new Set([...e,l])),null===r||void 0===r||r()},className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors text-sm font-medium",children:[(0,jr.jsx)(G9,{className:"w-4 h-4"}),"Complete Tutorial"]})]})]}),(0,jr.jsx)("div",{className:"flex justify-center gap-2 p-4 pt-0",children:p.map((e,t)=>(0,jr.jsx)("button",{onClick:()=>g(t),className:"w-2 h-2 rounded-full transition-all duration-200 "+(t===l?"bg-blue-400 w-6":d.has(t)?"bg-green-500":"bg-slate-600 hover:bg-slate-500"),"aria-label":`Go to step ${t+1}`},t))})]})})},q9=Dr("mouse-pointer",[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]]),X9=e=>{let{isActive:t=!1,targetSelector:n=null,highlightType:r="spotlight",overlayOpacity:o=.7,spotlightPadding:s=8,animationDuration:a=300,showPointer:l=!1,pointerText:c=null,onTargetClick:u=null,className:h=""}=e;const[d,f]=(0,i.useState)(null),[p,m]=(0,i.useState)(!1),g=(0,i.useRef)(null),_=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(!t||!n)return f(null),void m(!1);const e=()=>{const e=document.querySelector(n);return e?(y(e),m(!0),e):null};let r=e();if(!r){const t=setTimeout(()=>{r=e()},100);return()=>clearTimeout(t)}r&&window.ResizeObserver&&(_.current=new ResizeObserver(()=>{y(r)}),_.current.observe(r));const i=new MutationObserver(()=>{const e=document.querySelector(n);e&&e!==r&&(r=e,y(r))});return i.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}),()=>{_.current&&_.current.disconnect(),i.disconnect()}},[t,n]);const y=e=>{if(!e)return;const t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;f({top:t.top+r,left:t.left+n,width:t.width,height:t.height,right:t.right+n,bottom:t.bottom+r,centerX:t.left+n+t.width/2,centerY:t.top+r+t.height/2})};(0,i.useEffect)(()=>{const e=()=>{if(n){const e=document.querySelector(n);e&&y(e)}};return window.addEventListener("resize",e),window.addEventListener("scroll",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e)}},[n]);if(!t||!p||!d)return null;const v=()=>{const e=Math.max(document.documentElement.clientWidth,window.innerWidth),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),r=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),i=Math.max(e,r),o=Math.max(t,n),a=d.left-s,l=d.top-s,c=d.width+2*s,u=d.height+2*s;return`\n      M 0,0 \n      L ${i},0 \n      L ${i},${o} \n      L 0,${o} \n      Z \n      M ${a},${l} \n      L ${a+c},${l} \n      L ${a+c},${l+u} \n      L ${a},${l+u} \n      Z\n    `};return(0,jr.jsxs)("div",{ref:g,className:`fixed inset-0 z-[1000] transition-opacity duration-${a} ${h}`,onClick:e=>{if(d&&u){const t=e.clientX+window.pageXOffset,n=e.clientY+window.pageYOffset;t>=d.left&&t<=d.right&&n>=d.top&&n<=d.bottom&&u(e)}},style:{pointerEvents:u?"auto":"none"},children:[(()=>{switch(r){case"spotlight":return(0,jr.jsxs)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{width:"100vw",height:Math.max(document.documentElement.scrollHeight,window.innerHeight)},children:[(0,jr.jsx)("defs",{children:(0,jr.jsxs)("filter",{id:"spotlight-glow",children:[(0,jr.jsx)("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),(0,jr.jsxs)("feMerge",{children:[(0,jr.jsx)("feMergeNode",{in:"coloredBlur"}),(0,jr.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})}),(0,jr.jsx)("path",{d:v(),fill:`rgba(0, 0, 0, ${o})`,fillRule:"evenodd"}),(0,jr.jsx)("rect",{x:d.left-s,y:d.top-s,width:d.width+2*s,height:d.height+2*s,fill:"none",stroke:"rgba(59, 130, 246, 0.8)",strokeWidth:"2",filter:"url(#spotlight-glow)",rx:"8"})]});case"outline":return(0,jr.jsxs)(jr.Fragment,{children:[(0,jr.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundColor:`rgba(0, 0, 0, ${o})`,width:"100vw",height:Math.max(document.documentElement.scrollHeight,window.innerHeight)}}),(0,jr.jsx)("div",{className:"absolute border-2 border-blue-400 rounded-lg pointer-events-none animate-pulse",style:{left:d.left-s,top:d.top-s,width:d.width+2*s,height:d.height+2*s,boxShadow:"0 0 20px rgba(59, 130, 246, 0.6)",zIndex:1001}})]});case"glow":return(0,jr.jsx)("div",{className:"absolute rounded-lg pointer-events-none animate-pulse",style:{left:d.left-s,top:d.top-s,width:d.width+2*s,height:d.height+2*s,boxShadow:"\n                0 0 0 4px rgba(59, 130, 246, 0.4),\n                0 0 0 8px rgba(59, 130, 246, 0.2),\n                0 0 20px rgba(59, 130, 246, 0.6),\n                inset 0 0 20px rgba(59, 130, 246, 0.1)\n              ",background:"rgba(59, 130, 246, 0.05)",zIndex:1001}});case"pulse":return(0,jr.jsxs)("div",{className:"absolute rounded-lg pointer-events-none",style:{left:d.left-s,top:d.top-s,width:d.width+2*s,height:d.height+2*s,zIndex:1001},children:[(0,jr.jsx)("div",{className:"absolute inset-0 border-2 border-blue-400 rounded-lg animate-ping opacity-75"}),(0,jr.jsx)("div",{className:"absolute inset-2 border-2 border-blue-300 rounded-lg animate-pulse opacity-60"}),(0,jr.jsx)("div",{className:"absolute inset-4 bg-blue-400/20 rounded-lg animate-pulse"})]});default:return null}})(),l&&(0,jr.jsx)("div",{className:"absolute pointer-events-none z-[1002]",style:{left:d.centerX,top:d.bottom+20,transform:"translateX(-50%)"},children:(0,jr.jsxs)("div",{className:"flex flex-col items-center",children:[(0,jr.jsx)(q9,{className:"w-6 h-6 text-blue-400 animate-bounce"}),c&&(0,jr.jsx)("div",{className:"mt-2 px-3 py-2 bg-slate-800/90 border border-blue-400/50 rounded-lg backdrop-blur-sm",children:(0,jr.jsx)("p",{className:"text-sm text-blue-300 whitespace-nowrap",children:c})})]})}),(0,jr.jsx)("div",{className:"absolute pointer-events-none",style:{left:d.left-s-12,top:d.top-s-12},children:(0,jr.jsx)(q0,{className:"w-6 h-6 text-blue-400 animate-spin",style:{animationDuration:"3s"}})}),(0,jr.jsx)("style",{jsx:!0,children:"\n        @keyframes breathe {\n          0%, 100% {\n            transform: scale(1);\n            opacity: 0.8;\n          }\n          50% {\n            transform: scale(1.05);\n            opacity: 1;\n          }\n        }\n\n        .animate-breathe {\n          animation: breathe 2s ease-in-out infinite;\n        }\n      "})]})},Z9=X9,K9=e=>({1:'[data-tutorial="control-panel"]',2:'[data-tutorial="map-container"]',3:'[data-tutorial="data-panels"]',4:'[data-tutorial="output-module"]',5:'[data-tutorial="chatbot"]',6:'[data-tutorial="holoocean-panel"]'}[e]||null),Y9=()=>{var e,t;const[n,r]=(0,i.useState)(!0),[o,s]=(0,i.useState)(!1),a=ti();return(0,i.useEffect)(()=>{a.connectionStatus&&a.connectionStatus.checkAPIStatus&&a.connectionStatus.checkAPIStatus()},[a.connectionStatus]),(0,i.useEffect)(()=>{a.dataLoaded&&a.connectionStatus&&!a.connectionStatus.connected&&!o&&!a.connectionStatus.hasApiKey&&a.connectionStatus.endpoint&&s(!0)},[a.dataLoaded,a.connectionStatus,o]),(0,jr.jsxs)("div",{className:"bg-slate-900 text-white min-h-screen",children:[(0,jr.jsx)(mi,{dataSource:a.dataSource,timeZone:a.timeZone,onTimeZoneChange:a.setTimeZone,connectionStatus:a.connectionStatus,dataQuality:a.dataQuality,showDataStatus:!0,showTutorial:a.showTutorial,onTutorialToggle:a.handleTutorialToggle,tutorialStep:a.tutorialStep,isFirstTimeUser:a.isFirstTimeUser,apiStatus:a.connectionStatus,apiMetrics:a.connectionDetails,chatMetrics:(null===(e=a.chatMessages)||void 0===e?void 0:e.length)||0,onShowApiConfig:()=>s(!0),onResetApiMetrics:()=>{}}),(0,jr.jsxs)("main",{className:"flex-1 flex flex-col min-h-0",children:[(0,jr.jsx)("section",{className:"border-b border-pink-500/30 flex-shrink-0",children:(0,jr.jsx)(Tc,{"data-tutorial":"control-panel",isLoading:a.isLoading,availableModels:a.availableModels,availableDepths:a.availableDepths,dataLoaded:a.dataLoaded,selectedArea:a.selectedArea,selectedModel:a.selectedModel,selectedDepth:a.selectedDepth,startDate:a.startDate,endDate:a.endDate,timeZone:a.timeZone,currentFrame:a.currentFrame,isPlaying:a.isPlaying,playbackSpeed:a.playbackSpeed,loopMode:a.loopMode,holoOceanPOV:a.holoOceanPOV,availableDates:a.availableDates,availableTimes:a.availableTimes,totalFrames:a.totalFrames,data:a.data,mapLayerVisibility:a.mapLayerVisibility,isSstHeatmapVisible:a.isSstHeatmapVisible,currentsVectorScale:a.currentsVectorScale,currentsColorBy:a.currentsColorBy,onAreaChange:a.setSelectedArea,onModelChange:a.setSelectedModel,onDepthChange:a.setSelectedDepth,onDateRangeChange:a.onDateRangeChange,onTimeZoneChange:a.setTimeZone,onPlayToggle:a.handlePlayToggle,onSpeedChange:a.setPlaybackSpeed,onLoopModeChange:a.setLoopMode,onFrameChange:a.handleFrameChange,onReset:a.handleReset,onSquery:a.refreshData,onLayerToggle:a.toggleMapLayer,onSstHeatmapToggle:a.toggleSstHeatmap,onCurrentsScaleChange:a.handleCurrentsScaleChange,onCurrentsColorChange:a.handleCurrentsColorChange,heatmapScale:a.heatmapScale,onHeatmapScaleChange:a.onHeatmapScaleChange,apiStatus:a.connectionStatus,windVelocityParticleCount:a.windVelocityParticleCount,onWindVelocityParticleCountChange:a.onWindVelocityParticleCountChange,windVelocityParticleOpacity:a.windVelocityParticleOpacity,onWindVelocityParticleOpacityChange:a.onWindVelocityParticleOpacityChange,windVelocityParticleSpeed:a.windVelocityParticleSpeed,onWindVelocityParticleSpeedChange:a.onWindVelocityParticleSpeedChange})}),(0,jr.jsxs)("section",{className:"flex h-96 md:h-[500px] lg:h-[600px] min-h-0",children:[(0,jr.jsx)("div",{className:"relative min-h-0 h-full transition-all duration-300 "+(n?"flex-1":"w-1/2"),children:(0,jr.jsx)(G0,{"data-tutorial":"map-container",stationData:a.stationData,timeSeriesData:a.timeSeriesData,rawData:a.rawData,currentsGeoJSON:a.currentsGeoJSON,currentFrame:a.currentFrame,selectedDepth:a.selectedDepth,selectedArea:a.selectedArea,holoOceanPOV:a.holoOceanPOV,onPOVChange:a.setHoloOceanPOV,onDepthChange:a.setSelectedDepth,onStationSelect:a.setSelectedStation,onEnvironmentUpdate:a.setEnvData,currentDate:a.currentDate,currentTime:a.currentTime,mapLayerVisibility:a.mapLayerVisibility,isSstHeatmapVisible:a.isSstHeatmapVisible,currentsVectorScale:a.currentsVectorScale,currentsColorBy:a.currentsColorBy,heatmapScale:a.heatmapScale,mapboxToken:"pk.eyJ1Ijoiam1wYXVsbWFwYm94IiwiYSI6ImNtZHh0ZmR6MjFoaHIyam9vZmJ4Z2x1MDYifQ.gR60szhfKWhTv8MyqynpVA",isOutputCollapsed:n,availableDepths:a.availableDepths,windVelocityParticleCount:a.windVelocityParticleCount,windVelocityParticleOpacity:a.windVelocityParticleOpacity,windVelocityParticleSpeed:a.windVelocityParticleSpeed})}),(0,jr.jsx)("div",{className:"relative min-h-0 h-full transition-all duration-300 "+(n?"w-1/5":"w-1/2"),children:(0,jr.jsx)(N9,{"data-tutorial":"output-module",chatMessages:a.chatMessages,timeSeriesData:a.timeSeriesData,currentFrame:a.currentFrame,selectedDepth:a.selectedDepth,isTyping:a.isTyping,isCollapsed:n,onToggleCollapse:()=>r(!n),apiStatus:a.connectionStatus,apiMetrics:a.connectionDetails,chatMetrics:(null===(t=a.chatMessages)||void 0===t?void 0:t.length)||0})})]}),(0,jr.jsx)("section",{className:"border-t border-green-500/30",children:(0,jr.jsx)(A1,{"data-tutorial":"data-panels",envData:a.envData,holoOceanPOV:a.holoOceanPOV,selectedDepth:a.selectedDepth,timeSeriesData:a.timeSeriesData,currentFrame:a.currentFrame,data:a.data,availableDepths:a.availableDepths,onDepthChange:a.setSelectedDepth,onPOVChange:a.setHoloOceanPOV,onRefreshData:a.refreshData,apiStatus:a.connectionStatus})})]}),(0,jr.jsx)(F9,{"data-tutorial":"chatbot",timeSeriesData:a.timeSeriesData,data:a.data,dataSource:a.dataSource,selectedDepth:a.selectedDepth,availableDepths:a.availableDepths,selectedArea:a.selectedArea,selectedModel:a.selectedModel,playbackSpeed:a.playbackSpeed,currentFrame:a.currentFrame,holoOceanPOV:a.holoOceanPOV,envData:a.envData,timeZone:a.timeZone,startDate:a.startDate,endDate:a.endDate,onAddMessage:a.addChatMessage,apiStatus:a.connectionStatus,apiConfig:a.connectionDetails}),(0,jr.jsx)(W9,{isOpen:a.showTutorial,onClose:a.handleTutorialToggle,onComplete:a.handleTutorialComplete,tutorialStep:a.tutorialStep,onStepChange:a.handleTutorialStepChange}),(0,jr.jsx)(Z9,{isActive:a.showTutorial,targetSelector:K9(a.tutorialStep),highlightType:"spotlight",showPointer:a.tutorialStep>0})]})},J9=()=>{const{isAuthenticated:e,isLoading:t,user:n}=Xn(),[r,o]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(e&&n){const e="84cbc5c3605411e6c07567dc4960b8d23fb159995cb73711c8058c45982bdab7",t=n.sub;if(e){(e=>{mr=e})(Kn().PBKDF2(e,t,{keySize:8,iterations:1e3}).toString())}else console.warn("REACT_APP_AUTH0_SECRET is not set. Local storage will not be encrypted.")}},[e,n]),t?(0,jr.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-slate-900 text-white",children:"Loading..."}):r||e?(0,jr.jsx)(ni,{authMethod:e?"auth0":"password",children:(0,jr.jsx)(Y9,{})}):(0,jr.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-slate-900 text-white",children:[(0,jr.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Welcome to the Oceanographic Platform"}),(0,jr.jsxs)("div",{className:"w-full max-w-md space-y-8",children:[(0,jr.jsxs)("div",{className:"bg-slate-800 rounded-xl shadow-lg border border-pink-500/30 p-6",children:[(0,jr.jsx)("h2",{className:"text-xl font-semibold mb-4 text-center",children:"Login with Password"}),(0,jr.jsx)(j9,{onSuccess:()=>o(!0),inline:!0})]}),(0,jr.jsxs)("div",{className:"relative",children:[(0,jr.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,jr.jsx)("div",{className:"w-full border-t border-slate-600"})}),(0,jr.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,jr.jsx)("span",{className:"px-4 bg-slate-900 text-slate-400",children:"OR"})})]}),(0,jr.jsxs)("div",{className:"bg-slate-800 rounded-xl shadow-lg border border-pink-500/30 p-6",children:[(0,jr.jsx)("h2",{className:"text-xl font-semibold mb-4 text-center",children:"Login with Auth0"}),(0,jr.jsx)(di,{})]})]})]})},Q9=()=>(0,jr.jsxs)(Ee,{children:[(0,jr.jsx)(we,{path:"/auth/callback",element:(0,jr.jsx)(B9,{})}),(0,jr.jsx)(we,{path:"/*",element:(0,jr.jsx)(J9,{})})]}),eee=e=>{let{children:t}=e;const n="https://dev-iehguv204612q2sk.us.auth0.com",r="RSiNbEo6RBx6Mxq0PT9YvbCXJKN7HG17",i={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BASE_URL:"https://demo-chat.isdata.ai",REACT_APP_HOLOOCEAN_ENDPOINT:"ws://bluemvmt-holoocean-1-ws.ngrok.dev",REACT_APP_DB:"isdata-usmcom.usm_com",REACT_APP_MAPBOX_ACCESS_TOKEN:"pk.eyJ1Ijoiam1wYXVsbWFwYm94IiwiYSI6ImNtZHh0ZmR6MjFoaHIyam9vZmJ4Z2x1MDYifQ.gR60szhfKWhTv8MyqynpVA",REACT_APP_CHAT_API_KEY:"test",REACT_APP_BEARER_TOKEN:"0S0290SN1929VM192SDSsld239092@%^&*341267812",REACT_APP_ACCESS_PASSWORD:"U!nd37w4t3r@",REACT_APP_LOCAL_STORAGE_SECRET:"local",REACT_APP_AUTH0_SECRET:"84cbc5c3605411e6c07567dc4960b8d23fb159995cb73711c8058c45982bdab7",REACT_APP_AUTH0_DOMAIN:"https://dev-iehguv204612q2sk.us.auth0.com",REACT_APP_AUTH0_CLIENT_ID:"RSiNbEo6RBx6Mxq0PT9YvbCXJKN7HG17",REACT_APP_AUTH0_AUDIENCE:"https://api.isdata.ai"}.REACT_APP_AUTH0_CLIENT_SECRET,o="https://api.isdata.ai",s={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BASE_URL:"https://demo-chat.isdata.ai",REACT_APP_HOLOOCEAN_ENDPOINT:"ws://bluemvmt-holoocean-1-ws.ngrok.dev",REACT_APP_DB:"isdata-usmcom.usm_com",REACT_APP_MAPBOX_ACCESS_TOKEN:"pk.eyJ1Ijoiam1wYXVsbWFwYm94IiwiYSI6ImNtZHh0ZmR6MjFoaHIyam9vZmJ4Z2x1MDYifQ.gR60szhfKWhTv8MyqynpVA",REACT_APP_CHAT_API_KEY:"test",REACT_APP_BEARER_TOKEN:"0S0290SN1929VM192SDSsld239092@%^&*341267812",REACT_APP_ACCESS_PASSWORD:"U!nd37w4t3r@",REACT_APP_LOCAL_STORAGE_SECRET:"local",REACT_APP_AUTH0_SECRET:"84cbc5c3605411e6c07567dc4960b8d23fb159995cb73711c8058c45982bdab7",REACT_APP_AUTH0_DOMAIN:"https://dev-iehguv204612q2sk.us.auth0.com",REACT_APP_AUTH0_CLIENT_ID:"RSiNbEo6RBx6Mxq0PT9YvbCXJKN7HG17",REACT_APP_AUTH0_AUDIENCE:"https://api.isdata.ai"}.REACT_APP_AUTH0_CALLBACK_URL||`${window.location.origin}/auth/callback`,a=[];if(a.length>0)return(0,jr.jsx)("div",{style:{padding:20,textAlign:"center",backgroundColor:"#1e293b",color:"white",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:(0,jr.jsxs)("div",{style:{maxWidth:"600px",padding:"2rem",backgroundColor:"#ef4444",borderRadius:"8px",color:"white"},children:[(0,jr.jsx)("h1",{style:{margin:"0 0 1rem 0",fontSize:"1.5rem"},children:"Auth0 Configuration Missing"}),(0,jr.jsx)("p",{style:{margin:"0 0 1rem 0"},children:"Please make sure you have set up your .env file with the following required Auth0 variables:"}),(0,jr.jsx)("ul",{style:{textAlign:"left",margin:"1rem 0",padding:"0 0 0 2rem"},children:a.map(e=>(0,jr.jsx)("li",{style:{margin:"0.5rem 0"},children:(0,jr.jsx)("code",{style:{backgroundColor:"rgba(255,255,255,0.2)",padding:"2px 4px",borderRadius:"3px"},children:e})},e))}),(0,jr.jsx)("p",{style:{margin:"1rem 0 0 0",fontSize:"0.875rem",opacity:.9},children:"Check your .env file in the project root and restart the development server after making changes."})]})});console.log("Auth0 Configuration (SPA):",{domain:n,clientId:r,hasClientSecret:!!i,audience:"https://api.isdata.ai",callbackUrl:s});const l={redirect_uri:s,scope:"openid profile email"};return o&&!o.includes("localhost")&&(l.audience=o),(0,jr.jsx)(qn,{domain:n,clientId:r,authorizationParams:l,useRefreshTokens:!0,cacheLocation:"localstorage",skipRedirectCallback:!1,children:t})},tee=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,6453)).then(t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:o,getTTFB:s}=t;n(e),r(e),i(e),o(e),s(e)})};s.createRoot(document.getElementById("root")).render((0,jr.jsx)(i.StrictMode,{children:(0,jr.jsx)(eee,{children:(0,jr.jsx)(rt,{children:(0,jr.jsx)(Q9,{})})})})),tee()})()})();
//# sourceMappingURL=main.49962564.js.map